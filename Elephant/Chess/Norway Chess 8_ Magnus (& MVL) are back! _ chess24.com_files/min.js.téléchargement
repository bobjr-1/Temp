function inheritable(){throw new Error("inheritable can't be instantiated")}function buildTree(e,t){function n(){var i={};t.fen&&(i.fen=e.toString()),t.move&&e.getCurrentPosition()!==e.getStartPosition()&&(i.move=e.getCurrentPosition().getCan()),t.id&&(i.id=e.getCurrentPosition().knotId),t.comment&&void 0!==e.getCurrentPosition().comment&&(i.comment=e.getCurrentPosition().comment),t.question&&void 0!==e.getCurrentPosition().question&&(i.question={question:e.getCurrentPosition().question.question,answers:e.getCurrentPosition().question.getAnswer()}),i.children=[];for(var o=0;o<e.countChildrenMoves();o++)e.gotoChildrenPositionById(o),i.children[o]=n(r),e.gotoParentPosition();return i}var i=e.getCurrentPosition(),r={};return e.gotoStart(r),r=n(),e.setCurrentPosition(i),r}function Linkified(e,t){this._defaults=defaults,this.element=e,this.setOptions(t),this.init()}function popupList(e,t){for(var n=jQuery("<div/>").addClass("chess-choice-bg"),i=jQuery("<ul/>").addClass("chess-choice"),r=this,o=0;o<e.length;o++)i.append(jQuery("<li/>").html(e[o].text).on("click",function(e){return function(){"function"==typeof t&&t(e),r.remove()}}(e[o].id)).on("mouseover",function(){jQuery(this).hasClass("highlighted")||(i.find(".highlighted").removeClass("highlighted"),jQuery(this).addClass("highlighted"))}));i.find("li:first").addClass("first"),i.find("li:last").addClass("last"),i.appendTo("body").css({left:jQuery(window).width()/2-i.width()/2+"px",top:jQuery(window).height()/2-i.height()/2+"px"}),n.insertBefore(i).css({left:parseInt(i.css("left"))-10+"px",top:parseInt(i.css("top"))-10+"px",width:i.width()+20+"px",height:i.height()+20+"px"});var a=0;return this.down=function(){return a=Math.min(a+1,i.find("li").length-1),this.highlight(),this},this.up=function(){return a=Math.max(a-1,0),this.highlight(),this},this.value=function(){return e[a].id},this.highlight=function(){return i.find(".highlighted").removeClass("highlighted"),i.find("li:eq("+a+")").addClass("highlighted"),this},this.remove=function(){return n.remove(),i.remove(),this},this.select=function(){return i.find("li.highlighted").trigger("click"),this},this.highlight(),this}function achievementsManager(){function e(){n.initEveryTime(),jQuery(document).on("click",".missionIconBtn",function(){n.handleMissionIconClick(this)}),jQuery(document).on("click",".closeMissionBadgesPanel",function(){n.hideMissionBadges(this.getAttribute("data-firstmission"))}),jQuery(document).on("click",".seeAllItems",function(){n.showAllItems(this)}),jQuery(document).on("click",".closeAllItems",function(){n.closeAllItems(this)}),t=jQuery("<div>",{id:"achievementsBubble"}).append(jQuery("<h3>",{id:"bubbleTitle"}).html("&nbsp;")).append(jQuery("<p>",{id:"bubbleDescription"}).html("&nbsp;")),jQuery("body").append(t),t.bubble({side:"bottom",point:"precise",flexible:!0,noanimation:!0})}var t,n=this;return achievementsManager.instance?(achievementsManager.instance.initEveryTime(),achievementsManager.instance):(achievementsManager.instance=n,n.initEveryTime=function(){jQuery(".userProfileTabs ul.tabNav > li > a").on("click",function(e){return n.handleMenuTabClick(this,e)}),jQuery("#finishedAchievementsBtn").on("click",function(){jQuery("#openAchievements").hide(),n.showAchievementsTab()}),jQuery("#openAchievementsBtn").on("click",function(){jQuery("#finishedAchievements").hide(),n.showAchievementsTab()}),n.openFirstSubtab(),jQuery(".withBubble").on("mouseover",function(){n.showBubble(this)}),jQuery(".withBubble").on("mouseout",function(){t.bubble("hide")})},n.openFirstSubtab=function(){jQuery("#finishedAchievementsBtn").trigger("click"),jQuery(".tabContentWrap").css("height","auto"),jQuery("#finishedAchievementsBtn").parent("li").addClass("current"),setTimeout(function(){jQuery("#openAchievementsBtn").parent("li").hasClass("current")||jQuery("#finishedAchievementsBtn").parent("li").addClass("current"),jQuery(".tabContentWrap").css("height","auto")},100)},n.handleMenuTabClick=function(e,t){if("tabAchievements"==e.getAttribute("data-tab-content-id")){if(jQuery(e).parent("li").hasClass("withSubTabs")){try{t.stopPropagation()}catch(i){t.cancelBubble=!0}return!1}n.openFirstSubtab()}else n.hideAchievementsTab()},n.showAchievementsTab=function(){jQuery("#tabAchievements").addClass("forceTabVisibility")},n.hideAchievementsTab=function(){jQuery("#tabAchievements").removeClass("forceTabVisibility")},n.handleMissionIconClick=function(e){var t=e.getAttribute("data-mission"),i=jQuery("#missionBadgesItem"+t);"block"==i.css("display")?n.hideMissionBadges(t):n.showMissionBadges(t)},n.showMissionBadges=function(e){var t=jQuery("#missionBadgesItem"+e),n=t.parents(".achievementsBadgeDetails");n.find(".missionBadgesItem").hide(),t.show(),n.show();var i=jQuery("#missionIcon"+e);i.parent("ul").find(".missionIcon").removeClass("current"),i.addClass("current")},n.hideMissionBadges=function(e){var t=jQuery("#missionBadgesItem"+e),n=t.parents(".achievementsBadgeDetails");n.find(".missionBadgesItem").hide(),n.hide();var i=jQuery("#missionIcon"+e);i.parent("ul").find(".missionIcon").removeClass("current")},n.showAllItems=function(e){var t=e.getAttribute("data-allitems");jQuery(e).hide(),jQuery("#closeAllItemsBtn"+t).show(),jQuery("#allItemsWrapper"+t).slideDown()},n.closeAllItems=function(e){var t=e.getAttribute("data-allitems");jQuery(e).hide(),jQuery("#seeAllItemsBtn"+t).show(),jQuery("#allItemsWrapper"+t).slideUp()},n.showBubble=function(e){var n=jQuery(e);t.bubble("hide"),setTimeout(function(){var i=n.find(".bubbleInfoBadgeTitle").html(),r=n.find(".bubbleInfoBadgeDescription").html();t.find("#bubbleTitle").html(i),t.find("#bubbleDescription").html(r),t.show().bubble("realign",e).bubble("show")},1)},e(),n)}function loadTopTournamentPage(){function e(){function e(){function e(e){e.preventDefault(),jQuery.post("/api/web/NewsletterAPI/subscribe",{email:$(this).find("#email").val(),channel:$(this).data("channel"),csrf:config.csrf()}).success(function(){n.hide();var e=n.find("#email").prop("disabled");e&&r(e),$(".newsletter .message").html(t(a.message)).addClass("success").show(),setTimeout(function(){n.parent().fadeOut()},5e3),$.cookie(a.cookieKey,JSON.stringify("success"),{expires:30,path:"/"}),mixpanel.track("Newsletter Subscribe",{Type:a.type,Registered:e?"yes":"no"}),Handler.tracking("newsletter","subscribe",a.type)}).error(function(e){var t=JSON.parse(e.responseText),n=t.errors.error[0];$(".newsletter .message").html(n).addClass("success").show()})}if($("#newsLetterTopTournamentId").length>0){var n=$('form[name="newsletterSubscription"]'),i=(new Date).getDate();$("dl[data-day="+i+"]").addClass("active"),n.on("submit",e)}}e(),mixpanel.track("Visit",{Type:a.type}),jQuery(function(){var e=(new Date).getDate();$("dl[data-day="+e+"]").addClass("active"),a.addPlayerScores&&i(),a.activityStream&&new View.ActivityStream(".communityStream","community",a.activityStream).link(notificationHandler),a.sidebarAdd&&new View.SidebarAdvertisementRotation(".sidebarAdd",a.sidebarAdd),a.trackConfirmation&&r(!1)})}function n(){function e(e,t){return"undefined"!=typeof e?e:t}var t=o.attr("data");t=JSON.parse(t)||{};var n={message:t.pageTitle?"Successfully signed up for the "+t.pageTitle+" Newsletter":"Successfully signed up for the Newsletter",type:e(t.type,"TopTournament"),cookieKey:t.type?"topTournament_newsletter_"+t.type:"topTournament_newsletter",addPlayerScores:e(t.addPlayerScores,!1),activityStream:e(t.activityStream,!1),trackConfirmation:e(t.trackConfirmation,!1),sidebarAdd:e(t.sidebarAdd,!1)};return n}function i(){var e=a.addPlayerScores,t=new Controller.BroadcastTournament;t.on("tournamentAdded",function(n,i){if(i.id==e.tournamentId){var r=t.getPlayerResults(e.tournamentId,e.player1Id,e.roundId),o=t.getPlayerResults(e.tournamentId,e.player2Id,e.roundId);$(".tournamentScore .playerLeft dt.normal").html(r.p),$(".tournamentScore .playerRight dt.normal").html(o.p)}})}function r(e){Handler.tracking("newsletter","confirm",a.type),mixpanel.track("Newsletter Confirm",{Type:a.type,Registered:e?"yes":"no"})}var o=$("#topTournamentPageId");if(!(o.length<=0)){var a=n();e()}}function chesspairs(){function e(){if(i(),k.show(),b.html(t("{{n}} seconds",{"{{n}}":0})),v.show(),u=0,h=0,0==x){x=!0,n(),C.sort(o);for(var e=0;17>e;e++)$(".card:first-child").clone().appendTo("#cards");v.children().each(function(e){$(this).css({left:($(this).width()+15)*(e%6),top:($(this).height()+15)*Math.floor(e/6)});var t=C.pop();$(this).find(".back").addClass(t),$(this).attr("data-pattern",t),$(this).click(a)}),r()}}function n(){C=[].concat(j,j)}function i(){v.html('<div class="card"><div class="face front"></div><div class="face back"></div></div>')}function r(){if(x){var e=Date.now();f=setInterval(function(){var n=Date.now()-e;b.html(t("{{n}} seconds",{"{{n}}":Math.round(n/1e3)}))},1e3)}}function o(){return.5-Math.random()}function a(){$(".card-flipped").size()>1||($(this).addClass("card-flipped"),2==$(".card-flipped").size()&&setTimeout(s,700))}function s(){l()?($(".card-flipped").removeClass("card-flipped").addClass("card-removed"),c()):$(".card-flipped").removeClass("card-flipped")}function l(){var e=$(".card-flipped"),t=$(e[0]).data("pattern"),n=$(e[1]).data("pattern");return t==n}function c(){8>h?(h++,$(".card-removed").remove()):($(".card-removed").remove(),m.hide(),g.show(),clearTimeout(f))}function d(){x=!1,i(),clearTimeout(f),n(),e()}var u,h,f,p=$("#intro"),m=$("#game"),g=$("#complete"),v=$("#cards"),y=$(".reset"),b=$(".score"),w=$("#play"),k=$("#timer"),x=!1,C=[],j=["bishop-mad-black","king-happy-black","pawn-annoyed-black","queen-surprised-black","rook-heart-black","bishop-heart-white","bishop-mad-white","king-happy-white","pawn-idea-white"];w.on("click",function(t){t.preventDefault(),p.hide(),y.show(),m.show(),e()}),y.on("click",function(e){e.preventDefault(),g.hide(),m.show(),d()})}if(function(){var e=window.location.pathname.match(/site\/browser/);if(!e){var t=window.navigator.userAgent,n=!0;try{for(var i=[{regexp:/; MSIE ([\d\.]+);/i,version:9,index:1},{regexp:/Firefox\/([\d\.]+)/i,version:3,index:1},{regexp:/^(opera|opr)\/([\d\.]+)/i,version:14,index:2}],r=0;r<i.length;r++){var o=t.match(i[r].regexp);if(o&&o[i[r].index]<=i[r].version){n=!1;break}}}catch(a){n=!1}if(!n)throw window.location="/site/browser","Unsupported browser"}window.isActive=function(){for(var e=["hidden","webkitHidden","mozHidden","msHidden"],t=0;t<e.length;t++)if(void 0!==document[e[t]])return!document[e[t]]}}(),function(e){e=e||{};var t=Object.prototype.hasOwnProperty;return e.every=e.every||function(e,n,i){if("function"!=typeof n)throw new TypeError;for(var r in e)if(t.call(e,r)&&!n.call(i,e[r],r,e))return!1;return!0},e.extend=e.extend||function(e){for(var n=1,i=arguments.length;i>n;n++)for(var r in arguments[n])t.call(arguments[n],r)&&(e[r]=arguments[n][r]);return e},e.filter=e.filter||function(e,n,i){if("function"!=typeof n)throw new TypeError;var r={};for(var o in e)t.call(e,o)&&n.call(i,e[o],o,e)&&(r[o]=e[o]);return r},e.find=e.find||function(e,n,i){for(var r in e)if(t.call(e,r)&&n.call(i,e[r],r,e))return e[r]},e.findKey=e.findKey||function(e,n,i){for(var r in e)if(t.call(e,r)&&n.call(i,e[r],r,e))return r},e.forEach=e.forEach||function(e,n){if("function"!=typeof n)throw new TypeError;for(var i in e)t.call(e,i)&&n(e[i],i)},e.getLength=e.getLength||function(e){return Object.keys(e).length},e.has=e.has||function(e){for(var n=1,i=arguments.length;i>n;n++)if(!t.call(e,arguments[n]))return!1;return!0},e.isEmpty=e.isEmpty||function(e,n){for(var i in e)if(n||t.call(e,i))return!1;return!0},e.keyOf=e.keyOf||function(e,n){for(var i in e)if(t.call(e,i)&&n===e[i])return i},e.map=e.map||function(e,n,i){if("function"!=typeof n)throw new TypeError;var r={};for(var o in e)t.call(e,o)&&(r[o]=n.call(i,e[o],o,e));return r},e.merge=e.merge||function(){return Array.prototype.unshift.call(arguments,{}),e.extend.apply(this,arguments)},e.copy=e.copy||function(e){return void 0===e?void 0:JSON.parse(JSON.stringify(e))},e.reduce=e.reduce||function(e,n,i){if(null===e||void 0===e)throw new TypeError("Object.reduce called on null or undefined");if("function"!=typeof n)throw new TypeError(n+" is not a function");var r=arguments.length<3;for(var o in e)if(t.call(e,o)){var a=!0;if(void 0===i&&r){i=e[o];continue}i=n(i,e[o],o,e)}if(r&&!a)throw new TypeError("neither initial value nor object properties to iterate");return i},e.some=e.some||function(e,n,i){if("function"!=typeof n)throw new TypeError;for(var r in e)if(t.call(e,r)&&n.call(i,e[r],r,e))return!0;return!1},e.subset=e.subset||function(e,n){arguments.length>2&&(n=Array.prototype.slice.call(arguments,1));for(var i={},r=0,o=n.length;o>r;r++){var a=n[r];t.call(e,a)&&(i[a]=e[a])}return i},e.values=e.values||function(e){for(var t=Object.keys(e),n=[],i=0,r=t.length;r>i;i++)n.push(e[t[i]]);return n},e.without=e.without||function(e,n){var i={};for(var r in e)t.call(e,r)&&-1===n.indexOf(r)&&(i[r]=e[r]);return i},e}(Object),"function"!=typeof Math.randomBetween&&(Math.randomBetween=function(e,t){return Math.floor(Math.random()*(t-e+1)+e)}),"function"!=typeof Math.ChiSquare&&!function(){function e(e){if(0>e)return Number("0/0");for(var t=o[0],n=o.length-1;n>0;--n)t+=o[n]/(e+n);var i=e+r+.5;return.5*Math.log(2*Math.PI)+(e+.5)*Math.log(i)-i+Math.log(t)-Math.log(e)}function t(r){if(.5>r)return Math.PI/(Math.sin(Math.PI*r)*t(1-r));if(r>100)return Math.exp(e(r));r-=1;for(var o=i[0],a=1;n+2>a;a++)o+=i[a]/(r+a);var s=r+n+.5;return Math.sqrt(2*Math.PI)*Math.pow(s,r+.5)*Math.exp(-s)*o}Math.ChiSquare=function(e,n){if(0>e)return 0;var i=n/2;return 1/(Math.pow(2,i)*t(i))*Math.pow(e,i-1)*Math.exp(-e/2)};var n=7,i=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,1.5056327351493116e-7],r=607/128,o=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22]}(),"function"!=typeof Math.between&&(Math.between=function(e,t,n){return isNaN(e)||isNaN(t)||isNaN(n)?NaN:e>=Math.min(t,n)&&e<=Math.max(t,n)}),"function"!=typeof Math.Gaussian&&(Math.Gaussian=function(e,t){if(0>=t)throw new Error("Variance must be > 0 (but was "+t+")");var n=Math.sqrt(t),i=1/t,r=i*e,o=function(e){var t=Math.abs(e),n=1/(1+t/2),i=n*Math.exp(-t*t-1.26551223+n*(1.00002368+n*(.37409196+n*(.09678418+n*(-.18628806+n*(.27886807+n*(-1.13520398+n*(1.48851587+n*(-.82215223+.17087277*n)))))))));return e>=0?i:2-i},a=function(e){if(e>=2)return-100;if(0>=e)return 100;for(var t=1>e?e:2-e,n=Math.sqrt(-2*Math.log(t/2)),i=-.70711*((2.30753+.27061*n)/(1+n*(.99229+.04481*n))-n),r=0;2>r;r++){var a=o(i)-t;i+=a/(1.1283791670955126*Math.exp(-(i*i))-i*a)}return 1>e?i:-i},s=function(e,t){var n=t/e,i=1/e;return Math.Gaussian(n,i)};return{mean:e,variance:t,standardDeviation:n,precision:i,precisionmean:r,pdf:function(i){var r=n*Math.sqrt(2*Math.PI),o=Math.exp(-Math.pow(i-e,2)/(2*t));return o/r},cdf:function(t){return.5*o(-(t-e)/(n*Math.sqrt(2)))},ppf:function(t){return e-n*Math.sqrt(2)*a(2*t)},mul:function(e){return s(i+e.precision,r+e.precisionmean)},div:function(e){return s(i-e.precision,r-e.precisionmean)}}}),"function"!=typeof Math.getPercentages&&(Math.getPercentages=function(e){e=e.map(function(e){return parseInt(e,10)||0});for(var t=e.reduce(function(e,t){return e+t}),n=[],i=[],r=0;r<e.length;r++){var o=100*e[r]/t,a=Math.floor(o);n.push(a),i.push(o-a)}for(;n.reduce(function(e,t){return e+t})<100;){for(var s,r=0;r<i.length;r++){var l=i[r];(void 0===s||l>i[s])&&(s=r)}n[s]++,i[s]=0}return n}),"function"!=typeof Math.sgn&&(Math.sgn=function(e){return e?0>e?-1:1:0}),dummy=function(){},isValidUUID=function(e){var t=/^[0-9a-zA-Z_-]{22}$/;return void 0!==e&&null!==e.match(t)},uuid=function(){function e(e){var t=(Math.random().toString(16)+"000000000").substr(2,8);return e?"-"+t.substr(0,4)+"-"+t.substr(4,4):t}return e()+e(!0)+e(!0)+e()},jsonToParams=function(e){var t=[];for(var n in e)if("object"==typeof e[n])for(var i=0;i<e[n].length;i++)t.push(n+"="+e[n][i]);else t.push(n+"="+e[n]);return t.join("&")},Array.prototype.random||Object.defineProperty(Array.prototype,"random",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this.length?this[Math.randomBetween(0,this.length-1)]:void 0}}),Array.prototype.compare||Object.defineProperty(Array.prototype,"compare",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(!e)return!1;if(this.length!==e.length)return!1;for(var t=0;t<this.length;t++)if(Array.isArray(this[t])&&Array.isArray(e[t])){if(!this[t].compare(e[t]))return!1}else if(this[t]!==e[t])return!1;return!0}}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,n=Object(this),i=n.length>>>0,r=arguments[1],o=0;i>o;o++)if(o in n&&(t=n[o],e.call(r,t,o,n)))return t;return void 0}}),Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,n=Object(this),i=n.length>>>0,r=arguments[1],o=0;i>o;o++)if(o in n&&(t=n[o],e.call(r,t,o,n)))return o;return-1}}),Array.prototype.last||Object.defineProperty(Array.prototype,"last",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this[this.length-1]}}),Array.prototype.pushArray||Object.defineProperty(Array.prototype,"pushArray",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return this.push.apply(this,e)}}),Array.prototype.move||Object.defineProperty(Array.prototype,"move",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){return this.splice(t,0,this.splice(e,1)[0]),this}}),Array.prototype.remove||Object.defineProperty(Array.prototype,"remove",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){var n=this.slice((t||e)+1||this.length);return this.length=0>e?this.length+e:e,this.push.apply(this,n)}}),Array.prototype.removeByValue||Object.defineProperty(Array.prototype,"removeByValue",{enumerable:!1,configurable:!0,writable:!0,value:function(){for(var e,t,n=arguments,i=n.length;i&&this.length;)for(e=n[--i];-1!==(t=this.indexOf(e));)this.splice(t,1);return this}}),"function"!=typeof Array.convert&&(Array.convert=function(e){return Array.prototype.slice.call(e)}),Array.prototype.contains||Object.defineProperty(Array.prototype,"contains",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return-1!==this.indexOf(e)}}),Array.prototype.unique||Object.defineProperty(Array.prototype,"unique",{enumerable:!1,configurable:!0,writable:!0,value:function(){for(var e=this.concat(),t=0;t<e.length;++t)for(var n=t+1;n<e.length;++n)e[t]===e[n]&&e.splice(n--,1);return e}}),Number.addThousandSeparators||!function(){var e;Number.addThousandSeparators=function(t,n){return e||(e=",",window&&window.config&&window.config.language&&["de","es"].contains(window.config.language())&&(e=".")),t.toString().replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1"+(n||e))}}(),void 0===Date.getSplitedTime&&(Date.getSplitedTime=function(e){return{days:Math.floor(e/864e5),hours:Math.floor(e/36e5)%24,minutes:Math.floor(e/6e4)%60,seconds:Math.floor(e/1e3)%60,milliseconds:e%1e3}}),String.prototype.lpad||Object.defineProperty(String.prototype,"lpad",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){for(var n=this;n.length<t;)n=e+n;return n}}),String.prototype.contains||Object.defineProperty(String.prototype,"contains",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return-1!==this.indexOf(e)}}),String.prototype.rpad||Object.defineProperty(String.prototype,"rpad",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){for(var n=this;n.length<t;)n+=e;return n}}),String.prototype.toCamelCase||Object.defineProperty(String.prototype,"toCamelCase",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=e?/((\-|^)[a-z])/g:/(\-[a-z])/g;return this.replace(t,function(e){return e.toUpperCase().replace("-","")})}}),String.prototype.permalink||Object.defineProperty(String.prototype,"permalink",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=[["а","А"],["б","Б"],["в","В"],["г","Г"],["д","Д"],["е","Е"],["ё","Ё"],["ж","Ж"],["з","З"],["и","И"],["й","Й"],["к","К"],["л","Л"],["м","М"],["н","Н"],["о","О"],["п","П"],["р","Р"],["с","С"],["т","Т"],["у","У"],["ф","Ф"],["х","Х"],["ц","Ц"],["ч","Ч"],["ш","Ш"],["щ","Щ"],["ъ","Ъ"],["ы","Ы"],["ь","Ь"],["э","Э"],["ю","Ю"],["я","Я"],["ä","Ä"],["ö","Ö"],["ß","ß"],["ü","Ü"],["ñ","Ñ"],["ó","Ó"],["í","Í"],["á","Á"],["é","É"],["ú","Ú"],["ø","Ø"]],t=["a","b","v","g","d","e","e","zh","z","i","y","k","l","m","n","o","p","r","s","t","u","f","h","c","ch","sh","sch","j","y","","e","yu","ya","ae","oe","ss","ue","n","o","i","a","e","u","o"];return function(){for(var n=""+this,i=0;i<e.length;i++)n=n.replace(new RegExp("["+e[i].join("")+"]","g"),t[i]);return n=n.toLowerCase().replace(/\W/g,"-").replace(/-+/g,"-"),"-"===n[0]&&(n=n.substr(1)),"-"===n[n.length-1]&&(n=n.substr(0,n.length-1)),n}}()}),String.prototype.capitalize||Object.defineProperty(String.prototype,"capitalize",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this[0].toUpperCase()+this.slice(1)}}),String.prototype.ellipsis||Object.defineProperty(String.prototype,"ellipsis",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=""+this;if("object"!=typeof e&&(e={length:20}),e.length||e.pixels||(e={length:20}),e.length&&t.length>e.length)return t.substr(0,e.length-3).trim()+"...";if(e.pixels&&"undefined"!=typeof jQuery){e.append=e.append||"";var n=jQuery("<div/>").css({position:"absolute",opacity:0,left:0,top:0,"white-space":"nowrap"}).appendTo("body").html(t+e.append),i=!1;for(e.css&&n.css(e.css);n.width()>e.pixels;)i=!0,t=t.substr(0,t.length-1).trim(),n.html(t+"..."+e.append);t+=i?"...":"",n.remove()}return t}}),String.prototype.sanitize||Object.defineProperty(String.prototype,"sanitize",{enumerable:!1,configurable:!0,writable:!0,value:function(){return this.replace(/<[^>]+>/g,"")}}),JSON.betterParse||(JSON.betterParse=function(e){return"undefined"===e?void 0:JSON.parse(e)}),Object.removeUndefined||(Object.removeUndefined=function(e){for(var t in e)e.hasOwnProperty(t)&&void 0===e[t]&&delete e[t];return e}),Object.getAndRemove||(Object.getAndRemove=function(e,t){var n=e[t];return n&&delete e[t],n}),JSON.betterParse||(JSON.betterParse=function(e){return"undefined"===e?void 0:JSON.parse(e)}),Object.diff||(Object.diff=function(e,t){if(Array.isArray(t))var n=[];else n={};void 0===e&&(e={}),void 0===t&&(t={});for(var i in t)if(t.hasOwnProperty(i))if(Array.isArray(t[i]))JSON.stringify(e[i])!==JSON.stringify(t[i])&&(n[i]=t[i]);else if("object"==typeof t[i]){var r=Object.diff(e[i],t[i]);(Object.keys(r).length||"object"!=typeof e[i])&&(n[i]=r)}else e[i]!==t[i]&&(n[i]=t[i]);for(var i in e)e.hasOwnProperty(i)&&void 0===t[i]&&void 0!==e[i]&&(n[i]=null);return n}),Object.patch||(Object.patch=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(null===t[n]?delete e[n]:"object"!=typeof t[n]||Array.isArray(t[n])?e[n]=t[n]:("object"!=typeof e[n]&&(e[n]={}),Object.patch(e[n],t[n])));if(Array.isArray(e))for(;e.length&&void 0===e[e.length-1];)e.pop();return e}),Object.getByPath||(Object.getByPath=function(e,t,n){n=n||".",t=t.split(n);var i=t.shift();return i&&e&&e[i]?0===t.length?e[i]:Object.getByPath(e[i],t.join(n)):void 0}),Object.setByPath||(Object.setByPath=function(e,t,n,i){i=i||".";for(var r=t.split(i),o=0;o<r.length-1;o++){var a=r[o];e.hasOwnProperty(a)||(e[a]={}),e=e[a]}e[r[r.length-1]]=n}),function(){var e="/api/web/UserAPI/getUserData",t="/api/web/UserAPI/getUserThemes",n="user_data",i={};window.config={level:function(e){if("undefined"==typeof e&&(e=!1),i.level&&!e)return i.level;var t=jQuery.cookie(n);if(t)try{i.level=JSON.betterParse(t).level}catch(r){errorHandler.error(r,{json:t})}return i.level||(i.level={isGuest:!0,isPremium:!1,isAdmin:!1,isFraudAgent:!1}),i.level.toString=function(){return i.level.isPremium?"premium":i.level.isGuest?"guest":"registered"},i.level},user:function(t){if(t="undefined"!=typeof t?t:!1,i.user)return i.user;var r=jQuery.cookie(n);if(r)try{i.user=JSON.betterParse(r).user}catch(o){errorHandler.error(o,{json:r})}return(!i.user||t||i.user&&!i.user.name)&&jQuery.ajax({url:e,cache:!1,async:!1,dataType:"json",type:"GET"}).done(function(e){e.data&&e.data.userData||errorHandler.error(new Error("invalid response",{response:e}));var t=e.data.userData;$.cookie(t.name,t.value,{path:"/",expires:t.ttl});var n=JSON.parse(t.value);i.user=n.user,config.level()}).fail(function(e,t,n){errorHandler.error(n)}),i.user?i.user:{}},themes:function(){return i.themes?i.themes:(jQuery.ajax({url:t,cache:!1,async:!1,dataType:"json",type:"GET"}).done(function(e){e.data&&e.data.themes||errorHandler.error(new Error("invalid response",{response:e})),i.themes=e.data.themes}).fail(function(e,t,n){errorHandler.error(n)}),i.themes?i.themes:{})},csrf:function(){return i.csrf=i.csrf||jQuery.cookie("csrf")},version:function(){return i.version||(i.version=jQuery("meta#version").attr("content"))},language:function(){return i.language||(i.language=jQuery("html").attr("lang"))},assetDir:function(){return i.assetDir||(i.assetDir=jQuery("link[rel=media-url]").attr("href"))}}}(),function(){var e={},t=function(t,n,i,r){function o(e){return void 0===e?v:void 0===v[e]?[]:v[e]}function a(e,n,i,r){var o=function(){n.apply(this,arguments),u(e,o,r)};return b.push({wrapper:o,original:n,alias:r}),l(e,o,i,r),t}function s(e){return Array.isArray(e)||("string"!=typeof e&&(e=e.toString()),e=e.split(" ")),e}function l(e,n,i,r){"function"!=typeof n&&errorHandler.msg("error",new Error("no callback given during on-registration"),!0),e=s(e);for(var o=0;o<e.length;o++){var a=e[o];void 0===v[a]&&(v[a]=[]),v[a].push({callback:n,sync:r,alias:i})}return t}function c(t){if(e[t])return e[t];var n=t.split("."),i=[],r=n[0];i.push(r);for(var o=1;o<n.length;o++)r=r+"."+n[o],i.push(r);return e[t]=d(i),e[t]}function d(e){for(var t=[e[0]],n=0;n<e.length;n++)for(var i=e[n].split("."),r=i.length-1,o=i.splice(r,1)[0],a=i.length,s=Math.pow(2,a),l=0;s>l;l++){for(var c=[],d=l.toString(2).lpad("0",a),u=d.split(""),h=0;h<u.length;h++)c.push("0"===u[h]?"*":i[h]);a>0&&c.push(o),t.push(c.join("."))}return t}function u(e,n){if(void 0===e)return v={},t;var i="function"==typeof n,r="string"==typeof n;if(i)for(var o=0;o<b.length;o++)if(b[o].original===n){n=b[o].wrapper,b.splice(o,1);break}e=s(e);for(var a=0;a<e.length;a++){var l=e[a];if(void 0!==v[l])if(void 0!==n){for(var c=v[l].length-1;c>=0;c--)(i&&v[l][c].callback===n||r&&v[l][c].alias===n)&&v[l].splice(c,1);0===v[l].length&&delete v[l]}else delete v[l]}return t}function h(e){if(e)var t=[e];else{t=[];for(var n in y)t.push(n)}for(var i=0;i<t.length;i++){n=t[i];for(var r=0;r<y[n].length;r++)clearTimeout(y[n][r]);delete y[n]}}function f(e,t,n){try{i?t(e,n):t(n)}catch(o){errorHandler.msg("warning",new Error("registered subscriber ended with following error"),!1,{eventObject:e,additionalData:n}),errorHandler.msg("error",o,!r,{eventObject:e,additionalData:n})}}function p(e,t,n){return g(e,t,n,!0)}function m(e,t,n){return g(e,t,n,!1)}function g(e,n,i,r){"string"!=typeof e&&(e=e.toString());for(var o=e.split(" "),a=r,s=0;s<o.length;s++)for(var l=o[s],d=c(l),u=0;u<d.length;u++){var h=d[u],p={publisher:t,currentChannel:h,channel:l};if(void 0!==v[h])for(var m=0;void 0!==v[h]&&m<v[h].length;m++){var g=v[h][m].callback,b=r;void 0===b&&(b=v[h][m].sync),void 0===b&&(b=!0),b?f(p,g,n):(a=!1,void 0===y[h]&&(y[h]=[]),y[h].push(setTimeout(function(){f(p,g,n)},0)))}}return"function"==typeof i&&(a===!1?setTimeout(function(){i(t,n)},0):i(t,n)),t}void 0===r&&(r=!0),void 0===n&&(n={}),void 0===i&&(i=!0),n.on=n.on||"on",n.once=n.once||"once",n.off=n.off||"off",n.cancelEmit=n.cancelEmit||"cancelEmit",n.emit=n.emit||"emit",n.emitSync=n.emitSync||"emitSync",n.emitAsync=n.emitAsync||"emitAsync",n.get=n.get||"getSubscribers";var v={},y={},b=[];for(var w in n)void 0!==t[n[w]]&&errorHandler.msg("error",new Error("can not make this to a publisher, because a needed function is blocked"),!0,{blockedFunction:w});return t[n.on]=l,t[n.once]=a,t[n.off]=u,t[n.cancelEmit]=h,t[n.emit]=g,t[n.emitSync]=p,t[n.emitAsync]=m,t[n.get]=o,t};"undefined"!=typeof exports?module.exports=t:("undefined"==typeof Extend&&(Extend={}),Extend.Publisher=t)}(),function(e,t){function n(){function e(e){"undefined"!=typeof exports&&require("./view/"+e)}function o(t){(void 0===a.View||void 0===a.View[t])&&e(t.toLowerCase()+".js");var n=function(){},i=errorHandler.View[t];if(n.prototype=i.prototype,void 0===i)throw new Error("the requested View for the errorHandler doesn't exist");var r=new n;Array.prototype.shift.call(arguments),i.apply(r,arguments),r.link(a)}if(n.instance)return n.instance;var a=this,s=[],l={0:0,3:3,6:6,8:8,10:10,debug:0,notice:3,warning:6,error:8,critical:10};t&&(window.onerror=function(e,t,n,i,r){return r&&r._reported||a.notice(r||"Uncaught Exception",{msg:e,url:t,line:n,column:i},!1),!1},a.hasErrors=function(){return s.length>0},a.getErrors=function(){return s},a.clearErrors=function(){s.length=0}),Extend.Publisher(a);var c;return a.setAdditionalData=function(e){return c=e,a},a.debug=function(e,t,n){n!==!0&&(n=!1),a.msg("debug",e,n,t)},a.notice=function(e,t,n){n!==!0&&(n=!1),a.msg("notice",e,n,t)},a.warning=function(e,t,n){n!==!0&&(n=!1),a.msg("warning",e,n,t)},a.error=function(e,t,n){void 0===n&&(n=!0),a.msg("error",e,n,t)},a.critical=function(e,t,n){void 0===n&&(n=!0),a.msg("critical",e,n,t)},a.msg=function(e,n,o,d){if(o=o||!1,!o||n instanceof Error)u="string"==typeof n?{name:n}:n;else var u=new Error(n);if(void 0===l[e])throw new Error("errorLevel ("+e+") is not valid");var h=(new Helper.UUID).getShort();u.message=u.message||u.name||"noMessage",u.name=u.name||"noName",d=d||{},o&&(d.throwException=o);var f=d.pulse;delete d.pulse;try{var p=JSON.stringify(d)}catch(m){p="Failed to stringify context: "+m.message}p.length>r&&(d={shortened:p.substring(0,r)});var g=l[e],v={errorId:h,levelNumber:g,stack:u.stack,pulse:f,message:u.message,name:u.name,timeStamp:Date.now(),context:d,additional:c};if(t&&s.push(v)>i&&s.shift(),a.emit(g,v),o)throw u._reported=!0,u;return a},a.addView=function(e){Array.isArray(e)||(e=[e]);var t=e;Array.prototype.shift.call(arguments);for(var n=0;n<t.length;n++){var i=[t[n]];i.pushArray(arguments),o.apply(this,i)}return a},n.instance=a,a}var i=20,r=2e4;t||(require("../model/extend.js"),require("../model/helper/uuid.js")),e.errorHandler=e.errorHandler||new n}("undefined"==typeof exports?window:global,"undefined"==typeof exports),"undefined"==typeof Chess&&(Chess={}),function(){function e(e){return e&&e.evaluations&&e.evaluations[0]?Object.removeUndefined({score:e.evaluations[0].score,mate:e.evaluations[0].mate}):void 0}function t(e){return"0000"===e?e:(/^[a-h][1-8][a-h][1-8][rnbq]?/.test(e)||errorHandler.error(new Error("invalid can format"),{canBeforeTransformation:e}),e.substr(0,1)+(9-e.substr(1,1))+e.substr(2,1)+(9-e.substr(3,1))+e.substr(4))}function n(e,t){e[1]=t,e[0]=e[0].split("/").reverse().join("/");for(var n=["r","n","b","q","k","p"],i=0;i<n.length;i++)e[0]=e[0].replace(new RegExp(n[i].toUpperCase(),"g"),"z").replace(new RegExp(n[i],"g"),n[i].toUpperCase()).replace(/z/g,n[i]);if("-"!==e[2]){var r="";e[2].indexOf("k")>-1&&(r+="K"),e[2].indexOf("q")>-1&&(r+="Q"),e[2].indexOf("K")>-1&&(r+="k"),e[2].indexOf("Q")>-1&&(r+="q"),e[2]=r}return"-"!==e[3]&&(e[3]=e[3].substr(0,1)+("b"===t?3:6)),e}function i(e){var t=e.split(" ");return t.pop(),"b"===t[1]&&(t=n(t,"w")),parseInt(t.last(),10)<=20&&(t[t.length-1]=0),
t.join("_")}function r(e,t){var i=e.split("_");return i.push("1"),t&&(i=n(i,"b")),i.join(" ")}function o(e){return"-"===e?-1:e.charCodeAt(0)-97}function a(e){return String.fromCharCode(e+97)}function s(e){return e.replace(/8/g,"--------").replace(/7/g,"-------").replace(/6/g,"------").replace(/5/g,"-----").replace(/4/g,"----").replace(/3/g,"---").replace(/2/g,"--").replace(/1/g,"-")}function l(e){return e.replace(/--------/g,"8").replace(/-------/g,"7").replace(/------/g,"6").replace(/-----/g,"5").replace(/----/g,"4").replace(/---/g,"3").replace(/--/g,"2").replace(/-/g,"1")}function c(e){"string"!=typeof e&&errorHandler.msg("error",new Error("Cant decode CAN - No String"),!0,{can:e}),(e.length<4||e.length>5)&&errorHandler.msg("error",new Error("Cant decode CAN - Wrong Length"),!0,{can:e});var t,n=o(e.substr(0,1)),i=parseInt(e.substr(1,1),10)-1,r=o(e.substr(2,1)),a=parseInt(e.substr(3,1),10)-1;return 5===e.length&&(t=e.substr(4,1).toLowerCase()),Chess.getMove(i,n,a,r,t)}function d(e,t){return"string"!=typeof e&&errorHandler.msg("error",new Error("Cant decode LAN - No String"),!0,{lan:e}),"--"===e?h(0):(e=e.replace(/-/g,"").replace(/0/g,"O").replace("x","").replace("+","").replace("=","").replace("#",""),"OO"===e?c("w"===t.moveRight?"e1g1":"e8g8"):"OOO"===e?c("w"===t.moveRight?"e1c1":"e8c8"):(e.substr(0,1)===e.substr(0,1).toUpperCase()&&(e=e.substr(1)),c(e)))}function u(e,t){if("string"!=typeof e&&errorHandler.error(new Error("Cant decode SAN - No String"),{san:e}),"--"===e)return Chess.getNullMove();var n="w"===t.moveRight,i=e.replace(/[-x+=#]/g,"").replace(/0/g,"O").replace("ep","");if("OO"===i)return c(n?"e1g1":"e8g8");if("OOO"===i)return c(n?"e1c1":"e8c8");if(/^[RNBQK]/.test(i)){var r=n?i.substr(0,1):i.substr(0,1).toLowerCase();i=i.substr(1)}else if(r=n?"P":"p",/[rnbq]$/i.test(i)){var a=i.substr(-1).toLowerCase();i=i.substr(0,i.length-1)}var s=i.substr(-1)-1,l=o(i.substr(-2,1));if(3===i.length){var d=i.substr(0,1);if(/[a-h]/.test(d))var u=o(d);else var h=d-1}else 4===i.length&&(u=o(i.substr(0,1)),h=i.substr(1,1)-1);return t.findPotentialStartSquares(r,h,u,s,l,a)}function h(e,t){isNaN(e)&&errorHandler.msg("error",new Error("Cant decode SEP - No Numeric value"),!0,{sep:e}),(0>e||e>16383)&&errorHandler.msg("error",new Error("SEP out of range"),!0,{sep:e});var n,i=Math.floor(e%8),r=Math.floor(e/8%8),o=Math.floor(e/64%8),a=Math.floor(e/512%8),s=Math.floor(e/4096);switch(s){case 0:(0===r&&1===a||7===r&&6===a)&&t&&"P"===t.getPiece(a,o).toUpperCase()&&(n="r");break;case 1:n="n";break;case 2:n="b";break;case 3:n="q"}return Chess.getMove(a,o,r,i,n)}function f(e){var t=e.split("|");return"undefined"===t[4]&&(t[4]=void 0),Chess.getMove(t[0],t[1],t[2],t[3],t[4])}function p(e){return 0===e.y1&&0===e.x1&&0===e.y2&&0===e.x2?"0000":a(e.x1)+(e.y1+1)+a(e.x2)+(e.y2+1)+(void 0===e.promotion?"":e.promotion)}function m(e,t,n,i,r){return 0===e&&0===t&&0===n&&0===i?"0000":a(t)+(e+1)+a(i)+(n+1)+(void 0===r?"":r)}function g(e,t,n,i,r){if(0===e.y1&&0===e.x1&&0===e.y2&&0===e.x2)return"--";var o=t.toUpperCase();if(n)var s="x";else s="-";if("P"===o&&(o=""),"K"===o&&4===e.x1)if(6===e.x2)var l="O-O";else 2===e.x2&&(l="O-O-O");return void 0===l&&(l=o+a(e.x1)+(e.y1+1)+s+a(e.x2)+(e.y2+1)+(void 0===e.promotion?"":e.promotion.toUpperCase())),i?l+="#":r&&(l+="+"),l}function v(e,t,n,i,r,o){var s,l,c,d=t.toUpperCase();if("K"===d&&4===e.x1&&(6===e.x2?(t="",c="O-O"):2===e.x2&&(t="",c="O-O-O")),!c){for(var u=[],h=0;h<n.length;h++)n[h].y1===e.y1&&n[h].x1===e.x1||n[h].y2!==e.y2||n[h].x2!==e.x2||n[h].promotion!==e.promotion||u.push(n[h]);var f=!0,p=!0;if(u.length){for(h=u.length-1;h>=0;h--)if(e.y1===u[h].y1){f=!1;break}for(h=u.length-1;h>=0;h--)if(e.x1===u[h].x1){p=!1;break}f||p?p?s=!0:l=!0:(s=!0,l=!0)}s=s||i&&"P"===d,c=(s?a(e.x1):"")+(l?e.y1+1:"")+(i?"x":"")+a(e.x2)+(e.y2+1)+(void 0===e.promotion?"":e.promotion.toUpperCase())}return r?c+="#":o&&(c+="+"),[t,c]}function y(e,t,n,i,r,o){if(e.isNullMove())return"--";var a=v(e,t,n,i,r,o);return a[0]=a[0].toUpperCase(),"P"===a[0]?a[1]:a[0]+a[1]}function b(e,t,n,i,r,o){var a={K:"&#9812;",Q:"&#9813;",R:"&#9814;",B:"&#9815;",N:"&#9816;",P:"",k:"&#9818;",q:"&#9819;",r:"&#9820;",b:"&#9821;",n:"&#9822;",p:""},s=v.apply(null,arguments),l=a[s[0]]||"";return l+s[1]}function w(e){var t;switch(e.promotion){case"n":t=1;break;case"b":t=2;break;case"q":t=3;break;default:t=0}return 4096*t+512*e.y1+64*e.x1+8*e.y2+e.x2}function k(e){var t=parseInt(e.substr(1,1),10)-1,n=o(e.substr(0,1));return Chess.getSquare(t,n)}Chess.translate={coordinatesToCan:m,decodeHumanCordX:o,encodeHumanCordX:a,detailedToReducedEngine:e,longFenToEngineFen:i,engineFenToLongFen:r,shortToLongPositionGroup:s,longToShortPositionGroup:l,canToMove:c,lanToMove:d,sanToMove:u,sepToMove:h,moveStringToMove:f,moveToCan:p,moveToLan:g,moveToSan:y,moveToFan:b,moveToSep:w,squareStringToSquare:k,whiteToBlackMove:t}}(),"undefined"==typeof Handler&&(Handler={}),Handler.engine=function(){function e(e,t,n){return a[e]=a[e]||{},a[e][t]&&a[e][t].source&&y[a[e][t].source]>(y[n.source]||0)?void 0:(a[e][t]=n,!0)}function t(e,t){if(a[e]){var n=f[t],i=n.find(function(t){return a[e][t]});return i?{type:i,value:a[e][i]}:void 0}}function n(e){g[e]||errorHandler.error(new Error("Invalid engineType during set"),{validEngineType:g,typeToBeChecked:e})}function i(e,n,i){var r=n===u;if("string"==typeof e)if(e.indexOf(" ")>-1)var a=Chess.translate.longFenToEngineFen(e);else a=e;else{if(e.isNullMove())return;a=e.getEngineFen()}var l=t(a,n);if(l)return r&&l.type===h?Chess.translate.detailedToReducedEngine(l.value):l.value;if(p[n].every(function(e){return s[e]?s[e](a):!0}),i){for(var f,m=[];!f&&m.length<=c&&e&&e.parentMove;)f=t(e.parentMove.getEngineFen(),h),m.unshift(e.getCan()),e=e.parentMove;if(void 0===f)return;f=f.value,e.nextMoveIsBlack()&&(m=m.map(function(e){return Chess.translate.whiteToBlackMove(e)}));e:for(var g=0;g<f.evaluations.length;g++){for(var v=f.evaluations[g],y=0;y<m.length;y++)if(!v.moves||m[y]!==v.moves[y])continue e;var b=Object.subset(v,d);if(void 0!==b.mate){var w=b.mate<0,k=Math.abs(b.mate)-Math.floor(m.length/2);w&&(k=-1*k),b.mate=k}return r||(b={depth:f.depth-m.length,source:f.source,evaluations:[b]},b.evaluations[0].moves=v.moves.slice(m.length)),m.length%2?o.invert(b):b}}}function r(e,t,n){return w[t]&&w[t](e,n)}var o=Extend.Publisher({}),a={},s={},l=40,c=30,d=["score","mate"],u=o.NUMERICAL_ENGINE_TYPE="numerical",h=o.DETAILED_ENGINE_TYPE="detailed",f={};f[u]=[u,h],f[h]=[h];var p={};p[u]=[u,h],p[h]=[h];var m={};m[u]=[u],m[h]=[u,h];var g={};g[u]=!0,g[h]=!0;var v={local:"Local",cloud:"Cloud"},y={Local:0,Cloud:1},b={};b[u]={score:0};var w={};return w[u]=function(e,t){return null===t||"object"!=typeof t?(errorHandler.warning(new Error(h+" engineData is not an object"),{engineData:t,engineFen:e}),!1):void 0===t.score&&void 0===t.mate?(errorHandler.warning(new Error(u+" engineData does not have required property"),{engineData:t,engineFen:e}),!1):!0},w[h]=function(e,t){return void 0===t?(errorHandler.warning(new Error(h+" engineData is not an object"),{engineData:t,engineFen:e}),!1):void 0===t.depth?(errorHandler.warning(new Error(h+" engineData requires depth value"),{engineData:t,engineFen:e}),!1):Array.isArray(t.evaluations)?!0:(errorHandler.warning(new Error(h+" engineData requires evaluations"),{engineData:t,engineFen:e}),!1)},o.setDataGetter=function(e,t){return s[e]=t,o},o.shouldInvert=function(e,t){return t&&0===t.mate&&e.nextMoveIsWhite()||t&&0!==t.mate&&e.nextMoveIsBlack()?!0:!1},o.invertData=function(e,t){return this.shouldInvert(e,t)?this.invert(t):t},o.invert=function(e){if(void 0===e)return e;if(e._inverse)return e._inverse;var t=["score","mate"];if(e.evaluations)var n={_inverse:e,depth:e.depth,source:e.source,engineName:e.engineName,evaluations:e.evaluations.map(function(e){var n={};return e.moves&&(n.moves=e.moves.map(function(e){return Chess.translate.whiteToBlackMove(e)})),t.forEach(function(t){void 0!==e[t]&&(n[t]=-1*e[t])}),n})};else n={},t.forEach(function(t){void 0!==e[t]&&("mate"===t&&0===e[t]?n[t]="-0":n[t]=-1*e[t])}),e.approximated&&(n.approximated=e.approximated);return e._inverse=n},o.get=function(e,t,r,o){n(t);var a=0;do var s=i(e,t,r);while(o&&!s&&e instanceof Chess.Position&&(e=e.parentMove)&&++a<=l);if(o){a%2&&s&&(s=Handler.engine.invert(s));var c=Object.merge(s||b[t]);return a&&(c.approximated=!0),c}return s},o.set=function(t,i,a){return n(i),r(t,i,a)?void(e(t,i,a)&&m[i].forEach(function(e){var n=a;i===h&&e===u&&(n=Chess.translate.detailedToReducedEngine(a)),a.source&&(e+="."+a.source),o.emit(t+":"+e,n)})):o},o.formatEngine=function(e,t){return void 0!==e?(e/100).toFixed(2):void 0!==t?"#"+t:""},o.isLocalEvaluation=function(e){return e&&e.source===v.local},o.isCloudEvaluation=function(e){return e&&e.source===v.cloud},o}(),errorHandler.View=errorHandler.View||{},"undefined"!=typeof exports,errorHandler.View.Client=function(e,t,n,i){function r(e,t){return s("log",t),c}function o(e,t){return s("warn",t),c}function a(e,t){return s("error",t),c}function s(e,t){if(void 0!==t.context&&void 0!==t.context.__clientId){var n=t.context.__clientId;Array.isArray(n)||(n=[n]);for(var i=0;i<n.length;i++)l(n[i],e,t)}return c}function l(t,n,i){if(u>d){d++;var r=e(t);if(void 0!==r&&"function"==typeof r.emit){var o={cat:n,errorId:i.errorId};r.emit("serverError",o)}}}e=e||dummy;var c=this,d=0,u=5,h={};void 0===h.log&&(h.log=0),void 0===h.warn&&(h.warn=4),void 0===h.error&&(h.error=8),void 0===t&&(t=h.log),void 0===n&&(n=h.log),void 0===i&&(i=h.log);for(var f={callbacks:{}},p=t;n>p;p++)f.callbacks[p]=r;for(p=n;i>p;p++)f.callbacks[p]=o;for(p=i;11>p;p++)f.callbacks[p]=a;if(Extend.Subscriber(c,f.callbacks),"undefined"==typeof exports)throw new Error("errorRabbitView will not work, because here im running in a fucking browser");return c},errorHandler.View=errorHandler.View||{},errorHandler.View.Console=function(e,t,n){function i(e,t){try{l.log(a(t.stack,t.message,t.name,t.timeStamp)),s(t.context)}catch(n){}return d}function r(e,t){try{l.warn(a(t.stack,t.message,t.name,t.timeStamp)),s(t.context)}catch(n){}return d}function o(e,t){try{l.error(a(t.stack,t.message,t.name,t.timeStamp)),s(t.context)}catch(n){}return d}function a(e,t,n,i){return"("+i+") "+n+"\n"+(n!==t?t+"\n":"")+(e?e+"\n":"")}function s(e){return 0===Object.keys(e).length?d:(c?l.log(c.inspect(e,!1,3,!0)):l.dir(e),d)}if("undefined"==typeof exports)var l=window.console;else{var c=require("util");l=console}var d=this,u={};"undefined"!=typeof Config&&Config.base&&Config.base.errorHandler&&Config.base.errorHandler.console&&(u=Config.base.errorHandler.console),void 0===u.log&&(u.log=2),void 0===u.warn&&(u.warn=4),void 0===u.error&&(u.error=8),void 0===e&&(e=u.log),void 0===t&&(t=u.warn),void 0===n&&(n=u.error);for(var h={callbacks:{}},f=e;t>f;f++)h.callbacks[f]=i;for(f=t;n>f;f++)h.callbacks[f]=r;for(f=n;11>f;f++)h.callbacks[f]=o;return Extend.Subscriber(d,h.callbacks),"undefined"==typeof l?errorHandler.msg("notice",new Error("errorConsoleView will not work, because here is no console")):void 0===l.log?errorHandler.msg("notice",new Error("errorConsoleView will not work, because here is no console.log")):(l.warn||(l.warn=l.log),l.dir||(l.dir=l.log),l.error||(l.error=l.log)),d},errorHandler.View=errorHandler.View||{},"undefined"!=typeof exports)var fs=require("fs");errorHandler.View.File=function(e,t){function n(e,t){return i(t.stack,t.message,t.name,t.timeStamp,a.logFile,t.levelNumber,t.context,t.additional),o}function i(e,t,n,i,a,l,c,d){return s?o:(fs.appendFile(a,r(e,t,n,i,l,c),function(r){r&&(s=!0,errorHandler.msg("notice",r,!1,{stack:e,message:t,name:n,timeStamp:i,rawLevel:l,context:c,additional:d}))}),o)}function r(e,t,n,i,r,o){var a={stack:e,message:t,name:n,timeStamp:i,rawLevel:r,context:o};try{return JSON.stringify(a)+"\n"}catch(s){a.context={renderError:s};try{return JSON.stringify(a)+"\n"}catch(s){return JSON.stringify("Cant Render error Line")+"\n"}}}var o=this,a={},s=!1;"undefined"!=typeof Config&&Config.base&&Config.base.errorHandler&&Config.base.errorHandler.file&&(a=Config.base.errorHandler.file),void 0===a.log&&(a.log=2),a.logFile=a.logFile||t||"log.log",void 0===e&&(e=a.log);for(var l={callbacks:{}},c=e;11>c;c++)l.callbacks[c]=n;return Extend.Subscriber(o,l.callbacks),o},errorHandler.View=errorHandler.View||{},errorHandler.View.Notification=function(e){function t(e,t){if(r>2)return n;r++;try{Object.extend(t.context,{url:window.location.href,userUuid:config.user().uuid,version:config.version(),userLevel:config.level().toString()}),a.emit("clientEvent",t)}catch(i){}return n}var n=this,i={},r=0;"undefined"!=typeof Config&&Config.base&&Config.base.errorHandler&&Config.base.errorHandler.notification&&(i=Config.base.errorHandler.notification),void 0===i.log&&(i.log=6),void 0===e&&(e=i.log);for(var o={callbacks:{}},a=Handler.socket.getSocket(Handler.socket.types.NOTIFICATION),s=e;11>s;s++)o.callbacks[s]=t;return Extend.Subscriber(n,o.callbacks),n},function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}(function(e){function t(e){return s.raw?e:encodeURIComponent(e)}function n(e){return s.raw?e:decodeURIComponent(e)}function i(e){return t(s.json?JSON.stringify(e):String(e))}function r(e){0===e.indexOf('"')&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return e=decodeURIComponent(e.replace(a," ")),s.json?JSON.parse(e):e}catch(t){}}function o(t,n){var i=s.raw?t:r(t);return e.isFunction(n)?n(i):i}var a=/\+/g,s=e.cookie=function(r,a,l){if(void 0!==a&&!e.isFunction(a)){if(l=e.extend({},s.defaults,l),"number"==typeof l.expires){var c=l.expires,d=l.expires=new Date;d.setTime(+d+864e5*c)}return document.cookie=[t(r),"=",i(a),l.expires?"; expires="+l.expires.toUTCString():"",l.path?"; path="+l.path:"",l.domain?"; domain="+l.domain:"",l.secure?"; secure":""].join("")}for(var u=r?void 0:{},h=document.cookie?document.cookie.split("; "):[],f=0,p=h.length;p>f;f++){var m=h[f].split("="),g=n(m.shift()),v=m.join("=");if(r&&r===g){u=o(v,a);break}r||void 0===(v=o(v))||(u[g]=v)}return u};s.defaults={},e.removeCookie=function(t,n){return void 0===e.cookie(t)?!1:(e.cookie(t,"",e.extend({},n,{expires:-1})),!e.cookie(t))},e.staticTrackingCookie=function(t){var n="staticPageHit_onPageValue",i=e.cookie(n);return i=i?JSON.parse(i):[],i.push({value:t,time:(new Date).toJSON()}),e.cookie(n,JSON.stringify(i),{expires:30,path:"/"})}}),function(e){function t(t){var n,i,r,o=arguments.length,a=window[t],s=arguments,l=s[1];if(2>o)throw new Error("Minimum 2 arguments must be given");if(e.isArray(l)){i={};for(var c in l){n=l[c];try{i[n]=JSON.parse(a.getItem(n))}catch(d){i[n]=a.getItem(n)}}return i}if(2!=o){try{i=JSON.parse(a.getItem(l))}catch(d){throw new ReferenceError(l+" is not defined in this storage")}for(var c=2;o-1>c;c++)if(i=i[s[c]],void 0===i)throw new ReferenceError([].slice.call(s,1,c+1).join(".")+" is not defined in this storage");if(e.isArray(s[c])){r=i,i={};for(var u in s[c])i[s[c][u]]=r[s[c][u]];return i}return i[s[c]]}try{return JSON.parse(a.getItem(l))}catch(d){return a.getItem(l)}}function n(t){var n,i,r=arguments.length,o=window[t],a=arguments,s=a[1],l=a[2],c={};if(2>r||!e.isPlainObject(s)&&3>r)throw new Error("Minimum 3 arguments must be given or second parameter must be an object");if(e.isPlainObject(s)){for(var d in s)n=s[d],e.isPlainObject(n)?o.setItem(d,JSON.stringify(n)):o.setItem(d,n);return s}if(3==r)return"object"==typeof l?o.setItem(s,JSON.stringify(l)):o.setItem(s,l),l;try{i=o.getItem(s),null!=i&&(c=JSON.parse(i))}catch(u){}i=c;for(var d=2;r-2>d;d++)n=a[d],i[n]&&e.isPlainObject(i[n])||(i[n]={}),i=i[n];return i[a[d]]=a[d+1],o.setItem(s,JSON.stringify(c)),c}function i(t){var n,i,r=arguments.length,o=window[t],a=arguments,s=a[1];if(2>r)throw new Error("Minimum 2 arguments must be given");if(e.isArray(s)){for(var l in s)o.removeItem(s[l]);return!0}if(2==r)return o.removeItem(s),!0;try{n=i=JSON.parse(o.getItem(s))}catch(c){throw new ReferenceError(s+" is not defined in this storage")}for(var l=2;r-1>l;l++)if(i=i[a[l]],void 0===i)throw new ReferenceError([].slice.call(a,1,l).join(".")+" is not defined in this storage");if(e.isArray(a[l]))for(var d in a[l])delete i[a[l][d]];else delete i[a[l]];return o.setItem(s,JSON.stringify(n)),!0}function r(t,n){var r=s(t);for(var o in r)i(t,r[o]);if(n)for(var o in e.namespaceStorages)l(o)}function o(n){var i=arguments.length,r=arguments,a=(window[n],r[1]);if(1==i)return 0==s(n).length;if(e.isArray(a)){for(var l=0;l<a.length;l++)if(!o(n,a[l]))return!1;return!0}try{var c=t.apply(this,arguments);e.isArray(r[i-1])||(c={totest:c});for(var l in c)if(!(e.isPlainObject(c[l])&&e.isEmptyObject(c[l])||e.isArray(c[l])&&!c[l].length)&&c[l])return!1;return!0}catch(d){return!0}}function a(n){var i=arguments.length,r=arguments,o=(window[n],r[1]);if(2>i)throw new Error("Minimum 2 arguments must be given");if(e.isArray(o)){for(var s=0;s<o.length;s++)if(!a(n,o[s]))return!1;return!0}try{var l=t.apply(this,arguments);e.isArray(r[i-1])||(l={totest:l});for(var s in l)if(void 0===l[s]||null===l[s])return!1;return!0}catch(c){return!1}}function s(n){var i=arguments.length,r=window[n],o=arguments,a=(o[1],[]),s={};if(s=i>1?t.apply(this,o):r,s._cookie)for(var l in e.cookie())""!=l&&a.push(l.replace(s._prefix,""));else for(var c in s)a.push(c);return a}function l(t){if(!t||"string"!=typeof t)throw new Error("First parameter must be a string");h?(window.localStorage.getItem(t)||window.localStorage.setItem(t,"{}"),window.sessionStorage.getItem(t)||window.sessionStorage.setItem(t,"{}")):(window.localCookieStorage.getItem(t)||window.localCookieStorage.setItem(t,"{}"),window.sessionCookieStorage.getItem(t)||window.sessionCookieStorage.setItem(t,"{}"));var n={localStorage:e.extend({},e.localStorage,{_ns:t}),sessionStorage:e.extend({},e.sessionStorage,{_ns:t})};return e.cookie&&(window.cookieStorage.getItem(t)||window.cookieStorage.setItem(t,"{}"),n.cookieStorage=e.extend({},e.cookieStorage,{_ns:t})),e.namespaceStorages[t]=n,n}function c(e){if(!window[e])return!1;var t="jsapi";try{return window[e].setItem(t,t),window[e].removeItem(t),!0}catch(n){return!1}}var d="ls_",u="ss_",h=c("localStorage"),f={_type:"",_ns:"",_callMethod:function(e,t){var n=[this._type],t=Array.prototype.slice.call(t),i=t[0];return this._ns&&n.push(this._ns),"string"==typeof i&&-1!==i.indexOf(".")&&(t.shift(),[].unshift.apply(t,i.split("."))),[].push.apply(n,t),e.apply(this,n)},get:function(){return this._callMethod(t,arguments)},set:function(){var t=arguments.length,i=arguments,r=i[0];if(1>t||!e.isPlainObject(r)&&2>t)throw new Error("Minimum 2 arguments must be given or first parameter must be an object");if(e.isPlainObject(r)&&this._ns){for(var o in r)n(this._type,this._ns,o,r[o]);return r}var a=this._callMethod(n,i);return this._ns?a[r.split(".")[0]]:a},remove:function(){if(arguments.length<1)throw new Error("Minimum 1 argument must be given");return this._callMethod(i,arguments)},removeAll:function(e){return this._ns?(n(this._type,this._ns,{}),!0):r(this._type,e)},isEmpty:function(){return this._callMethod(o,arguments)},isSet:function(){if(arguments.length<1)throw new Error("Minimum 1 argument must be given");return this._callMethod(a,arguments)},keys:function(){return this._callMethod(s,arguments)}};if(e.cookie){window.name||(window.name=Math.floor(1e8*Math.random()));var p={_cookie:!0,_prefix:"",_expires:null,_path:null,_domain:null,setItem:function(t,n){e.cookie(this._prefix+t,n,{expires:this._expires,path:this._path,domain:this._domain})},getItem:function(t){return e.cookie(this._prefix+t)},removeItem:function(t){return e.removeCookie(this._prefix+t)},clear:function(){for(var t in e.cookie())""!=t&&(!this._prefix&&-1===t.indexOf(d)&&-1===t.indexOf(u)||this._prefix&&0===t.indexOf(this._prefix))&&e.removeCookie(t)},setExpires:function(e){return this._expires=e,this},setPath:function(e){return this._path=e,this},setDomain:function(e){return this._domain=e,this},setConf:function(e){return e.path&&(this._path=e.path),e.domain&&(this._domain=e.domain),e.expires&&(this._expires=e.expires),this},setDefaultConf:function(){this._path=this._domain=this._expires=null}};h||(window.localCookieStorage=e.extend({},p,{_prefix:d,_expires:3650}),window.sessionCookieStorage=e.extend({},p,{_prefix:u+window.name+"_"})),window.cookieStorage=e.extend({},p),e.cookieStorage=e.extend({},f,{_type:"cookieStorage",setExpires:function(e){return window.cookieStorage.setExpires(e),this},setPath:function(e){return window.cookieStorage.setPath(e),this},setDomain:function(e){return window.cookieStorage.setDomain(e),this},setConf:function(e){return window.cookieStorage.setConf(e),this},setDefaultConf:function(){return window.cookieStorage.setDefaultConf(),this}})}e.initNamespaceStorage=function(e){return l(e)},h?(e.localStorage=e.extend({},f,{_type:"localStorage"}),e.sessionStorage=e.extend({},f,{_type:"sessionStorage"})):(e.localStorage=e.extend({},f,{_type:"localCookieStorage"}),e.sessionStorage=e.extend({},f,{_type:"sessionCookieStorage"})),e.namespaceStorages={},e.removeAllStorages=function(t){e.localStorage.removeAll(t),e.sessionStorage.removeAll(t),e.cookieStorage&&e.cookieStorage.removeAll(t),t||(e.namespaceStorages={})}}(jQuery),function(e){var t=function(e){var t,n=[];return e.length?"span"===e[0].tagName.toLowerCase()?(e.find(":checked").each(function(){n.push(this.value)}),n.join(",")):(t=e.attr("type"),"checkbox"===t||"radio"===t?e.filter(":checked").val():e.val()):void 0};e.fn.yiiactiveform=function(n){return this.each(function(){var i=e.extend({},e.fn.yiiactiveform.defaults,n||{}),r=e(this);void 0===i.validationUrl&&(i.validationUrl=r.attr("action")),e.each(i.attributes,function(n){this.value=t(r.find("#"+this.inputID)),i.attributes[n]=e.extend({},{validationDelay:i.validationDelay,validateOnChange:i.validateOnChange,validateOnType:i.validateOnType,hideErrorMessage:i.hideErrorMessage,inputContainer:i.inputContainer,errorCssClass:i.errorCssClass,successCssClass:i.successCssClass,beforeValidateAttribute:i.beforeValidateAttribute,afterValidateAttribute:i.afterValidateAttribute,validatingCssClass:i.validatingCssClass,errorCallback:i.errorCallback},this)}),r.data("settings",i),i.submitting=!1;var o=function(n,o){o&&(n.status=2),e.each(i.attributes,function(){this.value!==t(r.find("#"+this.inputID))&&(this.status=2,o=!0)}),o&&(void 0!==i.timer&&clearTimeout(i.timer),i.timer=setTimeout(function(){i.submitting||r.is(":hidden")||(void 0===n.beforeValidateAttribute||n.beforeValidateAttribute(r,n))&&(e.each(i.attributes,function(){2===this.status&&(this.status=3,e.fn.yiiactiveform.getInputContainer(this,r).addClass(this.validatingCssClass))}),e.fn.yiiactiveform.validate(r,function(t){var o=!1;e.each(i.attributes,function(){(2===this.status||3===this.status)&&(o=e.fn.yiiactiveform.updateInput(this,t,r)||o)}),void 0!==n.afterValidateAttribute&&n.afterValidateAttribute(r,n,t,o)},i.errorCallback))},n.validationDelay))};if(e.each(i.attributes,function(n,i){this.validateOnChange&&r.find("#"+this.inputID).change(function(){o(i,!1)}).blur(function(){2!==i.status&&3!==i.status&&o(i,!i.status)}),this.validateOnType&&r.find("#"+this.inputID).keyup(function(){i.value!==t(e(this))&&o(i,!1)})}),i.validateOnSubmit){r.on("mouseup keyup",":submit",function(){r.data("submitObject",e(this))});var a=!1;r.submit(function(){return a?(a=!1,!0):(void 0!==i.timer&&clearTimeout(i.timer),i.submitting=!0,void 0===i.beforeValidate||i.beforeValidate(r)?e.fn.yiiactiveform.validate(r,function(t){var n=!1;if(e.each(i.attributes,function(){n=e.fn.yiiactiveform.updateInput(this,t,r)||n}),e.fn.yiiactiveform.updateSummary(r,t),(void 0===i.afterValidate||i.afterValidate(r,t,n))&&!n){a=!0;var o=r.data("submitObject")||r.find(":submit:first");return void(o.length?o.click():r.submit())}i.submitting=!1},i.errorCallback):i.submitting=!1,!1)})}r.bind("reset",function(){setTimeout(function(){e.each(i.attributes,function(){this.status=0;var n=r.find("#"+this.errorID),i=e.fn.yiiactiveform.getInputContainer(this,r);i.removeClass(this.validatingCssClass+" "+this.errorCssClass+" "+this.successCssClass),n.html("").hide(),this.value=t(r.find("#"+this.inputID))}),r.find("label, :input").each(function(){e(this).removeClass(i.errorCss)}),e("#"+i.summaryID).hide().find("ul").html(""),void 0===i.focus||window.location.hash||r.find(i.focus).focus()},1)}),void 0===i.focus||window.location.hash||r.find(i.focus).focus()})},e.fn.yiiactiveform.getInputContainer=function(e,t){return void 0===e.inputContainer?t.find("#"+e.inputID).closest("div"):t.find(e.inputContainer).filter(':has("#'+e.inputID+'")')},e.fn.yiiactiveform.updateInput=function(n,i,r){n.status=1;var o,a,s=!1,l=r.find("#"+n.inputID),c=r.data("settings").errorCss;return l.length&&(s=null!==i&&e.isArray(i[n.id])&&i[n.id].length>0,o=r.find("#"+n.errorID),a=e.fn.yiiactiveform.getInputContainer(n,r),a.removeClass(n.validatingCssClass+" "+n.errorCssClass+" "+n.successCssClass),a.find("label, :input").each(function(){e(this).removeClass(c)}),s?(o.html(i[n.id][0]),a.addClass(n.errorCssClass)):(n.enableAjaxValidation||n.clientValidation)&&a.addClass(n.successCssClass),n.hideErrorMessage||o.toggle(s),n.value=t(l)),s},e.fn.yiiactiveform.updateSummary=function(t,n){var i=e(t).data("settings"),r="";if(void 0!==i.summaryID){if(n){var o=[];for(var a in i.attributes)i.attributes[a].summary&&o.push(i.attributes[a].id);e.each(i.attributes,function(){-1!==e.inArray(this.id,o)&&e.isArray(n[this.id])&&e.each(n[this.id],function(e,t){r=r+"<li>"+t+"</li>"})})}e("#"+i.summaryID).toggle(""!==r).find("ul").html(r)}},e.fn.yiiactiveform.validate=function(n,i,r){var o=e(n),a=o.data("settings"),s=!1,l={};if(e.each(a.attributes,function(){var e,n=[];void 0===this.clientValidation||!a.submitting&&2!==this.status&&3!==this.status||(e=t(o.find("#"+this.inputID)),this.clientValidation(e,n,this),n.length&&(l[this.id]=n)),!this.enableAjaxValidation||n.length||!a.submitting&&2!==this.status&&3!==this.status||(s=!0)}),!s||a.submitting&&!e.isEmptyObject(l))return void(a.submitting?setTimeout(function(){i(l)},200):i(l));var c=o.data("submitObject"),d="&"+a.ajaxVar+"="+o.attr("id");c&&c.length&&(d+="&"+c.attr("name")+"="+c.attr("value")),e.ajax({url:a.validationUrl,type:o.attr("method"),data:o.serialize()+d,dataType:"json",success:function(t){null!==t&&"object"==typeof t?(e.each(a.attributes,function(){this.enableAjaxValidation||delete t[this.id]}),i(e.extend({},l,t))):i(l)},error:function(){void 0!==r&&r()}})},e.fn.yiiactiveform.getSettings=function(t){return e(t).data("settings")},e.fn.yiiactiveform.defaults={ajaxVar:"ajax",validationUrl:void 0,validationDelay:200,validateOnSubmit:!1,validateOnChange:!0,validateOnType:!1,hideErrorMessage:!1,inputContainer:void 0,errorCss:"error",errorCssClass:"error",successCssClass:"success",validatingCssClass:"validating",summaryID:void 0,timer:void 0,beforeValidateAttribute:void 0,afterValidateAttribute:void 0,beforeValidate:void 0,afterValidate:void 0,focus:void 0,attributes:[],errorCallback:void 0}}(jQuery),window.settings=function(){function e(){var e=t()||{};Object.keys(e).length?g=e:(g=window.__stng,i(function(t){g=Object.merge(g,t,e),n(g)}))}function t(){return JSON.parse(b.getItem(w))}function n(e){return b.setItem(w,JSON.stringify(e))}function i(e){k||(k=!0,jQuery.ajax({url:"/api/web/SettingAPI/getSettings?uuid="+config.user().uuid,dataType:"json",type:"GET"}).done(function(t){k=!1,e(t.data.settings)}).error(function(){k=!1,e({})}))}function r(e,i){if(Object.forEach(e,function(t,n){("game-piece-theme"===n||"game-board-theme"===n)&&(config.themes()[t]||delete e[n])}),0!==Object.keys(e).length){if(n(Object.merge(g,t(),e)),config.level().isGuest)return void i(!0);var r={csrf:config.csrf()};for(var o in e)e.hasOwnProperty(o)&&(r["settings["+o+"]"]=e[o]);jQuery.ajax({url:v,dataType:"json",data:r,type:y}).done(function(e){"function"==typeof i&&i(!0,e.report),C.emit("success.save",e.success)}).error(function(t){var n={};try{var r=jQuery.parseJSON(t.responseText);errorHandler.msg("warning",new Error("Error saving a setting"),!1,{url:v,setting:e,errors:r.errors}),n=r.errors}catch(o){errorHandler.msg("warning",new Error("Error saving a setting"),!1,{url:v,setting:e})}C.emit("error.save",n),"function"==typeof i&&i(!1,n)})}}function o(e){var t=e.data("linked-settings"),n={};return t&&(t=t.split(","),t.forEach(function(e){var t=jQuery('[data-setting="'+e+'"]');if(t.length){if(t.is(":radio")){t=t.filter(":checked");var i=t.val()}else i=t.is(":checkbox")?t.is(":checked")?1:0:t.val();n[e]=i}})),n}function a(e,t){var n=("0"===t?1:!t)?"off":"on";C.emit("settings."+e+"."+n,{name:e,value:t})}function s(t){return void 0!==x[t]?x[t]:(void 0===g[t]&&e(),g[t])}function l(e,t){if(!e)return C;if(e instanceof Object)var n=e;else n={},n[e]=t;n=Object.filter(n,function(e,t){return!u(t)});var i=!1;return Object.forEach(n,function(e,t){i=i||C.get(t)!=e}),i?(r(n,function(e,t){if(e)for(var i in n){var r=i,o=n[i];if(t&&!!t[i]==!1)return;g[r]=o,a(r,o),jQuery('[data-setting="'+r+'"]').each(function(){var e=jQuery(this);e.is(":checkbox")?this.checked=!!o:e.is(":radio")?this.checked=this.value==o:e.is("select")?e.find('option[value="'+o+'"]').attr("selected","selected"):e.val(o)})}}),C):C}function c(e,t){return x[e]=t,a(e,t),C}function d(e){delete x[e];var t=C.get(e);return a(e,t),C}function u(e){return Object.has(x,e)}function h(e,t){t=!!t;var n=jQuery(e);return n.each(function(){var e=jQuery(this),n=t?{}:void 0,i=e.find("input,select,textarea").add(e.filter("input,select,textarea"));i.each(function(){var a=jQuery(this),s=a.data("setting");if((a.is("input[type=text]")||a.is("select"))&&a.attr("name",s).addClass("validatable[safe]").validatable(),s){var l=C.get(s);a.is(":checkbox")?a.get(0).checked=1==l:a.is(":radio")?a.get(0).checked=l==a.val():a.is("select")?a.find('option[value="'+l+'"]').attr("selected","selected"):a.val(l);var c=u(s);c&&a.prop("disabled",c);var d=t?e.find("[data-settings-save]").addClass("cBtnInactive"):void 0;a.on("change",function(){setTimeout(function(){var e=a.val();if(a.is(":checkbox"))e=a.is(":checked")?1:0;else if(a.is(":radio")&&!a.is(":checked"))return;if(t)n[s]=e,Object.extend(n,o(a)),d.removeClass("cBtnInactive").off("click").on("click",function(){d.addClass("cBtnIcon cIconFileUploading"),r(n,function(t,r){if(d.removeClass("cBtnIcon cIconFileUploading"),t){for(var o in n)if(n.hasOwnProperty(o)){g[o]=n[o],C.emit("change."+o,{name:o,value:n[o]});var a=0===parseInt(e,10)?"off":"on";C.emit("settings."+s+"."+a)}d.addClass("cBtnInactive").off("click"),n={}}else{var l;for(var c in r)if(r.hasOwnProperty(c)){l=c;break}i.filter('[data-setting="'+l+'"]').trigger("validatable:error",{name:l,errors:r[l]})}})});else{var l=o(a)||{};l[s]=e,C.set(l)}})})}})}),C}function f(e){return parseFloat(C.get(e),10)}function p(e){var t=C.get(e);return"0"===t?!1:!!t}function m(e){return""+C.get(e)}var g={},v="/api/web/SettingAPI/setSettings",y="POST",b=(config.user(),window.localStorage),w="localSettings",k=!1,x={},C={get:s,set:l,setOverride:c,removeOverride:d,attach:h,getNumber:f,getBoolean:p,getString:m};return e(),Extend.Publisher(C)}(),!function(e){function t(t,n,i){i=i||"transparent";var r="obj"+(""+Math.random()).slice(2,15),o='<object class="fp-engine" id="'+r+'" name="'+r+'" ';o+=e.browser.msie?'classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000">':' data="'+t+'" type="application/x-shockwave-flash">';var a={width:"100%",height:"100%",allowscriptaccess:"always",wmode:i,quality:"high",flashvars:"",movie:t+(e.browser.msie?"?"+r:""),name:r};return e.each(n,function(e,t){a.flashvars+=e+"="+t+"&"}),e.each(a,function(e,t){o+='<param name="'+e+'" value="'+t+'"/>'}),o+="</object>",e(o)}function n(e,t){return t=t||100,Math.round(e*t)/t}function i(e){return/mpegurl/i.test(e)?"application/x-mpegurl":"video/"+e}function r(e){return/^(video|application)/i.test(e)||(e=i(e)),!!b.canPlayType(e).replace("no","")}function o(t,n){var i=e.grep(t,function(e){return e.type===n});return i.length?i[0]:null}function a(e){var t=e.attr("src"),n=e.attr("type")||"",i=t.split(x)[1];return n=/mpegurl/i.test(n)?"mpegurl":n.replace("video/",""),
{src:t,suffix:i||n,type:n||i}}function s(t){var n=this,i=[];e("source",t).each(function(){i.push(a(e(this)))}),i.length||i.push(a(t)),n.initialSources=i,n.resolve=function(t){return t?(e.isArray(t)?t={sources:e.map(t,function(t){var n,i=e.extend({},t);return e.each(t,function(e,t){n=e}),i.type=n,i.src=t[n],delete i[n],i})}:"string"==typeof t&&(t={src:t,sources:[]},e.each(i,function(e,n){"flash"!=n.type&&t.sources.push({type:n.type,src:t.src.replace(x,"."+n.suffix+"$2")})})),t):{sources:i}}}function l(e){return e=parseInt(e,10),e>=10?e:"0"+e}function c(e){e=e||0;var t=Math.floor(e/3600),n=Math.floor(e/60);return e-=60*n,t>=1?(n-=60*t,t+":"+l(n)+":"+l(e)):l(n)+":"+l(e)}!function(e){if(!e.browser){var t=e.browser={},n=navigator.userAgent.toLowerCase(),i=/(chrome)[ \/]([\w.]+)/.exec(n)||/(safari)[ \/]([\w.]+)/.exec(n)||/(webkit)[ \/]([\w.]+)/.exec(n)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(n)||/(msie) ([\w.]+)/.exec(n)||n.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(n)||[];i[1]&&(t[i[1]]=!0,t.version=i[2]||"0")}}(jQuery),e(function(){"function"==typeof e.fn.flowplayer&&e("video").parent(".flowplayer").flowplayer()});var d=[],u=[],h=window.navigator.userAgent;window.flowplayer=function(t){return e.isFunction(t)?u.push(t):"number"==typeof t||void 0===t?d[t||0]:e(t).data("flowplayer")},e(window).on("beforeunload",function(){e.each(d,function(t,n){n.conf.splash?n.unload():n.bind("error",function(){e(".flowplayer.is-error .fp-message").remove()})})});var f=!1;try{"object"==typeof window.localStorage&&(window.localStorage.flowplayerTestStorage="test",f=!0)}catch(p){}var g=/Safari/.exec(navigator.userAgent)&&!/Chrome/.exec(navigator.userAgent);m=/(\d+\.\d+) Safari/.exec(navigator.userAgent),safariVersion=m?Number(m[1]):100,e.extend(flowplayer,{version:"5.5.2",engine:{},conf:{},support:{},defaults:{debug:!1,disabled:!1,engine:"html5",fullscreen:window==window.top,keyboard:!0,ratio:9/16,adaptiveRatio:!1,flashfit:!1,rtmp:0,splash:!1,live:!1,swf:"//releases.flowplayer.org/5.5.2/commercial/flowplayer.swf",speeds:[.25,.5,1,1.5,2],tooltip:!0,volume:f?"true"==localStorage.muted?0:isNaN(localStorage.volume)?1:localStorage.volume||1:1,errors:["","Video loading aborted","Network error","Video not properly encoded","Video file not found","Unsupported video","Skin not found","SWF file not found","Subtitles not found","Invalid RTMP URL","Unsupported video format. Try installing Adobe Flash."],errorUrls:["","","","","","","","","","","http://get.adobe.com/flashplayer/"],playlist:[],hlsFix:g&&safariVersion<8}});var v=1;e.fn.flowplayer=function(t,n){return"string"==typeof t&&(t={swf:t}),e.isFunction(t)&&(n=t,t={}),!t&&this.data("flowplayer")||this.each(function(){var i,r,o=e(this).addClass("is-loading"),a=e.extend({},flowplayer.defaults,flowplayer.conf,t,o.data()),l=e("video",o).addClass("fp-engine").removeAttr("controls"),c=l.length?new s(l):null,h={};if(a.playlist.length){var p,m=a.preload||l.attr("preload");l.length&&l.replaceWith(p=e("<p />")),l=e("<video />").addClass("fp-engine"),p?p.replaceWith(l):o.prepend(l),flowplayer.support.video&&l.attr("preload",m),"string"==typeof a.playlist[0]?l.attr("src",a.playlist[0]):e.each(a.playlist[0],function(t,n){for(var i in n)n.hasOwnProperty(i)&&l.append(e("<source />").attr({type:"video/"+i,src:n[i]}))}),c=new s(l)}var g=o.data("flowplayer");g&&g.unload(),o.data("fp-player_id",o.data("fp-player_id")||v++);try{h=f?window.localStorage:h}catch(y){}var b=this.currentStyle&&"rtl"===this.currentStyle.direction||window.getComputedStyle&&"rtl"===window.getComputedStyle(this,null).getPropertyValue("direction");b&&o.addClass("is-rtl");var w=g||{conf:a,currentSpeed:1,volumeLevel:"undefined"==typeof a.volume?1*h.volume:a.volume,video:{},disabled:!1,finished:!1,loading:!1,muted:"true"==h.muted||a.muted,paused:!1,playing:!1,ready:!1,splash:!1,rtl:b,load:function(t,n){if(!(w.error||w.loading||w.disabled)){if(t=c.resolve(t),e.extend(t,r.pick(t.sources)),t.src){var i=e.Event("load");o.trigger(i,[w,t,r]),i.isDefaultPrevented()?w.loading=!1:(r.load(t),e.isFunction(t)&&(n=t),n&&o.one("ready",n))}return w}},pause:function(e){return!w.ready||w.seeking||w.disabled||w.loading||(r.pause(),w.one("pause",e)),w},resume:function(){return w.ready&&w.paused&&!w.disabled&&(r.resume(),w.finished&&(w.trigger("resume",[w]),w.finished=!1)),w},toggle:function(){return w.ready?w.paused?w.resume():w.pause():w.load()},seek:function(t,n){if(w.ready&&!w.live){if("boolean"==typeof t){var a=.1*w.video.duration;t=w.video.time+(t?a:-a)}t=i=Math.min(Math.max(t,0),w.video.duration).toFixed(1);var s=e.Event("beforeseek");o.trigger(s,[w,t]),s.isDefaultPrevented()?(w.seeking=!1,o.toggleClass("is-seeking",w.seeking)):(r.seek(t),e.isFunction(n)&&o.one("seek",n))}return w},seekTo:function(e,t){var n=void 0===e?i:.1*w.video.duration*e;return w.seek(n,t)},mute:function(e){return void 0===e&&(e=!w.muted),h.muted=w.muted=e,h.volume=isNaN(h.volume)?a.volume:h.volume,w.volume(e?0:h.volume,!0),w.trigger("mute",e),w},volume:function(e,t){return w.ready&&(e=Math.min(Math.max(e,0),1),t||(h.volume=e),r.volume(e)),w},speed:function(t,n){return w.ready&&("boolean"==typeof t&&(t=a.speeds[e.inArray(w.currentSpeed,a.speeds)+(t?1:-1)]||w.currentSpeed),r.speed(t),n&&o.one("speed",n)),w},stop:function(){return w.ready&&(w.pause(),w.seek(0,function(){o.trigger("stop")})),w},unload:function(){return o.hasClass("is-embedding")||(a.splash?(w.trigger("unload"),r.unload()):w.stop()),w},disable:function(e){return void 0===e&&(e=!w.disabled),e!=w.disabled&&(w.disabled=e,w.trigger("disable",e)),w}};w.conf=e.extend(w.conf,a),e.each(["bind","one","unbind"],function(e,t){w[t]=function(e,n){return o[t](e,n),w}}),w.trigger=function(e,t){return o.trigger(e,[w,t]),w},o.data("flowplayer")||o.bind("boot",function(){return e.each(["autoplay","loop","preload","poster"],function(e,t){var n=l.attr(t);void 0!==n&&(a[t]=n?n:!0)}),(a.splash||o.hasClass("is-splash")||!flowplayer.support.firstframe)&&(w.forcedSplash=!a.splash&&!o.hasClass("is-splash"),w.splash=a.splash=a.autoplay=!0,o.addClass("is-splash"),flowplayer.support.video&&l.attr("preload","none")),(a.live||o.hasClass("is-live"))&&(w.live=a.live=!0,o.addClass("is-live")),e.each(u,function(e){this(w,o)}),r=flowplayer.engine[a.engine],r&&(r=r(w,o)),r.pick(c.initialSources)?w.engine=a.engine:e.each(flowplayer.engine,function(e,t){return e!=a.engine&&(r=this(w,o),r.pick(c.initialSources))?(w.engine=e,!1):void 0}),d.push(w),w.engine?(a.splash?w.unload():w.load(),a.disabled&&w.disable(),r.volume(w.volumeLevel),void o.one("ready",n)):w.trigger("error",{code:flowplayer.support.flashVideo?5:10})}).bind("load",function(t,n,i){a.splash&&e(".flowplayer").filter(".is-ready, .is-loading").not(o).each(function(){var t=e(this).data("flowplayer");t.conf.splash&&t.unload()}),o.addClass("is-loading"),n.loading=!0}).bind("ready",function(e,t,n){function i(){o.removeClass("is-loading"),t.loading=!1}n.time=0,t.video=n,a.splash?o.one("progress",i):i(),t.muted?t.mute(!0):t.volume(t.volumeLevel);var r=t.conf.hlsFix&&/mpegurl/i.exec(n.type);o.toggleClass("hls-fix",!!r)}).bind("unload",function(e){a.splash&&l.remove(),o.removeClass("is-loading"),w.loading=!1}).bind("ready unload",function(e){var t="ready"==e.type;o.toggleClass("is-splash",!t).toggleClass("is-ready",t),w.ready=t,w.splash=!t}).bind("progress",function(e,t,n){t.video.time=n}).bind("speed",function(e,t,n){t.currentSpeed=n}).bind("volume",function(e,t,n){t.volumeLevel=Math.round(100*n)/100,t.muted?n&&t.mute(!1):h.volume=n}).bind("beforeseek seek",function(e){w.seeking="beforeseek"==e.type,o.toggleClass("is-seeking",w.seeking)}).bind("ready pause resume unload finish stop",function(e,t,n){w.paused=/pause|finish|unload|stop/.test(e.type),"ready"==e.type&&(w.paused="none"==a.preload,n&&(w.paused=!n.duration||!a.autoplay&&"none"!=a.preload)),w.playing=!w.paused,o.toggleClass("is-paused",w.paused).toggleClass("is-playing",w.playing),w.load.ed||w.pause()}).bind("finish",function(e){w.finished=!0}).bind("error",function(){l.remove()}),o.trigger("boot",[w,o]).data("flowplayer",w)})},!function(){var t=function(e){var t=/Version\/(\d\.\d)/.exec(e);return t&&t.length>1?parseFloat(t[1],10):0},n=flowplayer.support,i=e.browser,r=e("<video loop autoplay preload/>")[0],o=navigator.userAgent,a=i.msie||/Trident\/7/.test(o),s=/iPad|MeeGo/.test(o)&&!/CriOS/.test(o),l=/iPad/.test(o)&&/CriOS/.test(o),c=/iP(hone|od)/i.test(o)&&!/iPad/.test(o),d=/Android/.test(o)&&!/Firefox/.test(o),u=/Android/.test(o)&&/Firefox/.test(o),h=/Silk/.test(o),f=/IEMobile/.test(o),p=f?parseFloat(/Windows\ Phone\ (\d+\.\d+)/.exec(o)[1],10):0,m=f?parseFloat(/IEMobile\/(\d+\.\d+)/.exec(o)[1],10):0,g=(s?t(o):0,d?parseFloat(/Android\ (\d\.\d)/.exec(o)[1],10):0);e.extend(n,{subtitles:!!r.addTextTrack,fullscreen:"function"==typeof document.webkitCancelFullScreen&&!/Mac OS X 10_5.+Version\/5\.0\.\d Safari/.test(o)||document.mozFullScreenEnabled||"function"==typeof document.exitFullscreen||"function"==typeof document.msExitFullscreen,inlineBlock:!(a&&i.version<8),touch:"ontouchstart"in window,dataload:!s&&!c&&!f,zeropreload:!a&&!d,volume:!(s||d||c||h||l),cachedVideoTag:!(s||c||l||f),firstframe:!(c||s||d||h||l||f||u),inlineVideo:!c&&(!f||p>=8.1&&m>=11)&&(!d||g>=3),hlsDuration:!d&&(!i.safari||s||c||l),seekable:!s&&!l});try{var v=navigator.plugins["Shockwave Flash"],y=a?new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version"):v.description;a||v[0].enabledPlugin?(y=y.split(/\D+/),y.length&&!y[0]&&(y=y.slice(1)),n.flashVideo=y[0]>9||9==y[0]&&y[3]>=115):n.flashVideo=!1}catch(b){}try{n.video=!!r.canPlayType,n.video&&r.canPlayType("video/mp4")}catch(w){n.video=!1}n.animation=function(){for(var t=["","Webkit","Moz","O","ms","Khtml"],n=e("<p/>")[0],i=0;i<t.length;i++)if("undefined"!==n.style[t[i]+"AnimationName"])return!0}()}(),window.attachEvent&&window.attachEvent("onbeforeunload",function(){__flash_savedUnloadHandler=__flash_unloadHandler=function(){}}),flowplayer.engine.flash=function(n,i){var r,o,a,s=n.conf,l=(n.video,e(window)),c=function(){if("webkit"==S||B){var t=e("object param[name='flashvars']",i),r=(t.attr("value")||"").split("&");e.each(r,function(e,i){return i=i.split("="),"url"==i[0]&&i[1]!=n.video.url?(r[e]="url="+n.video.url,t.attr({value:r.join("&")}),!1):void 0})}},d=function(t){var r=i.height(),o=i.width();if(n.conf.flashfit||/full/.test(t.type)){var a,s,c=n.isFullscreen,d=c&&M,u=!flowplayer.support.inlineBlock,h=c?d?screen.width:l.width():o,f=c?d?screen.height:l.height():r,p=0,m=0,g=u?o:"",v=u?r:"";(n.conf.flashfit||"fullscreen"===t.type)&&(a=n.video.width/n.video.height,s=n.video.height/n.video.width,v=Math.max(s*h),g=Math.max(a*f),v=v>f?g*s:v,v=Math.min(Math.round(v),f),g=g>h?v*a:g,g=Math.min(Math.round(g),h),m=Math.max(Math.round((f+m-v)/2),0),p=Math.max(Math.round((h+p-g)/2),0)),e("object",i).css({width:g,height:v,marginTop:m,marginLeft:p})}},u={pick:function(t){if(flowplayer.support.flashVideo){var n=e.grep(t,function(e){return"flash"==e.type})[0];if(n)return n;for(var i,r=0;r<t.length;r++)if(i=t[r],/mp4|flv/i.test(i.type))return i}},load:function(l){function u(e){return e.replace(/&amp;/g,"%26").replace(/&/g,"%26").replace(/=/g,"%3D")}var h=e("video",i),f=u(l.src);is_absolute=/^https?:/.test(f);var p=function(){h.remove()},m=function(t){return e.grep(t,function(e){return!!h[0].canPlayType("video/"+e.type)}).length>0};if(flowplayer.support.video&&h.prop("autoplay")&&m(l.sources)?h.one("timeupdate",p):p(),is_absolute||s.rtmp||(f=e("<img/>").attr("src",f)[0].src),a)a.__play(f);else{n.bind("ready",c).bind("ready fullscreen fullscreen-exit",d),r="fp"+(""+Math.random()).slice(3,15);var g={hostname:s.embedded?s.hostname:location.hostname,url:f,callback:"jQuery."+r};i.data("origin")&&(g.origin=i.data("origin")),is_absolute&&delete s.rtmp,e.each(["key","autoplay","preload","rtmp","subscribe","live","loop","debug","splash","poster","rtmpt"],function(e,t){s.hasOwnProperty(t)&&(g[t]=s[t])}),void 0!==s.bufferTime&&(g.bufferTime=s.bufferTime),g.rtmp&&(g.rtmp=u(g.rtmp)),g.initialVolume=n.volumeLevel,o=t(s.swf,g,s.wmode),o.prependTo(i),a=o[0],setTimeout(function(){try{if(!a.PercentLoaded())return i.trigger("error",[n,{code:7,url:s.swf}])}catch(e){}},5e3),setTimeout(function(){"undefined"==typeof a.PercentLoaded&&i.trigger("flashdisabled",[n])},1e3),a.pollInterval=setInterval(function(){if(a){var e=a.__status?a.__status():null;e&&(n.trigger("progress",e.time),l.buffer=e.buffer/l.bytes*l.duration,n.trigger("buffer",l.buffer),!l.buffered&&e.time>0&&(l.buffered=!0,n.trigger("buffered")))}},250),e[r]=function(t,i){s.debug&&console.log("--",t,i);var r=e.Event(t);switch(t){case"ready":i=e.extend(l,i);break;case"click":r.flash=!0;break;case"keydown":r.which=i;break;case"seek":l.time=i}"buffered"!=t&&setTimeout(function(){n.trigger(r,i)},1)}}},speed:e.noop,unload:function(){a&&a.__unload&&a.__unload(),delete e[r],e("object",i).remove(),a=0,n.unbind("ready",c).unbind("ready fullscreen fullscreen-exit",d),clearInterval(a.pollInterval)}};return e.each("pause,resume,seek,volume".split(","),function(e,t){u[t]=function(e){try{n.ready&&("seek"==t&&n.video.time&&!n.paused&&n.trigger("beforeseek"),void 0===e?a["__"+t]():a["__"+t](e))}catch(r){if("undefined"==typeof a["__"+t])return i.trigger("flashdisabled",[n]);throw r}}}),u};var y,b=e("<video/>")[0],w={ended:"finish",pause:"pause",play:"resume",progress:"buffer",timeupdate:"progress",volumechange:"volume",ratechange:"speed",seeked:"seek",loadeddata:"ready",error:"error",dataunavailable:"error"},k=function(t){return y?y.attr({type:i(t.type),src:t.src}):y=e("<video/>",{src:t.src,type:i(t.type),"class":"fp-engine",autoplay:"autoplay",preload:"none","x-webkit-airplay":"allow"})};flowplayer.engine.html5=function(t,i){function a(o,a,s){o.listeners&&o.listeners.hasOwnProperty(i.data("fp-player_id"))||((o.listeners||(o.listeners={}))[i.data("fp-player_id")]=!0,a.bind("error",function(n){try{if(n.originalEvent&&e(n.originalEvent.originalTarget).is("img"))return n.preventDefault();r(e(n.target).attr("type"))&&t.trigger("error",{code:4})}catch(i){}}),e.each(w,function(r,a){o.addEventListener(r,function(c){if("progress"==a&&c.srcElement&&0===c.srcElement.readyState&&setTimeout(function(){t.video.duration||t.conf.live&&("mpegurl"!==t.video.type||!h.hlsDuration)||(a="error",t.trigger(a,{code:4}))},1e4),f.debug&&!/progress/.test(a)&&console.log(r,"->",a,c),(t.ready||/ready|error/.test(a))&&a&&e("video",i).length){var d,u=e.Event(a);switch(a){case"ready":d=e.extend(s,{duration:o.duration,width:o.videoWidth,height:o.videoHeight,url:o.currentSrc,src:o.currentSrc});try{d.seekable=!f.live&&/mpegurl/i.test(s?s.type||"":"")&&o.duration||o.seekable&&o.seekable.end(null)}catch(p){}if(l=l||setInterval(function(){try{d.buffer=o.buffered.end(null)}catch(e){}d.buffer&&(n(d.buffer,1e3)<n(d.duration,1e3)&&!d.buffered?t.trigger("buffer",c):d.buffered||(d.buffered=!0,t.trigger("buffer",c).trigger("buffered",c),clearInterval(l),l=0))},250),!f.live&&!d.duration&&!h.hlsDuration&&"loadeddata"===r){var m=function(){d.duration=o.duration;try{d.seekable=o.seekable&&o.seekable.end(null)}catch(e){}t.trigger(u,d),o.removeEventListener("durationchange",m)};return void o.addEventListener("durationchange",m)}break;case"progress":case"seek":t.video.duration;if(o.currentTime>0||t.live){d=Math.max(o.currentTime,0);break}if("progress"==a)return;case"speed":d=n(o.playbackRate);break;case"volume":d=n(o.volume);break;case"error":try{d=(c.srcElement||c.originalTarget).error}catch(g){return}}t.trigger(u,d)}},!1)}))}var s,l,c,d,u=e("video",i),h=flowplayer.support,f=(e("track",u),t.conf);return s={pick:function(e){if(h.video){if(f.videoTypePreference){var t=o(e,f.videoTypePreference);if(t)return t}for(var n=0;n<e.length;n++)if(r(e[n].type))return e[n]}},load:function(n){if(f.splash&&!c)u=k(n).prependTo(i),h.inlineVideo||u.css({position:"absolute",top:"-9999em"}),f.loop&&u.attr("loop","loop"),c=u[0],"undefined"!=typeof d&&(c.volume=d);else{c=u[0];var r=u.find("source");!c.src&&r.length&&(c.src=n.src,r.remove()),t.video.src&&n.src!=t.video.src?(u.attr("autoplay","autoplay"),c.src=n.src):"none"!=f.preload&&h.dataload||(h.zeropreload?t.trigger("ready",n).trigger("pause").one("ready",function(){i.trigger("resume",[t])}):t.one("ready",function(){i.trigger("pause",[t])}))}a(c,e("source",u).add(u),n),("none"!=f.preload&&"mpegurl"!=n.type||!h.zeropreload||!h.dataload)&&c.load(),f.splash&&c.load()},pause:function(){c.pause()},resume:function(){c.play()},speed:function(e){c.playbackRate=e},seek:function(e){try{var n=t.paused;c.currentTime=e,n&&c.pause()}catch(i){}},volume:function(e){d=e,c&&(c.volume=e)},unload:function(){e("video.fp-engine",i).remove(),h.cachedVideoTag||(y=null),l=clearInterval(l),c=0}}};var x=/\.(\w{3,4})(\?.*)?$/i;e.throttle=function(e,t){var n;return function(){n||(e.apply(this,arguments),n=1,setTimeout(function(){n=0},t))}},e.fn.slider2=function(t){var n=/iPad/.test(navigator.userAgent)&&!/CriOS/.test(navigator.userAgent);return this.each(function(){var i,r,o,a,s,l,c,d,u=e(this),h=e(document),f=u.children(":last"),p=!1,m=function(){r=u.offset(),o=u.width(),a=u.height(),l=s?a:o,d=b(c)},g=function(e){i||e==w.value||c&&!(c>e)||(u.trigger("slide",[e]),w.value=e)},v=function(e){var n=e.pageX;!n&&e.originalEvent&&e.originalEvent.touches&&e.originalEvent.touches.length&&(n=e.originalEvent.touches[0].pageX);var i=s?e.pageY-r.top:n-r.left;i=Math.max(0,Math.min(d||l,i));var o=i/l;return s&&(o=1-o),t&&(o=1-o),y(o,0,!0)},y=function(e,t){void 0===t&&(t=0),e>1&&(e=1);var i=Math.round(1e3*e)/10+"%";return(!c||c>=e)&&(n||p||f.stop(),p?f.css("width",i):f.animate(s?{height:i}:{width:i},t,"linear")),e},b=function(e){return Math.max(0,Math.min(l,s?(1-e)*a:e*o))},w={max:function(e){c=e},disable:function(e){i=e},slide:function(e,t,n){m(),n&&g(e),y(e,t)},disableAnimation:function(e,t){p=e!==!1,u.toggleClass("no-animation",!!t)}};m(),u.data("api",w).bind("mousedown.sld touchstart",function(t){if(t.preventDefault(),!i){var n=e.throttle(g,100);m(),w.dragging=!0,u.addClass("is-dragging"),g(v(t)),h.bind("mousemove.sld touchmove",function(e){e.preventDefault(),n(v(e))}).one("mouseup touchend",function(){w.dragging=!1,u.removeClass("is-dragging"),h.unbind("mousemove.sld touchmove")})}})})},flowplayer(function(t,n){function i(t){return e(".fp-"+t,n)}function r(t){("0px"===n.css("width")||"0px"===n.css("height")||t!==flowplayer.defaults.ratio)&&(parseInt(y,10)||m.css("paddingTop",100*t+"%")),l.inlineBlock||e("object",n).height(n.height())}function o(e){n.toggleClass("is-mouseover",e).toggleClass("is-mouseout",!e)}var a,s=t.conf,l=flowplayer.support;n.find(".fp-ratio,.fp-ui").remove(),n.addClass("flowplayer").append('      <div class="ratio"/>      <div class="ui">         <div class="waiting"><em/><em/><em/></div>         <a class="fullscreen"/>         <a class="unload"/>         <p class="speed"/>         <div class="controls">            <a class="play"></a>            <div class="timeline">               <div class="buffer"/>               <div class="progress"/>            </div>            <div class="volume">               <a class="mute"></a>               <div class="volumeslider">                  <div class="volumelevel"/>               </div>            </div>         </div>         <div class="time">            <em class="elapsed">00:00</em>            <em class="remaining"/>            <em class="duration">00:00</em>         </div>         <div class="message"><h2/><p/></div>      </div>'.replace(/class="/g,'class="fp-'));var d=i("progress"),u=i("buffer"),h=i("elapsed"),f=i("remaining"),p=i("waiting"),m=i("ratio"),g=i("speed"),v=i("duration"),y=m.css("paddingTop"),b=i("timeline").slider2(t.rtl),w=b.data("api"),k=(i("volume"),i("fullscreen")),x=i("volumeslider").slider2(t.rtl),C=x.data("api"),j=n.is(".fixed-controls, .no-toggle");w.disableAnimation(n.hasClass("is-touch")),l.animation||p.html("<p>loading &hellip;</p>"),r(s.ratio);try{s.fullscreen||k.remove()}catch(T){k.remove()}t.bind("ready",function(){var e=t.video.duration;w.disable(t.disabled||!e),s.adaptiveRatio&&r(t.video.height/t.video.width),v.add(f).html(c(e)),e>=3600&&n.addClass("is-long")||n.removeClass("is-long"),C.slide(t.volumeLevel),"flash"===t.engine&&w.disableAnimation(!0,!0)}).bind("unload",function(){y||m.css("paddingTop","")}).bind("buffer",function(){var e=t.video,n=e.buffer/e.duration;!e.seekable&&l.seekable&&w.max(n),1>n?u.css("width",100*n+"%"):u.css({width:"100%"})}).bind("speed",function(e,t,n){g.text(n+"x").addClass("fp-hilite"),setTimeout(function(){g.removeClass("fp-hilite")},1e3)}).bind("buffered",function(){u.css({width:"100%"}),w.max(1)}).bind("progress",function(){var e=t.video.time,n=t.video.duration;w.dragging||w.slide(e/n,t.seeking?0:250),h.html(c(e)),f.html("-"+c(n-e))}).bind("finish resume seek",function(e){n.toggleClass("is-finished","finish"==e.type)}).bind("stop",function(){h.html(c(0)),w.slide(0,100)}).bind("finish",function(){h.html(c(t.video.duration)),w.slide(1,100),n.removeClass("is-seeking")}).bind("beforeseek",function(){d.stop()}).bind("volume",function(){C.slide(t.volumeLevel)}).bind("disable",function(){var e=t.disabled;w.disable(e),C.disable(e),n.toggleClass("is-disabled",t.disabled)}).bind("mute",function(e,t,i){n.toggleClass("is-muted",i)}).bind("error",function(t,i,r){if(n.removeClass("is-loading").addClass("is-error"),r){r.message=s.errors[r.code],i.error=!0;var o=e(".fp-message",n);e("h2",o).text((i.engine||"html5")+": "+r.message),e("p",o).text(r.url||i.video.url||i.video.src||s.errorUrls[r.code]),n.unbind("mouseenter click").removeClass("is-mouseover")}}).bind("mouseenter mouseleave",function(e){if(!j){var t,i="mouseenter"==e.type;o(i),i?(n.bind("pause.x mousemove.x volume.x",function(){o(!0),t=new Date}),a=setInterval(function(){new Date-t>5e3&&(o(!1),t=new Date)},100)):(n.unbind(".x"),clearInterval(a))}}).bind("mouseleave",function(){(w.dragging||C.dragging)&&n.addClass("is-mouseover").removeClass("is-mouseout")}).bind("click.player",function(n){return e(n.target).is(".fp-ui, .fp-engine")||n.flash?(n.preventDefault(),t.toggle()):void 0}).bind("contextmenu",function(t){t.preventDefault();var i=n.offset(),r=e(window),o=t.clientX-i.left,a=t.clientY-i.top+r.scrollTop(),s=n.find(".fp-context-menu").css({left:o+"px",top:a+"px",display:"block"}).on("click",function(e){e.stopPropagation()});e("html").on("click.outsidemenu",function(t){s.hide(),e("html").off("click.outsidemenu")})}).bind("flashdisabled",function(){n.addClass("is-flash-disabled").one("ready",function(){n.removeClass("is-flash-disabled").find(".fp-flash-disabled").remove()}).append('<div class="fp-flash-disabled">Adobe Flash is disabled for this page, click player area to enable.</div>')}),s.poster&&n.css("backgroundImage","url("+s.poster+")");var _=n.css("backgroundColor"),S="none"!=n.css("backgroundImage")||_&&"rgba(0, 0, 0, 0)"!=_&&"transparent"!=_;!S||s.splash||s.autoplay||t.bind("ready stop",function(){n.addClass("is-poster").one("progress",function(){n.removeClass("is-poster")})}),!S&&t.forcedSplash&&n.css("backgroundColor","#555"),e(".fp-toggle, .fp-play",n).click(t.toggle),e.each(["mute","fullscreen","unload"],function(e,n){i(n).click(function(){t[n]()})}),b.bind("slide",function(e,n){t.seeking=!0,t.seek(n*t.video.duration)}),x.bind("slide",function(e,n){t.volume(n)}),i("time").click(function(t){e(this).toggleClass("is-inverted")}),o(j)});var C,j,T="is-help";e(document).bind("keydown.fp",function(t){var n=C,i=t.ctrlKey||t.metaKey||t.altKey,r=t.which,o=n&&n.conf;if(n&&o.keyboard&&!n.disabled){if(-1!=e.inArray(r,[63,187,191]))return j.toggleClass(T),!1;if(27==r&&j.hasClass(T))return j.toggleClass(T),!1;if(!i&&n.ready){if(t.preventDefault(),t.shiftKey)return void(39==r?n.speed(!0):37==r&&n.speed(!1));if(58>r&&r>47)return n.seekTo(r-48);switch(r){case 38:case 75:n.volume(n.volumeLevel+.15);break;case 40:case 74:n.volume(n.volumeLevel-.15);break;case 39:case 76:n.seeking=!0,n.seek(!0);break;case 37:case 72:n.seeking=!0,n.seek(!1);break;case 190:n.seekTo();break;case 32:n.toggle();break;case 70:o.fullscreen&&n.fullscreen();break;case 77:n.mute();break;case 81:n.unload()}}}}),flowplayer(function(t,n){if(t.conf.keyboard){n.bind("mouseenter mouseleave",function(e){C=t.disabled||"mouseenter"!=e.type?0:t,C&&(j=n)});var i=flowplayer.support.video&&"flash"!==t.conf.engine&&e("<video/>")[0].playbackRate?"<p><em>shift</em> + <em>&#8592;</em><em>&#8594;</em>slower / faster</p>":"";n.append('      <div class="fp-help">         <a class="fp-close"></a>         <div class="fp-help-section fp-help-basics">            <p><em>space</em>play / pause</p>            <p><em>q</em>unload | stop</p>            <p><em>f</em>fullscreen</p>'+i+'         </div>         <div class="fp-help-section">            <p><em>&#8593;</em><em>&#8595;</em>volume</p>            <p><em>m</em>mute</p>         </div>         <div class="fp-help-section">            <p><em>&#8592;</em><em>&#8594;</em>seek</p>            <p><em>&nbsp;. </em>seek to previous            </p><p><em>1</em><em>2</em>&hellip; <em>6</em> seek to 10%, 20% &hellip; 60% </p>         </div>      </div>   '),t.conf.tooltip&&e(".fp-ui",n).attr("title","Hit ? for help").on("mouseout.tip",function(){e(this).removeAttr("title").off("mouseout.tip")}),e(".fp-close",n).click(function(){n.toggleClass(T)})}});var _,S=e.browser.mozilla?"moz":"webkit",I="fullscreen",P="fullscreen-exit",M=flowplayer.support.fullscreen,Q=("function"==typeof document.exitFullscreen,navigator.userAgent.toLowerCase()),B=/(safari)[ \/]([\w.]+)/.exec(Q)&&!/(chrome)[ \/]([\w.]+)/.exec(Q);e(document).bind("fullscreenchange webkitfullscreenchange mozfullscreenchange MSFullscreenChange",function(t){var n=e(document.webkitCurrentFullScreenElement||document.mozFullScreenElement||document.fullscreenElement||document.msFullscreenElement||t.target);n.length&&!_?_=n.trigger(I,[n]):(_.trigger(P,[_]),_=null)}),flowplayer(function(t,n){if(t.conf.fullscreen){var i,r=e(window),o={apply:!1,pos:0,play:!1};t.isFullscreen=!1,t.fullscreen=function(a){if(!t.disabled){if(void 0===a&&(a=!t.isFullscreen),a&&(i=r.scrollTop()),"webkit"!=S&&!B||"flash"!=t.engine||(o={apply:!0,pos:t.video.time,play:t.playing}),M)if(a){var s=n[0];e.each(["requestFullScreen","webkitRequestFullScreen","mozRequestFullScreen","msRequestFullscreen"],function(e,t){return"function"==typeof s[t]?(s[t](Element.ALLOW_KEYBOARD_INPUT),!B||document.webkitCurrentFullScreenElement||document.mozFullScreenElement||s[t](),!1):void 0})}else e.each(["exitFullscreen","webkitCancelFullScreen","mozCancelFullScreen","msExitFullscreen"],function(e,t){return"function"==typeof document[t]?(document[t](),!1):void 0});else t.trigger(a?I:P,[t]);return t}};var a;n.bind("mousedown.fs",function(){+new Date-a<150&&t.ready&&t.fullscreen(),a=+new Date}),t.bind(I,function(e){n.addClass("is-fullscreen"),t.isFullscreen=!0}).bind(P,function(e){var o;M||"html5"!==t.engine||(o=n.css("opacity")||"",n.css("opacity",0)),n.removeClass("is-fullscreen"),M||"html5"!==t.engine||setTimeout(function(){n.css("opacity",o)}),t.isFullscreen=!1,r.scrollTop(i)}).bind("ready",function(){if(o.apply){var n=function(){o.play||t.conf.live?t.resume():t.pause(),e.extend(o,{pos:0,play:!1})};t.conf.live?n():t.conf.rtmp&&o.pos&&!isNaN(o.pos)?(t.resume(),t.seek(o.pos,n)):n()}})}}),flowplayer(function(t,n){function i(){return e(o.query,n)}function r(){return e(o.query+"."+a,n)}var o=e.extend({active:"is-active",advance:!0,query:".fp-playlist a"},t.conf),a=o.active;t.play=function(n){return void 0===n?t.resume():"number"!=typeof n||t.conf.playlist[n]?("number"!=typeof n&&t.load.apply(null,arguments),t.unbind("resume.fromfirst"),t.video.index=n,t.load("string"==typeof t.conf.playlist[n]?t.conf.playlist[n].toString():e.map(t.conf.playlist[n],function(t){return e.extend({},t)})),t):t},t.next=function(e){e&&e.preventDefault();var n=t.video.index;return-1!=n&&(n=n===t.conf.playlist.length-1?0:n+1,t.play(n)),t},t.prev=function(e){e&&e.preventDefault();var n=t.video.index;return-1!=n&&(n=0===n?t.conf.playlist.length-1:n-1,t.play(n)),t},e(".fp-next",n).click(t.next),e(".fp-prev",n).click(t.prev),o.advance&&n.unbind("finish.pl").bind("finish.pl",function(e,t){var i=t.video.index>=0?t.video.index+1:void 0;i<t.conf.playlist.length||o.loop?(i=i===t.conf.playlist.length?0:i,n.removeClass("is-finished"),setTimeout(function(){t.play(i)})):(n.addClass("is-playing"),t.conf.playlist.length>1&&t.one("resume.fromfirst",function(){return t.play(0),!1}))});var s=!1;if(t.conf.playlist.length){s=!0;var l=n.find(".fp-playlist");if(!l.length){l=e('<div class="fp-playlist"></div>');var c=e(".fp-next,.fp-prev",n);c.length?c.eq(0).before(l):e("video",n).after(l)}l.empty(),e.each(t.conf.playlist,function(t,n){var i;if("string"==typeof n)i=n;else for(var r in n[0])if(n[0].hasOwnProperty(r)){i=n[0][r];break}l.append(e("<a />").attr({href:i,"data-index":t}))})}if(i().length){s||(t.conf.playlist=[],i().each(function(){var n=e(this).attr("href");e(this).attr("data-index",t.conf.playlist.length),t.conf.playlist.push(n)})),n.on("click",o.query,function(n){n.preventDefault();var i=e(n.target).closest(o.query),r=Number(i.attr("data-index"));-1!=r&&t.play(r)});var d=i().filter("[data-cuepoints]").length;t.bind("load",function(i,o,s){var l=r().removeClass(a),c=l.attr("data-index"),u=s.index=t.video.index||0,h=e('a[data-index="'+u+'"]',n).addClass(a),f=u==t.conf.playlist.length-1;n.removeClass("video"+c).addClass("video"+u).toggleClass("last-video",f),s.index=o.video.index=u,s.is_last=o.video.is_last=f,d&&(t.cuepoints=h.data("cuepoints"))}).bind("unload.pl",function(){r().toggleClass(a)})}t.conf.playlist.length&&(t.conf.loop=!1)});var E=/ ?cue\d+ ?/;flowplayer(function(t,n){function i(e){n[0].className=n[0].className.replace(E," "),e>=0&&n.addClass("cue"+e)}var r=0;t.cuepoints=t.conf.cuepoints||[],t.bind("progress",function(e,o,a){if(r&&.015>a-r)return r=a;r=a;for(var s,l=t.cuepoints||[],c=0;c<l.length;c++)s=l[c],isNaN(s)||(s={time:s}),s.time<0&&(s.time=t.video.duration+s.time),s.index=c,Math.abs(s.time-a)<.125*t.currentSpeed&&(i(c),n.trigger("cuepoint",[t,s]))}).bind("unload seek",i),t.conf.generate_cuepoints&&t.bind("load",function(){e(".fp-cuepoint",n).remove()}).bind("ready",function(){var i=t.cuepoints||[],r=t.video.duration,o=e(".fp-timeline",n).css("overflow","visible");e.each(i,function(n,i){var a=i.time||i;0>a&&(a=r+i);var s=e("<a/>").addClass("fp-cuepoint fp-cuepoint"+n).css("left",a/r*100+"%");s.appendTo(o).mousedown(function(){return t.seek(a),!1})})})}),flowplayer(function(t,n,i){function r(e){var t=e.split(":");return 2==t.length&&t.unshift(0),60*t[0]*60+60*t[1]+parseFloat(t[2].replace(",","."))}var o=e("track",n),a=t.conf;if(flowplayer.support.subtitles&&(t.subtitles=o.length&&o[0].track,a.nativesubtitles&&"html5"==a.engine)){if(!t.subtitles)return;var s=function(t){var i=e("video",n)[0].textTracks;i.length&&(i[0].mode=t)};return s("disabled"),void t.one("ready",function(){t.conf.splash&&e("video.fp-engine",n).append(e("<track />").attr({kind:"subtitles",srclang:t.subtitles.language||"en",label:t.subtitles.language||"en",src:o.attr("src"),"default":"default"})),s("disabled"),s("showing")})}o.remove();var l=/^(([0-9]{2}:){1,2}[0-9]{2}[,.][0-9]{3}) --\> (([0-9]{2}:){1,2}[0-9]{2}[,.][0-9]{3})(.*)/;t.subtitles=[];var c=o.attr("src");if(c){setTimeout(function(){e.get(c,function(n){for(var i,o,a,s,c=0,d=n.split("\n"),u=d.length,h={};u>c;c++)if(o=l.exec(d[c])){for(i=d[c-1],a="<p>"+d[++c]+"</p><br/>";e.trim(d[++c])&&c<d.length;)a+="<p>"+d[c]+"</p><br/>";h={title:i,startTime:r(o[1]),endTime:r(o[3]),text:a},s={time:h.startTime,subtitle:h},t.subtitles.push(h),t.cuepoints.push(s),t.cuepoints.push({time:h.endTime,subtitleEnd:i}),0===h.startTime&&t.trigger("cuepoint",s)}}).fail(function(){return t.trigger("error",{code:8,url:c}),!1})});var d,u=e("<div class='fp-subtitle'/>").appendTo(n);t.bind("cuepoint",function(e,t,n){n.subtitle?(d=n.index,u.html(n.subtitle.text).addClass("fp-active")):n.subtitleEnd&&(u.removeClass("fp-active"),d=n.index)}).bind("seek",function(n,i,r){d&&t.cuepoints[d]&&t.cuepoints[d].time>r&&(u.removeClass("fp-active"),
d=null),e.each(t.cuepoints||[],function(e,n){var i=n.subtitle;i&&d!=n.index?r>=n.time&&(!i.endTime||r<=i.endTime)&&t.trigger("cuepoint",n):n.subtitleEnd&&r>=n.time&&n.index==d+1&&t.trigger("cuepoint",n)})})}}),flowplayer(function(t,n){function i(e){if(o&&"undefined"!=typeof _gat){var i=_gat._getTracker(r),a=t.video;i._setAllowLinker(!0),i._trackEvent("Video / Seconds played",t.engine+"/"+a.type,n.attr("title")||a.src.split("/").slice(-1)[0].replace(x,""),Math.round(o/1e3)),o=0}}var r=t.conf.analytics,o=0,a=0;r&&("undefined"==typeof _gat&&e.getScript("//google-analytics.com/ga.js"),t.bind("load unload",i).bind("progress",function(){t.seeking||(o+=a?+new Date-a:0,a=+new Date)}).bind("pause",function(){a=0}),e(window).unload(i))});var O=/IEMobile/.test(h);(flowplayer.support.touch||O)&&flowplayer(function(t,n){var i=/Android/.test(h)&&!/Firefox/.test(h)&&!/Opera/.test(h),r=/Silk/.test(h),o=i?parseFloat(/Android\ (\d\.\d)/.exec(h)[1],10):0;if(i){if(!/Chrome/.test(h)&&4>o){var a=t.load;t.load=function(e,n){var i=a.apply(t,arguments);return t.trigger("ready",[t,t.video]),i}}var s,l=0,d=function(e){s=setInterval(function(){e.video.time=++l,e.trigger("progress",l)},1e3)};t.bind("ready pause unload",function(){s&&(clearInterval(s),s=null)}),t.bind("ready",function(){l=0}),t.bind("resume",function(e,n){return n.live?l?d(n):void t.one("progress",function(e,t,n){0===n&&d(t)}):void 0})}flowplayer.support.volume||n.addClass("no-volume no-mute"),n.addClass("is-touch"),n.find(".fp-timeline").data("api").disableAnimation(),(!flowplayer.support.inlineVideo||t.conf.native_fullscreen)&&(t.conf.nativesubtitles=!0);var u=!1;n.bind("touchmove",function(){u=!0}).bind("touchend click",function(i){return u?void(u=!1):t.playing&&!n.hasClass("is-mouseover")?(n.addClass("is-mouseover").removeClass("is-mouseout"),!1):(t.paused&&n.hasClass("is-mouseout")&&!t.splash&&t.toggle(),void(t.paused&&O&&e("video.fp-engine",n)[0].play()))}),t.conf.native_fullscreen&&"function"==typeof e("<video />")[0].webkitEnterFullScreen&&(t.fullscreen=function(){var t=e("video.fp-engine",n);t[0].webkitEnterFullScreen(),t.one("webkitendfullscreen",function(){t.prop("controls",!0).prop("controls",!1)})}),(i||r)&&t.bind("ready",function(){var i=e("video.fp-engine",n);i.one("canplay",function(){i[0].play()}),i[0].play(),t.bind("progress.dur",function(){var r=i[0].duration;1!==r&&(t.video.duration=r,e(".fp-duration",n).html(c(r)),t.unbind("progress.dur"))})})}),flowplayer(function(t,n){if(t.conf.embed!==!1){var i=t.conf,r=e(".fp-ui",n),o=e("<a/>",{"class":"fp-embed",title:"Copy to your site"}).appendTo(r),a=e("<div/>",{"class":"fp-embed-code"}).append("<label>Paste this HTML code on your site to embed.</label><textarea/>").appendTo(r),s=e("textarea",a);t.embedCode=function(){var r=t.video,o=r.width||n.width(),a=r.height||n.height(),s=e("<div/>",{"class":"flowplayer",css:{width:o,height:a}}),l=e("<video/>").appendTo(s);e.each(["origin","analytics","key","rtmp","subscribe","bufferTime"],function(e,t){i.hasOwnProperty(t)&&s.attr("data-"+t,i[t])}),i.logo&&s.attr("data-logo",e("<img />").attr("src",i.logo)[0].src),e.each(r.sources,function(t,n){var r=n.src;(!/^https?:/.test(n.src)&&"flash"!==n.type||!i.rtmp)&&(r=e("<img/>").attr("src",n.src)[0].src),l.append(e("<source/>",{type:"mpegurl"!=n.type?"video/"+n.type:"application/x-mpegurl",src:r}))});var c={src:"//embed.flowplayer.org/5.5.2/embed.min.js"};e.isPlainObject(i.embed)&&(c["data-swf"]=i.embed.swf,c["data-library"]=i.embed.library,c.src=i.embed.script||c.src,i.embed.skin&&(c["data-skin"]=i.embed.skin));var d=e("<foo/>",c).append(s);return e("<p/>").append(d).html().replace(/<(\/?)foo/g,"<$1script")},n.fptip(".fp-embed","is-embedding"),s.click(function(){this.select()}),o.click(function(){s.text(t.embedCode()),s[0].focus(),s[0].select()})}}),e.fn.fptip=function(t,n){return this.each(function(){function i(){r.removeClass(n),e(document).unbind(".st")}var r=e(this);e(t||"a",this).click(function(t){t.preventDefault(),r.toggleClass(n),r.hasClass(n)&&e(document).bind("keydown.st",function(e){27==e.which&&i()}).bind("click.st",function(t){e(t.target).parents("."+n).length||i()})})})}}(jQuery),flowplayer(function(e,t){function n(e){var t=o("<a/>")[0];return t.href=e,t.hostname}function i(e){var t="ab.ca,ac.ac,ac.at,ac.be,ac.cn,ac.il,ac.in,ac.jp,ac.kr,ac.sg,ac.th,ac.uk,adm.br,adv.br,ah.cn,am.br,arq.br,art.br,arts.ro,asn.au,asso.fr,asso.mc,bc.ca,bio.br,biz.pl,biz.tr,bj.cn,br.com,cn.com,cng.br,cnt.br,co.ac,co.at,co.de,co.gl,co.hk,co.id,co.il,co.in,co.jp,co.kr,co.mg,co.ms,co.nz,co.th,co.uk,co.ve,co.vi,co.za,com.ag,com.ai,com.ar,com.au,com.br,com.cn,com.co,com.cy,com.de,com.do,com.ec,com.es,com.fj,com.fr,com.gl,com.gt,com.hk,com.hr,com.hu,com.kg,com.ki,com.lc,com.mg,com.mm,com.ms,com.mt,com.mu,com.mx,com.my,com.na,com.nf,com.ng,com.ni,com.pa,com.ph,com.pl,com.pt,com.qa,com.ro,com.ru,com.sb,com.sc,com.sg,com.sv,com.tr,com.tw,com.ua,com.uy,com.ve,com.vn,cq.cn,de.com,de.org,ecn.br,edu.au,edu.cn,edu.hk,edu.mm,edu.my,edu.pl,edu.pt,edu.qa,edu.sg,edu.tr,eng.br,ernet.in,esp.br,etc.br,eti.br,eu.com,eu.int,eu.lv,firm.in,firm.ro,fm.br,fot.br,fst.br,g12.br,gb.com,gb.net,gd.cn,gen.in,go.jp,go.kr,go.th,gov.au,gov.az,gov.br,gov.cn,gov.il,gov.in,gov.mm,gov.my,gov.qa,gov.sg,gov.tr,gov.tw,gov.uk,gs.cn,gv.ac,gv.at,gx.cn,gz.cn,he.cn,hi.cn,hk.cn,hl.cn,hu.com,id.au,idv.tw,in.ua,ind.br,ind.in,inf.br,info.pl,info.ro,info.tr,info.ve,iwi.nz,jl.cn,jor.br,js.cn,k12.il,k12.tr,kr.com,lel.br,ln.cn,ltd.uk,maori.nz,mb.ca,me.uk,med.br,mi.th,mil.br,mil.uk,mo.cn,mod.uk,muni.il,nb.ca,ne.jp,ne.kr,net.ag,net.ai,net.au,net.br,net.cn,net.do,net.gl,net.hk,net.il,net.in,net.kg,net.ki,net.lc,net.mg,net.mm,net.mu,net.ni,net.nz,net.pl,net.ru,net.sb,net.sc,net.sg,net.th,net.tr,net.tw,net.uk,net.ve,nf.ca,nhs.uk,nm.cn,nm.kr,no.com,nom.br,nom.ni,nom.ro,ns.ca,nt.ca,nt.ro,ntr.br,nx.cn,odo.br,off.ai,on.ca,or.ac,or.at,or.jp,or.kr,or.th,org.ag,org.ai,org.au,org.br,org.cn,org.do,org.es,org.gl,org.hk,org.in,org.kg,org.ki,org.lc,org.mg,org.mm,org.ms,org.nf,org.ni,org.nz,org.pl,org.ro,org.ru,org.sb,org.sc,org.sg,org.tr,org.tw,org.uk,org.ve,pe.ca,plc.uk,police.uk,ppg.br,presse.fr,pro.br,psc.br,psi.br,qc.ca,qc.com,qh.cn,rec.br,rec.ro,res.in,sa.com,sc.cn,sch.uk,se.com,se.net,sh.cn,sk.ca,slg.br,sn.cn,store.ro,tj.cn,tm.fr,tm.mc,tm.ro,tmp.br,tur.br,tv.br,tv.tr,tw.cn,uk.com,uk.net,us.com,uy.com,vet.br,waw.pl,web.ve,www.ro,xj.cn,xz.cn,yk.ca,yn.cn,zj.cn,zlg.br".split(",");e=e.toLowerCase();var n=e.split("."),i=n.length;if(2>i||/^\d+$/.test(n[i-1]))return e;var r=n.slice(-2).join(".");return i>=3&&o.inArray(r,t)>=0?n.slice(-3).join("."):r}function r(e,t){t=i(t);for(var n=0,r=t.length-1;r>=0;r--)n+=2983723987*t.charCodeAt(r);for(n=(""+n).substring(0,7),r=0;e.length>r;r++)if(n===e[r].substring(1,8))return 1}var o=jQuery,a=e.conf,s=a.swf.indexOf("flowplayer.org")&&a.e&&t.data("origin"),l=s?n(s):location.hostname,c=a.key;if("file:"==location.protocol&&(l="localhost"),e.load.ed=1,a.hostname=l,a.origin=s||location.href,s&&t.addClass("is-embedded"),"string"==typeof c&&(c=c.split(/,\s*/)),c&&"function"==typeof r&&r(c,l))a.logo&&t.append(o("<a>",{"class":"fp-logo",href:s}).append(o("<img/>",{src:a.logo})));else{var d=o("<a/>").attr("href","http://flowplayer.org").appendTo(t);o(".fp-controls",t);var u=o('<div class="fp-context-menu"><ul><li class="copyright">&copy; 2014</li><li><a href="http://flowplayer.org">About Flowplayer</a></li><li><a href="http://flowplayer.org/license">GPL based license</a></li></ul></div>').appendTo(t);e.bind("pause resume finish unload",function(e,n){var i=-1;n.video.src&&o.each([["org","flowplayer","drive"],["org","flowplayer","my"]],function(e,t){return i=n.video.src.indexOf("://"+t.reverse().join(".")),-1===i}),/pause|resume/.test(e.type)&&"flash"!=n.engine&&4!=i&&5!=i?(d.show().css({position:"absolute",left:16,bottom:36,zIndex:99999,width:100,height:20,backgroundImage:"url("+[".png","logo","/",".net",".cloudfront","d32wqyuo10o653","//"].reverse().join("")+")"}),n.load.ed=d.is(":visible")&&o.contains(t[0],u[0]),n.load.ed||n.pause()):d.hide()})}}),"undefined"==typeof Handler&&(Handler={}),Handler.tracking=Extend.Publisher(function(){return Handler.tracking.emit("event",arguments)}),Handler.tracking.ga=function(e,t){function n(){clearTimeout(i),ga("send","event","keepAlive"),Date.now()<=r+36e5&&(i=setTimeout(n,24e4))}"function"!=typeof ga&&errorHandler.error("Google Analytics not defined"),ga("create",e,t),ga("set","dimension2",config.level().toString()),ga("require","linkid","linkid.js"),ga("send","pageview"),window.flowplayer&&window.flowplayer.conf&&(flowplayer.conf.analytics=e);var i,r=Date.now();n(),Handler.tracking.on("event",function(e,t){var n=["send","event"];n.pushArray(t),ga.apply(ga,n)})},function(e,t,n,i,r,o,a){e.GoogleAnalyticsObject=r,e[r]=e[r]||function(){(e[r].q=e[r].q||[]).push(arguments)},e[r].l=1*new Date,o=t.createElement(n),a=t.getElementsByTagName(n)[0],o.async=1,o.src=i,a.parentNode.insertBefore(o,a)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),Handler.tracking.ga("UA-49208411-1","chess24.com"),"undefined"==typeof Handler&&(Handler={}),$(function(){window.config&&(window.chatHandler=new Handler.ChatHandler)}),Handler.ChatHandler=function(){function e(e,t,n){notificationHandler.sendMessage("chat."+e,t,n)}function t(){function e(e,t){Object.forEach(r,function(n){"function"==typeof n[e]&&n[e](t)})}function t(e,t,n){var i=r[t];i&&"function"==typeof i[e]&&i[e](n)}var n=this,i=0,r={};n.addView=function(e,t){r[e]=t,i++},n.removeView=function(e){void 0!==r[e]&&(r[e].clear(),delete r[e],i--)},n.hasView=function(e){return void 0!==r[e]},n.hasViews=function(){return i>0},n.handleInitData=function(e){t("handleInitData",e.viewId,e)},n.handleEnterRoom=function(e){t("enterChatRoom",e.viewId,e)},n.handleEnterRoomFailed=function(e){t("enterChatRoomFailed",e.data.viewId,e)},n.handleMessage=function(t){e("addNewMessage",t.message)},n.handleMemberCounts=function(t){e("updateCounts",t.counts)},n.handleRoomMetadata=function(t){e("updateMetadata",t)},n.handleGetMessages=function(e){t("addPreviousMessages",e.data.viewId,e.messages)},n.handleMessageDeleted=function(t){e("deleteMessage",t.id)},n.handleMessagesDeleted=function(t){e("deleteMessages",t.userId)},n.handleUserBlocked=function(e){t("handleUserBlocked",e.clientInfo.viewId,e)},n.handleUserBanned=function(e){t("handleUserBanned",e.clientInfo.viewId,e)},n.handleUserUnbanned=function(e){t("handleUserUnbanned",e.clientInfo.viewId,e)}}function n(e){var t=e.content,n=t.action,i=t.data;switch(n){case"enterRoom":var r=i.roomId;void 0!==u[r]&&u[r].handleEnterRoomFailed(i);break;default:errorHandler.warning(n+" failed",e.content.data)}}function i(e){var t,n=e.content,i=n.data;switch(i.code){case s:t=i.clientInfo.roomId,void 0!==u[t]&&u[t].handleUserBlocked(i);break;case l:t=i.clientInfo.roomId,void 0!==u[t]&&u[t].handleUserBanned(i);break;case c:t=i.clientInfo.roomId,void 0!==u[t]&&u[t].handleUserUnbanned(i)}}function r(e,t){if(void 0!==t.content.type){var r,o,a=t.content.type;switch(a){case"roomMetadata":case"message":case"getMessages":case"memberCounts":case"messageDeleted":case"messagesDeleted":case"enterRoom":r=t.content.data.roomId,void 0!==u[r]&&(o="handle"+a.charAt(0).toUpperCase()+a.slice(1),u[r][o](t.content.data));break;case"initData":for(r in t.content.data.rooms)break;u[r].handleInitData(t.content.data);break;case"error":n(t);break;case"info":i(t)}}}function o(){h||(notificationHandler.on("chat",r),h=!0)}var a="default",s=201,l=202,c=203,d=this,u={},h=!1,f=20;return d.addChat=function(e,n,i){h||o(),i=i||{},i.getMessagesLimit=i.getMessagesLimit||f;var r=i.viewId||a+(new Helper.UUID).getShort();Array.isArray(n)||(n=[n]);var s=new View.Chat.ChatHandler(e,n,r,i);return n.forEach(function(e){void 0===u[e]&&(u[e]=new t(e)),u[e].hasView(r)||u[e].addView(r,s)}),s},d.removeChat=function(t,n,i){if(void 0===u[t])return d;var r=u[t];return n=n||a,r.removeView(n),r.hasViews()?"function"==typeof i&&i():(delete u[t],e("leaveChatRoom",t,i)),d},d.getInitData=function(t,n){e("getInitData",{rooms:t,viewId:n})},d.enterChatRoom=function(t,n,i){t&&(i=i||f,e("enterChatRoom",{roomId:t,viewId:n,messages:i,blockedUsers:blockedUserHandler.getBlockedUsers()}))},d.leaveChatRoom=function(t){e("leaveChatRoom",t)},d.sendMessage=function(t,n,i,r){return e("sendMessage",{roomId:t,message:n,type:i},r),Handler.tracking("message","chat",t),d},d.getPreviousMessages=function(t,n,i,r,o){return o=o||f,e("getMessages",{roomId:t,viewId:n,limit:o,refMessageId:i,refMessageTimestamp:r,blockedUsers:blockedUserHandler.getBlockedUsers()}),d},d.moderator={deleteMessage:function(t,n,i){e("deleteMessage",{roomId:t,id:n,timestamp:i})},getModeratorLog:function(t,n,i){e("getModeratorLog",{offset:t,limit:n},i)},getBannedUsers:function(t,n,i){e("getBannedUsers",{offset:t,limit:n},i)},user:{block:function(t,n,i,r){e("blockUser",{uuid:t,timeout:n,clientInfo:{roomId:i,viewId:r}})},ban:function(t,n,i){e("banUser",{uuid:t,clientInfo:{roomId:n,viewId:i}})},unban:function(t,n,i){e("unbanUser",{uuid:t,clientInfo:{roomId:n,viewId:i}})},deleteMessages:function(t,n){e("deleteMessagesFromUser",{roomId:n,userId:t})}}},d},Handler.ChatHandler.COOLDOWN_DEFAULTVALUE=30,function(){function e(){function e(e,s){void 0===s||isNaN(s)||(n=Date.now()-s,t.set("serverUserTimeOffset",n),o.resolve(n)),e.on("*",function(t){a.contains(t.id)||(i.emit(t.event||t.channel,t),a.push(t.id)),t.channel&&t.channel.substr(0,r.length)===r&&e.emit("messageRecieved",t.id)})}var t=jQuery.localStorage,n=t.get("serverUserTimeOffset"),i=Extend.Publisher(this),r="channel:private:",o=new Helper.Deferred,a=[],s=Handler.socket.getSocket(Handler.socket.types.NOTIFICATION);return s.deferred.promise.done(e).fail(function(e){errorHandler.warning("no notification service available",{err:e})}),i.subscribe=function(e){return s.subscribe(e),i},i.unsubscribe=function(e){return s.unsubscribe(e),i},i.subscribeRequest=function(e){return s.subscribeRequest(e),i},i.getTimeOffset=function(){return null==n?o.promise:n},i.sendMessage=function(e,t,n){switch(e){case"chat.enterChatRoom":var i="chat:"+t.roomId,r=s.getChannels();r.contains(i)||r.push(i);break;case"chat.leaveChatRoom":i="chat:"+t,r=s.getChannels(),r.contains(i)&&r.removeByValue(i)}var o=[e,t];n&&o.push(n),s.emit.apply(s,o)},i.triggerNotificationDeleted=function(e,t){i.emit("deleteNotification",{notificationType:e,referenceId:t})},i}jQuery(function(){window.config&&(window.notificationHandler=new e)})}(),"undefined"==typeof Handler&&(Handler={}),$(function(){window.config&&(window.blockedUserHandler=new Handler.BlockedUserHandler)}),Handler.BlockedUserHandler=function(){function e(e){return i[e]="1",n.emit("user.blocked",e),this}function t(e){return delete i[e],n.emit("user.unblocked",e),this}var n=Extend.Publisher(this),i={};return n.isBlocked=function(e){return i[e]?!0:!1},n.getBlockedUsers=function(){var e=[];for(var t in i)i.hasOwnProperty(t)&&e.push(t);return i},function(){notificationHandler.on("blockedUserUpdate",function(n,i){i=i.content,i.state?e(i.userUuid):t(i.userUuid)});var n=window.settings.getString("blocked-users");"#"!==n&&n.split(",").forEach(e)}(),n},"undefined"==typeof Handler&&(Handler={}),Handler.ConversationListHandler=function(e){function t(e){return!blockedUserHandler.isBlocked(e.uuid)}function n(e){switch(e.type){case 1:return Array.isArray(e.users)&&e.users.some(t)||Array.isArray(e.deletedFrom)&&e.deletedFrom.some(t);default:return!1}}function i(e){o=[],e.forEach(function(e){n(e)&&o.push(e)}),r(),a.emit("conversationListChanged",o)}function r(){s={};for(var e=o.length,t=0;e>t;t++)s[o[t].id]=t}var o,a=Extend.Publisher(this),s={};return e.on("newMessage",function(t,n){if(!blockedUserHandler.isBlocked(n.message.user.uuid)){var i=n.roomId,l=s[i];if(void 0!==l){if(l>0){var c=o[l];o.splice(l,1),o.unshift(c),r(),a.emit("movedItemToStart",l)}a.emit("updateConversation",{isOwnMessage:config.user().uuid===n.message.user.uuid,index:0,message:n.message.content,timestamp:n.message.timestamp})}else l=0,e.getConversation(i,function(e){o.unshift(e),r(),a.emit("newItem",{index:0,converesation:e})})}}),e.on("user-left",function(e,t){var n=t.room,i=s[n],l=t.user;config.user().uuid==l?(o.splice(i,1),a.emit("removedItem",{index:i}),r()):a.emit("user-left."+n,l)}),a.getConversations=function(){return o},e.getConversations(i),a},"undefined"==typeof Handler&&(Handler={}),$(function(){window.config&&(window.conversationHandler=new Handler.ConversationHandler)}),Handler.ConversationHandler=function(){function e(e,t,n){notificationHandler.sendMessage("conversation."+e,t,n)}var t,n=20,i=Extend.Publisher(this),r={};return notificationHandler.on("conversation",function(e,t){var n=t.content.data;switch(t.content.type){case"userLeft":i.emit("user-left",n);break;case"message":n.context&&n.context.gameUuid&&i.emit("inGame."+n.context.gameUuid,n),i.emit("newMessage."+n.roomId,n)}}),i.sendPrivateMessage=function(t,n,i){e("sendPrivateMessage",{receiver:t,message:n},i)},i.sendPrivateMessageInGame=function(t,n,i,r){e("sendPrivateMessage",{receiver:t,context:n,message:i},r)},i.sendMessage=function(t,n,r,o){return e("sendMessage",{conversationId:t,message:n,type:r},o),Handler.tracking("message","conversation",t),i},i.getConversations=function(t){return e("getConversations",{blockedUsers:blockedUserHandler.getBlockedUsers()},t),i},i.getConversation=function(t,n){return e("getConversation",{conversationId:t},n),i},i.getConversationInGame=function(t,n,r){return e("getConversationInGame",{users:[config.user().uuid,t],gameUuid:n},r),i},i.enterConversation=function(t,r){return e("enterConversation",{conversationId:t,messages:n,blockedUsers:blockedUserHandler.getBlockedUsers()},r),i},i.getPreviousMessages=function(t,r,o,a,s){return s=s||n,e("getMessages",{conversationId:t,limit:s,refMessageId:r,refMessageTimestamp:o,blockedUsers:blockedUserHandler.getBlockedUsers()},a),i},i.setLastReadMessageTimestamp=function(t,n){return e("setLastReadMessageTimestamp",{conversationId:t,lastReadMessageTimestamp:n}),i},i.blockMessagesNotificationsForConversation=function(e){r[e]?r[e]++:r[e]=1},i.unblockMessagesNotificationsForConversation=function(e){r[e]&&(1===r[e]?delete r[e]:r[e]--)},i.blockInGameMessageNotificationsFrom=function(e){t=e},i.isConversationsDisplayed=function(e,n){var i=!!r[e],o=window.settings.getBoolean("game-chat")&&t==n;return i||o},i.deleteConversation=function(t,n){e("deleteConversation",{conversationId:t},n)},i.deleteMessage=function(t,n,i,r){e("deleteMessage",{conversationId:t,id:n,timestamp:i},r)},i.conversationListHandler=new Handler.ConversationListHandler(i),i},"undefined"==typeof Chess&&(Chess={}),Chess.defaultFen="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",Chess.colors={white:{metaData:"White",full:"white",letter:"w"},black:{metaData:"Black",full:"black",letter:"b"}},Chess.colors.both={metaData:[Chess.colors.white.metaData,Chess.colors.black.metaData],full:[Chess.colors.white.full,Chess.colors.black.full],letter:[Chess.colors.white.letter,Chess.colors.black.letter]},function(){var e={};Object.keys(Chess.colors.white).forEach(function(t){e[Chess.colors.white[t]]=Chess.colors.black[t],e[Chess.colors.black[t]]=Chess.colors.white[t]}),Chess.colors.invert=function(t){return e[t]}}(),Chess.colors.letter2full=function(e){switch(e){case Chess.colors.white.letter:return Chess.colors.white.full;case Chess.colors.black.letter:return Chess.colors.black.full}},Chess.roles={SPECTATOR:10,SPECTATOR_INVISIBLE:20,BLACK:30,WHITE:40,AUTO:50},Chess.roles.const2role=function(e){switch(parseInt(e,10)){case Chess.roles.WHITE:return"w";case Chess.roles.BLACK:return"b";case Chess.roles.SPECTATOR:return"s"}},Chess.roles.role2const=function(e){switch(e){case"w":return Chess.roles.WHITE;case"b":return Chess.roles.BLACK;case"s":return Chess.roles.SPECTATOR}},Chess.roles.roleToMeta=function(e){switch(parseInt(e,10)){case Chess.roles.WHITE:return Chess.colors.white.metaData;case Chess.roles.BLACK:return Chess.colors.black.metaData;case Chess.roles.SPECTATOR:return"Spectator"}},Chess.roles.random=function(){return Math.random()<.5?Chess.roles.WHITE:Chess.roles.BLACK},Chess.roles.inverse=function(e){return parseInt(e,10)===Chess.roles.WHITE?Chess.roles.BLACK:parseInt(e,10)===Chess.roles.BLACK?Chess.roles.WHITE:void 0},Chess.roles.isPlayer=function(e){return[Chess.roles.WHITE,Chess.roles.BLACK].contains(parseInt(e,10))},Chess.roles.isSpectator=function(e){return[Chess.roles.SPECTATOR].contains(parseInt(e,10))},Chess.elo={},Chess.elo.types={BULLET:1,BLITZ:2,CLASSICAL:3},Chess.elo.getType=function(e){var t=e.base+40*e.increment;return 180>t?Chess.elo.types.BULLET:900>t?Chess.elo.types.BLITZ:Chess.elo.types.CLASSICAL},"undefined"==typeof Chess&&(Chess={}),Chess.couchToGame=function(e){function t(t){return e.moves[t]}function n(e,t){if(t.timeUsage=e.timeUsage||0,t.timeUsageClient=e.timeUsageClient||0,void 0!==e.comment&&a.setComment(e.comment,t),void 0!==e.highlights)for(var n=0;n<e.highlights.length;n++){var i=e.highlights[n];i.square?a.addHighlight({color:i.color,square:Chess.translate.squareStringToSquare(i.square)}):i.frame?a.addHighlight({color:i.color,frame:Chess.translate.squareStringToSquare(i.frame)}):i.line?a.addHighlight({color:i.color,line:Chess.translate.canToMove(i.line)}):errorHandler.warning("unsopported highlight type during couch decoding",{highlight:i})}if(void 0!==e.glyphes&&a.setGlyphes(e.glyphes,t),void 0!==e.question&&(a.setQuestion(e.question.question,t),e.question.answers&&!Array.isArray(e.question.answers)))for(n in e.question.answers){var r=e.question.answers[n];a.getQuestion(t).addAnswer(Chess.translate.canToMove(n),r.feedback,r.correctAnswer,r.points)}}function i(){if(void 0!==o.children)for(var e=0;e<o.children.length;e++){try{var s=t(o.children[e]);a.move(s.move,void 0,!0,s.knotId);var l=a.getPositionByKnotId(s.knotId);n(s,l);var c=o;r=o.children[e],o=t(r),i(),o=c}catch(d){errorHandler.msg("critical",d,!0,{move:o.children[e]})}a.gotoParentPosition()}}var r=0,o=e.moves[r],a=new Chess.Game({ruleSet:e.ruleSet,fen:o.fen,noTimeout:!0,initialClocks:e.initialClocks,meta:e.meta}).setCheckForGameEnd(!1).setMoveMode({duringGame:{mainline:!0,sideline:!0},afterGame:{mainline:!0,sideline:!0}}).setCalcTimeSpendInThisMove(!1);return n(o,a.getStartPosition()),void 0!==e.gameStartedAt?a.gameStartedAt=e.gameStartedAt:delete a.gameStartedAt,void 0!==e.clockStartMove&&a.setClockStartMove(e.clockStartMove),i(),void 0!==e.timeGoneSinceLastMove&&(a.getEndOfMainlinePosition().moveMadeAt=Date.now()-e.timeGoneSinceLastMove),void 0!==e.endOfMainlineMoveMadeAt&&(a.getEndOfMainlinePosition().moveMadeAt=e.endOfMainlineMoveMadeAt),e.gameStatus.endedBy&&e.gameStatus.result&&a.setGameEndByPoints(e.gameStatus.result.white,e.gameStatus.result.black,e.gameStatus.endedBy),a.gotoEndOfMainline(),a},"undefined"==typeof Chess&&(Chess={}),Chess.Game=Chess.Game||function(e){var t=this;e=e||{};var n=0;Extend.Publisher(t);var i=!0,r=3,o=!0,a=e.meta||{};a.White=a.White||{},a.Black=a.Black||{};var s,l=e.noTimeout||!1,c={duringGame:{mainline:!0,sideline:!0},afterGame:{mainline:!1,sideline:!0}},d={duringGame:{mainline:!1,sideline:!0},afterGame:{mainline:!1,sideline:!0}},u=new Chess.GameStatus;t.setNoTimeout=function(e){return"boolean"!=typeof e?t:(l=e,l?clearTimeout(h):t.getClockInformation(),t)},t.getMeta=function(){return a},t.isTournamentGame=function(){var e=t.getMeta();return!!e.TournamentUUID},t.destroy=function(){t.setNoTimeout(!0).off();var e=t.getAllPositions();for(var n in e)e[n].destroy(),delete e[n];f=void 0;for(var i in t)delete t[i];t.toString=function(){return"destroyed ChessGame"}},t.setClockStartMove=function(e){return isNaN(e)||(r=parseInt(e,10)),t.getClockInformation(void 0,!0),t},t.getClockStartMove=function(){return r},t.setCalcTimeSpendInThisMove=function(e){if("boolean"==typeof e){var n=o!==e;n&&(o=e,t.getClockInformation(void 0,!0))}return t},t.getCalcTimeSpendInThisMove=function(){return o},t.getDeleteMode=function(e,n){return void 0===e&&(e=void 0===u.endedBy),void 0===n&&(n=t.isEndOfMainline()),e?n?d.duringGame.mainline:d.duringGame.sideline:n?d.afterGame.mainline:d.afterGame.sideline},t.getMoveMode=function(e,n){return void 0===e&&(e=void 0===u.endedBy),void 0===n&&(n=t.isEndOfMainline()),e?n?c.duringGame.mainline:c.duringGame.sideline:n?c.afterGame.mainline:c.afterGame.sideline},t.setMoveMode=function(e){return Object.patch(c,e),t.emit("permission.move",c),t},t.setDeleteMode=function(e){return Object.patch(d,e),t.emit("permission.delete",c),t},t.getGameStatus=function(){if(t.isOver())var e="finished";else e=0===t.getStartPosition().countChildrenMoves()?"upcoming":"running";return{result:u.result,endedBy:u.endedBy,status:e}},t.getGameStatusAsString=function(){return u.toString()},t.getListOfGameResults=function(){return u.listOfGameResults},t.getListOfGameEnds=function(){return u.listOfGameEnds},t.setGameStatus=function(e,n,i){return u.setGameEnd(e,n,i),u.result!==u.listOfGameResults.OPEN?t.setMeta("Result",u.toString()):t.setMeta("Result"),t.emit("gameStatusChanged",t.getGameStatus()),t};var h;t.checkGameHasEnded=function(e){if(t.isOver()||!e&&(!t.getCheckForGameEnd()||!t.isEndOfMainline()))return t;var n=t.getEndOfMainlinePosition();return n.isCheckMate()?"w"===n.moveRight?t.setGameStatus("BLACK_WON","CHECKMATE"):t.setGameStatus("WHITE_WON","CHECKMATE"):n.isStaleMate()?t.setGameStatus("DRAW","STALEMATE"):n.isInsufficentMaterial()?t.setGameStatus("DRAW","INSUFFICENT_MATERIAL"):n.isPositionRepetition()?t.setGameStatus("DRAW","REPETITION"):n.isActionCounterOverLimit()?t.setGameStatus("DRAW","NO_ACTION"):s.white.flagDown?n.isInsufficentMaterial("b")?t.setGameStatus("DRAW","CLOCKFLAG_VS_INSUFFICENT_MATERIAL"):t.setGameStatus("BLACK_WON","CLOCKFLAG"):s.black.flagDown?n.isInsufficentMaterial("w")?t.setGameStatus("DRAW","CLOCKFLAG_VS_INSUFFICENT_MATERIAL"):t.setGameStatus("WHITE_WON","CLOCKFLAG"):t},t.setClockInformation=function(e){return s=e,s||(s={}),s.white||(s.white={}),s.black||(s.black={}),s.white.base=parseInt(s.white.base,10)||parseInt(s.base,10)||0,s.white.incrementPerMove=parseInt(s.white.incrementPerMove,10)||parseInt(s.incrementPerMove,10)||0,s.white.flagDown=!!s.white.flagDown||!1,s.black.base=parseInt(s.black.base,10)||parseInt(s.base,10)||0,s.black.incrementPerMove=parseInt(s.black.incrementPerMove,10)||parseInt(s.incrementPerMove,10)||0,s.black.flagDown=!!s.black.flagDown||!1,t.getClockInformation(),t},t.getClockInformation=function(e,n){clearTimeout(h);var i=t.isOver();if(!n&&i)return(u.lostOnTime("white")||"CLOCKFLAG_VS_INSUFFICENT_MATERIAL"===u.endedBy&&f.endOfMainline.nextMoveIsWhite())&&(s.white.flagDown=!0,s.white.timeLeft=0),(u.lostOnTime("black")||"CLOCKFLAG_VS_INSUFFICENT_MATERIAL"===u.endedBy&&f.endOfMainline.nextMoveIsBlack())&&(s.black.flagDown=!0,s.black.timeLeft=0),t.emit("clock",s),s;if(s.white.incrementInSum=0,s.black.incrementInSum=0,s.white.usage=0,s.black.usage=0,s.runningUp=0===s.white.base&&0===s.black.base&&0===s.white.incrementPerMove&&0===s.black.incrementPerMove,t.getDepth()<r)return s.white.timeLeft=s.white.base,s.black.timeLeft=s.black.base,s;for(var a=t.getStartPosition(),c=1;r>c;c++)a=a.getChildrenMoveById(0);for(;a.childrenMoves.length;)a=a.getChildrenMoveById(0),a.isNullMove()||("b"===a.moveRight?(s.white.usage+=a.timeUsage,s.white.incrementInSum+=s.white.incrementPerMove):(s.black.usage+=a.timeUsage,s.black.incrementInSum+=s.black.incrementPerMove));if(o&&!i){for(;a.parentMove&&a.isNullMove();)a=a.parentMove;s.timeSpendInThisMove=Date.now()-a.moveMadeAt,"w"===a.moveRight?s.white.usage+=s.timeSpendInThisMove:s.black.usage+=s.timeSpendInThisMove}if(s.white.timeLeft=s.white.base+s.white.incrementInSum-s.white.usage,s.black.timeLeft=s.black.base+s.black.incrementInSum-s.black.usage,s.runningUp){if("w"===a.moveRight)var d=s.white.timeLeft;else d=s.black.timeLeft;var p=100;-21e3>d&&(p=1e3),l||(h=setTimeout(t.getClockInformation,p))}else{if("b"===a.moveRight)var m=s.white.incrementPerMove,g=0;else m=0,g=s.black.incrementPerMove;if(s.white.timeLeft<=m&&(s.white.flagDown=!0,s.white.timeLeft=0),s.black.timeLeft<=g&&(s.black.flagDown=!0,s.black.timeLeft=0),e||!s.white.flagDown&&!s.black.flagDown||t.checkGameHasEnded(),"w"===a.moveRight)var v=s.white.timeLeft;else v=s.black.timeLeft;if(v>0){var p=100;v>21e3&&(p=1e3),l||(h=setTimeout(t.getClockInformation,Math.min(p,v+10)))}}return t.emit("clock",s),s},t.getNextFreeKnotId=function(){return n++},t.updateNextFreeKnotId=function(e){return n=Math.max(n,e),t},t.getAllPositions=function(){return f.all},t.getPositionByKnotId=function(e){return f.all[e]},t.move=function(e,i,r,o,a,s){t.getClockInformation(),"string"==typeof e&&(e=Chess.translate.canToMove(e)),Chess.isMove(e)||errorHandler.critical(new Error("invalid move provided to move method"),{move:e.toString(),positionToAddMove:i&&i.toString(),moveCurrentPointer:r,assignKnotId:o});var l=t.getEndOfMainlinePosition(),d=t.getCurrentPosition();i=t.getPosition(i),void 0===r&&(r=d===i&&i.isEndOfLine());var u=!t.isOver(),h=i===l;if("remote"!==a){if(h&&(u&&!c.duringGame.mainline||!u&&!c.afterGame.mainline)){var p=Chess.getNullMove();if(u&&!c.duringGame.sideline||!i.isLegalMove(p)||!u&&!c.afterGame.sideline)return t;var m=i.move({move:p,knotId:t.getNextFreeKnotId()});f.all[m.knotId]=m,t.setLastAddedPosition(m),t.setEndOfMainlinePosition(m),h=!1}if(!t.getMoveMode(u,h))return t}if(void 0!==o){var g=!0;if(o in f.all){var v=t.getPositionByKnotId(o);(v.parentMove!==i||v.moveCoords!==e)&&errorHandler.error(new Error("the move cannot be added, because the knotId is in use"),{move:e,positionToAddMove:i,moveCurrentPointer:r,assignKnotId:o})}n=Math.max(n,o+1)}else o=t.getNextFreeKnotId();for(var y=t.getRules(),b=0;b<y.length;b++)if(y[b].move){var w=y[b].move.call(t,e,i,o);if(void 0!==w)break}var k=w instanceof Chess.Position;if(k){f.all[o]=w,t.setLastAddedPosition(w);var x=a&&"."+a||"";h?(t.emit("move.mainline.add"+x,w),t.setEndOfMainlinePosition(w)):(m&&t.emit("move.mainline.add"+x,m),t.emit("move.sideline.add"+x,w))}else if(w=i.getChildrenMoveById(w),t.setLastAddedPosition(w),g&&o!==w.knotId){var C=w.knotId;w.knotId=o,f.all[o]=f.all[C],delete f.all[C],t.emit("position.knotId",{position:w,key:"knotId",old:C,value:o})}return a&&t.setSource(a,w),r&&t.setCurrentPosition(w),k&&!s&&(t.getClockInformation(!0),t.checkGameHasEnded()),t},t.getCurrentPosition=function(){return f.current},t.setCurrentPosition=function(e){if(e!==f.current){var n;n=e.parentMove===f.current?"next":e===f.current.parentMove?"previous":e===f.start?"start":e.isEndOfLine()?"endOfLine":"jump",f.current=e,t.emit("movedPositionPointer.current."+n,e)}return t},t.getEndOfMainlinePosition=function(e){var t=f.endOfMainline;if(e)for(;t.parentMove&&t.isNullMove();)t=t.parentMove;return t},t.getLastAddedPosition=function(){return f.lastAdded},t.setEndOfMainlinePosition=function(e){return f.endOfMainline!==e&&(f.endOfMainline=e,t.emit("movedPositionPointer.endOfMainline",e)),t},t.setLastAddedPosition=function(e){return f.lastAdded=e,t},t.getStartPosition=function(){return f.start},t.setStartPosition=function(e){f.start=e,e.reRoot(),e.knotId=0,n=1,a.FEN=e.toString();var i=t.getCurrentPosition();t.emit("movedPositionPointer.start",e);do{if(i===f.start)return t;i=i.parentMove}while(void 0!==i);return t.rebuildPositionsAll(),t.setCurrentPosition(f.start),t.setEndOfMainlinePosition(f.start.getEndOfLine()),t},t.setCheckForGameEnd=function(e){return"boolean"==typeof e&&(i=e),t},t.getCheckForGameEnd=function(){return i},t.isOver=function(){return void 0!==u.endedBy},t.hasEndedWithMove=function(){return u.hasEndedWithMove()},t.getGameEndDescription=function(){return u.getGameEndDescription()},t.getGameEndDescription=function(){return u.getGameEndDescription()},e.knotId=t.getNextFreeKnotId(),Extend.Decoratable(t,{play:[Chess.Game.decorators.standardRules],analyse:[Chess.Game.decorators.nullMove,Chess.Game.decorators.standardRules],build:[Chess.Game.decorators.freeMove]},{clear:"clearRules",add:"addRule",remove:"removeRule",get:"getRules",set:"setRules",getCurrentSetName:"getCurrentRuleSet"}),t.setRules(e.ruleSet||"play"),
e.validators=t.getRules();var f={start:new Chess.Position(e),all:{}};return f.all[f.start.knotId]=f.start,f.lastAdded=f.start,f.current=f.start,f.endOfMainline=f.start,e.fen&&(a.FEN=f.start.toString()),t.gameStartedAt=Date.now(),t.setClockInformation(e.initialClocks),t},Chess.Game.prototype.getPosition=function(e){return void 0===e?e=this.getCurrentPosition():"number"==typeof e&&(e=this.getPositionByKnotId(e)),e},Chess.Game.prototype.moveLan=function(e,t,n,i,r,o){return t=this.getPosition(t),this.move(Chess.translate.lanToMove(e,t),t,n,i,r,o)},Chess.Game.prototype.moveSep=function(e,t,n,i,r,o){return t=this.getPosition(t),this.move(Chess.translate.sepToMove(e,t),t,n,i,r,o)},Chess.Game.prototype.moveSan=function(e,t,n,i,r,o){return t=this.getPosition(t),this.move(Chess.translate.sanToMove(e,t),t,n,i,r,o)},Chess.Game.prototype.moveAtEndOfMainline=function(e,t,n,i,r){return this.move(e,this.getEndOfMainlinePosition(),t,n,i,r),this},Chess.Game.prototype.getDepth=function(){return this.getStartPosition().getDepth()},Chess.Game.prototype.abortOrResign=function(e){return"w"!==e&&"b"!==e&&errorHandler.error(new Error('this method only accepts "w" or "b"')),this.getDepth()<this.getClockStartMove()?(this.setGameStatus("OPEN","ABORTED"),this):(this.setGameStatus("w"===e?"BLACK_WON":"WHITE_WON","RESIGN"),this)},Chess.Game.prototype.gotoEndOfMainline=function(){return this.setCurrentPosition(this.getEndOfMainlinePosition()),this},Chess.Game.prototype.gotoLastAddedPosition=function(){return this.setCurrentPosition(this.getLastAddedPosition()),this},Chess.Game.prototype.link=function(e,t){return e.addGame(t,this),this},Chess.Game.prototype.getGlyphes=function(e){return this.getPosition(e).getGlyphes()},Chess.Game.prototype.hasGlyph=function(e,t){return this.getGlyphes(t).contains(e)},Chess.Game.prototype.toggleGlyph=function(e,t){return this[(this.hasGlyph(e,t)?"remove":"add")+"Glyph"](e,t)},Chess.Game.prototype.addGlyph=function(e,t){return t=this.getPosition(t),t.addGlyph(e),this.emit("position.glyph"+(t===this.getCurrentPosition()?".current":""),{key:"glyphes",position:t,value:t.getGlyphes()}),this},Chess.Game.prototype.setGlyphes=function(e,t){return t=this.getPosition(t),t.setGlyphes(e),this.emit("position.glyph"+(t===this.getCurrentPosition()?".current":""),{key:"glyphes",position:t,value:t.getGlyphes()}),this},Chess.Game.prototype.removeGlyph=function(e,t){return t=this.getPosition(t),t.removeGlyph(e),this.emit("position.glyph"+(t===this.getCurrentPosition()?".current":""),{key:"glyphes",position:t,value:t.getGlyphes()}),this},Chess.Game.prototype.getChat=function(e){return this.getPosition(e).getChat()},Chess.Game.prototype.addChat=function(e,t,n,i){void 0===i&&(i=this.getEndOfMainlinePosition(!0)),i=this.getPosition(i)||this.getEndOfMainlinePosition(!0);var r=i.addChat(e,t,n);return r&&this.emit("position.chat"+(i===this.getCurrentPosition()?".current":""),{key:"chat",position:i,value:r}),r},Chess.Game.prototype.setTimeUsage=function(e,t){return t=this.getPosition(t),t.timeUsage=e,this.emit("position.timeUsage",{key:"timeUsage",position:t,value:e}),this.getClockInformation(void 0,!0),this},Chess.Game.prototype.getTimeUsage=function(e){return e=this.getPosition(e),e.timeUsage},Chess.Game.prototype.setSource=function(e,t){return t=this.getPosition(t),t.setSource(e)&&this.emit("position.source"+(t===this.getCurrentPosition()?".current":""),{key:"source",position:t,value:e}),this},Chess.Game.prototype.getEngine=function(e,t,n,i){return e=this.getPosition(e),e.getEngine(t,n,i)},Chess.Game.prototype.setComment=function(e,t){return t=this.getPosition(t),e?t.comment=e:delete t.comment,this.emit("position.comment"+(t===this.getCurrentPosition()?".current":""),{key:"comment",position:t,value:e}),this},Chess.Game.prototype.getComment=function(e){return e=this.getPosition(e),e.comment},Chess.Game.prototype.gotoStart=function(){return this.setCurrentPosition(this.getStartPosition()),this},Chess.Game.prototype.isEndOfLine=function(){return this.getCurrentPosition().isEndOfLine()},Chess.Game.prototype.isEndOfMainline=function(){return this.getCurrentPosition()===this.getEndOfMainlinePosition()},Chess.Game.prototype.gotoEndOfLine=function(e){var t=this.getCurrentPosition().getEndOfLine();if(e)for(;t.parentMove&&t.isNullMove();)t=t.parentMove;return this.setCurrentPosition(t),this},Chess.Game.prototype.getTitle=function(){var e=this.getMeta()||{Title:""};return e.Title.replace(/\{([^}]+)\}/g,function(t){return e[t.replace(/[\{\}]/g,"")]||"{"+t+"}"})},Chess.Game.prototype.getQuestion=function(e){return e=this.getPosition(e),e.getQuestion()},Chess.Game.prototype.setQuestion=function(e,t){return t=this.getPosition(t),t.setQuestion(e),this},Chess.Game.prototype.setHighlights=function(e,t,n){var i=this.getPosition(t);return i.setHighlights(e),n!==!0&&this.emit("position.highlights"+(i===this.getCurrentPosition()?".current":""),e),this},Chess.Game.prototype.getHighlights=function(e){var t=this.getPosition(e);return t.getHighlights()},Chess.Game.prototype.addHighlight=function(e,t,n){var i=this.getPosition(t);return i.addHighlight(e),n!==!0&&this.emit("position.highlights"+(i===this.getCurrentPosition()?".current":""),i.getHighlights()),this},Chess.Game.prototype.deleteHighlight=function(e,t,n){var i=this.getPosition(t);return i.deleteHighlight(e),n!==!0&&this.emit("position.highlights"+(i===this.getCurrentPosition()?".current":""),i.getHighlights()),this},Chess.Game.prototype.deleteHighlightsByType=function(e,t,n){var i=this.getPosition(t);return i.deleteHighlightsByType(e),n!==!0&&this.emit("position.highlights"+(i===this.getCurrentPosition()?".current":""),i.getHighlights()),this},Chess.Game.prototype.gotoId=function(e){var t=this.getPositionByKnotId(e);return t&&this.setCurrentPosition(t),this},Chess.Game.prototype.gotoChildrenPositionById=function(e){var t=this.getCurrentPosition().getChildrenMoveById(e);return t&&this.setCurrentPosition(t),this},Chess.Game.prototype.gotoNextPosition=function(e){for(var t=this.getCurrentPosition(),n=t.countChildrenMoves(),i=0;n>i;i++){for(var r=t.getChildrenMoveById(i);e&&r&&r.isNullMove();)r=r.getChildrenMoveById(0);if(r&&!r.isNullMove())break}return r?(this.setCurrentPosition(r),this):this},Chess.Game.prototype.countChildrenMoves=function(e){return this.getCurrentPosition().countChildrenMoves(e)},Chess.Game.prototype.gotoParentPosition=function(){var e=this.getCurrentPosition();return void 0!==e.parentMove&&this.setCurrentPosition(e.parentMove),this},Chess.Game.prototype.getMoveRight=function(){return this.getCurrentPosition().moveRight},Chess.Game.prototype.toString=function(e){return this.getCurrentPosition().toString(e)},Chess.Game.prototype.toAscii=function(){return this.getCurrentPosition().toAscii()},Chess.Game.prototype.setTimeUsageForLastAddedPosition=function(e){return this.setTimeUsage(e,this.getLastAddedPosition())},Chess.Game.prototype.disconnectTimeout=function(e,t){if("w"!==e&&"b"!==e&&errorHandler.error(new Error('this method only accepts "w" or "b"')),this.getDepth()>2){var n=Chess.colors.invert(e);if(n&&this.getEndOfMainlinePosition().isInsufficentMaterial(n))return this.setGameStatus("DRAW","DISCONNECT_VS_INSUFFICENT_MATERIAL"),this;var i="w"===e?"BLACK_WON":"WHITE_WON";return this.setGameStatus(i,"DISCONNECT_TIMEOUT"),this}return t?this:(this.setGameStatus("OPEN","ABORTED"),this)},Chess.Game.prototype.reOpen=function(){return this.setGameStatus(void 0,void 0,!0),this},Chess.Game.prototype.getType=function(){var e=this.getClockInformation(),t=Math.max(e.white.base,e.black.base)+40*Math.max(e.white.incrementPerMove,e.black.incrementPerMove);return 0===t?"Classical":18e4>t?"Bullet":9e5>t?"Blitz":"Classical"},Chess.Game.prototype.getTimeout=function(e){void 0===e&&(e=this.getDepth()<=2);var t=this.getClockInformation(),n=Math.max(t.white.base,t.black.base)+40*Math.max(t.white.incrementPerMove,t.black.incrementPerMove);return 1e3*Math.round(Math.min(12e4,Math.max(2e4,2200*Math.sqrt(n/1e3)))/1e3)},Chess.Game.prototype.rebuildPositionsAll=function(){var e=this.getStartPosition(),t=[e].concat(e.getAllChildrenInSubtree()),n=this.getAllPositions();for(var i in n)delete n[i];for(var r=0;r<t.length;r++){var o=t[r];n[o.knotId]=o}return this},Chess.Game.prototype.getSnapshot=function(e){e=e||4;for(var t=[],n=this.getEndOfMainlinePosition(),i=0;e>i&&void 0!==n;i++){var r=n.getCan();if(void 0===r)break;t.unshift(r),n=n.parentMove}var o=n&&n.toString()||this.getStartPosition().toString();return{moves:t,fen:o}},Chess.Game.prototype.setMeta=function(e,t){if("string"==typeof e){var n=e;e={},e[n]=t}var i=this.getMeta();return Object.patch(i,e),this.emit("meta",{meta:i,diff:e}),this},Chess.Game.prototype.setGameEndByPoints=function(e,t,n,i){var r=this.getListOfGameResults();if(e===r.DRAW.white&&t===r.DRAW.black)var o="DRAW";else o=e===r.WHITE_WON.white&&t===r.WHITE_WON.black?"WHITE_WON":e===r.BLACK_WON.white&&t===r.BLACK_WON.black?"BLACK_WON":"OPEN";return this.setGameStatus(o,n,i)},Chess.Game.prototype.promote=function(e){return e=this.getPosition(e),e.promote(),this.setEndOfMainlinePosition(this.getStartPosition().getEndOfLine()),this.emit("move.promote",e),this},Chess.Game.prototype.deleteMove=function(e,t){if(!t&&!this.getDeleteMode())return this;e=this.getPosition(e);var n=e.getAllChildrenInSubtree();n.push(e);var i=n.contains(this.getCurrentPosition()),r=n.contains(this.getLastAddedPosition()),o=e.isInMainline(),a=e.deleteMove();if(!a)return this;var s=e.parentMove.childrenMoves;if(1===s.length){var l=s[0];l.moveCoords.isNullMove()&&this.deleteMove(l,!0)}if(a===!1)return this;for(var c=0;c<n.length;c++)delete this.getAllPositions()[n[c].knotId];return i&&this.setCurrentPosition(a),o&&this.setEndOfMainlinePosition(this.getStartPosition().getEndOfLine()),r&&this.setLastAddedPosition(this.getEndOfMainlinePosition()),this.emit("move."+(o?"main":"side")+"line.delete",e),this},Chess.Game.prototype.getDistanceToStartPosition=function(e){e=this.getPosition(e);for(var t=this.getStartPosition(),n=0;e&&e!==t;)n++,e=e.parentMove;return n},Chess.Game.validators={nullMove:function(e){return e.isNullMove()||void 0},standardRules:function(e){return this.checkMove(e)||void 0},freeMove:function(){return!0}},Chess.Game.decorators={nullMove:{moveValidator:Chess.Game.validators.nullMove},standardRules:{moveValidator:Chess.Game.validators.standardRules,move:function(e,t,n){return t.move({move:e,knotId:n})}},freeMove:{moveValidator:Chess.Game.validators.freeMove,move:function(e,t){t.setPiece(e.y2,e.x2,t.getPiece(e.y1,e.x1)),t.setPiece(e.y1,e.x1,"-");var n=new Chess.Position({fen:t.toString(!0),validators:this.getRules()});return n.setHighlights(t.getHighlights()),this.setStartPosition(n),this.gotoStart(),n}}},"undefined"==typeof Chess&&(Chess={}),Chess.chessGameDiff=function(e,t){function n(e,t){function n(e,t,n){void 0===n&&(n=[]),n.push("comment","timeUsage","getGlyphes()","getHighlights()");for(var i={},o={},a={},s={},l=0;l<n.length;l++)if("getGlyphes()"===n[l]){var c=e.getGlyphes(),d=t.getGlyphes();c.compare(d)||(s.glyphes=d)}else if("getHighlights()"===n[l]){var c=e.getHighlights(),d=t.getHighlights(),u=Object.diff(c,d);u&&Object.getLength(u)&&(s.highlights=d)}else o[n[l]]=e[n[l]],a[n[l]]=t[n[l]];i=Object.diff(o,a);for(var h in s)i[h]=s[h];Object.keys(i).length&&(e.knotId!==t.knotId&&errorHandler.msg("error",new Error("knotIds for old and new positions are not the same"),!0,{oldPositionKnotId:e.knotId,newPositionKnotId:t.knotId,oldPositionMove:e.getCan(),newPositionMove:t.getCan()}),i.knotId=e.knotId,r.push({command:"updateMove",data:i}))}function i(e,t){var o=[];if(void 0!==e)for(var a=0;a+o.length<e.childrenMoves.length;a++){var s=e.childrenMoves[a+o.length];if(t)var l=t.childrenMoves[a];void 0===l||s.getCan()!==l.getCan()?(r.push({command:"removeMove",data:{knotId:s.knotId}}),o.push(a--)):n(s,l)}if(s=void 0,l=void 0,void 0!==t)for(var a=0;a<t.childrenMoves.length;a++){for(var c=0,d=0;d<o.length;d++)o[d]<=a&&c++;if(e)var s=e.childrenMoves[a+c];var l=t.childrenMoves[a];if(void 0===s){var u=l.getGlyphes(),h={command:"addMove",data:Object.removeUndefined({parentId:t.knotId,move:l.getCan(),knotId:l.knotId,comment:l.comment,glyphes:u.length?u:void 0,mainline:l.isInMainline()?!0:void 0,timeUsage:l.timeUsage})};r.push(h)}i(s,l)}}var r=[],o=e.getStartPosition(),a=t.getStartPosition();return n(o,a),i(o,a),r}function i(e){return{result:e.result,endedBy:e.endedBy}}function r(e,t){function n(e,t){t.knotId=e.knotId;for(var i=e.countChildrenMoves(),r=0;i>r;r++){var o=e.getChildrenMoveById(r),a=t.getChildrenMoveByMove(o.moveCoords);a!==!1&&n(o,a)}}var i=e.getStartPosition(),r=t.getStartPosition();n(i,r),t.rebuildPositionsAll()}function o(e,t){var n=Object.diff(e,t);return 1===Object.keys(n).length&&void 0!==n.Result?{}:n}var a=[];if(void 0===t)a.push({command:"removeGame"});else if(void 0===e)a.push({command:"addGame",data:Chess.gameToCouch(t,["timeGoneSinceLastMove","fen"])});else{r(e,t),e.getStartPosition().toString()!==t.getStartPosition().toString()&&(a.push({command:"rebuildGame",data:t.getStartPosition().toString()}),e=new Chess.Game({fen:t.getStartPosition().toString()}));var s=o(e.getMeta(),t.getMeta());Object.keys(s).length&&a.push({command:"metaChanged",data:s});var l=Object.diff(i(e.getGameStatus()),i(t.getGameStatus()));Object.keys(l).length&&a.push({command:"resultChanged",data:l});var c=n(e,t);Object.keys(c).length&&a.pushArray(c)}return a},"undefined"==typeof Chess&&(Chess={}),Chess.GameHandler=function(){function e(e,t){var r=t.oldGame,o=t.newGame,a=i.getKeyForGame(r);if(a===n)var s=!0;i.addGame(a,o),s&&i.setCurrentGame(a)}function t(e,t){i.emit(e.channel,t)}var n,i=this,r={};return Extend.Publisher(i),i.getCurrentGame=function(){return void 0===n&&0===Object.keys(r).length&&i.addGame(void 0,new Chess.Game),i.getGame(n)},i.hasGame=function(e){return void 0!==r[e]&&r[e]instanceof Chess.Game},i.getGame=function(e){return r[e]},i.getGameKeys=function(){return Object.keys(r)},i.getCurrentGameKey=function(){return n},i.addGame=function(t,n){return void 0===t?t="default":"number"==typeof t&&(t=t.toString()),t in r&&i.removeGame(t),r[t]=n,n.on("replaceChessGame",e),1===Object.keys(r).length&&i.setCurrentGame(t),i},i.removeGame=function(o){return o instanceof Chess.Game&&(o=i.getKeyForGame(o)),"number"==typeof o&&(o=o.toString()),"string"!=typeof o&&errorHandler.msg("warning",new Error("The chessGame you want to remove, can't be found"),!0,{removeGame:o}),void 0!==r[o]&&(r[o].off("*",t),r[o].off("replaceChessGame",e),delete r[o],o===n&&(n=void 0)),i},i.getKeyForGame=function(e){for(var t in r)if(r[t]===e)return t},i.setCurrentGame=function(e){return e instanceof Chess.Game&&(e=i.getKeyForGame(e)),"number"==typeof e&&(e=e.toString()),e===n?i:(("string"!=typeof e||void 0===r[e])&&errorHandler.msg("warning",new Error("The chessGame you want to set current, can't be found"),!0,{oldKey:n,newKey:e}),void 0!==r[n]&&r[n].off("*",t),n=e.toString(),r[n].on("*",t),i.emit("currentGameChanged",r[n]),i)},i},function(){for(var e=["abortOrResign","addGlyph","addChat","addHighlight","addRule","checkGameHasEnded","clearRules","countChildrenMoves","deleteHighlight","deleteHighlightsByType","deleteMove","disconnectTimeout","draw","getAllPositions","getCalcTimeSpendInThisMove","getCheckForGameEnd","getClockInformation","getClockStartMove","getClockStartMove","getChat","getComment","getCurrentPosition","getCurrentRuleSet","getDeleteMode","getDepth","getEndOfMainlinePosition","getEngine","getGameEndDescription","getGameStatus","getGameStatusAsString","getGlyphes","getHighlights","getLastAddedPosition","getListOfGameEnds","getListOfGameResults","getMeta","getMoveMode","getMoveRight","getNextFreeKnotId","getPositionByKnotId","getQuestion","getStartPosition","getRules","getTimeout","getTitle","getType","gotoChildrenPositionById","gotoEndOfLine","gotoEndOfMainline","gotoId","gotoLastAddedPosition","gotoNextPosition","gotoParentPosition","gotoStart","hasGlyph","isEndOfLine","isEndOfMainline","isOver","move","moveAtEndOfMainline","moveLan","moveSan","moveSep","promote","removeGlyph","reOpen","setCalcTimeSpendInThisMove","setCheckForGameEnd","setClockStartMove","setComment","setCurrentPosition","setGameEndByPoints","setGameStatus","setGlyphes","setHighlights","setMeta","removeRule","setDeleteMode","setMoveMode","setQuestion","setRules","setStartPosition","setTimeUsage","setTimeUsageForLastAddedPosition","toAscii","toggleGlyph","toString","updateNextFreeKnotId"],t=0;t<e.length;t++)!function(e){Chess.GameHandler.prototype[e]=function(){var t=this.getCurrentGame(),n=t[e].apply(t,arguments);return n===t?this:n}}(e[t])}(),"undefined"==typeof Chess&&(Chess={}),Chess.gamePatch=function(e,t){function n(t,n){switch(t){case"metaChanged":e.setMeta(n);break;case"resultChanged":var i=n.endedBy;null===i&&(i=void 0),e.setGameEndByPoints(n.result.white,n.result.black,i,!0);break;case"removeGame":break;case"addGame":break;case"addMove":e.move(n.move,n.parentId,void 0,n.knotId,"remote",!0),void 0!==n.timeUsage&&e.setTimeUsage(n.timeUsage,n.knotId),void 0!==n.comment&&e.setComment(n.comment,n.knotId),!e.getCalcTimeSpendInThisMove()&&e.getStartPosition().countChildrenMoves()>0&&e.setCalcTimeSpendInThisMove(!0).getClockInformation();for(var r=e.getLastAddedPosition();n.mainline&&!r.isInMainline();)e.promote(r);for(var o=r.parentMove.childrenMoves,a=o.length-1;a>=0;a--){var s=o[a];s.moveCoords.isNullMove()&&e.deleteMove(s,!0)}if(r.countChildrenMoves()>0){var l=e.getNextFreeKnotId();e.move(Chess.getMove(0,0,0,0),r,void 0,l,"remote",!0),e.promote(l)}break;case"rebuildGame":e.setStartPosition(new Chess.Position({fen:n}));break;case"updateMove":void 0!==n.glyphes&&e.setGlyphes(n.glyphes,n.knotId),void 0!==n.comment&&(null===n.comment?e.setComment(void 0,n.knotId):e.setComment(n.comment,n.knotId)),void 0!==n.highlights&&(n.highlights.forEach(function(e){e.frame&&(e.frame=Chess.getSquare(e.frame.y,e.frame.x)),e.square?e.square=Chess.getSquare(e.square.y,e.square.y):e.line&&(e.line=Chess.getMove(e.line.y1,e.line.x1,e.line.y2,e.line.x2))}),e.setHighlights(n.highlights,n.knotId)),void 0!==n.timeUsage&&e.setTimeUsage(n.timeUsage,n.knotId);break;case"removeMove":e.deleteMove(n.knotId,!0),0===e.getStartPosition().countChildrenMoves()&&e.setCalcTimeSpendInThisMove(!1)}}for(var i=0;i<t.length;i++){var r=t[i].command,o=t[i].data;n(r,o)}},"undefined"==typeof Chess&&(Chess={}),Chess.GameStatus=function(e,t){return this.setGameEnd(e,t,!0),this},Chess.GameStatus.prototype.setGameEnd=function(e,t,n){return(void 0!==t&&!this.listOfGameEnds.contains(t)||void 0!==e&&!Object.has(this.listOfGameResults,e))&&errorHandler.msg("critical",new Error("illegal game end"),!0,{triedGameEnd:t,result:e}),(n||!this.result||this.result===this.listOfGameResults.OPEN)&&(e?this.result=this.listOfGameResults[e]:this.result=this.listOfGameResults.OPEN),e&&!t&&(t=Chess.GameStatus.defaultEndedBy[e]),(n||!this.endedBy)&&(this.endedBy=t),this},Chess.GameStatus.prototype.toString=function(){return Chess.GameStatus.resultToString(this.result).replace("1/2-1/2","½-½")},Chess.GameStatus.prototype.lostOnTime=function(e){return this.listOfClockGameEnds.contains(this.endedBy)&&(0===this.result.black&&"black"===e||0===this.result.white&&"white"===e)?!0:!1},Chess.GameStatus.prototype.hasEndedWithMove=function(){return this.listOfEndedWithMoveGameEnds.contains(this.endedBy)},Chess.GameStatus.defaultEndedBy={WHITE_WON:"RESIGN",BLACK_WON:"RESIGN",DRAW:"DRAW_AGREED"},Chess.GameStatus.defaultEndedBy["1-0"]=Chess.GameStatus.defaultEndedBy.WHITE_WON,Chess.GameStatus.defaultEndedBy["1/2-1/2"]=Chess.GameStatus.defaultEndedBy.DRAW,Chess.GameStatus.defaultEndedBy["0-1"]=Chess.GameStatus.defaultEndedBy.BLACK_WON,Chess.GameStatus.listOfGameResults=Chess.GameStatus.prototype.listOfGameResults={WHITE_WON:{white:1,black:0},BLACK_WON:{white:0,black:1},DRAW:{white:.5,black:.5},OPEN:{white:void 0,black:void 0}},Chess.GameStatus.listOfGameResults["1-0"]=Chess.GameStatus.listOfGameResults.WHITE_WON,Chess.GameStatus.listOfGameResults["1/2-1/2"]=Chess.GameStatus.listOfGameResults.DRAW,Chess.GameStatus.listOfGameResults["0-1"]=Chess.GameStatus.listOfGameResults.BLACK_WON,Chess.GameStatus.listOfGameResults["*"]=Chess.GameStatus.listOfGameResults.OPEN,Chess.GameStatus.gameEndDescriptions={CHECKMATE:"Checkmate",RESIGN:"Ended by resign",CLOCKFLAG:"Clockflag",CLOCKFLAG_VS_INSUFFICENT_MATERIAL:"Clockflag vs. insufficent material",DRAW_AGREED:"Draw agreed",INSUFFICENT_MATERIAL:"Insufficent material",REPETITION:"Position repeated 3 times",NO_ACTION:"No pawn moves or no capture in 50 moves",STALEMATE:"Stalemate",BOTH_FLAGS_DOWN:"Clockflag for both players",ABORTED:"Game aborted",DISCONNECT_TIMEOUT:"One player failed to reconnect on time",TOURNAMENT_NO_SHOW:"Player failed to start on time",TOURNAMENT_WITHDRAW:"Player left the tournament",TOURNAMENT_BYE:"Player was given a bye"},Chess.GameStatus.prototype.getGameEndDescription=function(){return Chess.GameStatus.gameEndDescriptions[this.endedBy]},Chess.GameStatus.prototype.listOfClockGameEnds=["CLOCKFLAG","CLOCKFLAG_VS_INSUFFICENT_MATERIAL","BOTH_FLAGS_DOWN"],Chess.GameStatus.prototype.listOfEndedWithMoveGameEnds=["CHECKMATE","INSUFFICENT_MATERIAL","REPETITION","NO_ACTION","STALEMATE"],Chess.GameStatus.prototype.listOfGameEnds=["CHECKMATE","RESIGN","CLOCKFLAG","CLOCKFLAG_VS_INSUFFICENT_MATERIAL","DISCONNECT_VS_INSUFFICENT_MATERIAL","DRAW_AGREED","INSUFFICENT_MATERIAL","REPETITION","NO_ACTION","STALEMATE","BOTH_FLAGS_DOWN","ABORTED","DISCONNECT_TIMEOUT","TOURNAMENT_WITHDRAW","TOURNAMENT_NO_SHOW","TOURNAMENT_BYE"],Chess.GameStatus.resultToString=function(e){return!e||e.white===Chess.GameStatus.listOfGameResults.OPEN.white&&e.black===Chess.GameStatus.listOfGameResults.OPEN.black?"*":parseFloat(e.white)===Chess.GameStatus.listOfGameResults.DRAW.white&&parseFloat(e.black)===Chess.GameStatus.listOfGameResults.DRAW.black?"1/2-1/2":parseInt(e.white,10)===Chess.GameStatus.listOfGameResults.WHITE_WON.white&&parseInt(e.black,10)===Chess.GameStatus.listOfGameResults.WHITE_WON.black?"1-0":parseInt(e.white,10)===Chess.GameStatus.listOfGameResults.BLACK_WON.white&&parseInt(e.black,10)===Chess.GameStatus.listOfGameResults.BLACK_WON.black?"0-1":void 0},Chess.GameStatus.stringToResult=function(e){return Chess.GameStatus.listOfGameResults[e]},"undefined"==typeof Chess&&(Chess={}),Chess.gameToContent=function(e){function t(e){var t=e.getSan(),n=e.knotId,i=e.getGlyphes(),r=e.getDistanceToMainline(),o=e.comment||"";return o.length&&(o+=" "),0===i.length&&(i=[0]),"[["+n+"]["+t+"]["+i.join(" ")+"]["+r+"]] "+o}function n(o){var a="";e.setCurrentPosition(o);var s=e.countChildrenMoves();if(0===s)return a;var l="",c="";if("w"===o.moveRight?l=o.moveCounter+". ":c=o.moveCounter+"... ",r&&(a+=c),a+=l+t(o.getChildrenMoveById(0)),r=!1,s>1)for(var d=1;s>d;d++){var u=i.openSideline+c+l+t(o.getChildrenMoveById(d))+n(o.getChildrenMoveById(d));a=a.replace(/^  */,"").replace(/  *$/,"")+u.replace(/^  */,"").replace(/  *$/,"")+i.closeSideline+" ",r=!0}return a+n(o.getChildrenMoveById(0))}e instanceof Chess.Game||errorHandler.msg("critical",new Error('Chess.gameToCouch: required parameter "chessGame" is missing or not an object'),!0,{chessGame:e});var i={openSideline:"\n",closeSideline:"\n"},r=!0,o=e.getStartPosition().comment;return void 0===o?o="":o+=" ",(o+n(e.getStartPosition())).replace(/^  */,"").replace(/  *$/,"")},"undefined"==typeof Chess&&(Chess={}),Chess.gameToCouch=function(e,t){function n(e){var t=a.indexOf(e);return a.contains(e)?t:a.push(e)-1}function i(a){var s={};n(a.knotId);var l=a.getCan();void 0!==l&&(t.contains("move")||(s.move=l),t.contains("timeUsage")||(s.timeUsage=a.timeUsage),t.contains("timeUsageClient")||(s.timeUsageClient=a.timeUsageClient)),(!t.contains("fen")||o===a&&a.toString()!==Chess.defaultFen)&&(s.fen=a.toString()),void 0===a.comment||t.contains("comment")||(s.comment=a.comment);var c=e.getHighlights(a);if(void 0!==c&&c.length&&!t.contains("highlights")){s.highlights=[];for(var d=0;d<c.length;d++){var u=c[d];u.temporary||(u.square?s.highlights.push({color:u.color,frame:u.square.toString()}):u.frame?s.highlights.push({color:u.color,frame:u.frame.toString()}):u.line?s.highlights.push({color:u.color,line:u.line.toString()}):errorHandler.warning("unsopported highlight type during couch encoding",{highlight:u}))}0==s.highlights.length&&delete s.highlights}if(!t.contains("glyphes")&&a.hasGlyphes()&&(s.glyphes=a.getGlyphes()),void 0===a.question||t.contains("question")||(s.question={question:a.question.question,answers:a.question.getAnswer()}),t.contains("knotId")||(s.knotId=a.knotId),r.moves.push(s),!t.contains("childrenMoves")&&a.childrenMoves.length){s.children=[];for(var d=0;d<a.childrenMoves.length;d++)s.children.push(n(a.childrenMoves[d].knotId)),i(a.childrenMoves[d])}return r}var r={};e instanceof Chess.Game||errorHandler.msg("critical",new Error('Chess.gameToCouch: required parameter "chessGame" is missing or not an object'),!0,{chessGame:e}),t||(t=[]);var o=e.getStartPosition(),a=[],s=e.getGameStatus();r.gameStatus=s,r.ruleSet=e.getCurrentRuleSet(),r.meta=e.getMeta(),r.clockStartMove=e.getClockStartMove(),t.contains("gameStartedAt")||(r.gameStartedAt=e.gameStartedAt),t.contains("endOfMainlineMoveMadeAt")||(r.endOfMainlineMoveMadeAt=e.getEndOfMainlinePosition().moveMadeAt),s.result!==e.getListOfGameResults().OPEN||t.contains("timeGoneSinceLastMove")||(r.timeGoneSinceLastMove=Date.now()-e.getEndOfMainlinePosition().moveMadeAt);var l=e.getClockInformation();return(l.white.base||l.white.incrementPerMove||l.black.base||l.black.incrementPerMove)&&(r.initialClocks={white:{base:l.white.base,incrementPerMove:l.white.incrementPerMove},black:{base:l.black.base,incrementPerMove:l.black.incrementPerMove}}),r.moves=[],i(o),Object.copy(r)},"undefined"==typeof Chess&&(Chess={}),function(){function e(e){for(var t,n=e.split(" "),i="",r="";t=n.shift();)i.length+t.length<=80?i+=(i.length?" ":"")+t:(r+=i+"\n",i=t);return r+i}Chess.gameToPgn=function(t,n,i){function r(e){for(var n=e,i=e.timeUsage||0,r=t.getClockInformation()["w"===e.moveRight?"white":"black"],o=r.incrementPerMove||0;(n=n.parentMove)&&(n=n.parentMove)&&t.getDistanceToStartPosition(n)>=h;)i+=n.timeUsage||0,o+=r.incrementPerMove;var a=r.base-i+o;if(a>=0){var s=Date.getSplitedTime(a);return"[%clk "+s.hours+":"+s.minutes.toString().lpad("0",2)+":"+s.seconds.toString().lpad("0",2)+"]"}return""}function o(e){for(var i=e.getSan(),o=e.getGlyphes(),a="",s=0;s<o.length;s++)a+="$"+o[s]+" ";if(void 0===e.comment)var l="";else l=e.comment;return n&&e.isInMainline()&&t.getDistanceToStartPosition(e)>=h&&(l+=r(e)),l.length&&(l="{"+l+"} "),i+" "+a+l}function a(e){var n="";t.setCurrentPosition(e);var i=t.countChildrenMoves();if(0===i)return n;var r="",s="";if("w"===e.moveRight?r=e.moveCounter+". ":s=e.moveCounter+"... ",c&&(n+=s),n+=r+o(e.getChildrenMoveById(0)),c=!1,i>1)for(var d=1;i>d;d++){var u=l.openSideline+s+r+o(e.getChildrenMoveById(d))+a(e.getChildrenMoveById(d));n=n.replace(/^  */,"").replace(/  *$/,"")+" "+u.replace(/^  */,"").replace(/  *$/,"")+l.closeSideline+" ",c=!0}return n+a(e.getChildrenMoveById(0))}function s(e){var t=e.toLowerCase(),n=e;return"fen"===t&&(n="FEN"),"FEN"===n&&p[e]===Chess.defaultFen?"":"["+n+' "'+p[e]+'"]\n'}t instanceof Chess.Game||errorHandler.msg("critical",new Error('Chess.gameToPgn: required parameter "chessGame" is missing or not an object'),!0,{chessGame:t});var l={openSideline:"(",closeSideline:")"};i=i||[];for(var c=!0,d="",u=t.getMeta(),h=t.getClockStartMove(),f=["White","Black"],p=Object.without(u,f),m=0;m<f.length;m++)for(var g in u[f[m]])"Name"===g?p[f[m]]=u[f[m]][g]:p[f[m]+g]=u[f[m]][g];var v=t.getGameStatusAsString().replace("½-½","1/2-1/2");p.Result=v;var y={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?"};for(var b in y)void 0===p[b]&&(p[b]=y[b]);for(var w=["Event","Site","Date","Round","White","Black","Result"],g=0;g<w.length;g++)b=w[g],void 0!==p[b]&&(d+=s(b),delete p[b]);for(b in p)p[b]&&!i.contains(b)&&(d+=s(b));d+="\n";var k=t.getStartPosition().comment;return k=void 0===k?"":"{"+k+"} ",d+k+e(a(t.getStartPosition())+v).replace(/^  */,"").replace(/  *$/,"")}}(),"undefined"==typeof Chess&&(Chess={}),function(){function e(){return{move:{1:{symbol:"!",title:"good move"},3:{symbol:"!!",title:"very good move"},5:{symbol:"!?",title:"speculative move"},2:{symbol:"?",title:"poor move"},4:{symbol:"??",title:"very poor move"},6:{symbol:"?!",title:"questionable move"}},position:{14:{symbol:"⩲",title:"White has a slight advantage"},16:{symbol:"±",title:"White has a moderate advantage"},18:{symbol:"+-",title:"White has a decisive advantage"},15:{symbol:"⩱",title:"Black has a slight advantage"},17:{symbol:"∓",title:"Black has a moderate advantage"},19:{symbol:"-+",title:"Black has a decisive advantage"},11:{symbol:"=",title:"Equal position"},13:{symbol:"∞",title:"Unclear position"},44:{symbol:"=/∞",title:"With compensation"}},other:{146:{symbol:"N",title:"New Move"},138:{symbol:"⊕",title:"Time trouble"},36:{symbol:"↑",title:"Initiative"},40:{symbol:"→",title:"Attack"},32:{symbol:"↑↑",title:"Development advantage"},132:{symbol:"⇄",title:"Counterplay"},22:{symbol:"⊙",title:"Zugzwang"},8:{symbol:"□",title:"Singular move"}}}}function t(){return Object.merge.apply(void 0,Object.values(Chess.Glyphes.getByCategory()))}Chess.Glyphes={};var n,i,r={move:!0,position:!0,other:!1};Chess.Glyphes.getSymbolById=function(e){return i||(i=t()),i[e]&&i[e].symbol||""},Chess.Glyphes.getByCategory=function(){return n||(n=e())},Chess.Glyphes.isSinleItemCategory=function(e){return r[e]}}(),"undefined"==typeof Chess&&(Chess={}),function(){var e=/[1-8]{2}/,t=/^[prnbqkPRNBQK-]{8}$/,n=/^(w|b)$/,i=/^(KQ?k?q?|Qk?q?|kq?|q|-)$/,r=/^(-|[a-h][36])$/;Chess.isFen=function(o){try{var a=o.split(" ");if(6!==a.length)throw new Error('Illegal FEN / Wrong count of FEN blocks "'+o+'"');if(e.test(a[0]))throw new Error('Illegal FEN / Two digits next to each other "'+o+'"');var s=Chess.translate.shortToLongPositionGroup(a[0]).split("/");if(8!==s.length)throw new Error('Illegal FEN / Wrong count of position blocks "'+o+'"');for(var l=0;l<s.length;l++){if(8!==s[l].length)throw new Error('Illegal FEN / block is numeric  "'+o+'"');if(!t.test(s[l]))throw new Error('Illegal FEN / illegal piece "'+s[l]+'" in "'+o+'"')}if(!n.test(a[1]))throw new Error('Illegal FEN / illegal MoveRight "'+a[1]+'" in "'+o+'"');if(!i.test(a[2]))throw new Error('Illegal FEN / illegal CastlingRights "'+a[2]+'" in "'+o+'"');if(!r.test(a[3]))throw new Error('Illegal FEN / illegal EP Information "'+a[3]+'" in "'+o+'"');if(isNaN(a[4])||parseInt(a[4],10)<0)throw new Error('Illegal FEN / illegal ActionCounter "'+a[4]+'" in "'+o+'"');if(isNaN(a[5])||parseInt(a[5],10)<=0)throw new Error('Illegal FEN / illegal MoveCounter "'+a[5]+'" in "'+o+'"')}catch(c){return{valid:!1,error:c.message}}return{valid:!0}},Chess.isValidFen=function(e){return Chess.isFen(e).valid}}(),function(){function e(e,t,n,i,r,o){var a=this;return a.y1=parseInt(e,10),a.x1=parseInt(t,10),a.x2=parseInt(i,10),a.y2=parseInt(n,10),a.promotion=r,(isNaN(a.y1)||isNaN(a.x1)||isNaN(a.x2)||isNaN(a.y2))&&errorHandler.msg("critical",new Error("Illegal parameter in position Constructor"),!0,{y1:e,x1:t,y2:n,x2:i,promotion:r}),a.can=o,a}"undefined"==typeof Chess&&(Chess={});var t=[];Chess.getNullMove=function(){return Chess.getMove(0,0,0,0)},Chess.getMove=function(n,i,r,o,a){a=a&&a.toLowerCase();var s=Chess.translate.coordinatesToCan(n,i,r,o,a);return t[s]||(t[s]=new e(n,i,r,o,a,s))},Chess.isMove=function(t){return t instanceof e},e.prototype.isOnBoard=function(){return this.onBoard},Object.defineProperty(e.prototype,"onBoard",{get:function(){var e=this.y1>=0&&this.y1<=7&&this.x1>=0&&this.x1<=7&&this.y2>=0&&this.y2<=7&&this.x2>=0&&this.x2<=7;return Object.defineProperty(this,"onBoard",{value:e}),e}}),e.prototype.toString=function(){return this.can},Object.defineProperty(e.prototype,"endSquare",{get:function(){var e=Chess.getSquare(this.y2,this.x2);return Object.defineProperty(this,"endSquare",{value:e}),e}}),Object.defineProperty(e.prototype,"startSquare",{
get:function(){var e=Chess.getSquare(this.y1,this.x1);return Object.defineProperty(this,"startSquare",{value:e}),e}}),e.prototype.changePromotion=function(e){return Chess.getMove(this.y1,this.x1,this.y2,this.x2,e)},e.prototype.isNullMove=function(){return this===Chess.getNullMove()}}(),function(){function e(e){var t=e.split("."),n=t[0],i="??"===t[1]?1:t[1],r="??"===t[2]?1:t[2];return new Date(n,i-1,r).getTime()}function t(e){for(var t={White:{},Black:{}},n=e.split(d),i=0;i<n.length;i++)if("["===n[i].substring(0,1)&&'"]'===n[i].substring(n[i].length-2)){n[i]=n[i].substring(1,n[i].length-2);var r=n[i].split('"'),o=r[0].trim(),a=r[1].trim();if("fen"===o.toLowerCase()&&(o="FEN"),"Date"===o&&!T.test(a)){errorHandler.notice("skipped invalid meta date",{value:a});continue}if("White"===o){o="WhiteName";var s=a.match(f);a=a.replace(f,"").trim()}"Black"===o&&(o="BlackName",a=a.replace(f,"").trim());var l=o.substring(0,5),c="White"===l||"Black"===l;if(c){var u=o.substring(5);/^elo$/i.test(u)?(u="Elo",a=parseInt(a,10),isNaN(a)||(t[l][u]=a)):t[l][u]=a}else if("Round"===o)if(a.contains(".")){var h=parseInt(a.split(".")[0]),p=a.split(".")[1];isNaN(h)||(t.Round=h)}else isNaN(a)?j.test(a)&&(t.Round=parseInt(a.match(j)[0],10)):t.Round=parseInt(a,10);else"Board"===o?(a.contains(".")&&(a=a.split(".").last()),isNaN(a)||(t[o]=parseInt(a,10))):t[o]=a}return void 0===t.Board&&(s&&!isNaN(s)?t.Board=parseInt(s,10):p&&!isNaN(p)&&(t.Board=parseInt(p,10))),t}function n(e,t,n){for(var i=0,r=36e5;t.length;){var o=t.shift();i+=o*r,r/=60}e.setTimeUsageForLastAddedPosition(-1*i+n)}function i(e,t){for(var n=t.split(","),i=n.length,r=0;i>r;r++){var o=n[r],a=S[o[0]];if(a){var s=o.substr(1,2),l={color:a,frame:Chess.translate.squareStringToSquare(s)};e.addHighlight(l,void 0)}}}function r(e,t){for(var n=t.split(","),i=n.length,r=0;i>r;r++){var o=n[r],a=S[o[0]];if(a){var s=o.substr(1,4),l={color:a,line:Chess.translate.canToMove(s)};e.addHighlight(l,void 0)}}}function o(e,t){if(k.test(t)){var i="w"===e.getCurrentPosition().parentMove.moveRight?"white":"black";n(e,t.trim().replace(/\./g,":").split(":"),e.getClockInformation()[i].timeLeft)}}function a(e,t){if(x.test(t)){var n=t.split("."),i=1e3*parseInt(n[0],10)+(parseInt(n[1],10)||0);e.setTimeUsageForLastAddedPosition(i)}}function s(e,t){var n=e.getCurrentPosition();try{for(var i=t.split(","),r=0;r<i.length;)'"'===i[r].trim()[0]&&'"'!==i[r].trim()[i[r].trim().length-1]?(i[r]+=","+i[r+1],i.remove(r+1)):r++;var o=(i.length-3)/3;o!==Math.floor(o)&&errorHandler.msg("warning",new Error("wrong number of elements in quiz"),!0,{numberOfAnswers:o,quizInformation:i});var a=i[0].trim();'"'===a[0]&&'"'===a[a.length-1]?a=a.substr(1,a.length-2).trim():errorHandler.msg("warning",new Error("quiz questions isn't double quoted"),!0,{question:a}),e.setQuestion(a);for(var s=3;3+3*o>s;s+=3){var l=i[s].trim();try{e.moveSan(l,void 0,!0,void 0,void 0,!0).setTimeUsageForLastAddedPosition(0);var c=e.getCurrentPosition().moveCoords;e.gotoParentPosition()}catch(d){errorHandler.msg("warning",new Error("the move given in the quiz is not a valid move"),!0,{move:l,moveError:d.message})}var u=i[s+1].trim();'"'===u[0]&&'"'===u[u.length-1]?u=u.substr(1,u.length-2).trim():errorHandler.msg("warning",new Error("quiz feedback isn't double quoted"),!0,{feedback:u});var h=parseInt(i[s+2].trim(),10);if(isNaN(h)&&errorHandler.msg("warning",new Error("points in quit is not a number"),!0,{feedback:u,points:h}),e.getCurrentPosition().getChildrenMoveById(0).moveCoords===c)var f=!0;else f=!1;e.getQuestion().addAnswer(c,u,f,h)}}catch(d){}e.setCurrentPosition(n)}function l(e,t){for(var l,c,d,u,h,f=/\[%(.+?) (.+?)\]/g,m=t;l=f.exec(t);){h=!0,c=l[0],d=l[1],u=l[2];try{switch(d){case"clk":o(e,u);break;case"emt":a(e,u);break;case"tqu":s(e,u);break;case"csl":i(e,u);break;case"cal":r(e,u);break;default:h=!1,errorHandler.notice("found unknown command during pgn parsing: "+c,{meta:e.getMeta(),comment:t,currentPosition:e.toString()})}}catch(g){}h&&(m=m.replace(c,""))}if(t=m,l=t.match(p)){c=l[0];var v="w"===e.getCurrentPosition().parentMove.moveRight?"white":"black";n(e,c.split(":"),e.getClockInformation()[v].timeLeft),t=t.replace(c,"")}return t}function c(e,t){for(var n=[],i="",r="",o=!1,a=0;a<t.length;a++)if(r=t[a],o){if("}"===r){if(i=l(e,i.trim()).trim(),i.length){var s=e.getComment();s?e.setComment(s+" "+i):e.setComment(i)}o=!1,i="";continue}i+=r}else if("{"!==r)if("("!==r)if(")"!==r)if(" "===r&&i.length>1){if(v.test(i)){i="";continue}if(y.test(i)){e.addGlyph(parseInt(i.substr(1),10)),i="";continue}try{e.moveSan(i,void 0,!0,void 0,void 0,!0).setTimeUsageForLastAddedPosition(0)}catch(c){errorHandler.warning(new Error("could not fully import pgn game, because of illegal move"),{meta:e.getMeta(),move:i,currentPosition:e.toString()});break}i=""}else" "!==r&&(i+=r);else m.test(i)?e.addGlyph(parseInt(i.substr(1),10)):g.test(i)||e.moveSan(i,void 0,!0,void 0,void 0,!0).setTimeUsageForLastAddedPosition(0),i="",e.setCurrentPosition(n.pop());else n.push(e.getCurrentPosition()),e.gotoParentPosition();else o=!0;return e.gotoStart()}var d=/\n/g,u=/\n+$/g,h=/\n\n/g,f=/^\d+ /,p=/^[0-9]{1,2}:[0-9]{2}:[0-9]{2}$/,m=/^\$[0-9]*\s*$/,g=/^([0-9]*\.+|0-1|1-0|1\/2-1\/2)?\s*$/,v=/^([0-9]*\.+|0-1|1-0|1\/2-1\/2)\s*$/,y=/^\$[0-9]*\s*$/,b=/[\r|\t]/g,w=/([0-9]+\.)([a-h]|Q|R|N|B|K|0-0|O-O)/g,k=/^[0-9|:|.]*/,x=/^[0-9|.]*/,C=/\* \{[0-9]{1,2}:[0-9]{2}:[0-9]{2}\}/,j=/[0-9]+/,T=/^[0-9]{4}.[0-9\?]{2}.[0-9\?]{2}$/,_=["*","1-0","0-1","1/2-1/2"],S={R:"red",Y:"yellow",G:"green"};Chess.pgnToGame=function(n,i,r){i=i=[],n=n.replace(b,"").replace(u,"");var o=n.split(h);if(2!==o.length)return errorHandler.warning("can't import chessGame because, the blocks are not well formatted"),!1;var a=o[1].replace(C,"*").replace(w,"$1 $2").replace(d," ").trim(),s=a.substr(a.lastIndexOf(" ")+1);if(!_.contains(s))return errorHandler.warning("can't import chessGame because, the move block has no terminator char (*, 1-0, 0-1, 1/2-1/2)",{lastPartofGameString:s,meta:o[0]}),!1;var l=t(o[0]),f={noTimeout:!0};l.FEN&&(f.fen=l.FEN);var p=new Chess.Game(f);l.Date&&(p.gameStartedAt=e(l.Date));var m={emit:p.emit};switch(p.emit=dummy,p.setCheckForGameEnd(!1).setClockStartMove(1).setCalcTimeSpendInThisMove(!1).setMoveMode({duringGame:{mainline:!0,sideline:!0},afterGame:{mainline:!0,sideline:!0}}),c(p,a),l.Result){case"1-0":case"0-1":case"1/2-1/2":p.setGameStatus(l.Result)}return r&&(l=Object.subset(l,r)),p.setMeta(l),i.contains("gameStartedAt")&&delete p.gameStartedAt,p.emit=m.emit,p}}(),function(){function e(){}function t(){var e=this;return e.type="r",e.moveDirections=[Chess.getSquare(0,1),Chess.getSquare(0,-1),Chess.getSquare(1,0),Chess.getSquare(-1,0)],e.maxMoveSquares=7,e.takeDirections=e.moveDirections,e.maxTakeSquares=e.maxMoveSquares,e}function n(){var e=this;return e.type="n",e.moveDirections=[Chess.getSquare(2,1),Chess.getSquare(2,-1),Chess.getSquare(1,2),Chess.getSquare(1,-2),Chess.getSquare(-1,2),Chess.getSquare(-1,-2),Chess.getSquare(-2,1),Chess.getSquare(-2,-1)],e.maxMoveSquares=1,e.takeDirections=e.moveDirections,e.maxTakeSquares=e.maxMoveSquares,e}function i(){var e=this;return e.type="b",e.moveDirections=[Chess.getSquare(1,1),Chess.getSquare(1,-1),Chess.getSquare(-1,1),Chess.getSquare(-1,-1)],e.maxMoveSquares=7,e.takeDirections=e.moveDirections,e.maxTakeSquares=e.maxMoveSquares,e}function r(){var e=this;return e.type="q",e.moveDirections=[Chess.getSquare(0,1),Chess.getSquare(0,-1),Chess.getSquare(1,0),Chess.getSquare(-1,0),Chess.getSquare(1,1),Chess.getSquare(1,-1),Chess.getSquare(-1,1),Chess.getSquare(-1,-1)],e.maxMoveSquares=7,e.takeDirections=e.moveDirections,e.maxTakeSquares=e.maxMoveSquares,e}function o(){var e=this;return e.type="k",e.moveDirections=[Chess.getSquare(0,1),Chess.getSquare(0,-1),Chess.getSquare(1,0),Chess.getSquare(-1,0),Chess.getSquare(1,1),Chess.getSquare(1,-1),Chess.getSquare(-1,1),Chess.getSquare(-1,-1)],e.maxMoveSquares=1,e.takeDirections=e.moveDirections,e.maxTakeSquares=e.maxMoveSquares,e}function a(e,t){var n=this;return n.color=e,n.type="p","w"===e?(n.moveDirections=[Chess.getSquare(1,0)],n.takeDirections=[Chess.getSquare(1,1),Chess.getSquare(1,-1)]):(n.moveDirections=[Chess.getSquare(-1,0)],n.takeDirections=[Chess.getSquare(-1,1),Chess.getSquare(-1,-1)]),n.maxMoveSquares=t?2:1,n.maxTakeSquares=1,n}"undefined"==typeof Chess&&(Chess={});var s={pawn:{w:{},b:{}}};Chess.getPiece=function(e,l,c){switch(e.toLowerCase()){case"p":return c=c||!1,s.pawn[l][c]||(s.pawn[l][c]=new a(l,c));case"n":return s.knight||(s.knight=new n);case"b":return s.bishop||(s.bishop=new i);case"q":return s.queen||(s.queen=new r);case"r":return s.rook||(s.rook=new t);case"k":return s.king||(s.king=new o);default:return errorHandler.error(new Error("Illegal Piece in Constructor"),{piece:e})}},Chess.isPiece=function(t){return t instanceof e},e.prototype.getPossibleDistances=function(){for(var e={pieceHasSameMoveAndTakingBehavior:this.takeDirections===this.moveDirections,move:[],take:[]},t=0;t<this.moveDirections.length;t++){for(var n=[],i=1;i<=this.maxMoveSquares;i++)n.push(Chess.getSquare(this.moveDirections[t].y*i,this.moveDirections[t].x*i));e.move.unshift(n)}if(!e.pieceHasSameMoveAndTakingBehavior)for(t=0;t<this.takeDirections.length;t++){var n=[];for(i=1;i<=this.maxTakeSquares;i++)n.push(Chess.getSquare(this.takeDirections[t].y*i,this.takeDirections[t].x*i));e.take.unshift(n)}return this.getPossibleDistances=function(){return e},e},e.prototype.getPotentialSquares=function(){var e=this.getPossibleDistances(),t=[];return t=t.concat.apply(t,e.move.concat(e.take)),this.getPotentialSquares=function(){return t},t},t.prototype=n.prototype=i.prototype=o.prototype=r.prototype=a.prototype=e.prototype}(),function(){function e(e){for(var t={r:0,n:0,b:0,q:0,k:0,p:0,R:0,N:0,B:0,Q:0,K:0,P:0},n=0;64>n;n++)"-"!==e[n]&&t[e[n]]++;return t.white=t.K+t.Q+t.R+t.B+t.N+t.P,t.black=t.k+t.q+t.r+t.b+t.n+t.p,t.total=t.white+t.black,t}function t(e){Chess.isSquare(e.square)||Chess.isMove(e.line)||Chess.isSquare(e.frame)||errorHandler.error(new Error("highlightData does not have a proper highlight object"),{highlight:e})}function n(e){for(var t={squareBased:{},pieceBased:{},fullList:!1,piecePosition:{r:[],n:[],b:[],q:[],k:[],p:[]}},n=0;8>n;n++)for(var i=0;8>i;i++){if("w"===e.moveRight)var r=Chess.getSquare(n,i);else var r=Chess.getSquare(7-n,7-i);var o=e.getPiece(r);"-"===o||("w"!==e.moveRight||"P"!==o&&"R"!==o&&"N"!==o&&"B"!==o&&"Q"!==o&&"K"!==o)&&("b"!==e.moveRight||"p"!==o&&"r"!==o&&"n"!==o&&"b"!==o&&"q"!==o&&"k"!==o)||(t.piecePosition[o.toLowerCase()].push(r),t.squareBased[r]=r)}return t}"undefined"==typeof Chess&&(Chess={});var i,r={local:1,remote:2};!function o(){i={goesIntoIllegalPosition:{},checkMove:{},isMoveListEmpty:{},listOfLegalMoves:{},pieceCount:{}},setTimeout(o,"undefined"!=typeof Config&&Config.base&&Config.base.clearPositionCacheInterval||6e5)}(),Chess.Position=function(e){function t(){if(e.simpleMove&&(l.countPiecesOnBoard(),l.switchMoveRight(),l.kingPos[l.moveRight]&&l.isAttacked(l.kingPos[l.moveRight])&&(l.positionFlags.illegal=!0),l.switchMoveRight()),l.isMoveListEmpty())return void(l.kingPos[l.moveRight]&&l.isAttacked(l.kingPos[l.moveRight])?(l.positionFlags.check=!0,l.positionFlags.checkMate=!0):l.positionFlags.staleMate=!0);if(!e.dontCheckForInsufficentMaterial){var t=l.countPiecesOnBoard();if(t.white<3&&0===t.R&&0===t.Q&&0===t.P&&(l.positionFlags.insufficentMaterial.w=!0),t.black<3&&0===t.r&&0===t.q&&0===t.p&&(l.positionFlags.insufficentMaterial.b=!0),l.positionFlags.insufficentMaterial[l.moveRight])for(var n=l.getMoveList(),i=0;i<n.length;i++){var r=l.addChild({move:n[i],simpleMove:!0,dontCheckForInsufficentMaterial:!0}),o=r.isCheckMate();if(r.destroy(),o){l.positionFlags.insufficentMaterial[l.moveRight]=!1;break}}if(l.positionFlags.insufficentMaterial.w&&2===t.black&&2===t.white&&1===t.N&&1===t.p){var a=l.getPiece(),s=a.indexOf("p"),c=s/8,d=s%8;(0===d||7===d)&&3>c&&l.kingPos.b.x===d&&l.kingPos.b.y<c&&l.kingPos.w.y<2&&2===Math.abs(l.kingPos.b.x-l.kingPos.w.x)&&(l.positionFlags.insufficentMaterial.w=!1)}if(l.positionFlags.insufficentMaterial.b&&2===t.black&&2===t.white&&1===t.n&&1===t.P){var a=l.getPiece(),s=a.indexOf("P"),c=s/8,d=s%8;(0===d||7===d)&&c>4&&l.kingPos.w.x===d&&l.kingPos.w.y>c&&l.kingPos.b.y>5&&2===Math.abs(l.kingPos.b.x-l.kingPos.w.x)&&(l.positionFlags.insufficentMaterial.b=!1)}}l.kingPos[l.moveRight]&&l.isAttacked(l.kingPos[l.moveRight])&&(l.positionFlags.check=!0)}function o(){l.moveFormats={},l.moveMadeAt=Date.now(),l.parentMove?l.timeUsage=l.moveMadeAt-l.parentMove.moveMadeAt:l.timeUsage=0,void 0!==e.knotId&&(l.knotId=parseInt(e.knotId,10)),l.reRoot=function(){return g=!0,delete l.parentMove,delete l.moveCoords,l},l.getHighlights=function(){return m||(m=[])},l.isRootPosition=function(){return g},l.getSource=function(){return p},l.setSource=function(e){return r[e]>(r[p]||0)?(p=e,!0):!1},l.getGlyphes=function(){return f||(f=[])},l.getChat=function(){return h||(h=[])},l.getValidators=function(){return u}}function a(e,t){function n(e,n){return"-"===e?r.push(n):r.unshift(n),t}t=t||!1;for(var i=l.getPiece(e),r=[],o=i===i.toUpperCase()?"w":"b",a="P"===i&&1===e.y||"p"===i&&6===e.y,s="b"===o,c=Chess.getPiece(i,o,a),d=c.getPossibleDistances(),u=0;u<d.move.length;u++)for(var h=0;h<d.move[u].length;h++){var f=e.overlaySquare(d.move[u][h]);if(!f.onBoard)break;var p=l.getPiece(f);if(!("-"===p||d.pieceHasSameMoveAndTakingBehavior&&p===p.toLowerCase()!==s))break;if(7===f.y&&"P"===i||0===f.y&&"p"===i)for(var m=["q","r","b","n"],g=0;g<m.length;g++){var v=Chess.getMove(e.y,e.x,f.y,f.x,m[g]);if(l.goesIntoIllegalPosition(v))break;if(n(p,v))return r}else{if(v=Chess.getMove(e.y,e.x,f.y,f.x),!l.goesIntoIllegalPosition(v)&&n(p,v))return r;if("-"!==p)break}}if(!d.pieceHasSameMoveAndTakingBehavior)for(u=0;u<d.take.length;u++)for(h=0;h<d.take[u].length;h++){var f=e.overlaySquare(d.take[u][h]);if(!f.onBoard)break;if(p=l.getPiece(f),"-"!==p){var y="b";if(p===p.toUpperCase()&&(y="w"),y!==o)if(7===f.y&&"P"===i||0===f.y&&"p"===i)for(var m=["q","r","b","n"],g=0;g<m.length;g++){var v=Chess.getMove(e.y,e.x,f.y,f.x,m[g]);if(l.goesIntoIllegalPosition(v))break;if(n(p,v))return r}else if(v=Chess.getMove(e.y,e.x,f.y,f.x),!l.goesIntoIllegalPosition(v)&&n(p,v))return r;break}}if(-1!==l.ep&&"p"===c.type)for(var b=0;b<c.takeDirections.length;b++)for(h=1;h<=c.maxTakeSquares;h++){f=e.getNewSquare(h*c.takeDirections[b].y,h*c.takeDirections[b].x);var w;if(w="w"===o?5:2,f.y===w&&f.x===l.ep&&(v=Chess.getMove(e.y,e.x,e.y+h*c.takeDirections[b].y,e.x+h*c.takeDirections[b].x),!l.goesIntoIllegalPosition(v)&&n(l.getPiece(f),v)))return r}if("k"===c.type){if(l.canCastleKingside(o)&&"-"===l.getPiece(e.getNewSquare(0,1))&&"-"===l.getPiece(e.getNewSquare(0,2))&&!l.isAttacked(e)&&!l.isAttacked(e.getNewSquare(0,1))&&!l.isAttacked(e.getNewSquare(0,2))&&n("-",Chess.getMove(e.y,e.x,e.y,e.x+2)))return r;l.canCastleQueenside(o)&&("-"!==l.getPiece(e.getNewSquare(0,-1))||"-"!==l.getPiece(e.getNewSquare(0,-2))||"-"!==l.getPiece(e.getNewSquare(0,-3))||l.isAttacked(e)||l.isAttacked(e.getNewSquare(0,-1))||l.isAttacked(e.getNewSquare(0,-2))||n("-",Chess.getMove(e.y,e.x,e.y,e.x-2)))}return r}function s(){if(c.fullList)return l;for(var e in c.squareBased)if(Chess.isSquare(c.squareBased[e])){var t=l.getPiece(c.squareBased[e]).toLowerCase(),n=a(c.squareBased[e]);c.squareBased[e]=n,c.pieceBased[t]=(c.pieceBased[t]||[]).concat(n)}return c.fullList=!0,l}var l=this;e=e||{};var c,d,u,h,f,p,m,g=!e.parentMove;return l.childrenMoves=[],l.castlingRights=[],l.dontCheckForInsufficentMaterial=e.dontCheckForInsufficentMaterial,l.kingPos={},l.positionFlags={check:!1,checkMate:!1,staleMate:!1,illegal:!1,insufficentMaterial:{w:!1,b:!1},positionRepetition:!1},g||e.move||errorHandler.critical(new Error("Can't construct position. Wrong input parameter"),{move:e.move}),l.isMoveListEmpty=function(){if(void 0===c)return!1;var e=this.toString(),t=i.isMoveListEmpty[e];if(void 0!==t)return t;for(var n in c.squareBased){if(c.squareBased[n].length)return i.isMoveListEmpty[e]=!1;var r=a(c.squareBased[n],!0);if(r.length)return i.isMoveListEmpty[e]=!1;c.squareBased[n]=r}return i.isMoveListEmpty[e]=!0},l.getPiece=function(e,t){return void 0===e?d:(void 0===t&&(t=e.x,e=e.y),d[8*e+t])},l.setPiece=function(e,t,n){void 0===n&&(n=t,t=e.x,e=e.y);var i=8*e+t;return d=d.substr(0,i)+n+d.substr(i+n.length),l},l.findPotentialStartSquares=function(e,t,n,i,r,o){function a(t,a){for(var d=m.pieceHasSameMoveAndTakingBehavior||"-"===c?m.move:m.take,h=0;h<d.length;h++)for(var f=0;f<d[h].length;f++){var g=s.overlaySquare(d[h][f]);if(!g.onBoard)break;var v=l.getPiece(g);if(v!==e){if("-"===v)continue;break}if(void 0===a||a===g[t]){var y=Chess.getMove(g.y,g.x,i,r,o);if(!l.goesIntoIllegalPosition(y))return y}}if(-1!==l.ep&&"p"===p.type&&void 0!==n&&(2===i&&"b"===u||5===i&&"w"===u)){var y=Chess.getMove("b"===u?3:4,n,i,r,o);if(!l.goesIntoIllegalPosition(y))return y}}var s=Chess.getSquare(i,r),c=l.getPiece(s),d=e.toLowerCase(),u=e===d?"b":"w";if("p"===d)var h="w"===u?"b":"w",f="P"===e&&3===i||4===i;var p=Chess.getPiece(e,h,f),m=p.getPossibleDistances();return void 0===t?void 0===n?a():a("x",n):void 0===n?a("y",t):Chess.getMove(t,n,i,r,o)},l.getMoveList=function(e,t){if(!c)return[];if("piece"===e){if(t){t=t.toLowerCase();var n;if(c.piecePosition[t]){for(;n=c.piecePosition[t].pop();)l.getMoveList("square",n);delete c.piecePosition[t]}return c.pieceBased[t]||[]}return s(),c.pieceBased}if("square"===e){if(t){if("currentState"===t)return c.squareBased;if(!c.squareBased[t])return[];if(Array.isArray(c.squareBased[t]))return c.squareBased[t];var i=l.getPiece(t).toLowerCase(),r=a(t);return c.pieceBased[i]=(c.pieceBased[i]||[]).concat(r),c.squareBased[t]=r}return s(),c.squareBased}if(!c.listBased){s(),c.listBased=[];for(var o in c.squareBased)c.listBased.pushArray(c.squareBased[o])}return c.listBased},g?(!function(e){var t=Chess.isFen(e);t.valid||errorHandler.msg("notice",new Error(t.error),!0,{fen:e});var n=e.split(" "),i=Chess.translate.shortToLongPositionGroup(n[0]).split("/");d="";for(var r=0;8>r;r++)for(var o=0;8>o;o++){var a=i[7-r][o];d+=a,"k"===a?l.kingPos.b=Chess.getSquare(r,o):"K"===a&&(l.kingPos.w=Chess.getSquare(r,o))}l.moveRight=n[1];for(var s=["K","Q","k","q"],c=0;4>c;c++)-1!==n[2].indexOf(s[c])&&(l.castlingRights[c]=!0);l.ep=Chess.translate.decodeHumanCordX(n[3][0]),l.actionCounter=parseInt(n[4],10),l.moveCounter=parseInt(n[5],10)}(e.fen||Chess.defaultFen),u=e.validators?e.validators:[{moveValidator:Chess.Game.validators.standardRules}]):(l.parentMove=e.parentMove,d=l.parentMove.getPiece(),l.moveRight=l.parentMove.moveRight,l.castlingRights=l.parentMove.castlingRights.slice(),l.actionCounter=l.parentMove.actionCounter,l.moveCounter=l.parentMove.moveCounter,l.kingPos.w=l.parentMove.kingPos.w,l.kingPos.b=l.parentMove.kingPos.b,l.moveCoords=e.move,l.adjustBoard(),e.simpleMove!==!0&&(u=e.parentMove.getValidators(),l.positionFlags.positionRepetition=l.countRepetition()>2)),(e.dontCheckForInsufficentMaterial||!e.simpleMove)&&(c=i.listOfLegalMoves[l.toString()]||(i.listOfLegalMoves[l.toString()]=n(l))),e.simpleMove||o(),t(),e.simpleMove&&delete l.parentMove,l},Chess.Position.prototype.getEngineFen=function(){return Chess.translate.longFenToEngineFen(this.toString())},Chess.Position.prototype.promote=function(){var e=this;if(!e.parentMove)return this;var t=e.parentMove.childrenMoves;if(!t||t.length<2)return e.parentMove.promote(),this;var n=t.indexOf(e);return 1>n?(e.parentMove.promote(),this):(e.parentMove.childrenMoves.splice(n,1),e.parentMove.childrenMoves.unshift(e),this)},Chess.Position.prototype.toAscii=function(){for(var e="-+--------+\n",t=0;8>t;t++){e+=7-t+1+"|";for(var n=0;8>n;n++)e+=this.getPiece(7-t,n).replace("-"," ");e+="|\n"}return e+="-+--------+\n"+this.moveRight+"|abcdefgh|"},Chess.Position.prototype.isAtLeastAwayFromRoot=function(e){for(var t=this;e--&&(t=t.parentMove););return!!t},Chess.Position.prototype.getDepth=function(e){var t=0;if(e=e||!1)var n=this.childrenMoves.length;else n=Math.min(this.childrenMoves.length,1);for(var i=0;n>i;i++){var r=this.childrenMoves[i].getDepth(e);r>t&&(t=r)}return 1+t},Chess.Position.prototype.countChildrenMoves=function(e){return e?this.childrenMoves.reduce(function(e,t){return t.isNullMove()||e++,e},0):this.childrenMoves.length},Chess.Position.prototype.isNullMove=function(){return void 0===this.moveCoords?!1:this.moveCoords.isNullMove()},Chess.Position.prototype.deleteMove=function(){if(!this.parentMove)return!1;var e=this.parentMove.childrenMoves.indexOf(this);return e>=0?(this.parentMove.childrenMoves.splice(e,1),this.parentMove):!1},Chess.Position.prototype.addChild=function(e){e.parentMove=this;var t=new Chess.Position(e);return e.simpleMove||this.childrenMoves.push(t),t},Chess.Position.prototype.getAllChildrenInSubtree=function(){var e=[];e.pushArray(this.childrenMoves);for(var t=0;t<this.childrenMoves.length;t++)e.pushArray(this.childrenMoves[t].getAllChildrenInSubtree());return e},Chess.Position.prototype.isInMainline=function(){for(var e=this;e.parentMove;){if(0!==e.parentMove.childrenMoves.indexOf(e))return!1;e=e.parentMove}return!0},Chess.Position.prototype.getEndOfLine=function(){for(var e=this;e.countChildrenMoves()>0;)e=e.getChildrenMoveById(0);return e},Chess.Position.prototype.isEndOfLine=function(){return 0===this.countChildrenMoves()},Chess.Position.prototype.getDistanceToMainline=function(){return this.isInMainline()?0:0===this.getPositionInChildrenArray()?this.parentMove.getDistanceToMainline():this.parentMove.getDistanceToMainline()+1},Chess.Position.prototype.getChildrenMoveById=function(e){return void 0===this.childrenMoves[e]?!1:this.childrenMoves[e]},Chess.Position.prototype.getChildrenMoveByMove=function(e){for(var t=0;t<this.childrenMoves.length;t++)if(this.childrenMoves[t].moveCoords===e)return this.childrenMoves[t];return!1},Chess.Position.prototype.getPositionInChildrenArray=function(){if(void 0===this.parentMove)return-1;var e=this.parentMove.childrenMoves;return e.indexOf(this)},Chess.Position.prototype.isLegalMoveIfItWouldBeAPromotion=function(e){return this.isLegalMove(Chess.getMove(e.y1,e.x1,e.y2,e.x2,"q"))},Chess.Position.prototype.isLegalMove=function(e){for(var t=this.getValidators(),n=0;n<t.length;n++){var i=t[n].moveValidator.call(this,e);if(void 0!==i)return i}return!1},Chess.Position.prototype.move=function(e){if(!e.simpleMove&&!this.isLegalMove(e.move))return errorHandler.error(new Error("Illegal Move"),{move:e.move,fen:this.toString()});for(var t=0;t<this.childrenMoves.length;t++)if(e.move===this.childrenMoves[t].moveCoords)return t;return void 0===e.dontCheckForInsufficentMaterial&&(e.dontCheckForInsufficentMaterial=this.dontCheckForInsufficentMaterial),this.addChild(e)},Chess.Position.prototype.clonePosition=function(){return new Chess.Position({fen:this.toString()})},Chess.Position.prototype.getFormatedGlyphes=function(){return this.getGlyphes().map(Chess.Glyphes.getSymbolById).join("")},Chess.Position.prototype.getMove=function(e,t){if(t)var n=this.getFormatedGlyphes();switch(e.toLowerCase()){case"san":var i=this.getSan();break;case"fan":i=this.getFan();break;case"lan":i=this.getLan();break;case"can":i=this.getCan();break;case"sep":i=this.getSep();break;default:errorHandler.warning(new Error("the selected move format is not avaible"),{format:e}),i=this.getSan()}return n?i+n:i},Chess.Position.prototype.isCheck=function(){return this.positionFlags.check},Chess.Position.prototype.isIllegal=function(){return this.positionFlags.illegal},Chess.Position.prototype.isCheckMate=function(){return this.positionFlags.checkMate},Chess.Position.prototype.isActionCounterOverLimit=function(){return this.actionCounter>=100},Chess.Position.prototype.isStaleMate=function(){return this.positionFlags.staleMate},Chess.Position.prototype.isInsufficentMaterial=function(e){var t=!1;return t=void 0===e?this.positionFlags.insufficentMaterial.w&&this.positionFlags.insufficentMaterial.b:"w"===e?this.positionFlags.insufficentMaterial.w:this.positionFlags.insufficentMaterial.b},Chess.Position.prototype.isPositionRepetition=function(){return this.positionFlags.positionRepetition},Chess.Position.prototype.isDraw=function(){return this.positionFlags.positionRepetition||this.positionFlags.staleMate||this.isActionCounterOverLimit()||this.positionFlags.insufficentMaterial.w&&this.positionFlags.insufficentMaterial.b},Chess.Position.prototype.isAttacked=function(e){var t=this,n=t.getPiece(e);if("-"===n)var i=t.moveRight;else i=n===n.toUpperCase()?"w":"b";var r=t.countPiecesOnBoard();if("w"===i){var o=["k"];r.p&&o.push("p"),r.n&&o.push("n"),r.r&&o.push("r"),r.b&&o.push("b"),r.q&&o.push("q")}else o=["K"],r.P&&o.push("P"),r.N&&o.push("N"),r.R&&o.push("R"),r.B&&o.push("B"),r.Q&&o.push("Q");if(t.ep===e.x)if("w"===i){if(3===e.y&&"P"===n&&"b"===t.moveRight){if("p"===t.getPiece(e.getNewSquare(0,1)))return!0;if("p"===t.getPiece(e.getNewSquare(0,-1)))return!0}}else if(4===e.y&&"p"===n&&"w"===t.moveRight){if("P"===t.getPiece(e.getNewSquare(0,1)))return!0;if("P"===t.getPiece(e.getNewSquare(0,-1)))return!0}for(var a=0;a<o.length;a++)for(var s=Chess.getPiece(o[a],i),l=0;l<s.takeDirections.length;l++)for(var c=1;c<=s.maxTakeSquares;c++){var d=e.getNewSquare(c*s.takeDirections[l].y,c*s.takeDirections[l].x);if(!d.onBoard)break;if(t.getPiece(d)===o[a])return!0;if("-"!==t.getPiece(d))break}return!1},Chess.Position.prototype.switchMoveRight=function(){return"w"===this.moveRight?this.moveRight="b":this.moveRight="w",this},Chess.Position.prototype.adjustBoard=function(){var e,t=this.moveCoords.y1,n=this.moveCoords.x1,i=this.moveCoords.y2,r=this.moveCoords.x2,o=this.moveCoords.endSquare,a=this.moveCoords.startSquare,s=this.moveCoords.promotion;return 0===t&&0===n&&0===i&&0===r?("b"===this.moveRight&&this.moveCounter++,this.switchMoveRight(),this):("-"!==this.getPiece(o)&&(this.hasTakenPiece=!0),this.pieceUsed=this.getPiece(a),"P"===this.pieceUsed||"p"===this.pieceUsed||"-"!==this.getPiece(o)?this.actionCounter=0:this.actionCounter++,"K"===this.pieceUsed||"k"===this.pieceUsed?(r>n+1?(this.additionalMoveInformation=this.additionalMoveInformation||{},this.additionalMoveInformation.additionalMove=Chess.getMove(t,7,i,5),this.setPiece(t,5,this.getPiece(t,7)),this.setPiece(t,7,"-")):n-1>r&&(this.additionalMoveInformation=this.additionalMoveInformation||{},this.additionalMoveInformation.additionalMove=Chess.getMove(t,0,i,3),this.setPiece(t,3,this.getPiece(t,0)),this.setPiece(t,0,"-")),"k"===this.pieceUsed&&(this.kingPos.b=o),"K"===this.pieceUsed&&(this.kingPos.w=o)):n===r||"P"!==this.pieceUsed&&"p"!==this.pieceUsed||"-"!==this.getPiece(o)||(this.setPiece(t,r,"-"),this.additionalMoveInformation=this.additionalMoveInformation||{},this.additionalMoveInformation.removePiece=Chess.getSquare(t,r),this.actionCounter=0,this.hasTakenPiece=!0),!s&&(7===o.y&&"P"===this.pieceUsed||0===o.y&&"p"===this.pieceUsed)&&(s="r"),e=s?"w"===this.moveRight?s.toUpperCase():s:this.pieceUsed,this.setPiece(i,r,e),this.setPiece(t,n,"-"),"w"===this.moveRight?(0===t&&(4===n?(this.castlingRights[0]=!1,this.castlingRights[1]=!1):7===n?this.castlingRights[0]=!1:0===n&&(this.castlingRights[1]=!1)),7===i&&(7===r?this.castlingRights[2]=!1:0===r&&(this.castlingRights[3]=!1))):(7===t&&(4===n?(this.castlingRights[2]=!1,this.castlingRights[3]=!1):7===n?this.castlingRights[2]=!1:0===n&&(this.castlingRights[3]=!1)),0===i&&(7===r?this.castlingRights[0]=!1:0===r&&(this.castlingRights[1]=!1)),this.moveCounter++),this.switchMoveRight(),"P"!==this.getPiece(i,r)&&"p"!==this.getPiece(i,r)||2!==Math.abs(t-i)||("w"===this.moveRight?("P"===this.getPiece(i,r-1)||"P"===this.getPiece(i,r+1))&&(this.ep=n):("p"===this.getPiece(i,r-1)||"p"===this.getPiece(i,r+1))&&(this.ep=r)),this)},Chess.Position.prototype.nextMoveIsBlack=function(){return"b"===this.moveRight},Chess.Position.prototype.nextMoveIsWhite=function(){return"w"===this.moveRight},Chess.Position.prototype.lastMoveWasBlack=function(){return"w"===this.moveRight},Chess.Position.prototype.lastMoveWasWhite=function(){return"b"===this.moveRight},Chess.Position.prototype.getMoveRight=function(){return this.moveRight},Chess.Position.prototype.canCastleKingside=function(e,t){return e=e||this.moveRight,"w"===e?!!this.castlingRights[0]&&(!t||"K"===this.getPiece(0,4)&&"R"===this.getPiece(0,7)):"b"===e?!!this.castlingRights[2]&&(!t||"k"===this.getPiece(7,4)&&"r"===this.getPiece(7,7)):void 0},Chess.Position.prototype.canCastleQueenside=function(e,t){return e=e||this.moveRight,"w"===e?!!this.castlingRights[1]&&(!t||"K"==this.getPiece(0,4)&&"R"==this.getPiece(0,0)):"b"===e?!!this.castlingRights[3]&&(!t||"k"==this.getPiece(7,4)&&"r"==this.getPiece(7,0)):void 0},Chess.Position.prototype.getCan=function(){return this.isRootPosition()?void 0:(this.moveFormats.can||(this.moveFormats.can=this.moveCoords.toString()),this.moveFormats.can)},Chess.Position.prototype.getLan=function(){return this.isRootPosition()?void 0:(this.moveFormats.lan||(this.moveFormats.lan=Chess.translate.moveToLan(this.moveCoords,this.pieceUsed,this.hasTakenPiece,this.isCheckMate(),this.isCheck())),this.moveFormats.lan)},Chess.Position.prototype.getSan=function(){return this.isRootPosition()?void 0:(this.moveFormats.san||(this.moveFormats.san=Chess.translate.moveToSan(this.moveCoords,this.pieceUsed,this.parentMove.getMoveList("piece",this.pieceUsed),this.hasTakenPiece,this.isCheckMate(),this.isCheck())),this.moveFormats.san)},Chess.Position.prototype.getFan=function(){return this.isRootPosition()?void 0:(this.moveFormats.fan||(this.moveFormats.fan=Chess.translate.moveToFan(this.moveCoords,this.pieceUsed,this.parentMove.getMoveList("piece",this.pieceUsed),this.hasTakenPiece,this.isCheckMate(),this.isCheck())),this.moveFormats.fan)},Chess.Position.prototype.getSep=function(){return this.isRootPosition()?void 0:(this.moveFormats.sep||(this.moveFormats.sep=Chess.translate.moveToSep(this.moveCoords)),this.moveFormats.sep)},Chess.Position.prototype.setQuestion=function(e){return this.question=new Chess.Question(e),this},Chess.Position.prototype.getQuestion=function(){if(!this.question){this.question=new Chess.Question;for(var e=0;e<this.childrenMoves.length;e++)this.question.addAnswer(this.childrenMoves[e].moveCoords,this.childrenMoves[e].comment,0===e,0)}return this.question},Chess.Position.prototype.addChat=function(e,t,n){if(n=parseInt(n||Date.now(),10),"string"!=typeof t||!t.length||isNaN(n))return errorHandler.msg("notice",new Error("ignored invalid chat message"),!1,{id:e,message:t,timestamp:n}),!1;for(var i=this.getChat(),r={id:e,message:t,timestamp:n},o=i.length;o>0&&(i[o-1]&&!(i[o-1].timestamp<=n));o--);return i.splice(o,0,r),r},Chess.Position.prototype.addGlyph=function(e){var t=this.getGlyphes();return t.contains(e)||t.push(e),this},Chess.Position.prototype.removeGlyph=function(e){var t=this.getGlyphes();return void 0===e?t.splice(0,t.length):t.removeByValue(e),this},Chess.Position.prototype.setGlyphes=function(e){var t=this.getGlyphes();return t.splice(0,t.length),e.forEach(this.addGlyph,this),this},Chess.Position.prototype.countRepetition=function(){function e(e){return e.split(" ",4).join(" ")}for(var t=this,n=t,i=1,r=e(t.toString());n=n.parentMove;){var o=e(n.toString());if(o===r&&i++,0===n.actionCounter)break}return i},Chess.Position.prototype.getEngine=function(e,t,n){var i=Handler.engine.get(this,e,t,n);return i=Handler.engine.invertData(this,i)},Chess.Position.prototype.hasGlyphes=function(){return!!this.getGlyphes().length},Chess.Position.prototype.toString=function(){for(var e="",t=7;t>=0;t--){for(var n=0;8>n;n++)e+=this.getPiece(t,n);t>0&&(e+="/")}if(e=Chess.translate.longToShortPositionGroup(e)+" "+this.moveRight+" ",this.castlingRights[0]&&(e+="K"),this.castlingRights[1]&&(e+="Q"),this.castlingRights[2]&&(e+="k"),this.castlingRights[3]&&(e+="q"),this.castlingRights[0]||this.castlingRights[1]||this.castlingRights[2]||this.castlingRights[3]||(e+="-"),-1!==this.ep){var i=Chess.translate.encodeHumanCordX(this.ep);i+="w"===this.moveRight?"6":"3"}else i="-";return e+=" "+i,e+=" "+this.actionCounter,e+=" "+this.moveCounter,
this.toString=function(t){return t?Chess.Position.prototype.toString.call(this):e},e},Chess.Position.prototype.setHighlights=function(e){Array.isArray(e)||errorHandler.error(new Error("highlightsData is not an array"),{highlightsData:e});var n=this.getHighlights();n.length=0;for(var i=0;i<e.length;i++)t(e[i]),n.push(e[i]);return this},Chess.Position.prototype.goesIntoIllegalPosition=function(e){var t=this.toString(),n=i.goesIntoIllegalPosition[t]||(i.goesIntoIllegalPosition[t]={});if(void 0!==n[e.can])return n[e.can];var r=this.addChild({move:e,simpleMove:!0}),o=r.isIllegal();return r.destroy(),n[e.can]=o,o},Chess.Position.prototype.checkMove=function(e){var t=this.toString(),n=i.checkMove[t]||(i.checkMove[t]={});if(void 0!==n[e.can])return n[e.can];var r=e.startSquare,o=e.endSquare,a=this.getPiece(e.startSquare),s=this.getPiece(e.endSquare);if("-"===a||!e.onBoard)return n[e.can]=!1;var l=a===a.toLowerCase()?"b":"w";if(l!==this.moveRight)return n[e.can]=!1;if("-"!==s&&(s===s.toLowerCase()?"b":"w")===this.moveRight)return n[e.can]=!1;if(this.goesIntoIllegalPosition(e))return n[e.can]=!1;var c=Chess.getPiece(a,l,"P"===a&&1===r.y||"p"===a&&6===r.y);if("-"===s&&this.ep===o.x&&"p"===c.type&&1===Math.abs(r.x-o.x)&&("b"===l&&2===o.y&&3===r.y||"w"===l&&5===o.y&&4===r.y))return n[e.can]=!0;if("k"===c.type){if(this.canCastleKingside(l)&&o===r.getNewSquare(0,2)&&"-"===this.getPiece(r.getNewSquare(0,1))&&"-"===this.getPiece(o)&&!this.isAttacked(r)&&!this.isAttacked(r.getNewSquare(0,1))&&!this.isAttacked(o))return n[e.can]=!0;if(this.canCastleQueenside(l)&&o===r.getNewSquare(0,-2)&&"-"===this.getPiece(r.getNewSquare(0,-1))&&"-"===this.getPiece(o)&&"-"===this.getPiece(r.getNewSquare(0,-3))&&!this.isAttacked(r)&&!this.isAttacked(r.getNewSquare(0,-1))&&!this.isAttacked(o))return n[e.can]=!0}if(7===o.y&&"P"===a||0===o.y&&"p"===a){if(!/[rbnq]/i.test(e.promotion||""))return n[e.can]=!1}else if(e.promotion)return n[e.can]=!1;for(var d=c.getPossibleDistances(),u=d.pieceHasSameMoveAndTakingBehavior||"-"===s?d.move:d.take,h=0;h<u.length;h++)for(var f=0;f<u[h].length;f++){var p=r.overlaySquare(u[h][f]);if(!p.onBoard)break;if(o.x===p.x&&o.y===p.y)return n[e.can]=!0;var m=this.getPiece(p);if("-"!==m)break}return n[e.can]=!1},Chess.Position.prototype.addHighlight=function(e){t(e);var n=this.getHighlights(),i=!0;if(!e.temporary)for(var r=n.length-1;r>=0;r--){var o=n[r];(Chess.isSquare(e.square)&&e.square===o.square||Chess.isMove(e.line)&&e.line===o.line||Chess.isSquare(e.frame)&&e.frame===o.frame)&&(n.splice(r,1),e.color===o.color&&(i=!1))}return i&&n.push(e),this},Chess.Position.prototype.deleteHighlight=function(e){for(var t=this.getHighlights(),n=t.length-1;n>=0;n--){var i=t[n];(Chess.isSquare(e.square)&&e.square===i.square||Chess.isMove(e.line)&&e.line===i.line||Chess.isSquare(e.frame)&&e.frame===i.frame)&&e.temporary==i.temporary&&t.splice(n,1)}return this},Chess.Position.prototype.deleteHighlightsByType=function(e){for(var t=this.getHighlights(),n=t.length-1;n>=0;n--){var i=t[n];("square"===e&&Chess.isSquare(i.square)||"line"===e&&Chess.isMove(i.line)||"frame"===e&&Chess.isSquare(i.frame))&&t.splice(n,1)}},Chess.Position.prototype.countPiecesOnBoard=function(){var t=this.toString();return i.pieceCount[t]||(i.pieceCount[t]=e(this.getPiece()))},Chess.Position.prototype.ep=-1,Chess.Position.prototype.destroy=function(){delete this.parentMove,this.childrenMoves&&this.childrenMoves.splice(0,this.childrenMoves.length);for(var e in this)Object.has(this,e)&&delete this[e]},Chess.Position.prototype.isValid=function(e){for(var t=!1,n=!1,i={k:[1,1],q:[0,9],r:[0,10],n:[0,10],b:[0,10],p:[0,8],white:[1,16],black:[1,16]},r=this.countPiecesOnBoard(),o=["k","q","r","n","b","p","K","Q","R","N","B","P","white","black"],a=0;a<o.length;a++)(r[o[a]]<i[o[a].toLowerCase()][0]||r[o[a]]>i[o[a].toLowerCase()][1])&&(t=!0);r.k&&r.K&&(this.isAttacked(this.kingPos.b)&&this.isAttacked(this.kingPos.w)&&(n=!0),this.isAttacked(this.kingPos.b)&&"w"===this.moveRight&&(n=!0),this.isAttacked(this.kingPos.w)&&"b"===this.moveRight&&(n=!0));for(var a=0;8>a;a++)"p"===this.getPiece(0,a).toLowerCase()&&(t=!0);for(var a=0;8>a;a++)"p"===this.getPiece(7,a).toLowerCase()&&(t=!0);return this.canCastleKingside("w")&&("K"!==this.getPiece(0,4)||"R"!==this.getPiece(0,7))&&(t=!0),this.canCastleQueenside("w")&&("K"!==this.getPiece(0,4)||"R"!==this.getPiece(0,0))&&(t=!0),this.canCastleKingside("b")&&("k"!==this.getPiece(7,4)||"r"!==this.getPiece(7,7))&&(t=!0),this.canCastleQueenside("b")&&("k"!==this.getPiece(7,4)||"r"!==this.getPiece(7,0))&&(t=!0),!n&&(e||!t)}}(),"undefined"==typeof Chess&&(Chess={}),Chess.Question=function(e){var t=this,n={};void 0===e&&(t.autoGenerated=!0);var i="object"==typeof window&&"function"===window.t||function(e){return e};t.question=e||i("Try to guess the next move"),t.defaultWrongAnswer=i("This is not the best move. Try again!"),t.defaultCorrectAnswer=i("Correct!");var r=0;return t.addAnswer=function(e,i,o,a){return Chess.isMove(e)&&"boolean"==typeof o&&"number"==typeof a||errorHandler.msg("error",new Error("invalid argument"),!0,{move:e,feedback:i,correctAnswer:o,points:a}),n[e.toString()]={feedback:i||(o?t.defaultCorrectAnswer:t.defaultWrongAnswer),correctAnswer:o,points:a},a>r&&(r=a),t},t.checkAnswer=function(e){return e=e.toString(),void 0!==n[e]?{feedback:n[e].feedback,correctAnswer:n[e].correctAnswer,points:n[e].points,maximumPoints:r}:{feedback:t.defaultWrongAnswer,correctAnswer:!1,points:0,maximumPoints:r}},t.getAnswer=function(e){return void 0===e?n:n[e.toString()]},t.getMaximumPoints=function(){return r},t},function(){function e(e,t){var n=this;return n.y=parseInt(e,10),n.x=parseInt(t,10),(isNaN(n.y)||isNaN(n.x))&&errorHandler.error(new Error("Illegal parameter in square Constructor"),{x:t,y:e}),n.onBoard=this.y>=0&&this.y<=7&&this.x>=0&&this.x<=7,n}"undefined"==typeof Chess&&(Chess={});var t=[];Chess.getSquare=function(n,i){return void 0===t[n]&&(t[n]=[]),t[n][i]||(t[n][i]=new e(n,i))},Chess.isSquare=function(t){return t instanceof e},e.prototype.getNewSquare=function(e,t){return isNaN(e)&&(e=0),isNaN(t)&&(t=0),Chess.getSquare(this.y+e,this.x+t)},e.prototype.overlaySquare=function(e){return this.getNewSquare(e.y,e.x)},e.prototype.isOnBoard=function(){return this.onBoard},e.prototype.toString=function(){return this.human||(this.human=String.fromCharCode(this.x+97)+(this.y+1))}}(),function(){var e=function(e,t,n){function i(){return d.splice(0,d.length),e}function r(t,n){return"object"!=typeof t&&errorHandler.msg("error",new Error("given decorator is not a object"),!0,{decorator:t}),void 0!==n?0===n&&d.unshift(t):d.push(t),e}function o(t){return"number"==typeof t?(d.remove(t),e):("object"!=typeof t&&errorHandler.msg("error",new Error("given decorator is not a function"),!0,{decorator:t}),d.removeByValue(t),e)}function a(){return d}function s(){return c}function l(n){"string"==typeof n&&(c=n,n=t[n]),Array.isArray(n)||errorHandler.msg("error",new Error("given decoratorSet is not a array"),!0,{newDecoratorSet:n}),i();for(var o=0;o<n.length;o++)r(n[o]);return e}var c,d=[];void 0===n&&(n={}),n.clear=n.clear||"clearDecorators",n.add=n.add||"clearDecorator",n.remove=n.remove||"removeDecorator",n.get=n.get||"getDecorators",n.set=n.set||"setDecorators",n.getCurrentSetName=n.getCurrentSetName||"getCurrentSetName";for(var u in n)void 0!==e[n[u]]&&errorHandler.msg("error",new Error("can not make this decoratable, because a needed function is blocked"),!0,{method:n[u]});for(var h in n)void 0!==e[n[h]]&&errorHandler.msg("error",new Error("can not make this to a publisher, because a needed function is blocked"),!0,{blockedFunction:h});return e[n.clear]=i,e[n.add]=r,e[n.remove]=o,e[n.get]=a,e[n.set]=l,e[n.getCurrentSetName]=s,e};"undefined"!=typeof exports?module.exports=e:("undefined"==typeof Extend&&(Extend={}),Extend.Decoratable=e)}(),inheritable.simpleExtend=function(e,t){if("object"!=typeof e)return e;for(var n in t)"object"==typeof t[n]?e[n]=inheritable.simpleExtend({},t[n]):e[n]=t[n];return e},inheritable.extend=function(e){var t=this.prototype||Function.prototype,n={};for(var i in e)n[i]=e[i];for(var i in t)"function"==typeof t[i]?"undefined"==typeof n[i]&&(n[i]=t[i]):"object"==typeof t[i]?n[i]=inheritable.simpleExtend({},t[i]):n[i]=t[i];n._stack=(t._stack||[]).concat([t]);var r=function(){var e=this,i={};for(var r in t)i[r]=function(t){return function(){var i=n._stack.pop(),r=i[t].apply(e,arguments);return n._stack.push(i),r}}(r);return i},o=function(){return this.parent=r.call(this),e.__constructor?(n.constructor=e.__constructor,e.__constructor.apply(this,arguments)):this};return o.prototype=n,o.extend=this.extend,o},function(){function e(e,t){function n(){if(t.encoders){for(var n in t.encoders)c(n,t.encoders[n]);delete t.encoders}if(void 0!==t.config&&(i(t.config),delete t.config),void 0!==t.validators&&(r(t.validators),delete t.validators),void 0!==t.init&&"function"==typeof t.init&&(t.init(e),delete t.init),void 0!==t.attributes)for(var o in t.attributes){var a=t.attributes[o];e.set(o,a)}}function i(e){void 0!==e.publishDirectly&&(g.publishDirectly=!!e.publishDirectly)}function r(e){if("object"==typeof e)for(var t in e){var n=e[t];if(Array.isArray(n))for(var i=0;i<n.length;i++)d(t,n[i]);else d(t,n)}}function o(t,n,i,r){var o=!0;if(!r)if(n===f[t]||"number"==typeof n&&isNaN(n))o=!1;else if(!i&&"object"==typeof n){var a=f[t],s=n;if(void 0===a){if(void 0!==m[t])try{s=e.encode(t,s)}catch(l){}}else{if(void 0!==m[t])try{a=e.encode(t,a),s=e.encode(t,s)}catch(l){}try{a=JSON.stringify(a),s=JSON.stringify(s),a===s&&(o=!1)}catch(l){}}}if(o&&void 0!==f[t]&&!Array.isArray(n)&&"function"==typeof e.createPatch&&(r=e.createPatch(t,f[t],n),Array.isArray(r)&&0===r.length&&(o=!1)),i&&"function"==typeof e.afterRefetch&&f[t]){var c=e.afterRefetch(t,f[t],n);return f[t]=n,c}if(f[t]=n,o){var d={name:"set."+t,data:{key:t,value:n}};return r&&(d.data.diff=r),h(d),{diff:r,newData:o}}return{newData:o}}function a(e){return f[e]}function s(e){return void 0!==f[e]}function l(e){if(s(e)){var t={name:"unset."+e,data:{key:e,value:a(e)}};return delete f[e],h(t),!0}return!1}function c(e,t){"function"!=typeof t&&errorHandler.msg("error",new Error("Transformer is not a function"),!0,{key:e}),m[e]=t}function d(e,t){if(void 0===p[e]&&(p[e]=[]),Array.isArray(t))for(var n=0;n<t.length;n++)"function"==typeof t[n]&&p[e].push(t[n]);else p[e].push(t)}function u(e,t){if(void 0!==p[e]){for(var n=!1,i=0;i<p[e].length;i++){var r=p[e][i];r(t)!==!0&&(n=!0)}return!n}return!0}function h(t){g.publishDirectly===!0?e.emit(t.name,t.data):v.push(t)}Extend.Publisher(e),t=t||{};var f={},p={},m={},g={publishDirectly:!0},v=[];return e.set=function(t,n,i,r,a){function s(e,t){var n=o(e,t,r,a);l[e]=n.newData,void 0!==n.diff&&(c[e]=n.diff)}var l={};i=i||!1;var c={};if("object"==typeof t){var d=t,h=!1;for(var t in d)u(t,d[t])!==!0&&i!==!0&&(h=!0);if(h===!0)return!1;for(var t in d)s(t,d[t]);var f=d}else{if(u(t,n)!==!0&&i!==!0)return!1;s(t,n),f={},f[t]=n}return e.afterSet(f,c,l),!0},e.afterSet=function(){return e},e.validate=function(e,t){return u(e,t)},e.encode=function(e,t){return m[e]?m[e](t):t},e.get=function(e){if(Array.isArray(e)){for(var t=e,n={},e=0;e<t.length;e++)n[t[e]]=a(t[e]);return n}return a(e)},e.has=function(e){return s(e)},e.unset=function(e){if(Array.isArray(e)){for(var t=e,n=!1,e=0;e<t.length;e++)l(t[e])||(n=!0);return!n}return l(e)},e.save=function(){for(;v.length;){var t=v.pop();e.emit(t.name,t.data)}},e.addValidator=function(e,t){d(e,t)},e.getAttributes=function(){return Object.copy(f)},e.toJSON=function(){return JSON.stringify({attributes:f,validators:p,config:g})},e.remove=function(){var e={name:"remove"};h(e)},n(),e}"undefined"!=typeof exports?module.exports=e:("undefined"==typeof Extend&&(Extend={}),Extend.Model=e)}(),function(){var e=function(e,t,n,i,r){function o(e){a(e),r()}function a(t){for(var n in t)t[n]=e.encode(n,t[n]);isNaN(t.__messageId)&&errorHandler.critical(new Error("initObject.__messageId is not a number"),{messageId:t.__messageId}),h.reset(parseInt(t.__messageId,10)+1),delete t.__messageId,d&&Object.extend(t,d),u.set(t,void 0,void 0,!0)}function s(t){for(var n in t.diffs)d&&Object.has(d,n)||u.set(n,e.patch(n,t.diffs[n]),void 0,void 0,t.diffs[n]);for(var n in t.attributes)d&&Object.has(d,n)||u.set(n,t.attributes[n]);return e}function l(i){return t.emit("get",n.rkey,i||a),e}function c(e){return d&&void 0!==d[e]?d[e]:u.get(e)}i=i||{},delete i.attributes,i.config=i.config||{},i.config.publishDirectly=!0,Extend.Model(e,i);var d,u={remove:e.remove,set:e.set,unset:e.unset,get:e.get},h=new Helper.MessageQueue(s,2e4,l);return t.subscribe(n.rkey),l(o),t.on(n.rkey,function(e){switch(e.action){case"unset":u.unset(e.key);break;case"set":h.addMessage(e.messageId,e);break;case"remove":t.emit("unsubscribe",n.rkey),u.remove();break;default:errorHandler.msg("error",new Error("the action is not defined in socketPR"),!0,{update:e})}}),e.getModelSpec=function(){return n},e.set=function(){return!1},e.get=function(e){return Array.isArray(e)?e.map(c):c(e)},e.setOverrides=function(t){return d=t,e},e.patch=function(t,n){var i=e.get(t);return"object"!=typeof i&&errorHandler.msg("critical",new Error("can only patch objects"),!0,{currentValue:i,key:t,diff:n}),Object.patch(Object.copy(i),n)},e.unsubscribe=function(){t.subscribe(n.rkey)},e};"undefined"!=typeof exports?module.exports=e:("undefined"==typeof Extend&&(Extend={}),Extend.SocketPR=e)}(),function(){var e=function(e,t,n,i){function r(e,i){i=i||"on",!Object.keys(t).length||"object"==typeof e&&"function"==typeof e[i]||errorHandler.msg("error",new Error("can not link this subscriber, because you want to link to something that is not a publisher"),!0,{publisher:e,subscriptions:t}),"function"==typeof n.beforeLink&&n.beforeLink({publisher:e});for(var r in t){if("function"==typeof t[r])var o=t[r],a=void 0;else if("object"==typeof t[r]&&"function"==typeof t[r].callback)var o=t[r].callback,a=t[r].sync;else errorHandler.msg("error",new Error("given callback is neither function nor object with callback and sync property"),!0,{publisher:e,subscriptions:t});e[i](r,o,void 0,a)}return"function"==typeof n.afterLink&&n.afterLink({publisher:e}),this}function o(e,i){i=i||"off",("object"!=typeof e||"function"!=typeof e[i])&&errorHandler.msg("error",new Error("can not unlink this subscriber, because you want to link to something that is not a publisher"),!0,{publisher:e,subscriptions:t}),"function"==typeof n.beforeUnlink&&n.beforeUnlink({publisher:e});for(var r in t){if("function"==typeof t[r])var o=t[r];else if("object"==typeof t[r]&&"function"==typeof t[r].callback)var o=t[r].callback;else errorHandler.msg("error",new Error("given callback is neither function nor object with callback and sync property"),!0,{publisher:e,subscriptions:t});e[i](r,o)}return"function"==typeof n.afterUnlink&&n.afterUnlink({publisher:e}),this}void 0===i&&(i={}),i.link=i.link||"link",i.unlink=i.unlink||"unlink","object"!=typeof t&&errorHandler.msg("error",new Error("can not link this subscriber, because no subscriptions are defined"),!0,{subscriber:e,subscriptions:t}),"object"!=typeof n&&(n={});for(var a in i)void 0!==e[i[a]]&&errorHandler.msg("error",new Error("can not make this to a subscriber, because the needed link function is blocked"),!0,{blockedFunction:i[a]});return e[i.link]=r,e[i.unlink]=o,e};"undefined"!=typeof exports?module.exports=e:("undefined"==typeof Extend&&(Extend={}),Extend.Subscriber=e)}(),function(){var e=function(e,t,n){function i(){return h?e:(h=!0,d&&d.call(e),e)}function r(){return h?(h=!1,u&&u.call(e,f),f=!1,e):e}function o(){return h}function a(t){return void 0!==t&&"function"!=typeof t&&errorHandler.error(new Error("callback must be a function"),{badCallback:t}),d=t,e}function s(t){return void 0!==t&&"function"!=typeof t&&errorHandler.error(new Error("callback must be a function"),{badCallback:t}),u=t,e}function l(t){if(!h)return e;var n=typeof t;return"undefined"===n?f=!0:"boolean"==n?f=t:"object"==n?(("object"!=typeof f||Array.isArray(f))&&(f={}),f=Object.merge(f,t)):Array.isArray(f)?f.push(t):f=[t],e}function c(t,n){return function(){return h?void(n||l()):t.apply(e,arguments)}}void 0===n&&(n={}),n.suspend=n.suspend||"suspend",n.resume=n.resume||"resume",n.outdate=n.outdate||"outdate",n.delegate=n.delegate||"delegate",n.isSuspended=n.isSuspended||"isSuspended",n.onSuspend=n.onSuspend||"onSuspend",n.onResume=n.onResume||"onResume";var d,u,h=!!t,f=!!t;for(var p in n)void 0!==e[n[p]]&&errorHandler.error(new Error("can not make this to a suspendable, because a needed function is blocked"),{blockedFunction:p});return e[n.suspend]=i,e[n.resume]=r,e[n.outdate]=l,e[n.delegate]=c,e[n.isSuspended]=o,e[n.onSuspend]=a,e[n.onResume]=s,e};"undefined"!=typeof exports?module.exports=e:("undefined"==typeof Extend&&(Extend={}),Extend.Suspendable=e)}(),"undefined"!=typeof exports&&(module.exports=buildTree),"undefined"==typeof Helper&&(Helper={}),Helper.Cache=function(e){var t=this,n={};return e=e||6e4,t.set=function(i,r,o){return n[i]={value:r,validUntil:Date.now()+(o||e)},t},t.get=function(e){return void 0!==n[e]&&n[e].validUntil>Date.now()?n[e].value:void 0},t.unset=function(e){return void 0!==n[e]&&delete n[e],t},t},"undefined"==typeof Helper&&(Helper={}),Helper.Deferred=function(e,t){function n(){for(var e=arguments;s.length;)s.shift().apply(i,e);delete i.reject,delete i.resolve,o=void 0,a=void 0,s=void 0,i.promise.done=function(e){return r.success&&e.apply(i,r.data),i.promise},i.promise.fail=function(e){return r.success||e.apply(i,r.data),i.promise},i.promise.always=function(e){return void 0!==r.success&&e.apply(i,r.data),i.promise}}t=t!==!1;var i=this,r={success:void 0,data:void 0},o=[],a=[],s=[];return i.isOpen=function(){return void 0===r.success},i.resolve=function(){var e=arguments;for(r.success=!0,r.data=e;o.length;)o.shift().apply(i,e);return n.apply(i,e),i},i.reject=function(){var e=arguments;for(r.success=!1,r.data=e;a.length;)a.shift().apply(i,e);return n.apply(i,e),i},i.promise={},i.promise.done=function(e){return"function"!=typeof e?i.promise:void 0===r.success?(o.push(e),i.promise):(r.success===!0&&e.apply(i,r.data),i.promise)},i.promise.fail=function(e){return"function"!=typeof e?i.promise:void 0===r.success?(a.push(e),i.promise):(r.success===!1&&e.apply(i,r.data),i.promise)},i.promise.always=function(e){return"function"!=typeof e?i.promise:void 0===r.success?(s.push(e),i.promise):(void 0!==r.success&&e.apply(i,r.data),i.promise)},i},Helper.Deferred.prototype.resolve=Helper.Deferred.prototype.reject=function(){errorHandler.error("Deferred already complete")},"undefined"==typeof Helper&&(Helper={}),function(){function e(e,n,i,r){var o=t(e,n,i,r);if(o)return o-e}function t(e,t,r,o){if(e=parseInt(e,10),t=parseInt(t,10),e&&t){r=parseFloat(r),o=parseInt(o,10)||i(e);var a=n(e,t);return e+o*(r-a)}}function n(e,t){var n=t-e;return Math.abs(n)>400&&(n=n>0?400:-400),1/(1+Math.pow(10,n/400))}function i(e){return e>=2400?10:20}Helper.EloChangeFromChessGame=function(e,t,n){if(!e.isOver()||e.getDepth()<5)return{white:void 0,black:void 0};var i=e.getGameStatus().result;return Helper.EloChange(t.elo,n.elo,i.white,i.black,t.eloK,n.eloK)},Helper.EloChange=function(e,t,n,i,r,o){return Object.map(Helper.EloChangeHighPrecision(e,t,n,i,r,o),function(e){return isNaN(e)?e:Math.round(e)})},Helper.EloChangeHighPrecision=function(t,n,i,r,o,a){return{player:e(t,n,i,o),opponent:e(n,t,r,a)}}}(),"undefined"==typeof Helper&&(Helper={}),Helper.FixedSizeQueue=function(e,t){t=t||{};var n=this,i=[];return n.push=function(t){for(i=i.concat(t);i.length>e;)i.shift();return n},n.min=t.min||function(){return Math.min.apply(void 0,i)},n.max=t.max||function(){return Math.max.apply(void 0,i)},n.avg=t.avg||function(){return i.length?i.reduce(function(e,t){return e+t})/i.length:void 0},n.sum=t.sum||function(){return i.length?i.reduce(function(e,t){return e+t}):0},n.filter=t.filter||function(e){return i.filter(e)},n.find=t.find||function(e){return i.find(e)},n.remove=t.remove||function(e){return i=n.filter(function(){return!e.apply(this,arguments)}),n},n.getSize=t.getSize||function(){return i.length},n.getAll=function(){return Object.copy(i)},n.flush=function(){return i=[],n},n},Helper.formatTimeUsage=function(e,t){var n=Date.getSplitedTime(e);return n.hours>0?n.hours+"h"+n.minutes.toString().lpad("0",2)+"m":n.minutes>0?n.minutes+"m"+n.seconds.toString().lpad("0",2)+"s":n.seconds>9?n.seconds+"s":t&&n.seconds>0?n.seconds+"."+n.milliseconds.toString().lpad("0",3).substr(0,2)+"s":n.seconds>0?n.seconds+"s":t&&n.milliseconds>0?n.milliseconds+"ms":""},"undefined"==typeof Helper&&(Helper={}),Helper.MessageQueue=function(e,t,n){function i(){"function"==typeof n&&(o(),l=setTimeout(r,t))}function r(){s=void 0,n()}function o(){void 0!==l&&(clearTimeout(l),l=void 0)}function a(){for(var t=Object.keys(d).length;void 0!==d[s];){var n=d[s];delete d[s],t--,e(n),s++}t||o()}"function"!=typeof e&&errorHandler.error(new Error("need function to process messages"));var s,l,c=this;t=t||5e3;var d={};return c.addMessage=function(e,t){return d[e]=t,void 0===s?c:(e===s?a():void 0===l&&e>s&&i(),c)},c.reset=c.start=function(e){s=e;for(var t in d)if(parseInt(t,10)<s)delete d[t];else var n=!0;return n&&i(),a(),c},c},"undefined"==typeof Helper&&(Helper={}),function(){Helper.timer={},Helper.timer.Timeout=function(e,t){function n(){a||(a=!0,r=new Date,i=setTimeout(function(){a=!1,t=0,e()},t))}var i,r,o=this,a=!1;return o.pause=function(){a&&(a=!1,clearTimeout(i),t-=new Date-r)},o.resume=n,o.getTimeLeft=function(){return a&&(this.pause(),this.resume()),t},o.toString=function(){return JSON.stringify({id:i,running:a,started:r,timeLeft:this.getTimeLeft()})},n(),o},Helper.timer.Countdown=function(e,t,n,i){function r(e,t,n,i){n=n||dummy,i=i||dummy;var a=e%t!==0?e%t:t,s=e-a;o=setTimeout(function(){n(s),s>0?r(s,t,n,i):i()},a)}var o,a=this;return r(e,t,n,i),a.stop=function(){o&&clearTimeout(o)},a}}(),"undefined"==typeof Helper&&(Helper={}),Helper.UUID=function(e){function t(){function e(e){var t=(Math.random().toString(16)+"000000000").substr(2,8);return e?"-"+t.substr(0,4)+"-"+t.substr(4,4):t}return e()+e(!0)+e(!0)+e()}e=e||t();var n,i=this;i.getLong=function(){return e},i.getShort=function(){if(void 0!==n)return n;var t="0123456789abcdef",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";if(e=e.replace(/[^0-9a-f]/gi,"").toLowerCase(),32!==e.length)return"";e=e.slice(6,8)+e.slice(4,6)+e.slice(2,4)+e.slice(0,2)+e.slice(10,12)+e.slice(8,10)+e.slice(14,16)+e.slice(12,14)+e.slice(16),e+="0";var r,o,a;n="";for(var s=0;33>s;)r=t.indexOf(e[s++])<<8|t.indexOf(e[s++])<<4|t.indexOf(e[s++]),o=r>>6,a=63&r,n+=i[o]+i[a];return n},i.isValid=function(){if(22===e.length)var t=/^[0-9a-zA-Z_-]{22}$/;else{if(36!==e.length)return!1;t=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/}return void 0!==e&&null!==e.match(t)}},"undefined"==typeof Helper&&(Helper={}),Helper.WhiteOrBlackList=function(e){return this.list=e||[],this.isBlackList=!0,this},Helper.WhiteOrBlackList.prototype.add=function(e){return this.list.push(e),this},Helper.WhiteOrBlackList.prototype.remove=function(e){return this.list.removeByValue(e),this},Helper.WhiteOrBlackList.prototype.clear=function(){return this.list=[],this},Helper.WhiteOrBlackList.prototype.whiteList=function(){return this.isBlackList=!1,this},Helper.WhiteOrBlackList.prototype.blackList=function(){return this.isBlackList=!0,this},Helper.WhiteOrBlackList.prototype.check=function(e){if(-1===e)return!1;var t=this.list.contains(e);return this.isBlackList?!t:t},"undefined"!=typeof exports&&(module.exports=Helper.WhiteOrBlackList),"undefined"==typeof Record&&(Record={}),Record.ChessGameSocketPR=function(e,t,n,i){function r(e){return e.isOver()||0===i||isNaN(i)||(e.getEndOfMainlinePosition().moveMadeAt+=i),e}function o(e){if(e){var t=e.getAllPositions();for(var n in c){var i=t[n]&&t[n].getEngineFen();i&&(Handler.engine.set(i,"numerical",c[n]),delete c[n])}}}var a=a||{};a.encoders={chessGame:function(e){var t=r(Chess.couchToGame(e)).updateNextFreeKnotId(1e6).setDeleteMode({duringGame:{mainline:!1,sideline:!0},afterGame:{mainline:!1,sideline:!0}}).setMoveMode({duringGame:{mainline:!1,sideline:!0},afterGame:{mainline:!1,sideline:!0}}).setNoTimeout(!1).setClockStartMove(2).setRules("analyse");t.getStartPosition().countChildrenMoves()>0&&t.setCalcTimeSpendInThisMove(!0).setClockStartMove(1);var n=t.getAllPositions();for(var i in n)n[i].setSource("remote");return t}};var s=Extend.SocketPR(this,t,e,a,n),l={patch:s.patch,afterRefetch:s.afterRefetch};s.afterRefetch=function(e,t,n){return"chessGame"===e&&(t.emit("replaceChessGame",{oldGame:t,newGame:n}),t.setNoTimeout(!0).destroy()),{newData:!0}},s.patch=function(e,t){if("chessGame"===e){var n=s.get("chessGame");return Chess.gamePatch(n,t),0===n.getStartPosition().countChildrenMoves()?n.setClockStartMove(2).emit("movedPositionPointer.endOfMainline",n.getStartPosition()):n.setClockStartMove(1),n}return l.patch.apply(this,arguments)};var c={};return s.on("set.chessGame",function(e,t){o(t.value)}),s.on("set.engine",function(e,t){var n=t.diff||t.value;Object.forEach(n,function(e,n){c[n]=t.value[n]}),o(s.get("chessGame"))}),s},"undefined"==typeof Record&&(Record={}),Record.TournamentSocketPR=function(e,t,n){return Extend.SocketPR(this,t,e,{},n)},"undefined"==typeof Controller&&(Controller={}),function(){function e(e,t){return void 0===e?t:i.indexOf(e)}function t(e,t){var n={};"string"==typeof e&&(e=e.split(" "));for(var i in t){var r=e.indexOf(i);r>-1&&r<e.length-1&&(n[t[i]]=e[r+1])}return n}function n(e,t,n,i){void 0===i&&(i=function(e){return e});for(var r=0;r<n.length;r++){var o=e[n[r]];void 0!==o&&(t[n[r]]=i(o))}return t}var i=["starting","ready","idle","busy","error","terminated"],r={evaluationAntiHammer:[-1]};Controller.UCI=function(o,a){function s(e){return y("error"),x.emit("evaluation.finished",{error:e}),v(),b("quit"),x}function l(e){return C=e.replace(/^id name /,""),x}function c(e){e=e.replace(/^option name /,"");var t=e.split(" "),n=e.substr(0,e.indexOf("type")-1),i={type:t[t.indexOf("type")+1]};switch(i.type){case"spin":i.min=parseInt(t[t.indexOf("min")+1],10),i.max=parseInt(t[t.indexOf("max")+1],10),i["default"]=parseInt(t[t.indexOf("default")+1],10);break;case"check":i["default"]="true"===t[t.indexOf("default")+1];break;case"string":var r=t[t.indexOf("default")+1];"string"==typeof r&&(i["default"]=t[t.indexOf("default")+1].replace(/^<empty>$/,""));break;case"combo":i["default"]=t[t.indexOf("default")+1].replace(/^<empty>$/,""),i.values=[];for(var o=0;o<t.length;o++)"var"===t[o]&&i.values.push(t[o+1])}void 0!==i["default"]&&(S[n]&&(i.current=S[n].current),void 0===i.current&&(i.current=i["default"])),S[n]=i}function d(e){if(m("error"))return x;g("busy"),e=e.replace(/^bestmove /,"");var t=e.split(" ponder "),n=t[0],i=x.getEvaluation();if(i.evaluations||(i.evaluations=[]),i.evaluations[0]||(i.evaluations[0]={}),!(-1!==n.indexOf("none")||i.evaluations&&i.evaluations[0]&&i.evaluations[0].moves&&i.evaluations[0].moves[0])){errorHandler.warning(new Error("no moves stored in evaluation, so picking the bestmove now"),{bestMove:n,fen:x.getPosition()});var r=new Chess.Position({fen:x.getPosition()});r.isLegalMove(Chess.translate.canToMove(n))&&(i.evaluations[0].moves=[n])}i.evaluations&&i.evaluations[0]&&(i.evaluations[0].moves&&i.evaluations[0].moves[0]||0===i.evaluations[0].mate)?x.emit("evaluation.finished",i):(errorHandler.warning(new Error("binary finished task, but no valid move has been found"),{evaluation:i,fen:x.getPosition()}),x.emit("evaluation.finished",i));for(var o in I)x.setOption(o,I[o]),delete I[o];return Q=100,y("idle"),x}function u(e){if(m("error"))return x;g("busy"),e.replace(/^info /,"");var n=t(e,{multipv:"multipv",cp:"score",mate:"mate"});if(n.multipv=parseInt(n.multipv-1,10),isNaN(n.multipv))return x;if(void 0===n.score&&void 0===n.mate)return errorHandler.error(new Error("There is an engine line with neither score nor mate information"),{line:e,score:n.score,mate:n.mate},!1);if(void 0!==n.mate&&(n.mate=parseInt(n.mate,10)),void 0!==n.score&&(n.score=parseInt(n.score,10)),0===n.mate)return x;e.indexOf(" pv ")>-1&&(n.moves=e.split(" pv ").pop().trim().split(" ",Q));for(var i=0;i<T.evaluations.length;i++)if(n.moves&&T.evaluations[i]&&T.evaluations[i].moves&&T.evaluations[i].moves[0]===n.moves[0]){var r=n.multipv;n.multipv=i;break}void 0===T.evaluations[n.multipv]&&(T.evaluations[n.multipv]={});var o=T.evaluations[n.multipv];void 0!==n.score?(o.score=n.score*(T.nextMoveIsWhite?1:-1),delete o.mate):void 0!==n.mate&&(delete o.score,o.mate=n.mate*(T.nextMoveIsWhite?1:-1)),n.moves&&(o.moves=n.moves),void 0!==r&&T.evaluations.move(n.multipv,r);var a=Date.now();return j+h(M)<=a&&(M++,j=a,x.emit("evaluation",x.getEvaluation())),x}function h(e){return a.evaluationAntiHammer[Math.min(e,a.evaluationAntiHammer.length-1)]}function f(e){if(m("error"))return x;g("busy"),e.replace(/^info /,"");var i=t(e,{depth:"depth",seldepth:"selDepth",tbhits:"tbHits",time:"time",nodes:"nodes",nps:"nodesPerSecond"}),r=t(e,{cp:"score",mate:"mate"});return 0===parseInt(r.mate,10)&&(parseInt(i.depth,10)>0||e.contains("multipv"))?x:(n(i,T,["nodesPerSecond","tbHits","selDepth","depth","time","nodes"],function(e){return parseInt(e,10)}),Object.keys(r).length&&(_=r),0===parseInt(r.mate,10)&&x.stop(),x)}function p(t,n){var r=e(t,0),o=e(n,i.length-1);return(r>P||P>o)&&errorHandler.critical(new Error("engine is in wrong state"),{currentStatus:i[P],requiredLowStatus:t,requiredHighStatus:n}),x}function m(e){return i[P]===e}function g(e){m(e)||errorHandler.critical(new Error("engine is in wrong state"),{currentStatus:i[P],requiredStatus:e})}function v(){T={nextMoveIsWhite:!0,evaluations:[]},_=void 0}function y(e){var t=i.indexOf(e);return-1===t?errorHandler.critical(new Error("this engine state is not defined"),{possibleStatus:i,newStatus:e}):P!==t&&(P=t,x.emit("status."+i[P],i[P])),x}function b(e){o.write(e)}function w(e,t){for(var n=0;n<B.length;n++)if(B[n].regExp.test(t)&&(B[n].callback(t),B[n].stopParsing))return}function k(){P=0,S={},I={},a=a||{};for(var e in r)void 0===a[e]&&(a[e]=r[e]);v(),o.start(),b("uci")}var x=Extend.Publisher(this);a=a||{};var C,j,T,_,S,I,P=0,M=0,Q=100,B=[{regExp:/^uciok$/,stopParsing:!0,callback:function(){b("isready")}},{regExp:/^readyok$/,stopParsing:!0,callback:function(){if(y("ready"),a.options)for(var e in a.options)x.getOption(e)&&x.setOption(e,a.options[e]);y("idle")}},{regExp:/^option name /,stopParsing:!0,callback:c},{regExp:/^id name /,stopParsing:!0,callback:l},{regExp:/^bestmove /,stopParsing:!0,callback:d},{regExp:/^info string/,stopParsing:!0,callback:dummy},{regExp:/^info /,callback:f},{regExp:/ multipv /,callback:u},{regExp:/^ERROR: /,stopParsing:!0,callback:s}];return x.getName=function(){return C},x.getEvaluation=function(){p("idle");var e=n(T,{engineName:x.getName()},["nodes","nodesPerSecond","depth","time","evaluations"]);return T.evaluations&&(e.evaluations=T.evaluations.slice().sort(function(e,t){var n=[],i=1e9;return[e,t].forEach(function(e){return void 0!==e.mate?e.mate<0?n.push(-i-e.mate):n.push(i-e.mate):n.push(e.score)}),n[1]-n[0]})),1===T.depth&&T.selDepth>T.depth&&T.tbHits&&(e.depth=T.selDepth),e.evaluations&&e.evaluations[0]||!_||0!==parseInt(_.mate,10)||(e.evaluations=[{mate:0,moves:[]}]),e},x.getOption=function(e){return p("ready"),void 0===e?S:S[e]},x.setOption=function(e,t){p("ready","busy");var n=S[e];if(!n)return errorHandler.warning("the engine does not offer this option",{optionName:e,newValue:t}),x;switch(n.type){case"spin":t=parseInt(t,10),isNaN(t)&&errorHandler.critical(new Error("value is not a number"),{currentOption:n,newValue:t}),(n.min>t||t>n.max)&&errorHandler.critical(new Error("value out of allowed range"),{currentOption:n,newValue:t});break;case"check":"boolean"!=typeof t&&errorHandler.critical(new Error("value is not a boolean"),{currentOption:n,newValue:t});break;case"combo":n.values.contains(t)||errorHandler.critical(new Error("value is not in the predefined combo list"),{
values:n.values,newValue:t})}return b("setoption name "+e+("button"===n.type?"":" value "+t)),n.current=t,x},x.getStatus=function(){return i[P]},x.getPosition=function(){return p("idle"),T.fenPosition},x.getLatestInfo=function(){return T},x.setPosition=function(e,t){m("error")?y("idle"):g("idle");var n=new Chess.Position({dontCheckForInsufficentMaterial:!0,fen:e});if(t)for(var i=0;i<t.length;i++)n=n.move({move:Chess.translate.canToMove(t[i])});return v(),T.nextMoveIsWhite="w"===n.moveRight,T.fenPosition=n.toString(),b("position fen "+T.fenPosition),x},x.evaluate=function(e){p("ready","idle"),y("busy");var t=[];if("object"==typeof e){if("object"==typeof e.options)for(var n in e.options){var i=x.getOption(n);if(i){var r=i.current;I[n]=r,x.setOption(n,e.options[n])}}void 0!==e.lineLimit&&(Q=parseInt(e.lineLimit,10)),void 0!==e.time&&t.push("movetime",e.time),void 0!==e.depth&&t.push("depth",e.depth),void 0!==e.nodes&&t.push("nodes",e.nodes),void 0!==e.mate&&t.push("mate",e.mate)}return 0===t.length&&t.push("infinite"),j=Date.now(),M=0,b("go "+t.join(" ")),x},x.newGame=function(){return b("ucinewgame"),x},x.stop=function(){p("busy","error"),b("stop")},x.restart=k,o.on("data",w),o.on("closed",function(){y("terminated"),k()}),k(),x}}(),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery.ui.widget"],e):e(window.jQuery)}(function(e){"use strict";e.support.xhrFileUpload=!(!window.XMLHttpRequestUpload||!window.FileReader),e.support.xhrFormDataFileUpload=!!window.FormData,e.widget("blueimp.fileupload",{options:{namespace:void 0,dropZone:e(document),pasteZone:e(document),fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,formData:function(e){return e.serializeArray()},add:function(e,t){t.submit()},processData:!1,contentType:!1,cache:!1},_refreshOptionsList:["namespace","fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_BitrateTimer:function(){this.timestamp=+new Date,this.loaded=0,this.bitrate=0,this.getBitrate=function(e,t,n){var i=e-this.timestamp;return(!this.bitrate||!n||i>n)&&(this.bitrate=(t-this.loaded)*(1e3/i)*8,this.loaded=t,this.timestamp=e),this.bitrate}},_isXHRUpload:function(t){return!t.forceIframeTransport&&(!t.multipart&&e.support.xhrFileUpload||e.support.xhrFormDataFileUpload)},_getFormData:function(t){var n;return"function"==typeof t.formData?t.formData(t.form):e.isArray(t.formData)?t.formData:t.formData?(n=[],e.each(t.formData,function(e,t){n.push({name:e,value:t})}),n):[]},_getTotal:function(t){var n=0;return e.each(t,function(e,t){n+=t.size||1}),n},_onProgress:function(e,t){if(e.lengthComputable){var n,i,r=+new Date;if(t._time&&t.progressInterval&&r-t._time<t.progressInterval&&e.loaded!==e.total)return;t._time=r,n=t.total||this._getTotal(t.files),i=parseInt(e.loaded/e.total*(t.chunkSize||n),10)+(t.uploadedBytes||0),this._loaded+=i-(t.loaded||t.uploadedBytes||0),t.lengthComputable=!0,t.loaded=i,t.total=n,t.bitrate=t._bitrateTimer.getBitrate(r,i,t.bitrateInterval),this._trigger("progress",e,t),this._trigger("progressall",e,{lengthComputable:!0,loaded:this._loaded,total:this._total,bitrate:this._bitrateTimer.getBitrate(r,this._loaded,t.bitrateInterval)})}},_initProgressListener:function(t){var n=this,i=t.xhr?t.xhr():e.ajaxSettings.xhr();i.upload&&(e(i.upload).bind("progress",function(e){var i=e.originalEvent;e.lengthComputable=i.lengthComputable,e.loaded=i.loaded,e.total=i.total,n._onProgress(e,t)}),t.xhr=function(){return i})},_initXHRData:function(t){var n,i=t.files[0],r=t.multipart||!e.support.xhrFileUpload,o=t.paramName[0];(!r||t.blob)&&(t.headers=e.extend(t.headers,{"X-File-Name":i.name,"X-File-Type":i.type,"X-File-Size":i.size}),t.blob?r||(t.contentType="application/octet-stream",t.data=t.blob):(t.contentType=i.type,t.data=i)),r&&e.support.xhrFormDataFileUpload&&(t.postMessage?(n=this._getFormData(t),t.blob?n.push({name:o,value:t.blob}):e.each(t.files,function(e,i){n.push({name:t.paramName[e]||o,value:i})})):(t.formData instanceof FormData?n=t.formData:(n=new FormData,e.each(this._getFormData(t),function(e,t){n.append(t.name,t.value)})),t.blob?n.append(o,t.blob,i.name):e.each(t.files,function(e,i){i instanceof Blob&&n.append(t.paramName[e]||o,i,i.name)})),t.data=n),t.blob=null},_initIframeSettings:function(t){t.dataType="iframe "+(t.dataType||""),t.formData=this._getFormData(t),t.redirect&&e("<a></a>").prop("href",t.url).prop("host")!==location.host&&t.formData.push({name:t.redirectParamName||"redirect",value:t.redirect})},_initDataSettings:function(e){this._isXHRUpload(e)?(this._chunkedUpload(e,!0)||(e.data||this._initXHRData(e),this._initProgressListener(e)),e.postMessage&&(e.dataType="postmessage "+(e.dataType||""))):this._initIframeSettings(e,"iframe")},_getParamName:function(t){var n=e(t.fileInput),i=t.paramName;return i?e.isArray(i)||(i=[i]):(i=[],n.each(function(){for(var t=e(this),n=t.prop("name")||"files[]",r=(t.prop("files")||[1]).length;r;)i.push(n),r-=1}),i.length||(i=[n.prop("name")||"files[]"])),i},_initFormSettings:function(t){t.form&&t.form.length||(t.form=e(t.fileInput.prop("form")),t.form.length||(t.form=e(this.options.fileInput.prop("form")))),t.paramName=this._getParamName(t),t.url||(t.url=t.form.prop("action")||location.href),t.type=(t.type||t.form.prop("method")||"").toUpperCase(),"POST"!==t.type&&"PUT"!==t.type&&(t.type="POST"),t.formAcceptCharset||(t.formAcceptCharset=t.form.attr("accept-charset"))},_getAJAXSettings:function(t){var n=e.extend({},this.options,t);return this._initFormSettings(n),this._initDataSettings(n),n},_enhancePromise:function(e){return e.success=e.done,e.error=e.fail,e.complete=e.always,e},_getXHRPromise:function(t,n,i){var r=e.Deferred(),o=r.promise();return n=n||this.options.context||o,t===!0?r.resolveWith(n,i):t===!1&&r.rejectWith(n,i),o.abort=r.promise,this._enhancePromise(o)},_chunkedUpload:function(t,n){var i,r,o,a,s=this,l=t.files[0],c=l.size,d=t.uploadedBytes=t.uploadedBytes||0,u=t.maxChunkSize||c,h=l.slice||l.webkitSlice||l.mozSlice;return this._isXHRUpload(t)&&h&&(d||c>u)&&!t.data?n?!0:d>=c?(l.error="Uploaded bytes exceed file size",this._getXHRPromise(!1,t.context,[null,"error",l.error])):(r=Math.ceil((c-d)/u),i=function(n){return n?i(n-=1).pipe(function(){var i=e.extend({},t);return i.blob=h.call(l,d+n*u,d+(n+1)*u),i.chunkIndex=n,i.chunksNumber=r,i.chunkSize=i.blob.size,s._initXHRData(i),s._initProgressListener(i),o=(e.ajax(i)||s._getXHRPromise(!1,i.context)).done(function(){i.loaded||s._onProgress(e.Event("progress",{lengthComputable:!0,loaded:i.chunkSize,total:i.chunkSize}),i),t.uploadedBytes=i.uploadedBytes+=i.chunkSize})}):s._getXHRPromise(!0,t.context)},a=i(r),a.abort=function(){return o.abort()},this._enhancePromise(a)):!1},_beforeSend:function(e,t){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer),this._active+=1,this._loaded+=t.uploadedBytes||0,this._total+=this._getTotal(t.files)},_onDone:function(t,n,i,r){this._isXHRUpload(r)||this._onProgress(e.Event("progress",{lengthComputable:!0,loaded:1,total:1}),r),r.result=t,r.textStatus=n,r.jqXHR=i,this._trigger("done",null,r)},_onFail:function(e,t,n,i){i.jqXHR=e,i.textStatus=t,i.errorThrown=n,this._trigger("fail",null,i),i.recalculateProgress&&(this._loaded-=i.loaded||i.uploadedBytes||0,this._total-=i.total||this._getTotal(i.files))},_onAlways:function(e,t,n,i){this._active-=1,i.textStatus=t,n&&n.always?(i.jqXHR=n,i.result=e):(i.jqXHR=e,i.errorThrown=n),this._trigger("always",null,i),0===this._active&&(this._trigger("stop"),this._loaded=this._total=0,this._bitrateTimer=null)},_onSend:function(t,n){var i,r,o,a=this,s=a._getAJAXSettings(n),l=function(n,r){return a._sending+=1,s._bitrateTimer=new a._BitrateTimer,i=i||(n!==!1&&a._trigger("send",t,s)!==!1&&(a._chunkedUpload(s)||e.ajax(s))||a._getXHRPromise(!1,s.context,r)).done(function(e,t,n){a._onDone(e,t,n,s)}).fail(function(e,t,n){a._onFail(e,t,n,s)}).always(function(e,t,n){if(a._sending-=1,a._onAlways(e,t,n,s),s.limitConcurrentUploads&&s.limitConcurrentUploads>a._sending)for(var i,r=a._slots.shift();r;){if(i=r.state?"pending"===r.state():!r.isRejected()){r.resolve();break}r=a._slots.shift()}})};return this._beforeSend(t,s),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(r=e.Deferred(),this._slots.push(r),o=r.pipe(l)):o=this._sequence=this._sequence.pipe(l,l),o.abort=function(){var e=[void 0,"abort","abort"];return i?i.abort():(r&&r.rejectWith(o,e),l(!1,e))},this._enhancePromise(o)):l()},_onAdd:function(t,n){var i,r,o,a,s=this,l=!0,c=e.extend({},this.options,n),d=c.limitMultiFileUploads,u=this._getParamName(c);if((c.singleFileUploads||d)&&this._isXHRUpload(c))if(!c.singleFileUploads&&d)for(o=[],i=[],a=0;a<n.files.length;a+=d)o.push(n.files.slice(a,a+d)),r=u.slice(a,a+d),r.length||(r=u),i.push(r);else i=u;else o=[n.files],i=[u];return n.originalFiles=n.files,e.each(o||n.files,function(r,a){var c=e.extend({},n);return c.files=o?a:[a],c.paramName=i[r],c.submit=function(){return c.jqXHR=this.jqXHR=s._trigger("submit",t,this)!==!1&&s._onSend(t,this),this.jqXHR},l=s._trigger("add",t,c)}),l},_replaceFileInput:function(t){var n=t.clone(!0);e("<form></form>").append(n)[0].reset(),t.after(n).detach(),e.cleanData(t.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(e,i){return i===t[0]?n[0]:i}),t[0]===this.element[0]&&(this.element=n)},_handleFileTreeEntry:function(t,n){var i,r=this,o=e.Deferred(),a=function(e){e&&!e.entry&&(e.entry=t),o.resolve([e])};return n=n||"",t.isFile?t._file?(t._file.relativePath=n,o.resolve(t._file)):t.file(function(e){e.relativePath=n,o.resolve(e)},a):t.isDirectory?(i=t.createReader(),i.readEntries(function(e){r._handleFileTreeEntries(e,n+t.name+"/").done(function(e){o.resolve(e)}).fail(a)},a)):o.resolve([]),o.promise()},_handleFileTreeEntries:function(t,n){var i=this;return e.when.apply(e,e.map(t,function(e){return i._handleFileTreeEntry(e,n)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(t){t=t||{};var n=t.items;return n&&n.length&&(n[0].webkitGetAsEntry||n[0].getAsEntry)?this._handleFileTreeEntries(e.map(n,function(e){var t;return e.webkitGetAsEntry?(t=e.webkitGetAsEntry(),t&&(t._file=e.getAsFile()),t):e.getAsEntry()})):e.Deferred().resolve(e.makeArray(t.files)).promise()},_getSingleFileInputFiles:function(t){t=e(t);var n,i,r=t.prop("webkitEntries")||t.prop("entries");if(r&&r.length)return this._handleFileTreeEntries(r);if(n=e.makeArray(t.prop("files")),!n.length){if(i=t.prop("value"),!i)return e.Deferred().resolve([]).promise();n=[{name:i.replace(/^.*\\/,"")}]}return e.Deferred().resolve(n).promise()},_getFileInputFiles:function(t){return t instanceof e&&1!==t.length?e.when.apply(e,e.map(t,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(t)},_onChange:function(t){var n=t.data.fileupload,i={fileInput:e(t.target),form:e(t.target.form)};n._getFileInputFiles(i.fileInput).always(function(e){i.files=e,n.options.replaceFileInput&&n._replaceFileInput(i.fileInput),n._trigger("change",t,i)!==!1&&n._onAdd(t,i)})},_onPaste:function(t){var n=t.data.fileupload,i=t.originalEvent.clipboardData,r=i&&i.items||[],o={files:[]};return e.each(r,function(e,t){var n=t.getAsFile&&t.getAsFile();n&&o.files.push(n)}),n._trigger("paste",t,o)===!1||n._onAdd(t,o)===!1?!1:void 0},_onDrop:function(e){e.preventDefault();var t=e.data.fileupload,n=e.dataTransfer=e.originalEvent.dataTransfer,i={};t._getDroppedFiles(n).always(function(n){i.files=n,t._trigger("drop",e,i)!==!1&&t._onAdd(e,i)})},_onDragOver:function(e){var t=e.data.fileupload,n=e.dataTransfer=e.originalEvent.dataTransfer;return t._trigger("dragover",e)===!1?!1:(n&&(n.dropEffect="copy"),void e.preventDefault())},_initEventHandlers:function(){var e=this.options.namespace;this._isXHRUpload(this.options)&&(this.options.dropZone.bind("dragover."+e,{fileupload:this},this._onDragOver).bind("drop."+e,{fileupload:this},this._onDrop),this.options.pasteZone.bind("paste."+e,{fileupload:this},this._onPaste)),this.options.fileInput.bind("change."+e,{fileupload:this},this._onChange)},_destroyEventHandlers:function(){var e=this.options.namespace;this.options.dropZone.unbind("dragover."+e,this._onDragOver).unbind("drop."+e,this._onDrop),this.options.pasteZone.unbind("paste."+e,this._onPaste),this.options.fileInput.unbind("change."+e,this._onChange)},_setOption:function(t,n){var i=-1!==e.inArray(t,this._refreshOptionsList);i&&this._destroyEventHandlers(),e.Widget.prototype._setOption.call(this,t,n),i&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var t=this.options;void 0===t.fileInput?t.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):t.fileInput instanceof e||(t.fileInput=e(t.fileInput)),t.dropZone instanceof e||(t.dropZone=e(t.dropZone)),t.pasteZone instanceof e||(t.pasteZone=e(t.pasteZone))},_create:function(){var t=this.options;e.extend(t,e(this.element[0].cloneNode(!1)).data()),t.namespace=t.namespace||this.widgetName,this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=this._loaded=this._total=0,this._initEventHandlers()},destroy:function(){this._destroyEventHandlers(),e.Widget.prototype.destroy.call(this)},enable:function(){var t=!1;this.options.disabled&&(t=!0),e.Widget.prototype.enable.call(this),t&&this._initEventHandlers()},disable:function(){this.options.disabled||this._destroyEventHandlers(),e.Widget.prototype.disable.call(this)},add:function(t){var n=this;t&&!this.options.disabled&&(t.fileInput&&!t.files?this._getFileInputFiles(t.fileInput).always(function(e){t.files=e,n._onAdd(null,t)}):(t.files=e.makeArray(t.files),this._onAdd(null,t)))},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var n,i,r=this,o=e.Deferred(),a=o.promise();return a.abort=function(){return i=!0,n?n.abort():(o.reject(null,"abort","abort"),a)},this._getFileInputFiles(t.fileInput).always(function(e){i||(t.files=e,n=r._onSend(null,t).then(function(e,t,n){o.resolve(e,t,n)},function(e,t,n){o.reject(e,t,n)}))}),this._enhancePromise(a)}if(t.files=e.makeArray(t.files),t.files.length)return this._onSend(null,t)}return this._getXHRPromise(!1,t&&t.context)}})}),function(){var e={},n={INVALID:"Invalid value: {{value}}",OPTION_SELECTED:"Option must be selected",VALUE_REQUIRED:"Value is required",VALUE_DONT_MATCH:"Values don't match",VALUES_MATCH:"Values match",COMPARISION_FAILURE:"Comparison failure",INVALID_DATE:"Invalid date",INVALID_RANGE:"Invalid range",VALUE_NOT_IN_RANGE:"Value not in required range",INVALID_LENGTH:"Invalid length"},i=function(e){for(var t=1;t<arguments.length;t++)for(var n in arguments[t])arguments[t].hasOwnProperty(n)&&(e[n]=arguments[t][n]);return e};e.base=function(e){var t={errors:[],skipOnError:!1,before:function(e){return!this.skipOnError||!e.hasClass("error")},validateField:function(e){return this.validateValue(this.value(e))},validateValue:function(e){return!0},extend:function(e){var t=this;return function(n){return i({},t,e,n)}},value:function(e){return jQuery&&e instanceof jQuery?void 0===e.val()?e.get(0).getAttribute("value"):e.val():void 0===e.value?e.getAttribute("value"):e.value},empty:function(e){return""===e||null===e},assert:function(e,t){return this.errors=[],e||this.errors.push(t),e}};return"object"==typeof e&&(t=i(t,e)),t},e.ajax=e.base().extend({server:!0,allowEmpty:!0,url:"",method:"",rule:"",validateField:function(e){if(!jQuery)return!0;var t=this.value(e);if(this.allowEmpty&&this.empty(t))return!0;this.url||(this.url=e.closest("form").attr("action")),this.method||(this.method=e.closest("form").attr("method"));var n={csrf:e.closest("form").find("input[name=csrf]").val()||config.csrf(),"ajax-validation":this.rule},i=e.attr("name");n[i]=t;var r=this.request(n);if(this.assert(!0),"object"==typeof r)for(var o in r)o===i&&(this.errors=this.errors.concat(r[o]));return 0===this.errors.length},validateFieldDeferred:function(e){if(!jQuery)return!0;var t=this.value(e);if(this.allowEmpty&&this.empty(t))return!0;this.url||(this.url=e.closest("form").attr("action")),this.method||(this.method=e.closest("form").attr("method"));var n={csrf:e.closest("form").find("input[name=csrf]").val()||config.csrf(),"ajax-validation":"*"},i=e.attr("name");return n[i]=t,n},request:function(e){var t;return e=e||{},jQuery.ajax({type:this.method,url:this.url,dataType:"json",data:e,async:!1,success:function(e){t=e}}),t}}),e.match=e.base().extend({pattern:/^$/,allowEmpty:!0,not:!1,validateValue:function(e){e=this.prepare(e);var i=this.regexp();if(!(i instanceof RegExp))if("string"==typeof i){var r=i.match(/^\/(.+)\/([gim]*)/);i=r?new RegExp(r[1],r[2]):new RegExp(i)}else i=new RegExp(i);var o=this.allowEmpty&&this.empty(e)||e.match(i)&&this.also(e);return this.assert(this.not!=!!o,t(n.INVALID,{"{{value}}":e}))},regexp:function(){return this.pattern},prepare:function(e){return e},also:function(e){return!0}}),e["boolean"]=e.base().extend({trueValue:"1",falseValue:"0",allowEmpty:!0,validateValue:function(e){return this.assert(this.allowEmpty&&this.empty(e)||e==this.trueValue||e==this.falseValue,t(n.INVALID,{"{{value}}":e}))}}),e.required=e.base().extend({requiredValue:"",validateField:function(e){var i=this.value(e);return e.is("[type=checkbox],[type=radio]")?this.assert(e.is(":checked")&&(!this.requiredValue||i==this.requiredValue),t(n.OPTION_SELECTED)):this.assert(!(this.empty(i)||this.requiredValue&&i!=this.requiredValue),t(n.VALUE_REQUIRED))},validateValue:function(e){return this.assert(!(this.empty(e)||this.requiredValue&&e!=this.requiredValue),t(n.INVALID,{"{{value}}":e}))}}),e.captcha=e.ajax().extend({rule:"CaptchaValidator",allowEmpty:!1}),e.compare=e.base().extend({compareValue:"",compareAttribute:"",operator:"=",validateField:function(e){var i=this.value(e),r=this.compareValue;if(this.compareAttribute){var o=e.attr("name"),a="";if(!o)return this.assert(!0);a=o.match(/\[[^\]]+\]$/)?o.replace(/\[[^\]]+\]$/,"["+this.compareAttribute+"]"):this.compareAttribute;var s=jQuery('[name="'+a+'"]');if(!s.length)return this.assert(!0);r=this.value(s)}switch("="!=this.operator&&"!="!=this.operator&&(i=parseFloat(i),r=parseFloat(r)),this.operator){case"=":case"==":return this.assert(i==r,t(n.VALUE_DONT_MATCH));case"!=":return this.assert(i!=r,t(n.VALUES_MATCH));case"<":return this.assert(r>i,t(n.COMPARISION_FAILURE));case"<=":return this.assert(r>=i,t(n.COMPARISION_FAILURE));case">":return this.assert(i>r,t(n.COMPARISION_FAILURE));case">=":return this.assert(i>=r,t(n.COMPARISION_FAILURE))}return this.assert(!0)},validateValue:function(e){if(this.compareValue){if("="!==this.operator&&"!="!==this.operator)var i=parseFloat(e),r=parseFloat(this.compareValue);else i=e,r=this.compareValue;switch(this.operator){case"=":case"==":return this.assert(i==r,t(n.VALUE_DONT_MATCH));case"!=":return this.assert(i!=r,t(n.VALUES_MATCH));case"<":return this.assert(r>i,t(n.COMPARISION_FAILURE));case"<=":return this.assert(r>=i,t(n.COMPARISION_FAILURE));case">":return this.assert(i>r,t(n.COMPARISION_FAILURE));case">=":return this.assert(i>=r,t(n.COMPARISION_FAILURE))}}return this.assert(!0)}}),e.date=e.base().extend({format:"MM/dd/yyyy",allowEmpty:!0,validateValue:function(e){return this.allowEmpty&&this.empty(e)?this.assert(!0):this.assert(f.parse(e,this.format),t(n.INVALID_DATE))}}),e.email=e.match().extend({pattern:/^[a-zA-Z0-9!#$%&\'*+\\/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&\'*+\\/=?^_`{|}~-]+)*@(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?$/,fullPattern:/^[^@]*<[a-zA-Z0-9!#$%&\'*+\\/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&\'*+\\/=?^_`{|}~-]+)*@(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?>$/,allowName:!1,allowEmpty:!0,regexp:function(){return this.allowName?this.fullPattern:this.pattern},also:function(e){return e.length<254}}),e.exist=e.ajax().extend({rule:"exist"}),e.file=e.base,e.inline=e.ajax().extend({rule:"inline"}),e.numerical=e.match().extend({integerOnly:!1,allowEmpty:!0,max:null,min:null,integerPattern:/^\s*[+-]?\d+\s*$/,numberPattern:/^\s*[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?\s*$/,regexp:function(){return this.integerOnly?this.integerPattern:this.numberPattern},also:function(e){return(this.empty(this.max)||parseFloat(this.max)>=parseFloat(e))&&(this.empty(this.min)||parseFloat(this.min)<=parseFloat(e))}}),e["in"]=e.base().extend({range:[],allowEmpty:!0,not:!1,validateValue:function(e){return this.allowEmpty&&this.empty(e)?this.assert(!0):Array.isArray(this.range)?this.assert(this.not!=this.range.contains(e),t("Value not in required range")):this.assert(!1,t(n.INVALID_RANGE))}}),e.safe=e.base,e.length=e.base().extend({allowEmpty:!0,max:null,min:null,is:null,validateValue:function(e){return this.allowEmpty&&this.empty(e)?!0:this.assert((!this.max||this.max>=e.length)&&(!this.min||this.min<=e.length)&&(!this.is||this.is==e.length),t(n.INVALID_LENGTH))}}),e.unique=e.ajax().extend({rule:"unique"}),e.unsafe=e.base,e.url=e.match().extend({pattern:/^({schemes}?\:\/\/[a-z][\w\.\-]+([\/\?].*)?)?(\#.*)?$/i,validSchemes:["http","https"],defaultScheme:null,allowEmpty:!0,prepare:function(e){!this.empty(e)&&this.defaultScheme&&-1==e.indexOf("://")&&(e=this.defaultScheme+"://"+e);var t=this.pattern.source;return-1!=t.indexOf("{schemes}")&&(this.pattern=new RegExp(t.replace("{schemes}","("+this.validSchemes.join("|")+")"),(this.pattern.ignoreCase?"i":"")+(this.pattern.global?"g":"")+(this.pattern.multiline?"m":""))),e}}),e.couchExists=e.ajax().extend({rule:"CouchExistsValidator"}),e.FEN=e.ajax().extend({rule:"FENValidator"}),e.html=e.ajax().extend({rule:"HtmlValidator"}),e.latitude=e.numerical().extend({integerOnly:!1,min:-90,max:90}),e.longitude=e.numerical().extend({integerOnly:!1,min:-180,max:180}),e.maxRows=e.ajax().extend({rule:"MaxRowsValidator"}),e.nick=e.ajax().extend({rule:"NickValidator"}),e.oneRequired=e.base().extend({}),e.permalink=e.match().extend({allowEmpty:!1,pattern:/^[a-z0-9-_]{3}[a-z0-9-_]*$/i}),e.UUID=e.match().extend({allowEmpty:!1,useShortVersion:!1,pattern:/^[0-9a-f]{8}(-[0-9a-f]{4}){3}-[0-9a-f]{12}$/,patternShort:/^[a-z0-9-_]{22}$/i,regexp:function(){return this.useShortVersion?this.patternShort:this.pattern}});var r=function(e,t){var n=e.attr("class");if(e.data("validatable-classes",n),!n)return[];for(var i=[],r=[],o="",a=0;a<n.length;a++)if("["===n.substr(a,1))for(var s=1;a<n.length&&(o+=n.substr(a,1),"]"!==n.substr(a,1)||(s--,0!==s));a++);else" "===n.substr(a,1)?(o.length&&r.push(o),o=""):o+=n.substr(a,1);o&&r.push(o),n=r;for(var a=0;a<n.length;a++){var l=n[a].match(/^validate\[(.*)\]$/);if(l){l=l[1];for(var c=[],d="",u={},h=0,f=!1,p=0;p<l.length;p++)if("["===l.substr(p,1)){var m="",g="",v=!1;for(p++;p<l.length;p++){if(!v||'"'!==l.substr(p,1)||g||f){if(v&&"["==l.substr(p,1)&&!g&&!f){g=[];var y="";for(p++;p<l.length;p++){if("]"===l.substr(p,1)){y&&g.push(y);break}","===l.substr(p,1)?(g.push(y),y=""):y+=l.substr(p,1)}continue}if("]"===l.substr(p,1)&&0===h&&!f){m&&("true"===g?g=!0:"false"===g&&(g=!1),u[m]=v?g:!0);break}","!==l.substr(p,1)||f?"="!==l.substr(p,1)||v?v?g+=l.substr(p,1):m+=l.substr(p,1):v=!0:(m&&("true"===g?g=!0:"false"===g&&(g=!1),u[m]=v?g:!0),v=!1,m="",g="")}else{for(p++;p<l.length&&'"'!==l.substr(p,1);p++)g+=l.substr(p,1);u[m]=g,y=""}"["!==l.substr(p,1)||f?"]"!==l.substr(p,1)||f||h--:h++,f="\\"===l.substr(p,1)}}else","===l.substr(p,1)?(d&&c.push([d,u]),d="",u={}):d+=l.substr(p,1);d&&c.push([d,u]);for(var p=0;p<c.length;p++)c[p][0]=c[p][0].replace(/^([A-Z])([^A-Z])/,function(e,t,n){return t.toLowerCase()+n}),c[p][0]=c[p][0].replace(/validator$/i,"");i=i.concat(c);var p}}return i},o=function(e){var t=e.data("field-errors");(!t||t&&t.length&&!t.closest("body").length)&&(t=e.siblings('.field-errors[data-field="'+e.attr("name")+'"]'),t.length||(t=e.closest("form").find('.field-errors[data-field="'+e.attr("name")+'"]')),!t.length&&e.attr("name")&&(t=jQuery('.field-errors[data-field="'+e.attr("name")+'"]')),t.length||(t=jQuery("<span/>").addClass("field-errors").attr("data-field",e.attr("name")).hide().insertAfter(e)),e.data("field-errors",t.appendTo(".pageContent").attr("x",e.attr("id"))));var n=e.closest(".modal, .bubble");n.length&&n.one("chess24:hide",function(){a(e)});var i=e.is(":visible")?e.offset():e.parent().offset(),r=e.is(":visible")?e.outerHeight():e.parent().outerHeight();return i&&t.css({left:i.left+"px",top:i.top+r+"px"}),t},a=function(e){if(e.is("form"))e.find("input,select,textarea").each(function(){a(jQuery(this))});else{var t=e.attr("class");if(!t)return;t=t.split(" ");for(var n=0;n<t.length;n++)"error"===t[n].substr(0,5)&&e.removeClass(t[n]);var i=o(e);i.hide().html(""),e.find(".form-errors, .field-errors").html("")}},s=function(t,n){a(t);for(var i=[],o=r(t,"skip"===n),s=!1,l=0;l<o.length;l++){var c=e[o[l][0]];if(c){if(c=c(o[l][1]),c.server){if("skip"===n)continue;if("return"===n){i.push(o[l]);continue}}c.before(t)&&!c.validateField(t)&&(t.trigger("validatable:error",{name:o[l][0],errors:c.errors}),s=!0)}}return s||t.trigger("validatable:ok"),"return"===n?i:void 0},l=function(t,n){a(t);var i=t.find("input,select,textarea"),r=!1,o=void 0;if(i.each(function(){var t=jQuery(this),i=s(t,n?"skip":"return");if(r=r||t.hasClass("error"),i)for(var a=0;a<i.length;a++){var l=e[i[a][0]];if(l){l=l(i[a][1]);var c=l.validateFieldDeferred(t);"object"==typeof c&&(o=jQuery.extend(o||{},c))}}}),o){var l=e.ajax();l.url=t.attr("action")||"",l.method=t.attr("method")||"post";var c=l.request(o);if("object"==typeof c){r=!0;for(var d in c)t.find('[name="'+d+'"]').trigger("validatable:error",{name:"",errors:c[d]})}}return t[r?"addClass":"removeClass"]("error"),!r},c=function(e,t){return"reset"===t?(a(e),void e.off("validatable:go").data("validatable",0)):"validate"===t?!e.trigger("validatable:go").hasClass("error"):"clientvalidate"===t?!e.trigger("validatable:go",!0).hasClass("error"):void 0},d=function(e,t){if(!e.data("validatable")){e.data("validatable",1),e.on("validatable:go",function(t,n){try{t.stopPropagation()}catch(i){t.cancelBubble=!0}s(e,n?"skip":void 0)}),e.on("validatable:error",function(t,n){var i=o(e);e.addClass("error error-"+n.name);var r=e.attr("data-error-"+n.name.toLowerCase())||e.attr("data-error-"+n.name.toLowerCase()+"validator")||e.attr("data-error")||n.errors.join("<br/>");r&&(i.html(r),i.show(),i.attr("data-success-class")&&i.removeClass(i.attr("data-success-class")),i.attr("data-error-class")&&i.addClass(i.attr("data-error-class")))}),e.on("validatable:ok",function(t){var n=o(e);n.length&&(n.attr("data-success-class")?n.addClass(n.attr("data-success-class")):n.hide(),n.attr("data-error-class")&&n.removeClass(n.attr("data-error-class")))});var n="change";e.is("input")&&"checkbox"!==e.attr("type")&&"radio"!==e.attr("type")&&"hidden"!==e.attr("type")&&(n="blur"),e.on(n,function(){a(e),e.closest("form").data("validatable")||e.trigger("validatable:go","clientvalidate"===t)}),e.on("focus click",function(){var t=o(e);t.hide()})}},u=function(e,t){return"validate"===t?!e.trigger("validatable:go").hasClass("error"):"clientvalidate"===t?!e.trigger("validatable:go",!0).hasClass("error"):"reset"===t?(a(e),e.find("input,select,textarea").each(function(){a(jQuery(this))}),void e.off("validatable:go").off("submit.validatable").data("validatable",0)):"clear"===t?void a(e):void 0},h=function(e,t){if(!e.data("validatable")){e.data("validatable",1);var n=e.find("input,select,textarea");n.each(function(){jQuery(this).validatable("reset")}),e.on("submit.validatable validatable:go",function(t,n){if(l(e,n),e.hasClass("error")){for(var i=!1,r=e.parent();!r.is("body")&&r.length;){if("fixed"===r.css("position")){i=!0;break}r=r.parent()}if(!i){var o=e.find(".error:first").offset().top;(o<jQuery("body").prop("scrollTop")||o>jQuery("body").prop("scrollTop")+jQuery(window).height())&&jQuery("html,body").animate({scrollTop:o-100})}return t.stopPropagation(),t.preventDefault(),!1}})}};jQuery&&(jQuery.fn.validatable=function(e){var t=this;return this.each(function(){var n=jQuery(this);if(n.is("input,select,textarea")){var i=d(n,e);e&&(i=c(n,e)),t="validate"===e||"clientvalidate"===e?i:t}else if(n.is("form")){var i=h(n,e);e&&(i=u(n,e)),t="validate"===e||"clientvalidate"===e?i:t}}),t},jQuery.fn.validatable.validators=e);var f={parse:function(e,t,n){t=t||"MM/dd/yyyy",n=n||[];for(var i,r,o,a,s,l,c,d,u=this.tokenize(t),h=0,f=e.length,p=0;p<u.length;p++){var m=u[p];switch(m){case"yyyy":if((i=this.parseInteger(e,h,4,4))===!1)return!1;h+=4;break;case"yy":if((i=this.parseInteger(e,h,1,2))===!1)return!1;h+=i.length;break;case"MMMM":var g={monthName:""};if((r=this.parseMonth(e,h,"wide",g))===!1)return!1;h+=g.monthName.length;break;case"MMM":var g={monthName:""};if((r=this.parseMonth(e,h,"abbreviated",g))===!1)return!1;h+=g.monthName.length;break;case"MM":if((r=this.parseInteger(e,h,2,2))===!1)return!1;h+=2;break;case"M":if((r=this.parseInteger(e,h,1,2))===!1)return!1;h+=r.length;break;case"dd":if((o=this.parseInteger(e,h,2,2))===!1)return!1;h+=2;break;case"d":if((o=this.parseInteger(e,h,1,2))===!1)return!1;h+=o.length;break;case"h":case"H":if((a=this.parseInteger(e,h,1,2))===!1)return!1;h+=a.length;break;case"hh":case"HH":if((a=this.parseInteger(e,h,2,2))===!1)return!1;h+=2;break;case"m":if((s=this.parseInteger(e,h,1,2))===!1)return!1;h+=s.length;break;case"mm":if((s=this.parseInteger(e,h,2,2))===!1)return!1;h+=2;break;case"s":if((l=this.parseInteger(e,h,1,2))===!1)return!1;h+=l.length;break;case"ss":if((l=this.parseInteger(e,h,2,2))===!1)return!1;h+=2;break;case"a":if((c=this.parseAmPm(e,h))===!1)return!1;void 0!==a&&(12==a&&"am"===c?a=0:12>a&&"pm"===c&&(a+=12)),h+=2;break;default:if(d=m.length,h>=f||"?"!==m.substr(0,1)&&e.substr(h,d)!==m)return!1;h+=d}}if(f>h)return!1;void 0===i&&(i=(new Date).getFullYear()),void 0===r&&(r=(new Date).getMonth()+1),void 0===o&&(o=(new Date).getDate()),2===(""+i).length&&(i+=i>=70?1900:2e3),i=parseInt(i),r=parseInt(r),o=parseInt(o),void 0===a&&void 0===s&&void 0===l?(a=0,s=0,l=0):(void 0===a&&(a=(new Date).getHours()),void 0===s&&(s=(new Date).getMinutes()),void 0===l&&(l=(new Date).getSeconds()),a=parseInt(a),s=parseInt(s),l=parseInt(l));var v=new Date(i,r-1,o,a,s,l,0);return v.getFullYear()==i&&v.getMonth()+1==r&&v.getDate()==o&&v.getHours()==a&&v.getMinutes()==s&&v.getSeconds()==l?v.getTime():!1},tokenize:function(e){var t=e.length;if(!t)return[];for(var n=[],i=e[0],r=0,o=1;t>o;++o){var a=e[o];a!==i&&(n.push(e.substr(r,o-r)),i=a,r=o)}return n.push(e.substr(r,t-r)),n},parseInteger:function(e,t,n,i){for(var r=i;r>=n;--r){var o=e.substr(t,r);if(!isNaN(parseInt(o))&&parseInt(o)==o&&o>0&&o.length>=n)return o}return!1},parseAmPm:function(e,t){var n=e.substr(t,2).toLowerCase();return"am"===n||"pm"===n?n:!1},parseMonth:function(e,t,n,i){for(var r=e.length,o=1;r>=t+o;o++)if(i.monthName=e.substr(t,o),i.monthName.match(/^\p{L}+$/)){i.monthName=i.monthName.substr(0,-1);break}i.monthName=i.monthName.toLowerCase();var a=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],s=["january","february","march","april","may","june","july","august","september","october","november","december"],l=a.indexOf(i.monthName),c=s.indexOf(i.monthName);return-1==l&&-1==c?!1:(-1!=l?l:c)+1}}}(),function(e,t){"object"==typeof exports&&exports?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.Mustache={})}(this,function(e){function t(e){return"function"==typeof e}function n(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function i(e,t){return p.call(e,t)}function r(e){return!i(m,e)}function o(e){return String(e).replace(/[&<>"'\/]/g,function(e){return g[e]})}function a(t,i){
function o(){if(x&&!C)for(;g.length;)delete m[g.pop()];else g=[];x=!1,C=!1}function a(e){if("string"==typeof e&&(e=e.split(y,2)),!f(e)||2!==e.length)throw new Error("Invalid tags: "+e);d=new RegExp(n(e[0])+"\\s*"),u=new RegExp("\\s*"+n(e[1])),h=new RegExp("\\s*"+n("}"+e[1]))}if(!t)return[];var d,u,h,p=[],m=[],g=[],x=!1,C=!1;a(i||e.tags);for(var j,T,_,S,I,P,M=new c(t);!M.eos();){if(j=M.pos,_=M.scanUntil(d))for(var Q=0,B=_.length;B>Q;++Q)S=_.charAt(Q),r(S)?g.push(m.length):C=!0,m.push(["text",S,j,j+1]),j+=1,"\n"===S&&o();if(!M.scan(d))break;if(x=!0,T=M.scan(k)||"name",M.scan(v),"="===T?(_=M.scanUntil(b),M.scan(b),M.scanUntil(u)):"{"===T?(_=M.scanUntil(h),M.scan(w),M.scanUntil(u),T="&"):_=M.scanUntil(u),!M.scan(u))throw new Error("Unclosed tag at "+M.pos);if(I=[T,_,j,M.pos],m.push(I),"#"===T||"^"===T)p.push(I);else if("/"===T){if(P=p.pop(),!P)throw new Error('Unopened section "'+_+'" at '+j);if(P[1]!==_)throw new Error('Unclosed section "'+P[1]+'" at '+j)}else"name"===T||"{"===T||"&"===T?C=!0:"="===T&&a(_)}if(P=p.pop())throw new Error('Unclosed section "'+P[1]+'" at '+M.pos);return l(s(m))}function s(e){for(var t,n,i=[],r=0,o=e.length;o>r;++r)t=e[r],t&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(i.push(t),n=t));return i}function l(e){for(var t,n,i=[],r=i,o=[],a=0,s=e.length;s>a;++a)switch(t=e[a],t[0]){case"#":case"^":r.push(t),o.push(t),r=t[4]=[];break;case"/":n=o.pop(),n[5]=t[2],r=o.length>0?o[o.length-1][4]:i;break;default:r.push(t)}return i}function c(e){this.string=e,this.tail=e,this.pos=0}function d(e,t){this.view=null==e?{}:e,this.cache={".":this.view},this.parent=t}function u(){this.cache={}}var h=Object.prototype.toString,f=Array.isArray||function(e){return"[object Array]"===h.call(e)},p=RegExp.prototype.test,m=/\S/,g={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},v=/\s*/,y=/\s+/,b=/\s*=/,w=/\s*\}/,k=/#|\^|\/|>|\{|&|=|!/;c.prototype.eos=function(){return""===this.tail},c.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},c.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=t.length,t},d.prototype.push=function(e){return new d(e,this)},d.prototype.lookup=function(e){var n,i=this.cache,r=this.subView||(this.subView={});if(e in i)n=i[e];else{for(var o,a,s,l=this;l;){if(e.indexOf(".")>0)for(n=l.view,o=e.split("."),a=0;null!=n&&a<o.length;)s=n,n=n[o[a++]],r[n]=s;else n=l.view[e];if(null!=n)break;l=l.parent}i[e]=n}return t(n)&&(n=n.call(r[n]||this.view)),n},u.prototype.clearCache=function(){this.cache={}},u.prototype.parse=function(e,t){var n=this.cache,i=n[e];return null==i&&(i=n[e]=a(e,t)),i},u.prototype.render=function(e,t,n){var i=this.parse(e),r=t instanceof d?t:new d(t);return this.renderTokens(i,r,n,e)},u.prototype.renderTokens=function(n,i,r,o){function a(e){return d.render(e,i,r)}for(var s,l,c="",d=this,u=0,h=n.length;h>u;++u)switch(s=n[u],s[0]){case"#":if(l=i.lookup(s[1]),!l)continue;if(f(l))for(var p=0,m=l.length;m>p;++p)c+=this.renderTokens(s[4],i.push(l[p]),r,o);else if("object"==typeof l||"string"==typeof l)c+=this.renderTokens(s[4],i.push(l),r,o);else if(t(l)){if("string"!=typeof o)throw new Error("Cannot use higher-order sections without the original template");l=l.call(i.view,o.slice(s[3],s[5]),a),null!=l&&(c+=l)}else c+=this.renderTokens(s[4],i,r,o);break;case"^":l=i.lookup(s[1]),(!l||f(l)&&0===l.length)&&(c+=this.renderTokens(s[4],i,r,o));break;case">":if(!r)continue;l=t(r)?r(s[1]):r[s[1]],null!=l&&(c+=this.renderTokens(this.parse(l),i,r,l));break;case"&":l=i.lookup(s[1]),null!=l&&(c+=l);break;case"name":l=i.lookup(s[1]),null!=l&&(c+=e.escape(l));break;case"text":c+=s[1]}return c},e.name="mustache.js",e.version="0.8.1",e.tags=["{{","}}"];var x=new u;e.clearCache=function(){return x.clearCache()},e.parse=function(e,t){return x.parse(e,t)},e.render=function(e,t,n){return x.render(e,t,n)},e.to_html=function(n,i,r,o){var a=e.render(n,i,r);return t(o)?void o(a):a},e.escape=o,e.Scanner=c,e.Context=d,e.Writer=u}),"undefined"==typeof Handler&&(Handler={}),Handler.Highlight=function(e,t,n,i){function r(e){e.is(".highlight")||(e=e.siblings(".highlight"));var t=(e.attr("class")||"").replace(/^.*_(\d\d).*$/,"$1");return Chess.getSquare(parseInt(t.substr(0,1),10),parseInt(t.substr(1,1),10))}var o,a=this;e=jQuery(e),e.length||errorHandler.error("container not found in Handler.Highlight"),Extend.Subscriber(a,{},{afterLink:function(e){o=e.publisher}});var s,l={},c=!0,d=!1;return a.unHighlightAll=function(){return e.find(".highlight").attr("src",t.getHighlightUrl()),a},a.unHighlightCell=function(n){return e.find(".highlight_"+n).attr("src",t.getHighlightUrl()),a},a.highlightTargetSquares=function(e){if(!(c&&a.anyMovesAllowed&&e&&e.isOnBoard()))return a;for(var t=n("square",e),r=0;r<t.length;r++){var o=t[r].endSquare,s=void 0,l=i().getPiece(o);"-"!==l&&(s="take"),a.highlightCell(o.y.toString()+o.x.toString(),"green",s)}return a},a.highlightCellSelect=function(e,t,n){return a.highlightCell(e,t,"select",n)},a.highlightCellEmpty=function(e,t,n){return a.highlightCell(e,t,void 0,n)},a.highlightCellTake=function(e,t,n){return a.highlightCell(e,t,"take",n)},a.highlightCell=function(n,i,r,o){return c?(e.find(".highlight_"+n).attr("src",t.getHighlightUrl(i,r)),o&&(clearTimeout(l[n]),l[n]=setTimeout(function(){e.find(".highlight_"+n).attr("src")===t.getHighlightUrl(i,r)&&e.find(".highlight_"+n).attr("src",t.getHighlightUrl())},500)),a):a},a.activate=function(){return c=!0,a},a.deactivate=function(){return c=!1,a.unHighlightAll(),a},a.startDrawing=function(t){if(!o)return a;a.stopDrawing(),d=!0,s=["red","blue","green","yellow"].contains(t)?t:"red";var n,i,l=!1;return e.find(".highlight, .piece").off("click.highlight").on("click.highlight",function(){return l?void(l=!1):void o.addHighlight({frame:r(jQuery(this)),color:s})}).draggable({helper:function(){return jQuery("<span/>")},start:function(){n=r(jQuery(this))},stop:function(){n=void 0}}),e.find(".cell").droppable({tolerance:"pointer",drop:function(){n&&i&&(o.deleteHighlight(i),n.x!=i.line.x2||n.y!=i.line.y2?(delete i.temporary,o.addHighlight(i),l=!1):(o.addHighlight({frame:n,color:s}),l=!0),i=void 0,n=void 0)},over:function(){if(n){l=!0,i&&o.deleteHighlight(i);var e=r(jQuery(this).find(".highlight"));i={color:s,line:Chess.getMove(n.y,n.x,e.y,e.x),temporary:!0},(n.x!=e.x||n.y!=e.y)&&o.addHighlight(i)}}}),a},a.stopDrawing=function(){if(!d)return a;d=!1;var t=e.find(".highlight, .piece");return t.off("click.highlight"),t.filter(function(){return!!jQuery(this).data("ui-draggable")}).draggable("destroy"),e.find(".cell").filter(function(){return!!jQuery(this).data("ui-droppable")}).droppable("destroy"),a},a.isDrawing=function(){return d},a.startEraser=function(){return o?(a.stopEraser(),d=!0,e.find(".highlight, .piece").off("click.highlight").on("click.highlight",function(){var e=r(jQuery(this));o.getHighlights().filter(function(t){return t.line&&t.line.x1==e.x&&t.line.y1==e.y?!0:t.frame&&t.frame.x==e.x&&t.frame.y==e.y?!0:void 0}).forEach(function(e){o.deleteHighlight(e)})}),a):void 0},a.stopEraser=function(){return a.stopDrawing()},a},"undefined"==typeof Handler&&(Handler={}),Handler.KeyboardDispatcher=new function(){function e(e){e!==r&&(r&&t(r,!1),t(e,!0),r=e)}function t(e,t){s[e].setActive(t)}function n(e){var t=["setActive","getActive"],n=t.every(function(t){return"function"==typeof e[t]});return n}function i(e){var t=Object.findKey(s,function(t){return e===t});return t&&parseInt(t,10)}var r,o=0,a=this,s={},l={},c={};a.add=function(i,d){n(i)||errorHandler.error("Keyboard handler does not meet dispatcher's requirements",i),d||(d=jQuery(document));var u=++o;return s[u]=i,l[u]=d,r?t(u,!1):(r=u,t(u,!0)),d.on("mousedown.keyboardHandler-"+u,function(t){c[t]||(e(u),c[t]=!0,setTimeout(function(){delete c[t]},1e3))}),a},a.remove=function(e){var n=i(e);return void 0===n?a:(r===n&&(r=void 0),t(n,!1),l[n].off("mousedown.keyboardHandler-"+n),delete s[n],void delete l[n])},a.select=function(t){var n=i(t);n&&e(n)}},"undefined"==typeof Handler&&(Handler={}),Handler.Keyboard=function(){function e(e){function t(){for(var e,t=0;t<n.length;t++)if(n[t]instanceof Chess.Game||n[t]instanceof Chess.GameHandler){if(e)return!1;e=n[t]}if(!e)return!1;var i=e.getCurrentPosition();if(i.countChildrenMoves(!0)<2)return!1;if(o)o.select();else{for(var r=[],t=0;t<i.childrenMoves.length;t++){var s=i.childrenMoves[t].getSan();i.childrenMoves[t].isNullMove()||r.push({id:i.childrenMoves[t].knotId,text:("w"==i.moveRight?i.moveCounter+". ":i.moveCounter+"... ")+s})}o=new popupList(r,function(e){o.remove(),o=void 0,a("gotoId",e)})}return!0}function a(t,r){o&&(o.remove(),o=void 0);for(var a=0;a<n.length;a++)i&&"function"==typeof n[a][t]&&n[a][t](r);e.preventDefault()}if(!r&&i&&(r=!0,setTimeout(function(){r=!1},200),!jQuery(document.activeElement).attr("contenteditable"))){switch(document.activeElement.tagName.toLowerCase()){case"input":case"textarea":return}var s=Handler.Keyboard.keys;switch(e.keyCode){case s.VK_RIGHT:if(t())break;a("gotoNextPosition",!0);break;case s.VK_LEFT:a("gotoParentPosition");break;case s.VK_HOME:a("gotoStart");break;case s.VK_END:a("gotoEndOfLine",!0);break;case s.VK_UP:o?(o.up(),e.preventDefault()):a("showPrevGame");break;case s.VK_DOWN:o?(o.down(),e.preventDefault()):a("showNextGame")}}}if(Handler.Keyboard.instance)return Handler.Keyboard.instance;var t=this,n=[],i=!0,r=!1;Extend.Subscriber(t,{},{afterLink:function(e){n.contains(e.publisher)||n.push(e.publisher)},afterUnlink:function(e){n.removeByValue(e.publisher)}});var o;return t.setActive=function(e){i=e},t.getActive=function(){return i},jQuery(document).off("keydown.keyboardhandler").on("keydown.keyboardhandler",e),Handler.Keyboard.instance=t,t},Handler.Keyboard.keys={VK_TAB:9,VK_SHIFT:16,VK_CTRL:17,VK_ALT:18,VK_CAPS:20,VK_RETURN:13,VK_ESCAPE:27,VK_PAGE_UP:33,VK_PAGE_DOWN:34,VK_END:35,VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40,VK_DELETE:46,VK_F1:112,VK_F2:113,VK_F3:114,VK_F4:115,VK_F5:116,VK_F6:117,VK_F7:118,VK_F8:119,VK_F9:120,VK_F10:121,VK_F11:122,VK_F12:123,VK_COPY:67,VK_PASTE:86,VK_1:49,VK_2:50,VK_3:51,VK_4:52},function(){function e(){h&&n(h,!0)}function t(){c&&"busy"===c.getStatus()&&u.terminate(),o(),d=void 0}function n(e,t){if(h=e,d!==e&&window.Worker){c=c||a();var n=c.getStatus();("busy"!==n||e!==Chess.translate.longFenToEngineFen(c.getPosition()))&&(o(),window.settings.getBoolean("game-broadcast-engine")&&window.settings.getBoolean("game-broadcast-engine-local")&&(d=e,"undefined"!=typeof c&&u instanceof l?"idle"===n?i(t):"busy"===n&&c.stop():"idle"===n?i(t):"busy"===n&&(w.depth?c.stop():u.terminate())))}}function i(e){if(d){if(!e&&Handler.engine.get(d,f,!1,!1))return void(d=void 0);Handler.engine.once(d+":detailed."+m,r),c.setPosition(Chess.translate.engineFenToLongFen(d)).evaluate(w)}}function r(e,n){e.channel===d+":detailed."+m&&t()}function o(){d&&Handler.engine.off(d+":detailed."+m,r)}function a(){if(navigator.mimeTypes["application/x-pnacl"])u=new l(y);else{var e="object"==typeof WebAssembly&&WebAssembly.validate(Uint8Array.of(0,97,115,109,1,0,0,0))&&-1==navigator.userAgent.indexOf("Chrome");u=new s(e?v:g)}var t=new Controller.UCI(u,{evaluationAntiHammer:[500,1e3],options:k});return t.on("status.idle",function(){i()}),t.on("evaluation",function(e,n){n.source=p,Handler.engine.set(Chess.translate.longFenToEngineFen(t.getPosition()),f,n)}),t}function s(e){var t=Extend.Publisher(this);return t.start=function(){uci=new Worker(e),uci.addEventListener("message",function(e){t.emit("data",e.data)},!1)},t.terminate=function(){return uci&&uci.terminate(),t.emit("closed"),t},t.write=function(e){return uci.postMessage(e),t},t}function l(e){var t=Extend.Publisher(this);return t.start=function(){uci=document.createElement("embed"),uci.setAttribute("src",e),uci.setAttribute("type","application/x-pnacl"),uci.setAttribute("width",0),uci.setAttribute("height",0),document.body.appendChild(uci),uci.addEventListener("message",function(e){t.emit("data",e.data)},!1)},t.terminate=function(){return uci&&uci.remove(),t.emit("closed"),t},t.write=function(e){return uci.postMessage(e),t},t}var c,d,u,h,f="detailed",p="Local",m="Cloud",g="/engine/stockfish.js",v="/engine/stockfish.wasm.js",y="/engine/stockfish.nmf",b=config.level().toString(),w={guest:{depth:8},registered:{depth:12},premium:{}}[b],k={MultiPV:3};Handler.localEngine={newTask:n,stop:t},window.settings.on("settings.game-broadcast-engine-local.on",e),window.settings.on("settings.game-broadcast-engine-local.off",t)}(),"undefined"==typeof Handler&&(Handler={}),Handler.Movement=function(e,t,n,i,r){function o(e,t){return(t||n.moveRight===e)&&S.contains(e)?!0:!1}function a(){var e;return Q.draggable({helper:"clone",addClasses:!1,zIndex:100,start:function(n,i){e=jQuery(this),t.addClass("dragging"),e.stop(!0,!0).addClass("inDrag"),d(e.data("coordinates"),!0);var r=document.documentElement.scrollTop||document.body.scrollTop;jQuery(window).on("scroll",function(){$(window).scrollTop(r)})},stop:function(e,n){jQuery(this).css({left:"auto",top:"auto"}).removeClass("inDrag"),t.removeClass("dragging"),jQuery(window).off("scroll")}}).draggable("enable"),B.droppable({drop:function(t,n){var i=jQuery(this);if(i.removeClass("dropableSquareOver"),e){var r=i.offset(),o=e.offset();e.css({left:r.left-o.left+"px",top:r.top-o.top+"px"});var a=i.data("coordinates");d(a,!0),T.click&&e.data("coordinates")===a||p()}else{var s=n.draggable,l=s.data("new-piece");if(!l)return;f(i.data("coordinates"),l)}},over:function(e,t){jQuery(this).addClass("dropableSquareOver")},out:function(e,t){jQuery(this).removeClass("dropableSquareOver")}}),T.dragDrop=!0,j}function s(){return Q.off("click.movementHandler").on("click.movementHandler",function(){j.emit("pieceSelected"),d(jQuery(this).data("coordinates"))}),T.click=!0,j}function l(){return E.off("click.movementHandler"),E.on("click.movementHandler",function(){d(jQuery(this).data("coordinates"))}),T.click=!0,j}function c(e){if(!C)return j;var t=e.startSquare,i=e.endSquare,r=n.getPiece(t);if("-"===r)return!1;var o=r===r.toUpperCase()?"w":"b",a=!1;("P"===r&&1===t.y||"p"===r&&6===t.y)&&(a=!0);for(var s=Chess.getPiece(r.toLowerCase(),o,a),l=i.getNewSquare(-t.y,-t.x),c=s.getPotentialSquares(),d=0;d<c.length;d++)if(c[d].y===l.y&&c[d].x===l.x)return!0;return"k"!==r.toLowerCase()||4!==t.x||2!==i.x&&6!==i.x||!("w"===o&&0===i.y||"b"===o&&7===i.y)?!1:!0}function d(e,t){if(!T.click&&!t)return j;var i=Chess.getSquare(parseInt(e.substr(0,1)),parseInt(e.substr(1,1))),a=n.getPiece(i);if(a=a||"-","-"===a)var s;else s=a.toLowerCase()===a?"b":"w";if(b){if(b===i)return t||p(),j;var l=n.getPiece(b);if("-"===l)var d;else d=l.toLowerCase()===l?"b":"w";var f=Chess.getMove(b.y,b.x,i.y,i.x);n.isLegalMove(f)?v(f):n.isLegalMoveIfItWouldBeAPromotion(f)?y(f,d):1===S.length&&!o(d)&&o(d,!0)&&c(f)?(m(f),p()):o(s,!0)?h(i):I&&void 0!==r&&u(a,i,"red",!0)}else o(s,!0)?h(i):(I&&void 0!==r&&u(a,i,"red",!0),m());return j}function u(e,t,n,i){"-"===e?r.highlightCellEmpty(t.y.toString()+t.x.toString(),n,i):r.highlightCellTake(t.y.toString()+t.x.toString(),n,i)}function h(e){return p(e),void 0!==r&&g(e,"select"),m(),j}function f(t,n){var i=Chess.getSquare(parseInt(t.substr(0,1)),parseInt(t.substr(1,1))),r=e.getCurrentPosition();r.setPiece(i,n),r=new Chess.Position({fen:r.toString(!0),validators:e.getCurrentGame().getRules()}),e.setCurrentPosition(r),e.gotoEndOfLine()}function p(e){return b=e,r&&!M&&r.unHighlightAll(),i.markKingInCheck(),j}function m(e){return C?(e?i.addArrow(e.x1,e.y1,e.x2,e.y2,!0):i.clearArrow(!0),w=e,j):j}function g(e,t){return I&&void 0!==r?(r.highlightCell(e.y.toString()+e.x.toString(),"green",t),window.settings.getBoolean("game-highlight-possible-square")&&r.highlightTargetSquares(e),j):j}function v(t){function n(){function n(){e.deleteMove(a.childrenMoves[0]),e.move(t),o(e,l),e.setCurrentPosition(a.childrenMoves[0]),p(),m()}function i(){e.move(t,void 0,!0,void 0,"local"),p(),m()}function r(e,t){return t.every(function(t){if(!e.isLegalMove(t.moveCoords))return!1;var n=e.move({move:t.moveCoords});return r(n,t.childrenMoves)})}function o(e,t){var n=e.getCurrentPosition();t.forEach(function(t){e.getCurrentPosition().isLegalMove(t.moveCoords)&&(e.move(t.moveCoords),o(e,t.childrenMoves))}),e.setCurrentPosition(n)}if(!P)return i();var a=e.getCurrentPosition();if(a.isEndOfLine())return i();var s=a.clonePosition().move({move:t}),l=a.childrenMoves[0].childrenMoves,c=r(s,l);c?n():Dialog.confirmation({content:window.t("Position conflict"),comment:window.t("Some positions further on in the game will not be possible if we make this move. Do you want to proceed and only keep the compatiple moves?")},n)}var i=x||x!==!1&&window.settings.getBoolean("game-confirm-move");if(i&&e.getMoveMode(void 0,!0)){var r=new Chess.Game({fen:e.getCurrentPosition().toString()});r.setRules(e.getRules()).move(t),Dialog.confirmMove(r,n,e.getCurrentPosition().nextMoveIsBlack())}else n()}function y(e,t){return(_=void 0!==k?k:window.settings.getBoolean("game-autopromote-queen"))?(v(e.changePromotion("w"===t?"Q":"q")),j):(i.showPromotionDialog(e,t,v,void 0===k),j)}var b,w,k,x,C,j=Extend.Publisher(this),T={click:!0,dragDrop:!0},_=window.settings.getBoolean("game-autopromote-queen"),S=["w","b"],I=!0,P=!1,M=!1;t=jQuery(t),t.length||errorHandler.error(new Error("container not found for Handler.Movement"));var Q=t.find(".piece"),B=t.find(".cell"),E=t.find(".highlight");return j.setUserMoveRight=function(e){return"string"==typeof e&&(e=[e]),Array.isArray(e)||errorHandler.error(new Error("invalid argument while setting userMoveRight"),{newMoveRight:e}),S=e,j},j.setHighlighting=function(e){return e!==!0&&e!==!1?j:(e===!1&&void 0!==r&&r.unHighlightAll(),I=e,j)},j.setPremove=function(e){return e!==!0&&e!==!1&&(e=window.settings.getBoolean("game-premove")),t.off("contextmenu.cancelPremove"),e===!1?m():t.on("contextmenu.cancelPremove",function(e){e.preventDefault(),m()}),C=e,j},j.activate=function(e){return void 0===e?(T.click=!0,T.dragDrop=!0):("click"===e||"dragDrop"===e)&&(T[e]=!0),j.initEvents(),j},j.deactivate=function(e){Q=t.find(".piece"),void 0===e?e=["click","dragDrop"]:Array.isArray(e)||(e=[e]),e.contains("dragDrop")&&T.dragDrop&&(Q.draggable("destroy"),B.droppable("destroy")),e.contains("click")&&T.click&&(E.off("click"),Q.off("click"));for(var n=0;n<e.length;n++)T[e[n]]=!1;return j},j.isActive=function(){return T.click||T.dragDrop},j.getSelectedPiece=function(){return b},j.cancelPremove=function(){return w=void 0,j},j.setCurrentPosition=function(t){n=t,w&&o(n.moveRight)&&(n.isLegalMove(w)?setTimeout(function(t){return function(){e.moveAtEndOfMainline(t,void 0,void 0,"local")}}(w)):n.isLegalMoveIfItWouldBeAPromotion(w)&&y(w,n.moveRight),m())},j.switchAutoQueen=function(e){k=void 0===e?void 0:!!e},j.switchMoveConfirm=function(e){x=void 0===e?void 0:!!e},j.switchPersistentHighlights=function(e){M=!!e},j.setReplaceMode=function(e){P=!!e},j.getReplaceMode=function(){return P},j.initEvents=function(){return Q=t.find(" .piece"),E=t.find(" .highlight"),T.click&&l(),T.dragDrop&&a(),T.click&&s(),j},j.setPremove(),j.initEvents(),window.settings.on("settings.game-premove",function(){j.setPremove(window.settings.getBoolean("game-premove"))}),j},"undefined"==typeof Handler&&(Handler={}),function(){function e(e){void 0===e&&(e=c[r]||""),e=e+(e.length?h:"")+u;var t=l.attr("title")||o;s.length&&s.length<=t.length&&t.substr(0,s.length)===s&&(t=t.substr(s.length)),t&&(o=t),s=e,l.attr("title",e+t)}function t(e){clearTimeout(i),c=p?[]:e,r=0,n()}function n(){r++,r>=c.length&&(r=0),e(c[r]),c.length>1&&(i=setTimeout(n,d))}var i,r,o,a=0,s="",l=jQuery(document),c=[],d=500,u="",h=" | ",f=[],p=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0;l.ready(function(){jQuery('head > link[rel="icon"]').each(function(){var e=new Favico({bgColor:"#c4662b",animation:"popFade",element:this});e.browser.supported&&f.push(e)})}),Handler.pageTitle={set:function(e){l.attr("title",e)},setTextWithAnimation:function(e){var n=["-","|"];e=e||"";for(var i=0;i<n.length;i++)n[i]=n[i]+" "+e;t(n)},setTextWithoutAnimation:function(e){t([e])},setNotification:function(t){return a=Math.max(parseInt(t,10),0),f.length?(f.forEach(function(e){e.badge(a)}),u=""):u=a?"("+t+") ":"",e(),this},updateNotification:function(e){return e=parseInt(e,10),isNaN(e)||this.setNotification(a+e),this},reset:function(){return clearTimeout(i),e(""),c=[],this}}}();var Handler=Handler||{};Handler.Pagination=function(e,t,n){function i(){function i(){var e=$(this),t=e.data("offset"),i=e.data("limit");n&&n(t,i)}var r=t.offset,o=t.limit,a=t.total,s=t.noOfPagesToShow,l=1,c=(r+o)/o,d=Math.max(l,Math.ceil(a/o));l>c?c=l:c>d&&(c=d),s=Math.min(t.noOfPagesToShow,d);var u=Math.floor(s/2),h=Math.max(c-u,l),f=Math.min(s+h-1,d);s+h-1>d&&(h=Math.max(f-s+1,l));for(var p=[],m=h;f>=m;m++)p.push(m);p.forEach(function(t){var n=$('<li><a data-page="'+t.toString()+'">'+t.toString()+"</a></li>");t===c&&n.addClass("active");var r=o*t-o;n.on("click",i).data("offset",r).data("limit",o),e.next.before(n)}),c===l?(e.first.addClass("inactive"),e.prev.addClass("inactive")):(e.first.on("click",i).data("offset",o*l-o).data("limit",o),e.prev.children("a").on("click",i).data("offset",r-o).data("limit",o)),c===d?(e.next.addClass("inactive"),e.last.addClass("inactive")):(e.next.children("a").on("click",i).data("offset",r+o).data("limit",o),e.last.on("click",i).data("offset",o*d-o).data("limit",o))}e=e||{},e.first=e.first||$(),e.prev=e.prev||$(),e.next=e.next||$(),e.last=e.last||$(),t=t||{},t.noOfPagesToShow=t.noOfPagesToShow||5,t.offset=t.offset||0,t.limit=t.limit||0,void 0===t.total&&(t.total=1/0);var r=this;return i(),r},"undefined"==typeof Handler&&(Handler={}),Handler.Pairing=function(){function e(){return c=Handler.socket.getSocket(Handler.socket.types.PAIRING),t(c),c.deferred.promise.done(n),d}function t(e){e.on("error",i),e.on("connect_failed",i)}function n(e){e.off("error",i).on("error",i),e.off("connect_failed",i).on("connect_failed",i),e.off("disconnect",r).on("disconnect",r),e.off("noMatch",o).on("noMatch",o),e.off("informNotAllowed",a).on("informNotAllowed",a),e.off("initGameSession",s).on("initGameSession",s),e.off("serverError",l).on("serverError",l)}function i(){d.emit("connectionError"),c.disconnect()}function r(){d.emit("connectionError"),c.disconnect()}function o(){d.emit("noMatch"),c.disconnect()}function a(e){d.emit("informNotAllowed",e),c.disconnect()}function s(e){e.authToken=config.user().authToken,d.emit("initGameSession",e),c.disconnect()}function l(e){d.emit("serverError",e)}if(Handler.Pairing.instance)return Handler.Pairing.instance;var c,d=this;return Extend.Publisher(d),d.play=function(t){return e(),t.increment=t.increment||0,t.authToken=config.user().authToken,c.emit("play",t),d},d.cancel=function(){e();var t={authToken:config.user().authToken};return c.emit("cancel",t),d},d.reMatch=function(t){return e(),c.emit("reMatch",t),d},Handler.Pairing.instance=d,d},"undefined"==typeof Handler&&(Handler={}),Handler.Playing=function(e,t,n){function i(){return f=Handler.socket.getSocket(Handler.socket.types.PLAYING,n),m}function r(e,t){f.on(e,t),r.cache=r.cache||{},r.cache[e]=t}function o(){if(r.cache)for(var e in r.cache)f.off(e,r.cache[e])}function a(n){function i(e){o(),r("startGameSession",a),r("spectatorJoin",s),r("spectatorLeave",l),r("receivedMove",c),r("receivedMoveACK",d),r("playerDisconnected",b),r("playerReconnected",w),r("gameSessionEnded",u),r("gameSessionResults",y),r("drawOffered",k),r("noReMatch",C),r("reMatchOffered",x),r("ping",function(t){e.emit("pingACK",t)}),r("gameSessionOver",function(e){m.emit("gameSessionOver",e)}),r("reconnect",function(){T.isOver()||T.emit("selfReconnected"),e.emit("joinGameSession",_)}),r("close",function(){if(!T.isOver()){var e=T.getDepth()>2,t=T.getTimeout(),n={timeout:t,win:e,itsMe:!0};T.emit("selfDisconnected",n)}}),r("disconnect",function(){if(!T.isOver()){var e=T.getDepth()>2,t=T.getTimeout(),n={timeout:t,win:e,itsMe:!0};T.emit("selfDisconnected",n)}}),r("serverError",function(e){m.emit("playingError",e)})}function a(e){if(e=j(e),e!==!1){"undefined"==typeof e.game&&errorHandler.msg("critical",new Error("startGameSession: game invalid"),!0);try{e.game=Chess.couchToGame(e.game)}catch(t){errorHandler.msg("critical",t,!0,{data:e})}return void 0===typeof e.role&&errorHandler.msg("critical",new Error("startGameSession: color invalid"),!0),h=e.role,e.spectator&&m.emit("spectatorUpdate",e.spectator),m.emit("startGameSession",e),m}}function s(e){m.emit("spectatorJoin",e)}function l(e){m.emit("spectatorLeave",e)}function c(e){if(e=j(e),e===!1)return m;void 0===e.move&&errorHandler.msg("critical",new Error("receivedMove: data.move undefined"),!0),void 0===e.id&&errorHandler.msg("critical",new Error("receivedMove: data.id undefined"),!0);try{T.moveAtEndOfMainline(e.move,void 0,void 0,"remote"),v[e.id]=T.getLastAddedPosition(),T.setTimeUsage(e.timeUsage,v[e.id])}catch(t){errorHandler.msg("critical",t,!0,{currentPosition:T.toString(),data:e})}return m}function d(e){return e=j(e),e===!1?m:(T.setTimeUsage(e.timeUsage,v[e.id]),m)}function u(e){var t=T.getCurrentGame();if(e.gameDepth)for(;t.getDepth()>e.gameDepth;)t.deleteMove(t.getEndOfMainlinePosition(),!0);var n=e.gameStatus||e;t.setGameEndByPoints(n.result.white,n.result.black,n.endedBy),m.emit("gameSessionEnded",t)}function y(e){if(e=j(e),e===!1)return m;var t=T.getCurrentGame();t.additionalInformation||(t.additionalInformation={}),t.additionalInformation.scoreTotal=e.score,t.additionalInformation.eloNew=e.elo,t.additionalInformation.badges=e.badges,t.additionalInformation.lockedEngines=e.lockedEngines,t.additionalInformation.ratedEngines=e.ratedEngines,t.setMeta({White:{EloChange:t.additionalInformation.eloNew.whiteChange},Black:{EloChange:t.additionalInformation.eloNew.blackChange}}),m.emit("gameSessionResults",t)}function b(e){return e=j(e),e===!1?m:(T.isOver()||T.emit("playerDisconnected",e),m)}function w(e){return e=j(e),e===!1?m:(T.isOver()||T.emit("playerReconnected"),m)}function k(e){return e=j(e),e===!1?m:(T.emit("drawOffered"),m)}function x(e){return e=j(e),e===!1?m:(m.emit("reMatchOffered"),m)}function C(e){return e=j(e),e===!1?m:(m.emit("noReMatch"),m)}function j(t){return void 0===t?(errorHandler.msg("warning",new Error("data is undefined"),!1,{data:t}),!1):void 0===t.gameSessionToken?(errorHandler.msg("warning",new Error("data does not contain gameSessionToken"),!1,{data:t}),!1):e!==t.gameSessionToken?(errorHandler.msg("warning",new Error("data does not contain the correct gameSessionToken"),!1,{data:t,expectedGameSessionToken:e}),!1):t}var T=n.publisher;(T instanceof Chess.GameHandler||T instanceof Chess.Game)&&(p=T),g&&(i(f),g=!1);var _={gameSessionToken:e,authToken:t};return f.emit("joinGameSession",_),m}function s(t,n){var i=n.parentMove.moveRight;if(i===h){var r=t.publisher.getCurrentGame().getMeta(),o=Chess.roles.roleToMeta(Chess.roles.role2const(h)),a=Chess.roles.roleToMeta(Chess.roles.inverse(Chess.roles.role2const(h))),s=n.getCan();v[Handler.Playing.moveId]=n;var l={event:"move",data:{gameSessionToken:e,id:Handler.Playing.moveId++,move:s,timeUsageClient:n.timeUsage,uuid:r[o].UUID,opponentUuid:r[a].UUID}};u(l)}return m}function l(){var t={event:"drawOffer",data:{gameSessionToken:e}};return u(t),m}function c(){var t={event:"acceptDraw",data:{gameSessionToken:e}};return u(t),m}function d(t,n){var i={event:"abortOrResign",data:{abort:n.abort&&n.abort===!0,gameSessionToken:e}};return u(i),m}function u(e){f.emit(e.event,e.data)}if(Handler.Playing.instance[e])return Handler.Playing.instance[e];var h,f,p,m=this,g=!0;i();var v={};return Extend.Publisher(m),Extend.Subscriber(m,{"move.mainline.add.local":s,drawOffer:l,acceptDraw:c,abortOrResign:d},{afterLink:function(e){a(e)},afterUnlink:function(e){o(),g=!0}}),m.reMatch=function(e){return f.emit("reMatch",e),m},m.noReMatch=function(e){return f.emit("noReMatch",e),f.disconnect(),m},m.closeConnection=function(){return f.disconnect(),m},m.disconnect=function(){if(!("s"==h||p&&p.isOver()))return m;var t={event:"disconnectGameSession",data:{gameSessionToken:e}};return u(t),delete Handler.Playing.instance[e],m},Handler.Playing.instance[e]=m,m},Handler.Playing.moveId=1,Handler.Playing.instance={},"undefined"==typeof Handler&&(Handler={}),Handler.Position=function(e,t,n){function i(e){var n=t.getCurrentPosition().setPiece(u.y,u.x,e);t.setStartPosition(new Chess.Position({fen:n.toString(!0),validators:n.getValidators()})),t.setHighlights(n.getHighlights())}function r(){for(var e=t.getCurrentPosition(),n=e.getHighlights(),i=Chess.getSquare(u.y,u.x),r=[],o=0;o<n.length;o++){var a=n[o].square&&n[o].square===i||n[o].frame&&n[o].frame===i||n[o].line&&n[o].line.startSquare===i;a||r.push(n[o])}t.setHighlights(r)}function o(e,n){e?d.temporary=!0:delete d.temporary,n||t.deleteHighlight(d),t.addHighlight(d)}function a(e){e=e||b&&b.find("img"),e&&!e.closest(p).length&&p.html("").append(e.clone(!0))}var s=!0;n=n||{pieces:!0,highlights:!0,clear:!0,arrows:!0};var l=this;if(t||errorHandler.msg("error",new Error("publisher is required"),!0),t.setRules("build"),e=jQuery(e),e.addClass("chessBoardPositionBuilder"),!n.pieces&&n.arrows&&n.highlights)var c="onlyHighlights";else c=!n.pieces||n.arrows||n.highlights?"":"onlyPieces";var d,u,h=e.find(".cell"),f=jQuery("<div/>").addClass("positionHandler "+(c||"")).hide().appendTo("body"),p=jQuery('<div class="last"/>').appendTo(f),m=config.assetDir()+"/images";if(n.pieces){var g=jQuery('<div class="pieces"/>').appendTo(f),v=m+"/chess/themes/pieces/chess24/";g.append(jQuery("<img/>").attr("src",v+"white/p.png").data("piece","P")).append(jQuery("<img/>").attr("src",v+"white/r.png").data("piece","R")).append(jQuery("<img/>").attr("src",v+"white/n.png").data("piece","N")).append(jQuery("<img/>").attr("src",v+"white/b.png").data("piece","B")).append(jQuery("<img/>").attr("src",v+"white/q.png").data("piece","Q")).append(jQuery("<img/>").attr("src",v+"white/k.png").data("piece","K")).append("<br/>").append(jQuery("<img/>").attr("src",v+"black/p.png").data("piece","p")).append(jQuery("<img/>").attr("src",v+"black/r.png").data("piece","r")).append(jQuery("<img/>").attr("src",v+"black/n.png").data("piece","n")).append(jQuery("<img/>").attr("src",v+"black/b.png").data("piece","b")).append(jQuery("<img/>").attr("src",v+"black/q.png").data("piece","q")).append(jQuery("<img/>").attr("src",v+"black/k.png").data("piece","k"))}if(n.highlights){var y=jQuery('<div class="highlights"/>').appendTo(f);y.append(jQuery("<img/>").attr("src",m+"/chess/themes/pieces/blue/highlight/red-take.png").data("highlight","red")).append(jQuery("<img/>").attr("src",m+"/chess/themes/pieces/blue/highlight/blue-take.png").data("highlight","blue")).append(jQuery("<img/>").attr("src",m+"/chess/themes/pieces/blue/highlight/green-take.png").data("highlight","green")).append(jQuery("<img/>").attr("src",m+"/chess/themes/pieces/blue/highlight/yellow-take.png").data("highlight","yellow"))}if(n.clear){var b=jQuery('<div class="clearcell"/>').appendTo(f);b.append(jQuery("<img/>").attr("src",m+"/editor/widget-delete.png").data("clear",!0))}if(n.arrows){var w=jQuery('<div class="arrows"/>').appendTo(f);w.append(jQuery("<img/>").attr("src",m+"/editor/arrow-red.png").data("arrow","red")).append(jQuery("<img/>").attr("src",m+"/editor/arrow-blue.png").data("arrow","blue")).append(jQuery("<img/>").attr("src",m+"/editor/arrow-green.png").data("arrow","green")).append(jQuery("<img/>").attr("src",m+"/editor/arrow-yellow.png").data("arrow","yellow"))}return h.on("mouseover",function(){if(s){var e=jQuery(this),t=(e.attr("class")||"").replace(/^.*_(\d\d).*$/,"$1");d&&(d.line=Chess.getMove(d.line.y1,d.line.x1,parseInt(t.substr(0,1),10),parseInt(t.substr(1,1),10)),o(!0))}}),h.on("click",function(e){if(s){if(d)o(!1),d=void 0;else{var t=jQuery(this),n=(t.attr("class")||"").replace(/^.*_(\d\d).*$/,"$1"),i=n;
i&&(u={x:parseInt(i.substr(1,1),10),y:parseInt(i.substr(0,1),10)});var r=t.offset();f.css({left:r.left+"px",top:r.top+"px"}).show(),e.stopPropagation(),jQuery(document).one("click",function(){f.hide()})}e.stopPropagation()}}),f.find("img").on("click",function(){var e=jQuery(this),s=e.data("piece"),l=e.data("highlight"),c=e.data("arrow"),h=e.data("clear");s?i(s):l?t.addHighlight({frame:Chess.getSquare(u.y,u.x),color:l}):c?(d={color:c,line:Chess.getMove(u.y,u.x,u.y,u.x)},o(!0,!0)):h&&(n.pieces&&i("-"),(n.highlights||n.arrows)&&r()),a(e)}),l.clear=function(){for(var e=t.getEndOfMainlinePosition(),n=0;8>n;n++)for(var i=0;8>i;i++)e.setPiece(i,n,"-");t.setStartPosition(new Chess.Position({fen:e.toString(!0),validators:e.getValidators()}))},l.activate=function(){s=!0},l.deactivate=function(){s=!1,d=void 0,f.is(":visible")&&f.hide()},a(),l},jQuery(function(){function e(){r.keys().forEach(function(e){Date.now()-r.get(e)>i&&r.remove(e)})}function t(e,i,o){o||window.isActive()?r.get(e)||(r.set(e,Date.now()),i()):setTimeout(function(){t(e,i,!0)},n)}"undefined"==typeof Handler&&(Handler={});var n=1e3,i=n+2e4,r=jQuery.initNamespaceStorage("singletab").localStorage;e(),Handler.singleTab=function(e,n){"function"==typeof n&&t(e,n)}}),function(){function e(e){function n(){return i.deferred=new Helper.Deferred,i}var i=this,r=[],o={on:[],off:[],emit:[]};return i.subscribeRequest=function(e){return r.contains(e)?i.request(e):(r.push(e),i.emit("subscribeRequest",e))},i.subscribe=function(e){return r.contains(e)?i:(r.push(e),i.emit("subscribe",e))},i.unsubscribe=function(e){return r.contains(e)&&r.removeByValue(e),i.emit("unsubscribe",e)},i.request=function(e){return i.emit("request",e)},i.emit=function(){return i.socket?(i.socket.emit.apply(i.socket,arguments),i):(o.emit.push(arguments),i)},i.on=function(){var e=arguments;return i.socket?(i.socket.on.apply(i.socket,e),i):(o.on.push(e),i)},i.off=function(){var e=arguments;return i.socket?(i.socket.removeListener.apply(i.socket,e),i):(o.off.push(e),i)},i.connect=function(e,t,n){function r(){return!config.level().isGuest&&config.user(!1)&&config.user(!1).authToken?config.user().authToken:void 0}function a(e){var t={isGuest:config.level().isGuest,isPremium:config.level().isPremium,isAdmin:config.level().isAdmin,userName:config.user().name};return e&&(t.initialChannels=i.getChannels()),t}function s(){i.socket.emit("connect",r(),a(!0),void 0)}function l(e,t,n){return e&&t?(n=jQuery.extend(n||{},{"force new connection":!0,"max reconnection attempts":50,"reconnection limit":3e4,secure:!0,port:t}),io.connect(e,n)):(errorHandler.error(new Error("please provide host and port to connect to")),!1)}i.socket=l(e,t,n);var c=setTimeout(function(){i.socket.socket.publish("connect_failed")},3e4);i.socket||errorHandler.error(new Error("invalid socket")),i.socket.on("reconnect",function(){try{s()}catch(e){setTimeout(function(){s()},5e3)}}),i.socket.emit("connect",r(),a(),function(){clearTimeout(c),Array.prototype.unshift.call(arguments,i),i.deferred.resolve.apply(this,arguments)});for(var d;d=o.emit.shift();)i.socket.emit.apply(i.socket,d);for(;d=o.on.shift();)i.socket.on.apply(i.socket,d);for(;d=o.off.shift();)i.socket.removeListener.apply(i.socket,d);return i},i.disconnect=function(){return i.socket.socket.connected&&(i.socket.removeAllListeners("disconnect"),i.socket.disconnect()),t[e]&&delete t[e],i},i.getChannels=function(){return r},n()}"undefined"==typeof Handler&&(Handler={});var t={},n={};Handler.socket={types:{NOTIFICATION:1,PAIRING:2,PLAYING:3},getSocket:function(i,r){var o,a=!0;switch(i){case Handler.socket.types.NOTIFICATION:o="/api/web/NodeServerAPI/getNotificationServer";break;case Handler.socket.types.PAIRING:o="/api/web/NodeServerAPI/getPairingServer";break;case Handler.socket.types.PLAYING:a=!1;break;default:errorHandler.error(new Error("no such socket type: ",i))}if(void 0!==t[i])return t[i];var s=new e(i);if(a&&(t[i]=s),r&&r.host&&r.port){var l=Object.getAndRemove(r,"host"),c=Object.getAndRemove(r,"port");return s.connect(l,c,r),s}if(n[i]){var l=n[i].host,c=n[i].port;return s.connect(l,c,r),s}return jQuery.get(o).done(function(e){var t=e.data.server.host,o=e.data.server.port;a&&(n[i]=e.data.server),s.connect(t,o,r)}).fail(function(e,t,n){s.deferred.reject(n)}),s}}}();var Handler=Handler||{};Handler.Sorting=function(e,t){function n(){o=e.find("th > a.sortCol"),o.on("click",i)}function i(){var e=$(this);if(e.hasClass("sortAsc"))var n=Handler.Sorting.SORT_ORDER_DESC;else n=e.hasClass("sortDesc")?Handler.Sorting.SORT_ORDER_ASC:Handler.Sorting.SORT_ORDER_ASC;var i=e.data("sort-key");t(i,n)}var r=this;e=$(e),t=t||dummy;var o;return n(),r},Handler.Sorting.SORT_ORDER_ASC=1,Handler.Sorting.SORT_ORDER_DESC=-1,"undefined"==typeof Handler&&(Handler={}),Handler.Stream=function(e,t){function n(){if(!t.eloType)return h[h.length-1];var e=h.reverse(),n=e.findIndex(function(e){return t.eloType&&e.data.player.white.eloType==t.eloType?!0:void 0});return-1!==n?e[n]:void 0}function i(e,t){h=h.filter(function(e){return e.gameSessionToken!==t.content.gameSessionToken})}function r(e,t){if(h.push(t.content),!l.isSuspended()){var i=n();i&&o(i,!0)}}function o(e,n){clearTimeout(s),s=setTimeout(function(){e||(e={data:{server:{}},gameSessionToken:""});var n="s";if(!f.nonExclusiveView)if(e.data.player&&e.data.player.white.uuid===config.user().uuid)var n="w";else e.data.player&&e.data.player.black.uuid===config.user().uuid&&(n="b");d.initGameSession(Object.merge(f,{gameSessionToken:e.gameSessionToken,authToken:config.user().authToken,role:n,mode:e.gameSessionToken?"human":"standby",chessGame:void 0,stream:t,analyze:!1,playingServer:{host:e.data.server.host,port:e.data.server.port}}))},n?0:c)}var a,s,l=this,c=3e3,d=Controller.getPlayZone(),u="channel:gameSession:remove",h=[];Array.isArray(e)||(e=[e]),t=t||{};var f={};return t.buffer&&Object.forEach(t.buffer,function(e){e&&h.push(e)}),Extend.Subscriber(l,{},{afterLink:function(t){a=t.publisher,e.forEach(function(e){a.subscribe(e).on(e,r)}),a.subscribe(u).on(u,i)}}),Extend.Suspendable(l,!1),l.onResume(function(){var e=n();e&&o(e)}),l.option=function(e,i){t[e]=i,o(n(),!0)},l.playzoneOption=function(e,t){"object"==typeof e?f=Object.merge(f,e):f[e]=t},l},"undefined"==typeof Handler&&(Handler={}),Handler.TableKeyboard=function(e){function t(){o=e.find("tbody tr"),o.length||(o=e.find("tr").filter(function(){return!jQuery(this).find("th").length})),o.off("click.tablekeyboardhandler").on("click.tablekeyboardhandler",function(){var e=jQuery(this).prevAll("tr").length;n(e)})}function n(e){if(e=Math.max(0,Math.min(o.length-1,e)),c!==e){i();var t=o.eq(e).addClass("selected");c=e;var n=t.offset().top,r=n+t.outerHeight(),a=jQuery(document).scrollTop(),s=jQuery(window).height(),l=a+s;r>l?jQuery("body").stop().animate({scrollTop:r+20-s}):a>n&&jQuery("body").stop().animate({scrollTop:n-20})}}function i(){-1!==c&&(o.eq(c).removeClass("selected"),c=-1)}function r(t){if(o.length){var i=c;switch(t.which){case Handler.Keyboard.keys.VK_UP:i=-1===c?o.length-1:c-1;break;case Handler.Keyboard.keys.VK_DOWN:i=-1===c?0:c+1;break;case Handler.Keyboard.keys.VK_PAGE_UP:i=-1===c?o.length-1:c-Handler.TableKeyboard.pageSize;break;case Handler.Keyboard.keys.VK_PAGE_DOWN:i=-1===c?0:c+Handler.TableKeyboard.pageSize;break;case Handler.Keyboard.keys.VK_RIGHT:case Handler.Keyboard.keys.VK_RETURN:-1!==c&&e.trigger("chess24:select",{index:c,element:o.eq(c)});break;case Handler.Keyboard.keys.VK_LEFT:d.forEach(function(e){e.gotoParentPosition()});break;default:return}return n(i),t.preventDefault(),!1}}var o,a=this,s=!1,l=(new Helper.UUID).getShort(),c=-1,d=[];return t(),a.setActive=function(e){s=e,jQuery(document).off("keydown.basekeyboardhandler."+l),e?jQuery(document).on("keydown.basekeyboardhandler."+l,r):i()},Extend.Subscriber(a,{},{afterLink:function(e){d.contains(e.publisher)||d.push(e.publisher)},afterUnlink:function(e){d.removeByValue(e.publisher)}}),a.getActive=function(){return s},a.selectDefault=function(){o&&o.length&&n(0)},a},Handler.TableKeyboard.pageSize=10,"undefined"==typeof Handler&&(Handler={}),function(){var e={};Handler.Template=function(t){if(t=t||"",e[t])return e[t];var n=e[t]=this;return n.render=function(e,n,i){return i=i||t,e=e.replace(/\./g,"_"),Handler.Template.templates[t][e]?(n=n||{},Mustache.render(Handler.Template.templates[t][e],n,Handler.Template.templates[i])):""},n.append=function(e){return Handler.Template.templates[t]=Object.extend({},e.getTemplates(),Handler.Template.templates[t]),n},n.getTemplates=function(){return Handler.Template.templates[t]},n},Handler.Template.renderString=Mustache.render,Handler.Template.escape=Mustache.escape}(),"undefined"==typeof Handler&&(Handler={}),Handler.Theme=function(e,t,n){function i(e){return e===e.toUpperCase()?"white":"black"}function r(){return g=Math.round(e/(2*w+8))}function o(){return y={x:Math.round(w*g),y:Math.round(k*g)}}function a(){var e=m[t].minSquareSize||u,n=m[t].maxSquareSize||h;return v=e>=g?e:g>=n?n:Math.ceil(g/f)*f}function s(){return b={x:8*g+2*y.x,y:8*g+2*y.y}}function l(){r(),a(),o(),s()}var c=this,d=config.assetDir()+"/images/chess/themes",u=24,h=80,f=8,p="",m={debug:{boardMarginQuotientX:34/70,boardMarginQuotientY:34/70,arrowColorMove:"blue",arrowColorPremove:"red",whiteSquareColor:"dark"},chess24:{boardMarginQuotientX:.3375,boardMarginQuotientY:.3375,arrowColorMove:"blue",arrowColorPremove:"red",whiteSquareColor:"bright"},chess24new:{boardMarginQuotientX:.325,boardMarginQuotientY:.325,arrowColorMove:"blue",arrowColorPremove:"red",whiteSquareColor:"dark"},football:{boardMarginQuotientX:.325,boardMarginQuotientY:.325,arrowColorMove:"blue",arrowColorPremove:"red",whiteSquareColor:"bright"},blue:{boardMarginQuotientX:.325,boardMarginQuotientY:.325,arrowColorMove:"blue",arrowColorPremove:"red",whiteSquareColor:"dark"},fide:{boardMarginQuotientX:13/31.5,boardMarginQuotientY:13/31.5,arrowColorMove:"grey",arrowColorPremove:"grey",minSquareSize:32,maxSquareSize:32,whiteSquareColor:"dark"},lightwood:{boardMarginQuotientX:.3375,boardMarginQuotientY:.3375,arrowColorMove:"blue",arrowColorPremove:"red",whiteSquareColor:"dark"},paper:{boardMarginQuotientX:.3375,boardMarginQuotientY:.3375,arrowColorMove:"blue",arrowColorPremove:"red",whiteSquareColor:"dark"},classical_blue:{boardMarginQuotientX:.3375,boardMarginQuotientY:.3375,arrowColorMove:"blue",arrowColorPremove:"red",whiteSquareColor:"dark"},beas:{boardMarginQuotientX:.3375,boardMarginQuotientY:.3375,arrowColorMove:"blue",arrowColorPremove:"red",whiteSquareColor:"dark"},avantgarde:{boardMarginQuotientX:.3375,boardMarginQuotientY:.3375,arrowColorMove:"blue",arrowColorPremove:"red",whiteSquareColor:"dark"}};t=t||window.settings.get("game-board-theme")||"chess24",n=n||window.settings.get("game-piece-theme")||"chess24new",m[t]||(t="chess24");var g,v,y,b,w=m[t].boardMarginQuotientX||34/70,k=m[t].boardMarginQuotientY||34/70;return c.setBoardTheme=function(n){return config.themes()[n]?(t=n||t||"chess24",w=m[t].boardMarginQuotientX||34/70,k=m[t].boardMarginQuotientY||34/70,l(e),c):void 0},c.setPieceTheme=function(e){return config.themes()[e]?(n=e||n||"chess24new",c):void 0},c.setContainerWidth=function(t){return e=t,l(e),c},c.setSquareSize=function(t){return e=Math.round(t*w*2+8*t),l(e),c},c.getPieceUrl=function(e){var t=i(e);return e=e.toLowerCase(),d+"/pieces/"+n+"/"+t+"/"+e+".png"},c.appendPiece=function(e,t,n){return n=n||g,jQuery(e).append(jQuery(p).append(jQuery("<img />").attr("src",c.getPieceUrl(t)).attr("width",n).attr("height",n))),c},c.getBoardUrl=function(e){return e=e||"white",d+"/boards/"+t+"/"+e+".png"},c.getWhiteSquareColor=function(){return m[t].whiteSquareColor},c.getHighlightUrl=function(e,t){return e=e||"null",d+"/pieces/"+n+"/highlight/"+e+(t?"-"+t:"")+".png"},c.getArrowColor=function(e){return e?m[t].arrowColorPremove:m[t].arrowColorMove},c.setWrapper=function(e){return p=e,c},c.getSquareSize=function(){return g},c.getPieceImageSize=function(){return v},c.getBoardMargin=function(e){return y[e]},c.getBoardSize=function(e){return b[e]},l(e),c},jQuery(function(){function e(e){config.level().isAdmin&&!a.contains(e)&&(a.push(e),o.push(e),s||(s=setTimeout(t,n)))}function t(){clearTimeout(s),s=null,jQuery.post(r,{csrf:config.csrf(),lang:config.language(),phrases:o}).done(function(){o=[]})}var n=2e4;if("object"==typeof window.__dct){var i=window.__dct;delete window.__dct}else i={};var r="/api/web/i18nAPI/add",o=[],a=[],s=null;if(window.t=function(t,n){var r=i[t];void 0===r&&void 0!==t&&(e(t),r=t);for(var o in n)r=r.replace(o,n[o]);return r},String.prototype.translate||Object.defineProperty(String.prototype,"translate",{enumerable:!1,configurable:!0,writable:!0,value:function(){return window.t(this)}}),"object"!=typeof window.__dctCountry||Array.isArray(window.__dct))l={};else{var l=window.__dctCountry;delete window.__dctCountry}window.t.country=function(e){return l[e]||e}}),function(){var e=function(e){"use strict";function t(e){if(e.paused||e.ended||g)return!1;try{d.clearRect(0,0,l,s),d.drawImage(e,0,0,l,s)}catch(n){}b=setTimeout(t,Q.duration,e),M.setIcon(c)}function n(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,n,i){return t+t+n+n+i+i});var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:!1}function i(e,t){var n,i={};for(n in e)i[n]=e[n];for(n in t)i[n]=t[n];return i}function r(){return document.hidden||document.msHidden||document.webkitHidden||document.mozHidden}e=e?e:{};var o,a,s,l,c,d,u,h,f,p,m,g,v,y,b,w={bgColor:"#d00",textColor:"#fff",fontFamily:"sans-serif",fontStyle:"bold",type:"circle",position:"down",animation:"slide",elementId:!1};v={},v.ff="undefined"!=typeof InstallTrigger,v.chrome=!!window.chrome,v.opera=!!window.opera||navigator.userAgent.indexOf("Opera")>=0,v.ie=!1,v.safari=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,v.supported=v.chrome||v.ff||v.opera;var k=[];m=function(){},h=g=!1;var x=function(){o=i(w,e),o.bgColor=n(o.bgColor),o.textColor=n(o.textColor),o.position=o.position.toLowerCase(),o.animation=Q.types[""+o.animation]?o.animation:w.animation;var t=o.position.indexOf("up")>-1,r=o.position.indexOf("left")>-1;if(t||r)for(var h=0;h<Q.types[""+o.animation].length;h++){var f=Q.types[""+o.animation][h];t&&(f.y<.6?f.y=f.y-.4:f.y=f.y-2*f.y+(1-f.w)),r&&(f.x<.6?f.x=f.x-.4:f.x=f.x-2*f.x+(1-f.h)),Q.types[""+o.animation][h]=f}o.type=j[""+o.type]?o.type:w.type;try{a=M.getIcon(),c=document.createElement("canvas"),u=document.createElement("img"),a.hasAttribute("href")?(u.setAttribute("src",a.getAttribute("href")),u.onload=function(){s=u.height>0?u.height:32,l=u.width>0?u.width:32,c.height=s,c.width=l,d=c.getContext("2d"),C.ready()}):(u.setAttribute("src",""),s=32,l=32,u.height=s,u.width=l,c.height=s,c.width=l,d=c.getContext("2d"),C.ready())}catch(p){throw"Error initializing favico. Message: "+p.message}},C={};C.ready=function(){h=!0,C.reset(),m()},C.reset=function(){h&&(k=[],f=!1,d.clearRect(0,0,l,s),d.drawImage(u,0,0,l,s),M.setIcon(c),window.clearTimeout(y),window.clearTimeout(b))},C.start=function(){if(h&&!p){var e=function(){f=k[0],p=!1,k.length>0&&(k.shift(),C.start())};if(k.length>0){p=!0;var t=function(){["type","animation","bgColor","textColor","fontFamily","fontStyle"].forEach(function(e){e in k[0].options&&(o[e]=k[0].options[e])}),Q.run(k[0].options,function(){e()},!1)};f?Q.run(f.options,function(){t()},!0):t()}}};var j={},T=function(e){return e.n="number"==typeof e.n?Math.abs(0|e.n):e.n,e.x=l*e.x,e.y=s*e.y,e.w=l*e.w,e.h=s*e.h,e.len=(""+e.n).length,e};j.circle=function(e){e=T(e);var t=!1;2===e.len?(e.x=e.x-.4*e.w,e.w=1.4*e.w,t=!0):e.len>=3&&(e.x=e.x-.65*e.w,e.w=1.65*e.w,t=!0),d.clearRect(0,0,l,s),d.drawImage(u,0,0,l,s),d.beginPath(),d.font=o.fontStyle+" "+Math.floor(e.h*(e.n>99?.85:1))+"px "+o.fontFamily,d.textAlign="center",t?(d.moveTo(e.x+e.w/2,e.y),d.lineTo(e.x+e.w-e.h/2,e.y),d.quadraticCurveTo(e.x+e.w,e.y,e.x+e.w,e.y+e.h/2),d.lineTo(e.x+e.w,e.y+e.h-e.h/2),d.quadraticCurveTo(e.x+e.w,e.y+e.h,e.x+e.w-e.h/2,e.y+e.h),d.lineTo(e.x+e.h/2,e.y+e.h),d.quadraticCurveTo(e.x,e.y+e.h,e.x,e.y+e.h-e.h/2),d.lineTo(e.x,e.y+e.h/2),d.quadraticCurveTo(e.x,e.y,e.x+e.h/2,e.y)):d.arc(e.x+e.w/2,e.y+e.h/2,e.h/2,0,2*Math.PI),d.fillStyle="rgba("+o.bgColor.r+","+o.bgColor.g+","+o.bgColor.b+","+e.o+")",d.fill(),d.closePath(),d.beginPath(),d.stroke(),d.fillStyle="rgba("+o.textColor.r+","+o.textColor.g+","+o.textColor.b+","+e.o+")","number"==typeof e.n&&e.n>999?d.fillText((e.n>9999?9:Math.floor(e.n/1e3))+"k+",Math.floor(e.x+e.w/2),Math.floor(e.y+e.h-.2*e.h)):d.fillText(e.n,Math.floor(e.x+e.w/2),Math.floor(e.y+e.h-.15*e.h)),d.closePath()},j.rectangle=function(e){e=T(e);var t=!1;2===e.len?(e.x=e.x-.4*e.w,e.w=1.4*e.w,t=!0):e.len>=3&&(e.x=e.x-.65*e.w,e.w=1.65*e.w,t=!0),d.clearRect(0,0,l,s),d.drawImage(u,0,0,l,s),d.beginPath(),d.font=o.fontStyle+" "+Math.floor(e.h*(e.n>99?.9:1))+"px "+o.fontFamily,d.textAlign="center",d.fillStyle="rgba("+o.bgColor.r+","+o.bgColor.g+","+o.bgColor.b+","+e.o+")",d.fillRect(e.x,e.y,e.w,e.h),d.fillStyle="rgba("+o.textColor.r+","+o.textColor.g+","+o.textColor.b+","+e.o+")","number"==typeof e.n&&e.n>999?d.fillText((e.n>9999?9:Math.floor(e.n/1e3))+"k+",Math.floor(e.x+e.w/2),Math.floor(e.y+e.h-.2*e.h)):d.fillText(e.n,Math.floor(e.x+e.w/2),Math.floor(e.y+e.h-.15*e.h)),d.closePath()};var _=function(e,t){t=("string"==typeof t?{animation:t}:t)||{},m=function(){try{if("number"==typeof e?e>0:""!==e){var i={type:"badge",options:{n:e}};if("animation"in t&&Q.types[""+t.animation]&&(i.options.animation=""+t.animation),"type"in t&&j[""+t.type]&&(i.options.type=""+t.type),["bgColor","textColor"].forEach(function(e){e in t&&(i.options[e]=n(t[e]))}),["fontStyle","fontFamily"].forEach(function(e){e in t&&(i.options[e]=t[e])}),k.push(i),k.length>100)throw"Too many badges requests in queue.";C.start()}else C.reset()}catch(r){throw"Error setting badge. Message: "+r.message}},h&&m()},S=function(e){m=function(){try{var t=e.width,n=e.height,i=document.createElement("img"),r=n/s>t/l?t/l:n/s;i.setAttribute("src",e.getAttribute("src")),i.height=n/r,i.width=t/r,d.clearRect(0,0,l,s),d.drawImage(i,0,0,l,s),M.setIcon(c)}catch(o){throw"Error setting image. Message: "+o.message}},h&&m()},I=function(e){m=function(){try{if("stop"===e)return g=!0,C.reset(),void(g=!1);e.addEventListener("play",function(){t(this)},!1)}catch(n){throw"Error setting video. Message: "+n.message}},h&&m()},P=function(e){if(window.URL&&window.URL.createObjectURL||(window.URL=window.URL||{},window.URL.createObjectURL=function(e){return e}),v.supported){var n=!1;navigator.getUserMedia=navigator.getUserMedia||navigator.oGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia||navigator.webkitGetUserMedia,m=function(){try{if("stop"===e)return g=!0,C.reset(),void(g=!1);n=document.createElement("video"),n.width=l,n.height=s,navigator.getUserMedia({video:!0,audio:!1},function(e){n.src=URL.createObjectURL(e),n.play(),t(n)},function(){})}catch(i){throw"Error setting webcam. Message: "+i.message}},h&&m()}},M={};M.getIcon=function(){var e=!1,t="",n=function(){for(var e=document.getElementsByTagName("head")[0].getElementsByTagName("link"),t=e.length,n=t-1;n>=0;n--)if(/(^|\s)icon(\s|$)/i.test(e[n].getAttribute("rel")))return e[n];return!1};if(o.element?e=o.element:o.elementId?(e=document.getElementById(o.elementId),e.setAttribute("href",e.getAttribute("src"))):(e=n(),e===!1&&(e=document.createElement("link"),e.setAttribute("rel","icon"),document.getElementsByTagName("head")[0].appendChild(e))),t=o.elementId?e.src:e.href,"data:"!==t.substr(0,5)&&-1===t.indexOf(document.location.hostname))throw new Error("Error setting favicon. Favicon image is on different domain (Icon: "+t+", Domain: "+document.location.hostname+")");return e.setAttribute("type","image/png"),e},M.setIcon=function(e){var t=e.toDataURL("image/png");if(o.element&&o.element.setAttribute("src",t),o.elementId)document.getElementById(o.elementId).setAttribute("src",t);else if(v.ff||v.opera){var n=a;a=document.createElement("link"),v.opera&&a.setAttribute("rel","icon"),a.setAttribute("rel","icon"),a.setAttribute("type","image/png"),document.getElementsByTagName("head")[0].appendChild(a),a.setAttribute("href",t),n.parentNode&&n.parentNode.removeChild(n)}else a.setAttribute("href",t)};var Q={};return Q.duration=40,Q.types={},Q.types.fade=[{x:.4,y:.4,w:.6,h:.6,o:0},{x:.4,y:.4,w:.6,h:.6,o:.1},{x:.4,y:.4,w:.6,h:.6,o:.2},{x:.4,y:.4,w:.6,h:.6,o:.3},{x:.4,y:.4,w:.6,h:.6,o:.4},{x:.4,y:.4,w:.6,h:.6,o:.5},{x:.4,y:.4,w:.6,h:.6,o:.6},{x:.4,y:.4,w:.6,h:.6,o:.7},{x:.4,y:.4,w:.6,h:.6,o:.8},{x:.4,y:.4,w:.6,h:.6,o:.9},{x:.4,y:.4,w:.6,h:.6,o:1}],Q.types.none=[{x:.4,y:.4,w:.6,h:.6,o:1}],Q.types.pop=[{x:1,y:1,w:0,h:0,o:1},{x:.9,y:.9,w:.1,h:.1,o:1},{x:.8,y:.8,w:.2,h:.2,o:1},{x:.7,y:.7,w:.3,h:.3,o:1},{x:.6,y:.6,w:.4,h:.4,o:1},{x:.5,y:.5,w:.5,h:.5,o:1},{x:.4,y:.4,w:.6,h:.6,o:1}],Q.types.popFade=[{x:.75,y:.75,w:0,h:0,o:0},{x:.65,y:.65,w:.1,h:.1,o:.2},{x:.6,y:.6,w:.2,h:.2,o:.4},{x:.55,y:.55,w:.3,h:.3,o:.6},{x:.5,y:.5,w:.4,h:.4,o:.8},{x:.45,y:.45,w:.5,h:.5,o:.9},{x:.4,y:.4,w:.6,h:.6,o:1}],Q.types.slide=[{x:.4,y:1,w:.6,h:.6,o:1},{x:.4,y:.9,w:.6,h:.6,o:1},{x:.4,y:.9,w:.6,h:.6,o:1},{x:.4,y:.8,w:.6,h:.6,o:1},{x:.4,y:.7,w:.6,h:.6,o:1},{x:.4,y:.6,w:.6,h:.6,o:1},{x:.4,y:.5,w:.6,h:.6,o:1},{x:.4,y:.4,w:.6,h:.6,o:1}],Q.run=function(e,t,n,a){var s=Q.types[r()?"none":o.animation];return a=n===!0?"undefined"!=typeof a?a:s.length-1:"undefined"!=typeof a?a:0,t=t?t:function(){},a<s.length&&a>=0?(j[o.type](i(e,s[a])),y=setTimeout(function(){n?a-=1:a+=1,Q.run(e,t,n,a)},Q.duration),M.setIcon(c),void 0):void t()},x(),{badge:_,video:I,image:S,webcam:P,reset:C.reset,browser:{supported:v.supported}}};"undefined"!=typeof define&&define.amd?define([],function(){return e}):"undefined"!=typeof module&&module.exports?module.exports=e:this.Favico=e}(),function(e){function n(){var e=arguments[1],n=Emoticons.getDefsByKey()[e];return n?'<span class="emoticon emoji '+n.css+'" key="'+n.key+'" title="'+t(n.title)+'"/>':":"+e+":"}function i(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var r,o;e.fn.expandEmoticons=function(){return this.each(function(){r||(r=i(Emoticons.getKeys().join("|"))),o||(o=[],Emoticons.getDefs().forEach(function(e){e.ascii&&o.push({regex:new RegExp("("+e.ascii.map(i).join("|")+"+)","g"),replace:n(void 0,e.key)})}));var t=new RegExp(":(["+r+"]+):","g"),a=e(this).html().replace(t,n);o.forEach(function(e){a=a.replace(e.regex,e.replace)}),e(this).html(a)})}}(jQuery),function($){if($.ui.timepicker=$.ui.timepicker||{},!$.ui.timepicker.version){$.extend($.ui,{timepicker:{version:"1.2.1"}});var Timepicker=function(){this.regional=[],this.regional[""]={currentText:"Now",closeText:"Done",amNames:["AM","A"],pmNames:["PM","P"],timeFormat:"HH:mm",timeSuffix:"",timeOnlyTitle:"Choose Time",timeText:"Time",hourText:"Hour",minuteText:"Minute",secondText:"Second",millisecText:"Millisecond",timezoneText:"Time Zone",isRTL:!1},this._defaults={showButtonPanel:!0,timeOnly:!1,showHour:!0,showMinute:!0,showSecond:!1,showMillisec:!1,showTimezone:!1,showTime:!0,stepHour:1,stepMinute:1,stepSecond:1,stepMillisec:1,hour:0,minute:0,second:0,millisec:0,timezone:null,useLocalTimezone:!1,defaultTimezone:"+0000",hourMin:0,minuteMin:0,secondMin:0,millisecMin:0,hourMax:23,minuteMax:59,secondMax:59,millisecMax:999,minDateTime:null,maxDateTime:null,onSelect:null,hourGrid:0,minuteGrid:0,secondGrid:0,millisecGrid:0,alwaysSetTime:!0,separator:" ",altFieldTimeOnly:!0,altTimeFormat:null,altSeparator:null,altTimeSuffix:null,pickerTimeFormat:null,pickerTimeSuffix:null,showTimepicker:!0,timezoneIso8601:!1,timezoneList:null,addSliderAccess:!1,sliderAccessArgs:null,controlType:"slider",defaultValue:null,parse:"strict"},$.extend(this._defaults,this.regional[""])};$.extend(Timepicker.prototype,{$input:null,$altInput:null,$timeObj:null,inst:null,hour_slider:null,minute_slider:null,second_slider:null,millisec_slider:null,timezone_select:null,hour:0,minute:0,second:0,millisec:0,timezone:null,defaultTimezone:"+0000",hourMinOriginal:null,minuteMinOriginal:null,secondMinOriginal:null,millisecMinOriginal:null,hourMaxOriginal:null,minuteMaxOriginal:null,secondMaxOriginal:null,millisecMaxOriginal:null,ampm:"",formattedDate:"",formattedTime:"",formattedDateTime:"",timezoneList:null,units:["hour","minute","second","millisec"],control:null,setDefaults:function(e){return extendRemove(this._defaults,e||{}),this},_newInst:function($input,o){var tp_inst=new Timepicker,inlineSettings={},fns={},overrides,i;for(var attrName in this._defaults)if(this._defaults.hasOwnProperty(attrName)){var attrValue=$input.attr("time:"+attrName);if(attrValue)try{inlineSettings[attrName]=eval(attrValue)}catch(err){inlineSettings[attrName]=attrValue}}overrides={beforeShow:function(e,t){return $.isFunction(tp_inst._defaults.evnts.beforeShow)?tp_inst._defaults.evnts.beforeShow.call($input[0],e,t,tp_inst):void 0},onChangeMonthYear:function(e,t,n){tp_inst._updateDateTime(n),$.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)&&tp_inst._defaults.evnts.onChangeMonthYear.call($input[0],e,t,n,tp_inst)},onClose:function(e,t){tp_inst.timeDefined===!0&&""!==$input.val()&&tp_inst._updateDateTime(t),$.isFunction(tp_inst._defaults.evnts.onClose)&&tp_inst._defaults.evnts.onClose.call($input[0],e,t,tp_inst)}};for(i in overrides)overrides.hasOwnProperty(i)&&(fns[i]=o[i]||null);if(tp_inst._defaults=$.extend({},this._defaults,inlineSettings,o,overrides,{evnts:fns,timepicker:tp_inst}),tp_inst.amNames=$.map(tp_inst._defaults.amNames,function(e){return e.toUpperCase()}),tp_inst.pmNames=$.map(tp_inst._defaults.pmNames,function(e){return e.toUpperCase()}),"string"==typeof tp_inst._defaults.controlType?(void 0===$.fn[tp_inst._defaults.controlType]&&(tp_inst._defaults.controlType="select"),tp_inst.control=tp_inst._controls[tp_inst._defaults.controlType]):tp_inst.control=tp_inst._defaults.controlType,null===tp_inst._defaults.timezoneList){var timezoneList=["-1200","-1100","-1000","-0930","-0900","-0800","-0700","-0600","-0500","-0430","-0400","-0330","-0300","-0200","-0100","+0000","+0100","+0200","+0300","+0330","+0400","+0430","+0500","+0530","+0545","+0600","+0630","+0700","+0800","+0845","+0900","+0930","+1000","+1030","+1100","+1130","+1200","+1245","+1300","+1400"];tp_inst._defaults.timezoneIso8601&&(timezoneList=$.map(timezoneList,function(e){return"+0000"==e?"Z":e.substring(0,3)+":"+e.substring(3)})),tp_inst._defaults.timezoneList=timezoneList}return tp_inst.timezone=tp_inst._defaults.timezone,tp_inst.hour=tp_inst._defaults.hour<tp_inst._defaults.hourMin?tp_inst._defaults.hourMin:tp_inst._defaults.hour>tp_inst._defaults.hourMax?tp_inst._defaults.hourMax:tp_inst._defaults.hour,tp_inst.minute=tp_inst._defaults.minute<tp_inst._defaults.minuteMin?tp_inst._defaults.minuteMin:tp_inst._defaults.minute>tp_inst._defaults.minuteMax?tp_inst._defaults.minuteMax:tp_inst._defaults.minute,tp_inst.second=tp_inst._defaults.second<tp_inst._defaults.secondMin?tp_inst._defaults.secondMin:tp_inst._defaults.second>tp_inst._defaults.secondMax?tp_inst._defaults.secondMax:tp_inst._defaults.second,tp_inst.millisec=tp_inst._defaults.millisec<tp_inst._defaults.millisecMin?tp_inst._defaults.millisecMin:tp_inst._defaults.millisec>tp_inst._defaults.millisecMax?tp_inst._defaults.millisecMax:tp_inst._defaults.millisec,tp_inst.ampm="",tp_inst.$input=$input,o.altField&&(tp_inst.$altInput=$(o.altField).css({cursor:"pointer"}).focus(function(){$input.trigger("focus")})),(0===tp_inst._defaults.minDate||0===tp_inst._defaults.minDateTime)&&(tp_inst._defaults.minDate=new Date),(0===tp_inst._defaults.maxDate||0===tp_inst._defaults.maxDateTime)&&(tp_inst._defaults.maxDate=new Date),void 0!==tp_inst._defaults.minDate&&tp_inst._defaults.minDate instanceof Date&&(tp_inst._defaults.minDateTime=new Date(tp_inst._defaults.minDate.getTime())),void 0!==tp_inst._defaults.minDateTime&&tp_inst._defaults.minDateTime instanceof Date&&(tp_inst._defaults.minDate=new Date(tp_inst._defaults.minDateTime.getTime())),void 0!==tp_inst._defaults.maxDate&&tp_inst._defaults.maxDate instanceof Date&&(tp_inst._defaults.maxDateTime=new Date(tp_inst._defaults.maxDate.getTime())),void 0!==tp_inst._defaults.maxDateTime&&tp_inst._defaults.maxDateTime instanceof Date&&(tp_inst._defaults.maxDate=new Date(tp_inst._defaults.maxDateTime.getTime())),tp_inst.$input.bind("focus",function(){tp_inst._onFocus()}),tp_inst},_addTimePicker:function(e){var t=this.$altInput&&this._defaults.altFieldTimeOnly?this.$input.val()+" "+this.$altInput.val():this.$input.val();this.timeDefined=this._parseTime(t),this._limitMinMaxDateTime(e,!1),this._injectTimePicker()},_parseTime:function(e,t){if(this.inst||(this.inst=$.datepicker._getInst(this.$input[0])),t||!this._defaults.timeOnly){var n=$.datepicker._get(this.inst,"dateFormat");try{var i=parseDateTimeInternal(n,this._defaults.timeFormat,e,$.datepicker._getFormatConfig(this.inst),this._defaults);if(!i.timeObj)return!1;$.extend(this,i.timeObj)}catch(r){return $.timepicker.log("Error parsing the date/time string: "+r+"\ndate/time string = "+e+"\ntimeFormat = "+this._defaults.timeFormat+"\ndateFormat = "+n),!1}return!0}var o=$.datepicker.parseTime(this._defaults.timeFormat,e,this._defaults);return o?($.extend(this,o),!0):!1},_injectTimePicker:function(){var e=this.inst.dpDiv,t=this.inst.settings,n=this,i="",r="",o={},a={},s=null,l=0,c=0;if(0===e.find("div.ui-timepicker-div").length&&t.showTimepicker){var d=' style="display:none;"',u='<div class="ui-timepicker-div'+(t.isRTL?" ui-timepicker-rtl":"")+'"><dl><dt class="ui_tpicker_time_label"'+(t.showTime?"":d)+">"+t.timeText+'</dt><dd class="ui_tpicker_time"'+(t.showTime?"":d)+"></dd>";for(l=0,c=this.units.length;c>l;l++){if(i=this.units[l],r=i.substr(0,1).toUpperCase()+i.substr(1),o[i]=parseInt(t[i+"Max"]-(t[i+"Max"]-t[i+"Min"])%t["step"+r],10),a[i]=0,u+='<dt class="ui_tpicker_'+i+'_label"'+(t["show"+r]?"":d)+">"+t[i+"Text"]+'</dt><dd class="ui_tpicker_'+i+'"><div class="ui_tpicker_'+i+'_slider"'+(t["show"+r]?"":d)+"></div>",t["show"+r]&&t[i+"Grid"]>0){if(u+='<div style="padding-left: 1px"><table class="ui-tpicker-grid-label"><tr>',"hour"==i)for(var h=t[i+"Min"];h<=o[i];h+=parseInt(t[i+"Grid"],10)){a[i]++;var f=$.datepicker.formatTime(useAmpm(t.pickerTimeFormat||t.timeFormat)?"hht":"HH",{hour:h},t);u+='<td data-for="'+i+'">'+f+"</td>"}else for(var p=t[i+"Min"];p<=o[i];p+=parseInt(t[i+"Grid"],10))a[i]++,u+='<td data-for="'+i+'">'+(10>p?"0":"")+p+"</td>";u+="</tr></table></div>"}u+="</dd>"}u+='<dt class="ui_tpicker_timezone_label"'+(t.showTimezone?"":d)+">"+t.timezoneText+"</dt>",u+='<dd class="ui_tpicker_timezone" '+(t.showTimezone?"":d)+"></dd>",u+="</dl></div>";var m=$(u);for(t.timeOnly===!0&&(m.prepend('<div class="ui-widget-header ui-helper-clearfix ui-corner-all"><div class="ui-datepicker-title">'+t.timeOnlyTitle+"</div></div>"),e.find(".ui-datepicker-header, .ui-datepicker-calendar").hide()),l=0,c=n.units.length;c>l;l++)i=n.units[l],r=i.substr(0,1).toUpperCase()+i.substr(1),n[i+"_slider"]=n.control.create(n,m.find(".ui_tpicker_"+i+"_slider"),i,n[i],t[i+"Min"],o[i],t["step"+r]),t["show"+r]&&t[i+"Grid"]>0&&(s=100*a[i]*t[i+"Grid"]/(o[i]-t[i+"Min"]),m.find(".ui_tpicker_"+i+" table").css({width:s+"%",marginLeft:t.isRTL?"0":s/(-2*a[i])+"%",marginRight:t.isRTL?s/(-2*a[i])+"%":"0",borderCollapse:"collapse"}).find("td").click(function(e){var t=$(this),r=t.html(),o=parseInt(r.replace(/[^0-9]/g),10),a=r.replace(/[^apm]/gi),s=t.data("for");"hour"==s&&(-1!==a.indexOf("p")&&12>o?o+=12:-1!==a.indexOf("a")&&12===o&&(o=0)),n.control.value(n,n[s+"_slider"],i,o),n._onTimeChange(),n._onSelectHandler()}).css({cursor:"pointer",width:100/a[i]+"%",textAlign:"center",overflow:"hidden"}));if(this.timezone_select=m.find(".ui_tpicker_timezone").append("<select></select>").find("select"),$.fn.append.apply(this.timezone_select,$.map(t.timezoneList,function(e,t){return $("<option />").val("object"==typeof e?e.value:e).text("object"==typeof e?e.label:e)})),"undefined"!=typeof this.timezone&&null!==this.timezone&&""!==this.timezone){var g=new Date(this.inst.selectedYear,this.inst.selectedMonth,this.inst.selectedDay,12),v=$.timepicker.timeZoneOffsetString(g);
v==this.timezone?selectLocalTimeZone(n):this.timezone_select.val(this.timezone)}else"undefined"!=typeof this.hour&&null!==this.hour&&""!==this.hour?this.timezone_select.val(t.defaultTimezone):selectLocalTimeZone(n);this.timezone_select.change(function(){n._defaults.useLocalTimezone=!1,n._onTimeChange(),n._onSelectHandler()});var y=e.find(".ui-datepicker-buttonpane");if(y.length?y.before(m):e.append(m),this.$timeObj=m.find(".ui_tpicker_time"),null!==this.inst){var b=this.timeDefined;this._onTimeChange(),this.timeDefined=b}if(this._defaults.addSliderAccess){var w=this._defaults.sliderAccessArgs,k=this._defaults.isRTL;w.isRTL=k,setTimeout(function(){if(0===m.find(".ui-slider-access").length){m.find(".ui-slider:visible").sliderAccess(w);var e=m.find(".ui-slider-access:eq(0)").outerWidth(!0);e&&m.find("table:visible").each(function(){var t=$(this),n=t.outerWidth(),i=t.css(k?"marginRight":"marginLeft").toString().replace("%",""),r=n-e,o=i*r/n+"%",a={width:r,marginRight:0,marginLeft:0};a[k?"marginRight":"marginLeft"]=o,t.css(a)})}},10)}}},_limitMinMaxDateTime:function(e,t){var n=this._defaults,i=new Date(e.selectedYear,e.selectedMonth,e.selectedDay);if(this._defaults.showTimepicker){if(null!==$.datepicker._get(e,"minDateTime")&&void 0!==$.datepicker._get(e,"minDateTime")&&i){var r=$.datepicker._get(e,"minDateTime"),o=new Date(r.getFullYear(),r.getMonth(),r.getDate(),0,0,0,0);(null===this.hourMinOriginal||null===this.minuteMinOriginal||null===this.secondMinOriginal||null===this.millisecMinOriginal)&&(this.hourMinOriginal=n.hourMin,this.minuteMinOriginal=n.minuteMin,this.secondMinOriginal=n.secondMin,this.millisecMinOriginal=n.millisecMin),e.settings.timeOnly||o.getTime()==i.getTime()?(this._defaults.hourMin=r.getHours(),this.hour<=this._defaults.hourMin?(this.hour=this._defaults.hourMin,this._defaults.minuteMin=r.getMinutes(),this.minute<=this._defaults.minuteMin?(this.minute=this._defaults.minuteMin,this._defaults.secondMin=r.getSeconds(),this.second<=this._defaults.secondMin?(this.second=this._defaults.secondMin,this._defaults.millisecMin=r.getMilliseconds()):(this.millisec<this._defaults.millisecMin&&(this.millisec=this._defaults.millisecMin),this._defaults.millisecMin=this.millisecMinOriginal)):(this._defaults.secondMin=this.secondMinOriginal,this._defaults.millisecMin=this.millisecMinOriginal)):(this._defaults.minuteMin=this.minuteMinOriginal,this._defaults.secondMin=this.secondMinOriginal,this._defaults.millisecMin=this.millisecMinOriginal)):(this._defaults.hourMin=this.hourMinOriginal,this._defaults.minuteMin=this.minuteMinOriginal,this._defaults.secondMin=this.secondMinOriginal,this._defaults.millisecMin=this.millisecMinOriginal)}if(null!==$.datepicker._get(e,"maxDateTime")&&void 0!==$.datepicker._get(e,"maxDateTime")&&i){var a=$.datepicker._get(e,"maxDateTime"),s=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0);(null===this.hourMaxOriginal||null===this.minuteMaxOriginal||null===this.secondMaxOriginal)&&(this.hourMaxOriginal=n.hourMax,this.minuteMaxOriginal=n.minuteMax,this.secondMaxOriginal=n.secondMax,this.millisecMaxOriginal=n.millisecMax),e.settings.timeOnly||s.getTime()==i.getTime()?(this._defaults.hourMax=a.getHours(),this.hour>=this._defaults.hourMax?(this.hour=this._defaults.hourMax,this._defaults.minuteMax=a.getMinutes(),this.minute>=this._defaults.minuteMax?(this.minute=this._defaults.minuteMax,this._defaults.secondMax=a.getSeconds(),this.second>=this._defaults.secondMax?(this.second=this._defaults.secondMax,this._defaults.millisecMax=a.getMilliseconds()):(this.millisec>this._defaults.millisecMax&&(this.millisec=this._defaults.millisecMax),this._defaults.millisecMax=this.millisecMaxOriginal)):(this._defaults.secondMax=this.secondMaxOriginal,this._defaults.millisecMax=this.millisecMaxOriginal)):(this._defaults.minuteMax=this.minuteMaxOriginal,this._defaults.secondMax=this.secondMaxOriginal,this._defaults.millisecMax=this.millisecMaxOriginal)):(this._defaults.hourMax=this.hourMaxOriginal,this._defaults.minuteMax=this.minuteMaxOriginal,this._defaults.secondMax=this.secondMaxOriginal,this._defaults.millisecMax=this.millisecMaxOriginal)}if(void 0!==t&&t===!0){var l=parseInt(this._defaults.hourMax-(this._defaults.hourMax-this._defaults.hourMin)%this._defaults.stepHour,10),c=parseInt(this._defaults.minuteMax-(this._defaults.minuteMax-this._defaults.minuteMin)%this._defaults.stepMinute,10),d=parseInt(this._defaults.secondMax-(this._defaults.secondMax-this._defaults.secondMin)%this._defaults.stepSecond,10),u=parseInt(this._defaults.millisecMax-(this._defaults.millisecMax-this._defaults.millisecMin)%this._defaults.stepMillisec,10);this.hour_slider&&(this.control.options(this,this.hour_slider,"hour",{min:this._defaults.hourMin,max:l}),this.control.value(this,this.hour_slider,"hour",this.hour-this.hour%this._defaults.stepHour)),this.minute_slider&&(this.control.options(this,this.minute_slider,"minute",{min:this._defaults.minuteMin,max:c}),this.control.value(this,this.minute_slider,"minute",this.minute-this.minute%this._defaults.stepMinute)),this.second_slider&&(this.control.options(this,this.second_slider,"second",{min:this._defaults.secondMin,max:d}),this.control.value(this,this.second_slider,"second",this.second-this.second%this._defaults.stepSecond)),this.millisec_slider&&(this.control.options(this,this.millisec_slider,"millisec",{min:this._defaults.millisecMin,max:u}),this.control.value(this,this.millisec_slider,"millisec",this.millisec-this.millisec%this._defaults.stepMillisec))}}},_onTimeChange:function(){var e=this.hour_slider?this.control.value(this,this.hour_slider,"hour"):!1,t=this.minute_slider?this.control.value(this,this.minute_slider,"minute"):!1,n=this.second_slider?this.control.value(this,this.second_slider,"second"):!1,i=this.millisec_slider?this.control.value(this,this.millisec_slider,"millisec"):!1,r=this.timezone_select?this.timezone_select.val():!1,o=this._defaults,a=o.pickerTimeFormat||o.timeFormat,s=o.pickerTimeSuffix||o.timeSuffix;"object"==typeof e&&(e=!1),"object"==typeof t&&(t=!1),"object"==typeof n&&(n=!1),"object"==typeof i&&(i=!1),"object"==typeof r&&(r=!1),e!==!1&&(e=parseInt(e,10)),t!==!1&&(t=parseInt(t,10)),n!==!1&&(n=parseInt(n,10)),i!==!1&&(i=parseInt(i,10));var l=o[12>e?"amNames":"pmNames"][0],c=e!=this.hour||t!=this.minute||n!=this.second||i!=this.millisec||this.ampm.length>0&&12>e!=(-1!==$.inArray(this.ampm.toUpperCase(),this.amNames))||null===this.timezone&&r!=this.defaultTimezone||null!==this.timezone&&r!=this.timezone;c&&(e!==!1&&(this.hour=e),t!==!1&&(this.minute=t),n!==!1&&(this.second=n),i!==!1&&(this.millisec=i),r!==!1&&(this.timezone=r),this.inst||(this.inst=$.datepicker._getInst(this.$input[0])),this._limitMinMaxDateTime(this.inst,!0)),useAmpm(o.timeFormat)&&(this.ampm=l),this.formattedTime=$.datepicker.formatTime(o.timeFormat,this,o),this.$timeObj&&(a===o.timeFormat?this.$timeObj.text(this.formattedTime+s):this.$timeObj.text($.datepicker.formatTime(a,this,o)+s)),this.timeDefined=!0,c&&this._updateDateTime()},_onSelectHandler:function(){var e=this._defaults.onSelect||this.inst.settings.onSelect,t=this.$input?this.$input[0]:null;e&&t&&e.apply(t,[this.formattedDateTime,this])},_updateDateTime:function(e){e=this.inst||e;var t=$.datepicker._daylightSavingAdjust(new Date(e.selectedYear,e.selectedMonth,e.selectedDay)),n=$.datepicker._get(e,"dateFormat"),i=$.datepicker._getFormatConfig(e),r=null!==t&&this.timeDefined;this.formattedDate=$.datepicker.formatDate(n,null===t?new Date:t,i);var o=this.formattedDate;if(""===e.lastVal&&(e.currentYear=e.selectedYear,e.currentMonth=e.selectedMonth,e.currentDay=e.selectedDay),this._defaults.timeOnly===!0?o=this.formattedTime:this._defaults.timeOnly!==!0&&(this._defaults.alwaysSetTime||r)&&(o+=this._defaults.separator+this.formattedTime+this._defaults.timeSuffix),this.formattedDateTime=o,this._defaults.showTimepicker)if(this.$altInput&&this._defaults.altFieldTimeOnly===!0)this.$altInput.val(this.formattedTime),this.$input.val(this.formattedDate);else if(this.$altInput){this.$input.val(o);var a="",s=this._defaults.altSeparator?this._defaults.altSeparator:this._defaults.separator,l=this._defaults.altTimeSuffix?this._defaults.altTimeSuffix:this._defaults.timeSuffix;a=this._defaults.altFormat?$.datepicker.formatDate(this._defaults.altFormat,null===t?new Date:t,i):this.formattedDate,a&&(a+=s),a+=this._defaults.altTimeFormat?$.datepicker.formatTime(this._defaults.altTimeFormat,this,this._defaults)+l:this.formattedTime+l,this.$altInput.val(a)}else this.$input.val(o);else this.$input.val(this.formattedDate);this.$input.trigger("change")},_onFocus:function(){if(!this.$input.val()&&this._defaults.defaultValue){this.$input.val(this._defaults.defaultValue);var e=$.datepicker._getInst(this.$input.get(0)),t=$.datepicker._get(e,"timepicker");if(t&&t._defaults.timeOnly&&e.input.val()!=e.lastVal)try{$.datepicker._updateDatepicker(e)}catch(n){$.timepicker.log(n)}}},_controls:{slider:{create:function(e,t,n,i,r,o,a){var s=e._defaults.isRTL;return t.prop("slide",null).slider({orientation:"horizontal",value:s?-1*i:i,min:s?-1*o:r,max:s?-1*r:o,step:a,slide:function(t,i){e.control.value(e,$(this),n,s?-1*i.value:i.value),e._onTimeChange()},stop:function(t,n){e._onSelectHandler()}})},options:function(e,t,n,i,r){if(e._defaults.isRTL){if("string"==typeof i)return"min"==i||"max"==i?void 0!==r?t.slider(i,-1*r):Math.abs(t.slider(i)):t.slider(i);var o=i.min,a=i.max;return i.min=i.max=null,void 0!==o&&(i.max=-1*o),void 0!==a&&(i.min=-1*a),t.slider(i)}return"string"==typeof i&&void 0!==r?t.slider(i,r):t.slider(i)},value:function(e,t,n,i){return e._defaults.isRTL?void 0!==i?t.slider("value",-1*i):Math.abs(t.slider("value")):void 0!==i?t.slider("value",i):t.slider("value")}},select:{create:function(e,t,n,i,r,o,a){for(var s='<select class="ui-timepicker-select" data-unit="'+n+'" data-min="'+r+'" data-max="'+o+'" data-step="'+a+'">',l=e._defaults.pickerTimeFormat||e._defaults.timeFormat,c=r;o>=c;c+=a)s+='<option value="'+c+'"'+(c==i?" selected":"")+">",s+="hour"==n?$.datepicker.formatTime($.trim(l.replace(/[^ht ]/gi,"")),{hour:c},e._defaults):"millisec"==n||c>=10?c:"0"+c.toString(),s+="</option>";return s+="</select>",t.children("select").remove(),$(s).appendTo(t).change(function(t){e._onTimeChange(),e._onSelectHandler()}),t},options:function(e,t,n,i,r){var o={},a=t.children("select");if("string"==typeof i){if(void 0===r)return a.data(i);o[i]=r}else o=i;return e.control.create(e,t,a.data("unit"),a.val(),o.min||a.data("min"),o.max||a.data("max"),o.step||a.data("step"))},value:function(e,t,n,i){var r=t.children("select");return void 0!==i?r.val(i):r.val()}}}}),$.fn.extend({timepicker:function(e){e=e||{};var t=Array.prototype.slice.call(arguments);return"object"==typeof e&&(t[0]=$.extend(e,{timeOnly:!0})),$(this).each(function(){$.fn.datetimepicker.apply($(this),t)})},datetimepicker:function(e){e=e||{};var t=arguments;return"string"==typeof e?"getDate"==e?$.fn.datepicker.apply($(this[0]),t):this.each(function(){var e=$(this);e.datepicker.apply(e,t)}):this.each(function(){var t=$(this);t.datepicker($.timepicker._newInst(t,e)._defaults)})}}),$.datepicker.parseDateTime=function(e,t,n,i,r){var o=parseDateTimeInternal(e,t,n,i,r);if(o.timeObj){var a=o.timeObj;o.date.setHours(a.hour,a.minute,a.second,a.millisec)}return o.date},$.datepicker.parseTime=function(e,t,n){var i=extendRemove(extendRemove({},$.timepicker._defaults),n||{}),r=function(e,t,n){var i,r=function(e,t){var n=[];return e&&$.merge(n,e),t&&$.merge(n,t),n=$.map(n,function(e){return e.replace(/[.*+?|()\[\]{}\\]/g,"\\$&")}),"("+n.join("|")+")?"},o=function(e){var t=e.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|t{1,2}|z|'.*?')/g),n={h:-1,m:-1,s:-1,l:-1,t:-1,z:-1};if(t)for(var i=0;i<t.length;i++)-1==n[t[i].toString().charAt(0)]&&(n[t[i].toString().charAt(0)]=i+1);return n},a="^"+e.toString().replace(/([hH]{1,2}|mm?|ss?|[tT]{1,2}|[lz]|'.*?')/g,function(e){var t=e.length;switch(e.charAt(0).toLowerCase()){case"h":return 1===t?"(\\d?\\d)":"(\\d{"+t+"})";case"m":return 1===t?"(\\d?\\d)":"(\\d{"+t+"})";case"s":return 1===t?"(\\d?\\d)":"(\\d{"+t+"})";case"l":return"(\\d?\\d?\\d)";case"z":return"(z|[-+]\\d\\d:?\\d\\d|\\S+)?";case"t":return r(n.amNames,n.pmNames);default:return"("+e.replace(/\'/g,"").replace(/(\.|\$|\^|\\|\/|\(|\)|\[|\]|\?|\+|\*)/g,function(e){return"\\"+e})+")?"}}).replace(/\s/g,"\\s?")+n.timeSuffix+"$",s=o(e),l="";i=t.match(new RegExp(a,"i"));var c={hour:0,minute:0,second:0,millisec:0};if(i){if(-1!==s.t&&(void 0===i[s.t]||0===i[s.t].length?(l="",c.ampm=""):(l=-1!==$.inArray(i[s.t].toUpperCase(),n.amNames)?"AM":"PM",c.ampm=n["AM"==l?"amNames":"pmNames"][0])),-1!==s.h&&("AM"==l&&"12"==i[s.h]?c.hour=0:"PM"==l&&"12"!=i[s.h]?c.hour=parseInt(i[s.h],10)+12:c.hour=Number(i[s.h])),-1!==s.m&&(c.minute=Number(i[s.m])),-1!==s.s&&(c.second=Number(i[s.s])),-1!==s.l&&(c.millisec=Number(i[s.l])),-1!==s.z&&void 0!==i[s.z]){var d=i[s.z].toUpperCase();switch(d.length){case 1:d=n.timezoneIso8601?"Z":"+0000";break;case 5:n.timezoneIso8601&&(d="0000"==d.substring(1)?"Z":d.substring(0,3)+":"+d.substring(3));break;case 6:n.timezoneIso8601?"00:00"==d.substring(1)&&(d="Z"):d="Z"==d||"00:00"==d.substring(1)?"+0000":d.replace(/:/,"")}c.timezone=d}return c}return!1},o=function(e,t,n){try{var i=new Date("2012-01-01 "+t);if(isNaN(i.getTime())&&(i=new Date("2012-01-01T"+t),isNaN(i.getTime())&&(i=new Date("01/01/2012 "+t),isNaN(i.getTime()))))throw"Unable to parse time with native Date: "+t;return{hour:i.getHours(),minute:i.getMinutes(),second:i.getSeconds(),millisec:i.getMilliseconds(),timezone:$.timepicker.timeZoneOffsetString(i)}}catch(o){try{return r(e,t,n)}catch(a){$.timepicker.log("Unable to parse \ntimeString: "+t+"\ntimeFormat: "+e)}}return!1};return"function"==typeof i.parse?i.parse(e,t,i):"loose"===i.parse?o(e,t,i):r(e,t,i)},$.datepicker.formatTime=function(e,t,n){n=n||{},n=$.extend({},$.timepicker._defaults,n),t=$.extend({hour:0,minute:0,second:0,millisec:0,timezone:"+0000"},t);var i=e,r=n.amNames[0],o=parseInt(t.hour,10);return o>11&&(r=n.pmNames[0]),i=i.replace(/(?:HH?|hh?|mm?|ss?|[tT]{1,2}|[lz]|('.*?'|".*?"))/g,function(e){switch(e){case"HH":return("0"+o).slice(-2);case"H":return o;case"hh":return("0"+convert24to12(o)).slice(-2);case"h":return convert24to12(o);case"mm":return("0"+t.minute).slice(-2);case"m":return t.minute;case"ss":return("0"+t.second).slice(-2);case"s":return t.second;case"l":return("00"+t.millisec).slice(-3);case"z":return null===t.timezone?n.defaultTimezone:t.timezone;case"T":return r.charAt(0).toUpperCase();case"TT":return r.toUpperCase();case"t":return r.charAt(0).toLowerCase();case"tt":return r.toLowerCase();default:return e.replace(/\'/g,"")||"'"}}),i=$.trim(i)},$.datepicker._base_selectDate=$.datepicker._selectDate,$.datepicker._selectDate=function(e,t){var n=this._getInst($(e)[0]),i=this._get(n,"timepicker");i?(i._limitMinMaxDateTime(n,!0),n.inline=n.stay_open=!0,this._base_selectDate(e,t),n.inline=n.stay_open=!1,this._notifyChange(n),this._updateDatepicker(n)):this._base_selectDate(e,t)},$.datepicker._base_updateDatepicker=$.datepicker._updateDatepicker,$.datepicker._updateDatepicker=function(e){var t=e.input[0];if(!($.datepicker._curInst&&$.datepicker._curInst!=e&&$.datepicker._datepickerShowing&&$.datepicker._lastInput!=t||"boolean"==typeof e.stay_open&&e.stay_open!==!1)){this._base_updateDatepicker(e);var n=this._get(e,"timepicker");n&&n._addTimePicker(e)}},$.datepicker._base_doKeyPress=$.datepicker._doKeyPress,$.datepicker._doKeyPress=function(e){var t=$.datepicker._getInst(e.target),n=$.datepicker._get(t,"timepicker");if(n&&$.datepicker._get(t,"constrainInput")){var i=useAmpm(n._defaults.timeFormat),r=$.datepicker._possibleChars($.datepicker._get(t,"dateFormat")),o=n._defaults.timeFormat.toString().replace(/[hms]/g,"").replace(/TT/g,i?"APM":"").replace(/Tt/g,i?"AaPpMm":"").replace(/tT/g,i?"AaPpMm":"").replace(/T/g,i?"AP":"").replace(/tt/g,i?"apm":"").replace(/t/g,i?"ap":"")+" "+n._defaults.separator+n._defaults.timeSuffix+(n._defaults.showTimezone?n._defaults.timezoneList.join(""):"")+n._defaults.amNames.join("")+n._defaults.pmNames.join("")+r,a=String.fromCharCode(void 0===e.charCode?e.keyCode:e.charCode);return e.ctrlKey||" ">a||!r||o.indexOf(a)>-1}return $.datepicker._base_doKeyPress(e)},$.datepicker._base_updateAlternate=$.datepicker._updateAlternate,$.datepicker._updateAlternate=function(e){var t=this._get(e,"timepicker");if(t){var n=t._defaults.altField;if(n){var i=(t._defaults.altFormat||t._defaults.dateFormat,this._getDate(e)),r=$.datepicker._getFormatConfig(e),o="",a=t._defaults.altSeparator?t._defaults.altSeparator:t._defaults.separator,s=t._defaults.altTimeSuffix?t._defaults.altTimeSuffix:t._defaults.timeSuffix,l=null!==t._defaults.altTimeFormat?t._defaults.altTimeFormat:t._defaults.timeFormat;o+=$.datepicker.formatTime(l,t,t._defaults)+s,t._defaults.timeOnly||t._defaults.altFieldTimeOnly||null===i||(o=t._defaults.altFormat?$.datepicker.formatDate(t._defaults.altFormat,i,r)+a+o:t.formattedDate+a+o),$(n).val(o)}}else $.datepicker._base_updateAlternate(e)},$.datepicker._base_doKeyUp=$.datepicker._doKeyUp,$.datepicker._doKeyUp=function(e){var t=$.datepicker._getInst(e.target),n=$.datepicker._get(t,"timepicker");if(n&&n._defaults.timeOnly&&t.input.val()!=t.lastVal)try{$.datepicker._updateDatepicker(t)}catch(i){$.timepicker.log(i)}return $.datepicker._base_doKeyUp(e)},$.datepicker._base_gotoToday=$.datepicker._gotoToday,$.datepicker._gotoToday=function(e){var t=this._getInst($(e)[0]),n=t.dpDiv;this._base_gotoToday(e);var i=this._get(t,"timepicker");selectLocalTimeZone(i);var r=new Date;this._setTime(t,r),$(".ui-datepicker-today",n).click()},$.datepicker._disableTimepickerDatepicker=function(e){var t=this._getInst(e);if(t){var n=this._get(t,"timepicker");$(e).datepicker("getDate"),n&&(n._defaults.showTimepicker=!1,n._updateDateTime(t))}},$.datepicker._enableTimepickerDatepicker=function(e){var t=this._getInst(e);if(t){var n=this._get(t,"timepicker");$(e).datepicker("getDate"),n&&(n._defaults.showTimepicker=!0,n._addTimePicker(t),n._updateDateTime(t))}},$.datepicker._setTime=function(e,t){var n=this._get(e,"timepicker");if(n){var i=n._defaults;n.hour=t?t.getHours():i.hour,n.minute=t?t.getMinutes():i.minute,n.second=t?t.getSeconds():i.second,n.millisec=t?t.getMilliseconds():i.millisec,n._limitMinMaxDateTime(e,!0),n._onTimeChange(),n._updateDateTime(e)}},$.datepicker._setTimeDatepicker=function(e,t,n){var i=this._getInst(e);if(i){var r=this._get(i,"timepicker");if(r){this._setDateFromField(i);var o;t&&("string"==typeof t?(r._parseTime(t,n),o=new Date,o.setHours(r.hour,r.minute,r.second,r.millisec)):o=new Date(t.getTime()),"Invalid Date"==o.toString()&&(o=void 0),this._setTime(i,o))}}},$.datepicker._base_setDateDatepicker=$.datepicker._setDateDatepicker,$.datepicker._setDateDatepicker=function(e,t){var n=this._getInst(e);if(n){var i=t instanceof Date?new Date(t.getTime()):t;this._updateDatepicker(n),this._base_setDateDatepicker.apply(this,arguments),this._setTimeDatepicker(e,i,!0)}},$.datepicker._base_getDateDatepicker=$.datepicker._getDateDatepicker,$.datepicker._getDateDatepicker=function(e,t){var n=this._getInst(e);if(n){var i=this._get(n,"timepicker");if(i){void 0===n.lastVal&&this._setDateFromField(n,t);var r=this._getDate(n);return r&&i._parseTime($(e).val(),i.timeOnly)&&r.setHours(i.hour,i.minute,i.second,i.millisec),r}return this._base_getDateDatepicker(e,t)}},$.datepicker._base_parseDate=$.datepicker.parseDate,$.datepicker.parseDate=function(e,t,n){var i;try{i=this._base_parseDate(e,t,n)}catch(r){if(!(r.indexOf(":")>=0))throw r;i=this._base_parseDate(e,t.substring(0,t.length-(r.length-r.indexOf(":")-2)),n),$.timepicker.log("Error parsing the date string: "+r+"\ndate string = "+t+"\ndate format = "+e)}return i},$.datepicker._base_formatDate=$.datepicker._formatDate,$.datepicker._formatDate=function(e,t,n,i){var r=this._get(e,"timepicker");return r?(r._updateDateTime(e),r.$input.val()):this._base_formatDate(e)},$.datepicker._base_optionDatepicker=$.datepicker._optionDatepicker,$.datepicker._optionDatepicker=function(e,t,n){var i,r=this._getInst(e);if(!r)return null;var o=this._get(r,"timepicker");if(o){var a,s=null,l=null,c=null,d=o._defaults.evnts,u={};if("string"==typeof t){if("minDate"===t||"minDateTime"===t)s=n;else if("maxDate"===t||"maxDateTime"===t)l=n;else if("onSelect"===t)c=n;else if(d.hasOwnProperty(t)){if("undefined"==typeof n)return d[t];u[t]=n,i={}}}else if("object"==typeof t){t.minDate?s=t.minDate:t.minDateTime?s=t.minDateTime:t.maxDate?l=t.maxDate:t.maxDateTime&&(l=t.maxDateTime);for(a in d)d.hasOwnProperty(a)&&t[a]&&(u[a]=t[a])}for(a in u)u.hasOwnProperty(a)&&(d[a]=u[a],i||(i=$.extend({},t)),delete i[a]);if(i&&isEmptyObject(i))return;s?(s=0===s?new Date:new Date(s),o._defaults.minDate=s,o._defaults.minDateTime=s):l?(l=0===l?new Date:new Date(l),o._defaults.maxDate=l,o._defaults.maxDateTime=l):c&&(o._defaults.onSelect=c)}return void 0===n?this._base_optionDatepicker.call($.datepicker,e,t):this._base_optionDatepicker.call($.datepicker,e,i||t,n)};var isEmptyObject=function(e){var t;for(t in e)if(e.hasOwnProperty(e))return!1;return!0},extendRemove=function(e,t){$.extend(e,t);for(var n in t)(null===t[n]||void 0===t[n])&&(e[n]=t[n]);return e},useAmpm=function(e){return(-1!==e.indexOf("t")||-1!==e.indexOf("T"))&&-1!==e.indexOf("h")},convert24to12=function(e){return e>12&&(e-=12),0===e&&(e=12),String(e)},splitDateTime=function(e,t,n,i){try{var r=i&&i.separator?i.separator:$.timepicker._defaults.separator,o=i&&i.timeFormat?i.timeFormat:$.timepicker._defaults.timeFormat,a=o.split(r),s=a.length,l=t.split(r),c=l.length;if(c>1)return[l.splice(0,c-s).join(r),l.splice(0,s).join(r)]}catch(d){if($.timepicker.log("Could not split the date from the time. Please check the following datetimepicker options\nthrown error: "+d+"\ndateTimeString"+t+"\ndateFormat = "+e+"\nseparator = "+i.separator+"\ntimeFormat = "+i.timeFormat),d.indexOf(":")>=0){var u=t.length-(d.length-d.indexOf(":")-2);t.substring(u);return[$.trim(t.substring(0,u)),$.trim(t.substring(u))]}throw d}return[t,""]},parseDateTimeInternal=function(e,t,n,i,r){var o,a=splitDateTime(e,n,i,r);if(o=$.datepicker._base_parseDate(e,a[0],i),""!==a[1]){var s=a[1],l=$.datepicker.parseTime(t,s,r);if(null===l)throw"Wrong time format";return{date:o,timeObj:l}}return{date:o}},selectLocalTimeZone=function(e,t){if(e&&e.timezone_select){e._defaults.useLocalTimezone=!0;var n="undefined"!=typeof t?t:new Date,i=$.timepicker.timeZoneOffsetString(n);e._defaults.timezoneIso8601&&(i=i.substring(0,3)+":"+i.substring(3)),e.timezone_select.val(i)}};$.timepicker=new Timepicker,$.timepicker.timeZoneOffsetString=function(e){var t=-1*e.getTimezoneOffset(),n=t%60,i=(t-n)/60;return(t>=0?"+":"-")+("0"+(101*i).toString()).slice(-2)+("0"+(101*n).toString()).slice(-2)},$.timepicker.timeRange=function(e,t,n){return $.timepicker.handleRange("timepicker",e,t,n)},$.timepicker.dateTimeRange=function(e,t,n){$.timepicker.dateRange(e,t,n,"datetimepicker")},$.timepicker.dateRange=function(e,t,n,i){i=i||"datepicker",$.timepicker.handleRange(i,e,t,n)},$.timepicker.handleRange=function(e,t,n,i){function r(e,i,r){i.val()&&new Date(t.val())>new Date(n.val())&&i.val(r)}function o(t,n,i){if($(t).val()){var r=$(t)[e].call($(t),"getDate");r.getTime&&$(n)[e].call($(n),"option",i,r)}}return $.fn[e].call(t,$.extend({onClose:function(e,t){r(this,n,e)},onSelect:function(e){o(this,n,"minDate")}},i,i.start)),$.fn[e].call(n,$.extend({onClose:function(e,n){r(this,t,e)},onSelect:function(e){o(this,t,"maxDate")}},i,i.end)),"timepicker"!=e&&i.reformat&&$([t,n]).each(function(){var t=$(this)[e].call($(this),"option","dateFormat"),n=new Date($(this).val());$(this).val()&&n&&$(this).val($.datepicker.formatDate(t,n))}),r(t,n,t.val()),o(t,n,"minDate"),o(n,t,"maxDate"),$([t.get(0),n.get(0)])},$.timepicker.log=function(e){},$.timepicker.version="1.2.1"}}(jQuery),function(){function e(e){return e&&e.country?Object.extend({countryName:window.t.country(e.country)},e):e}function t(e,t,n){return t.map(function(t){if(t.player.white==n)var i=Chess.colors.white.full,o=Chess.colors.black.full,a=!0;else i=Chess.colors.black.full,o=Chess.colors.white.full,a=!1;return t.opponent=r.getPlayer(e,t.player[o]),t.player=r.getPlayer(e,t.player[i]),t.playerWasWhite=a,t.player&&t.opponent&&t.gameStatus.result&&void 0!==t.gameStatus.result[i]?(t.score=Controller.Broadcast.scoreToString(t.gameStatus.result[i]),t.eloChange=Helper.EloChangeHighPrecision(t.player.elo,t.opponent.elo,t.gameStatus.result[i],t.gameStatus.result[o]).player||0):(t.score="*",t.eloChange=0),t.roundLabel&&(t.roundLabel[config.language()]&&(t.roundLabel=t.roundLabel[config.language()]),t.roundLabel.length>3&&delete t.roundLabel),t})}function n(){var e=$(this),t=new Controller.Broadcast;return t.showGame(e.data("tournamentid"),e.data("roundid"),e.data("matchid"),e.data("gameid")),!1}var i,r;jQuery.fn.addPlayerTournamentStatistics=function(o,a){function s(s,l){var c=a||s.data("playerId");if(c&&"unknown"!==c){var d=(r=r||new Controller.BroadcastTournament).getAllGamesForAPlayer(o,c);if(Array.isArray(d)){i=i||new Handler.Template("broadcast");var u=r.getPlayerResults(o,c,"live"),h=t(o,d,c),f=Math.round(h.reduce(function(e,t){return e+t.eloChange},0)),p={tournamentId:o,games:h,totalEloChange:f,player:e(r.getPlayer(o,c)),formatPoints:Controller.Broadcast.scoreToString(u.p),playerId:c,playerResults:u},m=$(i.render("statistics.miniprofile",p));m.find("a.gameLink").on("click",n),l(m)}}}return this.each(function(){var e=jQuery(this);e.tooltip({},s)})}}(),jQuery.fn.ajaxTabs=function(){function e(e){function t(){e.find("li > a").click(function(){var e=jQuery(this);if(e.data("load-url")&&!e.closest("li").hasClass("current")){e.data("status")||e.data("status",a);var t=e.data("status"),n=e.data("tab-content-id");t==a||t==l&&e.data("load-multiple")?(i(n),e.data("status",s),jQuery.ajax({url:e.data("load-url"),dataType:"json",success:function(t){e.data("status",l),t&&0===t.status&&t.data&&t.data.html&&(jQuery("#"+n+" .tabContentInsider").html(t.data.html).trigger("chess24:show"),r(n),setTimeout(function(){jQuery(document).trigger("newhtml")},100))},error:function(t,n,i){e.data("status",a)}})):jQuery("#"+n+" .tabContentInsider").trigger("chess24:show")}return!0}),n()}function n(){var t=e.find("li.current");t.find("a").data("load-url")&&(t.removeClass("current"),t.find("a").trigger("click"),t.addClass("current"))}function i(e){var t=(new Handler.Template).render("commonLoader");jQuery("#"+e+" .tabContentInsider").html(t)}function r(e){jQuery("#"+e+" .tabContentInsider .commonLoader").remove()}var o=this,a=1,s=2,l=3;return e.data("ajaxTabsManager")?e.data("ajaxTabsManager"):(e.data("ajaxTabsManager",o),t(),o)}return new e(this),this},function(e,t){"$:nomunge";function n(e){return"string"==typeof e}function i(e){var t=x.call(arguments,1);return function(){return e.apply(this,t.concat(x.call(arguments)))}}function r(e){return e.replace(y,"$2")}function o(e){return e.replace(/(?:^[^?#]*\?([^#]*).*$)?.*/,"$1")}function a(t,i,r,o,a){var s,l,u,f,p;return o!==c?(u=r.match(t?y:/^([^#?]*)\??([^#]*)(#?.*)/),p=u[3]||"",2===a&&n(o)?l=o.replace(t?v:E,""):(f=h(u[2]),o=n(o)?h[t?P:I](o):o,l=2===a?o:1===a?e.extend({},o,f):e.extend({},f,o),l=d(l),t&&(l=l.replace(b,C))),s=u[1]+(t?k:l||!u[1]?"?":"")+l+p):s=i(r!==c?r:location.href),s}function s(e,t,i){return t===c||"boolean"==typeof t?(i=t,t=j[e?P:I]()):t=n(t)?t.replace(e?v:E,""):t,h(t,i)}function l(t,i,r,o){return n(r)||"object"==typeof r||(o=r,r=i,i=c),this.each(function(){var n=e(this),a=i||g()[(this.nodeName||"").toLowerCase()]||"",s=a&&n.attr(a)||"";n.attr(a,j[t](s,r,o))})}var c,d,u,h,f,p,m,g,v,y,b,w,k,x=Array.prototype.slice,C=decodeURIComponent,j=e.param,T=e.bbq=e.bbq||{},_=e.event.special,S="hashchange",I="querystring",P="fragment",M="elemUrlAttr",Q="href",B="src",E=/^.*\?|#.*$/g,O={};j[I]=i(a,0,o),j[P]=u=i(a,1,r),j.sorted=d=function(t,n){var i=[],r={};return e.each(j(t,n).split("&"),function(e,t){var n=t.replace(/(?:%5B|=).*$/,""),o=r[n];o||(o=r[n]=[],i.push(n)),o.push(t)}),e.map(i.sort(),function(e){return r[e]}).join("&")},u.noEscape=function(t){t=t||"";var n=e.map(t.split(""),encodeURIComponent);b=new RegExp(n.join("|"),"g")},u.noEscape(",/"),u.ajaxCrawlable=function(e){return e!==c&&(e?(v=/^.*(?:#!|#)/,y=/^([^#]*)(?:#!|#)?(.*)$/,k="#!"):(v=/^.*#/,y=/^([^#]*)#?(.*)$/,k="#"),w=!!e),w},u.ajaxCrawlable(0),e.deparam=h=function(t,n){var i={},r={"true":!0,"false":!1,"null":null};return e.each(t.replace(/\+/g," ").split("&"),function(t,o){var a,s=o.split("="),l=C(s[0]),d=i,u=0,h=l.split("]["),f=h.length-1;if(/\[/.test(h[0])&&/\]$/.test(h[f])?(h[f]=h[f].replace(/\]$/,""),h=h.shift().split("[").concat(h),f=h.length-1):f=0,2===s.length)if(a=C(s[1]),n&&(a=a&&!isNaN(a)?+a:"undefined"===a?c:r[a]!==c?r[a]:a),f)for(;f>=u;u++)l=""===h[u]?d.length:h[u],d=d[l]=f>u?d[l]||(h[u+1]&&isNaN(h[u+1])?{}:[]):a;else e.isArray(i[l])?i[l].push(a):i[l]!==c?i[l]=[i[l],a]:i[l]=a;else l&&(i[l]=n?c:"")}),i},h[I]=i(s,0),h[P]=f=i(s,1),e[M]||(e[M]=function(t){return e.extend(O,t)})({a:Q,base:Q,iframe:B,img:B,input:B,form:"action",link:Q,script:B}),g=e[M],e.fn[I]=i(l,I),e.fn[P]=i(l,P),T.pushState=p=function(e,t){n(e)&&/^#/.test(e)&&t===c&&(t=2);var i=e!==c,r=u(location.href,i?e:{},i?t:2);location.href=r},T.getState=m=function(e,t){return e===c||"boolean"==typeof e?f(e):f(t)[e]},T.removeState=function(t){var n={};t!==c&&(n=m(),e.each(e.isArray(t)?t:arguments,function(e,t){delete n[t]})),p(n,2)},_[S]=e.extend(_[S],{add:function(t){function n(e){var t=e[P]=u();e.getState=function(e,n){return e===c||"boolean"==typeof e?h(t,e):h(t,n)[e]},i.apply(this,arguments)}var i;return e.isFunction(t)?(i=t,n):(i=t.handler,void(t.handler=n))}})}(jQuery,this),function(e,t,n){"$:nomunge";function i(e){return e=e||location.href,"#"+e.replace(/^[^#]*#?(.*)$/,"$1")}var r,o="hashchange",a=document,s=e.event.special,l=a.documentMode,c="on"+o in t&&(l===n||l>7);e.fn[o]=function(e){return e?this.bind(o,e):this.trigger(o)},e.fn[o].delay=50,s[o]=e.extend(s[o],{setup:function(){return c?!1:void e(r.start)},teardown:function(){return c?!1:void e(r.stop)}}),r=function(){function r(){var n=i(),a=f(d);n!==d?(h(d=n,a),e(t).trigger(o)):a!==d&&(location.href=location.href.replace(/#.*/,"")+a),s=setTimeout(r,e.fn[o].delay)}var s,l={},d=i(),u=function(e){return e},h=u,f=u;return l.start=function(){s||r()},l.stop=function(){s&&clearTimeout(s),s=n},null!==navigator.userAgent.match(/MSIE/i)&&!c&&function(){var t,n;l.start=function(){t||(n=e.fn[o].src,n=n&&n+i(),t=e('<iframe tabindex="-1" title="empty"/>').hide().one("load",function(){n||h(i()),r()}).attr("src",n||"javascript:0").insertAfter("body")[0].contentWindow,a.onpropertychange=function(){try{"title"===event.propertyName&&(t.document.title=a.title)}catch(e){}})},l.stop=u,f=function(){return i(t.location.href)},h=function(n,i){var r=t.document,s=e.fn[o].domain;n!==i&&(r.title=a.title,r.open(),s&&r.write('<script>document.domain="'+s+'"</script>'),r.close(),t.location.hash=n)}}(),l}()}(jQuery,this),function(){var e={init:function(e){this.data=e,this.clear();var t=jQuery("<div/>").addClass("chartScroll").appendTo(this);this.chart=jQuery("<div/>").addClass("chart").appendTo(t);var n=jQuery("<div/>").addClass("labelsScroll").appendTo(this);this.xlabels=jQuery("<div/>").addClass("labels").appendTo(n),this.setup(),this.grid(),this.labels(),this.bars()},update:function(e){this.data=e,this.chart=this.find(".chart"),this.xlabels=this.find(".labels"),this.clear(),this.setup(),this.grid(),this.labels(),this.bars(),this.chart.css("left","-"+(this.data.length*this.dim.move-this.dim.width)+"px")},clear:function(){this.find(".gridLine, label, a, .bar").remove()},setup:function(){for(var e=this,t=0,n=0;n<this.data.length;n++)t=Math.max(t,Math.abs((""+this.data[n]).replace("#","")));t=Math.ceil(t),this.dim={width:parseInt(this.chart.parent().css("width"),10),height:parseInt(this.chart.parent().css("height"),10),left:parseInt(this.css("padding-left"),10),move:this.width()/60},this.measures={top:function(t){return"#"==(""+t).substr(0,1)?parseFloat((""+t).substr(1))<0?e.dim.height/2:0:t>0?e.dim.height/2-this.height(t):e.dim.height/2;
},height:function(n){return"#"==(""+n).substr(0,1)?e.dim.height/2:Math.abs(n)/t*(e.dim.height/2)},max:function(){return t}}},grid:function(){for(var e=Math.max(60,this.data.length),t=this.dim.move,n=this.measures.max(),i=-n+1;n>i;i++)jQuery("<div/>").addClass("gridLine").css({width:this.dim.width+"px",height:"1px",left:this.dim.left+"px",top:this.measures.top(i)+(0>i?this.measures.height(i):0)}).appendTo(this);for(var i=1;e>i;i++)jQuery("<div/>").addClass("gridLine"+(i%10===0?" special":"")).css({width:"1px",height:this.dim.height+"px",top:"0px",left:i*t+"px"}).appendTo(this.chart);jQuery("<div/>").addClass("gridLine middle").css({width:this.dim.width+"px",height:"2px",top:this.measures.top(0)-1+"px",left:this.dim.left+"px"}).appendTo(this)},labels:function(){for(var e=Math.max(2,this.measures.max()),t=this.dim.move,n=Math.max(30,this.data.length/2),i=5;n>i;i+=5){var r=jQuery("<label/>").addClass("x").html(i).appendTo(this.xlabels);r.css("left",t*i*2-r.width()/2+"px")}for(var i=-e+1;e>i;i++){var r=jQuery("<label/>").addClass("y").html(i).appendTo(this);r.css("top",this.measures.top(i)+-9+(0>i?this.measures.height(i):0)-r.height()/2+"px")}if(this.data.length>60){var o=this;jQuery("<a/>").addClass("scrollLeft").appendTo(this).on("click",function(){o.scroll(-1)}),jQuery("<a/>").addClass("scrollRight").appendTo(this).on("click",function(){o.scroll(1)});var a=this.data.length-60;o.scroll(1,!1,Math.floor(a/20)+1)}},bars:function(){for(var e=this.dim.move,t=this,n=0;n<this.data.length;n++)jQuery("<div/>").addClass("bar "+(parseFloat((""+this.data[n]).replace("#",""))>0?"positive":"negative")).css({left:e*n+1+"px",top:this.measures.top(this.data[n])+"px",width:e-1+"px",height:this.measures.height(this.data[n])+"px"}).appendTo(this.chart).on("mouseover",function(e){return function(){t.trigger("chartover",{index:e,value:t.data[e],bar:jQuery(this)})}}(n))},scroll:function(e,t,n){void 0===t&&(t=!0),n=n||1;var i=this.dim.move,r=this.data.length*i-this.dim.width,o=parseInt(this.chart.css("left"),10);if(t||(o=0),0>e){if(0===o)return;o+=200*n}else{if(!(e>0))return;o-=200*n}var a=-Math.max(0,Math.min(-o,r));t?(this.chart.animate({left:a+"px"},200),this.xlabels.animate({left:a+"px"},200)):(this.chart.css("left",a+"px"),this.xlabels.css("left",a+"px"))}};jQuery.fn.barChart=function(t){return this.each(function(){var n=jQuery(this);n.data("barchart")?t&&jQuery.extend(n,e).update(t):jQuery.extend(n,e).data("barchart",!0).init(t)})}}(),function(){var e=0,t=0,n=function(){var e=jQuery("<div/>").css({visibility:"hidden",position:"fixed",left:"20px",top:"20px"}).appendTo("body");setTimeout(function(){e.remove()},1)},i={getAlignParent:function(){var e=this.attr("x-bubble-align");return e?jQuery(".x-bubble-align-"+e):null},setAlignParent:function(e){var n=this.attr("x-bubble-align");n?jQuery(".x-bubble-align-"+n).removeClass("x-bubble-align-"+n):(n=t++,this.attr("x-bubble-align",n)),e.addClass("x-bubble-align-"+n).on("click",function(e){try{e.cancelBubble=!0,e.stopPropagation()}catch(t){}})},getIncludeParent:function(){var e=this.attr("x-bubble-include");return e?jQuery(".x-bubble-include-"+e):null},setIncludeParent:function(t){var n=e++;t.addClass("x-bubble-include-"+n).on("click",function(e){try{e.cancelBubble=!0,e.stopPropagation()}catch(t){}}),this.attr("x-bubble-include",n),this.addClass("bubble-included")},alignProxy:function(){return this.attr("x-bubble-align")?this.alignAligned():this.attr("x-bubble-include")?this.alignIncluded():this},alignAligned:function(e,t){var n=e&&!this.settings.noanimation?function(e){this.animate(e,200)}:function(e){this.css(e)},i=this.find("> .bubble-handle:first"),r=this.getAlignParent();if(!r)return this.settings.detached?this:this.hide();this.appendTo("body");var o=t||this.settings.side;this.settings.forceside=t;var a=this.settings.offset_x||0,s=this.settings.offset_y||0;this.add(this.find(".bubble-contents")).css("height","auto").css("width","auto");var l=this.height(),c=this.width(),d=r.offset().left,u=r.offset().top,h=r.width()+parseInt(r.css("padding-left"))+parseInt(r.css("padding-right")),f=r.height()+parseInt(r.css("padding-top"))+parseInt(r.css("padding-bottom")),p="overlay"==this.settings.point?8:-i.height()+8;if("left"==o){if(!t&&this.settings.flexible&&!this.settings.x&&d+h+p+c>jQuery(document).width())return this.alignAligned(e,"right");n.call(this,{left:this.settings.x||d+h+p+a+"px",top:this.settings.y||u+f/2-l/2+s+"px"}),this.settings.y?i.css("top",u-this.settings.y+f/2-i.height()/2+"px"):i.css("top",l/2-i.height()/2+"px")}else if("right"==o){if(!t&&this.settings.flexible&&!this.settings.x&&d-c-p<jQuery(window).scrollLeft())return this.alignAligned(e,"left");n.call(this,{left:this.settings.x||d-c-p+a+"px",top:this.settings.y||u+f/2-l/2+s+"px"}),this.settings.y?i.css("top",u-this.settings.y+f/2-i.height()/2+"px"):i.css("top",l/2-i.height()/2+"px")}else if("top"==o)if(this.settings.detached)i.css({left:d+h/2-i.width()/2-this.offset().left+"px",top:u-this.offset().top+p}),i.offset().top>this.offset().top&&i.offset().top+i.height()<this.offset().top+this.height()?i.hide():i.show();else{if(!t&&this.settings.flexible&&!this.settings.y&&u+f+p+l>jQuery(window).height())return this.alignAligned(e,"bottom");n.call(this,{left:this.settings.x||d+h/2-c/2+a+"px",top:this.settings.y||u+f-p+s+"px"}),this.settings.x?i.css("left",d-this.settings.x+h/2-i.width()/2+"px"):i.css("left",c/2-i.width()/2+"px")}else if("bottom"==o)if(this.settings.detached)i.css({left:d+h/2-i.width()/2-this.offset().left+"px",top:u-this.offset().top+p}),i.offset().top>this.offset().top&&i.offset().top+i.height()<this.offset().top+this.height()?i.hide():i.show();else{if(!t&&this.settings.flexible&&!this.settings.y&&u-l+p<jQuery(window).scrollTop())return this.alignAligned(e,"top");n.call(this,{left:this.settings.x||d+h/2-c/2+a+"px",top:this.settings.y||u-l+p+s+"px"}),this.settings.x?i.css("left",d-this.settings.x+h/2-i.width()/2+"px"):i.css("left",c/2-i.width()/2+"px")}return this},alignIncluded:function(e){var t=this.find("> .bubble-handle:first"),n=this.getIncludeParent(),i=this.height(),r=this.width(),o=n.width()+parseInt(n.css("padding-left"))+parseInt(n.css("padding-right")),a=n.height()+parseInt(n.css("padding-top"))+parseInt(n.css("padding-bottom")),s="overlay"==this.settings.point?8:-t.height()+8;return"left"==this.settings.side?(this.css({left:o+s+"px",top:a/2-i/2+"px"}),t.css("top",i/2-t.height()/2+"px")):"right"==this.settings.side?(this.css({left:-r-s+"px",top:a/2-i/2+"px"}),t.css("top",i/2-t.height()/2+"px")):"top"==this.settings.side?(this.css({left:o/2-r/2+"px",top:a+s+"px"}),t.css("left",r/2-t.width()/2+"px")):"bottom"==this.settings.side&&(this.css({left:o/2-r/2+"px",top:-s-i+"px"}),t.css("left",r/2-t.width()/2+"px")),"function"==typeof e&&e(),this},show:function(e){var t=this.settings.noanimation?function(e,t,n){this.css(e),n&&n()}:function(e,t,n){this.animate(e,t,n)};if(this.settings.persistent)return void this.find(".bubble-handle").show();var i=this;if("block"==this.css("display"))return"function"==typeof e&&e(),this;this.alignProxy();var r=this.find(".bubble-contents");this.hide(),r.css("width","auto").css("height","auto");var o=this.height(),a=this.width(),s=parseInt(this.css("left")),l=parseInt(this.css("top")),c=this.settings.forceside||this.settings.side;switch(this.removeClass("bubble-left bubble-right bubble-top bubble-bottom").addClass("bubble-"+c),c){case"left":t.call(r.css("width","0px"),{width:a+"px"},200,function(){r.css("width","auto"),e&&e(),n()}),this.css("display","block");break;case"right":t.call(r.css("width","0px"),{width:a+"px"},200,function(){r.css("width","auto"),n()}),t.call(this.css("left",s+a+"px").css("display","block"),{left:s+"px"},200,e);break;case"top":t.call(r.css("height","0px"),{height:o+"px"},200,function(){r.css("height","auto"),e&&e(),n()}),this.css("display","block");break;case"bottom":t.call(r.css("height","0px"),{height:o+"px"},200,function(){r.css("height","auto"),n()}),t.call(this.css("top",l+o+"px").css("display","block"),{top:l+"px"},200,e)}if("top"==c||"bottom"==c){var d=Math.max(0,this.offset().left+this.width()-jQuery(window).width())||Math.min(0,this.offset().left);if(d){var u=this.find(".bubble-handle");this.css("left",parseInt(this.css("left"))-d+"px"),u.css("left",parseInt(u.css("left"))+d+"px")}}if(!this.settings.persistent){var h=function(e){"block"==i.css("display")&&3!=e.which&&(i.hide(),jQuery(document).off("click",h))};jQuery(document).on("click",h)}return this},hide:function(e){var t=this.settings.noanimation?function(e,t,n){this.css(e),n&&n()}:function(e,t,n){this.animate(e,t,n)};if(this.settings.persistent)return void this.find(".bubble-handle").hide();if("none"==this.css("display"))return"function"==typeof e&&e(),this;var n=this,i=this.find(".bubble-contents"),r=this.settings.forceside||this.settings.side;this.css("width","auto").css("height","auto");var o=this.height(),a=this.width(),s=parseInt(this.css("left")),l=parseInt(this.css("top"));switch(r){case"left":t.call(i,{width:"0px"},200,function(){e&&e(),n.css("display","none")});break;case"right":t.call(i,{width:"0px"},200),t.call(this,{left:s+a+"px"},200,function(){e&&e(),n.css("display","none").css("left",s+"px").css("width",a+"px")});break;case"top":t.call(i,{height:"0px"},200,function(){e&&e(),n.css("display","none")});break;case"bottom":t.call(i,{height:"0px"},200),t.call(this,{top:l+o+"px"},200,function(){e&&e(),n.css("display","none").css("top",l+"px").css("height",o+"px")})}return this},realign:function(e){return e?jQuery(e).length?(this.setAlignParent(jQuery(e)),this.find(".bubble-handle").show(),"none"==this.css("display")?this.show():this.alignAligned(!0),this):this:this.alignAligned()},collapseTitle:function(e){var t=this.find(".bubble-collapsed-text");t.length||(t=jQuery("<div/>").addClass("bubble-collapsed-text").appendTo(this)),"undefined"!=typeof e&&t.html(e)},collapse:function(e){var t=this;this.collapseTitle(e),this.hasClass("bubble-collapsed")||(this.data("expanded-height",this.height()),this.addClass("bubble-collapsed"),this.animate({height:"36px"},200,function(){t.find(".bubble-contents").hide(),t.trigger("collapse")}))},expand:function(){if(this.hasClass("bubble-collapsed")){var e=this;this.find(".bubble-contents").show(),this.animate({height:this.data("expanded-height")+"px"},200,function(){e.removeClass("bubble-collapsed"),e.trigger("expand")})}},detach:function(){return this.settings.detached?this:(this.settings.detached=!0,this.saveSettings(),this.alignProxy(),this)},attach:function(){return this.settings.detached?(this.settings.detached=!1,this.saveSettings(),this.alignProxy(),this):this},adjust:function(){var e=0,t=0;this.find("> *").each(function(){jQuery(this).hasClass("bubble-handle")||(t+=jQuery(this).innerHeight(),e=Math.max(e,jQuery(this).innerWidth()))});var n=e-this.innerWidth(),i=t-this.innerHeight(),r={};n&&(r.width=e+"px"),i&&(r.height=t+"px");var o=this.settings.forceside||this.settings.side;t&&"bottom"==o&&(r.top=(i>0?"-":"+")+"="+Math.abs(i)+"px"),e&&"right"==o&&(r.left=(n>0?"-":"+")+"="+Math.abs(n)+"px"),this.animate(r,200)},html:function(e){return jQuery(".bubble-handle",this).next().html(e),this},options:function(e){this.settings=jQuery.extend(this.settings,e),this.saveSettings()},saveSettings:function(){this.data("bubble-settings",this.settings)}};jQuery.fn.bubble=function(e){var t={};"object"==typeof e&&(t=jQuery.extend({},e,{align:e.align?jQuery(e.align):null,include:e.include&&!e.align?jQuery(e.include):null,side:!e.side||"left"!=e.side&&"right"!=e.side&&"top"!=e.side&&"bottom"!=e.side?"left":e.side,point:e.point||"overlay",mode:e.mode||"free",x:e.x,y:e.y}));var n;if(!this.length)return this;if(e||(e={}),"string"==typeof e){var r=this.hasClass("bubble")?this:this.closest(".bubble");if(!r.length)return;r.settings=jQuery.extend(r.data("bubble-settings")||{},t),n=jQuery.extend(r,i),"function"==typeof n[e]&&n[e].apply(n,[].slice.call(arguments,1))}else{var o=jQuery('<div class="bubble-handle"/>');if(n=jQuery('<div class="bubble"/>')[t.persistent?"show":"hide"]().append(o).append(jQuery('<div class="bubble-contents"/>').append(this)).css("width",t.width||"auto").appendTo(t.include||"body").addClass("bubble-"+t.side),n=jQuery.extend(n,i),n.data("bubble-settings",t).settings=t,t.close)n.append(jQuery("<a/>").addClass("bubble-close").on("click",function(e){return n.bubble("hide"),!1}));else if(t.collapsable){var a,s;a=jQuery("<a/>").addClass("bubble-collapse").on("click",function(e){return n.bubble("collapse"),a.hide(),s.show(),!1}),s=jQuery("<a/>").addClass("bubble-expand").on("click",function(e){return n.bubble("expand"),s.hide(),a.show(),!1}).hide(),n.append(a).append(s)}t.align?n.setAlignParent(t.align):t.include&&n.setIncludeParent(t.include),jQuery(this).on("click",function(e){try{e.cancelBubble=!0,e.stopPropagation()}catch(t){}})}return n}}(),jQuery.fn.capturedPieces=function(e){function t(e,t){function n(){var e=new Handler.Template("plugin"),t=e.render("capturedPieces");s.html(t),u.capturedWhitePiecesRow=s.find(".capturedWhitePiecesHolder"),u.capturedBlackPiecesRow=s.find(".capturedBlackPiecesHolder"),u.capturedPiecesSwitch=s.find(".capturedPiecesSwitch"),u.materialBalanceSwitch=s.find(".materialBalanceSwitch"),l=new View.CapturedPieces(u.capturedWhitePiecesRow,["w"],!1).link(d),c=new View.CapturedPieces(u.capturedBlackPiecesRow,["b"],!1).link(d),u.capturedPiecesSwitch.on("click",i),u.materialBalanceSwitch.on("click",r)}function i(){return o(!1)}function r(){return o(!0)}function o(e){l.setDiff(e),c.setDiff(e),e?(u.materialBalanceSwitch.addClass("active"),u.capturedPiecesSwitch.removeClass("active")):(u.capturedPiecesSwitch.addClass("active"),u.materialBalanceSwitch.removeClass("active"))}var a=this,s=jQuery(e),l=null,c=null,d=t.chessGameHandler,u={capturedWhitePiecesRow:null,capturedBlackPiecesRow:null,capturedPiecesSwitch:null,materialBalanceSwitch:null};return n(),a}return this.each(function(){return jQuery(this).data("capturedPieces")||(e&&e.chessGameHandler||errorHandler.msg("error",new Error("No chessGameHandler given"),!0),jQuery(this).data("capturedPieces",new t(this,e))),this})},function(){var e={peritem:200,count:0,position:0,radius:0,itemwidth:100,ratio:1.58,init:function(e){if(this.closest("div.carousel").length)this.catchup();else{for(var t in e)("number"==typeof this[t]||"string"==typeof this[t])&&(this[t]=e[t]);var n=jQuery("<div/>").addClass("carousel preventSelection").insertBefore(this);this.controls={container:n,viewport:jQuery("<div/>").addClass("carousel-viewport").appendTo(n).append(this),next:jQuery("<a/>").addClass("carousel-next").appendTo(n),previous:jQuery("<a/>").addClass("carousel-previous").appendTo(n)}}this.find("li img").each(function(){var e=jQuery(this);e.attr("src")&&!e.data("src")&&e.data("src",e.attr("src")).attr("src","")}),this.find("li").each(function(){var e=jQuery(this);e.find("> div.title").length||jQuery("<div/>").addClass("title").html(e.attr("title")).appendTo(e),e.find("> div.image").length||jQuery("<div/>").addClass("image").append(e.find(">a,>img")).appendTo(e),e.find("> div.comment").length||jQuery("<div/>").addClass("comment").html(e.attr("comment")).appendTo(e),e.removeAttr("title comment")}),this.radius=this.controls.viewport.width()/2,this.count=this.find("li").length,this.position=this.entire()/2+(this.count%2===0?-this.peritem/2:0);var i=this.find("li.start");if(i.length){var r=i.prevAll("li").length;this.position=r*this.peritem}this.setupInteractions(),this.css("visibility","visible").adjust()},catchup:function(){var e=this.closest("div.carousel");this.controls={container:e,viewport:e.find(".carousel-viewport"),next:e.find(".carousel-next"),previous:e.find(".carousel-previous")}},setupInteractions:function(){var e=this,t=function(e){try{e.preventDefault(),e.stopPropagation()}catch(t){e.cancelBubble=!0,e.returnValue=!1}return!1};this.controls.next.on("click",function(n){return e.scrollTo(e.position+e.peritem,!0),t(n)}),this.controls.previous.on("click",function(n){return e.scrollTo(e.position-e.peritem,!0),t(n)});var n=!1;this.on("mousedown",function(t){n=!1;var i=t.pageX,r=e.position,o=function(){jQuery(document).off("mousemove",a)},a=function(t){n=!0,e.scrollTo(r-(t.pageX-i))};jQuery(document).on("mousemove",a).one("mouseup",o);try{t.stopPropagation(),t.preventDefault()}catch(s){t.cancelBubble=!0,t.returnValue=!1}}),this.find("li a").on("click",function(e){return n?t(e):void 0})},scrollTo:function(e,t){if(this.animation&&clearTimeout(this.animation),t){e=Math.max(0,Math.min(e,this.entire()));var n=this,i=function(e,t,n,i){return e/=i,e--,n*(e*e*e+1)+t},r=0,o=200,a=20,s=this.position,l=e-s;this.animation=setInterval(function(){r+=o/a,n.position=i(r,s,l,o),n.adjust(),r>=o&&clearTimeout(n.animation)},o/a)}else this.position=Math.max(0,Math.min(e,this.entire())),this.adjust()},load:function(){},entire:function(){return(this.count-1)*this.peritem},calculateItem:function(e){var t=this.position-this.radius*Math.PI/2,n=this.position+this.radius*Math.PI/2,i=this.controls.viewport.width(),r=e>=t-4*this.peritem&&e<=n+4*this.peritem;if(t>e)return{x:0,y:0,left:!0,stack:!0,preload:r};if(e>n)return{x:i,y:0,right:!0,stack:!0,preload:r};var o=2*Math.PI*this.radius,a=(e-this.position)/o*(2*Math.PI),s=this.radius*Math.sin(a),l=Math.cos(a);return{x:i/2+s,y:l,front:Math.abs(a)<Math.PI/8.6,left:Math.abs(a)>=Math.PI/8.6&&e<this.position,right:Math.abs(a)>=Math.PI/8.6&&e>this.position,preload:!0}},adjust:function(){var e=this,t=e.controls.viewport.height()/2,n=this.find("li");n.each(function(i){var r=jQuery(this),o=r.find("img"),a=i*e.peritem,s=e.calculateItem(a),l=1+2*Math.pow(s.y,4),c=e.itemwidth*l,d=e.itemwidth/e.ratio*l,u=0;s.front?(r.addClass("front"),u=parseInt(r.css("padding-top"),10)):r.removeClass("front"),r[s.front?"addClass":"removeClass"]("front"),r[s.left?"addClass":"removeClass"]("left"),r[s.right?"addClass":"removeClass"]("right"),r[s.stack&&(s.right&&i<n.length-1||s.left&&i>0)?"addClass":"removeClass"]("stack"),r.css({width:c+"px",height:d+"px",left:s.x-c/2+"px",top:t-d/2-u+"px","z-index":Math.ceil(10*s.y)+(s.stack?0:1)}),o.css({height:d+"px",width:c+"px"}),s.preload&&!o.attr("src")&&o.attr("src",o.data("src")).data("src","")}),n.filter(".stack.left:last, .stack.right:first").css("z-index",1)}};jQuery.fn.carousel=function(t){$(this).each(function(){var n=$(this);n.data("carousel")||(n.data("carousel",!0),jQuery.extend(n,e).init(t))})}}(),function(e){e.fn.centerScreen=function(t){var n=this;t?(n.stop(),n.animate({top:e(window).height()/2-this.height()/2,left:e(window).width()/2-this.width()/2},200,"linear")):(n.css("top",e(window).height()/2-this.height()/2),n.css("left",e(window).width()/2-this.width()/2),e(window).resize(function(){n.centerScreen(!t)}))}}(jQuery),function(e){function t(t){var n=t.data("class-setter-on-click"),i=n.classname,r=n.method;if(i&&r){var o=e(n.target);if(!n.target)var o=t;switch(r){case"add":o.addClass(i);break;case"remove":o.removeClass(i);break;case"toggle":o.toggleClass(i)}}}e.fn.classSetterOnClick=function(){this.on("click",function(){t(e(this))})}}(jQuery),function(e){var t=null;e.fn.clipboard=function(n){if("object"==typeof n&&!n.length||"undefined"==typeof n){var i=e.extend({path:"jquery.clipboard.swf",copy:null,beforeCopy:null,afterCopy:null,clickAfter:!0},n||{});return this.each(function(){var n=e(this);n.is(":visible")&&("string"==typeof i.copy||e.isFunction(i.copy))&&(e.isFunction(i.copy)&&n.bind("Clipboard_copy",i.copy),e.isFunction(i.beforeCopy)&&n.bind("Clipboard_beforeCopy",i.beforeCopy),e.isFunction(i.afterCopy)&&n.bind("Clipboard_afterCopy",i.afterCopy),null===t&&(ZeroClipboard.config({moviePath:i.path,trustedDomains:"*",hoverClass:"hover",activeClass:"active"}),t=new ZeroClipboard(null),t.on("load",function(t){t.on("mouseover",function(t){e(this).trigger("mouseenter")}),t.on("mouseout",function(t){e(this).trigger("mouseleave")}),t.on("mousedown",function(t){e(this).trigger("mousedown"),e.isFunction(i.copy)?t.setText(e(this).triggerHandler("Clipboard_copy")):t.setText(i.copy),e.isFunction(i.beforeCopy)&&e(this).trigger("Clipboard_beforeCopy")}),t.on("complete",function(t,n){e.isFunction(i.afterCopy)?e(this).trigger("Clipboard_afterCopy"):e(this).removeClass("hover"),i.clickAfter&&e(this).trigger("click")})})),t.clip([n[0]]))})}}}(jQuery),function(){"use strict";function e(e){return e.replace(/,/g,".").replace(/[^0-9\.]/g,"")}function t(t){return parseFloat(e(t))>=10}var n,i={bridge:null,version:"0.0.0",disabled:null,outdated:null,ready:null},r={},o=0,a={},s=0,l={},c=null,d=null,u=function(){var e,t,n,i,r="ZeroClipboard.swf";if(document.currentScript&&(i=document.currentScript.src));else{var o=document.getElementsByTagName("script");if("readyState"in o[0])for(e=o.length;e--&&("interactive"!==o[e].readyState||!(i=o[e].src)););else if("loading"===document.readyState)i=o[o.length-1].src;else{for(e=o.length;e--;){if(n=o[e].src,!n){t=null;break}if(n=n.split("#")[0].split("?")[0],n=n.slice(0,n.lastIndexOf("/")+1),null===t)t=n;else if(t!==n){t=null;break}}null!==t&&(i=t)}}return i&&(i=i.split("#")[0].split("?")[0],r=i.slice(0,i.lastIndexOf("/")+1)+r),r}(),h=function(){var e=/\-([a-z])/g,t=function(e,t){return t.toUpperCase()};return function(n){return n.replace(e,t)}}(),f=function(e,t){var n,i,r;return window.getComputedStyle?n=window.getComputedStyle(e,null).getPropertyValue(t):(i=h(t),n=e.currentStyle?e.currentStyle[i]:e.style[i]),"cursor"!==t||n&&"auto"!==n||(r=e.tagName.toLowerCase(),"a"!==r)?n:"pointer"},p=function(e){e||(e=window.event);var t;this!==window?t=this:e.target?t=e.target:e.srcElement&&(t=e.srcElement),O.activate(t)},m=function(e,t,n){e&&1===e.nodeType&&(e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n))},g=function(e,t,n){e&&1===e.nodeType&&(e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n))},v=function(e,t){if(!e||1!==e.nodeType)return e;if(e.classList)return e.classList.contains(t)||e.classList.add(t),e;if(t&&"string"==typeof t){var n=(t||"").split(/\s+/);if(1===e.nodeType)if(e.className){for(var i=" "+e.className+" ",r=e.className,o=0,a=n.length;a>o;o++)i.indexOf(" "+n[o]+" ")<0&&(r+=" "+n[o]);e.className=r.replace(/^\s+|\s+$/g,"")}else e.className=t}return e},y=function(e,t){if(!e||1!==e.nodeType)return e;if(e.classList)return e.classList.contains(t)&&e.classList.remove(t),e;if(t&&"string"==typeof t||void 0===t){var n=(t||"").split(/\s+/);if(1===e.nodeType&&e.className)if(t){for(var i=(" "+e.className+" ").replace(/[\n\t]/g," "),r=0,o=n.length;o>r;r++)i=i.replace(" "+n[r]+" "," ");e.className=i.replace(/^\s+|\s+$/g,"")}else e.className=""}return e},b=function(){var e,t,n,i=1;return"function"==typeof document.body.getBoundingClientRect&&(e=document.body.getBoundingClientRect(),t=e.right-e.left,n=document.body.offsetWidth,i=Math.round(t/n*100)/100),i},w=function(e,t){var n={left:0,top:0,width:0,height:0,zIndex:_(t)-1};if(e.getBoundingClientRect){var i,r,o,a=e.getBoundingClientRect();"pageXOffset"in window&&"pageYOffset"in window?(i=window.pageXOffset,r=window.pageYOffset):(o=b(),i=Math.round(document.documentElement.scrollLeft/o),r=Math.round(document.documentElement.scrollTop/o));var s=document.documentElement.clientLeft||0,l=document.documentElement.clientTop||0;n.left=a.left+i-s,n.top=a.top+r-l,n.width="width"in a?a.width:a.right-a.left,n.height="height"in a?a.height:a.bottom-a.top}return n},k=function(e,t){var n=null===t||t&&t.cacheBust===!0&&t.useNoCache===!0;return n?(-1===e.indexOf("?")?"?":"&")+"noCache="+(new Date).getTime():""},x=function(e){var t,n,i,r=[],o=[],a=[];if(e.trustedOrigins&&("string"==typeof e.trustedOrigins?o.push(e.trustedOrigins):"object"==typeof e.trustedOrigins&&"length"in e.trustedOrigins&&(o=o.concat(e.trustedOrigins))),e.trustedDomains&&("string"==typeof e.trustedDomains?o.push(e.trustedDomains):"object"==typeof e.trustedDomains&&"length"in e.trustedDomains&&(o=o.concat(e.trustedDomains))),o.length)for(t=0,n=o.length;n>t;t++)if(o.hasOwnProperty(t)&&o[t]&&"string"==typeof o[t]){if(i=P(o[t]),!i)continue;if("*"===i){a=[i];break}a.push.apply(a,[i,"//"+i,window.location.protocol+"//"+i])}return a.length&&r.push("trustedOrigins="+encodeURIComponent(a.join(","))),"string"==typeof e.jsModuleId&&e.jsModuleId&&r.push("jsModuleId="+encodeURIComponent(e.jsModuleId)),r.join("&")},C=function(e,t,n){if("function"==typeof t.indexOf)return t.indexOf(e,n);var i,r=t.length;for("undefined"==typeof n?n=0:0>n&&(n=r+n),i=n;r>i;i++)if(t.hasOwnProperty(i)&&t[i]===e)return i;return-1},j=function(e){if("string"==typeof e)throw new TypeError("ZeroClipboard doesn't accept query strings.");return e.length?e:[e]},T=function(e,t,n,i){i?window.setTimeout(function(){e.apply(t,n)},0):e.apply(t,n)},_=function(e){var t,n;return e&&("number"==typeof e&&e>0?t=e:"string"==typeof e&&(n=parseInt(e,10))&&!isNaN(n)&&n>0&&(t=n)),t||("number"==typeof H.zIndex&&H.zIndex>0?t=H.zIndex:"string"==typeof H.zIndex&&(n=parseInt(H.zIndex,10))&&!isNaN(n)&&n>0&&(t=n)),t||0},S=function(e,t){if(e&&t!==!1&&"undefined"!=typeof console&&console&&(console.warn||console.log)){var n="`"+e+"` is deprecated. See docs for more info:\n    https://github.com/zeroclipboard/zeroclipboard/blob/master/docs/instructions.md#deprecations";console.warn?console.warn(n):console.log(n)}},I=function(){var e,t,n,i,r,o,a=arguments[0]||{};for(e=1,t=arguments.length;t>e;e++)if(null!==(n=arguments[e]))for(i in n)if(n.hasOwnProperty(i)){if(r=a[i],o=n[i],a===o)continue;void 0!==o&&(a[i]=o)}return a},P=function(e){if(null===e||""===e)return null;if(e=e.replace(/^\s+|\s+$/g,""),""===e)return null;var t=e.indexOf("//");e=-1===t?e:e.slice(t+2);var n=e.indexOf("/");return e=-1===n?e:-1===t||0===n?null:e.slice(0,n),e&&".swf"===e.slice(-4).toLowerCase()?null:e||null},M=function(){var e=function(e,t){var n,i,r;if(null!==e&&"*"!==t[0]&&("string"==typeof e&&(e=[e]),"object"==typeof e&&"length"in e))for(n=0,i=e.length;i>n;n++)if(e.hasOwnProperty(n)&&(r=P(e[n]))){if("*"===r){t.length=0,t.push("*");break}-1===C(r,t)&&t.push(r)}},t={always:"always",samedomain:"sameDomain",never:"never"};return function(n,i){var r,o=i.allowScriptAccess;if("string"==typeof o&&(r=o.toLowerCase())&&/^always|samedomain|never$/.test(r))return t[r];var a=P(i.moviePath);null===a&&(a=n);var s=[];e(i.trustedOrigins,s),e(i.trustedDomains,s);var l=s.length;if(l>0){if(1===l&&"*"===s[0])return"always";if(-1!==C(n,s))return 1===l&&n===a?"sameDomain":"always"}return"never"}}(),Q=function(e){if(null===e)return[];if(Object.keys)return Object.keys(e);var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t},B=function(e){if(e)for(var t in e)e.hasOwnProperty(t)&&delete e[t];return e},E=function(){var e=!1;if("boolean"==typeof i.disabled)e=i.disabled===!1;else{if("function"==typeof ActiveXObject)try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash")&&(e=!0)}catch(t){}!e&&navigator.mimeTypes["application/x-shockwave-flash"]&&(e=!0)}return e},O=function(e,t){return this instanceof O?(this.id=""+o++,a[this.id]={instance:this,elements:[],handlers:{}},e&&this.clip(e),"undefined"!=typeof t&&(S("new ZeroClipboard(elements, options)",H.debug),O.config(t)),this.options=O.config(),"boolean"!=typeof i.disabled&&(i.disabled=!E()),void(i.disabled===!1&&i.outdated!==!0&&null===i.bridge&&(i.outdated=!1,i.ready=!1,N()))):new O(e,t)};O.prototype.setText=function(e){return e&&""!==e&&(r["text/plain"]=e,i.ready===!0&&i.bridge&&i.bridge.setText(e)),this},O.prototype.setSize=function(e,t){return i.ready===!0&&i.bridge&&i.bridge.setSize(e,t),this};var A=function(e){i.ready===!0&&i.bridge&&i.bridge.setHandCursor(e)};O.prototype.destroy=function(){this.unclip(),this.off(),delete a[this.id]};var D=function(){var e,t,n,i=[],r=Q(a);for(e=0,t=r.length;t>e;e++)n=a[r[e]].instance,n&&n instanceof O&&i.push(n);return i};O.version="1.3.2";var H={swfPath:u,trustedDomains:window.location.host?[window.location.host]:[],cacheBust:!0,forceHandCursor:!1,zIndex:999999999,debug:!0,title:null,autoActivate:!0};O.config=function(e){"object"==typeof e&&null!==e&&I(H,e);{if("string"!=typeof e||!e){var t={};for(var n in H)H.hasOwnProperty(n)&&("object"==typeof H[n]&&null!==H[n]?"length"in H[n]?t[n]=H[n].slice(0):t[n]=I({},H[n]):t[n]=H[n]);return t}if(H.hasOwnProperty(e))return H[e]}},O.destroy=function(){O.deactivate();for(var e in a)if(a.hasOwnProperty(e)&&a[e]){var t=a[e].instance;t&&"function"==typeof t.destroy&&t.destroy()}var n=L(i.bridge);n&&n.parentNode&&(n.parentNode.removeChild(n),i.ready=null,i.bridge=null)},O.activate=function(e){n&&(y(n,H.hoverClass),y(n,H.activeClass)),n=e,v(e,H.hoverClass),G();var t=H.title||e.getAttribute("title");if(t){var r=L(i.bridge);r&&r.setAttribute("title",t)}var o=H.forceHandCursor===!0||"pointer"===f(e,"cursor");A(o)},O.deactivate=function(){var e=L(i.bridge);e&&(e.style.left="0px",e.style.top="-9999px",e.removeAttribute("title")),n&&(y(n,H.hoverClass),y(n,H.activeClass),n=null)};var N=function(){var e,t,n=document.getElementById("global-zeroclipboard-html-bridge");if(!n){var r=O.config();r.jsModuleId="string"==typeof c&&c||"string"==typeof d&&d||null;var o=M(window.location.host,H),a=x(r),s=H.moviePath+k(H.moviePath,H),l='      <object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" id="global-zeroclipboard-flash-bridge" width="100%" height="100%">         <param name="movie" value="'+s+'"/>         <param name="allowScriptAccess" value="'+o+'"/>         <param name="scale" value="exactfit"/>         <param name="loop" value="false"/>         <param name="menu" value="false"/>         <param name="quality" value="best" />         <param name="bgcolor" value="#ffffff"/>         <param name="wmode" value="transparent"/>         <param name="flashvars" value="'+a+'"/>         <embed src="'+s+'"           loop="false" menu="false"           quality="best" bgcolor="#ffffff"           width="100%" height="100%"           name="global-zeroclipboard-flash-bridge"           allowScriptAccess="'+o+'"           allowFullScreen="false"           type="application/x-shockwave-flash"           wmode="transparent"           pluginspage="http://www.macromedia.com/go/getflashplayer"           flashvars="'+a+'"           scale="exactfit">         </embed>       </object>';n=document.createElement("div"),n.id="global-zeroclipboard-html-bridge",n.setAttribute("class","global-zeroclipboard-container"),n.style.position="absolute",n.style.left="0px",n.style.top="-9999px",n.style.width="15px",n.style.height="15px",n.style.zIndex=""+_(H.zIndex),document.body.appendChild(n),n.innerHTML=l}e=document["global-zeroclipboard-flash-bridge"],e&&(t=e.length)&&(e=e[t-1]),i.bridge=e||n.children[0].lastElementChild},L=function(e){for(var t=/^OBJECT|EMBED$/,n=e&&e.parentNode;n&&t.test(n.nodeName)&&n.parentNode;)n=n.parentNode;return n||null},G=function(){if(n){var e=w(n,H.zIndex),t=L(i.bridge);t&&(t.style.top=e.top+"px",t.style.left=e.left+"px",t.style.width=e.width+"px",t.style.height=e.height+"px",t.style.zIndex=e.zIndex+1),i.ready===!0&&i.bridge&&i.bridge.setSize(e.width,e.height)}return this};O.prototype.on=function(e,t){var n,r,o,s={},l=a[this.id]&&a[this.id].handlers;if("string"==typeof e&&e)o=e.toLowerCase().split(/\s+/);else if("object"==typeof e&&e&&"undefined"==typeof t)for(n in e)e.hasOwnProperty(n)&&"string"==typeof n&&n&&"function"==typeof e[n]&&this.on(n,e[n]);if(o&&o.length){for(n=0,r=o.length;r>n;n++)e=o[n].replace(/^on/,""),s[e]=!0,l[e]||(l[e]=[]),l[e].push(t);s.noflash&&i.disabled&&F.call(this,"noflash",{}),s.wrongflash&&i.outdated&&F.call(this,"wrongflash",{flashVersion:i.version}),s.load&&i.ready&&F.call(this,"load",{flashVersion:i.version})}return this},O.prototype.off=function(e,t){var n,i,r,o,s,l=a[this.id]&&a[this.id].handlers;if(0===arguments.length)o=Q(l);else if("string"==typeof e&&e)o=e.split(/\s+/);else if("object"==typeof e&&e&&"undefined"==typeof t)for(n in e)e.hasOwnProperty(n)&&"string"==typeof n&&n&&"function"==typeof e[n]&&this.off(n,e[n]);if(o&&o.length)for(n=0,i=o.length;i>n;n++)if(e=o[n].toLowerCase().replace(/^on/,""),s=l[e],s&&s.length)if(t)for(r=C(t,s);-1!==r;)s.splice(r,1),
r=C(t,s,r);else l[e].length=0;return this},O.prototype.handlers=function(e){var t,n=null,i=a[this.id]&&a[this.id].handlers;if(i){if("string"==typeof e&&e)return i[e]?i[e].slice(0):null;n={};for(t in i)i.hasOwnProperty(t)&&i[t]&&(n[t]=i[t].slice(0))}return n};var R=function(e,t,n,i){var r=a[this.id]&&a[this.id].handlers[e];if(r&&r.length){var o,s,l,c=t||this;for(o=0,s=r.length;s>o;o++)l=r[o],t=c,"string"==typeof l&&"function"==typeof window[l]&&(l=window[l]),"object"==typeof l&&l&&"function"==typeof l.handleEvent&&(t=l,l=l.handleEvent),"function"==typeof l&&T(l,t,n,i)}return this};O.prototype.clip=function(e){e=j(e);for(var t=0;t<e.length;t++)if(e.hasOwnProperty(t)&&e[t]&&1===e[t].nodeType){e[t].zcClippingId?-1===C(this.id,l[e[t].zcClippingId])&&l[e[t].zcClippingId].push(this.id):(e[t].zcClippingId="zcClippingId_"+s++,l[e[t].zcClippingId]=[this.id],H.autoActivate===!0&&m(e[t],"mouseover",p));var n=a[this.id].elements;-1===C(e[t],n)&&n.push(e[t])}return this},O.prototype.unclip=function(e){var t=a[this.id];if(t){var n,i=t.elements;e="undefined"==typeof e?i.slice(0):j(e);for(var r=e.length;r--;)if(e.hasOwnProperty(r)&&e[r]&&1===e[r].nodeType){for(n=0;-1!==(n=C(e[r],i,n));)i.splice(n,1);var o=l[e[r].zcClippingId];if(o){for(n=0;-1!==(n=C(this.id,o,n));)o.splice(n,1);0===o.length&&(H.autoActivate===!0&&g(e[r],"mouseover",p),delete e[r].zcClippingId)}}}return this},O.prototype.elements=function(){var e=a[this.id];return e&&e.elements?e.elements.slice(0):[]};var V=function(e){var t,n,i,r,o,s=[];if(e&&1===e.nodeType&&(t=e.zcClippingId)&&l.hasOwnProperty(t)&&(n=l[t],n&&n.length))for(i=0,r=n.length;r>i;i++)o=a[n[i]].instance,o&&o instanceof O&&s.push(o);return s};H.hoverClass="zeroclipboard-is-hover",H.activeClass="zeroclipboard-is-active",H.trustedOrigins=null,H.allowScriptAccess=null,H.useNoCache=!0,H.moviePath="ZeroClipboard.swf",O.detectFlashSupport=function(){return S("ZeroClipboard.detectFlashSupport",H.debug),E()},O.dispatch=function(e,t){if("string"==typeof e&&e){var i=e.toLowerCase().replace(/^on/,"");if(i)for(var r=n?V(n):D(),o=0,a=r.length;a>o;o++)F.call(r[o],i,t)}},O.prototype.setHandCursor=function(e){return S("ZeroClipboard.prototype.setHandCursor",H.debug),e="boolean"==typeof e?e:!!e,A(e),H.forceHandCursor=e,this},O.prototype.reposition=function(){return S("ZeroClipboard.prototype.reposition",H.debug),G()},O.prototype.receiveEvent=function(e,t){if(S("ZeroClipboard.prototype.receiveEvent",H.debug),"string"==typeof e&&e){var n=e.toLowerCase().replace(/^on/,"");n&&F.call(this,n,t)}},O.prototype.setCurrent=function(e){return S("ZeroClipboard.prototype.setCurrent",H.debug),O.activate(e),this},O.prototype.resetBridge=function(){return S("ZeroClipboard.prototype.resetBridge",H.debug),O.deactivate(),this},O.prototype.setTitle=function(e){if(S("ZeroClipboard.prototype.setTitle",H.debug),e=e||H.title||n&&n.getAttribute("title")){var t=L(i.bridge);t&&t.setAttribute("title",e)}return this},O.setDefaults=function(e){S("ZeroClipboard.setDefaults",H.debug),O.config(e)},O.prototype.addEventListener=function(e,t){return S("ZeroClipboard.prototype.addEventListener",H.debug),this.on(e,t)},O.prototype.removeEventListener=function(e,t){return S("ZeroClipboard.prototype.removeEventListener",H.debug),this.off(e,t)},O.prototype.ready=function(){return S("ZeroClipboard.prototype.ready",H.debug),i.ready===!0};var F=function(o,a){o=o.toLowerCase().replace(/^on/,"");var s=a&&a.flashVersion&&e(a.flashVersion)||null,l=n,c=!0;switch(o){case"load":if(s){if(!t(s))return void F.call(this,"onWrongFlash",{flashVersion:s});i.outdated=!1,i.ready=!0,i.version=s}break;case"wrongflash":s&&!t(s)&&(i.outdated=!0,i.ready=!1,i.version=s);break;case"mouseover":v(l,H.hoverClass);break;case"mouseout":H.autoActivate===!0&&O.deactivate();break;case"mousedown":v(l,H.activeClass);break;case"mouseup":y(l,H.activeClass);break;case"datarequested":var d=l.getAttribute("data-clipboard-target"),u=d?document.getElementById(d):null;if(u){var h=u.value||u.textContent||u.innerText;h&&this.setText(h)}else{var f=l.getAttribute("data-clipboard-text");f&&this.setText(f)}c=!1;break;case"complete":B(r)}var p=l,m=[this,a];return R.call(this,o,p,m,c)};"function"==typeof define&&define.amd?define(["require","exports","module"],function(e,t,n){return c=n&&n.id||null,O}):"object"==typeof module&&module&&"object"==typeof module.exports&&module.exports?(d=module.id||null,module.exports=O):window.ZeroClipboard=O}(),function(e,t){"use strict";function n(t){e.fn.cycle.debug&&i(t)}function i(){window.console&&console.log&&console.log("[cycle] "+Array.prototype.join.call(arguments," "))}function r(t,n,i){var r=e(t).data("cycle.opts");if(r){var o=!!t.cyclePause;o&&r.paused?r.paused(t,r,n,i):!o&&r.resumed&&r.resumed(t,r,n,i)}}function o(n,o,a){function l(t,n,r){if(!t&&n===!0){var o=e(r).data("cycle.opts");if(!o)return i("options not found, can not resume"),!1;r.cycleTimeout&&(clearTimeout(r.cycleTimeout),r.cycleTimeout=0),h(o.elements,o,1,!o.backwards)}}if(n.cycleStop===t&&(n.cycleStop=0),(o===t||null===o)&&(o={}),o.constructor==String){switch(o){case"destroy":case"stop":var c=e(n).data("cycle.opts");return c?(n.cycleStop++,n.cycleTimeout&&clearTimeout(n.cycleTimeout),n.cycleTimeout=0,c.elements&&e(c.elements).stop(),e(n).removeData("cycle.opts"),"destroy"==o&&s(n,c),!1):!1;case"toggle":return n.cyclePause=1===n.cyclePause?0:1,l(n.cyclePause,a,n),r(n),!1;case"pause":return n.cyclePause=1,r(n),!1;case"resume":return n.cyclePause=0,l(!1,a,n),r(n),!1;case"prev":case"next":return(c=e(n).data("cycle.opts"))?("string"==typeof a&&(c.oneTimeFx=a),e.fn.cycle[o](c),!1):(i('options not found, "prev/next" ignored'),!1);default:o={fx:o}}return o}if(o.constructor==Number){var d=o;return(o=e(n).data("cycle.opts"))?0>d||d>=o.elements.length?(i("invalid slide index: "+d),!1):(o.nextSlide=d,n.cycleTimeout&&(clearTimeout(n.cycleTimeout),n.cycleTimeout=0),"string"==typeof a&&(o.oneTimeFx=a),h(o.elements,o,1,d>=o.currSlide),!1):(i("options not found, can not advance slide"),!1)}return o}function a(t,n){if(!e.support.opacity&&n.cleartype&&t.style.filter)try{t.style.removeAttribute("filter")}catch(i){}}function s(t,n){n.next&&e(n.next).unbind(n.prevNextEvent),n.prev&&e(n.prev).unbind(n.prevNextEvent),(n.pager||n.pagerAnchorBuilder)&&e.each(n.pagerAnchors||[],function(){this.unbind().remove()}),n.pagerAnchors=null,e(t).unbind("mouseenter.cycle mouseleave.cycle"),n.destroy&&n.destroy(n)}function l(n,o,s,l,f){var v,y=e.extend({},e.fn.cycle.defaults,l||{},e.metadata?n.metadata():e.meta?n.data():{}),b=e.isFunction(n.data)?n.data(y.metaAttr):null;b&&(y=e.extend(y,b)),y.autostop&&(y.countdown=y.autostopCount||s.length);var w=n[0];if(n.data("cycle.opts",y),y.$cont=n,y.stopCount=w.cycleStop,y.elements=s,y.before=y.before?[y.before]:[],y.after=y.after?[y.after]:[],!e.support.opacity&&y.cleartype&&y.after.push(function(){a(this,y)}),y.continuous&&y.after.push(function(){h(s,y,0,!y.backwards)}),c(y),e.support.opacity||!y.cleartype||y.cleartypeNoBg||g(o),"static"==n.css("position")&&n.css("position","relative"),y.width&&n.width(y.width),y.height&&"auto"!=y.height&&n.height(y.height),y.startingSlide!==t?(y.startingSlide=parseInt(y.startingSlide,10),y.startingSlide>=s.length||y.startSlide<0?y.startingSlide=0:v=!0):y.backwards?y.startingSlide=s.length-1:y.startingSlide=0,y.random){y.randomMap=[];for(var k=0;k<s.length;k++)y.randomMap.push(k);if(y.randomMap.sort(function(e,t){return Math.random()-.5}),v)for(var x=0;x<s.length;x++)y.startingSlide==y.randomMap[x]&&(y.randomIndex=x);else y.randomIndex=1,y.startingSlide=y.randomMap[1]}else y.startingSlide>=s.length&&(y.startingSlide=0);y.currSlide=y.startingSlide||0;var C=y.startingSlide;o.css({position:"absolute",top:0,left:0}).hide().each(function(t){var n;n=y.backwards?C?C>=t?s.length+(t-C):C-t:s.length-t:C?t>=C?s.length-(t-C):C-t:s.length-t,e(this).css("z-index",n)}),e(s[C]).css("opacity",1).show(),a(s[C],y),y.fit&&(y.aspect?o.each(function(){var t=e(this),n=y.aspect===!0?t.width()/t.height():y.aspect;y.width&&t.width()!=y.width&&(t.width(y.width),t.height(y.width/n)),y.height&&t.height()<y.height&&(t.height(y.height),t.width(y.height*n))}):(y.width&&o.width(y.width),y.height&&"auto"!=y.height&&o.height(y.height))),!y.center||y.fit&&!y.aspect||o.each(function(){var t=e(this);t.css({"margin-left":y.width?(y.width-t.width())/2+"px":0,"margin-top":y.height?(y.height-t.height())/2+"px":0})}),!y.center||y.fit||y.slideResize||o.each(function(){var t=e(this);t.css({"margin-left":y.width?(y.width-t.width())/2+"px":0,"margin-top":y.height?(y.height-t.height())/2+"px":0})});var j=(y.containerResize||y.containerResizeHeight)&&n.innerHeight()<1;if(j){for(var T=0,_=0,S=0;S<s.length;S++){var I=e(s[S]),P=I[0],M=I.outerWidth(),Q=I.outerHeight();M||(M=P.offsetWidth||P.width||I.attr("width")),Q||(Q=P.offsetHeight||P.height||I.attr("height")),T=M>T?M:T,_=Q>_?Q:_}y.containerResize&&T>0&&_>0&&n.css({width:T+"px",height:_+"px"}),y.containerResizeHeight&&_>0&&n.css({height:_+"px"})}var B=!1;if(y.pause&&n.bind("mouseenter.cycle",function(){B=!0,this.cyclePause++,r(w,!0)}).bind("mouseleave.cycle",function(){B&&this.cyclePause--,r(w,!0)}),d(y)===!1)return!1;var E=!1;if(l.requeueAttempts=l.requeueAttempts||0,o.each(function(){var t=e(this);if(this.cycleH=y.fit&&y.height?y.height:t.height()||this.offsetHeight||this.height||t.attr("height")||0,this.cycleW=y.fit&&y.width?y.width:t.width()||this.offsetWidth||this.width||t.attr("width")||0,t.is("img")){var n=0===this.cycleH&&0===this.cycleW&&!this.complete;if(n){if(f.s&&y.requeueOnImageNotLoaded&&++l.requeueAttempts<100)return i(l.requeueAttempts," - img slide not loaded, requeuing slideshow: ",this.src,this.cycleW,this.cycleH),setTimeout(function(){e(f.s,f.c).cycle(l)},y.requeueTimeout),E=!0,!1;i("could not determine size of image: "+this.src,this.cycleW,this.cycleH)}}return!0}),E)return!1;if(y.cssBefore=y.cssBefore||{},y.cssAfter=y.cssAfter||{},y.cssFirst=y.cssFirst||{},y.animIn=y.animIn||{},y.animOut=y.animOut||{},o.not(":eq("+C+")").css(y.cssBefore),e(o[C]).css(y.cssFirst),y.timeout){y.timeout=parseInt(y.timeout,10),y.speed.constructor==String&&(y.speed=e.fx.speeds[y.speed]||parseInt(y.speed,10)),y.sync||(y.speed=y.speed/2);for(var O="none"==y.fx?0:"shuffle"==y.fx?500:250;y.timeout-y.speed<O;)y.timeout+=y.speed}if(y.easing&&(y.easeIn=y.easeOut=y.easing),y.speedIn||(y.speedIn=y.speed),y.speedOut||(y.speedOut=y.speed),y.slideCount=s.length,y.currSlide=y.lastSlide=C,y.random?(++y.randomIndex==s.length&&(y.randomIndex=0),y.nextSlide=y.randomMap[y.randomIndex]):y.backwards?y.nextSlide=0===y.startingSlide?s.length-1:y.startingSlide-1:y.nextSlide=y.startingSlide>=s.length-1?0:y.startingSlide+1,!y.multiFx){var A=e.fn.cycle.transitions[y.fx];if(e.isFunction(A))A(n,o,y);else if("custom"!=y.fx&&!y.multiFx)return i("unknown transition: "+y.fx,"; slideshow terminating"),!1}var D=o[C];return y.skipInitializationCallbacks||(y.before.length&&y.before[0].apply(D,[D,D,y,!0]),y.after.length&&y.after[0].apply(D,[D,D,y,!0])),y.next&&e(y.next).bind(y.prevNextEvent,function(){return p(y,1)}),y.prev&&e(y.prev).bind(y.prevNextEvent,function(){return p(y,0)}),(y.pager||y.pagerAnchorBuilder)&&m(s,y),u(y,s),y}function c(t){t.original={before:[],after:[]},t.original.cssBefore=e.extend({},t.cssBefore),t.original.cssAfter=e.extend({},t.cssAfter),t.original.animIn=e.extend({},t.animIn),t.original.animOut=e.extend({},t.animOut),e.each(t.before,function(){t.original.before.push(this)}),e.each(t.after,function(){t.original.after.push(this)})}function d(t){var r,o,a=e.fn.cycle.transitions;if(t.fx.indexOf(",")>0){for(t.multiFx=!0,t.fxs=t.fx.replace(/\s*/g,"").split(","),r=0;r<t.fxs.length;r++){var s=t.fxs[r];o=a[s],o&&a.hasOwnProperty(s)&&e.isFunction(o)||(i("discarding unknown transition: ",s),t.fxs.splice(r,1),r--)}if(!t.fxs.length)return i("No valid transitions named; slideshow terminating."),!1}else if("all"==t.fx){t.multiFx=!0,t.fxs=[];for(var l in a)a.hasOwnProperty(l)&&(o=a[l],a.hasOwnProperty(l)&&e.isFunction(o)&&t.fxs.push(l))}if(t.multiFx&&t.randomizeEffects){var c=Math.floor(20*Math.random())+30;for(r=0;c>r;r++){var d=Math.floor(Math.random()*t.fxs.length);t.fxs.push(t.fxs.splice(d,1)[0])}n("randomized fx sequence: ",t.fxs)}return!0}function u(t,n){t.addSlide=function(i,r){var o=e(i),a=o[0];t.autostopCount||t.countdown++,n[r?"unshift":"push"](a),t.els&&t.els[r?"unshift":"push"](a),t.slideCount=n.length,t.random&&(t.randomMap.push(t.slideCount-1),t.randomMap.sort(function(e,t){return Math.random()-.5})),o.css("position","absolute"),o[r?"prependTo":"appendTo"](t.$cont),r&&(t.currSlide++,t.nextSlide++),e.support.opacity||!t.cleartype||t.cleartypeNoBg||g(o),t.fit&&t.width&&o.width(t.width),t.fit&&t.height&&"auto"!=t.height&&o.height(t.height),a.cycleH=t.fit&&t.height?t.height:o.height(),a.cycleW=t.fit&&t.width?t.width:o.width(),o.css(t.cssBefore),(t.pager||t.pagerAnchorBuilder)&&e.fn.cycle.createPagerAnchor(n.length-1,a,e(t.pager),n,t),e.isFunction(t.onAddSlide)?t.onAddSlide(o):o.hide()}}function h(i,r,o,a){function s(){var e=0;r.timeout;r.timeout&&!r.continuous?(e=f(i[r.currSlide],i[r.nextSlide],r,a),"shuffle"==r.fx&&(e-=r.speedOut)):r.continuous&&l.cyclePause&&(e=10),e>0&&(l.cycleTimeout=setTimeout(function(){h(i,r,0,!r.backwards)},e))}var l=r.$cont[0],c=i[r.currSlide],d=i[r.nextSlide];if(o&&r.busy&&r.manualTrump&&(n("manualTrump in go(), stopping active transition"),e(i).stop(!0,!0),r.busy=0,clearTimeout(l.cycleTimeout)),r.busy)return void n("transition active, ignoring new tx request");if(l.cycleStop==r.stopCount&&(0!==l.cycleTimeout||o)){if(!o&&!l.cyclePause&&!r.bounce&&(r.autostop&&--r.countdown<=0||r.nowrap&&!r.random&&r.nextSlide<r.currSlide))return void(r.end&&r.end(r));var u=!1;if(!o&&l.cyclePause||r.nextSlide==r.currSlide)s();else{u=!0;var p=r.fx;c.cycleH=c.cycleH||e(c).height(),c.cycleW=c.cycleW||e(c).width(),d.cycleH=d.cycleH||e(d).height(),d.cycleW=d.cycleW||e(d).width(),r.multiFx&&(a&&(r.lastFx===t||++r.lastFx>=r.fxs.length)?r.lastFx=0:!a&&(r.lastFx===t||--r.lastFx<0)&&(r.lastFx=r.fxs.length-1),p=r.fxs[r.lastFx]),r.oneTimeFx&&(p=r.oneTimeFx,r.oneTimeFx=null),e.fn.cycle.resetState(r,p),r.before.length&&e.each(r.before,function(e,t){l.cycleStop==r.stopCount&&t.apply(d,[c,d,r,a])});var m=function(){r.busy=0,e.each(r.after,function(e,t){l.cycleStop==r.stopCount&&t.apply(d,[c,d,r,a])}),l.cycleStop||s()};n("tx firing("+p+"); currSlide: "+r.currSlide+"; nextSlide: "+r.nextSlide),r.busy=1,r.fxFn?r.fxFn(c,d,r,m,a,o&&r.fastOnEvent):e.isFunction(e.fn.cycle[r.fx])?e.fn.cycle[r.fx](c,d,r,m,a,o&&r.fastOnEvent):e.fn.cycle.custom(c,d,r,m,a,o&&r.fastOnEvent)}if(u||r.nextSlide==r.currSlide){var g;r.lastSlide=r.currSlide,r.random?(r.currSlide=r.nextSlide,++r.randomIndex==i.length&&(r.randomIndex=0,r.randomMap.sort(function(e,t){return Math.random()-.5})),r.nextSlide=r.randomMap[r.randomIndex],r.nextSlide==r.currSlide&&(r.nextSlide=r.currSlide==r.slideCount-1?0:r.currSlide+1)):r.backwards?(g=r.nextSlide-1<0,g&&r.bounce?(r.backwards=!r.backwards,r.nextSlide=1,r.currSlide=0):(r.nextSlide=g?i.length-1:r.nextSlide-1,r.currSlide=g?0:r.nextSlide+1)):(g=r.nextSlide+1==i.length,g&&r.bounce?(r.backwards=!r.backwards,r.nextSlide=i.length-2,r.currSlide=i.length-1):(r.nextSlide=g?0:r.nextSlide+1,r.currSlide=g?i.length-1:r.nextSlide-1))}u&&r.pager&&r.updateActivePagerLink(r.pager,r.currSlide,r.activePagerClass)}}function f(e,t,i,r){if(i.timeoutFn){for(var o=i.timeoutFn.call(e,e,t,i,r);"none"!=i.fx&&o-i.speed<250;)o+=i.speed;if(n("calculated timeout: "+o+"; speed: "+i.speed),o!==!1)return o}return i.timeout}function p(t,n){var i=n?1:-1,r=t.elements,o=t.$cont[0],a=o.cycleTimeout;if(a&&(clearTimeout(a),o.cycleTimeout=0),t.random&&0>i)t.randomIndex--,-2==--t.randomIndex?t.randomIndex=r.length-2:-1==t.randomIndex&&(t.randomIndex=r.length-1),t.nextSlide=t.randomMap[t.randomIndex];else if(t.random)t.nextSlide=t.randomMap[t.randomIndex];else if(t.nextSlide=t.currSlide+i,t.nextSlide<0){if(t.nowrap)return!1;t.nextSlide=r.length-1}else if(t.nextSlide>=r.length){if(t.nowrap)return!1;t.nextSlide=0}var s=t.onPrevNextEvent||t.prevNextClick;return e.isFunction(s)&&s(i>0,t.nextSlide,r[t.nextSlide]),h(r,t,1,n),!1}function m(t,n){var i=e(n.pager);e.each(t,function(r,o){e.fn.cycle.createPagerAnchor(r,o,i,t,n)}),n.updateActivePagerLink(n.pager,n.startingSlide,n.activePagerClass)}function g(t){function i(e){return e=parseInt(e,10).toString(16),e.length<2?"0"+e:e}function r(t){for(;t&&"html"!=t.nodeName.toLowerCase();t=t.parentNode){var n=e.css(t,"background-color");if(n&&n.indexOf("rgb")>=0){var r=n.match(/\d+/g);return"#"+i(r[0])+i(r[1])+i(r[2])}if(n&&"transparent"!=n)return n}return"#ffffff"}n("applying clearType background-color hack"),t.each(function(){e(this).css("background-color",r(this))})}var v="3.0.2";e.expr[":"].paused=function(e){return e.cyclePause},e.fn.cycle=function(t,r){var a={s:this.selector,c:this.context};return 0===this.length&&"stop"!=t?!e.isReady&&a.s?(i("DOM not ready, queuing slideshow"),e(function(){e(a.s,a.c).cycle(t,r)}),this):(i("terminating; zero elements found by selector"+(e.isReady?"":" (DOM not ready)")),this):this.each(function(){var s=o(this,t,r);if(s!==!1){s.updateActivePagerLink=s.updateActivePagerLink||e.fn.cycle.updateActivePagerLink,this.cycleTimeout&&clearTimeout(this.cycleTimeout),this.cycleTimeout=this.cyclePause=0,this.cycleStop=0;var c=e(this),d=s.slideExpr?e(s.slideExpr,this):c.children(),u=d.get();if(u.length<2)return void i("terminating; too few slides: "+u.length);var p=l(c,d,u,s,a);if(p!==!1){var m=p.continuous?10:f(u[p.currSlide],u[p.nextSlide],p,!p.backwards);m&&(m+=p.delay||0,10>m&&(m=10),n("first timeout: "+m),this.cycleTimeout=setTimeout(function(){h(u,p,0,!s.backwards)},m))}}})},e.fn.cycle.resetState=function(t,n){n=n||t.fx,t.before=[],t.after=[],t.cssBefore=e.extend({},t.original.cssBefore),t.cssAfter=e.extend({},t.original.cssAfter),t.animIn=e.extend({},t.original.animIn),t.animOut=e.extend({},t.original.animOut),t.fxFn=null,e.each(t.original.before,function(){t.before.push(this)}),e.each(t.original.after,function(){t.after.push(this)});var i=e.fn.cycle.transitions[n];e.isFunction(i)&&i(t.$cont,e(t.elements),t)},e.fn.cycle.updateActivePagerLink=function(t,n,i){e(t).each(function(){e(this).children().removeClass(i).eq(n).addClass(i)})},e.fn.cycle.next=function(e){p(e,1)},e.fn.cycle.prev=function(e){p(e,0)},e.fn.cycle.createPagerAnchor=function(t,i,o,a,s){var l;if(e.isFunction(s.pagerAnchorBuilder)?(l=s.pagerAnchorBuilder(t,i),n("pagerAnchorBuilder("+t+", el) returned: "+l)):l='<a href="#">'+(t+1)+"</a>",l){var c=e(l);if(0===c.parents("body").length){var d=[];o.length>1?(o.each(function(){var t=c.clone(!0);e(this).append(t),d.push(t[0])}),c=e(d)):c.appendTo(o)}s.pagerAnchors=s.pagerAnchors||[],s.pagerAnchors.push(c);var u=function(n){n.preventDefault(),s.nextSlide=t;var i=s.$cont[0],r=i.cycleTimeout;r&&(clearTimeout(r),i.cycleTimeout=0);var o=s.onPagerEvent||s.pagerClick;e.isFunction(o)&&o(s.nextSlide,a[s.nextSlide])===!1||h(a,s,1,s.currSlide<t)};/mouseenter|mouseover/i.test(s.pagerEvent)?c.hover(u,function(){}):c.bind(s.pagerEvent,u),/^click/.test(s.pagerEvent)||s.allowPagerClickBubble||c.bind("click.cycle",function(){return!1});var f=s.$cont[0],p=!1;s.pauseOnPagerHover&&c.hover(function(){p=!0,f.cyclePause++,r(f,!0,!0)},function(){p&&f.cyclePause--,r(f,!0,!0)})}},e.fn.cycle.hopsFromLast=function(e,t){var n,i=e.lastSlide,r=e.currSlide;return n=t?r>i?r-i:e.slideCount-i:i>r?i-r:i+e.slideCount-r},e.fn.cycle.commonReset=function(t,n,i,r,o,a){e(i.elements).not(t).hide(),"undefined"==typeof i.cssBefore.opacity&&(i.cssBefore.opacity=1),i.cssBefore.display="block",i.slideResize&&r!==!1&&n.cycleW>0&&(i.cssBefore.width=n.cycleW),i.slideResize&&o!==!1&&n.cycleH>0&&(i.cssBefore.height=n.cycleH),i.cssAfter=i.cssAfter||{},i.cssAfter.display="none",e(t).css("zIndex",i.slideCount+(a===!0?1:0)),e(n).css("zIndex",i.slideCount+(a===!0?0:1))},e.fn.cycle.custom=function(t,n,i,r,o,a){var s=e(t),l=e(n),c=i.speedIn,d=i.speedOut,u=i.easeIn,h=i.easeOut;l.css(i.cssBefore),a&&(c=d="number"==typeof a?a:1,u=h=null);var f=function(){l.animate(i.animIn,c,u,function(){r()})};s.animate(i.animOut,d,h,function(){s.css(i.cssAfter),i.sync||f()}),i.sync&&f()},e.fn.cycle.transitions={fade:function(t,n,i){n.not(":eq("+i.currSlide+")").css("opacity",0),i.before.push(function(t,n,i){e.fn.cycle.commonReset(t,n,i),i.cssBefore.opacity=0}),i.animIn={opacity:1},i.animOut={opacity:0},i.cssBefore={top:0,left:0}}},e.fn.cycle.ver=function(){return v},e.fn.cycle.defaults={activePagerClass:"activeSlide",after:null,allowPagerClickBubble:!1,animIn:null,animOut:null,aspect:!1,autostop:0,autostopCount:0,backwards:!1,before:null,center:null,cleartype:!e.support.opacity,cleartypeNoBg:!1,containerResize:1,containerResizeHeight:0,continuous:0,cssAfter:null,cssBefore:null,delay:0,easeIn:null,easeOut:null,easing:null,end:null,fastOnEvent:0,fit:0,fx:"fade",fxFn:null,height:"auto",manualTrump:!0,metaAttr:"cycle",next:null,nowrap:0,onPagerEvent:null,onPrevNextEvent:null,pager:null,pagerAnchorBuilder:null,pagerEvent:"click.cycle",pause:0,pauseOnPagerHover:0,prev:null,prevNextEvent:"click.cycle",random:0,randomizeEffects:1,requeueOnImageNotLoaded:!0,requeueTimeout:250,rev:0,shuffle:null,skipInitializationCallbacks:!1,slideExpr:null,slideResize:1,speed:1e3,speedIn:null,speedOut:null,startingSlide:t,sync:1,timeout:4e3,timeoutFn:null,updateActivePagerLink:null,width:null}}(jQuery),function(e){"use strict";e.fn.cycle.transitions.none=function(t,n,i){i.fxFn=function(t,n,i,r){e(n).show(),e(t).hide(),r()}},e.fn.cycle.transitions.fadeout=function(t,n,i){n.not(":eq("+i.currSlide+")").css({display:"block",opacity:1}),i.before.push(function(t,n,i,r,o,a){e(t).css("zIndex",i.slideCount+(a!==!0?1:0)),e(n).css("zIndex",i.slideCount+(a!==!0?0:1))}),i.animIn.opacity=1,i.animOut.opacity=0,i.cssBefore.opacity=1,i.cssBefore.display="block",i.cssAfter.zIndex=0},e.fn.cycle.transitions.scrollUp=function(t,n,i){t.css("overflow","hidden"),i.before.push(e.fn.cycle.commonReset);var r=t.height();i.cssBefore.top=r,i.cssBefore.left=0,i.cssFirst.top=0,i.animIn.top=0,i.animOut.top=-r},e.fn.cycle.transitions.scrollDown=function(t,n,i){t.css("overflow","hidden"),i.before.push(e.fn.cycle.commonReset);var r=t.height();i.cssFirst.top=0,i.cssBefore.top=-r,i.cssBefore.left=0,i.animIn.top=0,i.animOut.top=r},e.fn.cycle.transitions.scrollLeft=function(t,n,i){t.css("overflow","hidden"),i.before.push(e.fn.cycle.commonReset);var r=t.width();i.cssFirst.left=0,i.cssBefore.left=r,i.cssBefore.top=0,i.animIn.left=0,i.animOut.left=0-r},e.fn.cycle.transitions.scrollRight=function(t,n,i){t.css("overflow","hidden"),i.before.push(e.fn.cycle.commonReset);var r=t.width();i.cssFirst.left=0,i.cssBefore.left=-r,i.cssBefore.top=0,i.animIn.left=0,i.animOut.left=r},e.fn.cycle.transitions.scrollHorz=function(t,n,i){t.css("overflow","hidden").width(),i.before.push(function(t,n,i,r){i.rev&&(r=!r),e.fn.cycle.commonReset(t,n,i),i.cssBefore.left=r?n.cycleW-1:1-n.cycleW,i.animOut.left=r?-t.cycleW:t.cycleW}),i.cssFirst.left=0,i.cssBefore.top=0,i.animIn.left=0,i.animOut.top=0},e.fn.cycle.transitions.scrollVert=function(t,n,i){t.css("overflow","hidden"),i.before.push(function(t,n,i,r){i.rev&&(r=!r),e.fn.cycle.commonReset(t,n,i),i.cssBefore.top=r?1-n.cycleH:n.cycleH-1,i.animOut.top=r?t.cycleH:-t.cycleH}),i.cssFirst.top=0,i.cssBefore.left=0,i.animIn.top=0,i.animOut.left=0},e.fn.cycle.transitions.slideX=function(t,n,i){i.before.push(function(t,n,i){e(i.elements).not(t).hide(),e.fn.cycle.commonReset(t,n,i,!1,!0),i.animIn.width=n.cycleW}),i.cssBefore.left=0,i.cssBefore.top=0,i.cssBefore.width=0,i.animIn.width="show",i.animOut.width=0},e.fn.cycle.transitions.slideY=function(t,n,i){i.before.push(function(t,n,i){e(i.elements).not(t).hide(),e.fn.cycle.commonReset(t,n,i,!0,!1),i.animIn.height=n.cycleH}),i.cssBefore.left=0,i.cssBefore.top=0,i.cssBefore.height=0,i.animIn.height="show",i.animOut.height=0},e.fn.cycle.transitions.shuffle=function(t,n,i){var r,o=t.css("overflow","visible").width();for(n.css({left:0,top:0}),i.before.push(function(t,n,i){e.fn.cycle.commonReset(t,n,i,!0,!0,!0)}),i.speedAdjusted||(i.speed=i.speed/2,i.speedAdjusted=!0),i.random=0,i.shuffle=i.shuffle||{left:-o,top:15},i.els=[],r=0;r<n.length;r++)i.els.push(n[r]);for(r=0;r<i.currSlide;r++)i.els.push(i.els.shift());i.fxFn=function(t,n,i,r,o){i.rev&&(o=!o);var a=e(o?t:n);e(n).css(i.cssBefore);var s=i.slideCount;a.animate(i.shuffle,i.speedIn,i.easeIn,function(){for(var n=e.fn.cycle.hopsFromLast(i,o),l=0;n>l;l++)o?i.els.push(i.els.shift()):i.els.unshift(i.els.pop());if(o)for(var c=0,d=i.els.length;d>c;c++)e(i.els[c]).css("z-index",d-c+s);else{var u=e(t).css("z-index");a.css("z-index",parseInt(u,10)+1+s)}a.animate({left:0,top:0},i.speedOut,i.easeOut,function(){e(o?this:t).hide(),r&&r()})})},e.extend(i.cssBefore,{display:"block",opacity:1,top:0,left:0})},e.fn.cycle.transitions.turnUp=function(t,n,i){i.before.push(function(t,n,i){e.fn.cycle.commonReset(t,n,i,!0,!1),i.cssBefore.top=n.cycleH,i.animIn.height=n.cycleH,i.animOut.width=n.cycleW}),i.cssFirst.top=0,i.cssBefore.left=0,i.cssBefore.height=0,i.animIn.top=0,i.animOut.height=0},e.fn.cycle.transitions.turnDown=function(t,n,i){i.before.push(function(t,n,i){e.fn.cycle.commonReset(t,n,i,!0,!1),i.animIn.height=n.cycleH,i.animOut.top=t.cycleH}),i.cssFirst.top=0,i.cssBefore.left=0,i.cssBefore.top=0,i.cssBefore.height=0,i.animOut.height=0},e.fn.cycle.transitions.turnLeft=function(t,n,i){i.before.push(function(t,n,i){e.fn.cycle.commonReset(t,n,i,!1,!0),i.cssBefore.left=n.cycleW,i.animIn.width=n.cycleW}),i.cssBefore.top=0,i.cssBefore.width=0,i.animIn.left=0,i.animOut.width=0},e.fn.cycle.transitions.turnRight=function(t,n,i){i.before.push(function(t,n,i){e.fn.cycle.commonReset(t,n,i,!1,!0),i.animIn.width=n.cycleW,i.animOut.left=t.cycleW}),e.extend(i.cssBefore,{top:0,left:0,width:0}),i.animIn.left=0,i.animOut.width=0},e.fn.cycle.transitions.zoom=function(t,n,i){i.before.push(function(t,n,i){e.fn.cycle.commonReset(t,n,i,!1,!1,!0),i.cssBefore.top=n.cycleH/2,i.cssBefore.left=n.cycleW/2,e.extend(i.animIn,{top:0,left:0,width:n.cycleW,height:n.cycleH}),e.extend(i.animOut,{width:0,height:0,top:t.cycleH/2,left:t.cycleW/2})}),i.cssFirst.top=0,i.cssFirst.left=0,i.cssBefore.width=0,i.cssBefore.height=0},e.fn.cycle.transitions.fadeZoom=function(t,n,i){i.before.push(function(t,n,i){e.fn.cycle.commonReset(t,n,i,!1,!1),i.cssBefore.left=n.cycleW/2,i.cssBefore.top=n.cycleH/2,e.extend(i.animIn,{top:0,left:0,width:n.cycleW,height:n.cycleH})}),i.cssBefore.width=0,i.cssBefore.height=0,i.animOut.opacity=0},e.fn.cycle.transitions.blindX=function(t,n,i){var r=t.css("overflow","hidden").width();i.before.push(function(t,n,i){e.fn.cycle.commonReset(t,n,i),i.animIn.width=n.cycleW,i.animOut.left=t.cycleW}),i.cssBefore.left=r,i.cssBefore.top=0,i.animIn.left=0,i.animOut.left=r},e.fn.cycle.transitions.blindY=function(t,n,i){var r=t.css("overflow","hidden").height();i.before.push(function(t,n,i){e.fn.cycle.commonReset(t,n,i),i.animIn.height=n.cycleH,i.animOut.top=t.cycleH}),i.cssBefore.top=r,i.cssBefore.left=0,i.animIn.top=0,i.animOut.top=r},e.fn.cycle.transitions.blindZ=function(t,n,i){var r=t.css("overflow","hidden").height(),o=t.width();i.before.push(function(t,n,i){e.fn.cycle.commonReset(t,n,i),i.animIn.height=n.cycleH,i.animOut.top=t.cycleH}),i.cssBefore.top=r,i.cssBefore.left=o,i.animIn.top=0,i.animIn.left=0,i.animOut.top=r,i.animOut.left=o},e.fn.cycle.transitions.growX=function(t,n,i){i.before.push(function(t,n,i){e.fn.cycle.commonReset(t,n,i,!1,!0),i.cssBefore.left=this.cycleW/2,i.animIn.left=0,i.animIn.width=this.cycleW,i.animOut.left=0}),i.cssBefore.top=0,i.cssBefore.width=0},e.fn.cycle.transitions.growY=function(t,n,i){i.before.push(function(t,n,i){e.fn.cycle.commonReset(t,n,i,!0,!1),i.cssBefore.top=this.cycleH/2,i.animIn.top=0,i.animIn.height=this.cycleH,i.animOut.top=0}),i.cssBefore.height=0,i.cssBefore.left=0},e.fn.cycle.transitions.curtainX=function(t,n,i){i.before.push(function(t,n,i){e.fn.cycle.commonReset(t,n,i,!1,!0,!0),i.cssBefore.left=n.cycleW/2,i.animIn.left=0,i.animIn.width=this.cycleW,i.animOut.left=t.cycleW/2,i.animOut.width=0}),i.cssBefore.top=0,i.cssBefore.width=0},e.fn.cycle.transitions.curtainY=function(t,n,i){i.before.push(function(t,n,i){e.fn.cycle.commonReset(t,n,i,!0,!1,!0),i.cssBefore.top=n.cycleH/2,i.animIn.top=0,i.animIn.height=n.cycleH,i.animOut.top=t.cycleH/2,i.animOut.height=0}),i.cssBefore.height=0,i.cssBefore.left=0},e.fn.cycle.transitions.cover=function(t,n,i){var r=i.direction||"left",o=t.css("overflow","hidden").width(),a=t.height();i.before.push(function(t,n,i){e.fn.cycle.commonReset(t,n,i),i.cssAfter.display="","right"==r?i.cssBefore.left=-o:"up"==r?i.cssBefore.top=a:"down"==r?i.cssBefore.top=-a:i.cssBefore.left=o}),i.animIn.left=0,i.animIn.top=0,i.cssBefore.top=0,i.cssBefore.left=0},e.fn.cycle.transitions.uncover=function(t,n,i){var r=i.direction||"left",o=t.css("overflow","hidden").width(),a=t.height();i.before.push(function(t,n,i){e.fn.cycle.commonReset(t,n,i,!0,!0,!0),"right"==r?i.animOut.left=o:"up"==r?i.animOut.top=-a:"down"==r?i.animOut.top=a:i.animOut.left=-o}),i.animIn.left=0,i.animIn.top=0,i.cssBefore.top=0,i.cssBefore.left=0},e.fn.cycle.transitions.toss=function(t,n,i){var r=t.css("overflow","visible").width(),o=t.height();i.before.push(function(t,n,i){e.fn.cycle.commonReset(t,n,i,!0,!0,!0),i.animOut.left||i.animOut.top?i.animOut.opacity=0:e.extend(i.animOut,{left:2*r,top:-o/2,opacity:0})}),i.cssBefore.left=0,i.cssBefore.top=0,i.animIn.left=0},e.fn.cycle.transitions.wipe=function(t,n,i){var r=t.css("overflow","hidden").width(),o=t.height();i.cssBefore=i.cssBefore||{};var a;if(i.clip)if(/l2r/.test(i.clip))a="rect(0px 0px "+o+"px 0px)";else if(/r2l/.test(i.clip))a="rect(0px "+r+"px "+o+"px "+r+"px)";else if(/t2b/.test(i.clip))a="rect(0px "+r+"px 0px 0px)";else if(/b2t/.test(i.clip))a="rect("+o+"px "+r+"px "+o+"px 0px)";else if(/zoom/.test(i.clip)){var s=parseInt(o/2,10),l=parseInt(r/2,10);a="rect("+s+"px "+l+"px "+s+"px "+l+"px)"}i.cssBefore.clip=i.cssBefore.clip||a||"rect(0px 0px 0px 0px)";var c=i.cssBefore.clip.match(/(\d+)/g),d=parseInt(c[0],10),u=parseInt(c[1],10),h=parseInt(c[2],10),f=parseInt(c[3],10);i.before.push(function(t,n,i){if(t!=n){var a=e(t),s=e(n);e.fn.cycle.commonReset(t,n,i,!0,!0,!1),i.cssAfter.display="block";var l=1,c=parseInt(i.speedIn/13,10)-1;!function p(){var e=d?d-parseInt(l*(d/c),10):0,t=f?f-parseInt(l*(f/c),10):0,n=o>h?h+parseInt(l*((o-h)/c||1),10):o,i=r>u?u+parseInt(l*((r-u)/c||1),10):r;s.css({clip:"rect("+e+"px "+i+"px "+n+"px "+t+"px)"}),l++<=c?setTimeout(p,13):a.css("display","none")}()}}),e.extend(i.cssBefore,{display:"block",opacity:1,top:0,left:0}),i.animIn={left:0},i.animOut={left:0}}}(jQuery),function(){var e;jQuery.domCss=function(t){e||(jQuery("head").append("<style/>"),e=Array.convert(document.styleSheets).pop()),e&&e.insertRule&&e.insertRule(t,0)}}(),jQuery.fn.eventConditionSelector=function(){function e(e){function t(){n.reloadSelector()}var n=this,i=jQuery('link[rel="js-load-condition-selector"]').attr("href"),r=jQuery(e),o=r.find(".eventConditionUI"),a=r.find(".eventConditionSourceItems input.ecs_achievement_event_id"),s=r.find(".eventConditionSourceItems input.ecs_external_item_id"),l=r.find(".eventConditionSourceItems input.ecs_value_id"),c=null,d=null;return n.reloadSelector=function(){jQuery.ajax({url:i,data:{achievement_event_id:a.val(),external_item_id:s.val(),value_id:l.val(),event_group_id:o.find("select[name=event_group]").val()},dataType:"json",success:function(e){e&&0===e.status&&e.data&&(o.html(e.data.html),o.find("select").selectBox(),o.find("select[name=event_group]").on("change",function(){a.val(""),n.showLoader(jQuery(this)),n.reloadSelector()}),o.find("select[name=achievement_event]").on("change",function(){a.val(this.value),n.showLoader(jQuery(this)),n.reloadSelector()}),o.find("select[name=external_item]").on("change",function(){s.val(this.value)}),o.find("select[name=value]").on("change",function(){l.val(this.value)}),s.val(o.find("select[name=external_item]").val()),l.val(o.find("select[name=value]").val()));
},error:function(e,t,i){n.hideLoader(),n.showError(window.t("Failed to update selector"))}})},n.showError=function(e){n.hideError(),d=jQuery('<div class="errorSummary">').html(e),o.prepend(d),setTimeout(function(){n.hideError()},5e3)},n.hideError=function(){d&&(d.remove(),d=null)},n.showLoader=function(e){n.hideLoader(),c=jQuery((new Handler.Template).render("commonLoader")),e.parent().append(c)},n.hideLoader=function(){c&&(c.remove(),c=null)},t(),n}return this.each(function(){return jQuery(this).data("conditionSelector")||jQuery(this).data("conditionSelector",new e(this)),this})},function(e){function t(e,t){for(var n=e,i=0;e=e[t];)n.tagName==e.tagName&&i++;return i}function n(e,n,i){var r,o=t(e,i);if("odd"==n||"even"==n)r=2,o-=!("odd"==n);else{var a=n.indexOf("n");a>-1?(r=parseInt(n,10)||parseInt(n.substring(0,a)+"1",10),o-=(parseInt(n.substring(a+1),10)||0)-1):(r=o+1,o-=parseInt(n,10)-1)}return(0>r?0>=o:o>=0)&&o%r==0}var i={"first-of-type":function(e){return 0==t(e,"previousSibling")},"last-of-type":function(e){return 0==t(e,"nextSibling")},"only-of-type":function(e){return i["first-of-type"](e)&&i["last-of-type"](e)},"nth-of-type":function(e,t,i){return n(e,i[3],"previousSibling")},"nth-last-of-type":function(e,t,i){return n(e,i[3],"nextSibling")}};e.extend(e.expr[":"],i)}(jQuery),function(){jQuery.fn.flowplayerErrorHandler=function(){var e=new Handler.Template("video").append(new Handler.Template);return this.each(function(){function t(t,i,r){return n.css("background-image",""),n.html(e.render("videoErrorPanel")),layout(n),errorHandler.msg("critical",new Error("Video returned an error"),!1,{videoError:r,containerCssClass:n.attr("class")}),t&&t.stopPropagation(),!1}var n=jQuery(this);return n.data("flowplayer")?n.data("flowplayerErrorHandlerInitialized")?this:(n.data("flowplayerErrorHandlerInitialized",!0),n.hasClass("is-error")&&t(null,null,"When error handler initialized, video already had an error"),n.data("flowplayer").bind("error",t),this):this})}}(),window.JSON||(window.JSON={}),function(){function f(e){return 10>e?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,i,r,o,a,s=gap,l=t[e];switch(l&&"object"==typeof l&&"function"==typeof l.toJSON&&(l=l.toJSON(e)),"function"==typeof rep&&(l=rep.call(t,e,l)),typeof l){case"string":return quote(l);case"number":return isFinite(l)?String(l):"null";case"boolean":case"null":return String(l);case"object":if(!l)return"null";if(gap+=indent,a=[],"[object Array]"===Object.prototype.toString.apply(l)){for(o=l.length,n=0;o>n;n+=1)a[n]=str(n,l)||"null";return r=0===a.length?"[]":gap?"[\n"+gap+a.join(",\n"+gap)+"\n"+s+"]":"["+a.join(",")+"]",gap=s,r}if(rep&&"object"==typeof rep)for(o=rep.length,n=0;o>n;n+=1)i=rep[n],"string"==typeof i&&(r=str(i,l),r&&a.push(quote(i)+(gap?": ":":")+r));else for(i in l)Object.hasOwnProperty.call(l,i)&&(r=str(i,l),r&&a.push(quote(i)+(gap?": ":":")+r));return r=0===a.length?"{}":gap?"{\n"+gap+a.join(",\n"+gap)+"\n"+s+"}":"{"+a.join(",")+"}",gap=s,r}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var JSON=window.JSON,cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,n){var i;if(gap="",indent="","number"==typeof n)for(i=0;n>i;i+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,!t||"function"==typeof t||"object"==typeof t&&"number"==typeof t.length)return str("",{"":e});throw new Error("JSON.stringify")}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var n,i,r=e[t];if(r&&"object"==typeof r)for(n in r)Object.hasOwnProperty.call(r,n)&&(i=walk(r,n),void 0!==i?r[n]=i:delete r[n]);return reviver.call(e,t,r)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(e,t){"use strict";var n=e.History=e.History||{},i=e.jQuery;"undefined"==typeof n.Adapter&&(n.Adapter={bind:function(e,t,n){i(e).bind(t,n)},trigger:function(e,t,n){i(e).trigger(t,n)},extractEventData:function(e,n,i){var r=n&&n.originalEvent&&n.originalEvent[e]||i&&i[e]||t;return r},onDomLoad:function(e){i(e)}},"undefined"!=typeof n.init&&n.init())}(window),function(e,t){"use strict";var n=e.document,i=e.setTimeout||i,r=e.clearTimeout||r,o=e.setInterval||o,a=e.History=e.History||{};"undefined"==typeof a.initHtml4&&(a.initHtml4=function(){return"undefined"!=typeof a.initHtml4.initialized?!1:(a.initHtml4.initialized=!0,a.enabled=!0,a.savedHashes=[],a.isLastHash=function(e){var t,n=a.getHashByIndex();return t=e===n},a.saveHash=function(e){return a.isLastHash(e)?!1:(a.savedHashes.push(e),!0)},a.getHashByIndex=function(e){var t=null;return t="undefined"==typeof e?a.savedHashes[a.savedHashes.length-1]:0>e?a.savedHashes[a.savedHashes.length+e]:a.savedHashes[e]},a.discardedHashes={},a.discardedStates={},a.discardState=function(e,t,n){var i,r=a.getHashByState(e);return i={discardedState:e,backState:n,forwardState:t},a.discardedStates[r]=i,!0},a.discardHash=function(e,t,n){var i={discardedHash:e,backState:n,forwardState:t};return a.discardedHashes[e]=i,!0},a.discardedState=function(e){var t,n=a.getHashByState(e);return t=a.discardedStates[n]||!1},a.discardedHash=function(e){var t=a.discardedHashes[e]||!1;return t},a.recycleState=function(e){var t=a.getHashByState(e);return a.discardedState(e)&&delete a.discardedStates[t],!0},a.emulated.hashChange&&(a.hashChangeInit=function(){a.checkerFunction=null;var t,i,r,s,l="";return a.isInternetExplorer()?(t="historyjs-iframe",i=n.createElement("iframe"),i.setAttribute("id",t),i.style.display="none",n.body.appendChild(i),i.contentWindow.document.open(),i.contentWindow.document.close(),r="",s=!1,a.checkerFunction=function(){if(s)return!1;s=!0;var t=a.getHash()||"",n=a.unescapeHash(i.contentWindow.document.location.hash)||"";return t!==l?(l=t,n!==t&&(r=n=t,i.contentWindow.document.open(),i.contentWindow.document.close(),i.contentWindow.document.location.hash=a.escapeHash(t)),a.Adapter.trigger(e,"hashchange")):n!==r&&(r=n,a.setHash(n,!1)),s=!1,!0}):a.checkerFunction=function(){var t=a.getHash();return t!==l&&(l=t,a.Adapter.trigger(e,"hashchange")),!0},a.intervalList.push(o(a.checkerFunction,a.options.hashChangeInterval)),!0},a.Adapter.onDomLoad(a.hashChangeInit)),a.emulated.pushState&&(a.onHashChange=function(t){var i,r=t&&t.newURL||n.location.href,o=a.getHashByUrl(r),s=null,l=null;return a.isLastHash(o)?(a.busy(!1),!1):(a.doubleCheckComplete(),a.saveHash(o),o&&a.isTraditionalAnchor(o)?(a.Adapter.trigger(e,"anchorchange"),a.busy(!1),!1):(s=a.extractState(a.getFullUrl(o||n.location.href,!1),!0),a.isLastSavedState(s)?(a.busy(!1),!1):(l=a.getHashByState(s),i=a.discardedState(s),i?(a.getHashByIndex(-2)===a.getHashByState(i.forwardState)?a.back(!1):a.forward(!1),!1):(a.pushState(s.data,s.title,s.url,!1),!0))))},a.Adapter.bind(e,"hashchange",a.onHashChange),a.pushState=function(t,i,r,o){if(a.getHashByUrl(r))throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(o!==!1&&a.busy())return a.pushQueue({scope:a,callback:a.pushState,args:arguments,queue:o}),!1;a.busy(!0);var s=a.createStateObject(t,i,r),l=a.getHashByState(s),c=a.getState(!1),d=a.getHashByState(c),u=a.getHash();return a.storeState(s),a.expectedStateId=s.id,a.recycleState(s),a.setTitle(s),l===d?(a.busy(!1),!1):l!==u&&l!==a.getShortUrl(n.location.href)?(a.setHash(l,!1),!1):(a.saveState(s),a.Adapter.trigger(e,"statechange"),a.busy(!1),!0)},a.replaceState=function(e,t,n,i){if(a.getHashByUrl(n))throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(i!==!1&&a.busy())return a.pushQueue({scope:a,callback:a.replaceState,args:arguments,queue:i}),!1;a.busy(!0);var r=a.createStateObject(e,t,n),o=a.getState(!1),s=a.getStateByIndex(-2);return a.discardState(o,r,s),a.pushState(r.data,r.title,r.url,!1),!0}),a.emulated.pushState&&a.getHash()&&!a.emulated.hashChange&&a.Adapter.onDomLoad(function(){a.Adapter.trigger(e,"hashchange")}),void 0)},"undefined"!=typeof a.init&&a.init())}(window),function(e,t){"use strict";var n=e.console||t,i=e.document,r=e.navigator,o=e.sessionStorage||!1,a=e.setTimeout,s=e.clearTimeout,l=e.setInterval,c=e.clearInterval,d=e.JSON,u=e.alert,h=e.History=e.History||{},f=e.history;d.stringify=d.stringify||d.encode,d.parse=d.parse||d.decode,"undefined"==typeof h.init&&(h.init=function(){return"undefined"==typeof h.Adapter?!1:("undefined"!=typeof h.initCore&&h.initCore(),"undefined"!=typeof h.initHtml4&&h.initHtml4(),!0)},h.initCore=function(){if("undefined"!=typeof h.initCore.initialized)return!1;if(h.initCore.initialized=!0,h.options=h.options||{},h.options.hashChangeInterval=h.options.hashChangeInterval||100,h.options.safariPollInterval=h.options.safariPollInterval||500,h.options.doubleCheckInterval=h.options.doubleCheckInterval||500,h.options.storeInterval=h.options.storeInterval||1e3,h.options.busyDelay=h.options.busyDelay||250,h.options.debug=h.options.debug||!1,h.options.initialTitle=h.options.initialTitle||i.title,h.intervalList=[],h.clearAllIntervals=function(){var e,t=h.intervalList;if("undefined"!=typeof t&&null!==t){for(e=0;e<t.length;e++)c(t[e]);h.intervalList=null}},h.debug=function(){(h.options.debug||!1)&&h.log.apply(h,arguments)},h.log=function(){var e,t,r,o,a,s="undefined"!=typeof n&&"undefined"!=typeof n.log&&"undefined"!=typeof n.log.apply,l=i.getElementById("log");for(s?(o=Array.prototype.slice.call(arguments),e=o.shift(),"undefined"!=typeof n.debug?n.debug.apply(n,[e,o]):n.log.apply(n,[e,o])):e="\n"+arguments[0]+"\n",t=1,r=arguments.length;r>t;++t){if(a=arguments[t],"object"==typeof a&&"undefined"!=typeof d)try{a=d.stringify(a)}catch(c){}e+="\n"+a+"\n"}return l?(l.value+=e+"\n-----\n",l.scrollTop=l.scrollHeight-l.clientHeight):s||u(e),!0},h.getInternetExplorerMajorVersion=function(){var e=h.getInternetExplorerMajorVersion.cached="undefined"!=typeof h.getInternetExplorerMajorVersion.cached?h.getInternetExplorerMajorVersion.cached:function(){for(var e=3,t=i.createElement("div"),n=t.getElementsByTagName("i");(t.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->")&&n[0];);return e>4?e:!1}();return e},h.isInternetExplorer=function(){var e=h.isInternetExplorer.cached="undefined"!=typeof h.isInternetExplorer.cached?h.isInternetExplorer.cached:Boolean(h.getInternetExplorerMajorVersion());return e},h.emulated={pushState:!Boolean(e.history&&e.history.pushState&&e.history.replaceState&&!/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i.test(r.userAgent)&&!/AppleWebKit\/5([0-2]|3[0-2])/i.test(r.userAgent)),hashChange:Boolean(!("onhashchange"in e||"onhashchange"in i)||h.isInternetExplorer()&&h.getInternetExplorerMajorVersion()<8)},h.enabled=!h.emulated.pushState,h.bugs={setHash:Boolean(!h.emulated.pushState&&"Apple Computer, Inc."===r.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(r.userAgent)),safariPoll:Boolean(!h.emulated.pushState&&"Apple Computer, Inc."===r.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(r.userAgent)),ieDoubleCheck:Boolean(h.isInternetExplorer()&&h.getInternetExplorerMajorVersion()<8),hashEscape:Boolean(h.isInternetExplorer()&&h.getInternetExplorerMajorVersion()<7)},h.isEmptyObject=function(e){for(var t in e)return!1;return!0},h.cloneObject=function(e){var t,n;return e?(t=d.stringify(e),n=d.parse(t)):n={},n},h.getRootUrl=function(){var e=i.location.protocol+"//"+(i.location.hostname||i.location.host);return i.location.port&&(e+=":"+i.location.port),e+="/"},h.getBaseHref=function(){var e=i.getElementsByTagName("base"),t=null,n="";return 1===e.length&&(t=e[0],n=t.href.replace(/[^\/]+$/,"")),n=n.replace(/\/+$/,""),n&&(n+="/"),n},h.getBaseUrl=function(){var e=h.getBaseHref()||h.getBasePageUrl()||h.getRootUrl();return e},h.getPageUrl=function(){var e,t=h.getState(!1,!1),n=(t||{}).url||i.location.href;return e=n.replace(/\/+$/,"").replace(/[^\/]+$/,function(e,t,n){return/\./.test(e)?e:e+"/"})},h.getBasePageUrl=function(){var e=i.location.href.replace(/[#\?].*/,"").replace(/[^\/]+$/,function(e,t,n){return/[^\/]$/.test(e)?"":e}).replace(/\/+$/,"")+"/";return e},h.getFullUrl=function(e,t){var n=e,i=e.substring(0,1);return t="undefined"==typeof t?!0:t,/[a-z]+\:\/\//.test(e)||(n="/"===i?h.getRootUrl()+e.replace(/^\/+/,""):"#"===i?h.getPageUrl().replace(/#.*/,"")+e:"?"===i?h.getPageUrl().replace(/[\?#].*/,"")+e:t?h.getBaseUrl()+e.replace(/^(\.\/)+/,""):h.getBasePageUrl()+e.replace(/^(\.\/)+/,"")),n.replace(/\#$/,"")},h.getShortUrl=function(e){var t=e,n=h.getBaseUrl(),i=h.getRootUrl();return h.emulated.pushState&&(t=t.replace(n,"")),t=t.replace(i,"/"),h.isTraditionalAnchor(t)&&(t="./"+t),t=t.replace(/^(\.\/)+/g,"./").replace(/\#$/,"")},h.store={},h.idToState=h.idToState||{},h.stateToId=h.stateToId||{},h.urlToId=h.urlToId||{},h.storedStates=h.storedStates||[],h.savedStates=h.savedStates||[],h.normalizeStore=function(){h.store.idToState=h.store.idToState||{},h.store.urlToId=h.store.urlToId||{},h.store.stateToId=h.store.stateToId||{}},h.getState=function(e,t){"undefined"==typeof e&&(e=!0),"undefined"==typeof t&&(t=!0);var n=h.getLastSavedState();return!n&&t&&(n=h.createStateObject()),e&&(n=h.cloneObject(n),n.url=n.cleanUrl||n.url),n},h.getIdByState=function(e){var t,n=h.extractId(e.url);if(!n)if(t=h.getStateString(e),"undefined"!=typeof h.stateToId[t])n=h.stateToId[t];else if("undefined"!=typeof h.store.stateToId[t])n=h.store.stateToId[t];else{for(;n=(new Date).getTime()+String(Math.random()).replace(/\D/g,""),"undefined"!=typeof h.idToState[n]||"undefined"!=typeof h.store.idToState[n];);h.stateToId[t]=n,h.idToState[n]=e}return n},h.normalizeState=function(e){var t,n;return e&&"object"==typeof e||(e={}),"undefined"!=typeof e.normalized?e:(e.data&&"object"==typeof e.data||(e.data={}),t={},t.normalized=!0,t.title=e.title||"",t.url=h.getFullUrl(h.unescapeString(e.url||i.location.href)),t.hash=h.getShortUrl(t.url),t.data=h.cloneObject(e.data),t.id=h.getIdByState(t),t.cleanUrl=t.url.replace(/\??\&_suid.*/,""),t.url=t.cleanUrl,n=!h.isEmptyObject(t.data),(t.title||n)&&(t.hash=h.getShortUrl(t.url).replace(/\??\&_suid.*/,""),/\?/.test(t.hash)||(t.hash+="?"),t.hash+="&_suid="+t.id),t.hashedUrl=h.getFullUrl(t.hash),(h.emulated.pushState||h.bugs.safariPoll)&&h.hasUrlDuplicate(t)&&(t.url=t.hashedUrl),t)},h.createStateObject=function(e,t,n){var i={data:e,title:t,url:n};return i=h.normalizeState(i)},h.getStateById=function(e){e=String(e);var n=h.idToState[e]||h.store.idToState[e]||t;return n},h.getStateString=function(e){var t,n,i;return t=h.normalizeState(e),n={data:t.data,title:e.title,url:e.url},i=d.stringify(n)},h.getStateId=function(e){var t,n;return t=h.normalizeState(e),n=t.id},h.getHashByState=function(e){var t,n;return t=h.normalizeState(e),n=t.hash},h.extractId=function(e){var t,n,i;return n=/(.*)\&_suid=([0-9]+)$/.exec(e),i=n?n[1]||e:e,t=n?String(n[2]||""):"",t||!1},h.isTraditionalAnchor=function(e){var t=!/[\/\?\.]/.test(e);return t},h.extractState=function(e,t){var n,i,r=null;return t=t||!1,n=h.extractId(e),n&&(r=h.getStateById(n)),r||(i=h.getFullUrl(e),n=h.getIdByUrl(i)||!1,n&&(r=h.getStateById(n)),!r&&t&&!h.isTraditionalAnchor(e)&&(r=h.createStateObject(null,null,i))),r},h.getIdByUrl=function(e){var n=h.urlToId[e]||h.store.urlToId[e]||t;return n},h.getLastSavedState=function(){return h.savedStates[h.savedStates.length-1]||t},h.getLastStoredState=function(){return h.storedStates[h.storedStates.length-1]||t},h.hasUrlDuplicate=function(e){var t,n=!1;return t=h.extractState(e.url),n=t&&t.id!==e.id},h.storeState=function(e){return h.urlToId[e.url]=e.id,h.storedStates.push(h.cloneObject(e)),e},h.isLastSavedState=function(e){var t,n,i,r=!1;return h.savedStates.length&&(t=e.id,n=h.getLastSavedState(),i=n.id,r=t===i),r},h.saveState=function(e){return h.isLastSavedState(e)?!1:(h.savedStates.push(h.cloneObject(e)),!0)},h.getStateByIndex=function(e){var t=null;return t="undefined"==typeof e?h.savedStates[h.savedStates.length-1]:0>e?h.savedStates[h.savedStates.length+e]:h.savedStates[e]},h.getHash=function(){var e=h.unescapeHash(i.location.hash);return e},h.unescapeString=function(t){for(var n,i=t;n=e.unescape(i),n!==i;)i=n;return i},h.unescapeHash=function(e){var t=h.normalizeHash(e);return t=h.unescapeString(t)},h.normalizeHash=function(e){var t=e.replace(/[^#]*#/,"").replace(/#.*/,"");return t},h.setHash=function(e,t){var n,r,o;return t!==!1&&h.busy()?(h.pushQueue({scope:h,callback:h.setHash,args:arguments,queue:t}),!1):(n=h.escapeHash(e),h.busy(!0),r=h.extractState(e,!0),r&&!h.emulated.pushState?h.pushState(r.data,r.title,r.url,!1):i.location.hash!==n&&(h.bugs.setHash?(o=h.getPageUrl(),h.pushState(null,null,o+"#"+n,!1)):i.location.hash=n),h)},h.escapeHash=function(t){var n=h.normalizeHash(t);return n=e.escape(n),h.bugs.hashEscape||(n=n.replace(/\%21/g,"!").replace(/\%26/g,"&").replace(/\%3D/g,"=").replace(/\%3F/g,"?")),n},h.getHashByUrl=function(e){var t=String(e).replace(/([^#]*)#?([^#]*)#?(.*)/,"$2");return t=h.unescapeHash(t)},h.setTitle=function(e){var t,n=e.title;n||(t=h.getStateByIndex(0),t&&t.url===e.url&&(n=t.title||h.options.initialTitle));try{i.getElementsByTagName("title")[0].innerHTML=n.replace("<","&lt;").replace(">","&gt;").replace(" & "," &amp; ")}catch(r){}return i.title=n,h},h.queues=[],h.busy=function(e){if("undefined"!=typeof e?h.busy.flag=e:"undefined"==typeof h.busy.flag&&(h.busy.flag=!1),!h.busy.flag){s(h.busy.timeout);var t=function(){var e,n,i;if(!h.busy.flag)for(e=h.queues.length-1;e>=0;--e)n=h.queues[e],0!==n.length&&(i=n.shift(),h.fireQueueItem(i),h.busy.timeout=a(t,h.options.busyDelay))};h.busy.timeout=a(t,h.options.busyDelay)}return h.busy.flag},h.busy.flag=!1,h.fireQueueItem=function(e){return e.callback.apply(e.scope||h,e.args||[])},h.pushQueue=function(e){return h.queues[e.queue||0]=h.queues[e.queue||0]||[],h.queues[e.queue||0].push(e),h},h.queue=function(e,t){return"function"==typeof e&&(e={callback:e}),"undefined"!=typeof t&&(e.queue=t),h.busy()?h.pushQueue(e):h.fireQueueItem(e),h},h.clearQueue=function(){return h.busy.flag=!1,h.queues=[],h},h.stateChanged=!1,h.doubleChecker=!1,h.doubleCheckComplete=function(){return h.stateChanged=!0,h.doubleCheckClear(),h},h.doubleCheckClear=function(){return h.doubleChecker&&(s(h.doubleChecker),h.doubleChecker=!1),h},h.doubleCheck=function(e){return h.stateChanged=!1,h.doubleCheckClear(),h.bugs.ieDoubleCheck&&(h.doubleChecker=a(function(){return h.doubleCheckClear(),h.stateChanged||e(),!0},h.options.doubleCheckInterval)),h},h.safariStatePoll=function(){var t,n=h.extractState(i.location.href);if(!h.isLastSavedState(n))return t=n,t||(t=h.createStateObject()),h.Adapter.trigger(e,"popstate"),h},h.back=function(e){return e!==!1&&h.busy()?(h.pushQueue({scope:h,callback:h.back,args:arguments,queue:e}),!1):(h.busy(!0),h.doubleCheck(function(){h.back(!1)}),f.go(-1),!0)},h.forward=function(e){return e!==!1&&h.busy()?(h.pushQueue({scope:h,callback:h.forward,args:arguments,queue:e}),!1):(h.busy(!0),h.doubleCheck(function(){h.forward(!1)}),f.go(1),!0)},h.go=function(e,t){var n;if(e>0)for(n=1;e>=n;++n)h.forward(t);else{if(!(0>e))throw new Error("History.go: History.go requires a positive or negative integer passed.");for(n=-1;n>=e;--n)h.back(t)}return h},h.emulated.pushState){var p=function(){};h.pushState=h.pushState||p,h.replaceState=h.replaceState||p}else h.onPopState=function(t,n){var r,o,a=!1,s=!1;return h.doubleCheckComplete(),r=h.getHash(),r?(o=h.extractState(r||i.location.href,!0),o?h.replaceState(o.data,o.title,o.url,!1):(h.Adapter.trigger(e,"anchorchange"),h.busy(!1)),h.expectedStateId=!1,!1):(a=h.Adapter.extractEventData("state",t,n)||!1,s=a?h.getStateById(a):h.expectedStateId?h.getStateById(h.expectedStateId):h.extractState(i.location.href),s||(s=h.createStateObject(null,null,i.location.href)),h.expectedStateId=!1,h.isLastSavedState(s)?(h.busy(!1),!1):(h.storeState(s),h.saveState(s),h.setTitle(s),h.Adapter.trigger(e,"statechange"),h.busy(!1),!0))},h.Adapter.bind(e,"popstate",h.onPopState),h.pushState=function(t,n,i,r){if(h.getHashByUrl(i)&&h.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(r!==!1&&h.busy())return h.pushQueue({scope:h,callback:h.pushState,args:arguments,queue:r}),!1;h.busy(!0);var o=h.createStateObject(t,n,i);return h.isLastSavedState(o)?h.busy(!1):(h.storeState(o),h.expectedStateId=o.id,f.pushState(o.id,o.title,o.url),h.Adapter.trigger(e,"popstate")),!0},h.replaceState=function(t,n,i,r){if(h.getHashByUrl(i)&&h.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(r!==!1&&h.busy())return h.pushQueue({scope:h,callback:h.replaceState,args:arguments,queue:r}),!1;h.busy(!0);var o=h.createStateObject(t,n,i);return h.isLastSavedState(o)?h.busy(!1):(h.storeState(o),h.expectedStateId=o.id,f.replaceState(o.id,o.title,o.url),h.Adapter.trigger(e,"popstate")),!0};if(o){try{h.store=d.parse(o.getItem("History.store"))||{}}catch(m){h.store={}}h.normalizeStore()}else h.store={},h.normalizeStore();h.Adapter.bind(e,"beforeunload",h.clearAllIntervals),h.Adapter.bind(e,"unload",h.clearAllIntervals),h.saveState(h.storeState(h.extractState(i.location.href,!0))),o&&(h.onUnload=function(){var e,t;try{e=d.parse(o.getItem("History.store"))||{}}catch(n){e={}}e.idToState=e.idToState||{},e.urlToId=e.urlToId||{},e.stateToId=e.stateToId||{};for(t in h.idToState)h.idToState.hasOwnProperty(t)&&(e.idToState[t]=h.idToState[t]);for(t in h.urlToId)h.urlToId.hasOwnProperty(t)&&(e.urlToId[t]=h.urlToId[t]);for(t in h.stateToId)h.stateToId.hasOwnProperty(t)&&(e.stateToId[t]=h.stateToId[t]);h.store=e,h.normalizeStore(),o.setItem("History.store",d.stringify(e))},h.intervalList.push(l(h.onUnload,h.options.storeInterval)),h.Adapter.bind(e,"beforeunload",h.onUnload),h.Adapter.bind(e,"unload",h.onUnload)),h.emulated.pushState||(h.bugs.safariPoll&&h.intervalList.push(l(h.safariStatePoll,h.options.safariPollInterval)),("Apple Computer, Inc."===r.vendor||"Mozilla"===(r.appCodeName||""))&&(h.Adapter.bind(e,"hashchange",function(){h.Adapter.trigger(e,"popstate")}),h.getHash()&&h.Adapter.onDomLoad(function(){h.Adapter.trigger(e,"hashchange")})))},h.init())}(window),function(e){e.fn.hoverIntent=function(t,n,i){var r={interval:100,sensitivity:7,timeout:0};r="object"==typeof t?e.extend(r,t):e.isFunction(n)?e.extend(r,{over:t,out:n,selector:i}):e.extend(r,{over:t,out:t,selector:n});var o,a,s,l,c=function(e){o=e.pageX,a=e.pageY},d=function(t,n){return n.hoverIntent_t=clearTimeout(n.hoverIntent_t),Math.abs(s-o)+Math.abs(l-a)<r.sensitivity?(e(n).off("mousemove.hoverIntent",c),n.hoverIntent_s=1,r.over.apply(n,[t])):(s=o,l=a,n.hoverIntent_t=setTimeout(function(){d(t,n)},r.interval),void 0)},u=function(e,t){return t.hoverIntent_t=clearTimeout(t.hoverIntent_t),t.hoverIntent_s=0,r.out.apply(t,[e])},h=function(t){var n=jQuery.extend({},t),i=this;i.hoverIntent_t&&(i.hoverIntent_t=clearTimeout(i.hoverIntent_t)),"mouseenter"==t.type?(s=n.pageX,l=n.pageY,e(i).on("mousemove.hoverIntent",c),1!=i.hoverIntent_s&&(i.hoverIntent_t=setTimeout(function(){d(n,i)},r.interval))):(e(i).off("mousemove.hoverIntent",c),1==i.hoverIntent_s&&(i.hoverIntent_t=setTimeout(function(){u(n,i)},r.timeout)))};return this.on({"mouseenter.hoverIntent":h,"mouseleave.hoverIntent":h},r.selector)}}(jQuery),function(){var e=function(e){var t,n=!1,i=e.offset||0,r="offset",o=e.distance||50,a=!1,s=e.url||"";if(s){var l=s.match(/(\w+)=\{\{offset\}\}/);l&&(r=l[1]),s.replace(/([\?\&]\w+=\{\{offset\}\}$|\w+=\{\{offset\}\}&?)/,"")}var c;return{init:function(){for(var t=this,n=this;n.length;){if(n.is("body")){n=void 0;break}if(["scroll","auto"].contains(n.css("overflow"))||["scroll","auto"].contains(n.css("overflow-y"))){this.data("lazyload-scrollable",n);break}n=n.parent()}c=function(){setTimeout(function(){t.check()})},!i&&e.selector&&(i=t.find(e.selector).length),t.data("lazyload-config",e),(n||jQuery(window)).on("scroll.lazyload resize.lazyload",c),jQuery("body").on("chess24:show",c),t.on("chess24:lazyloaddone",c),t.check()},check:function(){if(this.is(":visible")){var e=this.data("lazyload-scrollable");if(e)if("absolute"===this.css("position"))var t=this.position().top+this.outerHeight(),n=e.outerHeight();else var t=this.outerHeight()-e.prop("scrollTop"),n=e.outerHeight();else var t=this.offset().top+this.height(),n=(jQuery("body").scrollTop()||document.documentElement.scrollTop)+window.innerHeight;o>=t-n?a||this.work():a&&(a=!1)}},work:function(){var o=this;if(!n){if(s&&(e.selector||e.array)){n=!0;var l=Object.extend(e.data||{});l[r]=i,o.data("xhr")&&o.data("xhr").abort(),t=jQuery.getJSON(s,l,function(t){if(e.array&&Array.isArray(t.data[e.array]))var r=t.data[e.array].length;else if(e.selector&&t.data.html){var s=jQuery(t.data.html);r=s.find(e.selector).add(s.filter(e.selector)).length}else r=0;r?i+=r:c&&o.reset(),n=!1,"function"==typeof e.onload&&e.onload.call(o,t),a=!1,o.trigger("chess24:lazyloaddone",t)}).error(function(t){try{var n=jQuery.parseJSON(t.responseText)}catch(i){n={}}"function"==typeof e.onerror&&e.onerror.call(o,n),o.trigger("chess24:lazyloaderror")}),o.data("xhr",t),a=!0}else{a=!0;var d=function(e){a=!1,e?o.check():o.reset()}}"function"==typeof e.onstart&&e.onstart.call(o,d),this.trigger("chess24:lazyloadstart",d)}},reset:function(){this.data("xhr")&&this.data("xhr").abort();var e=this.data("lazyload-scrollable");return e?(e.off("scroll.lazyload resize.lazyload",c),e.off("chess24:show",c)):(jQuery(window).off("scroll.lazyload resize.lazyload",c),jQuery("body").off("chess24:show",c)),this.off("chess24:lazyloaddone",c),this}}};jQuery.fn.lazyload=function(t){return"string"==typeof t?["refresh","reset"].contains(t)&&this.each(function(){var n=jQuery(this),i=n.data("lazyload-config");if(i){var r=jQuery.extend(n,e(i));"refresh"==t?r.reset().init():"reset"==t&&r.reset()}}):(t=t||{},this.each(function(){jQuery.extend(jQuery(this),e(t)).init()})),this}}(),function(){var e={colorLine:"#a7cb45",colorGrid:"#eee",colorAxis:"#ccc",colorAxisNode:"#888",left:30,right:5,top:5,bottom:50},n=function(e){e=jQuery(e).get(0);var t=e.getContext("2d");return t.lineWidth=1,{clear:function(){return e.width=e.width,this},path:function(e,n){if(0===e.length)return this;t.strokeStyle=n,t.beginPath(),t.moveTo(e[0][0],e[0][1]);for(var i=1;i<e.length;i++)t.lineTo(e[i][0],e[i][1]);return t.stroke(),this},circle:function(e,n,i){return t.fillStyle=i,t.beginPath(),t.arc(e[0],e[1],n,0,2*Math.PI),t.fill(),this}}},i={init:function(e){return this.html(""),this.canvas=jQuery("<canvas/>").attr("width",this.width()).attr("height",this.height()).appendTo(this),this.data("config",e),this.config=e,this.config.sets={},this.config.display={},this.config.colors={},this.config.width=this.width()-this.config.left-this.config.right,this.config.height=this.height()-this.config.top-this.config.bottom,this.config.yoffset=.05*this.config.height,this.graphics=n(this.canvas),this.hasdata()?(this.setup(),this.clear(),this.drawWires(),this.drawLabels(),this.drawGraph()):(this.clear(),this.empty()),this},catchup:function(){return this.config=this.data("config"),this.canvas=this.find("canvas"),this.graphics=n(this.canvas),this},clear:function(){return this.graphics.clear(),this.find("label,a").remove(),this},setup:function(){var e,t,n=this;for(var i in this.config.sets)if(this.config.display[i]){var r=this.config.sets[i];("undefined"==typeof e||"undefind"!=typeof r.start&&r.start<e)&&(e=r.start),("undefined"==typeof t||"undefined"!=typeof r.start&&r.start>t)&&(t=r.start);for(var o=0;o<r.length;o++)("undefined"==typeof e||e>parseFloat(r[o][0]))&&"undefined"!=typeof r[o][0]&&null!==r[o][0]&&(e=parseFloat(r[o][0])),("undefined"==typeof t||t<parseFloat(r[o][0]))&&"undefined"!=typeof r[o][0]&&null!==r[o][0]&&(t=parseFloat(r[o][0]))}var a,s,l=function(e){return!!(""+e).match(/^-?\d+$/)},c=function(e){for(var t=11;t>=2;t--)if(l(e/t))return e/t},d=!1;if(l(e)&&l(t))a=c(t-e),a?s=(t-e)/a:"undefined"==typeof a?(t++,a=c(t-e),s=(t-e)/a):(a=0,s=0);else{for(var u=t,h=e,f=0;!l(u)||!l(h);)u*=10,h*=10,f++;a=c(u-h),a?(a/=Math.pow(10,f),s=Math.round((t-e)/a)):"undefined"==typeof a?(u++,t+=1/Math.pow(10,f),a=c(u-h),s=Math.round((t-e)/a)):(a=0,s=0),d=!0}this.ylabels=[];for(var o=0;s>=o;o++)this.ylabels.push((e+o*a).toFixed(d?1:0));var p=this.count();this.xpoints=[];for(var a=Math.ceil(this.count()/15),o=0;p>o;o+=a)this.xpoints.push(o);var m=t!=e?(this.config.height-2*this.config.yoffset)/(t-e):0,g=p>1?this.config.width/(p-1):this.config.width;return this.xcoord=function(e){return n.config.left+e*g},this.ycoord=function(i,r){return n.config.top+(n.config.height-n.config.yoffset)-m*(void 0!==r?(t-e)*r:parseFloat(i)-e)},this},createMarker:function(e,t){var n=this;if(null===this.config.sets[e][t][0]||"undefined"==typeof this.config.sets[e][t][0]||!this.config.display[e])return this;var i=this.xcoord(t),r=this.ycoord(this.config.sets[e][t][0]),o=jQuery("<a/>").addClass("marker").appendTo(this).css({left:i+"px",top:r+"px"}).on("mouseover",function(){n.trigger("chartover",{value:n.config.sets[e][t][0],label:n.config.sets[e][t][1],dot:o,setname:e})}).on("click",function(){n.trigger("chartclick",{value:n.config.sets[e][t][0],label:n.config.sets[e][t][1],dot:o,setname:e})});return this},drawWires:function(){var e=this.count();this.graphics.path([[this.config.left,this.config.top],[this.config.left+this.config.width,this.config.top],[this.config.left+this.config.width,this.config.top+this.config.height],[this.config.left,this.config.top+this.config.height],[this.config.left,this.config.top]],this.config.colorAxis);for(var t=0;t<this.ylabels.length;t++){var n=this.ycoord(this.ylabels[t]);this.graphics.path([[this.xcoord(0),n],[this.xcoord(e-1),n]],this.config.colorGrid),this.graphics.circle([this.xcoord(0),n],2.5,this.config.colorAxisNode)}for(var t=0;t<this.xpoints.length;t++){var i=this.xcoord(this.xpoints[t]);this.graphics.path([[i,this.config.top],[i,this.config.top+this.config.height]],this.config.colorGrid),this.graphics.circle([i,this.config.top+this.config.height],2.5,this.config.colorAxisNode)}return this},drawGraph:function(){var e=this.count();for(var t in this.config.sets)if(this.config.display[t]&&(this.config.sets[t].length||this.config.sets[t].start)){var n,i=this.config.sets[t];n=i.length&&i[0][0]?[[this.xcoord(0),this.ycoord(i[0][0])]]:[[this.xcoord(0),this.ycoord(i.start)]];for(var r=i[0]?i[0][0]||i.start:i.start,o=1;o<i.length;o++)i[o][0]&&(n.push([this.xcoord(o),this.ycoord(i[o][0])]),r=i[o][0]);n.push([this.xcoord(e>1?e-1:1),this.ycoord(r)]),this.graphics.path(n,this.config.colors[t]);for(var o=0;o<i.length;o++)this.graphics.circle([this.xcoord(o),this.ycoord(i[o][0])],3.5,this.config.colors[t]),this.createMarker(t,o)}return this},drawLabels:function(){var e=[];for(var t in this.config.sets)if(this.config.display[t]&&this.config.sets[t].length){for(var n=0;n<this.config.sets[t].length;n++)e.push(this.config.sets[t][n][1]);break}for(var n=0;n<this.xpoints.length;n++){var t=jQuery("<label/>").addClass("x").css({
left:this.xcoord(this.xpoints[n])+7,top:this.config.top+this.config.height-3}).html(e[this.xpoints[n]]).appendTo(this);t.css({transform:"translate(-"+t.width()+"px) rotate(-45deg)","-webkit-transform":"translate(-"+t.width()+"px) rotate(-45deg)"})}for(var n=0;n<this.ylabels.length;n++){var t=jQuery("<label/>").addClass("y").css("right",this.config.width+this.config.right+5+"px").html(this.ylabels[n]).appendTo(this);t.css("top",this.ycoord(this.ylabels[n])-t.height()/2+"px")}return this},empty:function(){var e=jQuery("<label/>").addClass("empty"+(this.config.loading?" loading":"")).html(this.config.loading?t("Loading data..."):t("No information to draw a graph")).appendTo(this);return e.css({width:(this.width()||parseInt(this.css("width"),10))+"px",height:(this.height()||parseInt(this.css("height"),10))-parseInt(e.css("padding-top"),10)-parseInt(e.css("padding-bottom"),10)+"px"}),this.config.loading=!1,this},hasdata:function(){var e=!0;for(var t in this.config.sets)if(this.config.display[t]&&(this.config.sets[t].length>0&&null!==this.config.sets[t][0][0]||this.config.sets[t].start)){e=!1;break}return!e},compatible:function(e,t){var n=[];for(var i in this.config.sets)if(i!=t)for(var r=this.config.sets[i],o=0;o<r.length;o++)n.contains(r[o][1])||n.push(r[o][1]);if(n.length)for(var o=0;o<e.length;o++)if(!n.contains(e[o][1]))return!1;return!0},count:function(){var e=[];for(var t in this.config.sets)if(this.config.display[t])for(var n=0;n<this.config.sets[t].length;n++)e.contains(this.config.sets[t][n][1])||e.push(this.config.sets[t][n][1]);return e.length}},r={redraw:function(){this.hasdata()?this.setup().clear().drawWires().drawLabels().drawGraph():this.clear().empty()},path:function(e,t,n,i){if("object"==typeof e&&"undefined"==typeof t&&(t=e,e="default"),"undefined"==typeof i&&(i=!0),!this.compatible(t,e))throw new Error("New path is not compatible with existing data");this.config.sets[e]=t,"undefined"==typeof this.config.display[e]&&(this.config.display[e]=!0),"undefined"==typeof this.config.colors[e]&&(this.config.colors[e]=n||this.config.colorLine),i&&this.redraw()},toggle:function(e,t){for(var n=e.split(" "),i=0;i<n.length;i++)this.config.sets[n[i]]&&(this.config.display[n[i]]="undefined"==typeof t?!this.config.display[n[i]]:t);this.redraw()},reset:function(){for(var e in this.config.sets)this.config.sets[e]=[]}};jQuery.fn.lineChart=function(){if("object"==typeof arguments[0]){var t=arguments[0];this.each(function(){var n=jQuery(this);n.data("graph")||(n.data("graph",!0),jQuery.extend(n,i).init(jQuery.extend({},e,t)))})}else if(arguments[0]){var n=arguments;this.each(function(){var e=jQuery(this);jQuery.extend(e,r),"function"==typeof e[n[0]]&&(jQuery.extend(e,i),e.catchup(),e[n[0]].apply(e,Array.convert(n).slice(1)))})}return this}}(),function(e){e.fn.expandLinks=function(){return this.each(function(){new Linkified(this,{domainWhitelist:["(.+\\.)?chess24.com","(.+\\.)?google\\.[^\\.]+","(.+\\.)?wikipedia\\.[^\\.]+"]})})}}(jQuery),function(){function e(e,t){t.myData.score&&(t.myData.score.me=parseFloat(t.myData.score.me,10),t.myData.score.him=parseFloat(t.myData.score.him,10),t.showScore=!(!t.myData.score.me&&!t.myData.score.him),t.myData.score.me=Controller.Broadcast.scoreToString(t.myData.score.me),t.myData.score.him=Controller.Broadcast.scoreToString(t.myData.score.him));var n=jQuery(o.render("wrapper",t));n.find("a").on("click",function(e){e.stopPropagation()}),n.on("click",function(e){e.preventDefault(),e.stopPropagation()});var i=n.find(".challenges");s?e.children("span.miniProfile").removeClass("online"):new View.Online(n,t.user.online,t.user.uuid).link(notificationHandler);var a=t.user.uuid===config.user().uuid;return a||s?i.remove():(new View.ChallengeButton(i,t.user.uuid,t).link(notificationHandler),i.on("click.closeMiniProfile",function(t){t.preventDefault(),t.stopPropagation(),i.hasClass("cBtnInactive")||e.tooltip("hide")})),a||(config.level().isGuest?(n.find(".sendUserMessage").remove(),n.find(".friendshipButtons").remove()):(n.find(".sendUserMessage").on("click",function(n){n.preventDefault(),n.stopPropagation(),e.tooltip("hide"),new Dialog.UserMessage(t.user.uuid)}),r(n.find(".userActionMenu"),t.user))),n}function n(e){return{user:e.user,myData:e.myData,me:e.user.uuid===config.user().uuid}}function i(e,t,n){errorHandler.warning(new Error("not able to load miniprofile data",n))}function r(e,n){function i(){var e=$(this),t=e.data("related-user"),n=e.data("relation"),i={csrf:config.csrf(),relationType:n,relatedUser:t};jQuery.post(f,i)}function r(e,t){"action_update_buttons"===t.content.sAction&&t.content.sShownUserUuid===n.uuid&&(p.empty(),blockedUserHandler.isBlocked(n.uuid)&&m.removeClass().addClass("cIcon cIconUserBlock"),t.content.aButtons.forEach(function(e,t){switch(e.sButtonRelation){case"Invite":p.append(a()),m.removeClass().addClass("cIcon cIconUser");break;case"Cancel":p.append(s()),m.removeClass().addClass("cIcon cIconUserRequest");break;case"Accept":p.append(l()),m.removeClass().addClass("cIcon cIconUserRequest");break;case"Delete":p.append(c()),m.removeClass().addClass("cIcon cIconUserAccepted");break;case"Block":p.prepend(d());break;case"Unblock":p.prepend(d())}}))}function a(){return u("cIconUserAdd","Invite")}function s(){var e=jQuery(o.render("userActionMenu.actions.friendshipRequestOutgoing",{relatedUser:n.uuid,label:h("Request")}));return e.find("a").on("click",i),e}function l(){var e=jQuery(o.render("userActionMenu.actions.friendshipRequestIncoming",{relatedUser:n.uuid,label:h("Request")}));return e.find("a").on("click",i),e}function c(){return u("cIconUserDecline","Delete")}function d(){var e=blockedUserHandler.isBlocked(n.uuid)?"Unblock":"Block";return u("cIconUserBlock",e)}function u(e,t){var r=jQuery(o.render("userActionMenu.item",{className:e,relatedUser:n.uuid,relation:t,label:h(t)}));return r.children("a").on("click",i),r}function h(e){switch(e){case"Invite":return t("Add {{userName}} as friend",{"{{userName}}":n.name});case"Request":return t("Pending friendship request",{"{{userName}}":n.name});case"Delete":return t("Remove {{userName}} from friends",{"{{userName}}":n.name});case"Message":return t("Send message to {{userName}}",{"{{userName}}":n.name});case"Block":return t("Block {{userName}}",{"{{userName}}":n.name});case"Unblock":return t("Unblock {{userName}}",{"{{userName}}":n.name})}}var f="/api/web/UserFriendAPI/UpdateFriendshipRelation";notificationHandler.on("friendship",r),e.append(jQuery(o.render("userActionMenu.main")));var p=e.find("ul"),m=e.find(".icon");p.append(d()),blockedUserHandler.isBlocked(n.uuid)?m.removeClass().addClass("cIcon cIconUserBlock"):n.relation.isFriend?(p.append(c()),m.addClass("cIconUserAccepted")):n.relation.isPending&&n.relation.isOutgoing?(p.append(s()),m.addClass("cIconUserRequest")):n.relation.isPending&&!n.relation.isOutgoing?(p.append(l()),m.addClass("cIconUserRequest")):n.isFriend||(p.append(a()),m.addClass("cIconUser"))}var o,a,s,l="miniProfile",c="/api/web/UserAPI/getMiniprofile",d=400,u=/position-([^\s$]+)/;jQuery.fn.addMiniprofile=function(t){return s=s||jQuery("body").data("embed"),this.each(function(){function r(t,r){var s=t.data("uuid");if(!s)return void errorHandler.warning("missing uuid in miniprofile");a=a||new Helper.Cache(1e4),o=o||new Handler.Template(l).append(new Handler.Template);var d=a.get(s);return d&&!d.promise?r(e(t,d)):(d||(d=jQuery.getJSON(c,{userUUID:s,lang:config.language()}).fail(i),a.set(s,d)),void d.done(function(i){var o=n(i.data);a.set(s,o),r(e(t,o))}))}var s=jQuery(this);if(!s.data("initializedMiniprofile")||t){var h=(s.attr("class")||"").match(u);h=h?h[1]:"top",s.tooltip("reset").tooltip({showDelay:d,side:h},r),s.data("initializedMiniprofile",!0)}})}}(),function(){var e={showBg:function(){t++;var e=this,n=jQuery("body > .background");return n.length||(n=jQuery('<div class="background"/>').hide().appendTo("body").css({left:"0px",top:"0px",width:jQuery(window).innerWidth()+"px",height:jQuery(document).innerHeight()+"px"}),jQuery(window).on("resize",function(){n.css({width:jQuery(window).innerWidth()+"px",height:jQuery(document).innerHeight()+"px"})})),n.show(),this.data("modal-persistent")||n.one("click",function(){e.hide()}),this},setAlignX:function(e){return this.data("modal-align-x",jQuery(e).length?jQuery(e):null),this},setAlignY:function(e){return this.data("modal-align-y",jQuery(e).length?jQuery(e):null),this},setPersistent:function(){return this.data("modal-persistent",!0),this},hideBg:function(){return t--,1>t&&jQuery("body > .background").hide(),this},show:function(){var e=this;this.showBg(),this.css({display:"none",height:"auto"});var t,n,i=this.data("modal-align-x"),r=this.data("modal-align-y"),o=function(){t=i?i.offset().left+i.outerWidth()/2:jQuery(window).innerWidth()/2,n=r?r.offset().top-jQuery(document).scrollTop()+r.outerHeight()/2:jQuery(window).innerHeight()/2,e.css({left:t-e.width()/2+"px",top:n-e.height()/2+"px"})},a=this.height();return o(),this.css({height:"0px",display:"block",overflow:"hidden"}),this.animate({height:a+"px"},51,function(){e.css({height:"auto",overflow:"visible"})}),this.trigger("chess24:show"),jQuery(window).on("resize",o),layout(e),e},hide:function(){var e=this,t=e.data("modal-config")||{};return this.trigger("chess24:hide"),this.animate({height:"0px"},51,function(){e.css({display:"none",height:"auto"}),e.hideBg(),t.destroyOnClose&&e.destroy()}),this},destroy:function(){return this.remove(),this},adjust:function(e){e="undefined"==typeof e?51:e===!1?0:parseInt(e)||51,this.css("height","auto");var t=0,n=0;this.find("> *").each(function(){"absolute"!=jQuery(this).css("position")&&(n+=jQuery(this).innerHeight(),t=Math.max(t,jQuery(this).innerWidth()))}),t=Math.max(t,this.innerWidth()),n=Math.max(n,this.innerHeight());var i=t-this.innerWidth(),r=n-this.innerHeight(),o={};i&&(o.width=t+"px"),r&&(o.height=n+"px");var a,s,l=this.data("modal-align-x"),c=this.data("modal-align-y");return a=l?l.offset().left+l.outerWidth()/2:jQuery(window).innerWidth()/2,s=c?c.offset().top+c.outerHeight()/2:jQuery(window).innerHeight()/2,o.left=a-t/2+"px",o.top=s-n/2+"px",e?this.animate(o,e):this.css(o),this},html:function(e){return jQuery(".bubble-contents",this).html(e),this}},t=0;jQuery.fn.modal=function(t){if(!this.length)return this;t||(t={});var n;if("string"==typeof t){var i=this.hasClass("modal")?this:this.closest(".modal");if(!i.length)return;n=jQuery.extend(i,e),"function"==typeof n[t]&&n[t].apply(n,[].slice.call(arguments,1))}else n=this.is(".modal")?this:this.closest(".modal"),n.length||(n=jQuery('<div class="bubble modal"/>').append(jQuery('<div class="bubble-contents"/>').append(this)).css("width",t.width||"auto").appendTo("body"),t.classes&&n.find(".bubble-contents").addClass(t.classes),t.close&&n.append(jQuery("<div/>").addClass("btnCloseDialog").append(jQuery("<a/>").on("click",function(e){return n.modal("hide"),!1})))),n.data("modal-config",t),n=jQuery.extend(n,e),t.align&&(n.setAlignX(t.align),n.setAlignY(t.align)),t.alignX&&n.setAlignX(t.alignX),t.alignY&&n.setAlignY(t.alignY),t.persistent&&n.setPersistent(),n.css("display","none"),this.show(),jQuery(this).on("keyup",function(e){return 27==e.keyCode&&n.modal("hide"),!1}),jQuery(this).on("click",function(e){try{e.cancelBubble=!0,e.stopPropagation()}catch(t){}});return n}}(),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e:e(jQuery)}(function(e){function t(t){var o=t||window.event,a=s.call(arguments,1),l=0,c=0,d=0,u=0;return t=e.event.fix(o),t.type="mousewheel","detail"in o&&(d=-1*o.detail),"wheelDelta"in o&&(d=o.wheelDelta),"wheelDeltaY"in o&&(d=o.wheelDeltaY),"wheelDeltaX"in o&&(c=-1*o.wheelDeltaX),"axis"in o&&o.axis===o.HORIZONTAL_AXIS&&(c=-1*d,d=0),l=0===d?c:d,"deltaY"in o&&(d=-1*o.deltaY,l=d),"deltaX"in o&&(c=o.deltaX,0===d&&(l=-1*c)),0!==d||0!==c?(u=Math.max(Math.abs(d),Math.abs(c)),(!r||r>u)&&(r=u),l=Math[l>=1?"floor":"ceil"](l/r),c=Math[c>=1?"floor":"ceil"](c/r),d=Math[d>=1?"floor":"ceil"](d/r),t.deltaX=c,t.deltaY=d,t.deltaFactor=r,a.unshift(t,l,c,d),i&&clearTimeout(i),i=setTimeout(n,200),(e.event.dispatch||e.event.handle).apply(this,a)):void 0}function n(){r=null}var i,r,o=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],a="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],s=Array.prototype.slice;if(e.event.fixHooks)for(var l=o.length;l;)e.event.fixHooks[o[--l]]=e.event.mouseHooks;e.event.special.mousewheel={version:"3.1.6",setup:function(){if(this.addEventListener)for(var e=a.length;e;)this.addEventListener(a[--e],t,!1);else this.onmousewheel=t},teardown:function(){if(this.removeEventListener)for(var e=a.length;e;)this.removeEventListener(a[--e],t,!1);else this.onmousewheel=null}},e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})}),jQuery(function(){function e(e,n,i){if(n.update)return void(n.update.live&&(e.find(".live").removeClass("live"),e.find('li a[data-value="'+n.update.live+'"]').parent().addClass("live")));if(!n.values&&n.count){n.values=[];for(var r=0;r<n.count;r++)n.values.push(r+1)}n.values||errorHandler.error("Not enough data to build the pager",{options:n},!0),!n.labels&&n.count&&(n.labels=n.values.map(function(e){return e+1})),void 0===n.current&&(n.current=n.values[0]);var o=n.values.findIndex(function(e){return e==n.current}),a=o-(n.margin||0),s=o+(n.margin||0);0>a&&(s-=a,a=0),s>=n.values.length&&(a-=s-n.values.length+1,s=n.values.length-1),0>a&&(a=0);for(var l=[],r=a;s>=r;r++)l.push({value:n.values[r],label:n.labels[r],current:n.values[r]==n.current,live:n.live&&n.values[r]==n.live});var c={leftEllipsis:a>0,rightEllipsis:s<n.values.length-1,leftArrows:o>0,rightArrows:o<n.values.length-1},d=jQuery(t.render("pager",{pages:l,meta:c}));"function"==typeof i&&d.find("a").on("click",function(e){var t=jQuery(this);if(t.is(".disabled"))return void e.stopPropagation();var r,a=t.parent();r=a.is(".goFirst")?n.values[0]:a.is(".goPrev")?n.values[o-1]:a.is(".goNext")?n.values[o+1]:a.is(".goLast")?n.values[n.values.length-1]:t.data("value"),r!==n.current&&i(r),e.stopPropagation()}),n.classes&&d.addClass(n.classes),e.empty().append(d)}var t=new Handler.Template("plugin");jQuery.fn.pager=function(t,n){return this.each(function(){e(jQuery(this),Object.copy(t),n)})}}),function(){function e(e,n){function i(e,t,n){n=n||0;var i=jQuery("<div/>").addClass("chartPieSlice").appendTo(r),o=jQuery("<div/>").addClass("pie"+(t?" "+t:"")).appendTo(i);a>0&&i.css({"-webkit-transform":"rotate("+(a-n)+"deg)","-moz-transform":"rotate("+(a-n)+"deg)",transform:"rotate("+(a-n)+"deg)"}),o.css({"-webkit-transform":"rotate(0deg)","-moz-transform":"rotate(0deg)",transform:"rotate(0deg)"}),setTimeout(function(){o.css({"-webkit-transform":"rotate("+(e+n)+"deg)","-moz-transform":"rotate("+(e+n)+"deg)",transform:"rotate("+(e+n)+"deg)"})}),a+=e}for(var r=jQuery("<div/>").addClass("chartPieContainer"+(n.className?" "+n.className:"")).appendTo(e),o=jQuery("<ul/>").addClass("chartPieLegend").appendTo(e),a=0,s=n.data,l=[],c=0,d=0;d<s.length;d++)l.push(s[d].value),c+=parseInt(s[d].value,10),100==s[d].value&&s[d].color&&r.addClass(s[d].color);if(c>0){l=Math.getPercentages(l);for(var d=0;d<s.length;d++)s[d].value=3.6*l[d]}for(var d=0;d<s.length;d++)s[d].value>120?(i(120,s[d].color),s[d].value>240?(i(120,s[d].color,t),i(s[d].value-240,s[d].color,t)):i(s[d].value-120,s[d].color,t)):i(s[d].value,s[d].color),o.append(jQuery("<li/>").addClass(s[d].color||"").html(s[d].label||s[d].value+"%"));0===a&&(i(120,n.defaultColor||""),i(120,n.defaultColor||"",t),i(120,n.defaultColor||"",t),r.addClass(n.defaultColor||""))}var t=6;jQuery.fn.pieChart=function(t){this.each(function(){e(jQuery(this).empty(),t)})}}(),function(){function e(e,t){function n(){var n=t.getStartPosition().moveRight,r="b"===n?"P":"p",o="b"===n?4:3,a=i(r,o),s=e.find(".enPasantSelect").empty().append(jQuery("<option>&dash;</option>"));a.forEach(function(e){var t=e.replace("4","3").replace("5","6");s.append(jQuery('<option value="'+t+'">'+e+"</option>"))}),s.selectBox("destroy").selectBox()}function i(e,n){for(var i=t.getCurrentPosition().toString(),r=i.split(" "),o=Chess.translate.shortToLongPositionGroup(r[0]).split("/")[n],a=[],s=0;s<o.length;s++)o.substring(s,s+1)===e&&a.push(Chess.getSquare(7-n,s).toString());return a}function r(){var t={K:!1,Q:!1,k:!1,q:!1};return e.find('input[type="checkbox"].castling').each(function(){var e=jQuery(this);e.prop("checked")&&(t[e.attr("name")]=!0)}),t=Object.filter(t,function(e){return e}),t=Object.keys(t),t=t.length?t.join(""):"-"}function o(e,n){var i=t.getCurrentPosition().toString(),r=i.split(" ");r[e]!==n.toString()&&(r[e]=n.toString(),i=r.join(" "),t.setStartPosition(new Chess.Position({fen:i})))}function a(e){var n=jQuery('input[type="checkbox"][name="K"].castling'),i=jQuery('input[type="checkbox"][name="Q"].castling'),a=jQuery('input[type="checkbox"][name="k"].castling'),s=jQuery('input[type="checkbox"][name="q"].castling'),l=t.getCurrentPosition();n.prop("checked",(e||!e&&n.prop("checked"))&&l.canCastleKingside("w",!0)),i.prop("checked",(e||!e&&i.prop("checked"))&&l.canCastleQueenside("w",!0)),a.prop("checked",(e||!e&&a.prop("checked"))&&l.canCastleKingside("b",!0)),s.prop("checked",(e||!e&&s.prop("checked"))&&l.canCastleQueenside("b",!0)),o(2,r())}var s=new Handler.Template("plugin");e.html(s.render("positionBuilder"));var l=e.find(".chessBoard");t=t||new Chess.Game,t.setRules("build");var c=new View.ChessBoard(l).link(t),d=new Handler.Position(l,t,{pieces:!0,clear:!0});c.movementHandler.switchMoveConfirm(!1),n(),t.on("movedPositionPointer.start",function(){setTimeout(function(){a(!1),n()})}),e.find('input[type="radio"][name="blackwhitemove"]').change(function(){var e=["w","b"].contains(jQuery(this).val())?jQuery(this).val():"w";o(1,e)}).prop("checked",!1).filter("[value="+t.getMoveRight()+"]").prop("checked",!0),e.find('input[type="checkbox"].castling').change(function(){var e=r();o(2,e)}),e.find(".enPasantSelect").change(function(){var e=jQuery(this).val();o(3,e)}),e.find("input.moveNumber").change(function(){var e=parseInt(jQuery(this).val(),10)||0;o(5,e)}),e.find("input.applyFEN").on("propertychange change click keyup input paste",function(){var t=e.find("a.btnFen");Chess.isValidFen(jQuery(this).val())?t.removeClass("disabled").addClass("enabled"):t.removeClass("enabled").addClass("disabled")}),e.find(".fenInput").on("click","a.btnFen.enabled",function(){var n=e.find("input.applyFEN").val(),i=n.split(" "),r=i[1];jQuery('input[type="radio"][name="blackwhitemove"][value="'+r+'"]').prop("checked",!0);var o=i[4];jQuery("input.moveNumber").val(o),t.setStartPosition(new Chess.Position({fen:n})),a(!0)}),e.find(".btnReset").on("click",function(){t.setStartPosition(new Chess.Position)}),e.find(".btnClear").on("click",function(){d.clear()})}jQuery.fn.positionBuilder=function(t){return this.each(function(){e(jQuery(this).empty(),t)})}}(),function(e){e.fn.puzzle=function(t){function n(){return e(this).is("img")&&(this.complete?i(e(this)):e(this).load(function(){i(e(this))})),this}function i(t){function n(){o.onStart&&o.onStart(u),p.show(),f.animate({opacity:o.help?.1:0},"fast");for(var t=0;t<o.rows;t++)for(var n=0;n<o.columns;n++){var a=r-l,m=d-c,g=e("<span></span>").addClass("puzzle-piece").attr("data-num",t+"_"+n).css({width:l+"px",height:c+"px",display:"block",left:Math.floor(Math.random()*(a+1))+"px",top:Math.floor(Math.random()*(m+1))+"px","z-index":Math.floor(10*Math.random()+1),"background-image":'url("'+s+'")',cursor:"move","background-position":-n*l+"px "+-t*c+"px",position:"absolute"}).draggable({start:function(t,n){if(e.data(this,"ok")&&o.fixed)return!1;var i=0;u.find(".puzzle-piece").each(function(){var t=parseInt(e(this).css("z-index"));i=Math.max(t,i)}),e(this).css("z-index",i+1)},revert:"invalid",containment:u}).appendTo(p);e.data(g[0],"ok",!1),e.data(g[0],"lastLocation",p);e("<span></span>").addClass("puzzle-location").attr("data-num",t+"_"+n).css({width:l+"px",height:c+"px",left:n*l+"px",top:t*c+"px",display:"block",position:"absolute"}).droppable({accept:function(t){return t.hasClass("puzzle-piece")&&e(this).is(":empty")&&e(this).parents(".puzzle-game")[0]==t.parents(".puzzle-game")[0]},addClasses:!1,hoverClass:"puzzle-location-hover",drop:function(t,n){var r=e(this);if(n.draggable.appendTo(r),e.data(n.draggable[0],"lastLocation",r),n.draggable.css({left:"0px",top:"0px"}),e.data(n.draggable[0],"ok",!1),r.attr("data-num")==n.draggable.attr("data-num")){e.data(n.draggable[0],"ok",!0),o.fixed&&(n.draggable.css("cursor","default"),e("<span></span>").css({position:"absolute",left:"0px",top:"0px",display:"block",width:"100%",height:"100%","background-color":"#ffffff"}).appendTo(n.draggable).fadeOut("slow",function(){e(this).remove()}));var a=0;u.find(".puzzle-piece").each(function(){return e.data(this,"ok")?void a++:!1}),a==o.rows*o.columns&&i()}}}).appendTo(h)}}function i(){p.hide(),u.find(".puzzle-piece,	.puzzle-location").remove(),f.css("opacity","1"),o.onEnd&&o.onEnd(u)}var r=t.width(),a=t.height(),s=t.attr("src"),l=r/o.columns,c=a/o.rows,d=c>a/2?c:a/2,u=e("<span></span>").css({width:r+"px",display:"inline-block",position:"relative"}).addClass("puzzle-game").insertAfter(t),h=e("<span></span>").css({width:r+"px",height:a+"px",display:"inline-block",position:"relative"}).addClass("puzzle-container").appendTo(u),f=e("<span></span>").css({width:r+"px",height:a+"px",opacity:.1,"background-image":'url("'+s+'")',display:"inline-block"}).addClass("puzzle-image").appendTo(h),p=e("<span></span>").css({width:r+"px",minHeight:d+"px",display:"inline-block",position:"relative"}).addClass("puzzle-box").droppable({accept:".puzzle-piece",addClasses:!1,drop:function(t,n){var i=n.draggable,r=e.data(i[0],"lastLocation");r[0]!=this&&(i.appendTo(e(this)),i.css({left:"+="+r.position().left,top:i.position().top+r.position().top-h.outerHeight()+"px"}),e.data(i[0],"lastLocation",e(this)))}}).hide().insertAfter(h);t.remove(),n()}var r={rows:3,columns:3,help:!0,fixed:!1,onStart:null,onEnd:null},o=e.extend(r,t);return o.rows=Math.max(1,o.rows),o.columns=Math.max(1,o.columns),this.each(n)}}(jQuery),function(e){function t(e){var t=e.__resizeTriggers__,n=t.firstElementChild,i=t.lastElementChild,r=n.firstElementChild;i.scrollLeft=i.scrollWidth,i.scrollTop=i.scrollHeight,r.style.width=n.offsetWidth+1+"px",r.style.height=n.offsetHeight+1+"px",n.scrollLeft=n.scrollWidth,n.scrollTop=n.scrollHeight}function n(e){return e.offsetWidth!=e.__resizeLast__.width||e.offsetHeight!=e.__resizeLast__.height}function i(e){var i=this;t(this),this.__resizeRAF__&&c(this.__resizeRAF__),this.__resizeRAF__=l(function(){n(i)&&(i.__resizeLast__.width=i.offsetWidth,i.__resizeLast__.height=i.offsetHeight,i.__resizeListeners__.forEach(function(t){t.call(i,e)}))})}function r(){if(!a){var e=(w?w:"")+".resize-triggers { "+(k?k:"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',t=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e)),t.appendChild(n),a=!0}}var o=document.attachEvent,a=!1,s=e.fn.resize;if(e.fn.resize=function(e){return this.each(function(){this==window?s.call(jQuery(this),e):addResizeListener(this,e)})},e.fn.removeResize=function(e){return this.each(function(){removeResizeListener(this,e)})},!o){var l=function(){var e=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(e){return window.setTimeout(e,20)};return function(t){return e(t)}}(),c=function(){var e=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.clearTimeout;return function(t){return e(t)}}(),d=!1,u="animation",h="",f="animationstart",p="Webkit Moz O ms".split(" "),m="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),g="",v=document.createElement("fakeelement");if(void 0!==v.style.animationName&&(d=!0),d===!1)for(var y=0;y<p.length;y++)if(void 0!==v.style[p[y]+"AnimationName"]){g=p[y],u=g+"Animation",h="-"+g.toLowerCase()+"-",f=m[y],d=!0;break}var b="resizeanim",w="@"+h+"keyframes "+b+" { from { opacity: 0; } to { opacity: 0; } } ",k=h+"animation: 1ms "+b+"; "}window.addResizeListener=function(e,n){o?e.attachEvent("onresize",n):(e.__resizeTriggers__||("static"==getComputedStyle(e).position&&(e.style.position="relative"),r(),e.__resizeLast__={},e.__resizeListeners__=[],(e.__resizeTriggers__=document.createElement("div")).className="resize-triggers",e.__resizeTriggers__.innerHTML='<div class="expand-trigger"><div></div></div><div class="contract-trigger"></div>',e.appendChild(e.__resizeTriggers__),t(e),e.addEventListener("scroll",i,!0),f&&e.__resizeTriggers__.addEventListener(f,function(n){n.animationName==b&&t(e)})),e.__resizeListeners__.push(n))},window.removeResizeListener=function(e,t){o?e.detachEvent("onresize",t):(e.__resizeListeners__.splice(e.__resizeListeners__.indexOf(t),1),e.__resizeListeners__.length||(e.removeEventListener("scroll",i),e.__resizeTriggers__=!e.removeChild(e.__resizeTriggers__)))}}(jQuery),function(e){var t=this.SelectBox=function(e,t){if(e instanceof jQuery){if(!(e.length>0))return;e=e[0]}return this.typeTimer=null,this.typeSearch="",this.isMac=navigator.platform.match(/mac/i),t="object"==typeof t?t:{},this.selectElement=e,!t.mobile&&navigator.userAgent.match(/iPad|iPhone|Android|IEMobile|BlackBerry/i)?!1:"select"!==e.tagName.toLowerCase()?!1:void this.init(t)};t.prototype.version="1.2.0",t.prototype.init=function(t){var n=e(this.selectElement);if(n.data("selectBox-control"))return!1;var i=e('<a class="selectBox" />'),r=n.attr("multiple")||parseInt(n.attr("size"))>1,o=t||{},a=parseInt(n.prop("tabindex"))||0,s=this;if(i.width(n.outerWidth()).addClass(n.attr("class")).attr("title",n.attr("title")||"").attr("tabindex",a).css("display","inline-block").bind("focus.selectBox",function(){this!==document.activeElement&&document.body!==document.activeElement&&e(document.activeElement).blur(),i.hasClass("selectBox-active")||(i.addClass("selectBox-active"),n.trigger("focus"))}).bind("blur.selectBox",function(){i.hasClass("selectBox-active")&&(i.removeClass("selectBox-active"),n.trigger("blur"))}),e(window).data("selectBox-bindings")||e(window).data("selectBox-bindings",!0).bind("scroll.selectBox",o.hideOnWindowScroll?this.hideMenus:e.noop).bind("resize.selectBox",this.hideMenus),n.attr("disabled")&&i.addClass("selectBox-disabled"),n.bind("click.selectBox",function(e){i.focus(),e.preventDefault()}),r){if(t=this.getOptions("inline"),i.append(t).data("selectBox-options",t).addClass("selectBox-inline selectBox-menuShowing").bind("keydown.selectBox",function(e){s.handleKeyDown(e)}).bind("keypress.selectBox",function(e){s.handleKeyPress(e)}).bind("mousedown.selectBox",function(t){1===t.which&&(e(t.target).is("A.selectBox-inline")&&t.preventDefault(),i.hasClass("selectBox-focus")||i.focus())}).insertAfter(n),!n[0].style.height){var l=n.attr("size")?parseInt(n.attr("size")):5,c=i.clone().removeAttr("id").css({position:"absolute",top:"-9999em"}).show().appendTo("body");c.find(".selectBox-options").html("<li><a> </a></li>");var d=parseInt(c.find(".selectBox-options A:first").html("&nbsp;").outerHeight());c.remove(),i.height(d*l)}this.disableSelection(i)}else{var u=e('<span class="selectBox-label" />'),h=e('<span class="selectBox-arrow" />');u.attr("class",this.getLabelClass()).text(this.getLabelText()),t=this.getOptions("dropdown"),t.appendTo("BODY"),i.data("selectBox-options",t).addClass("selectBox-dropdown").append(u).append(h).bind("mousedown.selectBox",function(e){1===e.which&&(i.hasClass("selectBox-menuShowing")?s.hideMenus():(e.stopPropagation(),t.data("selectBox-down-at-x",e.screenX).data("selectBox-down-at-y",e.screenY),s.showMenu()))}).bind("keydown.selectBox",function(e){s.handleKeyDown(e)}).bind("keypress.selectBox",function(e){s.handleKeyPress(e)}).bind("open.selectBox",function(e,t){t&&t._selectBox===!0||s.showMenu()}).bind("close.selectBox",function(e,t){t&&t._selectBox===!0||s.hideMenus()}).insertAfter(n);var f=i.width()-h.outerWidth()-(parseInt(u.css("paddingLeft"))||0)-(parseInt(u.css("paddingRight"))||0);u.width(f),this.disableSelection(i)}n.addClass("selectBox").data("selectBox-control",i).data("selectBox-settings",o).hide()},t.prototype.getOptions=function(t){var n,i=e(this.selectElement),r=this,o=function(t,n){return t.children("OPTION, OPTGROUP").each(function(){if(e(this).is("OPTION"))e(this).length>0?r.generateOptions(e(this),n):n.append("<li> </li>");else{var t=e('<li class="selectBox-optgroup" />');t.text(e(this).attr("label")),n.append(t),n=o(e(this),n)}}),n};switch(t){case"inline":return n=e('<ul class="selectBox-options" />'),n=o(i,n),n.find("A").bind("mouseover.selectBox",function(t){r.addHover(e(this).parent())}).bind("mouseout.selectBox",function(t){r.removeHover(e(this).parent())}).bind("mousedown.selectBox",function(e){1===e.which&&(e.preventDefault(),i.selectBox("control").hasClass("selectBox-active")||i.selectBox("control").focus())}).bind("mouseup.selectBox",function(t){1===t.which&&(r.hideMenus(),r.selectOption(e(this).parent(),t))}),this.disableSelection(n),n;case"dropdown":n=e('<ul class="selectBox-dropdown-menu selectBox-options" />'),n=o(i,n),n.data("selectBox-select",i).css("display","none").appendTo("BODY").find("A").bind("mousedown.selectBox",function(t){1===t.which&&(t.preventDefault(),t.screenX===n.data("selectBox-down-at-x")&&t.screenY===n.data("selectBox-down-at-y")&&(n.removeData("selectBox-down-at-x").removeData("selectBox-down-at-y"),/android/i.test(navigator.userAgent.toLowerCase())&&/chrome/i.test(navigator.userAgent.toLowerCase())&&r.selectOption(e(this).parent()),r.hideMenus()))}).bind("mouseup.selectBox",function(t){1===t.which&&(t.screenX!==n.data("selectBox-down-at-x")||t.screenY!==n.data("selectBox-down-at-y"))&&(n.removeData("selectBox-down-at-x").removeData("selectBox-down-at-y"),r.selectOption(e(this).parent()),r.hideMenus())}).bind("mouseover.selectBox",function(t){r.addHover(e(this).parent())}).bind("mouseout.selectBox",function(t){r.removeHover(e(this).parent())});var a=i.attr("class")||"";if(""!==a){a=a.split(" ");for(var s=0;s<a.length;s++)n.addClass(a[s]+"-selectBox-dropdown-menu")}return this.disableSelection(n),n}},t.prototype.getLabelClass=function(){var t=e(this.selectElement).find("OPTION:selected");return("selectBox-label "+(t.attr("class")||"")).replace(/\s+$/,"")},t.prototype.getLabelText=function(){var t=e(this.selectElement).find("OPTION:selected");return t.text()||" "},t.prototype.setLabel=function(){var t=e(this.selectElement),n=t.data("selectBox-control");n&&n.find(".selectBox-label").attr("class",this.getLabelClass()).text(this.getLabelText())},t.prototype.destroy=function(){var t=e(this.selectElement),n=t.data("selectBox-control");if(n){var i=n.data("selectBox-options");i.remove(),n.remove(),t.removeClass("selectBox").removeData("selectBox-control").data("selectBox-control",null).removeData("selectBox-settings").data("selectBox-settings",null).show()}},t.prototype.refresh=function(){var t,n=e(this.selectElement),i=n.data("selectBox-control"),r=i.hasClass("selectBox-dropdown")?"dropdown":"inline";switch(i.data("selectBox-options").remove(),t=this.getOptions(r),i.data("selectBox-options",t),r){case"inline":i.append(t);break;case"dropdown":this.setLabel(),e("BODY").append(t)}"dropdown"===r&&i.hasClass("selectBox-menuShowing")&&this.showMenu()},t.prototype.showMenu=function(){var t=this,n=e(this.selectElement),i=n.data("selectBox-control"),r=n.data("selectBox-settings"),o=i.data("selectBox-options");if(i.hasClass("selectBox-disabled"))return!1;
this.hideMenus();var a=parseInt(i.css("borderBottomWidth"))||0,s=parseInt(i.css("borderTopWidth"))||0,l=i.offset(),c=r.topPositionCorrelation?r.topPositionCorrelation:0,d=r.bottomPositionCorrelation?r.bottomPositionCorrelation:0,u=o.outerHeight(),h=i.outerHeight(),f=parseInt(o.css("max-height")),p=e(window).scrollTop(),m=l.top-p,g=e(window).height()-(m+h),v=m>g&&(null==r.keepInViewport?!0:r.keepInViewport),y=v?l.top-u+s+c:l.top+h-a-d;if(f>m&&f>g)if(v){var b=f-(m-5);o.css({"max-height":f-b+"px"}),y+=b}else{var b=f-(g-5);o.css({"max-height":f-b+"px"})}if(o.data("posTop",v),o.width(i.innerWidth()).css({top:y,left:i.offset().left}).addClass("selectBox-options selectBox-options-"+(v?"top":"bottom")),n.triggerHandler("beforeopen"))return!1;var w=function(){n.triggerHandler("open",{_selectBox:!0})};switch(r.menuTransition){case"fade":o.fadeIn(r.menuSpeed,w);break;case"slide":o.slideDown(r.menuSpeed,w);break;default:o.show(r.menuSpeed,w)}r.menuSpeed||w();var k=o.find(".selectBox-selected:first");this.keepOptionInView(k,!0),this.addHover(k),i.addClass("selectBox-menuShowing selectBox-menuShowing-"+(v?"top":"bottom")),e(document).bind("mousedown.selectBox",function(n){if(1===n.which){if(e(n.target).parents().andSelf().hasClass("selectBox-options"))return;t.hideMenus()}})},t.prototype.hideMenus=function(){0!==e(".selectBox-dropdown-menu:visible").length&&(e(document).unbind("mousedown.selectBox"),e(".selectBox-dropdown-menu").each(function(){var t=e(this),n=t.data("selectBox-select"),i=n.data("selectBox-control"),r=n.data("selectBox-settings"),o=t.data("posTop");if(n.triggerHandler("beforeclose"))return!1;var a=function(){n.triggerHandler("close",{_selectBox:!0})};if(r){switch(r.menuTransition){case"fade":t.fadeOut(r.menuSpeed,a);break;case"slide":t.slideUp(r.menuSpeed,a);break;default:t.hide(r.menuSpeed,a)}r.menuSpeed||a(),i.removeClass("selectBox-menuShowing selectBox-menuShowing-"+(o?"top":"bottom"))}else e(this).hide(),e(this).triggerHandler("close",{_selectBox:!0}),e(this).removeClass("selectBox-menuShowing selectBox-menuShowing-"+(o?"top":"bottom"));t.css("max-height",""),t.removeClass("selectBox-options-"+(o?"top":"bottom")),t.data("posTop",!1)}))},t.prototype.selectOption=function(t,n){var i=e(this.selectElement);t=e(t);var r=i.data("selectBox-control");i.data("selectBox-settings");if(r.hasClass("selectBox-disabled"))return!1;if(0===t.length||t.hasClass("selectBox-disabled"))return!1;if(i.attr("multiple"))if(n.shiftKey&&r.data("selectBox-last-selected")){t.toggleClass("selectBox-selected");var o;o=t.index()>r.data("selectBox-last-selected").index()?t.siblings().slice(r.data("selectBox-last-selected").index(),t.index()):t.siblings().slice(t.index(),r.data("selectBox-last-selected").index()),o=o.not(".selectBox-optgroup, .selectBox-disabled"),t.hasClass("selectBox-selected")?o.addClass("selectBox-selected"):o.removeClass("selectBox-selected")}else this.isMac&&n.metaKey||!this.isMac&&n.ctrlKey?t.toggleClass("selectBox-selected"):(t.siblings().removeClass("selectBox-selected"),t.addClass("selectBox-selected"));else t.siblings().removeClass("selectBox-selected"),t.addClass("selectBox-selected");r.hasClass("selectBox-dropdown")&&r.find(".selectBox-label").text(t.text());var a=0,s=[];return i.attr("multiple")?r.find(".selectBox-selected A").each(function(){s[a++]=e(this).attr("rel")}):s=t.find("A").attr("rel"),r.data("selectBox-last-selected",t),i.val()!==s&&(i.val(s),this.setLabel(),i.trigger("change")),!0},t.prototype.addHover=function(t){t=e(t);var n=e(this.selectElement),i=n.data("selectBox-control"),r=i.data("selectBox-options");r.find(".selectBox-hover").removeClass("selectBox-hover"),t.addClass("selectBox-hover")},t.prototype.getSelectElement=function(){return this.selectElement},t.prototype.removeHover=function(t){t=e(t);var n=e(this.selectElement),i=n.data("selectBox-control"),r=i.data("selectBox-options");r.find(".selectBox-hover").removeClass("selectBox-hover")},t.prototype.keepOptionInView=function(t,n){if(t&&0!==t.length){var i=e(this.selectElement),r=i.data("selectBox-control"),o=r.data("selectBox-options"),a=r.hasClass("selectBox-dropdown")?o:o.parent(),s=parseInt(t.offset().top-a.position().top),l=parseInt(s+t.outerHeight());n?a.scrollTop(t.offset().top-a.offset().top+a.scrollTop()-a.height()/2):(0>s&&a.scrollTop(t.offset().top-a.offset().top+a.scrollTop()),l>a.height()&&a.scrollTop(t.offset().top+t.outerHeight()-a.offset().top+a.scrollTop()-a.height()))}},t.prototype.handleKeyDown=function(t){var n=e(this.selectElement),i=n.data("selectBox-control"),r=i.data("selectBox-options"),o=n.data("selectBox-settings"),a=0,s=0;if(!i.hasClass("selectBox-disabled"))switch(t.keyCode){case 8:t.preventDefault(),this.typeSearch="";break;case 9:case 27:this.hideMenus(),this.removeHover();break;case 13:i.hasClass("selectBox-menuShowing")?(this.selectOption(r.find("LI.selectBox-hover:first"),t),i.hasClass("selectBox-dropdown")&&this.hideMenus()):this.showMenu();break;case 38:case 37:if(t.preventDefault(),i.hasClass("selectBox-menuShowing")){var l=r.find(".selectBox-hover").prev("LI");for(a=r.find("LI:not(.selectBox-optgroup)").length,s=0;(0===l.length||l.hasClass("selectBox-disabled")||l.hasClass("selectBox-optgroup"))&&(l=l.prev("LI"),0===l.length&&(l=o.loopOptions?r.find("LI:last"):r.find("LI:first")),!(++s>=a)););this.addHover(l),this.selectOption(l,t),this.keepOptionInView(l)}else this.showMenu();break;case 40:case 39:if(t.preventDefault(),i.hasClass("selectBox-menuShowing")){var c=r.find(".selectBox-hover").next("LI");for(a=r.find("LI:not(.selectBox-optgroup)").length,s=0;(0===c.length||c.hasClass("selectBox-disabled")||c.hasClass("selectBox-optgroup"))&&(c=c.next("LI"),0===c.length&&(c=o.loopOptions?r.find("LI:first"):r.find("LI:last")),!(++s>=a)););this.addHover(c),this.selectOption(c,t),this.keepOptionInView(c)}else this.showMenu()}},t.prototype.handleKeyPress=function(t){var n=e(this.selectElement),i=n.data("selectBox-control"),r=i.data("selectBox-options"),o=this;if(!i.hasClass("selectBox-disabled"))switch(t.keyCode){case 9:case 27:case 13:case 38:case 37:case 40:case 39:break;default:i.hasClass("selectBox-menuShowing")||this.showMenu(),t.preventDefault(),clearTimeout(this.typeTimer),this.typeSearch+=String.fromCharCode(t.charCode||t.keyCode),r.find("A").each(function(){return e(this).text().substr(0,o.typeSearch.length).toLowerCase()===o.typeSearch.toLowerCase()?(o.addHover(e(this).parent()),o.selectOption(e(this).parent(),t),o.keepOptionInView(e(this).parent()),!1):void 0}),this.typeTimer=setTimeout(function(){o.typeSearch=""},1e3)}},t.prototype.enable=function(){var t=e(this.selectElement);t.prop("disabled",!1);var n=t.data("selectBox-control");n&&n.removeClass("selectBox-disabled")},t.prototype.disable=function(){var t=e(this.selectElement);t.prop("disabled",!0);var n=t.data("selectBox-control");n&&n.addClass("selectBox-disabled")},t.prototype.setValue=function(t){var n=e(this.selectElement);n.val(t),t=n.val(),null===t&&(t=n.children().first().val(),n.val(t));var i=n.data("selectBox-control");if(i){var r=n.data("selectBox-settings"),o=i.data("selectBox-options");this.setLabel(),o.find(".selectBox-selected").removeClass("selectBox-selected"),o.find("A").each(function(){if("object"==typeof t)for(var n=0;n<t.length;n++)e(this).attr("rel")==t[n]&&e(this).parent().addClass("selectBox-selected");else e(this).attr("rel")==t&&e(this).parent().addClass("selectBox-selected")}),r.change&&r.change.call(n)}},t.prototype.disableSelection=function(t){e(t).css("MozUserSelect","none").bind("selectstart",function(e){e.preventDefault()})},t.prototype.generateOptions=function(t,n){var i=e("<li />"),r=e("<a />");i.addClass(t.attr("class")),i.data(t.data()),r.attr("rel",t.val()).text(t.text()),i.append(r),t.attr("disabled")&&i.addClass("selectBox-disabled"),t.attr("selected")&&i.addClass("selectBox-selected"),n.append(i)},e.extend(e.fn,{setOptions:function(t){var n=e(this),i=n.data("selectBox-control");switch(typeof t){case"string":n.html(t);break;case"object":n.html("");for(var r in t)if(null!==t[r])if("object"==typeof t[r]){var o=e('<optgroup label="'+r+'" />');for(var a in t[r])o.append('<option value="'+a+'">'+t[r][a]+"</option>");n.append(o)}else{var s=e('<option value="'+r+'">'+t[r]+"</option>");n.append(s)}}i&&e(this).selectBox("refresh")},selectBox:function(n,i){var r;switch(n){case"control":return e(this).data("selectBox-control");case"settings":if(!i)return e(this).data("selectBox-settings");e(this).each(function(){e(this).data("selectBox-settings",e.extend(!0,e(this).data("selectBox-settings"),i))});break;case"options":if(void 0===i)return e(this).data("selectBox-control").data("selectBox-options");e(this).each(function(){e(this).setOptions(i)});break;case"value":if(void 0===i)return e(this).val();e(this).each(function(){(r=e(this).data("selectBox"))&&r.setValue(i)});break;case"refresh":e(this).each(function(){(r=e(this).data("selectBox"))&&r.refresh()});break;case"enable":e(this).each(function(){(r=e(this).data("selectBox"))&&r.enable(this)});break;case"disable":e(this).each(function(){(r=e(this).data("selectBox"))&&r.disable()});break;case"destroy":e(this).each(function(){(r=e(this).data("selectBox"))&&(r.destroy(),e(this).data("selectBox",null))});break;case"instance":return e(this).data("selectBox");default:e(this).each(function(i,r){e(r).data("selectBox")||e(r).data("selectBox",new t(r,n))})}return e(this)}})}(jQuery),function(){var e={facebook:!0,twitter:!0,google:!0,mail:!1,embed:!0},t=function(e){e()};jQuery.fn.shareButtons=function(n,i){function r(){var e=n.url||window.location.href;return e.match(/^https?\:\/\//)||(e=window.location.protocol+"//"+window.location.host+e),e}if("string"!=typeof n)n=jQuery.extend({},e,n),this.each(function(){var e=jQuery(this);if(!e.data("share-buttons")){if(e.data("share-buttons",!0),n.plain)i=e;else{e.addClass("cTooltipBox position-top"),n.noIcon||e.append('<a class="cIcon cIconSocial">'+(n.noLabel?"":window.t("Share"))+"</a>");var i=jQuery('<span class="cTooltipBoxContainer bubbleSocialIcons"/>').appendTo(e)}if(n.facebook){var o=e.find(".facebook");o.length||(o=jQuery('<a title="Facebook" class="cIcon cIconFacebookLarge"></a>').appendTo(i)),o.on("click",function(){t(function(){window.open("https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(r()),"facebook","width=400,height=300")})});e.find(".facebookCount")}if(n.twitter!==!1){var a=e.find(".twitter");a.length||(a=jQuery('<a title="Twitter" class="cIcon cIconTwitterLarge"></a>').appendTo(i)),a.on("click",function(){t(function(){window.open("http://twitter.com/home?status="+encodeURIComponent((n.twitter===!0?"":n.twitter+" ")+r()),"twitter","width=400,height=300")})});e.find(".twitterCount")}if(n.google){var s=e.find(".google");s.length||(s=jQuery('<a title="Google+" class="cIcon cIconGoogleLarge"></a>').appendTo(i)),s.on("click",function(){t(function(){window.open("https://plus.google.com/share?url="+encodeURIComponent(r()),"googleplus","width=400,height=300")})});e.find(".googleCount")}if(n.mail){var l=e.find(".mail");l.length||(l=jQuery('<a title="Email" class="cIcon cIconMailLarge"></a>').appendTo(i))}if(n.embed){var c=e.find(".embed");c.length||(c=jQuery('<a title="Embed" class="cIcon cIconEmbedLarge"></a>').appendTo(i)),c.on("click",function(){var t=e.data("embed-data");if(t){var n=jQuery(t.html).modal({close:!0});t.events&&Object.forEach(t.events,function(e,t){Object.forEach(e,function(e,i){var r="*"==i?n:n.find(i);r.on(t,function(){e.apply(this,arguments)})})}),n.modal("show")}else{var i=e.data("embed-url");i||(i=jQuery("head > link[rel=embed-url]").attr("href")),/^http/.test(i)||(i="https://chess24.com"+i);var r='<iframe src="'+i+'" width="980" height="1500" frameborder="0" style="margin:0; padding:0;"></iframe>',n=jQuery("<div/>").addClass("popupInsider socialDialogEmbed").append(jQuery("<div/>").addClass("dialogContent").html('<textarea class="cPattern">'+r+'</textarea><br class="clear"/>')).append(jQuery("<div/>").addClass("dialogFooter"));n.modal({classes:"defaultPopup",close:!0,destroyOnClose:!0}).modal("show"),n.find("textarea").select()}})}}});else switch(n){case"filter":"function"==typeof i&&(t=i)}}}(),function(e){function n(){a=new Date,a.setTime(a.getTime()-36e5*a.getHours()-6e4*a.getMinutes()-1e3*a.getSeconds()-a.getTime()%1e3),s=new Date(a),s.setDate(s.getDate()-1),o=new Date(a),o.setDate(o.getDate()+1),r=new Date(a),r.setDate(r.getDate()+2)}function i(e,n,i,r,o){for(var a=Math.floor((n-i-r.getTime())/1e3),s=new Date(n-1e3*a),u=o?d:c,h=0;h<u.length;h++)if(a<u[h].lessThan&&(!u[h].condition||u[h].condition(s))){var f=r.getHours(),p=r.getMinutes();return 10>f&&(f="0"+f),10>p&&(p="0"+p),e.html(t(u[h].phrase,{"{{n}}":Math.floor(a/u[h].devider),"{{hour}}":f,"{{minute}}":p,"{{day}}":r.getDate(),"{{month}}":r.getMonth()+1,"{{monthENG}}":l[r.getMonth()],"{{year}}":r.getFullYear()})),Math.abs(u[h].devider-a%u[h].devider)}}var r,o,a,s,l=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];e.fn.showAge=function(t,r){return(void 0===a||void 0===s)&&n(),this.each(function(){function n(){var e=Date.now(),t=notificationHandler.getTimeOffset();if(isNaN(t))return void t.done(n);if(o.closest(document.documentElement).length){var s=1e3*i(o,e,t,a,r);1/0>s&&o.data("showAgeTimeout",setTimeout(n,s))}}var o=e(this),a=void 0===t?o.data("created"):t;a instanceof Date||(a=new Date(a));var s=o.data("showAge");if(!s||s.getTime()!==a.getTime()){if(s){var l=o.data("showAgeTimeout");l&&clearTimeout(l)}o.data("showAge",a),n()}})},e.fn.showDateTime=function(t){return this.each(function(){var n=e(this);if(n.data("showDateTime"))return!0;var i=void 0===t?n.data("created"):t;n.html(Helper.getFormatedLocalDateTime(i)),n.data("showDateTime",!0)})},Helper.getFormatedLocalDateTime=function(e,n){e instanceof Date||(e=new Date(e));var i=e.getHours(),r=e.getMinutes(),o=e.getSeconds();return 10>i&&(i="0"+i),10>r&&(r="0"+r),10>o&&(o="0"+o),t(n||Helper.getFormatedLocalDateTimeSeperated.phrases.dateTime,{"{{hour}}":i,"{{minute}}":r,"{{seconds}}":o,"{{day}}":e.getDate(),"{{month}}":e.getMonth()+1,"{{monthENG}}":l[e.getMonth()],"{{year}}":e.getFullYear()})},Helper.getFormatedLocalDateTimeSeperated=function(e){e instanceof Date||(e=new Date(e));var n=e.getHours(),i=e.getMinutes();return 10>n&&(n="0"+n),10>i&&(i="0"+i),{date:t(Helper.getFormatedLocalDateTimeSeperated.phrases.date,{"{{day}}":e.getDate(),"{{month}}":e.getMonth()+1,"{{monthENG}}":l[e.getMonth()],"{{year}}":e.getFullYear()}),time:t(Helper.getFormatedLocalDateTimeSeperated.phrases.time,{"{{hour}}":n,"{{minute}}":i})}},Helper.getFormatedLocalDateTimeSeperated.phrases={date:"{{monthENG}} {{day}}, {{year}}",time:"{{hour}}:{{minute}}",dateTime:"{{monthENG}} {{day}}, {{year}} | {{hour}}:{{minute}}",dateTimeSeconds:"{{monthENG}} {{day}}, {{year}} | {{hour}}:{{minute}}:{{seconds}}"};var c=[{lessThan:-3600,devider:-3600,condition:function(e){return e>=o&&r>e},phrase:"tomorrow at {{hour}}:{{minute}}"},{lessThan:-3600,devider:-3600,condition:function(e){return e>=a&&o>e},phrase:"today at {{hour}}:{{minute}}"},{lessThan:-86400,devider:-3600,phrase:Helper.getFormatedLocalDateTimeSeperated.phrases.dateTime},{lessThan:-120,devider:-60,phrase:"in {{n}} minutes"},{lessThan:-60,devider:-60,phrase:"in {{n}} minute"},{lessThan:0,devider:60,phrase:"in a few seconds"},{lessThan:60,devider:60,phrase:"a few seconds ago"},{lessThan:120,devider:60,phrase:"{{n}} minute ago"},{lessThan:3600,devider:60,phrase:"{{n}} minutes ago"},{lessThan:7200,devider:3600,phrase:"{{n}} hour ago"},{lessThan:86400,devider:3600,phrase:"{{n}} hours ago"},{lessThan:172800,condition:function(e){return e>=s&&a>e},phrase:"yesterday at {{hour}}:{{minute}}"},{lessThan:1/0,devider:1/0,phrase:Helper.getFormatedLocalDateTimeSeperated.phrases.dateTime}],d=[{lessThan:60,devider:60,phrase:"&lt; 1 min"},{lessThan:3600,devider:60,phrase:"{{n}} min"},{lessThan:86400,devider:3600,phrase:"{{n}} h"},{lessThan:1/0,devider:1/0,phrase:"{{monthENG}} {{day}}"}]}(jQuery),function(e){e.fn.shuffle=function(){var t=this.get(),n=function(e){return Math.floor(Math.random()*e)},i=e.map(t,function(){var i=n(t.length),r=e(t[i]).clone(!0)[0];return t.splice(i,1),r});return this.each(function(t){e(this).replaceWith(e(i[t]))}),e(i)}}(jQuery),jQuery.fn.simpleSlideshow=function(e){return this.each(function(){var t=jQuery(this);if(!t.data("simpleslideshow")){t.find("li").each(function(){for(;this.nextSibling&&1!=this.nextSibling.nodeType;)this.parentNode.removeChild(this.nextSibling)}),e=e||{};var n=!1,i=e.width||t.parent().width(),r=function(e){if(!n){n=!0;var r=parseInt(t.css("left"),10),a=r-e*o.outerWidth();if(a>0){var s=Math.ceil(t.outerWidth()/o.outerWidth())*o.outerWidth(),l=r-s+parseInt(o.css("padding-left"),10)+parseInt(o.css("padding-right"),10),c=t.clone(!0).css("left",l+"px").insertBefore(t);t.animate({left:a+"px"},200),c.animate({left:l+i+"px"},200,function(){t.remove(),t=c,n=!1})}else if(-a>=t.outerWidth()){var s=Math.ceil(t.outerWidth()/o.outerWidth())*o.outerWidth(),l=r+s-parseInt(o.css("padding-left"),10)-parseInt(o.css("padding-right"),10),c=t.clone(!0).css("left",l+"px").insertAfter(t);t.animate({left:a+"px"},200),c.animate({left:l-i+"px"},200,function(){t.remove(),t=c,n=!1})}else t.stop().animate({left:a+"px"},200,function(){n=!1})}},o=t.closest("div.simpleSlideshow");if(o.length)o.find(".previous").on("click",function(){r(-1)}),o.find(".next").on("click",function(){r(1)});else{var a=t.outerHeight()+parseInt(t.css("margin-top"),10)+parseInt(t.css("margin-bottom"),10);o=jQuery("<div/>").addClass("simpleSlideshow").css("width",i+"px").css("height",a+"px").insertBefore(t).append(t).append(jQuery("<a/>").addClass("previous").on("click",function(){r(-1)})).append(jQuery("<a/>").addClass("next").on("click",function(){r(1)})),t.is(".externalHandles")&&o.find(".previous,.next").insertBefore(o)}t.css({position:"absolute",left:"0px",top:"0px"}),t.outerWidth()<o.outerWidth()&&o.find(".previous, .next").remove(),t.find("img").each(function(){var e=jQuery(this),t=e.data("src");if(t){var n=new Image;n.src=t;var i=e.attr("src");e.on("mouseenter",function(){e.attr("src",t)}).on("mouseleave",function(){e.attr("src",i)})}});var s=Array.prototype.reduce.call(t.find("li"),function(e,t){var n=jQuery(t);return e+n.outerWidth()+(parseInt(n.css("margin-left"),10)||0)+(parseInt(n.css("margin-right"),10)||0)},0);t.css("width",s+"px"),t.data("scroll-to")&&t.data("scroll-to")>1&&r(t.data("scroll-to")-1),t.data("simpleslideshow",!0)}})},function(){var e={height:200,speed:500,step:500,caption:"off"},t={wrapper:null,controls:null,current:0,init:function(){var e=this,t=this.parent().width();return this.wrapper=this.closest("div.slideshow"),0==this.wrapper.length?this.wrapper=jQuery("<div/>").addClass("slideshow"):(this.insertAfter(this.wrapper),this.wrapper.html("")),this.before(this.wrapper),this.controls={left:jQuery("<div/>").addClass("slideshow-left").appendTo(this.wrapper),right:jQuery("<div/>").addClass("slideshow-right").appendTo(this.wrapper),viewport:jQuery("<div/>").addClass("slideshow-viewport").appendTo(this.wrapper).append(this),caption:"on"==this.config.caption&&"popup"!=this.config.stage?jQuery("<div/>").addClass("slideshow-caption").appendTo(this.wrapper):!1,stage:"off"==this.config.stage||"popup"==this.config.stage?!1:jQuery("<div/>").addClass("slideshow-stage").appendTo(this.wrapper),popup:jQuery("<div/>").addClass("slideshow-popup").appendTo("body").modal({classes:"slideshow-popup"}),current:jQuery("<div/>").addClass("slideshow-current").appendTo(this.wrapper).hide()},this.controls.stage&&(this.controls.stage.append('<div class="image"/>'),this.controls.stage.append('<div class="caption"/>')),this.setupInteractions(),this.adjust(t,this.config.height),this.data("slideshow",this.config),this.config.perpage&&(this.config.step=this.controls.viewport.width()),this.find("li").each(function(){jQuery(this).find("*").hide().end().find(">img,>a").show()}),"popup"!=this.config.stage&&this.find("li:first").trigger("click"),e.data("slideshow",this.config),e},catchup:function(){var e=this,t=e.data("slideshow");return t?(e.config=t,e.wrapper=e.closest(".slideshow"),e.controls={left:e.wrapper.find("> .slideshow-left"),right:e.wrapper.find("> .slideshow-right"),viewport:e.wrapper.find("> .slideshow-viewport"),caption:"on"==e.config.caption&&"popup"!=e.config.stage?e.wrapper.find("> .slideshow-caption"):!1,stage:"off"==e.config.stage||"popup"==e.config.stage?!1:e.wrapper.find("> .slideshow-stage"),popup:jQuery(".slideshow-popup"),current:e.wrapper.find(".slideshow-current")},e.controls.current.length||(e.controls.current=jQuery("<div/>").addClass("slideshow-current").appendTo(this.wrapper).hide()),this.setupInteractions(),this.adjust(this.parent().width(),this.config.height),this.find("li").each(function(){jQuery(this).find("*").hide().end().find(">img,>a").show()}),"popup"!=this.config.stage&&this.find("li:first").trigger("click"),e):e.init()},slideTo:function(e,t){var n=this;if(n.animating)return n;var i=n.width(),r=n.controls.viewport.width();return e=Math.min(0,Math.max(e,r-i)),t?n.css("left",e+"px"):(n.animating=!0,n.animate({left:e+"px"},n.config.speed,"easeOutCirc",function(){n.animating=!1})),n},slideBy:function(e){return e&&this.slideTo(parseInt(this.css("left"))+e),this},setupInteractions:function(){var e=this,t=!1;e.controls.right.off("click").on("click",function(){if(parseInt(e.config.stage))e.current+1<=e.find("li").length&&e.find("li:eq("+(e.current+1)+")").trigger("click");else if(e.config=e.data("slideshow"),1==e.config.perpage){var t=Math.round(-parseInt(e.css("left"))/e.controls.viewport.width());e.find("li:eq("+t+")").next().trigger("click")}else e.slideBy(-e.config.step)}),e.controls.left.off("click").on("click",function(){if(parseInt(e.config.stage))e.current>0&&e.find("li:eq("+(e.current-1)+")").trigger("click");else if(e.config=e.data("slideshow"),1==e.config.perpage){var t=Math.round(-parseInt(e.css("left"))/e.controls.viewport.width());e.find("li:eq("+t+")").prev().trigger("click")}else e.slideBy(+e.config.step)}),e.find("li").off("click").on("click",function(){if(t)return void(t=!1);var n=jQuery(this);e.config=e.data("slideshow");var i=e.controls.viewport.width();if(e.slideTo(-n.position().left+i/2-n.width()/2),e.current=n.prevAll("li").length,e.controls.left[0==e.current?"hide":"show"](),e.controls.right[e.current==e.find("li").length-1?"hide":"show"](),"popup"==e.config.stage)e.popup(e.current);else if(e.controls.stage){var r=e.controls.stage.find(".image"),o=e.controls.stage.find(".caption"),a=n.find("img").clone(),s=a.data("original-src");s&&a.attr("src",s).attr("data-original-src",""),e.controls.stage.find(".image").html("").append(a),a.css("height",e.controls.stage.height()+"px"),a.css("left",r.width()/2-a.width()/2+"px");var l=n.clone().find("> img, >a, .slideshow-current, input[type=hidden]").remove().end().find(":not(:visible)").show().end().contents();o.html("").append(l),r.find("img").on("load",function(){o.css("margin-left",r.width()+"px"),e.controls.current.css("left",n.width()/2-e.controls.current.width()/2),a.css("left",r.width()/2-a.width()/2+"px")}),r.append(jQuery("<a/>").addClass("open").on("click",function(){e.popup(n.prevAll("li").length)}))}e.controls.caption&&e.controls.caption.html(n.clone().find("img").remove().end().html().trim()).find("*").show(),e.controls.current.appendTo(n).css("left",n.width()/2-e.controls.current.width()/2).show()}),e.off("mousedown").on("mousedown",function(n){t=!1,moving=!1;var i=parseInt(e.css("left")),r=n.clientX,o=n.clientX,a=(new Date).getTime(),s=[],l=function(){for(var e=0,t=0,n=s.length-1;n>=0&&!(e+s[n][0]>500);n--)e+=s[n][0],t+=s[n][1];return e?t/e:0};jQuery(document).on("mousemove mouseup",function(n){var l=(new Date).getTime(),c=n.clientX-o;if(!moving&&Math.abs(c)>10&&(moving=!0),moving){e.slideTo(i+n.clientX-r,!0);var d=l-a;s.length>0&&s[s.length-1][1]*c<0?s=[[d,c]]:s.push([d,c]),o=n.clientX,a=l;try{n.preventDefault()}catch(u){n.returnValue=!1}"mousemove"==n.type&&(t=!0)}}).on("mouseup",function(){t||e.slideBy(100*l()),jQuery(document).off("mouseup mousemove")});try{n.preventDefault()}catch(c){n.returnValue=!1}}),e.config.reorder&&e.find(e.config.reorder).off("mousedown").on("mousedown",function(t){var n,i,r=jQuery(jQuery(this).closest("li")),o=jQuery("<div/>").addClass("slideshow-drag-marker").css({height:r.height()+"px",left:parseInt(r.css("left"))-2+"px"}).appendTo(e);return e.find("li").not(r).on("mousemove",function(t){var r=jQuery(this);t.pageX<r.offset().left+r.width()/2?(n=null,i=this,o.css("left",parseInt(r.css("left"))-2+"px")):(n=this,i=null,o.css("left",parseInt(r.css("left"))+r.width()-1+"px")),t.pageX>e.controls.viewport.offset().left+e.controls.viewport.width()-r.width()?e.slideBy(-r.width()):t.pageX<e.controls.viewport.offset().left+r.width()&&e.slideBy(r.width())}),jQuery(document).one("mouseup",function(t){return e.find("li").off("mousemove"),jQuery(document).off("mouseup"),o.remove(),n?r.insertAfter(n):i&&r.insertBefore(i),e.adjust(void 0,void 0,!0),"function"==typeof e.config.onreorder&&e.config.onreorder(),t.stopPropagation(),t.preventDefault(),!1}),t.stopPropagation(),t.preventDefault(),!1})},adjust:function(e,t,n){var i=this;e||(e=this.wrapper.width()),t||(t=this.config.height),this.wrapper.css({width:e+"px",height:t+"px"});var r=t;"off"==this.config.stage||"popup"==this.config.stage?(this.controls.caption&&(r-=this.controls.caption.height(),this.controls.caption.css("width",e+"px")),this.controls.left.css("height",r+"px"),this.controls.right.css("height",r+"px"),this.controls.viewport.css({height:r+"px",left:"0px",width:e+"px"})):parseInt(this.config.stage)&&(this.controls.stage.css({left:"0px",top:"0px",width:e+"px",height:this.config.stage+"px"}),this.controls.stage.find(".image").css({height:this.config.stage+"px",width:1.5*this.config.stage+"px"}),r-=this.config.stage,this.controls.caption&&(this.controls.caption.css({left:"0px",top:this.config.stage+"px",width:e+"px"}),r-=this.controls.caption.height()),this.controls.left.css({height:this.config.stage+"px",top:"0px"}),this.controls.right.css({height:this.config.stage+"px",top:"0px"}),this.controls.viewport.css({width:e+"px",height:r+"px",top:t-r+"px"}));var o=0;if(this.find("li").each(function(){var a=jQuery(this),s=a.outerWidth()-a.width(),l=a.outerHeight()-a.height();a.add(a.find("img")).css("height",r-l+"px").css("width","auto"),i.config.perpage&&(a.css({width:(i.controls.viewport.width()-s*i.config.perpage)/i.config.perpage+"px"}),a.find("img").width()>a.width()&&a.find("img").css({width:a.width()+"px",height:"auto"})),n?a.animate({left:o+"px"},200):a.css("left",o+"px"),o+=a.innerWidth(),0==a.find("img").width()&&a.find("img").one("load",function(){i.adjust(e,t)})}),this.css({height:r+"px",width:o+"px"}),this.width()>this.controls.viewport.width()&&parseInt(this.css("left"))>this.width()-this.controls.viewport.width()&&this.css("left",this.width()-this.controls.viewport.width()+"px"),this.config.perpage){var a=this.controls.viewport.width()/this.config.perpage,s=(this.config.perpage-this.find("li").length%this.config.perpage)%this.config.perpage;this.css("width",o+a*s+"px")}return i.setupInteractions(),i.controls.stage&&i.controls.stage.find("input[type=hidden]").remove(),i},popup:function(e,t){var n=this,i=n.controls.popup.find(".slideshow-left"),r=n.controls.popup.find(".slideshow-right"),o=n.controls.popup.find(".slideshow-viewport"),a=function(){n.controls.popup.modal("hide")},s=n.controls.popup.find(".bubble-contents");i.length||(i=jQuery("<div/>").addClass("slideshow-left").appendTo(s),r=jQuery("<div/>").addClass("slideshow-right").appendTo(s),o=jQuery("<div/>").addClass("slideshow-viewport").appendTo(s)),i.off("click").one("click",function(t){n.popup(e-1,!0);try{t.cancelBubble=!0,t.stopPropagation()}catch(i){}}),r.off("click").one("click",function(t){n.popup(e+1,!0);try{t.cancelBubble=!0,t.stopPropagation()}catch(i){}});var l=n.find("li:eq("+e+") img");if(!l.length)return t&&a(),n;var c=n.controls.popup.find("img");n.controls.popup.css({width:c.width()+"px",height:c.height()+"px",overflow:"hidden"}),l=l.clone().css("visibility","hidden").on("click",function(){n.popup(e+1,!0)});var d=l.data("original-src");d&&l.attr("src",d).attr("data-original-src",""),l.appendTo(o);var u=function(e){o.find("*").not(l).remove(),l.css({width:"auto",height:"auto"}),l.width()>jQuery(window).width()-200&&l.css("width",jQuery(window).width()-200+"px"),l.height()>jQuery(window).height()-100&&l.css({width:"auto",height:jQuery(window).height()-100+"px"}),i.css({left:"0px",top:"0px",height:o.height()+"px"}),r.css({right:"0px",top:"0px",height:o.height()+"px"}),e&&"load"==e.type&&l.css("visibility","visible");var t=l.width(),a=l.height(),s=jQuery(window).innerWidth()/2-t/2,c=jQuery(window).innerHeight()/2-a/2;l.css("opacity",0),o.css("background","url("+l.attr("src")+") center center"),n.controls.popup.stop().animate({width:t+"px",height:a+"px",left:s+"px",top:c+"px"},100,function(){o.css("background",""),l.css("opacity",1),n.controls.popup.css({width:"auto",height:"auto"})})};return n.controls.popup.modal("show"),u(),l.on("load",u),n}};jQuery.fn.slideshow=function(n){if(0==this.length)return this;var i=jQuery.extend(jQuery(this.get(0)),t);if("string"==typeof n){if(0==i.closest(".slideshow").length)return this;if(i.catchup(),"function"==typeof i[n])return i[n].apply(i,[].slice.call(arguments,1))}else{if(!i.is("ul"))return this;i.config=jQuery.extend({},e,n||{}),i.closest(".slideshow").length>0?i.catchup():i.init()}return this}}(),jQuery.fn.sortableTable=function(e){function t(e,t,n){e.removeClass("sortAsc sortDesc").data("sortable-sort",!1),t.addClass("sort"+n.substr(0,1).toUpperCase()+n.substr(1)).data("sortable-sort",n)}function n(e){var t=e.find("th a.sortCol");if(!t.length)do{var n=e.parent().closest("table");t=n.find("> thead th a.sortCol")}while(n.length&&!t.length);return t}var i="pattern-sortable",r="sortable-reverse",o="sortable-cells",a="desc",s="asc";if("getCurrentSort"===e){$handles=n(jQuery(this)).filter(".sortDesc, .sortAsc");var l={};return l[$handles.parent().index()]=$handles.hasClass("sortDesc")?"sortDesc":"sortAsc",l}return this.each(function(){function e(){var e=jQuery(this);e.data(o,e.find("td").map(function(e){var t=jQuery(this),n=t.data("sortable-value");return void 0===n&&(n=t.text().trim().toLowerCase()),h[e]&&(n=(""+n).replace(h[e],"$1")),d[e]=u[e]||d[e]&&(!isNaN(n)||!!n.match(/^\s*[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?\s*$/)),n}))}function l(e,t,n){if(e.length){var i=e.sort(function(e,i){var r=jQuery(e).data(o)[t],a=jQuery(i).data(o)[t];return d[t]&&(r=parseInt(r,10),a=parseInt(a,10)),(n===s?1:-1)*(a>r?-1:r>a?1:0)}),r=c.find(i).eq(0);if(r.length)var a=jQuery("<tr/>").insertBefore(r);else a=jQuery("<tr/>").appendTo(c);i.detach(),a.after(i).remove(),e=i}}var c=jQuery(this);if(!c.data(i)){c.data(i,!0);var d=[],u=[],h=[],f=!!c.data(r),p=n(c);if(p.length){p.on("click",function(){var e=jQuery(this);if(f)var n=e.is(".sortDesc")?s:a;else n=e.is(".sortAsc")?a:s;var i=e.closest("th").prevAll("th").length;l(m,i,n),t(p,e,n)}).each(function(){var e=jQuery(this),t=e.closest("th").prevAll("th").length;d[t]=!0,u[t]=!!e.data("sortable-numeric");var n=e.data("sortable-pattern");h[t]=n?new RegExp(n):void 0});var m=c.find("tr").not(".sortIgnore").filter(function(){return 0===jQuery(this).find("th").length}).each(e);c.on("chess24:add",function(t,n){var i=jQuery(n);if(!i.is("tr"))throw new Exception("only <tr> elements can be inserted into a sortable table");e.call(i),m=m.add(i);var r=p.filter("a.sortCol.sortAsc, a.sortCol.sortDesc"),o=r.is(".sortAsc")?s:r.hasClass("sortDesc")?a:"";if([s,a].contains(o)){var d=r.closest("th").prevAll("th").length;l(m,d,o)}else f?c.prepend(i):c.append(i)}),c.on("chess24:remove",function(e,t){m=m.filter(function(){return!jQuery(this).is(t)}),jQuery(t).remove()});var g=p.filter(".sortDesc, .sortAsc").eq(0);if(g.length){var v=g.hasClass("sortAsc")?s:a;l(m,g.parent().index(),v),t(p,g,v)}}}})},function(){var e={url:"",autoPlay:!1,volume:100,loop:!1
},t={init:function(t){this.html("").addClass("soundPlayer"),this.config=jQuery.extend({},e,t),this.controls=this.buildHtml(),this.setupControls(),this.load(!!this.config.autoPlay),this.volume(parseInt(this.config.volume)||100)},buildHtml:function(){var e={},t=jQuery("<ul/>").addClass("ulPlaySet preventSelection").appendTo(this),n=jQuery("<li/>").addClass("playpause").appendTo(t),i=jQuery("<li/>").addClass("progress").appendTo(t),r=jQuery("<li/>").addClass("time").appendTo(t),o=jQuery("<li/>").addClass("label").appendTo(t);e.playpause=jQuery("<a/>").addClass("fp-play gameVideoControlIcon iconPlay").html(window.t("Play/Resume")).appendTo(n);var a=jQuery("<div/>").addClass("timelineContainer").appendTo(i);e.progress=jQuery("<div/>").addClass("fp-timeline").appendTo(a),e.buffer=jQuery("<div/>").addClass("fp-buffer").appendTo(e.progress),e.progressPos=jQuery("<div/>").addClass("fp-progress").appendTo(e.progress);var s=jQuery("<div/>").addClass("fp-time").appendTo(r);e.timeElapsed=jQuery("<em/>").addClass("fp-elapsed").html("00:00").appendTo(s).after('<em class="fp-separator">/</em>'),e.timeRemaining=jQuery("<em/>").addClass("fp-remaining").html("00:00").appendTo(s),e.timeDuration=jQuery("<em/>").addClass("fp-duration").html("00:00").appendTo(s),e.label=jQuery("<span/>").appendTo(o);var l=jQuery("<li/>").addClass("mute").appendTo(t),c=jQuery("<li/>").addClass("volume").appendTo(t);return e.volume=jQuery("<div/>").addClass("fp-volumeslider").appendTo(c),e.volumePos=jQuery("<div/>").addClass("fp-volumelevel").appendTo(e.volume),e.mute=jQuery("<a/>").addClass("fp-mute gameVideoControlIcon iconUnmute").html(window.t("Mute")).appendTo(l),e},position:function(e,t){return this.sound?"undefined"==typeof e?this.sound.position:(this.controls.progressPos.css("width",e+"%"),this.controls.timeElapsed.html(this.format(this.sound.duration*(e/100))),t||this.sound.setPosition(this.sound.duration*(e/100)),void 0):void 0},format:function(e){e=Math.round(e/1e3);var t=Math.floor(e/60),n=e%60;return t+":"+(10>n?"0":"")+n},volume:function(e){return this.sound?"undefined"==typeof e?this.sound.volume:(this.controls.volumePos.css("width",e+"%"),void this.sound.setVolume(e)):void 0},updateTime:function(){return this.sound?void(this.overridePosition||this.position(this.sound.position/this.sound.duration*100,!0)):void 0},updateLabel:function(){if(!this.sound)return void 0;var e=this.sound.id3.artist||window.t("Unknown"),t=this.sound.id3.title||window.t("Untitled");this.controls.label.html(e+" - "+t)},load:function(e){var t=this;this.sound=soundManager.createSound({id:"mySound2",url:this.config.url}),this.position(0),this.controls.label.html("..."),this.sound.load({onid3:function(){t.updateLabel()},onload:function(){t.updateLabel(),t.position(0),t.readyToPlay=!0,e&&t.play()}})},play:function(){if(!this.sound)return void 0;var e=this;this.sound.play({whileplaying:function(){e.updateTime()},onid3:function(){e.updateLabel()},onload:function(){e.updateLabel(),e.position(0)},onfinish:function(){e.position(0),e.pause()}}),this.controls.playpause.removeClass("iconPlay").addClass("iconPause")},pause:function(){return this.sound?(this.controls.playpause.removeClass("iconPause").addClass("iconPlay"),void this.sound.pause()):void 0},mute:function(e){return this.sound?void this.sound[e?"mute":"unmute"]():void 0},loop:function(e){if(!this.sound)return void 0;var t=this;this.sound.onfinish(function(){e&&(t.sound.position=0,t.sound.play())})},setupControls:function(){var e=this;this.controls.playpause.on("click",function(){e.controls.playpause.hasClass("iconPause")?e.pause():e.play()}),this.controls.volume.on("mousedown",function(t){var n=jQuery(this),i=t.clientX-n.offset().left,r=i/n.width()*100;e.volume(r),jQuery(document).on("mousemove",function(t){var i,r=t.clientX-n.offset().left;i=0>r?0:r>n.width()?100:r/n.width()*100,e.volume(i)}),jQuery(document).one("mouseup",function(){jQuery(document).off("mousemove").off("mouseup")})}),this.controls.progress.on("mousedown",function(t){var n=jQuery(this),i=t.clientX-n.offset().left,r=i/n.width()*100;e.position(r),e.overridePosition=!0;var o=r;jQuery(document).on("mousemove",function(t){var i=t.clientX-n.offset().left;if(!(0>i||i>n.width())){var r=i/n.width()*100;e.position(r,!0),o=r}}),jQuery(document).on("mouseup",function(){e.position(o),jQuery(document).off("mousemove").off("mouseup"),e.overridePosition=void 0})})}};jQuery.fn.soundPlayer=function(e){var n=this;return"object"==typeof e&&(soundManager.setup({debugMode:!1,url:e.swf||e.assetDir()+"/images/swf/soundmanager2.swf"}),soundManager.onready(function(){n.each(function(){var n=jQuery.extend({},jQuery(this),t);n.init(e)})})),this}}(),function(){var e,t;e=this.jQuery||window.jQuery,t=e(window),e.fn.stick_in_parent=function(n){var i,r,o,a,s,l,c,d,u,h,f,p;for(null==n&&(n={}),p=n.sticky_class,l=n.inner_scrolling,f=n.recalc_every,h=n.parent,u=n.offset_top,d=n.spacer,o=n.bottoming,null==u&&(u=0),null==h&&(h=void 0),null==l&&(l=!0),null==p&&(p="is_stuck"),i=e(document),null==o&&(o=!0),a=function(n,r,a,s,c,m,g,v){var y,b,w,k,x,C,j,T,_,S,I,P;if(!n.data("sticky_kit")){if(n.data("sticky_kit",!0),x=i.height(),j=n.parent(),null!=h&&(j=j.closest(h)),!j.length)throw"failed to find stick parent";if(w=!1,y=!1,I=null!=d?d&&n.closest(d):e("<div />"),T=function(){var e,t,o;if(!v)return x=i.height(),e=parseInt(j.css("border-top-width"),10),t=parseInt(j.css("padding-top"),10),r=parseInt(j.css("padding-bottom"),10),a=j.offset().top+e+t,s=j.height(),w&&(w=!1,y=!1,null==d&&(n.insertAfter(I),I.detach()),n.css({position:"",top:"",width:"",bottom:""}).removeClass(p),o=!0),c=n.offset().top-(parseInt(n.css("margin-top"),10)||0)-u,m=n.outerHeight(!0),g=n.css("float"),I&&I.css({width:n.outerWidth(!0),height:m,display:n.css("display"),"vertical-align":n.css("vertical-align"),"float":g}),o?P():void 0},T(),m!==s)return k=void 0,C=u,S=f,P=function(){var e,h,b,_,P,M;if(!v)return b=!1,null!=S&&(S-=1,0>=S&&(S=f,T(),b=!0)),b||i.height()===x||(T(),b=!0),_=t.scrollTop(),null!=k&&(h=_-k),k=_,w?(o&&(P=_+m+C>s+a,y&&!P&&(y=!1,n.css({position:"fixed",bottom:"",top:C}).trigger("sticky_kit:unbottom"))),c>_&&(w=!1,C=u,null==d&&(("left"===g||"right"===g)&&n.insertAfter(I),I.detach()),e={position:"",width:"",top:""},n.css(e).removeClass(p).trigger("sticky_kit:unstick")),l&&(M=t.height(),m+u>M&&(y||(C-=h,C=Math.max(M-m,C),C=Math.min(u,C),w&&n.css({top:C+"px"}))))):_>c&&(w=!0,e={position:"fixed",top:C},e.width="border-box"===n.css("box-sizing")?n.outerWidth()+"px":n.width()+"px",n.css(e).addClass(p),null==d&&(n.after(I),("left"===g||"right"===g)&&I.append(n)),n.trigger("sticky_kit:stick")),w&&o&&(null==P&&(P=_+m+C>s+a),!y&&P)?(y=!0,"static"===j.css("position")&&j.css({position:"relative"}),n.css({position:"absolute",bottom:r,top:"auto"}).trigger("sticky_kit:bottom")):void 0},_=function(){return T(),P()},b=function(){return v=!0,t.off("touchmove",P),t.off("scroll",P),t.off("resize",_),e(document.body).off("sticky_kit:recalc",_),n.off("sticky_kit:detach",b),n.removeData("sticky_kit"),n.css({position:"",bottom:"",top:"",width:""}),j.position("position",""),w?(null==d&&(("left"===g||"right"===g)&&n.insertAfter(I),I.remove()),n.removeClass(p)):void 0},t.on("touchmove",P),t.on("scroll",P),t.on("resize",_),e(document.body).on("sticky_kit:recalc",_),n.on("sticky_kit:detach",b),setTimeout(P,0)}},s=0,c=this.length;c>s;s++)r=this[s],a(e(r));return this}}.call(this),function(e){e.toJSON="object"==typeof JSON&&JSON.stringify?JSON.stringify:function(t){if(null===t)return"null";var n,i,r,o,a=e.type(t);if("undefined"===a)return void 0;if("number"===a||"boolean"===a)return String(t);if("string"===a)return e.quoteString(t);if("function"==typeof t.toJSON)return e.toJSON(t.toJSON());if("date"===a){var s=t.getUTCMonth()+1,l=t.getUTCDate(),c=t.getUTCFullYear(),d=t.getUTCHours(),u=t.getUTCMinutes(),h=t.getUTCSeconds(),f=t.getUTCMilliseconds();return 10>s&&(s="0"+s),10>l&&(l="0"+l),10>d&&(d="0"+d),10>u&&(u="0"+u),10>h&&(h="0"+h),100>f&&(f="0"+f),10>f&&(f="0"+f),'"'+c+"-"+s+"-"+l+"T"+d+":"+u+":"+h+"."+f+'Z"'}if(n=[],e.isArray(t)){for(i=0;i<t.length;i++)n.push(e.toJSON(t[i])||"null");return"["+n.join(",")+"]"}if("object"==typeof t){for(i in t)if(hasOwn.call(t,i)){if(a=typeof i,"number"===a)r='"'+i+'"';else{if("string"!==a)continue;r=e.quoteString(i)}a=typeof t[i],"function"!==a&&"undefined"!==a&&(o=e.toJSON(t[i]),n.push(r+":"+o))}return"{"+n.join(",")+"}"}}}(jQuery),function(e){e.fn.styleFileUpload=function(){e(this).each(function(){var t=e(this);if(!t.data("pattern-file")){t.data("pattern-file",!0);var n=t.closest(".inputFileUpload"),i=t.data("url"),r=!!i,o=t.data("filters")?t.data("filters").split(","):null,a=t.attr("multiple"),s=null,l=!1,c=n.find(".cBtnIconFileUpload");if(c.data("title",c.html()),r&&!a?n.addClass("uploadImmediate"):a&&n.addClass("uploadMultiple"),c.on("click",function(){if(!a&&l)l=!1,n.find(".fileUploadDetails, .fileUploadProgress, input[type=hidden]").remove(),n.removeClass("inputError fileUploadError uploadReady"),s=null,t.trigger("chess24:cancel");else{var i=e(this).closest(".inputFileUpload").find("input:file");a||i.attr("name")||i.attr("name",n.find("input[type=hidden]").attr("name")),i.click()}}),r){var d=[];if(d.proceed=function(){l=!1,this.length&&this.shift()()},!a){var u=e('<input type="hidden"/>').attr("name",t.attr("name")).val(t.get(0).getAttribute("value")).appendTo(n);t.attr("name","");for(var h=t.get(0).className.split(" "),f=0;f<h.length;f++)"validate["==h[f].substr(0,9)&&(u.addClass(h[f]),t.removeClass(h[f]))}t.fileupload({url:i,dataType:"iframejson",dropZone:e("nothing"),paramName:t.data("name"),converters:{"html iframejson":function(t){return e.parseJSON(e("<div/>").html(t.replace(/\r\n/g,"")).text())},"iframe iframejson":function(t){return e.parseJSON(t.find("body").text())}},add:function(i,u){if(n.removeClass("inputError uploadReady fileUploadError"),t=n.find("input:file"),t.trigger("chess24:add",u),r){if(o&&o.length){u.formData=u.formData||{};for(var h=0;h<o.length;h++){var f=e("#"+o[h]);f.length&&f.val()&&(u.formData[f.attr("name")]=f.val())}}u.formData=u.formData||{},u.formData.csrf||(u.formData.csrf=config.csrf())}if(a){var p,m=n.nextAll(".fileUploadProgress"),g=e("<div/>").addClass("fileUploadProgress").insertAfter(m.length?m.last():n).append(e("<div/>")).append(e("<label/>").html(u.files[0].name).prepend(e("<span>x</span>").on("click",function(){try{p.abort()}catch(e){}n.removeClass("inputError uploadReady fileUploadError"),g.remove()})));r&&(l?d.push(function(){return g.parent().length?(l=!0,s=g,void(p=u.submit())):void d.proceed()}):(l=!0,s=g,p=u.submit()))}else t.attr("name")||t.attr("name",n.find("input[type=hidden]").attr("name")),n.find(".fileUploadDetails, .fileUploadProgress, input[type=hidden]").remove(),u.originalFiles=u.originalFiles.slice(0,1),e('<div class="fileUploadDetails"/>').prependTo(n).append(e("<span>x</span>").on("click",function(){n.removeClass("inputError uploadReady fileUploadError"),n.find("input:file").attr("name")||n.find("input:file").attr("name",n.find("input[type=hidden]").attr("name")),n.find(".fileUploadDetails, .fileUploadProgress").remove(),n.find("input[type=hidden]").val(""),s=null,l=!1;try{p.abort()}catch(e){}c.html(c.data("title")),t.trigger("chess24:cancel")})).append("<label>"+u.files[0].name+"</label>"),r&&(s=e("<div/>").addClass("fileUploadProgress").prependTo(n).append(e("<div/>").addClass("showProgress").css({})),l=!0,u.submit()),c.html(window.t("Cancel"))},done:function(i,r){if(t=n.find("input:file"),!l)return void(s&&(s.remove(),s=null));var o=r.result;s&&s.addClass("uploadReady").find("div").css("width","100%"),n.addClass("uploadReady"),0==o.status&&(a?s.append(e('<input type="hidden"/>').attr("name",t.attr("name")+"[]").val(o.data.reference_id)):(n.append(e('<input type="hidden"/>').attr("name",t.attr("name")).val(o.data.reference_id)),t.attr("name",""),c.html(window.t("Change"))),t.trigger("chess24:done",r)),s=null,d.proceed()},error:function(e,i,r){(l||a)&&(n.addClass("uploadReady"),a||n.addClass("inputError"),s&&(s.find("div").css("width","100%"),s.addClass("fileUploadError uploadReady"),s=null),c.html(c.data("title")),t.trigger("chess24:error",e,i,r),d.proceed())},progressall:function(e,n){if(l){var i=Math.round(n.loaded/n.total*100);s&&s.find("div").css("width",i+"%"),t.trigger("chess24:progress",i)}}})}else t.on("change",function(){var i=e(this).val().split("\\").pop();n.find(".fileUploadDetails").remove(),i.length>0?(c.text(window.t("Change")),n.prepend(e('<div class="fileUploadDetails"/>').append("<span>x</span>").on("click",function(){t.val(""),n.find(".fileUploadDetails").remove(),c.text(c.data("title"))}).append("<label>"+i+"</label>"))):c.text(c.data("title"))})}})}}($),function(e){function t(e,t,n,r){var o=i[e]||i.linear;t.values.forEach(function(e,i){var a=e-n,s=r-n,l=a/s;t.values[i]=Math.round(n+s*o(l))})}function n(e,t,n,i){var o=r[e]||r.linear,a=t-n,s=i-n,l=a/s;return n+s*o(l)}e.fn.styleRangeSlider=function(){jQuery(this).each(function(){function e(e,n){if(f&&b.toggleClass(f,r(b)===u),p&&w.toggleClass(p,r(w)===h),n&&n.values){t(y,n,s,l);var o=n.values;i(b,o[0]==s?u||o[0]+c:o[0]),i(w,o[1]==l?h||o[1]+d:o[1])}}function i(e,t){k?e.find("input").val(t):e.html(t)}function r(e){return k?e.find("input").val():e.html()}var o=jQuery(this);if(!o.data("pattern-slider")){o.data("pattern-slider",!0);var a=o.children(".cPatternSlider"),s=a.data("min-value")||0,l=a.data("max-value")||100,c=a.data("min-append")||"",d=a.data("max-append")||"",u=a.data("min-replace-label"),h=a.data("max-replace-label"),f=a.data("min-replace-class"),p=a.data("max-replace-class"),m=a.data("initial-min-value")||0,g=a.data("initial-max-value")||100,v=parseFloat(a.data("step"))||1,y=a.data("shape")||"linear",b=o.find(".sliderValue-min"),w=o.find(".sliderValue-max"),k=b.find("input").length&&w.find("input").length;i(b,m==s&&(u||m+c)||m),i(w,g==l&&(h||g+d)||g);var x=!1;a.slider({range:!0,min:s,max:l,values:[m,g],step:v,slide:e,change:function(t,n){e(t,n),a.trigger("slidestop",n)},stop:function(e,n){t(y,n,s,l),a.trigger("afterstop",n)}}),k&&b.add(w).find("input").on("keyup",function(e){if(13===e.which){var t=jQuery(this),i=a.slider("values");t.parent().is(b)?i[0]=n(y,parseInt(t.val(),10)||s,s,l):i[1]=n(y,parseInt(t.val(),10)||l,s,l),x=!0,a.slider("values",i)}}),e()}})};var i={slowDown:function(e){return--e*e*e+1},linear:function(e){return e}},r={slowDown:function(e){return 1+Math.cbrt(e-1)},linear:function(e){return e}}}($),jQuery(function(){var e={init:function(){var e=this;this.controls={},this.controls.dropdown=jQuery("<div/>").addClass("suggestFieldDropdown").hide().appendTo("body"),this.config={url:this.data("url")||"",strict:"undefined"!=typeof this.data("strict"),multiple:"undefined"!=typeof this.data("multiple")};var t=this.data("filter");t&&(this.config.filters=(""+t).split(","));for(var n=this.attr("class").split(" "),i=0;i<n.length;i++)"validate["==n[i].substr(0,9)&&n.remove(i);if(n=n.join(" "),this.config.multiple){if(!this.is("div"))return;this.addClass("suggestField");var r=this.data("value");if(r&&r.length){for(var i=0;i<r.length;i++)this.append(this.item(r[i].value,r[i].name));this.trigger("chess24:select")}this.controls.input=this.find("input.suggestField"),this.controls.input.length||(this.controls.input=jQuery('<input type="text"/>').appendTo(this).addClass("suggestField").addClass(n).val(this.data("text-value")||"")),this.adjust()}else if(this.config.strict){if("hidden"!=this.attr("type"))return;this.controls.input=this.next("input.suggestField"),this.controls.input.length||(this.controls.input=this.next(".suggestField").find("input.suggestField")),this.controls.input.length||(this.controls.input=jQuery('<input type="text"/>').insertAfter(this).addClass("suggestField").addClass(n).val(this.data("text-value")||"")),this.updateValues=!0}else if("hidden"==this.attr("type")){var o=this.data("text-field");o&&(this.controls.input=jQuery("#"+o)),this.controls.input.length||(this.controls.input=this.next("input.suggestField")),this.controls.input.length||(this.controls.input=this.parent().next(".suggestField").find("input.suggestField")),this.controls.input.length||(this.controls.input=o?jQuery("#"+o):jQuery('<input type="text"/>').insertAfter(this).val(this.data("text-value")||"")),this.controls.input.addClass("suggestField").addClass("suggestField").addClass(n),this.updateValues=!0}else"text"==this.attr("type")&&(this.controls.input=this,this.updateValues=!1);var a;this.controls.input.on("keydown keypress keyup",function(t){9===t.keyCode&&t.preventDefault(),clearTimeout(a),a=setTimeout(function(){var n=e.controls.input.val().trim();return e.config.multiple&&""==n&&""==e.lastpattern&&8==t.keyCode&&"keydown"==t.type?void e.backspace():n&&(9==t.keyCode||13==t.keyCode)||","==n.substr(n.length-1)&&e.config.multiple?void e.force(n):void e.search(e.config.filter?e.config.filter(n):n)},20)}),this.controls.input.on("blur",function(){setTimeout(function(){e.cancel()},300)}),this.controls.dropdown.add(this.controls.input).on("click",function(e){try{e.stopPropagation()}catch(t){e.cancelBubble=!0}return!1}),this.data("config",this.config)},reinit:function(){return this.config=this.data("config"),this.controls={dropdown:jQuery(".suggestFieldDropdown"),input:this.find("input.suggestField")},this},setupUx:function(){var e=this;this.controls.dropdown.find("li").on("click",function(){jQuery(this).trigger(":select")}).removeClass("highlighted").first(),this.currentLi=-1;var t=function(){e.controls.dropdown.find("li").removeClass("highlighted"),e.currentLi>=0&&e.controls.dropdown.find("li:eq("+e.currentLi+")").addClass("highlighted")};this.keyhandler||(this.keyhandler=function(n){var i=e.controls.dropdown.find("li").length;switch(n.keyCode){case 38:e.currentLi>=0&&e.currentLi--,t();break;case 40:e.currentLi<i-1&&e.currentLi++,t();break;case 13:e.currentLi>=0&&e.controls.dropdown.find("li:eq("+e.currentLi+")").trigger(":select"),e.controls.input.off("keydown",e.keyhandler);break;case 27:e.cancel(),e.controls.input.off("keydown",e.keyhandler);break;case 9:return e.currentLi>=0&&e.controls.dropdown.find("li:eq("+e.currentLi+")").trigger(":select"),e.controls.input.off("keydown",e.keyhandler),!0;default:return!0}try{n.stopPropagation(),n.preventDefault()}catch(r){n.cancelBubble=!0,n.returnValue=!1}return!1}),this.controls.input.off("keydown",this.keyhandler).on("keydown",this.keyhandler),jQuery(document).one("click",function(){e.cancel()})},search:function(e){if("undefined"==typeof this.lastpattern||this.lastpattern!=e){this.trigger("chess24:change"),this.lastpattern=e;var t=this;this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(function(){t.filterDropdown(e),t.request(e)},100)}},request:function(e){if(this.config.url){var t=this;if(this.lastxhr&&(this.lastxhr.abort(),this.lastxhr=null),!e.trim().length)return this.cancel();var n={pattern:e,csrf:config.csrf()};if(this.config.filters)for(var i=0;i<this.config.filters.length;i++){var r=jQuery("#"+this.config.filters[i]);r.length&&(n[r.attr("name")]=r.val())}this.lastxhr=jQuery.post(this.config.url,n,function(e){if("string"==typeof e)try{e=jQuery.parseJSON(e)}catch(n){e={status:1}}if(0==e.status){if(e.data.events)for(var i=0;i<e.data.events.length;i++)t.trigger("chess24:"+e.data.events[i]);t.render(e.data.result,e.data.template),t.lastxhr=null}})}},render:function(e,t){var n=this,i=this.controls.dropdown.find("ul");if(i.length||(i=jQuery("<ul/>").appendTo(this.controls.dropdown)),i.find("li").remove(),!e||Array.isArray(e)&&!e.length||Array.isArray(e.value)&&!e.value.length){var r=this.data("empty");if(!r)return void this.cancel();i.append(jQuery("<li/>").html(r)).show(),this.controls.dropdown.show()}else{for(var o=0;o<e.length;o++){var a=e[o].name;if(t&&(a=t,a=a.replace("{{.}}",e[o].value),"object"==typeof e[o].data))for(var s in e[o].data)a=a.replace("{{"+s+"}}",e[o].data[s]);jQuery("<li/>").html(a).data("value",e[o].value).on(":select",function(e,t){return function(){n.select(e,t)}}(e[o].value,e[o].name)).appendTo(i);!this.config.multiple&&this.updateValues&&e[o].name.toLowerCase()==this.controls.input.val().toLowerCase()&&this.select(e[o].value,e[o].name,!0)}i.show()}this.setupUx(),this.controls.dropdown.css({left:this.controls.input.offset().left+"px",top:this.controls.input.offset().top+this.controls.input.outerHeight()+"px"}).show()},reset:function(){this.config.multiple&&(this.controls.input.val("").focus(),this.lastpattern="")},cancel:function(){this.controls.dropdown.find("ul li").remove(),this.controls.dropdown.hide()},force:function(e){this.config.multiple&&","==e.substr(e.length-1)&&(e=e.substr(0,e.length-1));var t="",n=e.toLowerCase(),i=!1;this.controls.dropdown.find("li").each(function(){if(!i){var r=jQuery(this);r.text().toLowerCase()==n&&(t=r.data("value"),e=r.text(),i=!0)}}),this.select(t,e),this.reset()},item:function(e,t){var n=this,i=jQuery("<span/>").html(t).append(jQuery("<a/>").html("x").on("click",function(){return i.remove(),n.trigger("chess24:select"),n.adjust(),!1}));return e?(i.append(jQuery('<input type="hidden"/>').attr("name",this.attr("name")+"[]").val(e)),i.append(jQuery('<input type="hidden"/>').attr("name",this.attr("name").replace(/(\[|$)/,"_meta$1")+"[]").val(1)),i.append(jQuery('<input type="hidden"/>').attr("name",this.attr("name").replace(/(\[|$)/,"_label$1")+"[]").val(t))):this.config.strict?i.addClass("invalid"):(i.append(jQuery('<input type="hidden"/>').attr("name",this.attr("name")+"[]").val(t)),i.append(jQuery('<input type="hidden"/>').attr("name",this.attr("name").replace(/(\[|$)/,"_meta$1")+"[]").val(0)),i.append(jQuery('<input type="hidden"/>').attr("name",this.attr("name").replace(/(\[|$)/,"_label$1")+"[]").val(t))),this.config.clickable&&i.on("click",this.config.clickable),i},select:function(e,t,n,i){if(this.config.multiple){if(this.config.filter&&(e=this.config.filter(e),t=this.config.filter(t)),t.trim()){var r=this.item(e,t);this.controls.input.before(r),this.adjust()}i||this.reset()}else this.updateValues&&this.val(e),this.controls.input.val(t);this.trigger("chess24:select"),this.lastpattern=t,n||this.cancel()},adjust:function(){this.controls.input.css("width","30px"),this.controls.input.css("width",this.innerWidth()-(this.controls.input.offset().left-this.offset().left)-30+"px")},backspace:function(){this.config.multiple&&(this.find("span:last").remove(),this.trigger("chess24:select"),this.adjust())},filterDropdown:function(e){var t=this,n=jQuery("nothing");this.updateValues&&this.val(""),this.controls.dropdown.find("ul li").each(function(){var i=jQuery(this);t.config.multiple||i.text().toLowerCase()!=e.toLowerCase()?i.text().toLowerCase().substr(0,e.length)!=e.toLowerCase()&&(n=n.add(this)):t.select(i.data("value"),i.text(),!t.config.multiple)}),n.remove(),this.currentLi=-1,0==this.controls.dropdown.find("ul li").length?this.controls.dropdown.hide():this.controls.dropdown.find("li").removeClass("highlighted")},add:function(e){e&&e.value&&e.name&&(this.select(e.value,e.name,!1,!0),this.adjust())},values:function(e){return this.config.multiple&&e?[].slice.apply(this.find('[name="'+this.attr("name")+'[]"]').map(function(){return this.value})):void 0},empty:function(){this.config.multiple&&this.find("span").remove()},clickable:function(e){var t=this;e===!1?(this.removeClass("clickable"),this.find("span").off("click"),this.config.clickable=void 0):"function"==typeof e&&(this.addClass("clickable"),this.config.clickable=function(){var n=jQuery(this),i=n.find('input[name="'+t.attr("name")+'[]"]').val(),r=n.find('input[name="'+t.attr("name")+'_label[]"]').val();e(i,r)},this.find("span").on("click",this.config.clickable))},filter:function(e){"function"==typeof e&&(this.config.filter=e)}};jQuery.fn.suggestField=function(t){if(t){if(!this.data("pattern-lookup"))return this;if("add"==t)jQuery.extend(this,e).reinit().add(arguments[1]);else if("adjust"==t)jQuery.extend(this,e).reinit().adjust();else{if("count"==t)return this.find("span").length;if("values"==t)return jQuery.extend(this,e).reinit().values(arguments[1]);"empty"==t?jQuery.extend(this,e).reinit().empty():"clickable"==t?jQuery.extend(this,e).reinit().clickable(arguments[1]):"filter"==t&&jQuery.extend(this,e).reinit().filter(arguments[1])}}else this.each(function(){var t=jQuery(this);return t.data("pattern-lookup")?this:(jQuery.extend(t,e).init(),void t.data("pattern-lookup",!0))});return this}}),jQuery.fn.suspendResume=function(e){Array.isArray(e)||(e=Array.convert(arguments)),e=e.filter(function(e){var t="object"==typeof e&&"function"==typeof e.resume&&"function"==typeof e.suspend;return t||errorHandler.warning("object is not a suspendable",{view:e}),t}),e.length&&(this.on("chess24:show",function(t){e.forEach(function(e){e.resume()}),t.stopPropagation()}),this.on("chess24:hide",function(t){e.forEach(function(e){e.suspend()}),t.stopPropagation()}),this.trigger(this.is("section.active,:not(section):visible")?"chess24:show":"chess24:hide"))},function(){var e=[{header:!0,cells:[{text:"",params:{bold:!0}},{text:"",params:{bold:!0}},{text:"",params:{bold:!0}}]},{header:!1,cells:[{text:"",params:{}},{text:"",params:{}},{text:"",params:{}}]},{header:!1,cells:[{text:"",params:{}},{text:"",params:{}},{text:"",params:{}}]}],t=[{name:"Rating table",data:[{header:!0,cells:[{text:"Rank",params:{width:8,center:!0,bold:!0}},{text:"Name",params:{width:65,bold:!0}},{text:"Rating",params:{width:9,center:!0,bold:!0}},{text:"Points",params:{width:9,center:!0,bold:!0}},{text:"Perf",params:{width:9,center:!0,bold:!0}}]},{header:!1,cells:[{text:"1",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"2",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"3",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"4",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"5",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"6",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"7",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"8",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"9",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"10",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]}]},{name:"Tournament 4x4",data:[{header:!0,cells:[{text:"#",params:{width:7,bold:!0,center:!0}},{text:"Name",params:{width:40,bold:!0}},{text:"Rtg",params:{width:9,bold:!0,center:!0}},{text:"Perf",params:{width:9,bold:!0,center:!0}},{text:"1",params:{width:5.5,bold:!0,center:!0}},{text:"2",params:{width:5.5,bold:!0,center:!0}},{text:"3",params:{width:5.5,bold:!0,center:!0}},{text:"4",params:{width:5.5,bold:!0,center:!0}},{text:"Pts",params:{width:6.5,bold:!0,center:!0}},{text:"SB",params:{width:6.5,bold:!0,center:!0}}]},{header:!1,cells:[{text:"1",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,empty:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"2",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,empty:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"3",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,empty:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"4",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,empty:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]}]},{name:"Tournament 6x6",data:[{header:!0,cells:[{text:"#",params:{width:5,bold:!0,empty:!1,center:!0}},{text:"Name",params:{width:34,bold:!0,center:!0}},{text:"Rtg",params:{width:7.5,bold:!0,center:!0}},{text:"Perf",params:{width:7.5,bold:!0,center:!0}},{text:"1",params:{width:5.5,bold:!0,center:!0}},{text:"2",params:{width:5.5,bold:!0,center:!0}},{text:"3",params:{width:5.5,bold:!0,center:!0}},{text:"4",params:{width:5.5,bold:!0,center:!0}},{text:"5",params:{width:5.5,bold:!0,center:!0}},{text:"6",params:{width:5.5,bold:!0,center:!0}},{text:"Pts",params:{width:6.5,bold:!0,center:!0}},{text:"SB",params:{width:6.5,bold:!0,center:!0}}]},{header:!1,cells:[{text:"1",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,empty:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"2",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,empty:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"3",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,empty:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"4",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,empty:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"5",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,empty:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"6",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,empty:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]}]},{name:"Tournament 8x8",data:[{header:!0,cells:[{text:"#",params:{width:4.5,bold:!0,empty:!1,center:!0}},{text:"Name",params:{width:27,bold:!0,center:!0}},{text:"Rtg",params:{width:7.5,bold:!0,center:!0}},{text:"Perf",params:{width:7.5,bold:!0,center:!0}},{text:"1",params:{width:5,bold:!0,center:!0}},{text:"2",params:{
width:5,bold:!0,center:!0}},{text:"3",params:{width:5,bold:!0,center:!0}},{text:"4",params:{width:5,bold:!0,center:!0}},{text:"5",params:{width:5,bold:!0,center:!0}},{text:"6",params:{width:5,bold:!0,center:!0}},{text:"7",params:{width:5,bold:!0,center:!0}},{text:"8",params:{width:5,bold:!0,center:!0}},{text:"Pts",params:{width:6.5,bold:!0,center:!0}},{text:"SB",params:{width:7,bold:!0,center:!0}}]},{header:!1,cells:[{text:"1",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,empty:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"2",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,empty:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"3",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,empty:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"4",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,empty:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"5",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,empty:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"6",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,empty:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"7",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,empty:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"8",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,empty:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]}]},{name:"Tournament 10x10",data:[{header:!0,cells:[{text:"#",params:{width:4.5,bold:!0,center:!0}},{text:"Name",params:{width:27,bold:!0,center:!0}},{text:"Rtg",params:{width:8,bold:!0,center:!0}},{text:"Perf",params:{width:7.5,bold:!0,center:!0}},{text:"1",params:{width:4,bold:!0,center:!0}},{text:"2",params:{width:4,bold:!0,center:!0}},{text:"3",params:{width:4,bold:!0,center:!0}},{text:"4",params:{width:4,bold:!0,center:!0}},{text:"5",params:{width:4,bold:!0,center:!0}},{text:"6",params:{width:4,bold:!0,center:!0}},{text:"7",params:{width:4,bold:!0,center:!0}},{text:"8",params:{width:4,bold:!0,center:!0}},{text:"9",params:{width:4,bold:!0,center:!0}},{text:"0",params:{width:4,bold:!0,center:!0}},{text:"Pts",params:{width:6,bold:!0,center:!0}},{text:"SB",params:{width:7,bold:!0,center:!0}}]},{header:!1,cells:[{text:"1",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,empty:!0}},{text:"",params:{center:!0,width:4}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,width:4}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,width:4}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"2",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,width:4,empty:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,width:4}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,width:4}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"3",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,width:4}},{text:"",params:{center:!0,empty:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,width:4}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,width:4}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"4",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,width:4}},{text:"",params:{center:!0}},{text:"",params:{center:!0,empty:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,width:4}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,width:4}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"5",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,width:4}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,empty:!0}},{text:"",params:{center:!0,width:4}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,width:4}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"6",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,width:4}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,width:4,empty:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,width:4}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"7",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,width:4}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,width:4}},{text:"",params:{center:!0,empty:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,width:4}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"8",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,width:4}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,width:4}},{text:"",params:{center:!0}},{text:"",params:{center:!0,empty:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,width:4}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"9",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,width:4}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,width:4}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,empty:!0}},{text:"",params:{center:!0,width:4}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"10",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,width:4}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,width:4}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:" ",params:{center:!0}},{text:"",params:{center:!0,width:4,empty:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]}]},{name:"Tournament 12x12",data:[{header:!0,cells:[{text:"#",params:{width:4,bold:!0,center:!0}},{text:"Name",params:{width:22,bold:!0}},{text:"Rtg",params:{width:7.5,bold:!0,center:!0}},{text:"Perf",params:{width:6.5,bold:!0,center:!0}},{text:"1",params:{width:4,bold:!0,center:!0}},{text:"2",params:{width:4,bold:!0,center:!0}},{text:"3",params:{width:4,bold:!0,center:!0}},{text:"4",params:{width:4,bold:!0,center:!0}},{text:"5",params:{width:4,bold:!0,center:!0}},{text:"6",params:{width:4,bold:!0,center:!0}},{text:"7",params:{width:4,bold:!0,center:!0}},{text:"8",params:{width:4,bold:!0,center:!0}},{text:"9",params:{width:4,bold:!0,center:!0}},{text:"0",params:{width:4,bold:!0,center:!0}},{text:"1",params:{width:4,bold:!0,center:!0}},{text:"2",params:{width:4,bold:!0,center:!0}},{text:"Pts",params:{width:4.5,bold:!0}},{text:"SB",params:{width:7.5,bold:!0,center:!0}}]},{header:!1,cells:[{text:"1",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,empty:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"2",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,empty:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"3",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,empty:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"4",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,empty:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"5",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,empty:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"6",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,empty:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"7",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,empty:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"8",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,empty:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"9",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,empty:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"10",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,empty:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"11",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,empty:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]},{header:!1,cells:[{text:"12",params:{center:!0}},{text:"",params:{}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0,empty:!0}},{text:"",params:{center:!0}},{text:"",params:{center:!0}}]}]}],n=function(e){var t;return{data:function(n){if("object"==typeof n)e.attr("data",jQuery.toJSON(n)),t=n;else{if(t)return t;n=e.attr("data"),n=n?jQuery.parseJSON(n):{}}return t=n,n},set:function(e,n){t=this.data(),t[e]=n,this.data(t)},get:function(e){return this.data()[e]},bold:function(t){return 0==arguments.length?!!this.get("bold"):(this.set("bold",!!t),void e.css("font-weight",t?"bold":""))},center:function(t){return 0==arguments.length?!!this.get("center"):(this.set("center",!!t),void e.css("text-align",t?"center":""))},empty:function(t){return 0==arguments.length?!!this.get("empty"):(this.set("empty",!!t),t&&e.html(""),e.css("background-color",t?"#999999":""),void 0)},width:function(e){return 0==arguments.length?this.get("width"):void this.set("width",e)},colspan:function(e){return 0==arguments.length?this.get("colspan")||1:void this.set("colspan",parseInt(e))},link:function(t){return 0==arguments.length?this.get("link"):void(t?(this.set("link",t),e.find("a,span").replaceWith(jQuery("<a/>").attr("href","javascript:void(0)").append(e.find("a,span").contents()))):(this.set("link",!1),e.find("a,span").replaceWith(jQuery("<span/>").append(e.find("a,span").contents()))))},flag:function(t){return 0==arguments.length?this.get("flag"):("undefined"==typeof t?e.find("span,a").removeClass():e.find("span,a").html("").addClass("icoFlag flag-"+(t||e.text())),void this.set("flag",t))},left:function(){var t=e.prevAll(".widget-table-cell:first");return t.length?t:null},right:function(){var t=e.nextAll(".widget-table-cell:first");return t.length?t:null},refresh:function(){this.link(this.link()),this.flag(this.flag()),this.center(this.center()),this.bold(this.bold()),this.empty(this.empty())}}},i={currentcell:[-1,-1,null],multiselect:[],editing:null,calculateCliche:function(){var e=this,t=this.tableWidth;e.cliche=[],e.find(".widget-table-row").each(function(){var i=0;jQuery(this).find(".widget-table-cell").each(function(){if(!e.cliche[i]){var r=n(jQuery(this));1==r.colspan()?(r.width()?e.cliche[i]=t*r.width()/100:e.cliche[i]=0,i++):i+=r.colspan()}})});for(var i=0,r=0;r<e.cliche.length;r++)e.cliche[r]?t-=e.cliche[r]:i++;for(var r=0;r<e.cliche.length;r++)e.cliche[r]||(e.cliche[r]=Math.round(t/i));return e},adjustCliche:function(){for(var e=0,t=0;t<this.cliche.length;t++)e+=this.cliche[t];for(var n=e/this.tableWidth,t=0;t<this.cliche.length;t++)this.cliche[t]=Math.round(this.cliche[t]/n);return this},alignCells:function(){var e=this,t=e.find(".widget-table-intercell:first").width()||3;e.adjustCliche();for(var i=[],r=0;r<this.cliche.length;r++)i.push(this.cliche[r]);for(var o=this.tableWidth-(i.length-1)*t,a=this.tableWidth/o,r=0;r<i.length;r++)i[r]=Math.floor(i[r]/a);var s=!0;e.find(".widget-table-row").each(function(){var e=jQuery(this),r=0;e.find(".widget-table-cell").each(function(){var e=jQuery(this),a=n(e);if(a.colspan()>1){for(var s=(a.colspan()-1)*t,l=0;l<a.colspan();l++)s+=i[r+l];e.css("width",s+"px"),r+=a.colspan()}else e.css("width",i[r]+"px"),a.width(i[r]/o*100),r++}),s=!s});var l=0,r=0;return e.find(".widget-table-removecolumn").each(function(e){jQuery(this).css("left",Math.round(l+i[r]/2-jQuery(this).width()/2)+"px"),l+=i[r]+t,r++}),e},setupDragging:function(){var e,t,i,r=this,o=function(n){if(t){var o=n.clientX-e;r.cliche[i]+o>10&&r.cliche[i+1]-o>10&&(r.cliche[i]+=o,r.cliche[i+1]-=o,r.adjustCliche(),r.alignCells(),e+=o)}},a=function(){e=void 0,t=void 0,r.off("dragmove").css("cursor",""),r.setupControls(),r.dump()};return r.find(".widget-table-intercell").attr("draggable",!0).off("mousedown").on("mousedown",function(s){t=jQuery(this),i=-1;for(var l=t.closest(".widget-table-row").find(".widget-table-cell"),c=0;c<l.length;c++){var d=jQuery(l.get(c)),u=n(d);if(i+=u.colspan(),d.next().is(t))break}e=s.clientX,r.off("mousemove").on("mousemove",o).css("cursor","w-resize"),jQuery(document).one("mouseup",a);try{s.preventDefault()}catch(h){s.returnValue=!1}return!1}),r},setupEditing:function(){var e=this;return e.find(".widget-table-cell").each(function(){var e=jQuery(this);if(!e.find("input").length&&!e.find("span,a").length){var t=n(e);t.link()?e.append(jQuery('<a href="javascript:void(0)"/>').html(e.contents())):e.append(jQuery("<span/>").html(e.contents())),void 0!==t.flag()&&t.flag(e.text()||t.flag())}}),e.find(".widget-table-cell").off("click").on("click",function(){var t=jQuery(this),i=0;t.prevAll(".widget-table-cell").each(function(){i+=n(jQuery(this)).colspan()});var r=t.closest(".widget-table-row").prevAll(".widget-table-row").length;e.selectCell(i,r),e.startEdit()}),e},setupControls:function(){var e=this,i=!0;e.find(".widget-table-row").each(function(){jQuery(this)[i?"addClass":"removeClass"]("odd")[i?"removeClass":"addClass"]("even"),i=!i});for(var r=e.find(".widget-table-intercell:first").width()||3,o=[],a=0;a<this.cliche.length;a++)o.push(this.cliche[a]);for(var s=this.tableWidth-(o.length-1)*r,l=this.tableWidth/s,a=0;a<o.length;a++)o[a]=Math.floor(o[a]/l);var c=function(t){var n=Widgets.Table().keys;if(jQuery(t.target).is("input")||jQuery(t.target).is(".paste-div"))return!0;if(!t.altKey&&t.keyCode!=n.VK_F1&&t.keyCode!=n.VK_F2&&t.keyCode!=n.VK_F3&&t.keyCode!=n.VK_F4&&t.keyCode!=n.VK_F5&&t.keyCode!=n.VK_F6&&t.keyCode!=n.VK_F7&&t.keyCode!=n.VK_F8&&t.keyCode!=n.VK_F9&&t.keyCode!=n.VK_F10&&t.keyCode!=n.VK_F11&&t.keyCode!=n.VK_F12){e.keypress(t.keyCode,t.charCode,t.shiftKey,t.ctrlKey);try{t.stopPropagation(),t.preventDefault()}catch(i){t.cancelBubble=!0,t.returnValue=!1}}};jQuery(document).off("keydown.tablebuilder").on("keydown.tablebuilder",c),jQuery(document).on("mousedown.tablebuilder",function(e){jQuery(e.target).is(".editor-dialog")||jQuery(e.target).closest(".editor-dialog").length>0||jQuery(document).off("keydown.tablebuilder",c)}),e.off("mousedown").on("mousedown.tablebuilder",function(e){jQuery(document).off("keydown.tablebuilder",c).on("keydown.tablebuilder",c);try{e.cancelBubble=!0,e.stopPropagation()}catch(t){}});var d=parseInt(e.css("padding-top"))||0;e.find(".widget-table-removerow, .widget-table-removecolumn, .widget-table-addrow, .widget-table-addcolumn, .widget-table-makeheader").remove();var u=0,h=e.find(".widget-table-row").length,f=e.find(".nativeScrollInsider");if(e.find(".widget-table-row").each(function(t){var i=jQuery(this);f.append(jQuery('<a class="widget-table-makeheader"/>').addClass(i.hasClass("widget-table-header")?"highlighted":"").on("click",function(){i.toggleClass("widget-table-header");var t=i.hasClass("widget-table-header");i.find(".widget-table-cell").each(function(){n(jQuery(this)).bold(!!t)}),jQuery(this).toggleClass("highlighted"),e.setupControls().dump()}).css("top",d+4+t*i.height()+"px")),h>1&&f.append(jQuery('<a class="widget-table-removerow"/>').on("click",function(){i.height();t==e.currentcell[1]&&(i.next(".widget-table-row").length?e.moveSelectCell(0,1):e.moveSelectCell(0,-1)),i.remove(),e.setupControls().dump()}).css("top",d+4+t*i.height()+"px"))}),e.cliche.length>1){u=0;for(var p=0;p<e.cliche.length;p++)e.append(jQuery('<a class="widget-table-removecolumn"/>').on("click",function(t){return function(){e.cliche.splice(t,1),e.find(".widget-table-row").each(function(){for(var i=-1,r=jQuery(this).find(".widget-table-cell"),o=0;o<r.length&&(i+=n(r.eq(o)).colspan(),!(i>=t));o++);var a=jQuery(this).find(".widget-table-cell:eq("+o+")"),s=n(a);return s.colspan()>1?void s.colspan(s.colspan()-1):(o==e.currentcell[0]&&(a.next(".widget-table-cell").length?e.moveSelectCell(1,0):e.moveSelectCell(-1,0)),a.next().hasClass("widget-table-intercell")?a.next().remove():a.prev().hasClass("widget-table-intercell")&&a.prev().remove(),void a.remove())}),e.adjustCliche().alignCells().setupDragging().setupEditing().setupControls().dump()}}(p)).css("left",u+o[p]/2-12.5+"px")),u+=o[p]+r}e.append(jQuery('<a class="widget-table-addcolumn"/>').on("click",function(){e.cliche.push(100),e.find(".widget-table-row").each(function(){var e=jQuery(this);e.append(jQuery('<div class="widget-table-intercell"/>')),e.append(jQuery('<div class="widget-table-cell"/>'))}),e.adjustCliche().alignCells().setupDragging().setupEditing().setupControls().dump()}).css("right",e.cliche[e.cliche.length-1]/2+60+"px")),e.append(jQuery('<a class="widget-table-addrow"/>').on("click",function(){var t=e.find(".widget-table-row:last");t.clone(!0).removeClass("widget-table-header").appendTo(e.find(".widget-table")).find(".widget-table-cell").html(""),t.find(".highlighted").length&&e.moveSelectCell(0,1),e.setupEditing().setupDragging().setupControls().dump().scrollTop(e.find(".widget-table").height()),jQuery(document).trigger("newhtml")}));var m;e.controlbar.find(".widget-table-paste").off("click").on("click",function(t){if(m&&m.closest(".bubble").is(":visible"))return void m.bubble("hide");m||(m=jQuery("<div/>").addClass("widget-table-paste").append(jQuery("<div/>").addClass("paste-div-comment").html(window.t("Paste the table here..."))).append(jQuery("<div/>").addClass("paste-div")).append(jQuery("<div/>").addClass("paste-div-checkbox").html('<input type="checkbox" name="onlydata"/> '+window.t("Only get data"))).append(jQuery("<div/>").addClass("paste-buttons").append(jQuery("<a/>").addClass("cBtn cBtnWhite").html(window.t("Cancel")).on("click",function(){m.bubble("hide")}))).bubble({align:this,side:"bottom",flexible:!0,point:"precise"}));var n=m.find(".paste-div");m.bubble("show",function(){n.html("").focus()}),e.hideProgress(),m.find(".paste-div-comment, .paste-div-checkbox").show().off("click").on("click",function(){n.html("").focus()}),jQuery(document).trigger("newhtml"),n.attr("contenteditable","true").html("").show(),n.off("paste").on("paste",function(){setTimeout(function(){n.hide(),m.find(".paste-div-comment, .paste-div-checkbox").hide();var t=m.find(".paste-div-checkbox input").is(":checked");t?e.loadTableData(n.html()):e.loadTable(n.html()),m.bubble("hide")},200)});try{t.stopPropagation()}catch(i){t.cancelBubble=!0}}).off("mousedown").on("mousedown",function(e){try{e.cancelBubble=!0,e.stopPropagation()}catch(t){}});var g;return e.controlbar.find(".widget-table-templates").off("click").on("click",function(n){if(g&&"block"==g.css("display"))return void g.bubble("hide",function(){g.closest(".bubble").remove().end().remove(),g=null});g=jQuery("<div/>").css("padding","10px");for(var i=0;i<t.length;i++)g.append(jQuery("<a/>").addClass("editor-dialog-widget").html(t[i].name).on("click",function(n){return function(i){e.loadJson(t[n].data),g.bubble("hide",function(){g.closest(".bubble").remove().end().remove(),g=null});try{i.cancelBubble=!0,i.stopPropagation()}catch(r){}}}(i)));g.bubble({align:jQuery(this),side:"bottom",point:"precise",flexible:!0}).bubble("show");try{n.stopPropagation()}catch(r){n.cancelBubble=!0}}),e},setupToolbar:function(){var e=this,t={bold:{name:window.t("bold"),icon:"bold.png",onclick:function(){var e=n(this);e.bold(!e.bold())},check:function(){return!!n(this).bold()}},link:{name:window.t("link"),icon:"link.png",onclick:function(){var t=n(this),i=this,r=jQuery("<div/>").css("padding","10px").on("mousedown click",function(e){try{e.cancelBubble=!0,e.stopPropagation()}catch(t){}});return r.append(jQuery('<input type="text"/>').val(t.link()||"http://").attr("size","30")),r.append(jQuery("<a/>").addClass("button-blue").html("Save").on("click",function(e){t.link(r.find("input").val()),r.bubble("hide"),i.trigger("click");try{e.cancelBubble=!0,e.stopPropagation()}catch(n){}})),r.append(jQuery("<a/>").addClass("button-blue").html("Delete").on("click",function(e){t.link(void 0),r.bubble("hide").remove(),i.trigger("click");try{e.cancelBubble=!0,e.stopPropagation()}catch(n){}})),e.one("mousedown",function(){r.bubble("hide").remove()}),r.bubble({align:this,side:"bottom",point:"precise"}).bubble("show"),r.find("input").focus(),!0},check:function(){return!!n(this).link()},available:function(){return 0==e.multiselect.length}},center:{name:window.t("center"),icon:"aligncenter.png",onclick:function(){var e=n(this);e.center(!e.center())},check:function(){return!!n(this).center()}},flag:{name:window.t("flag"),icon:"flag.png",onclick:function(){var e=n(this);e.flag(e.flag()?void 0:this.text()||"")},check:function(){return void 0!==n(this).flag()}},empty:{name:window.t("empty"),icon:"empty.png",onclick:function(){var t=n(this);t.empty(!t.empty()),t.empty()&&t.flag(void 0),e.setupEditing()},check:function(){return n(this).empty()}},spanleft:{name:"&larr;",icon:"spanleft.png",onclick:function(){var t=n(this);t.left()&&(t.colspan(t.colspan()+n(t.left()).colspan()),t.left().remove(),this.prev(".widget-table-intercell").remove(),e.currentcell[0]--,e.alignCells())},available:function(){return 0==e.multiselect.length&&!!n(this).left()}},spanright:{name:"&rarr;",icon:"spanright.png",onclick:function(){var t=n(this);t.right()&&(t.colspan(t.colspan()+n(t.right()).colspan()),t.right().remove(),this.next(".widget-table-intercell").remove(),e.alignCells())},available:function(){return 0==e.multiselect.length&&!!n(this).right()}},unspanleft:{name:"&rarr;",icon:"unspanleft.png",onclick:function(){var t=n(this);if(1!=t.colspan()){t.colspan(t.colspan()-1);var i=jQuery("<div/>").addClass("widget-table-cell"),r=jQuery("<div/>").addClass("widget-table-intercell");this.before(i).before(r),e.currentcell[0]++,e.alignCells().setupEditing().setupDragging()}},available:function(){return 0==e.multiselect.length&&n(this).colspan()>1}},unspanright:{name:"&larr;",icon:"unspanright.png",onclick:function(){var t=n(this);if(1!=t.colspan()){t.colspan(t.colspan()-1);var i=jQuery("<div/>").addClass("widget-table-cell"),r=jQuery("<div/>").addClass("widget-table-intercell");this.after(i).after(r),e.alignCells().setupEditing().setupDragging()}},available:function(){return 0==e.multiselect.length&&n(this).colspan()>1}}};e.find(".widget-table-toolbar").remove();var i=jQuery('<div class="widget-table-toolbar"/>').prependTo(e),r=!1;for(var o in t)jQuery("<a/>").html('<img src="'+config.assetDir()+"/images/editor/toolbar/"+t[o].icon+'"/>').on("mousedown",function(){r=!!e.editing}).on("click",function(n){return function(o){if(e.multiselect.length)for(var a=0;a<e.multiselect.length;a++)t[n].onclick.call(e.multiselect[a][2]);else{var s=t[n].onclick.call(e.currentcell[2]);!s&&r&&e.startEdit()}e.dump(),i.find("a").trigger("highlight");try{o.stopPropagation()}catch(l){o.cancelBubble=!0}return!1}}(o)).on("highlight",function(n){return function(){e.currentcell&&e.currentcell[2]&&(t[n].check&&jQuery(this)[t[n].check.call(e.currentcell[2])?"addClass":"removeClass"]("highlighted"),t[n].available&&jQuery(this)[t[n].available.call(e.currentcell[2])?"removeClass":"addClass"]("disabled"))}}(o)).appendTo(i);return e},updateToolbar:function(e){return this.find(".widget-table-toolbar a").trigger("highlight"),this},loadTable:function(e){var t=this,i=jQuery("<div/>").html(e).css({position:"absolute",left:"-10000px",top:"-10000px"}).appendTo("body"),r=t.find(".widget-table").hide(),o=i.find("table:first");
if(!o.length)return t.showMessage(window.t("No table found, make sure you copied it.")),i.remove(),void r.show();t.find(".widget-table-row").remove();var a=o.width(),s=i.find("table:first tr"),l=s.length,c=0,d=function(e){var i=e.first(),o=jQuery("<div/>").addClass("widget-table-row").appendTo(r);i.find("td,th").each(function(){var e=jQuery(this),t=jQuery("<div/>").addClass("widget-table-cell").appendTo(o).html(e.html());e.next().is("td,th")&&jQuery("<div/>").addClass("widget-table-intercell").appendTo(o);var i,r=n(t);(i=parseInt(e.css("width")))&&r.width(i/a*100),(i=e.attr("width"))&&(i.match(/%$/)?r.width(parseInt(i)):r.width(parseInt(i)/a*100)),("center"==e.css("text-align")||e.find("center").length)&&r.center(!0),("bold"==e.css("font-weight")||e.find("b").length)&&r.bold(!0),(i=parseInt(e.attr("colspan")))&&r.colspan(i),(i=e.find("a"))&&(i=i.attr("href"))&&r.link(i),e.is("th")&&(r.bold(!0),o.addClass("widget-table-header"));var s=e.find("> div");if(s.length){var l=s.attr("class").match(/^tn_(\w\w\w)$/);l&&r.flag(l[1].toLowerCase())}t.find("*").each(function(){jQuery(this).is("a")||jQuery(this).replaceWith(jQuery(this).contents())})}),i.remove(),e=e.slice(1),e.length?setTimeout(function(){d(e)},10):u(),c++,t.showProgress(c/l*100)};d(s);var u=function(){i.remove(),r.show(),t.hideProgress(),t.calculateCliche().alignCells().setupDragging().setupEditing().setupControls().dump().selectCell(0,0),jQuery(document).trigger("newhtml")};return t},loadTableData:function(e){var t=this,i=jQuery("<div/>").html(e).css({position:"absolute",left:"-10000px",top:"-10000px"}).appendTo("body"),r=t.find(".widget-table").hide(),o=i.find("table:first");if(!o.length)return t.showMessage(window.t("No table found, make sure you copied it.")),i.remove(),void r.show();var a=i.find("table:first tr"),s=a.length,l=0,c=function(){i.remove(),r.show(),t.hideProgress(),t.setupEditing().dump().selectCell(0,0),jQuery(document).trigger("newhtml")},d=function(e){var i=e.first(),r=t.find(".widget-table-row:eq("+l+")");if(!r.length)return c();var o=0;i.find("td,th").each(function(){var e=jQuery(this),t=r.find(".widget-table-cell:eq("+o++ +")").html(e.html());if(!t.length)return c();var i,a=n(t);("center"==e.css("text-align")||e.find("center").length)&&a.center(!0),("bold"==e.css("font-weight")||e.find("b").length)&&a.bold(!0),(i=e.find("a"))&&(i=i.attr("href"))&&a.link(i),t.find("*").each(function(){jQuery(this).is("a")?a.link(jQuery(this).attr("href")):jQuery(this).replaceWith(jQuery(this).contents())})}),i.remove(),e=e.slice(1),e.length?setTimeout(function(){d(e)},10):c(),l++,t.showProgress(l/s*100)};return d(a),t},loadJson:function(e){var t=this,i=t.find(".widget-table").hide();t.find(".widget-table-row").remove();var r=e.length,o=0,a=function(e){var l=e[0],c=jQuery("<div/>").addClass("widget-table-row").appendTo(i);l.header&&c.addClass("widget-table-header");for(var d=0;d<l.cells.length;d++){var u=l.cells[d].params;l.cells[d].text=l.cells[d].text&&l.cells[d].text.replace(/%26/g,"&").replace(/%3E/g,">").replace(/%3C/g,"<"),u.link=u.link&&u.link.replace(/%26/g,"&").replace(/%3E/g,">").replace(/%3C/g,"<");var h=jQuery("<div/>").addClass("widget-table-cell").appendTo(c).text((l.cells[d].text||"").replace("&nbsp;","")),f=n(h);d<l.cells.length-1&&jQuery("<div/>").addClass("widget-table-intercell").appendTo(c),f.data(u),u.center&&f.center(!0),(u.bold||l.header)&&f.bold(!0),u.empty&&f.empty(!0)}e=e.slice(1),e.length?setTimeout(function(){a(e)},10):s(),o++,t.showProgress(o/r*100)};a(e);var s=function(){i.show(),t.hideProgress(),t.calculateCliche().alignCells().setupDragging().setupEditing().setupControls().dump().selectCell(0,0),jQuery(document).trigger("newhtml")};return t},fixTable:function(){},showMessage:function(e,t){var n=this;return e?(this.controlbar.find(".message").html(e).show(),t||setTimeout(function(){n.controlbar.find(".message").hide()},3e3),n):(this.controlbar.find(".message").hide(),this)},showProgress:function(e){return this.controlbar.find(".progress-bar").show().find("div").css({width:e+"%"}),this},hideProgress:function(){var e=this;return setTimeout(function(){e.controlbar.find(".progress-bar").hide()},20),this},dump:function(){var e=[],t=0;return this.find(".widget-table-row:first .widget-table-cell").each(function(){t+=jQuery(this).width()}),this.find(".widget-table-row").each(function(){var i={header:jQuery(this).hasClass("widget-table-header"),cells:[]};jQuery(this).find(".widget-table-cell").each(function(){var e=n(jQuery(this)).data();e.width=100*jQuery(this).width()/t,i.cells.push({text:jQuery(this).text(),params:e})}),e.push(i)}),this.target.val(jQuery.toJSON(e).replace(/\&/g,"%26").replace(/>/g,"%3E").replace(/</g,"%3C")),this},startEdit:function(e){var t=this;if(-1!=this.currentcell[0]&&-1!=this.currentcell[1]&&this.currentcell[2]&&this.currentcell[2].length){var i=this.currentcell[2];if(this.resetMultiselection(),this.updateToolbar(i),!(this.editing&&i.find(this.editing).length>0)){this.editing&&this.endEdit();var r=n(i);if(!r.empty()){var o=r.flag()||i.text();this.editing=jQuery('<input type="text"/>').val(e||o).css({width:(i.find("span,a").width()||i.width()-10)+"px",height:i.find("span,a").height+"px","text-align":r.center()?"center":"","font-weight":r.bold()?"bold":""}).on("keydown",function(e){e.keyCode==Widgets.Table().keys.VK_RETURN?t.endEdit():e.keyCode==Widgets.Table().keys.VK_ESCAPE&&t.endEdit(o);try{e.cancelBubble=!0,e.stopPropagation()}catch(n){}}).on("blur",function(){t.endEdit()}),i.html("").append(this.editing);var a=this.editing.get(0);if("undefined"!=typeof a.selectionStart)a.selectionStart=a.value.length,a.selectionEnd=a.value.length;else if("function"==typeof a.createTextRange){var s=a.createTextRange();s.moveToElementText(a),s.collapse(!0)}return this.editing.focus(),t}}}},endEdit:function(e){var t=this;if(-1!=this.currentcell[0]&&-1!=this.currentcell[1]&&this.currentcell[2]&&this.currentcell[2].length){var i=this.currentcell[2],r=i.find("input");"undefined"==typeof e&&(e=r.val().replace(/</g,"&lt;").replace(/>/g,"&gt;"));var o=n(i);return void 0!==o.flag()&&o.flag(""==e?void 0:e),i.html(e),this.editing=null,this.setupEditing().dump(),t}},selectCell:function(e,t,i){if(!(0>e||0>t)){var r,o=-1,a=0;if(this.find(".widget-table-row:eq("+t+") .widget-table-cell").each(function(){o+=n(jQuery(this)).colspan(),!r&&o>=e&&(a=o-n(jQuery(this)).colspan()+1,r=jQuery(this))}),r){i?this.appendMultiselection([a,t,r]):(this.currentcell=[],this.resetMultiselection()),this.currentcell=[a,t,r],r.addClass("highlighted");var s=parseInt(this.css("padding-top")),l=s-this.find(".widget-table").position().top,c=r.position().top+s;c>this.outerHeight()-r.height()?this.scrollTop(l+(c-(this.outerHeight()-r.height()))):100>c&&this.scrollTop(Math.max(0,l-(100-c))),this.updateToolbar(r)}return this}},moveSelectCell:function(e,t,i){return-1==this.currentcell[0]||-1==this.currentcell[1]?this.selectCell(0,0):(e>0&&(e+=n(this.currentcell[2]).colspan()-1),this.selectCell(this.currentcell[0]+e,this.currentcell[1]+t,i)),this},appendMultiselection:function(e){var t=this;0==this.multiselect.length&&(this.msstart=this.currentcell),this.multiselect=[],this.find(".widget-table .highlighted").removeClass("highlighted");for(var i=Math.min(this.msstart[0],e[0]+n(e[2]).colspan()-1),r=Math.min(this.msstart[1],e[1]),o=Math.max(this.msstart[0],e[0]+n(e[2]).colspan()-1),a=Math.max(this.msstart[1],e[1]),s=r;a>=s;s++){var l=this.find(".widget-table-row:eq("+s+") .widget-table-cell"),c=0;l.each(function(){$this=jQuery(this),c>=i&&o>=c&&(t.multiselect.push([c,s,$this]),$this.addClass("highlighted")),c+=n($this).colspan()})}},resetMultiselection:function(){this.multiselect=[],this.find(".widget-table .highlighted").removeClass("highlighted"),this.currentcell[2]&&this.currentcell[2].addClass("highlighted")},keypress:function(e,t,i,r){var o=Widgets.Table().keys;switch(e){case o.VK_LEFT:this.moveSelectCell(-1,0,i);break;case o.VK_RIGHT:this.moveSelectCell(1,0,i);break;case o.VK_UP:this.moveSelectCell(0,-1,i);break;case o.VK_DOWN:this.moveSelectCell(0,1,i);break;case o.VK_DELETE:if(this.multiselect.length>0)for(var a=0;a<this.multiselect.length;a++){var s=n(this.multiselect[a][2]);s.flag()&&(s.flag(void 0),this.multiselect[a][2].find("span,a").removeClass()),this.multiselect[a][2].find("span,a").html("")}else if(this.currentcell[2]){var s=n(this.currentcell[2]);s.flag()&&(s.flag(void 0),this.currentcell[2].find("span,a").removeClass()),this.currentcell[2].find("span,a").html("")}this.dump();break;case o.VK_COPY:r&&(this.clipboard={data:n(this.currentcell[2]).data(),html:this.currentcell[2].html()});break;case o.VK_PASTE:r&&this.clipboard&&(this.currentcell[2].html(this.clipboard.html),n(this.currentcell[2]).data(this.clipboard.data),n(this.currentcell[2]).refresh(),this.updateToolbar(),this.dump());break;case o.VK_RETURN:this.startEdit()}return this}};jQuery.fn.tableBuilder=function(t,n,r){var o=this,a=jQuery.extend({},o,i);a.addClass("widget-table-builder"),a.after('<div class="clearfix"/>'),a.find(".widget-table").length||a.append(jQuery("<div/>").addClass("nativeScroll").append(jQuery("<div/>").addClass("nativeScrollInsider").append(jQuery("<div/>").addClass("widget-table")))),setTimeout(function(){jQuery(document).trigger("newhtml")},200),a.cliche=[],a.tableWidth=a.find(".nativeScrollInsider").width()-70,a.controlbar=a.next(".widget-table-controlbar"),a.controlbar.length||(a.controlbar=jQuery("<div/>").addClass("widget-table-controlbar").append(jQuery("<a/>").addClass("cBtn cBtnWhite widget-table-templates").html(window.t("Templates"))).append(jQuery("<a/>").addClass("cBtn cBtnWhite widget-table-paste").html(window.t("Paste"))).append(jQuery("<div/>").addClass("progress-bar").append(jQuery("<div/>"))).append(jQuery("<div/>").addClass("message")).insertBefore(a));var s=e;if(a.target=r||o.find("input[type=hidden]"),a.target.length){try{s=jQuery.parseJSON(a.target.val())}catch(l){}s||(s=e)}else a.target=jQuery("<input/>").attr("type","hidden").val(jQuery.toJSON(s)).appendTo(o);a.setupToolbar(),a.loadJson(s)}}(),function(){var e=0,t={width:150,height:140},n={init:function(){var e=this;if(this.container=jQuery("<div/>").addClass("thumbnail-builder").attr("id","builder-"+this.id).appendTo("body"),this.container.css({left:this.offset().left-jQuery(document).scrollLeft()+"px",top:this.offset().top-jQuery(document).scrollTop()+"px",width:this.width()+"px",height:this.height()+"px"}),this.covers={n:jQuery("<div/>").addClass("thumbnail-builder-cover").appendTo(this.container),e:jQuery("<div/>").addClass("thumbnail-builder-cover").appendTo(this.container),s:jQuery("<div/>").addClass("thumbnail-builder-cover").appendTo(this.container),w:jQuery("<div/>").addClass("thumbnail-builder-cover").appendTo(this.container)},this.container.closest(".bubble, .dialog").on("chess24:hide",function(t,n){n?e.container.remove():e.container.hide()}),this.body=jQuery("<div/>").addClass("thumbnail-builder-body").appendTo(this.container),this.drag=jQuery("<div/>").addClass("thumbnail-builder-move").appendTo(this.body).css({left:"10px",top:"10px"}),this.config.scale){this.scales={n:jQuery("<div/>").addClass("thumbnail-builder-scale scale-n").appendTo(this.body).data("side","n").css({left:"10px",top:"0px",height:"10px",cursor:"n-resize"}),nw:jQuery("<div/>").addClass("thumbnail-builder-scale scale-nw").appendTo(this.body).data("side","nw").css({left:"0px",top:"0px",width:"10px",height:"10px",cursor:"nw-resize"}),w:jQuery("<div/>").addClass("thumbnail-builder-scale scale-w").appendTo(this.body).data("side","w").css({left:"0px",top:"10px",width:"10px",cursor:"w-resize"}),sw:jQuery("<div/>").addClass("thumbnail-builder-scale scale-sw").appendTo(this.body).data("side","sw").css({left:"0px",bottom:"0px",width:"10px",height:"10px",cursor:"ne-resize"}),s:jQuery("<div/>").addClass("thumbnail-builder-scale scale-s").appendTo(this.body).data("side","s").css({left:"10px",bottom:"0px",height:"10px",cursor:"n-resize"}),se:jQuery("<div/>").addClass("thumbnail-builder-scale scale-se").appendTo(this.body).data("side","se").css({right:"0px",bottom:"0px",width:"10px",height:"10px",cursor:"nw-resize"}),e:jQuery("<div/>").addClass("thumbnail-builder-scale scale-e").appendTo(this.body).data("side","e").css({right:"0px",top:"10px",width:"10px",cursor:"w-resize"}),ne:jQuery("<div/>").addClass("thumbnail-builder-scale scale-ne").appendTo(this.body).data("side","ne").css({right:"0px",top:"0px",width:"10px",height:"10px",cursor:"ne-resize"})};for(var t in this.scales)this.scales[t].on("mousedown",function(t){e.startScale(t.clientX,t.clientY,jQuery(this).data("side"));try{t.cancelBubble=!0,t.stopPropagation()}catch(n){}}).on("dragstart",function(e){try{e.originalEvent.preventDefault(),e.originalEvent.stopPropagation()}catch(t){e.returnValue=!1,e.cancelBubble=!0}})}return this.drag.on("mousedown",function(t){e.startMove(t.clientX,t.clientY)}).on("dragstart",function(e){try{e.originalEvent.preventDefault(),e.originalEvent.stopPropagation()}catch(t){e.originalEvent.returnValue=!1,e.cancelBubble=!0}}),this.submit=jQuery("<a/>").addClass("thumbnail-builder-submit cBtnFlexi cBtnBlue").html("OK").appendTo(this.body).on("click",function(){e.submit.addClass("cBtnIcon cIconFileUploading disabled").off("click"),e.config.callback(e.config.left,e.config.top,e.config.width,e.config.height)}),this.config.left||(this.config.left=this.width()/2-this.config.width/2),this.config.top||(this.config.top=this.height()/2-this.config.height/2),this.update(),jQuery(window).on("resize",function(){e.container.css({left:e.offset().left-jQuery(document).scrollLeft()+"px",top:e.offset().top-jQuery(document).scrollTop()+"px"})}),e},update:function(){return this.body.css({left:this.config.left+"px",top:this.config.top+"px",width:this.config.width+"px",height:this.config.height+"px"}),this.covers.n.css({left:"0px",top:"0px",width:this.width()+"px",height:this.config.top+"px"}),this.covers.s.css({left:"0px",top:this.config.top+this.config.height+"px",width:this.width()+"px",height:this.height()-this.config.top-this.config.height+"px"}),this.covers.w.css({left:"0px",top:this.config.top+"px",width:this.config.left+"px",height:this.config.height+"px"}),this.covers.e.css({left:this.config.left+this.config.width+"px",top:this.config.top+"px",width:this.width()-this.config.left-this.config.width+"px",height:this.config.height+"px"}),this.submit.css({left:this.body.width()/2-this.submit.outerWidth()/2+"px",top:this.body.height()/2-this.submit.outerHeight()/2+"px"}),this.drag.css({width:this.config.width-20+"px",height:this.config.height-20+"px"}),this.config.scale&&(this.scales.n.css({width:this.config.width-20+"px"}),this.scales.s.css({width:this.config.width-20+"px"}),this.scales.e.css({height:this.config.height-20+"px"}),this.scales.w.css({height:this.config.height-20+"px"})),this},moveTo:function(e,t){this.config.left=Math.max(0,Math.min(this.container.width()-this.config.width,e)),this.config.top=Math.max(0,Math.min(this.container.height()-this.config.height,t)),this.update()},scaleTo:function(e,t,n,i){if("save-ratio"!=this.config.scale||!(50>e||50>t||e>=this.container.width()-this.config.left||t>=this.container.height()-this.config.top)){var r=Math.max(20,Math.min(this.container.width()-this.config.left,e)),o=Math.max(20,Math.min(this.container.height()-this.config.top,t)),a=r!=this.config.width,s=o!=this.config.height;this.config.width=r,this.config.height=o,this.moveTo(a&&n?n:this.config.left,s&&i?i:this.config.top)}},startMove:function(e,t){var n=this,i=this.config.left,r=this.config.top;return this.container.on("mousemove",function(o){var a=o.clientX-e,s=o.clientY-t;n.moveTo(i+a,r+s);try{o.stopPropagation(),o.preventDefault()}catch(l){o.cancelBubble=!0,o.returnValue=!1}return!1}),jQuery(document).one("mouseup",function(){n.endMove()}),this},endMove:function(){return this.container.off("mousemove"),this},startScale:function(e,t,n){var i=this,r=this.config.width,o=this.config.height,a=this.config.left,s=this.config.top,l="nw"==n||"w"==n||"sw"==n?-1:1,c="nw"==n||"n"==n||"ne"==n?-1:1;this.container.on("mousemove",function(d){var u="n"==n||"s"==n?0:d.clientX-e,h="w"==n||"e"==n?0:d.clientY-t,f=r+l*u,p=o+c*h;if("save-ratio"==i.config.scale){var m=i.config.width/i.config.height;Math.abs(u)>Math.abs(h)||"e"==n||"w"==n?p=f/m:f=p*m}var g=0>l?a-(f-r):void 0,v=0>c?s-(p-o):void 0;i.scaleTo(f,p,g,v);try{d.stopPropagation(),d.preventDefault()}catch(y){d.cancelBubble=!0,d.returnValue=!1}return!1}),jQuery(document).one("mouseup",function(){i.endScale()})},endScale:function(){this.container.off("mousemove")}};jQuery.fn.thumbnail=function(i){if(0==this.length)return this;if("hide"===i)return jQuery(".thumbnail-builder#builder-"+this.attr("builder-id")).remove(),this;var r=jQuery.extend({},this,n);return r.id=++e,r.config=jQuery.extend({},t,i),r.init(),this.attr("builder-id",r.id),this}}(),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){function t(e){if(e.minTime&&(e.minTime=v(e.minTime)),e.maxTime&&(e.maxTime=v(e.maxTime)),e.durationTime&&"function"!=typeof e.durationTime&&(e.durationTime=v(e.durationTime)),e.disableTimeRanges.length>0){for(var t in e.disableTimeRanges)e.disableTimeRanges[t]=[v(e.disableTimeRanges[t][0]),v(e.disableTimeRanges[t][1])];e.disableTimeRanges=e.disableTimeRanges.sort(function(e,t){return e[0]-t[0]})}return e}function n(t){var n=t.data("timepicker-settings"),i=t.data("timepicker-list");i&&i.length&&(i.remove(),t.data("timepicker-list",!1)),i=e("<ul />",{"class":"ui-timepicker-list"});var r=e("<div />",{"class":"ui-timepicker-wrapper",tabindex:-1});r.css({display:"none",position:"absolute"}).append(i),n.className&&r.addClass(n.className),(null!==n.minTime||null!==n.durationTime)&&n.showDuration&&r.addClass("ui-timepicker-with-duration");var o=n.minTime;"function"==typeof n.durationTime?o=v(n.durationTime()):null!==n.durationTime&&(o=n.durationTime);var a=null!==n.minTime?n.minTime:0,l=null!==n.maxTime?n.maxTime:a+w-1;a>=l&&(l+=w);for(var c=n.disableTimeRanges,d=0,u=c.length,h=a;l>=h;h+=60*n.step){var f=h%w,y=e("<li />");if(y.data("time",f),y.text(g(f,n.timeFormat)),(null!==n.minTime||null!==n.durationTime)&&n.showDuration){var b=e("<span />");b.addClass("ui-timepicker-duration"),b.text(" ("+m(h-o)+")"),y.append(b)}u>d&&(f>=c[d][0]&&f<c[d][1]?y.addClass("ui-timepicker-disabled"):f>=c[d][1]&&(d+=1)),i.append(y)}r.data("timepicker-input",t),t.data("timepicker-list",r);var k=n.appendTo;"string"==typeof k?k=e(k):"function"==typeof k&&(k=k(t)),k.append(r),s(t,i),i.on("click","li",function(n){t.off("focus.timepicker"),t.on("focus.timepicker-ie-hack",function(){t.off("focus.timepicker-ie-hack"),t.on("focus.timepicker",C.show)}),t[0].focus(),i.find("li").removeClass("ui-timepicker-selected"),e(this).addClass("ui-timepicker-selected"),p(t)&&r.hide()})}function i(){return new Date(1970,1,1,0,0,0)}function r(t){"ontouchstart"in document?e("body").on("touchstart.ui-timepicker",o):(e("body").on("mousedown.ui-timepicker",o),t.closeOnWindowScroll&&e(window).on("scroll.ui-timepicker",o))}function o(t){var n=e(t.target),i=n.closest(".ui-timepicker-input");0===i.length&&0===n.closest(".ui-timepicker-wrapper").length&&(C.hide(),e("body").unbind(".ui-timepicker"),e(window).unbind(".ui-timepicker"))}function a(t,n,i){if(!i&&0!==i)return!1;var r=t.data("timepicker-settings"),o=!1,a=30*r.step;return n.find("li").each(function(t,n){var r=e(n),s=r.data("time")-i;return Math.abs(s)<a||s==a?(o=r,!1):void 0}),o}function s(e,t){t.find("li").removeClass("ui-timepicker-selected");var n=v(c(e));if(n){var i=a(e,t,n);if(i){var r=i.offset().top-t.offset().top;(r+i.outerHeight()>t.outerHeight()||0>r)&&t.scrollTop(t.scrollTop()+i.position().top-i.outerHeight()),i.addClass("ui-timepicker-selected")}}}function l(){if(""!==this.value){var t=e(this),n=v(this.value);if(null===n)return void t.trigger("timeFormatError");var i=t.data("timepicker-settings");if(null!==i.minTime&&n<i.minTime?t.trigger("timeRangeError"):null!==i.maxTime&&n>i.maxTime&&t.trigger("timeRangeError"),e.each(i.disableTimeRanges,function(){return n>=this[0]&&n<this[1]?(t.trigger("timeRangeError"),!1):void 0}),i.forceRoundTime){var r=n%(60*i.step);r>=30*i.step?n+=60*i.step-r:n-=r}var o=g(n,i.timeFormat);d(t,o)}}function c(e){return e.is("input")?e.val():e.data("ui-timepicker-value")}function d(e,t){e.is("input")?e.val(t):e.data("ui-timepicker-value",t)}function u(t){var n=e(this),i=n.data("timepicker-list");if(!i||!i.is(":visible")){if(40!=t.keyCode)return h(t,n);n.focus()}switch(t.keyCode){case 13:return p(n)&&C.hide.apply(this),t.preventDefault(),!1;case 38:var r=i.find(".ui-timepicker-selected");return r.length?r.is(":first-child")||(r.removeClass("ui-timepicker-selected"),r.prev().addClass("ui-timepicker-selected"),r.prev().position().top<r.outerHeight()&&i.scrollTop(i.scrollTop()-r.outerHeight())):(i.find("li").each(function(t,n){return e(n).position().top>0?(r=e(n),!1):void 0}),r.addClass("ui-timepicker-selected")),!1;case 40:return r=i.find(".ui-timepicker-selected"),0===r.length?(i.find("li").each(function(t,n){return e(n).position().top>0?(r=e(n),!1):void 0}),r.addClass("ui-timepicker-selected")):r.is(":last-child")||(r.removeClass("ui-timepicker-selected"),r.next().addClass("ui-timepicker-selected"),r.next().position().top+2*r.outerHeight()>i.outerHeight()&&i.scrollTop(i.scrollTop()+r.outerHeight())),!1;case 27:i.find("li").removeClass("ui-timepicker-selected"),i.hide();break;case 9:C.hide();break;default:return h(t,n)}}function h(e,t){return!t.data("timepicker-settings").disableTextInput||e.ctrlKey||e.altKey||e.metaKey||2!=e.keyCode&&(e.keyCode<46||e.keyCode>90)}function f(t){var n=e(this),i=n.data("timepicker-list");if(!i||!i.is(":visible"))return!0;switch(t.keyCode){case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 65:case 77:case 80:case 186:case 8:case 46:s(n,i);break;default:return}}function p(e){var t=e.data("timepicker-settings"),n=e.data("timepicker-list"),i=null,r=n.find(".ui-timepicker-selected");if(r.hasClass("ui-timepicker-disabled"))return!1;if(r.length?i=r.data("time"):c(e)&&(i=v(c(e)),s(e,n)),null!==i){var o=g(i,t.timeFormat);d(e,o)}return e.trigger("change").trigger("changeTime"),!0}function m(e){var t,n=Math.round(e/60);if(Math.abs(n)<60)t=[n,x.mins];else if(60==n)t=["1",x.hr];else{var i=(n/60).toFixed(1);"."!=x.decimal&&(i=i.replace(".",x.decimal)),t=[i,x.hrs]}return t.join(" ")}function g(e,t){if(null!==e){for(var n,i,r=new Date(b.valueOf()+1e3*e),o="",a=0;a<t.length;a++)switch(i=t.charAt(a)){case"a":o+=r.getHours()>11?"pm":"am";break;case"A":o+=r.getHours()>11?"PM":"AM";break;case"g":n=r.getHours()%12,o+=0===n?"12":n;break;case"G":o+=r.getHours();break;case"h":n=r.getHours()%12,0!==n&&10>n&&(n="0"+n),o+=0===n?"12":n;break;case"H":n=r.getHours(),o+=n>9?n:"0"+n;break;case"i":var s=r.getMinutes();o+=s>9?s:"0"+s;break;case"s":e=r.getSeconds(),o+=e>9?e:"0"+e;break;default:o+=i}return o}}function v(e){if(""===e)return null;if(!e||e+0==e)return e;"object"==typeof e&&(e=e.getHours()+":"+y(e.getMinutes())+":"+y(e.getSeconds())),e=e.toLowerCase();var t;new Date(0);if(-1===e.indexOf(":")?(t=e.match(/^([0-9]):?([0-5][0-9])?:?([0-5][0-9])?\s*([pa]?)m?$/),t||(t=e.match(/^([0-2][0-9]):?([0-5][0-9])?:?([0-5][0-9])?\s*([pa]?)m?$/))):t=e.match(/^(\d{1,2})(?::([0-5][0-9]))?(?::([0-5][0-9]))?\s*([pa]?)m?$/),!t)return null;var n,i=parseInt(1*t[1],10);n=t[4]?12==i?"p"==t[4]?12:0:i+("p"==t[4]?12:0):i;var r=1*t[2]||0,o=1*t[3]||0;return 3600*n+60*r+o}function y(e){return("0"+e).slice(-2)}var b=i(),w=86400,k={className:null,minTime:null,maxTime:null,durationTime:null,step:30,showDuration:!1,timeFormat:"g:ia",scrollDefaultNow:!1,scrollDefaultTime:!1,selectOnBlur:!1,disableTouchKeyboard:!0,forceRoundTime:!1,appendTo:"body",disableTimeRanges:[],closeOnWindowScroll:!1,disableTextInput:!1},x={decimal:".",mins:"mins",hr:"hr",hrs:"hrs"},C={init:function(n){return this.each(function(){var i=e(this);if("SELECT"==i[0].tagName){for(var r={type:"text",value:i.val()},o=i[0].attributes,a=0;a<o.length;a++)r[o[a].nodeName]=o[a].nodeValue;var s=e("<input />",r);i.replaceWith(s),i=s}var c=e.extend({},k);n&&(c=e.extend(c,n)),c.lang&&(x=e.extend(x,c.lang)),c=t(c),i.data("timepicker-settings",c),i.prop("autocomplete","off"),i.on("click.timepicker focus.timepicker",C.show),i.on("blur.timepicker",l),i.on("keydown.timepicker",u),i.on("keyup.timepicker",f),i.addClass("ui-timepicker-input"),l.call(i.get(0))})},show:function(t){var i=e(this),o=i.data("timepicker-settings");"ontouchstart"in document&&o.disableTouchKeyboard&&i.blur();var s=i.data("timepicker-list");if(!i.prop("readonly")&&(s&&0!==s.length&&"function"!=typeof o.durationTime||(n(i),s=i.data("timepicker-list")),!s.is(":visible"))){C.hide(),s.show(),i.offset().top+i.outerHeight(!0)+s.outerHeight()>e(window).height()+e(window).scrollTop()?s.offset({left:i.offset().left+parseInt(s.css("marginLeft").replace("px",""),10),top:i.offset().top-s.outerHeight()+parseInt(s.css("marginTop").replace("px",""),10)}):s.offset({left:i.offset().left+parseInt(s.css("marginLeft").replace("px",""),10),top:i.offset().top+i.outerHeight()+parseInt(s.css("marginTop").replace("px",""),10)});var l=s.find(".ui-timepicker-selected");if(l.length||(c(i)?l=a(i,s,v(c(i))):o.scrollDefaultNow?l=a(i,s,v(new Date)):o.scrollDefaultTime!==!1&&(l=a(i,s,v(o.scrollDefaultTime)))),l&&l.length){var d=s.scrollTop()+l.position().top-l.outerHeight();s.scrollTop(d)}else s.scrollTop(0);r(o),i.trigger("showTimepicker")}},hide:function(t){e(".ui-timepicker-wrapper:visible").each(function(){var t=e(this),n=t.data("timepicker-input"),i=n.data("timepicker-settings");i&&i.selectOnBlur&&p(n),t.hide(),n.trigger("hideTimepicker")})},option:function(n,i){var r=this,o=r.data("timepicker-settings"),a=r.data("timepicker-list");if("object"==typeof n)o=e.extend(o,n);else if("string"==typeof n&&"undefined"!=typeof i)o[n]=i;else if("string"==typeof n)return o[n];return o=t(o),r.data("timepicker-settings",o),a&&(a.remove(),r.data("timepicker-list",!1)),r},getSecondsFromMidnight:function(){return v(c(this))},getTime:function(){var e=this,t=new Date;return t.setHours(0,0,0,0),new Date(t.valueOf()+1e3*v(c(e)))},setTime:function(e){var t=this,n=g(v(e),t.data("timepicker-settings").timeFormat);d(t,n)},remove:function(){var e=this;e.hasClass("ui-timepicker-input")&&(e.removeAttr("autocomplete","off"),e.removeClass("ui-timepicker-input"),e.removeData("timepicker-settings"),e.off(".timepicker"),e.data("timepicker-list")&&e.data("timepicker-list").remove(),e.removeData("timepicker-list"))}};e.fn.timepicker=function(t){return C[t]?C[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist on jQuery.timepicker"):C.init.apply(this,arguments)}}),function(e){function t(t,n){function i(){return d.update(),o(),d}function r(){var e=b.toLowerCase();g.obj.css(y,w/p.ratio),f.obj.css(y,-w),x.start=g.obj.offset()[y],p.obj.css(e,m[n.axis]),m.obj.css(e,m[n.axis]),g.obj.css(e,g[n.axis])}function o(){C?h.obj[0].ontouchstart=function(e){1===e.touches.length&&(a(e.touches[0]),e.stopPropagation())}:(g.obj.bind("mousedown",a),m.obj.bind("mouseup",l)),n.scroll&&window.addEventListener?(u[0].addEventListener("DOMMouseScroll",s,!1),u[0].addEventListener("mousewheel",s,!1),u[0].addEventListener("MozMousePixelScroll",function(e){e.preventDefault()},!1)):n.scroll&&(u[0].onmousewheel=s)}function a(t){e("body").addClass("noSelect");var n=parseInt(g.obj.css(y),10);x.start=v?t.pageX:t.pageY,k.start="auto"==n?0:n,C?(document.ontouchmove=function(e){e.preventDefault(),l(e.touches[0])},document.ontouchend=c):(e(document).bind("mousemove",l),e(document).bind("mouseup",c),g.obj.bind("mouseup",c))}function s(i){if(f.ratio<1){var r=i||window.event,o=r.wheelDelta?r.wheelDelta/120:-r.detail/3;w-=o*n.wheel,w=Math.min(f[n.axis]-h[n.axis],Math.max(0,w)),g.obj.css(y,w/p.ratio),f.obj.css(y,-w),(n.lockscroll||w!==f[n.axis]-h[n.axis]&&0!==w)&&(r=e.event.fix(r),r.preventDefault())}t.trigger("scroll")}function l(e){f.ratio<1&&(n.invertscroll&&C?k.now=Math.min(m[n.axis]-g[n.axis],Math.max(0,k.start+(x.start-(v?e.pageX:e.pageY)))):k.now=Math.min(m[n.axis]-g[n.axis],Math.max(0,k.start+((v?e.pageX:e.pageY)-x.start))),w=k.now*p.ratio,f.obj.css(y,-w),g.obj.css(y,k.now)),t.trigger("scroll")}function c(){e("body").removeClass("noSelect"),e(document).unbind("mousemove",l),e(document).unbind("mouseup",c),g.obj.unbind("mouseup",c),document.ontouchmove=document.ontouchend=null,t.trigger("scroll")}var d=this,u=t,h={obj:e(".viewport",t)},f={obj:e(".overview",t)},p={obj:e(".scrollbar",t)},m={obj:e(".track",p.obj)},g={obj:e(".thumb",p.obj)},v="x"===n.axis,y=v?"left":"top",b=v?"Width":"Height",w=0,k={start:0,now:0},x={},C="ontouchstart"in document.documentElement;return this.update=function(e){h[n.axis]=h.obj[0]["offset"+b],f[n.axis]=f.obj[0]["scroll"+b],f.ratio=h[n.axis]/f[n.axis],p.obj.toggleClass("disable",f.ratio>=1),m[n.axis]="auto"===n.size?h[n.axis]-10:n.size,g[n.axis]=Math.min(m[n.axis],Math.max(0,"auto"===n.sizethumb?m[n.axis]*f.ratio:n.sizethumb)),p.ratio="auto"===n.sizethumb?f[n.axis]/m[n.axis]:(f[n.axis]-h[n.axis])/(m[n.axis]-g[n.axis]),w="relative"===e&&f.ratio<=1?Math.min(f[n.axis]-h[n.axis],Math.max(0,w)):0,w="bottom"===e&&f.ratio<=1?f[n.axis]-h[n.axis]:isNaN(parseInt(e,10))?w:parseInt(e,10),r()},i()}e.tiny=e.tiny||{},e.tiny.scrollbar={options:{axis:"y",wheel:40,scroll:!0,lockscroll:!0,size:"auto",sizethumb:"auto",invertscroll:!1}},e.fn.tinyscrollbar=function(n){var i=e.extend({},e.tiny.scrollbar.options,n);return this.each(function(){e(this).data("tsb",new t(e(this),i))}),this},e.fn.tinyscrollbar_update=function(t){var n=e(this).data("tsb");return n?e(this).data("tsb").update(t):e(this)}}(jQuery),function(){function e(e){return e.off("mouseenter.tooltip").off("mouseleave.tooltip")}function t(e,t,i){clearTimeout(s),l.is(e)||(l.trigger("chess24:tooltip:hide"),l=e),n(),t.removeClass("cTooltipBoxContainer position-left position-right position-top position-bottom").addClass("jTooltipBox").appendTo("body").css({display:"block"});var o=r(e,t,void 0,void 0,i);t.addClass("position-"+o.side),t.css({top:o.top,left:o.left}).stop().animate({opacity:1},d),c.push(t),e.trigger("chess24:tooltip:show")}function n(){c=c.filter(function(e){return o&&e.get(0)===o.get(0)?!0:(e.stop().animate({opacity:0},d,function(){jQuery(this).detach()}),!1)})}function i(e,t,i){!i&&(t.length&&t.is(":hover")||e.length&&e.is(":hover"))||t.data("hideInProgress",!0).stop().animate({opacity:0},d,function(){jQuery(this).removeData("hideInProgress").detach(),e.trigger("chess24:tooltip:hide")}),n()}function r(e,t,n,i,r){function o(){return g>p||v>p?a():y>m||b>m?s():l()}function a(e){function t(){var e,t;return e=g-p-i,t=y-m+Math.round(f/2)+Math.round(m/2),{left:e,top:t,side:"left"}}function n(){var e,t;return e=g+h+i,t=y-m+Math.round(f/2)+Math.round(m/2),{left:e,top:t,side:"right"}}if("left"===e)return t();if("right"===e)return n();if(g>v){if(g>p)return t()}else if(v>p)return n();return l()}function s(e){function t(){var e,t;return e=g-p+Math.round(h/2)+Math.round(p/2),t=y-m-i,{left:e,top:t,side:"top"}}function n(){var e,t;return e=g-p+Math.round(h/2)+Math.round(p/2),t=y+f+i,{left:e,top:t,side:"bottom"}}if("top"===e)return t();if("bottom"===e)return n();if(y>b){if(y>m)return t()}else if(b>m)return n();return l()}function l(){var e,t;return e=g-p+Math.round(h/2)+Math.round(p/2),t=y-m,{left:e,top:t}}n=n||jQuery(window);var c=$("body"),d=c.offset(),u=e.offset();i=void 0===i?10:i;var h=e.outerWidth(),f=e.outerHeight(),p=t.outerWidth(),m=t.outerHeight(),g=u.left-d.left,v=n.outerWidth()-(u.left+h),y=u.top,b=n.outerHeight()-(u.top+f);return["left","right","horizontal"].contains(r)?a(r):["top","bottom","vertical"].contains(r)?s(r):o()}var o,a,s,l=jQuery(),c=[],d=200,u=100;jQuery.fn.tooltip=function(n,r){function l(t){e(t).on("mouseenter.tooltip",d)}function c(t){e(t).on("mouseleave.tooltip",h)}function d(){
function e(e){if(!s.data("tooltip-cancelled")){o=jQuery(e),s.data("tooltip-content",o);var r=Math.max(0,(n.showDelay||u)-Date.now()+d);o.data("hideInProgress")&&(o.stop(),r=0),a=setTimeout(function(){s.data("tooltip-cancelled")||s.data("tooltip-content")===o&&(t(s,o,n.side),function(e){o.off("mouseleave.tooltip").on("mouseleave.tooltip",function(){i(s,e)})}(o))},r)}}o=void 0;var s=jQuery(this);s.removeData("tooltip-cancelled");var l=s.data("tooltip-content"),d=Date.now();clearTimeout(a),c(s),!r||!n.invalidate&&l?e(l):r(s,e)}function h(){f(jQuery(this))}function f(e,t){return clearTimeout(a),l(e),o?void function(r){s=setTimeout(function(){i(e,r,t)},n.hideDelay||u)}(o):void e.data("tooltip-cancelled",!0)}var p=jQuery(this);return r?p.data("builder",r):r=p.data("builder"),"hide"===n?(f(p,!0),this):"reset"===n?(e(this),this.removeData("tooltip-content"),this):(l(this),this)}}(),function(e){function t(e){if(e in u.style)return e;var t=["Moz","Webkit","O","ms"],n=e.charAt(0).toUpperCase()+e.substr(1);if(e in u.style)return e;for(var i=0;i<t.length;++i){var r=t[i]+n;if(r in u.style)return r}}function n(){return u.style[h.transform]="",u.style[h.transform]="rotateY(90deg)",""!==u.style[h.transform]}function i(e){return"string"==typeof e&&this.parse(e),this}function r(e,t,n){t===!0?e.queue(n):t?e.queue(t,n):n()}function o(t){var n=[];return e.each(t,function(t){t=e.camelCase(t),t=e.transit.propertyMap[t]||e.cssProps[t]||t,t=l(t),-1===e.inArray(t,n)&&n.push(t)}),n}function a(t,n,i,r){var a=o(t);e.cssEase[i]&&(i=e.cssEase[i]);var s=""+d(n)+" "+i;parseInt(r,10)>0&&(s+=" "+d(r));var l=[];return e.each(a,function(e,t){l.push(t+" "+s)}),l.join(", ")}function s(t,n){n||(e.cssNumber[t]=!0),e.transit.propertyMap[t]=h.transform,e.cssHooks[t]={get:function(n){var i=e(n).css("transit:transform");return i.get(t)},set:function(n,i){var r=e(n).css("transit:transform");r.setFromString(t,i),e(n).css({"transit:transform":r})}}}function l(e){return e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}function c(e,t){return"string"!=typeof e||e.match(/^[\-0-9\.]+$/)?""+e+t:e}function d(t){var n=t;return e.fx.speeds[n]&&(n=e.fx.speeds[n]),c(n,"ms")}e.transit={version:"0.9.9",propertyMap:{marginLeft:"margin",marginRight:"margin",marginBottom:"margin",marginTop:"margin",paddingLeft:"padding",paddingRight:"padding",paddingBottom:"padding",paddingTop:"padding"},enabled:!0,useTransitionEnd:!1};var u=document.createElement("div"),h={},f=navigator.userAgent.toLowerCase().indexOf("chrome")>-1;h.transition=t("transition"),h.transitionDelay=t("transitionDelay"),h.transform=t("transform"),h.transformOrigin=t("transformOrigin"),h.transform3d=n();var p={transition:"transitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",WebkitTransition:"webkitTransitionEnd",msTransition:"MSTransitionEnd"},m=h.transitionEnd=p[h.transition]||null;for(var g in h)h.hasOwnProperty(g)&&"undefined"==typeof e.support[g]&&(e.support[g]=h[g]);u=null,e.cssEase={_default:"ease","in":"ease-in",out:"ease-out","in-out":"ease-in-out",snap:"cubic-bezier(0,1,.5,1)",easeOutCubic:"cubic-bezier(.215,.61,.355,1)",easeInOutCubic:"cubic-bezier(.645,.045,.355,1)",easeInCirc:"cubic-bezier(.6,.04,.98,.335)",easeOutCirc:"cubic-bezier(.075,.82,.165,1)",easeInOutCirc:"cubic-bezier(.785,.135,.15,.86)",easeInExpo:"cubic-bezier(.95,.05,.795,.035)",easeOutExpo:"cubic-bezier(.19,1,.22,1)",easeInOutExpo:"cubic-bezier(1,0,0,1)",easeInQuad:"cubic-bezier(.55,.085,.68,.53)",easeOutQuad:"cubic-bezier(.25,.46,.45,.94)",easeInOutQuad:"cubic-bezier(.455,.03,.515,.955)",easeInQuart:"cubic-bezier(.895,.03,.685,.22)",easeOutQuart:"cubic-bezier(.165,.84,.44,1)",easeInOutQuart:"cubic-bezier(.77,0,.175,1)",easeInQuint:"cubic-bezier(.755,.05,.855,.06)",easeOutQuint:"cubic-bezier(.23,1,.32,1)",easeInOutQuint:"cubic-bezier(.86,0,.07,1)",easeInSine:"cubic-bezier(.47,0,.745,.715)",easeOutSine:"cubic-bezier(.39,.575,.565,1)",easeInOutSine:"cubic-bezier(.445,.05,.55,.95)",easeInBack:"cubic-bezier(.6,-.28,.735,.045)",easeOutBack:"cubic-bezier(.175, .885,.32,1.275)",easeInOutBack:"cubic-bezier(.68,-.55,.265,1.55)"},e.cssHooks["transit:transform"]={get:function(t){return e(t).data("transform")||new i},set:function(t,n){var r=n;r instanceof i||(r=new i(r)),"WebkitTransform"!==h.transform||f?t.style[h.transform]=r.toString():t.style[h.transform]=r.toString(!0),e(t).data("transform",r)}},e.cssHooks.transform={set:e.cssHooks["transit:transform"].set},e.fn.jquery<"1.8"&&(e.cssHooks.transformOrigin={get:function(e){return e.style[h.transformOrigin]},set:function(e,t){e.style[h.transformOrigin]=t}},e.cssHooks.transition={get:function(e){return e.style[h.transition]},set:function(e,t){e.style[h.transition]=t}}),s("scale"),s("translate"),s("rotate"),s("rotateX"),s("rotateY"),s("rotate3d"),s("perspective"),s("skewX"),s("skewY"),s("x",!0),s("y",!0),i.prototype={setFromString:function(e,t){var n="string"==typeof t?t.split(","):t.constructor===Array?t:[t];n.unshift(e),i.prototype.set.apply(this,n)},set:function(e){var t=Array.prototype.slice.apply(arguments,[1]);this.setter[e]?this.setter[e].apply(this,t):this[e]=t.join(",")},get:function(e){return this.getter[e]?this.getter[e].apply(this):this[e]||0},setter:{rotate:function(e){this.rotate=c(e,"deg")},rotateX:function(e){this.rotateX=c(e,"deg")},rotateY:function(e){this.rotateY=c(e,"deg")},scale:function(e,t){void 0===t&&(t=e),this.scale=e+","+t},skewX:function(e){this.skewX=c(e,"deg")},skewY:function(e){this.skewY=c(e,"deg")},perspective:function(e){this.perspective=c(e,"px")},x:function(e){this.set("translate",e,null)},y:function(e){this.set("translate",null,e)},translate:function(e,t){void 0===this._translateX&&(this._translateX=0),void 0===this._translateY&&(this._translateY=0),null!==e&&void 0!==e&&(this._translateX=c(e,"px")),null!==t&&void 0!==t&&(this._translateY=c(t,"px")),this.translate=this._translateX+","+this._translateY}},getter:{x:function(){return this._translateX||0},y:function(){return this._translateY||0},scale:function(){var e=(this.scale||"1,1").split(",");return e[0]&&(e[0]=parseFloat(e[0])),e[1]&&(e[1]=parseFloat(e[1])),e[0]===e[1]?e[0]:e},rotate3d:function(){for(var e=(this.rotate3d||"0,0,0,0deg").split(","),t=0;3>=t;++t)e[t]&&(e[t]=parseFloat(e[t]));return e[3]&&(e[3]=c(e[3],"deg")),e}},parse:function(e){var t=this;e.replace(/([a-zA-Z0-9]+)\((.*?)\)/g,function(e,n,i){t.setFromString(n,i)})},toString:function(e){var t=[];for(var n in this)if(this.hasOwnProperty(n)){if(!h.transform3d&&("rotateX"===n||"rotateY"===n||"perspective"===n||"transformOrigin"===n))continue;"_"!==n[0]&&(e&&"scale"===n?t.push(n+"3d("+this[n]+",1)"):e&&"translate"===n?t.push(n+"3d("+this[n]+",0)"):t.push(n+"("+this[n]+")"))}return t.join(" ")}},e.fn.transition=e.fn.transit=function(t,n,i,o){var s=this,l=0,c=!0;"function"==typeof n&&(o=n,n=void 0),"function"==typeof i&&(o=i,i=void 0),"undefined"!=typeof t.easing&&(i=t.easing,delete t.easing),"undefined"!=typeof t.duration&&(n=t.duration,delete t.duration),"undefined"!=typeof t.complete&&(o=t.complete,delete t.complete),"undefined"!=typeof t.queue&&(c=t.queue,delete t.queue),"undefined"!=typeof t.delay&&(l=t.delay,delete t.delay),"undefined"==typeof n&&(n=e.fx.speeds._default),"undefined"==typeof i&&(i=e.cssEase._default),n=d(n);var u=a(t,n,i,l),f=e.transit.enabled&&h.transition,p=f?parseInt(n,10)+parseInt(l,10):0;if(0===p){var g=function(e){s.css(t),o&&o.apply(s),e&&e()};return r(s,c,g),s}var v={},y=function(n){var i=!1,r=function(){i&&s.unbind(m,r),p>0&&s.each(function(){this.style[h.transition]=v[this]||null}),"function"==typeof o&&o.apply(s),"function"==typeof n&&n()};p>0&&m&&e.transit.useTransitionEnd?(i=!0,s.bind(m,r)):window.setTimeout(r,p),s.each(function(){p>0&&(this.style[h.transition]=u),e(this).css(t)})},b=function(e){this.offsetWidth,y(e)};return r(s,c,b),this},e.transit.getTransitionValue=a}(jQuery),jQuery.fn.translationTable=function(){function e(e){function t(){s.find(".translationCell").on("click",function(){r.showCurrentEditCell(this)}),jQuery(s).on("keyup",".cellEditField",function(e){r.handleEditFieldKeyup(e)}),jQuery(s).on("click",".translationCellSaveBtn",function(e){r.saveCurrentField()})}var n="idle",i="saving",r=this,o=jQuery('link[rel="js-save-translation"]').attr("href"),a=jQuery(e),s=a.find("table"),l=s.data("itemtype"),c=s.data("itemid"),d=null,u=null;return r.showCurrentEditCell=function(e){if(jQuery(e).data("isEdited"))return!0;if(u==i)return r.flashCurrentCell(),!1;r.cancelCurrentCell(),d=jQuery(e),d.data("isEdited",!0),d.addClass("isEdited"),u=n,r.getCurrentHeader().addClass("expandedColumn"),d.find(".viewPart").hide(),d.find(".editPart").show();var t=d.parent("tr");if("image"!==t.data("property")){var o=d.find(".viewPart").html();d.find(".cellEditField").val(o).focus()}},r.cancelCurrentCell=function(){return u==i?!1:null==d?!0:(r.getCurrentHeader().removeClass("expandedColumn"),d.find(".viewPart").show(),d.find(".editPart").hide(),d.data("isEdited",!1),d.removeClass("isEdited"),d.find(".translationCellSaveBtn").show(),void d.find(".translationCellLoader").hide())},r.getCurrentHeader=function(){if(null==d)return null;var e=d.index(),t=s.find("thead th").get(e);return jQuery(t)},r.handleEditFieldKeyup=function(e){27==e.keyCode?r.cancelCurrentCell():10!=e.keyCode&&13!=e.keyCode||!e.ctrlKey||r.saveCurrentField()},r.saveCurrentField=function(){if(u==i)return!1;u=i,d.find(".translationCellSaveBtn").hide(),d.find(".translationCellLoader").show();var e=d.parent("tr");if("image"==e.data("property"))var t=d.find('input[name="BadgeForm[image]"]').val();else var t=d.find(".cellEditField").val();jQuery.ajax({url:o,data:{itemType:l,itemId:c,property:e.data("property"),sourceId:e.data("sourceid"),lang:d.data("lang"),value:t},dataType:"json",success:function(t){if(t&&0===t.status&&t.data)if(e.data("sourceid",t.data.sourceId),"image"==e.data("property")){var i=d.find(".badgePreview").attr("src");d.find(".badgePreview").attr("src",t.data.fieldValue),t.data.isDefault&&e.find('.badgePreview[src="'+i+'"]').attr("src",t.data.fieldValue),d.find(".inputFileUpload input").val("")}else d.find(".viewPart").html(t.data.fieldValue);u=n,r.cancelCurrentCell()},error:function(e,t,i){u=n,r.cancelCurrentCell()}})},r.flashCurrentCell=function(e,t){d.stop(!0,!0);var n=e||"#FFFF9C",i=t||1500,r=d.css("backgroundColor");d.css("background-color",n).animate({backgroundColor:r},i,"swing",function(){jQuery(this).css("backgroundColor","")})},t(),r}return this.each(function(){return jQuery(this).data("translationTable")||jQuery(this).data("translationTable",new e(this)),this})},function(e){function t(e,t){if(!(e.originalEvent.touches.length>1)){e.preventDefault();var n=e.originalEvent.changedTouches[0],i=document.createEvent("MouseEvents");i.initMouseEvent(t,!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(i)}}if(e.support.touch="ontouchend"in document,e.support.touch){var n,i=e.ui.mouse.prototype,r=i._mouseInit,o=i._mouseDestroy;i._touchStart=function(e){var i=this;!n&&i._mouseCapture(e.originalEvent.changedTouches[0])&&(n=!0,i._touchMoved=!1,t(e,"mouseover"),t(e,"mousemove"),t(e,"mousedown"))},i._touchMove=function(e){n&&(this._touchMoved=!0,t(e,"mousemove"))},i._touchEnd=function(e){n&&(t(e,"mouseup"),t(e,"mouseout"),this._touchMoved||t(e,"click"),n=!1)},i._mouseInit=function(){var t=this;t.element.bind({touchstart:e.proxy(t,"_touchStart"),touchmove:e.proxy(t,"_touchMove"),touchend:e.proxy(t,"_touchEnd")}),r.call(t)},i._mouseDestroy=function(){var t=this;t.element.unbind({touchstart:e.proxy(t,"_touchStart"),touchmove:e.proxy(t,"_touchMove"),touchend:e.proxy(t,"_touchEnd")}),o.call(t)}}}(jQuery),function(){jQuery.fn.videoDisplay=function(e,t,n,i){try{e=JSON.parse(e)}catch(r){errorHandler.error(r,e)}var o="/api/web/videoSeriesAPI/videoDescription",a=new Handler.Template("videoSeries");this.each(function(){var r=jQuery(this);jQuery.getJSON(o+"?id="+e.id+(e.series_id?"&series_id="+e.series_id:"")).fail(function(e,t,n){errorHandler.critical(new Error("unable to load json cuefile"),{textStatus:t})}).done(function(e){var o=a.render("videoContainer",{authorName:e.metadata.author,authorFideTitle:e.metadata.authorFideTitle,userCode:i,languages:[{lang:e.metadata.language}]});if(e.engineData)for(var s in e.engineData)Handler.engine.set(s,"remote",e.engineData[s]);r.html(o);for(var l=r.find(".chessBoardContainerContent"),c=r.find(".videoContainer"),d=r.find(".chessNotationContainer"),u=r.find(".videoControlContainer"),h=r.find(".userMoveModeMarker"),f=new Chess.GameHandler,p=new Chess.GameHandler,m=0;m<e.games.length;m++){for(var g=e.games[m],v=g.moves[0].fen,y=new Chess.Game({fen:v}).setSource("remote").setCheckForGameEnd(!1).setMoveMode({duringGame:{mainline:!1,sideline:!0},afterGame:{mainline:!1,sideline:!0}}).setRules("analyse"),b=new Chess.Game({fen:v}).setSource("remote").setCheckForGameEnd(!1).setMoveMode({duringGame:{mainline:!1,sideline:!0},afterGame:{mainline:!1,sideline:!0}}).setRules("analyse"),w=0;w<g.moves.length;w++){var k=g.moves[w];if(k.m){y.move(k.m,parseInt(k.pm,10),!k.m,k.id,"remote");var x=y.getLastAddedPosition();k.lineNumber||x.isInMainline()||y.promote(x),k.glyphs&&y.setGlyphes(k.glyphs,x),k.postComment&&config.level().isAdmin&&y.setComment(k.postComment,x)}if(k.highlights){for(var C=0;C<k.highlights.length;C++){var j=k.highlights[C];k.highlights[C]={color:j.color},"square"===j.type?k.highlights[C].frame=Chess.getSquare(j.y,j.x):"arrow"===j.type&&(k.highlights[C].line=Chess.translate.canToMove(j.from+j.to))}y.setHighlights(k.highlights,k.id)}if(!k.m){for(var T=[],_=y.getLastAddedPosition();_.parentMove;)T.unshift(_),_=_.parentMove;for(var S=0;S<T.length;S++){var I=T[S];b.move(I.moveCoords,void 0,!0,I.knotId,"remote"),I.hasGlyphes()&&b.setGlyphes(I.getGlyphes()),I.comment&&y.setComment(I.comment)}}}y.link(p,m),b.updateNextFreeKnotId(1e6).link(f,m)}for(var P=e.cuepoints,S=0;S<P.length;S++)P[S].index=S;var M=(new Handler.Keyboard).link(f);Handler.KeyboardDispatcher.add(M,l),new View.ChessBoard(l).link(f),new View.NotationArea(d,"videoDisplay").link(f),new View.UserMoveMode(h,"top").link(f),new View.Video(c,u,p,P,t,n).link(f);var Q=c.data("flowplayer"),B=u.find(".fp-timeline");r.data("chessGameHandler",f),r.trigger("videoDisplayInitialized",{exerciseGroups:e.exerciseGroups,videoApi:Q,timeline:B}),c.flowplayerErrorHandler()})})}}(),function(){var e={},t={},n={},i="videoSeries",r="ebook";jQuery.fn.addVideoSeriesPurchasePopUp=function(){var o=new Handler.Template("video").append(new Handler.Template);return this.each(function(){function a(){var a=c.data("content-type");void 0===a&&errorHandler.msg("warning",new Error("missing content type"),!0);var d=c.data("content-id");void 0===d&&errorHandler.msg("warning",new Error("missing content id"),!0);var u=a+"-"+d;if(t[u])return l(t[u],u,a,d);if(s(u),e[u])return!0;e[u]=!0;var h;switch(a){case r:h="/api/web/EbookAPI/ebookInfo?ebook_id="+d;break;case i:h="/api/web/VideoSeriesAPI/seriesInfo?series_id="+d;break;default:errorHandler.msg("warning",new Error("invalid content type: "+a),!0)}return jQuery.getJSON(h).done(function(e){var n;switch(a){case r:n=e.data.ebook,n.contentInfo=o.render("buyEbookInfo");break;case i:n=e.data.series,n.contentInfo=o.render("buySeriesInfo");break;default:errorHandler.msg("warning",new Error("invalid content type: "+a),!0)}t[u]=n,l(t[u],u,a,d,!0)}).fail(function(t,i,r){var o=jQuery.parseJSON(t.responseText);3===o.status?(n[u].modal("hide"),jQuery(".userMenu .login-link").trigger("click"),e[u]=!1):errorHandler.msg("critical",new Error("not able to load data for series purchase"),!1,{seriesId:d,textStatus:i,error:r})}),!0}function s(e){void 0===n[e]&&(n[e]=jQuery(o.render("popupBuyVideoSeries",{key:e,empty:!0})),jQuery("body").append(n[e]),n[e].modal({classes:"modal-payment"})),n[e].modal("show")}function l(e,t,i,r,a){if(a){e.empty=!1,e.key=t;var s=jQuery(o.render("popupBuyVideoSeries",e));n[t].html(s),n[t].find(".modal-payment__header__close").on("click",function(){n[t].modal("hide")}),n[t].modal("adjust"),layout(s),n[t].find(".modal-payment__content__buy").validatable(),n[t].find(".cBtnPremium").on("click",function(e){var t=jQuery(this).closest("form");if(t.validatable("clientvalidate")!==!1){var n=[{name:"csrf",value:config.csrf()},{name:"acceptTerms",value:1},{name:"content_type",value:i},{name:"content_id",value:r},{name:"lang",value:config.language()}];jQuery.post("/api/web/shopAPI/getPurchaseContentForm",n,function(e){var t=e.data.form,n=document.createElement("form");n.action=t.action,n.method=t.method,jQuery.each(t.fields,function(e,t){var i=document.createElement("input");i.setAttribute("name",t.name),i.setAttribute("type",t.type),i.setAttribute("value",t.value),n.appendChild(i)}),document.body.appendChild(n),n.submit()}),e.preventDefault()}})}else n[t].modal("show")}var c=jQuery(this);return c.data("addBuyContentPopUpInitialized")?this:(c.data("addBuyContentPopUpInitialized",!0),c.on("click",a),this)})}}(),$.fn.waterLabel=function(e){var t=$(this);e=e||t.data("watermark-label");var n=$("<div class='inputWaterlabel'>"+e+"</div>");t.data("pattern-waterlabel")||(t.after(n),n.click(function(){t.focus()}),this.keydown(function(){n.hide()}),t.bind("keyup blur input",function(){$(this).val().length?n.hide():n.show()}),t.focus(function(){n.addClass("input-block-focus")}),t.blur(function(){n.removeClass("input-block-focus")}),t.data("pattern-waterlabel",!0))},function(e){e.wrapTabs=function(t,n){var i=this;i.$el=jQuery(t),i.$nav=i.$el.find(".tabNav"),i.init=function(){i.options=e.extend({},e.wrapTabs.defaultOptions,n),i.$nav.on("click","li > a",null,function(e){if(!(jQuery(this).closest(".disabled").length>0)){if(jQuery(this).next("ul").length>0&&(jQuery(this).closest("li").hasClass("withSubTabs")||jQuery(this).closest(".tabNav").find("li.withSubTabs").each(function(){jQuery(this).removeClass("withSubTabs")})),jQuery(this).closest(".withSubTabs").length<=0&&(jQuery(this).next("ul").length>0?jQuery(this).closest("li").addClass("withSubTabs"):jQuery(".tabNav li").removeClass("withSubTabs")),jQuery(this).next("ul").find("li.autoCurrent").length>0)return void jQuery(this).next("ul").find("li.autoCurrent:first a").click();e.preventDefault();var t=i.$el.find("li.current a").attr("data-tab-content-id"),n=jQuery(this),r=n.attr("data-tab-content-id");if(r!=t&&0==i.$el.find(":animated").length){i.$el.find(".tabContentWrap");i.$el.find("#"+t).trigger("chess24:hide").fadeOut(i.options.speed,function(){i.$el.find("#"+r).trigger("chess24:show").fadeIn(i.options.speed),i.$el.find("#"+t).find(".customTabs section.active, .tabContentWrap > div:not(.hide)").trigger("chess24:hide"),i.$el.find("#"+r).find(".customTabs section.active, .tabContentWrap > div:not(.hide)").trigger("chess24:show"),i.$el.find(".tabNav li").removeClass("current"),n.closest("li").addClass("current")})}return!1}})},i.init()},e.wrapTabs.defaultOptions={speed:0},e.fn.wrapTabs=function(t){return this.each(function(){new e.wrapTabs(this,t)})}}(jQuery),function(e){e.yii={version:"1.0",submitForm:function(t,n,i){var r=e(t).parents("form")[0];r||(r=document.createElement("form"),r.style.display="none",t.parentNode.appendChild(r),r.method="POST"),"string"==typeof n&&""!=n&&(r.action=n),null!=t.target&&(r.target=t.target),i=i||{},i.csrf=config.csrf();var o=[];e.each(i,function(e,t){var n=document.createElement("input");n.setAttribute("type","hidden"),n.setAttribute("name",e),n.setAttribute("value",t),r.appendChild(n),o.push(n)}),e(r).data("submitObject",e(t)),e(r).trigger("submit"),e.each(o,function(){r.removeChild(this)})}}}(jQuery),function(e){var t,n,i=[];t=function(t){var n=i[t],r=e("#"+t).children("."+n.tableClass);return r.children("tbody").find("input.select-on-check").filter(":checked").each(function(){e(this).closest("tr").addClass("selected")}),r.children("thead").find("th input").filter('[type="checkbox"]').each(function(){var t=this.name.substring(0,this.name.length-4)+"[]",n=e("input[name='"+t+"']",r);this.checked=n.length>0&&n.length===n.filter(":checked").length}),this},n={init:function(n){var r=e.extend({ajaxUpdate:[],ajaxVar:"ajax",pagerClass:"pager",loadingClass:"loading",filterClass:"filters",tableClass:"items",selectableRows:1},n||{});return r.tableClass=r.tableClass.replace(/\s+/g,"."),this.each(function(){var n,o=e(this),a=o.attr("id"),s="#"+a+" ."+r.pagerClass.replace(/\s+/g,".")+" a",l="#"+a+" ."+r.tableClass+" thead th a.sort-link",c="#"+a+" ."+r.filterClass+" input, #"+a+" ."+r.filterClass+" select";r.updateSelector=r.updateSelector.replace("{page}",s).replace("{sort}",l),r.filterSelector=r.filterSelector.replace("{filter}",c),i[a]=r,r.ajaxUpdate.length>0&&e(document).on("click.yiiGridView",r.updateSelector,function(){if(r.enableHistory&&window.History.enabled){var t=e(this).attr("href").split("?"),n=e.deparam.querystring("?"+t[1]);delete n[r.ajaxVar],window.History.pushState(null,document.title,decodeURIComponent(e.param.querystring(t[0],n)))}else e("#"+a).yiiGridView("update",{url:e(this).attr("href")});return!1}),e(document).on("change.yiiGridView keydown.yiiGridView",r.filterSelector,function(t){if("keydown"===t.type){if(13!==t.keyCode)return;n="keydown"}else if("keydown"===n)return void(n="");var i=e(r.filterSelector).serialize();if(void 0!==r.pageVar&&(i+="&"+r.pageVar+"=1"),r.enableHistory&&r.ajaxUpdate!==!1&&window.History.enabled){var o=e("#"+a).yiiGridView("getUrl"),s=e.deparam.querystring(e.param.querystring(o,i));delete s[r.ajaxVar],window.History.pushState(null,document.title,decodeURIComponent(e.param.querystring(o.substr(0,o.indexOf("?")),s)))}else e("#"+a).yiiGridView("update",{data:i})}),r.enableHistory&&r.ajaxUpdate!==!1&&window.History.enabled&&e(window).bind("statechange",function(){var t=window.History.getState();e("#"+a).yiiGridView("update",{url:t.url})}),r.selectableRows>0?(t(this.id),e(document).on("click.yiiGridView","#"+a+" ."+r.tableClass+" > tbody > tr",function(t){var n,i,o,s,l=e(t.target);l.closest("td").is(".empty,.button-column")||"checkbox"===t.target.type&&!l.hasClass("select-on-check")||(i=e(this),n=e("#"+a),s=e("input.select-on-check",n),o=i.toggleClass("selected").hasClass("selected"),1===r.selectableRows&&(i.siblings().removeClass("selected"),s.prop("checked",!1)),e("input.select-on-check",i).prop("checked",o),e("input.select-on-check-all",n).prop("checked",s.length===s.filter(":checked").length),void 0!==r.selectionChanged&&r.selectionChanged(a))}),r.selectableRows>1&&e(document).on("click.yiiGridView","#"+a+" .select-on-check-all",function(){var t=e("#"+a),n=e("input.select-on-check",t),i=e("input.select-on-check-all",t),o=t.children("."+r.tableClass).children("tbody").children();this.checked?(o.addClass("selected"),n.prop("checked",!0),i.prop("checked",!0)):(o.removeClass("selected"),n.prop("checked",!1),i.prop("checked",!1)),void 0!==r.selectionChanged&&r.selectionChanged(a)})):e(document).on("click.yiiGridView","#"+a+" .select-on-check",!1)})},getKey:function(e){return this.children(".keys").children("span").eq(e).text()},getUrl:function(){var e=i[this.attr("id")].url;return e||this.children(".keys").attr("title")},getRow:function(e){var t=i[this.attr("id")].tableClass;return this.children("."+t).children("tbody").children("tr").eq(e).children()},getColumn:function(e){var t=i[this.attr("id")].tableClass;return this.children("."+t).children("tbody").children("tr").children("td:nth-child("+(e+1)+")")},update:function(n){var r;return n&&void 0!==n.error&&(r=n.error,delete n.error),this.each(function(){var o,a=e(this),s=a.attr("id"),l=i[s];a.addClass(l.loadingClass),n=e.extend({type:"GET",url:a.yiiGridView("getUrl"),success:function(n){var i=e("<div>"+n+"</div>");a.removeClass(l.loadingClass),e.each(l.ajaxUpdate,function(t,n){var r="#"+n;e(r).replaceWith(e(r,i))}),void 0!==l.afterAjaxUpdate&&l.afterAjaxUpdate(s,n),l.selectableRows>0&&t(s)},error:function(e,t,n){var i,o;if(a.removeClass(l.loadingClass),0!==e.readyState&&0!==e.status&&(void 0===r||(i=r(e),void 0===i||i))){switch(t){case"timeout":o="The request timed out!";break;case"parsererror":o="Parser error!";break;case"error":o=e.status&&!/^\s*$/.test(e.status)?"Error "+e.status:"Error",e.responseText&&!/^\s*$/.test(e.responseText)&&(o=o+": "+e.responseText)}void 0!==l.ajaxUpdateError?l.ajaxUpdateError(e,t,n,o):o&&alert(o)}}},n||{}),void 0!==n.data&&"GET"===n.type&&(n.url=e.param.querystring(n.url,n.data),n.data={}),l.ajaxUpdate!==!1?(n.url=e.param.querystring(n.url,l.ajaxVar+"="+s),void 0!==l.beforeAjaxUpdate&&l.beforeAjaxUpdate(s,n),e.ajax(n)):"GET"===n.type?window.location.href=n.url:(o=e('<form action="'+n.url+'" method="post"></form>').appendTo("body"),void 0===n.data&&(n.data={}),void 0===n.data.returnUrl&&(n.data.returnUrl=window.location.href),e.each(n.data,function(t,n){o.append(e('<input type="hidden" name="t" value="" />').attr("name",t).val(n))}),o.submit())})},getSelection:function(){var t=i[this.attr("id")],n=this.find(".keys span"),r=[];return this.find("."+t.tableClass).children("tbody").children().each(function(t){e(this).hasClass("selected")&&r.push(n.eq(t).text())}),r},getChecked:function(e){var t=i[this.attr("id")],n=this.find(".keys span"),r=[];return"[]"!==e.substring(e.length-2)&&(e+="[]"),this.find("."+t.tableClass).children("tbody").children("tr").children("td").children('input[name="'+e+'"]').each(function(e){this.checked&&r.push(n.eq(e).text())}),r}},e.fn.yiiGridView=function(t){return n[t]?n[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?(e.error("Method "+t+" does not exist on jQuery.yiiGridView"),!1):n.init.apply(this,arguments)},e.fn.yiiGridView.settings=i,e.fn.yiiGridView.getKey=function(t,n){return e("#"+t).yiiGridView("getKey",n)},e.fn.yiiGridView.getUrl=function(t){return e("#"+t).yiiGridView("getUrl")},e.fn.yiiGridView.getRow=function(t,n){return e("#"+t).yiiGridView("getRow",n)},e.fn.yiiGridView.getColumn=function(t,n){return e("#"+t).yiiGridView("getColumn",n)},e.fn.yiiGridView.update=function(t,n){e("#"+t).yiiGridView("update",n)},e.fn.yiiGridView.getSelection=function(t){return e("#"+t).yiiGridView("getSelection")},e.fn.yiiGridView.getChecked=function(t,n){return e("#"+t).yiiGridView("getChecked",n)}}(jQuery),function(e){e.fn.yiiListView=function(t){return this.each(function(){var n=e.extend({},e.fn.yiiListView.defaults,t||{}),i=e(this),r=i.attr("id");void 0==n.updateSelector&&(n.updateSelector="#"+r+" ."+n.pagerClass.replace(/\s+/g,".")+" a, #"+r+" ."+n.sorterClass.replace(/\s+/g,".")+" a"),e.fn.yiiListView.settings[r]=n,n.ajaxUpdate.length>0&&(e(document).on("click.yiiListView",n.updateSelector,function(){if(n.enableHistory&&window.History.enabled){var t=e(this).attr("href").split("?"),i=e.deparam.querystring("?"+t[1]);delete i[n.ajaxVar],window.History.pushState(null,document.title,decodeURIComponent(e.param.querystring(t[0],i)))}else e.fn.yiiListView.update(r,{url:e(this).attr("href")});return!1}),n.enableHistory&&window.History.enabled&&e(window).bind("statechange",function(){var t=window.History.getState();e.fn.yiiListView.update(r,{url:t.url})}))})},e.fn.yiiListView.defaults={ajaxUpdate:[],ajaxVar:"ajax",pagerClass:"pager",loadingClass:"loading",sorterClass:"sorter"},e.fn.yiiListView.settings={},e.fn.yiiListView.getKey=function(t,n){return e("#"+t+" > div.keys > span:eq("+n+")").text()},e.fn.yiiListView.getUrl=function(t){var n=e.fn.yiiListView.settings[t];return n.url||e("#"+t+" > div.keys").attr("title")},e.fn.yiiListView.update=function(t,n){var i,r=e.fn.yiiListView.settings[t];n&&void 0!==n.error&&(i=n.error,delete n.error),e("#"+t).addClass(r.loadingClass),n=e.extend({type:"GET",url:e.fn.yiiListView.getUrl(t),success:function(n,i){e.each(r.ajaxUpdate,function(t,i){var r="#"+i;e(r).replaceWith(e(r,"<div>"+n+"</div>"))}),void 0!=r.afterAjaxUpdate&&r.afterAjaxUpdate(t,n),e("#"+t).removeClass(r.loadingClass)},error:function(n,o,a){var s,l;if(e("#"+t).removeClass(r.loadingClass),0!==n.readyState&&0!==n.status&&(void 0===i||(s=i(n),void 0===s||s))){switch(o){case"timeout":l="The request timed out!";break;case"parsererror":l="Parser error!";break;case"error":l=n.status&&!/^\s*$/.test(n.status)?"Error "+n.status:"Error",n.responseText&&!/^\s*$/.test(n.responseText)&&(l=l+": "+n.responseText)}void 0!==r.ajaxUpdateError?r.ajaxUpdateError(n,o,a,l):l&&alert(l)}}},n||{}),void 0!=n.data&&"GET"==n.type&&(n.url=e.param.querystring(n.url,n.data),n.data={}),n.url=e.param.querystring(n.url,r.ajaxVar+"="+t),void 0!=r.beforeAjaxUpdate&&r.beforeAjaxUpdate(t),e.ajax(n)}}(jQuery);var defaults={tagName:"a",newLine:"\n",target:"_blank",linkClass:null,linkClasses:[],linkAttributes:null};Linkified.prototype={constructor:Linkified,init:function(){1===this.element.nodeType?Linkified.linkifyNode.call(this,this.element):this.element=Linkified.linkify.call(this,this.element.toString())},setOptions:function(e){this.settings=Linkified.extendSettings(e,this.settings)},toString:function(){return this.element.toString()}},Linkified.extendSettings=function(e,t){var n;t=t||{};for(n in defaults)t[n]||(t[n]=defaults[n]);for(n in e)t[n]=e[n];return t},Linkified.linkMatch=new RegExp(["(",'\\s|[^a-zA-Z0-9.\\+_\\/"\\>\\-]|^',")(?:","(","[a-zA-Z0-9\\+_\\-]+","(?:","\\.[a-zA-Z0-9\\+_\\-]+",")*@",")?(","http:\\/\\/|https:\\/\\/|ftp:\\/\\/",")?(","(?:(?:[a-z0-9][a-z0-9_%\\-_+]*\\.)+)",")(","(?:com|ca|co|edu|gov|net|org|dev|biz|cat|int|pro|tel|mil|aero|asia|coop|info|jobs|mobi|museum|name|post|travel|local|[a-z]{2})",")(","(?::\\d{1,5})",")?(","(?:","[\\/|\\?]","(?:","[\\-a-zA-Z0-9_%#*&+=~!?,;:.\\/]*",")*",")","[\\-\\/a-zA-Z0-9_%#*&+=~]","|","\\/?",")?",")(",'[^a-zA-Z0-9\\+_\\/"\\<\\-]|$',")"].join(""),"g"),Linkified.emailLinkMatch=/(<[a-z]+ href=\")(http:\/\/)([a-zA-Z0-9\+_\-]+(?:\.[a-zA-Z0-9\+_\-]+)*@)/g,Linkified.linkify=function(e,t){var n,i,r,o=[];if(this.constructor===Linkified&&this.settings?(i=this.settings,t&&(i=Linkified.extendSettings(t,i))):i=Linkified.extendSettings(t),r=i.linkClass?i.linkClass.split(/\s+/):[],r.push.apply(r,i.linkClasses),e=e.replace(/</g,"&lt;").replace(/(\s)/g,"$1$1"),i.domainWhitelist){var a=Linkified.linkMatch.exec(e);if(a&&a.length>4){var s=a[4]+a[5],l=new RegExp("^(www\\.)?("+i.domainWhitelist.join("|")+")$");if(!l.test(s))return e}}o.push("$1<"+i.tagName,'href="http://$2$4$5$6$7"'),o.push('class="linkified'+(r.length>0?" "+r.join(" "):"")+'"'),i.target&&o.push('target="'+i.target+'"');for(n in i.linkAttributes)o.push([n,'="',i.linkAttributes[n].replace(/\"/g,"&quot;").replace(/\$/g,"&#36;"),'"'].join(""));return o.push(">$2$3$4$5$6$7</"+i.tagName+">$8"),e=e.replace(Linkified.linkMatch,o.join(" ")),e=e.replace(Linkified.emailLinkMatch,"$1mailto:$3"),e=e.replace(/(\s){2}/g,"$1"),e=e.replace(/\n/g,i.newLine)},Linkified.linkifyNode=function(e){var t,n,i,r,o;if(e&&"object"==typeof e&&1===e.nodeType&&"a"!==e.tagName.toLowerCase()&&!/[^\s]linkified[\s$]/.test(e.className)){for(t=[],r=Linkified._dummyElement||document.createElement("div"),n=e.firstChild,i=e.childElementCount;n;){if(3===n.nodeType){for(;r.firstChild;)r.removeChild(r.firstChild);for(r.innerHTML=Linkified.linkify.call(this,n.textContent||n.innerText||n.nodeValue),t.push.apply(t,r.childNodes);r.firstChild;)r.removeChild(r.firstChild)}else 1===n.nodeType?t.push(Linkified.linkifyNode.call(this,n)):t.push(n);n=n.nextSibling}for(;e.firstChild;)e.removeChild(e.firstChild);for(o=0;o<t.length;o++)e.appendChild(t[o])}return e},Linkified._dummyElement=document.createElement("div"),function(e){var t,n,i="0.3.4",r="hasOwnProperty",o=/[\.\/]/,a="*",s=function(){},l=function(e,t){return e-t},c={n:{}},d=function(e,i){var r,o=n,a=Array.prototype.slice.call(arguments,2),s=d.listeners(e),c=0,u=[],h={},f=[],p=t;t=e,n=0;for(var m=0,g=s.length;g>m;m++)"zIndex"in s[m]&&(u.push(s[m].zIndex),s[m].zIndex<0&&(h[s[m].zIndex]=s[m]));for(u.sort(l);u[c]<0;)if(r=h[u[c++]],f.push(r.apply(i,a)),n)return n=o,f;for(m=0;g>m;m++)if(r=s[m],"zIndex"in r)if(r.zIndex==u[c]){if(f.push(r.apply(i,a)),n)break;do if(c++,r=h[u[c]],r&&f.push(r.apply(i,a)),n)break;while(r)}else h[r.zIndex]=r;else if(f.push(r.apply(i,a)),n)break;return n=o,
t=p,f.length?f:null};d.listeners=function(e){var t,n,i,r,s,l,d,u,h=e.split(o),f=c,p=[f],m=[];for(r=0,s=h.length;s>r;r++){for(u=[],l=0,d=p.length;d>l;l++)for(f=p[l].n,n=[f[h[r]],f[a]],i=2;i--;)t=n[i],t&&(u.push(t),m=m.concat(t.f||[]));p=u}return m},d.on=function(e,t){for(var n=e.split(o),i=c,r=0,a=n.length;a>r;r++)i=i.n,!i[n[r]]&&(i[n[r]]={n:{}}),i=i[n[r]];for(i.f=i.f||[],r=0,a=i.f.length;a>r;r++)if(i.f[r]==t)return s;return i.f.push(t),function(e){+e==+e&&(t.zIndex=+e)}},d.stop=function(){n=1},d.nt=function(e){return e?new RegExp("(?:\\.|\\/|^)"+e+"(?:\\.|\\/|$)").test(t):t},d.off=d.unbind=function(e,t){var n,i,s,l,d,u,h,f=e.split(o),p=[c];for(l=0,d=f.length;d>l;l++)for(u=0;u<p.length;u+=s.length-2){if(s=[u,1],n=p[u].n,f[l]!=a)n[f[l]]&&s.push(n[f[l]]);else for(i in n)n[r](i)&&s.push(n[i]);p.splice.apply(p,s)}for(l=0,d=p.length;d>l;l++)for(n=p[l];n.n;){if(t){if(n.f){for(u=0,h=n.f.length;h>u;u++)if(n.f[u]==t){n.f.splice(u,1);break}!n.f.length&&delete n.f}for(i in n.n)if(n.n[r](i)&&n.n[i].f){var m=n.n[i].f;for(u=0,h=m.length;h>u;u++)if(m[u]==t){m.splice(u,1);break}!m.length&&delete n.n[i].f}}else{delete n.f;for(i in n.n)n.n[r](i)&&n.n[i].f&&delete n.n[i].f}n=n.n}},d.once=function(e,t){var n=function(){var i=t.apply(this,arguments);return d.unbind(e,n),i};return d.on(e,n)},d.version=i,d.toString=function(){return"You are running Eve "+i},"undefined"!=typeof module&&module.exports?module.exports=d:"undefined"!=typeof define?define("eve",[],function(){return d}):e.eve=d}(this),function(){function e(t){if(e.is(t,"function"))return y?t():eve.on("raphael.DOMload",t);if(e.is(t,U))return e._engine.create[S](e,t.splice(0,3+e.is(t[0],F))).add(t);var n=Array.prototype.slice.call(arguments,0);if(e.is(n[n.length-1],"function")){var i=n.pop();return y?i.call(e._engine.create[S](e,n)):eve.on("raphael.DOMload",function(){i.call(e._engine.create[S](e,n))})}return e._engine.create[S](e,arguments)}function t(e){if(Object(e)!==e)return e;var n=new e.constructor;for(var i in e)e[C](i)&&(n[i]=t(e[i]));return n}function n(e,t){for(var n=0,i=e.length;i>n;n++)if(e[n]===t)return e.push(e.splice(n,1)[0])}function i(e,t,i){function r(){var o=Array.prototype.slice.call(arguments,0),a=o.join("␀"),s=r.cache=r.cache||{},l=r.count=r.count||[];return s[C](a)?(n(l,a),i?i(s[a]):s[a]):(l.length>=1e3&&delete s[l.shift()],l.push(a),s[a]=e[S](t,o),i?i(s[a]):s[a])}return r}function r(){return this.hex}function o(e,t){for(var n=[],i=0,r=e.length;r-2*!t>i;i+=2){var o=[{x:+e[i-2],y:+e[i-1]},{x:+e[i],y:+e[i+1]},{x:+e[i+2],y:+e[i+3]},{x:+e[i+4],y:+e[i+5]}];t?i?r-4==i?o[3]={x:+e[0],y:+e[1]}:r-2==i&&(o[2]={x:+e[0],y:+e[1]},o[3]={x:+e[2],y:+e[3]}):o[0]={x:+e[r-2],y:+e[r-1]}:r-4==i?o[3]=o[2]:i||(o[0]={x:+e[i],y:+e[i+1]}),n.push(["C",(-o[0].x+6*o[1].x+o[2].x)/6,(-o[0].y+6*o[1].y+o[2].y)/6,(o[1].x+6*o[2].x-o[3].x)/6,(o[1].y+6*o[2].y-o[3].y)/6,o[2].x,o[2].y])}return n}function a(e,t,n,i,r){var o=-3*t+9*n-9*i+3*r,a=e*o+6*t-12*n+6*i;return e*a-3*t+3*n}function s(e,t,n,i,r,o,s,l,c){null==c&&(c=1),c=c>1?1:0>c?0:c;for(var d=c/2,u=12,h=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],f=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],p=0,m=0;u>m;m++){var g=d*h[m]+d,v=a(g,e,n,r,s),y=a(g,t,i,o,l),b=v*v+y*y;p+=f[m]*H.sqrt(b)}return d*p}function l(e,t,n,i,r,o,a,l,c){if(!(0>c||s(e,t,n,i,r,o,a,l)<c)){var d,u=1,h=u/2,f=u-h,p=.01;for(d=s(e,t,n,i,r,o,a,l,f);G(d-c)>p;)h/=2,f+=(c>d?1:-1)*h,d=s(e,t,n,i,r,o,a,l,f);return f}}function c(e,t,n,i,r,o,a,s){if(!(N(e,n)<L(r,a)||L(e,n)>N(r,a)||N(t,i)<L(o,s)||L(t,i)>N(o,s))){var l=(e*i-t*n)*(r-a)-(e-n)*(r*s-o*a),c=(e*i-t*n)*(o-s)-(t-i)*(r*s-o*a),d=(e-n)*(o-s)-(t-i)*(r-a);if(d){var u=l/d,h=c/d,f=+u.toFixed(2),p=+h.toFixed(2);if(!(f<+L(e,n).toFixed(2)||f>+N(e,n).toFixed(2)||f<+L(r,a).toFixed(2)||f>+N(r,a).toFixed(2)||p<+L(t,i).toFixed(2)||p>+N(t,i).toFixed(2)||p<+L(o,s).toFixed(2)||p>+N(o,s).toFixed(2)))return{x:u,y:h}}}}function d(t,n,i){var r=e.bezierBBox(t),o=e.bezierBBox(n);if(!e.isBBoxIntersect(r,o))return i?0:[];for(var a=s.apply(0,t),l=s.apply(0,n),d=~~(a/5),u=~~(l/5),h=[],f=[],p={},m=i?0:[],g=0;d+1>g;g++){var v=e.findDotsAtSegment.apply(e,t.concat(g/d));h.push({x:v.x,y:v.y,t:g/d})}for(g=0;u+1>g;g++)v=e.findDotsAtSegment.apply(e,n.concat(g/u)),f.push({x:v.x,y:v.y,t:g/u});for(g=0;d>g;g++)for(var y=0;u>y;y++){var b=h[g],w=h[g+1],k=f[y],x=f[y+1],C=G(w.x-b.x)<.001?"y":"x",j=G(x.x-k.x)<.001?"y":"x",T=c(b.x,b.y,w.x,w.y,k.x,k.y,x.x,x.y);if(T){if(p[T.x.toFixed(4)]==T.y.toFixed(4))continue;p[T.x.toFixed(4)]=T.y.toFixed(4);var _=b.t+G((T[C]-b[C])/(w[C]-b[C]))*(w.t-b.t),S=k.t+G((T[j]-k[j])/(x[j]-k[j]))*(x.t-k.t);_>=0&&1>=_&&S>=0&&1>=S&&(i?m++:m.push({x:T.x,y:T.y,t1:_,t2:S}))}}return m}function u(t,n,i){t=e._path2curve(t),n=e._path2curve(n);for(var r,o,a,s,l,c,u,h,f,p,m=i?0:[],g=0,v=t.length;v>g;g++){var y=t[g];if("M"==y[0])r=l=y[1],o=c=y[2];else{"C"==y[0]?(f=[r,o].concat(y.slice(1)),r=f[6],o=f[7]):(f=[r,o,r,o,l,c,l,c],r=l,o=c);for(var b=0,w=n.length;w>b;b++){var k=n[b];if("M"==k[0])a=u=k[1],s=h=k[2];else{"C"==k[0]?(p=[a,s].concat(k.slice(1)),a=p[6],s=p[7]):(p=[a,s,a,s,u,h,u,h],a=u,s=h);var x=d(f,p,i);if(i)m+=x;else{for(var C=0,j=x.length;j>C;C++)x[C].segment1=g,x[C].segment2=b,x[C].bez1=f,x[C].bez2=p;m=m.concat(x)}}}}}return m}function h(e,t,n,i,r,o){null!=e?(this.a=+e,this.b=+t,this.c=+n,this.d=+i,this.e=+r,this.f=+o):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}function f(){return this.x+Q+this.y+Q+this.width+" × "+this.height}function p(e,t,n,i,r,o){function a(e){return((u*e+d)*e+c)*e}function s(e,t){var n=l(e,t);return((p*n+f)*n+h)*n}function l(e,t){var n,i,r,o,s,l;for(r=e,l=0;8>l;l++){if(o=a(r)-e,G(o)<t)return r;if(s=(3*u*r+2*d)*r+c,G(s)<1e-6)break;r-=o/s}if(n=0,i=1,r=e,n>r)return n;if(r>i)return i;for(;i>n;){if(o=a(r),G(o-e)<t)return r;e>o?n=r:i=r,r=(i-n)/2+n}return r}var c=3*t,d=3*(i-t)-c,u=1-c-d,h=3*n,f=3*(r-n)-h,p=1-h-f;return s(e,1/(200*o))}function m(e,t){var n=[],i={};if(this.ms=t,this.times=1,e){for(var r in e)e[C](r)&&(i[X(r)]=e[r],n.push(X(r)));n.sort(ce)}this.anim=i,this.top=n[n.length-1],this.percents=n}function g(t,n,i,r,o,a){i=X(i);var s,l,c,d,u,f,m=t.ms,g={},v={},y={};if(r)for(k=0,x=ot.length;x>k;k++){var b=ot[k];if(b.el.id==n.id&&b.anim==t){b.percent!=i?(ot.splice(k,1),c=1):l=b,n.attr(b.totalOrigin);break}}else r=+v;for(var k=0,x=t.percents.length;x>k;k++){if(t.percents[k]==i||t.percents[k]>r*t.top){i=t.percents[k],u=t.percents[k-1]||0,m=m/t.top*(i-u),d=t.percents[k+1],s=t.anim[i];break}r&&n.attr(t.anim[t.percents[k]])}if(s){if(l)l.initstatus=r,l.start=new Date-l.ms*r;else{for(var j in s)if(s[C](j)&&(te[C](j)||n.paper.customAttributes[C](j)))switch(g[j]=n.attr(j),null==g[j]&&(g[j]=ee[j]),v[j]=s[j],te[j]){case F:y[j]=(v[j]-g[j])/m;break;case"colour":g[j]=e.getRGB(g[j]);var T=e.getRGB(v[j]);y[j]={r:(T.r-g[j].r)/m,g:(T.g-g[j].g)/m,b:(T.b-g[j].b)/m};break;case"path":var _=Oe(g[j],v[j]),S=_[1];for(g[j]=_[0],y[j]=[],k=0,x=g[j].length;x>k;k++){y[j][k]=[0];for(var P=1,M=g[j][k].length;M>P;P++)y[j][k][P]=(S[k][P]-g[j][k][P])/m}break;case"transform":var Q=n._,O=Le(Q[j],v[j]);if(O)for(g[j]=O.from,v[j]=O.to,y[j]=[],y[j].real=!0,k=0,x=g[j].length;x>k;k++)for(y[j][k]=[g[j][k][0]],P=1,M=g[j][k].length;M>P;P++)y[j][k][P]=(v[j][k][P]-g[j][k][P])/m;else{var A=n.matrix||new h,D={_:{transform:Q.transform},getBBox:function(){return n.getBBox(1)}};g[j]=[A.a,A.b,A.c,A.d,A.e,A.f],He(D,v[j]),v[j]=D._.transform,y[j]=[(D.matrix.a-A.a)/m,(D.matrix.b-A.b)/m,(D.matrix.c-A.c)/m,(D.matrix.d-A.d)/m,(D.matrix.e-A.e)/m,(D.matrix.f-A.f)/m]}break;case"csv":var H=B(s[j])[E](w),N=B(g[j])[E](w);if("clip-rect"==j)for(g[j]=N,y[j]=[],k=N.length;k--;)y[j][k]=(H[k]-g[j][k])/m;v[j]=H;break;default:for(H=[][I](s[j]),N=[][I](g[j]),y[j]=[],k=n.paper.customAttributes[j].length;k--;)y[j][k]=((H[k]||0)-(N[k]||0))/m}var L=s.easing,G=e.easing_formulas[L];if(!G)if(G=B(L).match(K),G&&5==G.length){var R=G;G=function(e){return p(e,+R[1],+R[2],+R[3],+R[4],m)}}else G=ue;if(f=s.start||t.start||+new Date,b={anim:t,percent:i,timestamp:f,start:f+(t.del||0),status:0,initstatus:r||0,stop:!1,ms:m,easing:G,from:g,diff:y,to:v,el:n,callback:s.callback,prev:u,next:d,repeat:a||t.times,origin:n.attr(),totalOrigin:o},ot.push(b),r&&!l&&!c&&(b.stop=!0,b.start=new Date-m*r,1==ot.length))return st();c&&(b.start=new Date-b.ms*r),1==ot.length&&at(st)}eve("raphael.anim.start."+n.id,n,t)}}function v(e){for(var t=0;t<ot.length;t++)ot[t].el.paper==e&&ot.splice(t--,1)}e.version="2.1.0",e.eve=eve;var y,b,w=/[, ]+/,k={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},x=/\{(\d+)\}/g,C="hasOwnProperty",j={doc:document,win:window},T={was:Object.prototype[C].call(j.win,"Raphael"),is:j.win.Raphael},_=function(){this.ca=this.customAttributes={}},S="apply",I="concat",P="createTouch"in j.doc,M="",Q=" ",B=String,E="split",O="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[E](Q),A={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},D=B.prototype.toLowerCase,H=Math,N=H.max,L=H.min,G=H.abs,R=H.pow,V=H.PI,F="number",z="string",U="array",W=Object.prototype.toString,q=(e._ISURL=/^url\(['"]?([^\)]+?)['"]?\)$/i,/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i),$={NaN:1,Infinity:1,"-Infinity":1},K=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,J=H.round,X=parseFloat,Y=parseInt,Z=B.prototype.toUpperCase,ee=e._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/","letter-spacing":0,opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0},te=e._availableAnimAttrs={blur:F,"clip-rect":"csv",cx:F,cy:F,fill:"colour","fill-opacity":F,"font-size":F,height:F,opacity:F,path:"path",r:F,rx:F,ry:F,stroke:"colour","stroke-opacity":F,"stroke-width":F,transform:"transform",width:F,x:F,y:F},ne=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,ie={hs:1,rg:1},re=/,?([achlmqrstvxz]),?/gi,oe=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,ae=/([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,se=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/gi,le=(e._radial_gradient=/^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/,{}),ce=function(e,t){return X(e)-X(t)},de=function(){},ue=function(e){return e},he=e._rectPath=function(e,t,n,i,r){return r?[["M",e+r,t],["l",n-2*r,0],["a",r,r,0,0,1,r,r],["l",0,i-2*r],["a",r,r,0,0,1,-r,r],["l",2*r-n,0],["a",r,r,0,0,1,-r,-r],["l",0,2*r-i],["a",r,r,0,0,1,r,-r],["z"]]:[["M",e,t],["l",n,0],["l",0,i],["l",-n,0],["z"]]},fe=function(e,t,n,i){return null==i&&(i=n),[["M",e,t],["m",0,-i],["a",n,i,0,1,1,0,2*i],["a",n,i,0,1,1,0,-2*i],["z"]]},pe=e._getPath={path:function(e){return e.attr("path")},circle:function(e){var t=e.attrs;return fe(t.cx,t.cy,t.r)},ellipse:function(e){var t=e.attrs;return fe(t.cx,t.cy,t.rx,t.ry)},rect:function(e){var t=e.attrs;return he(t.x,t.y,t.width,t.height,t.r)},image:function(e){var t=e.attrs;return he(t.x,t.y,t.width,t.height)},text:function(e){var t=e._getBBox();return he(t.x,t.y,t.width,t.height)}},me=e.mapPath=function(e,t){if(!t)return e;var n,i,r,o,a,s,l;for(e=Oe(e),r=0,a=e.length;a>r;r++)for(l=e[r],o=1,s=l.length;s>o;o+=2)n=t.x(l[o],l[o+1]),i=t.y(l[o],l[o+1]),l[o]=n,l[o+1]=i;return e};if(e._g=j,e.type=j.win.SVGAngle||j.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML","VML"==e.type){var ge,ve=j.doc.createElement("div");if(ve.innerHTML='<v:shape adj="1"/>',ge=ve.firstChild,ge.style.behavior="url(#default#VML)",!ge||"object"!=typeof ge.adj)return e.type=M;ve=null}e.svg=!(e.vml="VML"==e.type),e._Paper=_,e.fn=b=_.prototype=e.prototype,e._id=0,e._oid=0,e.is=function(e,t){return t=D.call(t),"finite"==t?!$[C](+e):"array"==t?e instanceof Array:"null"==t&&null===e||t==typeof e&&null!==e||"object"==t&&e===Object(e)||"array"==t&&Array.isArray&&Array.isArray(e)||W.call(e).slice(8,-1).toLowerCase()==t},e.angle=function(t,n,i,r,o,a){if(null==o){var s=t-i,l=n-r;return s||l?(180+180*H.atan2(-l,-s)/V+360)%360:0}return e.angle(t,n,o,a)-e.angle(i,r,o,a)},e.rad=function(e){return e%360*V/180},e.deg=function(e){return 180*e/V%360},e.snapTo=function(t,n,i){if(i=e.is(i,"finite")?i:10,e.is(t,U)){for(var r=t.length;r--;)if(G(t[r]-n)<=i)return t[r]}else{t=+t;var o=n%t;if(i>o)return n-o;if(o>t-i)return n-o+t}return n};e.createUUID=function(e,t){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(e,t).toUpperCase()}}(/[xy]/g,function(e){var t=16*H.random()|0,n="x"==e?t:3&t|8;return n.toString(16)});e.setWindow=function(t){eve("raphael.setWindow",e,j.win,t),j.win=t,j.doc=j.win.document,e._engine.initWin&&e._engine.initWin(j.win)};var ye=function(t){if(e.vml){var n,r=/^\s+|\s+$/g;try{var o=new ActiveXObject("htmlfile");o.write("<body>"),o.close(),n=o.body}catch(a){n=createPopup().document.body}var s=n.createTextRange();ye=i(function(e){try{n.style.color=B(e).replace(r,M);var t=s.queryCommandValue("ForeColor");return t=(255&t)<<16|65280&t|(16711680&t)>>>16,"#"+("000000"+t.toString(16)).slice(-6)}catch(i){return"none"}})}else{var l=j.doc.createElement("i");l.title="Raphaël Colour Picker",l.style.display="none",j.doc.body.appendChild(l),ye=i(function(e){return l.style.color=e,j.doc.defaultView.getComputedStyle(l,M).getPropertyValue("color")})}return ye(t)},be=function(){return"hsb("+[this.h,this.s,this.b]+")"},we=function(){return"hsl("+[this.h,this.s,this.l]+")"},ke=function(){return this.hex},xe=function(t,n,i){if(null==n&&e.is(t,"object")&&"r"in t&&"g"in t&&"b"in t&&(i=t.b,n=t.g,t=t.r),null==n&&e.is(t,z)){var r=e.getRGB(t);t=r.r,n=r.g,i=r.b}return(t>1||n>1||i>1)&&(t/=255,n/=255,i/=255),[t,n,i]},Ce=function(t,n,i,r){t*=255,n*=255,i*=255;var o={r:t,g:n,b:i,hex:e.rgb(t,n,i),toString:ke};return e.is(r,"finite")&&(o.opacity=r),o};e.color=function(t){var n;return e.is(t,"object")&&"h"in t&&"s"in t&&"b"in t?(n=e.hsb2rgb(t),t.r=n.r,t.g=n.g,t.b=n.b,t.hex=n.hex):e.is(t,"object")&&"h"in t&&"s"in t&&"l"in t?(n=e.hsl2rgb(t),t.r=n.r,t.g=n.g,t.b=n.b,t.hex=n.hex):(e.is(t,"string")&&(t=e.getRGB(t)),e.is(t,"object")&&"r"in t&&"g"in t&&"b"in t?(n=e.rgb2hsl(t),t.h=n.h,t.s=n.s,t.l=n.l,n=e.rgb2hsb(t),t.v=n.b):(t={hex:"none"},t.r=t.g=t.b=t.h=t.s=t.v=t.l=-1)),t.toString=ke,t},e.hsb2rgb=function(e,t,n,i){this.is(e,"object")&&"h"in e&&"s"in e&&"b"in e&&(n=e.b,t=e.s,e=e.h,i=e.o),e*=360;var r,o,a,s,l;return e=e%360/60,l=n*t,s=l*(1-G(e%2-1)),r=o=a=n-l,e=~~e,r+=[l,s,0,0,s,l][e],o+=[s,l,l,s,0,0][e],a+=[0,0,s,l,l,s][e],Ce(r,o,a,i)},e.hsl2rgb=function(e,t,n,i){this.is(e,"object")&&"h"in e&&"s"in e&&"l"in e&&(n=e.l,t=e.s,e=e.h),(e>1||t>1||n>1)&&(e/=360,t/=100,n/=100),e*=360;var r,o,a,s,l;return e=e%360/60,l=2*t*(.5>n?n:1-n),s=l*(1-G(e%2-1)),r=o=a=n-l/2,e=~~e,r+=[l,s,0,0,s,l][e],o+=[s,l,l,s,0,0][e],a+=[0,0,s,l,l,s][e],Ce(r,o,a,i)},e.rgb2hsb=function(e,t,n){n=xe(e,t,n),e=n[0],t=n[1],n=n[2];var i,r,o,a;return o=N(e,t,n),a=o-L(e,t,n),i=0==a?null:o==e?(t-n)/a:o==t?(n-e)/a+2:(e-t)/a+4,i=(i+360)%6*60/360,r=0==a?0:a/o,{h:i,s:r,b:o,toString:be}},e.rgb2hsl=function(e,t,n){n=xe(e,t,n),e=n[0],t=n[1],n=n[2];var i,r,o,a,s,l;return a=N(e,t,n),s=L(e,t,n),l=a-s,i=0==l?null:a==e?(t-n)/l:a==t?(n-e)/l+2:(e-t)/l+4,i=(i+360)%6*60/360,o=(a+s)/2,r=0==l?0:.5>o?l/(2*o):l/(2-2*o),{h:i,s:r,l:o,toString:we}},e._path2string=function(){return this.join(",").replace(re,"$1")};e._preload=function(e,t){var n=j.doc.createElement("img");n.style.cssText="position:absolute;left:-9999em;top:-9999em",n.onload=function(){t.call(this),this.onload=null,j.doc.body.removeChild(this)},n.onerror=function(){j.doc.body.removeChild(this)},j.doc.body.appendChild(n),n.src=e};e.getRGB=i(function(t){if(!t||(t=B(t)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:r};if("none"==t)return{r:-1,g:-1,b:-1,hex:"none",toString:r};!(ie[C](t.toLowerCase().substring(0,2))||"#"==t.charAt())&&(t=ye(t));var n,i,o,a,s,l,c=t.match(q);return c?(c[2]&&(o=Y(c[2].substring(5),16),i=Y(c[2].substring(3,5),16),n=Y(c[2].substring(1,3),16)),c[3]&&(o=Y((s=c[3].charAt(3))+s,16),i=Y((s=c[3].charAt(2))+s,16),n=Y((s=c[3].charAt(1))+s,16)),c[4]&&(l=c[4][E](ne),n=X(l[0]),"%"==l[0].slice(-1)&&(n*=2.55),i=X(l[1]),"%"==l[1].slice(-1)&&(i*=2.55),o=X(l[2]),"%"==l[2].slice(-1)&&(o*=2.55),"rgba"==c[1].toLowerCase().slice(0,4)&&(a=X(l[3])),l[3]&&"%"==l[3].slice(-1)&&(a/=100)),c[5]?(l=c[5][E](ne),n=X(l[0]),"%"==l[0].slice(-1)&&(n*=2.55),i=X(l[1]),"%"==l[1].slice(-1)&&(i*=2.55),o=X(l[2]),"%"==l[2].slice(-1)&&(o*=2.55),("deg"==l[0].slice(-3)||"°"==l[0].slice(-1))&&(n/=360),"hsba"==c[1].toLowerCase().slice(0,4)&&(a=X(l[3])),l[3]&&"%"==l[3].slice(-1)&&(a/=100),e.hsb2rgb(n,i,o,a)):c[6]?(l=c[6][E](ne),n=X(l[0]),"%"==l[0].slice(-1)&&(n*=2.55),i=X(l[1]),"%"==l[1].slice(-1)&&(i*=2.55),o=X(l[2]),"%"==l[2].slice(-1)&&(o*=2.55),("deg"==l[0].slice(-3)||"°"==l[0].slice(-1))&&(n/=360),"hsla"==c[1].toLowerCase().slice(0,4)&&(a=X(l[3])),l[3]&&"%"==l[3].slice(-1)&&(a/=100),e.hsl2rgb(n,i,o,a)):(c={r:n,g:i,b:o,toString:r},c.hex="#"+(16777216|o|i<<8|n<<16).toString(16).slice(1),e.is(a,"finite")&&(c.opacity=a),c)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:r}},e),e.hsb=i(function(t,n,i){return e.hsb2rgb(t,n,i).hex}),e.hsl=i(function(t,n,i){return e.hsl2rgb(t,n,i).hex}),e.rgb=i(function(e,t,n){return"#"+(16777216|n|t<<8|e<<16).toString(16).slice(1)}),e.getColor=function(e){var t=this.getColor.start=this.getColor.start||{h:0,s:1,b:e||.75},n=this.hsb2rgb(t.h,t.s,t.b);return t.h+=.075,t.h>1&&(t.h=0,t.s-=.2,t.s<=0&&(this.getColor.start={h:0,s:1,b:t.b})),n.hex},e.getColor.reset=function(){delete this.start},e.parsePathString=function(t){if(!t)return null;var n=je(t);if(n.arr)return _e(n.arr);var i={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},r=[];return e.is(t,U)&&e.is(t[0],U)&&(r=_e(t)),r.length||B(t).replace(oe,function(e,t,n){var o=[],a=t.toLowerCase();if(n.replace(se,function(e,t){t&&o.push(+t)}),"m"==a&&o.length>2&&(r.push([t][I](o.splice(0,2))),a="l",t="m"==t?"l":"L"),"r"==a)r.push([t][I](o));else for(;o.length>=i[a]&&(r.push([t][I](o.splice(0,i[a]))),i[a]););}),r.toString=e._path2string,n.arr=_e(r),r},e.parseTransformString=i(function(t){if(!t)return null;var n=[];return e.is(t,U)&&e.is(t[0],U)&&(n=_e(t)),n.length||B(t).replace(ae,function(e,t,i){var r=[];D.call(t);i.replace(se,function(e,t){t&&r.push(+t)}),n.push([t][I](r))}),n.toString=e._path2string,n});var je=function(e){var t=je.ps=je.ps||{};return t[e]?t[e].sleep=100:t[e]={sleep:100},setTimeout(function(){for(var n in t)t[C](n)&&n!=e&&(t[n].sleep--,!t[n].sleep&&delete t[n])}),t[e]};e.findDotsAtSegment=function(e,t,n,i,r,o,a,s,l){var c=1-l,d=R(c,3),u=R(c,2),h=l*l,f=h*l,p=d*e+3*u*l*n+3*c*l*l*r+f*a,m=d*t+3*u*l*i+3*c*l*l*o+f*s,g=e+2*l*(n-e)+h*(r-2*n+e),v=t+2*l*(i-t)+h*(o-2*i+t),y=n+2*l*(r-n)+h*(a-2*r+n),b=i+2*l*(o-i)+h*(s-2*o+i),w=c*e+l*n,k=c*t+l*i,x=c*r+l*a,C=c*o+l*s,j=90-180*H.atan2(g-y,v-b)/V;return(g>y||b>v)&&(j+=180),{x:p,y:m,m:{x:g,y:v},n:{x:y,y:b},start:{x:w,y:k},end:{x:x,y:C},alpha:j}},e.bezierBBox=function(t,n,i,r,o,a,s,l){e.is(t,"array")||(t=[t,n,i,r,o,a,s,l]);var c=Ee.apply(null,t);return{x:c.min.x,y:c.min.y,x2:c.max.x,y2:c.max.y,width:c.max.x-c.min.x,height:c.max.y-c.min.y}},e.isPointInsideBBox=function(e,t,n){return t>=e.x&&t<=e.x2&&n>=e.y&&n<=e.y2},e.isBBoxIntersect=function(t,n){var i=e.isPointInsideBBox;return i(n,t.x,t.y)||i(n,t.x2,t.y)||i(n,t.x,t.y2)||i(n,t.x2,t.y2)||i(t,n.x,n.y)||i(t,n.x2,n.y)||i(t,n.x,n.y2)||i(t,n.x2,n.y2)||(t.x<n.x2&&t.x>n.x||n.x<t.x2&&n.x>t.x)&&(t.y<n.y2&&t.y>n.y||n.y<t.y2&&n.y>t.y)},e.pathIntersection=function(e,t){return u(e,t)},e.pathIntersectionNumber=function(e,t){return u(e,t,1)},e.isPointInsidePath=function(t,n,i){var r=e.pathBBox(t);return e.isPointInsideBBox(r,n,i)&&u(t,[["M",n,i],["H",r.x2+10]],1)%2==1},e._removedFactory=function(e){return function(){eve("raphael.log",null,"Raphaël: you are calling to method “"+e+"” of removed object",e)}};var Te=e.pathBBox=function(e){var n=je(e);if(n.bbox)return n.bbox;if(!e)return{x:0,y:0,width:0,height:0,x2:0,y2:0};e=Oe(e);for(var i,r=0,o=0,a=[],s=[],l=0,c=e.length;c>l;l++)if(i=e[l],"M"==i[0])r=i[1],o=i[2],a.push(r),s.push(o);else{var d=Ee(r,o,i[1],i[2],i[3],i[4],i[5],i[6]);a=a[I](d.min.x,d.max.x),s=s[I](d.min.y,d.max.y),r=i[5],o=i[6]}var u=L[S](0,a),h=L[S](0,s),f=N[S](0,a),p=N[S](0,s),m={x:u,y:h,x2:f,y2:p,width:f-u,height:p-h};return n.bbox=t(m),m},_e=function(n){var i=t(n);return i.toString=e._path2string,i},Se=e._pathToRelative=function(t){var n=je(t);if(n.rel)return _e(n.rel);e.is(t,U)&&e.is(t&&t[0],U)||(t=e.parsePathString(t));var i=[],r=0,o=0,a=0,s=0,l=0;"M"==t[0][0]&&(r=t[0][1],o=t[0][2],a=r,s=o,l++,i.push(["M",r,o]));for(var c=l,d=t.length;d>c;c++){var u=i[c]=[],h=t[c];if(h[0]!=D.call(h[0]))switch(u[0]=D.call(h[0]),u[0]){case"a":u[1]=h[1],u[2]=h[2],u[3]=h[3],u[4]=h[4],u[5]=h[5],u[6]=+(h[6]-r).toFixed(3),u[7]=+(h[7]-o).toFixed(3);break;case"v":u[1]=+(h[1]-o).toFixed(3);break;case"m":a=h[1],s=h[2];default:for(var f=1,p=h.length;p>f;f++)u[f]=+(h[f]-(f%2?r:o)).toFixed(3)}else{u=i[c]=[],"m"==h[0]&&(a=h[1]+r,s=h[2]+o);for(var m=0,g=h.length;g>m;m++)i[c][m]=h[m]}var v=i[c].length;switch(i[c][0]){case"z":r=a,o=s;break;case"h":r+=+i[c][v-1];break;case"v":o+=+i[c][v-1];break;default:r+=+i[c][v-2],o+=+i[c][v-1]}}return i.toString=e._path2string,n.rel=_e(i),i},Ie=e._pathToAbsolute=function(t){var n=je(t);if(n.abs)return _e(n.abs);if(e.is(t,U)&&e.is(t&&t[0],U)||(t=e.parsePathString(t)),!t||!t.length)return[["M",0,0]];var i=[],r=0,a=0,s=0,l=0,c=0;"M"==t[0][0]&&(r=+t[0][1],a=+t[0][2],s=r,l=a,c++,i[0]=["M",r,a]);for(var d,u,h=3==t.length&&"M"==t[0][0]&&"R"==t[1][0].toUpperCase()&&"Z"==t[2][0].toUpperCase(),f=c,p=t.length;p>f;f++){if(i.push(d=[]),u=t[f],u[0]!=Z.call(u[0]))switch(d[0]=Z.call(u[0]),d[0]){case"A":d[1]=u[1],d[2]=u[2],d[3]=u[3],d[4]=u[4],d[5]=u[5],d[6]=+(u[6]+r),d[7]=+(u[7]+a);break;case"V":d[1]=+u[1]+a;break;case"H":d[1]=+u[1]+r;break;case"R":for(var m=[r,a][I](u.slice(1)),g=2,v=m.length;v>g;g++)m[g]=+m[g]+r,m[++g]=+m[g]+a;i.pop(),i=i[I](o(m,h));break;case"M":s=+u[1]+r,l=+u[2]+a;default:for(g=1,v=u.length;v>g;g++)d[g]=+u[g]+(g%2?r:a)}else if("R"==u[0])m=[r,a][I](u.slice(1)),i.pop(),i=i[I](o(m,h)),d=["R"][I](u.slice(-2));else for(var y=0,b=u.length;b>y;y++)d[y]=u[y];switch(d[0]){case"Z":r=s,a=l;break;case"H":r=d[1];break;case"V":a=d[1];break;case"M":s=d[d.length-2],l=d[d.length-1];default:r=d[d.length-2],a=d[d.length-1]}}return i.toString=e._path2string,n.abs=_e(i),i},Pe=function(e,t,n,i){return[e,t,n,i,n,i]},Me=function(e,t,n,i,r,o){var a=1/3,s=2/3;return[a*e+s*n,a*t+s*i,a*r+s*n,a*o+s*i,r,o]},Qe=function(e,t,n,r,o,a,s,l,c,d){var u,h=120*V/180,f=V/180*(+o||0),p=[],m=i(function(e,t,n){var i=e*H.cos(n)-t*H.sin(n),r=e*H.sin(n)+t*H.cos(n);return{x:i,y:r}});if(d)j=d[0],T=d[1],x=d[2],C=d[3];else{u=m(e,t,-f),e=u.x,t=u.y,u=m(l,c,-f),l=u.x,c=u.y;var g=(H.cos(V/180*o),H.sin(V/180*o),(e-l)/2),v=(t-c)/2,y=g*g/(n*n)+v*v/(r*r);y>1&&(y=H.sqrt(y),n=y*n,r=y*r);var b=n*n,w=r*r,k=(a==s?-1:1)*H.sqrt(G((b*w-b*v*v-w*g*g)/(b*v*v+w*g*g))),x=k*n*v/r+(e+l)/2,C=k*-r*g/n+(t+c)/2,j=H.asin(((t-C)/r).toFixed(9)),T=H.asin(((c-C)/r).toFixed(9));j=x>e?V-j:j,T=x>l?V-T:T,0>j&&(j=2*V+j),0>T&&(T=2*V+T),s&&j>T&&(j-=2*V),!s&&T>j&&(T-=2*V)}var _=T-j;if(G(_)>h){var S=T,P=l,M=c;T=j+h*(s&&T>j?1:-1),l=x+n*H.cos(T),c=C+r*H.sin(T),p=Qe(l,c,n,r,o,0,s,P,M,[T,S,x,C])}_=T-j;var Q=H.cos(j),B=H.sin(j),O=H.cos(T),A=H.sin(T),D=H.tan(_/4),N=4/3*n*D,L=4/3*r*D,R=[e,t],F=[e+N*B,t-L*Q],z=[l+N*A,c-L*O],U=[l,c];if(F[0]=2*R[0]-F[0],F[1]=2*R[1]-F[1],d)return[F,z,U][I](p);p=[F,z,U][I](p).join()[E](",");for(var W=[],q=0,$=p.length;$>q;q++)W[q]=q%2?m(p[q-1],p[q],f).y:m(p[q],p[q+1],f).x;return W},Be=function(e,t,n,i,r,o,a,s,l){var c=1-l;return{x:R(c,3)*e+3*R(c,2)*l*n+3*c*l*l*r+R(l,3)*a,y:R(c,3)*t+3*R(c,2)*l*i+3*c*l*l*o+R(l,3)*s}},Ee=i(function(e,t,n,i,r,o,a,s){var l,c=r-2*n+e-(a-2*r+n),d=2*(n-e)-2*(r-n),u=e-n,h=(-d+H.sqrt(d*d-4*c*u))/2/c,f=(-d-H.sqrt(d*d-4*c*u))/2/c,p=[t,s],m=[e,a];return G(h)>"1e12"&&(h=.5),G(f)>"1e12"&&(f=.5),h>0&&1>h&&(l=Be(e,t,n,i,r,o,a,s,h),m.push(l.x),p.push(l.y)),f>0&&1>f&&(l=Be(e,t,n,i,r,o,a,s,f),m.push(l.x),p.push(l.y)),c=o-2*i+t-(s-2*o+i),d=2*(i-t)-2*(o-i),u=t-i,h=(-d+H.sqrt(d*d-4*c*u))/2/c,f=(-d-H.sqrt(d*d-4*c*u))/2/c,G(h)>"1e12"&&(h=.5),G(f)>"1e12"&&(f=.5),h>0&&1>h&&(l=Be(e,t,n,i,r,o,a,s,h),m.push(l.x),p.push(l.y)),f>0&&1>f&&(l=Be(e,t,n,i,r,o,a,s,f),m.push(l.x),p.push(l.y)),{min:{x:L[S](0,m),y:L[S](0,p)},max:{x:N[S](0,m),y:N[S](0,p)}}}),Oe=e._path2curve=i(function(e,t){var n=!t&&je(e);if(!t&&n.curve)return _e(n.curve);for(var i=Ie(e),r=t&&Ie(t),o={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},a={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},s=(function(e,t){var n,i;if(!e)return["C",t.x,t.y,t.x,t.y,t.x,t.y];switch(!(e[0]in{T:1,Q:1})&&(t.qx=t.qy=null),e[0]){case"M":t.X=e[1],t.Y=e[2];break;case"A":e=["C"][I](Qe[S](0,[t.x,t.y][I](e.slice(1))));break;case"S":n=t.x+(t.x-(t.bx||t.x)),i=t.y+(t.y-(t.by||t.y)),e=["C",n,i][I](e.slice(1));break;case"T":t.qx=t.x+(t.x-(t.qx||t.x)),t.qy=t.y+(t.y-(t.qy||t.y)),e=["C"][I](Me(t.x,t.y,t.qx,t.qy,e[1],e[2]));break;case"Q":t.qx=e[1],t.qy=e[2],e=["C"][I](Me(t.x,t.y,e[1],e[2],e[3],e[4]));break;case"L":e=["C"][I](Pe(t.x,t.y,e[1],e[2]));break;case"H":e=["C"][I](Pe(t.x,t.y,e[1],t.y));break;case"V":e=["C"][I](Pe(t.x,t.y,t.x,e[1]));break;case"Z":e=["C"][I](Pe(t.x,t.y,t.X,t.Y))}return e}),l=function(e,t){if(e[t].length>7){e[t].shift();for(var n=e[t];n.length;)e.splice(t++,0,["C"][I](n.splice(0,6)));e.splice(t,1),u=N(i.length,r&&r.length||0)}},c=function(e,t,n,o,a){e&&t&&"M"==e[a][0]&&"M"!=t[a][0]&&(t.splice(a,0,["M",o.x,o.y]),n.bx=0,n.by=0,n.x=e[a][1],n.y=e[a][2],u=N(i.length,r&&r.length||0))},d=0,u=N(i.length,r&&r.length||0);u>d;d++){i[d]=s(i[d],o),l(i,d),r&&(r[d]=s(r[d],a)),r&&l(r,d),c(i,r,o,a,d),c(r,i,a,o,d);var h=i[d],f=r&&r[d],p=h.length,m=r&&f.length;o.x=h[p-2],o.y=h[p-1],o.bx=X(h[p-4])||o.x,o.by=X(h[p-3])||o.y,a.bx=r&&(X(f[m-4])||a.x),a.by=r&&(X(f[m-3])||a.y),a.x=r&&f[m-2],a.y=r&&f[m-1]}return r||(n.curve=_e(i)),r?[i,r]:i},null,_e),Ae=(e._parseDots=i(function(t){for(var n=[],i=0,r=t.length;r>i;i++){var o={},a=t[i].match(/^([^:]*):?([\d\.]*)/);if(o.color=e.getRGB(a[1]),o.color.error)return null;o.color=o.color.hex,a[2]&&(o.offset=a[2]+"%"),n.push(o)}for(i=1,r=n.length-1;r>i;i++)if(!n[i].offset){for(var s=X(n[i-1].offset||0),l=0,c=i+1;r>c;c++)if(n[c].offset){l=n[c].offset;break}l||(l=100,c=r),l=X(l);for(var d=(l-s)/(c-i+1);c>i;i++)s+=d,n[i].offset=s+"%"}return n}),e._tear=function(e,t){e==t.top&&(t.top=e.prev),e==t.bottom&&(t.bottom=e.next),e.next&&(e.next.prev=e.prev),e.prev&&(e.prev.next=e.next)}),De=(e._tofront=function(e,t){t.top!==e&&(Ae(e,t),e.next=null,e.prev=t.top,t.top.next=e,t.top=e)},e._toback=function(e,t){t.bottom!==e&&(Ae(e,t),e.next=t.bottom,e.prev=null,t.bottom.prev=e,t.bottom=e)},e._insertafter=function(e,t,n){Ae(e,n),t==n.top&&(n.top=e),t.next&&(t.next.prev=e),e.next=t.next,e.prev=t,t.next=e},e._insertbefore=function(e,t,n){Ae(e,n),t==n.bottom&&(n.bottom=e),t.prev&&(t.prev.next=e),e.prev=t.prev,t.prev=e,e.next=t},e.toMatrix=function(e,t){var n=Te(e),i={_:{transform:M},getBBox:function(){return n}};return He(i,t),i.matrix}),He=(e.transformPath=function(e,t){return me(e,De(e,t))},e._extractTransform=function(t,n){if(null==n)return t._.transform;n=B(n).replace(/\.{3}|\u2026/g,t._.transform||M);var i=e.parseTransformString(n),r=0,o=0,a=0,s=1,l=1,c=t._,d=new h;if(c.transform=i||[],i)for(var u=0,f=i.length;f>u;u++){var p,m,g,v,y,b=i[u],w=b.length,k=B(b[0]).toLowerCase(),x=b[0]!=k,C=x?d.invert():0;"t"==k&&3==w?x?(p=C.x(0,0),m=C.y(0,0),g=C.x(b[1],b[2]),v=C.y(b[1],b[2]),d.translate(g-p,v-m)):d.translate(b[1],b[2]):"r"==k?2==w?(y=y||t.getBBox(1),d.rotate(b[1],y.x+y.width/2,y.y+y.height/2),r+=b[1]):4==w&&(x?(g=C.x(b[2],b[3]),v=C.y(b[2],b[3]),d.rotate(b[1],g,v)):d.rotate(b[1],b[2],b[3]),r+=b[1]):"s"==k?2==w||3==w?(y=y||t.getBBox(1),d.scale(b[1],b[w-1],y.x+y.width/2,y.y+y.height/2),s*=b[1],l*=b[w-1]):5==w&&(x?(g=C.x(b[3],b[4]),v=C.y(b[3],b[4]),d.scale(b[1],b[2],g,v)):d.scale(b[1],b[2],b[3],b[4]),s*=b[1],l*=b[2]):"m"==k&&7==w&&d.add(b[1],b[2],b[3],b[4],b[5],b[6]),c.dirtyT=1,t.matrix=d}t.matrix=d,c.sx=s,c.sy=l,c.deg=r,c.dx=o=d.e,c.dy=a=d.f,1==s&&1==l&&!r&&c.bbox?(c.bbox.x+=+o,c.bbox.y+=+a):c.dirtyT=1}),Ne=function(e){var t=e[0];switch(t.toLowerCase()){case"t":return[t,0,0];case"m":return[t,1,0,0,1,0,0];case"r":return 4==e.length?[t,0,e[2],e[3]]:[t,0];case"s":return 5==e.length?[t,1,1,e[3],e[4]]:3==e.length?[t,1,1]:[t,1]}},Le=e._equaliseTransform=function(t,n){n=B(n).replace(/\.{3}|\u2026/g,t),t=e.parseTransformString(t)||[],n=e.parseTransformString(n)||[];for(var i,r,o,a,s=N(t.length,n.length),l=[],c=[],d=0;s>d;d++){if(o=t[d]||Ne(n[d]),a=n[d]||Ne(o),o[0]!=a[0]||"r"==o[0].toLowerCase()&&(o[2]!=a[2]||o[3]!=a[3])||"s"==o[0].toLowerCase()&&(o[3]!=a[3]||o[4]!=a[4]))return;for(l[d]=[],c[d]=[],i=0,r=N(o.length,a.length);r>i;i++)i in o&&(l[d][i]=o[i]),i in a&&(c[d][i]=a[i])}return{from:l,to:c}};e._getContainer=function(t,n,i,r){var o;return o=null!=r||e.is(t,"object")?t:j.doc.getElementById(t),null!=o?o.tagName?null==n?{container:o,width:o.style.pixelWidth||o.offsetWidth,height:o.style.pixelHeight||o.offsetHeight}:{container:o,width:n,height:i}:{container:1,x:t,y:n,width:i,height:r}:void 0},e.pathToRelative=Se,e._engine={},e.path2curve=Oe,e.matrix=function(e,t,n,i,r,o){return new h(e,t,n,i,r,o)},function(t){function n(e){return e[0]*e[0]+e[1]*e[1]}function i(e){var t=H.sqrt(n(e));e[0]&&(e[0]/=t),e[1]&&(e[1]/=t)}t.add=function(e,t,n,i,r,o){var a,s,l,c,d=[[],[],[]],u=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],f=[[e,n,r],[t,i,o],[0,0,1]];for(e&&e instanceof h&&(f=[[e.a,e.c,e.e],[e.b,e.d,e.f],[0,0,1]]),a=0;3>a;a++)for(s=0;3>s;s++){for(c=0,l=0;3>l;l++)c+=u[a][l]*f[l][s];d[a][s]=c}this.a=d[0][0],this.b=d[1][0],this.c=d[0][1],this.d=d[1][1],this.e=d[0][2],this.f=d[1][2]},t.invert=function(){var e=this,t=e.a*e.d-e.b*e.c;return new h(e.d/t,-e.b/t,-e.c/t,e.a/t,(e.c*e.f-e.d*e.e)/t,(e.b*e.e-e.a*e.f)/t)},t.clone=function(){return new h(this.a,this.b,this.c,this.d,this.e,this.f)},t.translate=function(e,t){this.add(1,0,0,1,e,t)},t.scale=function(e,t,n,i){
null==t&&(t=e),(n||i)&&this.add(1,0,0,1,n,i),this.add(e,0,0,t,0,0),(n||i)&&this.add(1,0,0,1,-n,-i)},t.rotate=function(t,n,i){t=e.rad(t),n=n||0,i=i||0;var r=+H.cos(t).toFixed(9),o=+H.sin(t).toFixed(9);this.add(r,o,-o,r,n,i),this.add(1,0,0,1,-n,-i)},t.x=function(e,t){return e*this.a+t*this.c+this.e},t.y=function(e,t){return e*this.b+t*this.d+this.f},t.get=function(e){return+this[B.fromCharCode(97+e)].toFixed(4)},t.toString=function(){return e.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()},t.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"},t.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]},t.split=function(){var t={};t.dx=this.e,t.dy=this.f;var r=[[this.a,this.c],[this.b,this.d]];t.scalex=H.sqrt(n(r[0])),i(r[0]),t.shear=r[0][0]*r[1][0]+r[0][1]*r[1][1],r[1]=[r[1][0]-r[0][0]*t.shear,r[1][1]-r[0][1]*t.shear],t.scaley=H.sqrt(n(r[1])),i(r[1]),t.shear/=t.scaley;var o=-r[0][1],a=r[1][1];return 0>a?(t.rotate=e.deg(H.acos(a)),0>o&&(t.rotate=360-t.rotate)):t.rotate=e.deg(H.asin(o)),t.isSimple=!(+t.shear.toFixed(9)||t.scalex.toFixed(9)!=t.scaley.toFixed(9)&&t.rotate),t.isSuperSimple=!+t.shear.toFixed(9)&&t.scalex.toFixed(9)==t.scaley.toFixed(9)&&!t.rotate,t.noRotation=!+t.shear.toFixed(9)&&!t.rotate,t},t.toTransformString=function(e){var t=e||this[E]();return t.isSimple?(t.scalex=+t.scalex.toFixed(4),t.scaley=+t.scaley.toFixed(4),t.rotate=+t.rotate.toFixed(4),(t.dx||t.dy?"t"+[t.dx,t.dy]:M)+(1!=t.scalex||1!=t.scaley?"s"+[t.scalex,t.scaley,0,0]:M)+(t.rotate?"r"+[t.rotate,0,0]:M)):"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]}}(h.prototype);var Ge=navigator.userAgent.match(/Version\/(.*?)\s/)||navigator.userAgent.match(/Chrome\/(\d+)/);"Apple Computer, Inc."==navigator.vendor&&(Ge&&Ge[1]<4||"iP"==navigator.platform.slice(0,2))||"Google Inc."==navigator.vendor&&Ge&&Ge[1]<8?b.safari=function(){var e=this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});setTimeout(function(){e.remove()})}:b.safari=de;for(var Re=function(){this.returnValue=!1},Ve=function(){return this.originalEvent.preventDefault()},Fe=function(){this.cancelBubble=!0},ze=function(){return this.originalEvent.stopPropagation()},Ue=function(){return j.doc.addEventListener?function(e,t,n,i){var r=P&&A[t]?A[t]:t,o=function(r){var o=j.doc.documentElement.scrollTop||j.doc.body.scrollTop,a=j.doc.documentElement.scrollLeft||j.doc.body.scrollLeft,s=r.clientX+a,l=r.clientY+o;if(P&&A[C](t))for(var c=0,d=r.targetTouches&&r.targetTouches.length;d>c;c++)if(r.targetTouches[c].target==e){var u=r;r=r.targetTouches[c],r.originalEvent=u,r.preventDefault=Ve,r.stopPropagation=ze;break}return n.call(i,r,s,l)};return e.addEventListener(r,o,!1),function(){return e.removeEventListener(r,o,!1),!0}}:j.doc.attachEvent?function(e,t,n,i){var r=function(e){e=e||j.win.event;var t=j.doc.documentElement.scrollTop||j.doc.body.scrollTop,r=j.doc.documentElement.scrollLeft||j.doc.body.scrollLeft,o=e.clientX+r,a=e.clientY+t;return e.preventDefault=e.preventDefault||Re,e.stopPropagation=e.stopPropagation||Fe,n.call(i,e,o,a)};e.attachEvent("on"+t,r);var o=function(){return e.detachEvent("on"+t,r),!0};return o}:void 0}(),We=[],qe=function(e){for(var t,n=e.clientX,i=e.clientY,r=j.doc.documentElement.scrollTop||j.doc.body.scrollTop,o=j.doc.documentElement.scrollLeft||j.doc.body.scrollLeft,a=We.length;a--;){if(t=We[a],P){for(var s,l=e.touches.length;l--;)if(s=e.touches[l],s.identifier==t.el._drag.id){n=s.clientX,i=s.clientY,(e.originalEvent?e.originalEvent:e).preventDefault();break}}else e.preventDefault();var c,d=t.el.node,u=d.nextSibling,h=d.parentNode,f=d.style.display;j.win.opera&&h.removeChild(d),d.style.display="none",c=t.el.paper.getElementByPoint(n,i),d.style.display=f,j.win.opera&&(u?h.insertBefore(d,u):h.appendChild(d)),c&&eve("raphael.drag.over."+t.el.id,t.el,c),n+=o,i+=r,eve("raphael.drag.move."+t.el.id,t.move_scope||t.el,n-t.el._drag.x,i-t.el._drag.y,n,i,e)}},$e=function(t){e.unmousemove(qe).unmouseup($e);for(var n,i=We.length;i--;)n=We[i],n.el._drag={},eve("raphael.drag.end."+n.el.id,n.end_scope||n.start_scope||n.move_scope||n.el,t);We=[]},Ke=e.el={},Je=O.length;Je--;)!function(t){e[t]=Ke[t]=function(n,i){return e.is(n,"function")&&(this.events=this.events||[],this.events.push({name:t,f:n,unbind:Ue(this.shape||this.node||j.doc,t,n,i||this)})),this},e["un"+t]=Ke["un"+t]=function(e){for(var n=this.events||[],i=n.length;i--;)if(n[i].name==t&&n[i].f==e)return n[i].unbind(),n.splice(i,1),!n.length&&delete this.events,this;return this}}(O[Je]);Ke.data=function(t,n){var i=le[this.id]=le[this.id]||{};if(1==arguments.length){if(e.is(t,"object")){for(var r in t)t[C](r)&&this.data(r,t[r]);return this}return eve("raphael.data.get."+this.id,this,i[t],t),i[t]}return i[t]=n,eve("raphael.data.set."+this.id,this,n,t),this},Ke.removeData=function(e){return null==e?le[this.id]={}:le[this.id]&&delete le[this.id][e],this},Ke.hover=function(e,t,n,i){return this.mouseover(e,n).mouseout(t,i||n)},Ke.unhover=function(e,t){return this.unmouseover(e).unmouseout(t)};var Xe=[];Ke.drag=function(t,n,i,r,o,a){function s(s){(s.originalEvent||s).preventDefault();var l=j.doc.documentElement.scrollTop||j.doc.body.scrollTop,c=j.doc.documentElement.scrollLeft||j.doc.body.scrollLeft;this._drag.x=s.clientX+c,this._drag.y=s.clientY+l,this._drag.id=s.identifier,!We.length&&e.mousemove(qe).mouseup($e),We.push({el:this,move_scope:r,start_scope:o,end_scope:a}),n&&eve.on("raphael.drag.start."+this.id,n),t&&eve.on("raphael.drag.move."+this.id,t),i&&eve.on("raphael.drag.end."+this.id,i),eve("raphael.drag.start."+this.id,o||r||this,s.clientX+c,s.clientY+l,s)}return this._drag={},Xe.push({el:this,start:s}),this.mousedown(s),this},Ke.onDragOver=function(e){e?eve.on("raphael.drag.over."+this.id,e):eve.unbind("raphael.drag.over."+this.id)},Ke.undrag=function(){for(var t=Xe.length;t--;)Xe[t].el==this&&(this.unmousedown(Xe[t].start),Xe.splice(t,1),eve.unbind("raphael.drag.*."+this.id));!Xe.length&&e.unmousemove(qe).unmouseup($e)},b.circle=function(t,n,i){var r=e._engine.circle(this,t||0,n||0,i||0);return this.__set__&&this.__set__.push(r),r},b.rect=function(t,n,i,r,o){var a=e._engine.rect(this,t||0,n||0,i||0,r||0,o||0);return this.__set__&&this.__set__.push(a),a},b.ellipse=function(t,n,i,r){var o=e._engine.ellipse(this,t||0,n||0,i||0,r||0);return this.__set__&&this.__set__.push(o),o},b.path=function(t){t&&!e.is(t,z)&&!e.is(t[0],U)&&(t+=M);var n=e._engine.path(e.format[S](e,arguments),this);return this.__set__&&this.__set__.push(n),n},b.image=function(t,n,i,r,o){var a=e._engine.image(this,t||"about:blank",n||0,i||0,r||0,o||0);return this.__set__&&this.__set__.push(a),a},b.text=function(t,n,i){var r=e._engine.text(this,t||0,n||0,B(i));return this.__set__&&this.__set__.push(r),r},b.set=function(t){!e.is(t,"array")&&(t=Array.prototype.splice.call(arguments,0,arguments.length));var n=new ct(t);return this.__set__&&this.__set__.push(n),n},b.setStart=function(e){this.__set__=e||this.set()},b.setFinish=function(e){var t=this.__set__;return delete this.__set__,t},b.setSize=function(t,n){return e._engine.setSize.call(this,t,n)},b.setViewBox=function(t,n,i,r,o){return e._engine.setViewBox.call(this,t,n,i,r,o)},b.top=b.bottom=null,b.raphael=e;var Ye=function(e){var t=e.getBoundingClientRect(),n=e.ownerDocument,i=n.body,r=n.documentElement,o=r.clientTop||i.clientTop||0,a=r.clientLeft||i.clientLeft||0,s=t.top+(j.win.pageYOffset||r.scrollTop||i.scrollTop)-o,l=t.left+(j.win.pageXOffset||r.scrollLeft||i.scrollLeft)-a;return{y:s,x:l}};b.getElementByPoint=function(e,t){var n=this,i=n.canvas,r=j.doc.elementFromPoint(e,t);if(j.win.opera&&"svg"==r.tagName){var o=Ye(i),a=i.createSVGRect();a.x=e-o.x,a.y=t-o.y,a.width=a.height=1;var s=i.getIntersectionList(a,null);s.length&&(r=s[s.length-1])}if(!r)return null;for(;r.parentNode&&r!=i.parentNode&&!r.raphael;)r=r.parentNode;return r==n.canvas.parentNode&&(r=i),r=r&&r.raphael?n.getById(r.raphaelid):null},b.getById=function(e){for(var t=this.bottom;t;){if(t.id==e)return t;t=t.next}return null},b.forEach=function(e,t){for(var n=this.bottom;n;){if(e.call(t,n)===!1)return this;n=n.next}return this},b.getElementsByPoint=function(e,t){var n=this.set();return this.forEach(function(i){i.isPointInside(e,t)&&n.push(i)}),n},Ke.isPointInside=function(t,n){var i=this.realPath=this.realPath||pe[this.type](this);return e.isPointInsidePath(i,t,n)},Ke.getBBox=function(e){if(this.removed)return{};var t=this._;return e?((t.dirty||!t.bboxwt)&&(this.realPath=pe[this.type](this),t.bboxwt=Te(this.realPath),t.bboxwt.toString=f,t.dirty=0),t.bboxwt):((t.dirty||t.dirtyT||!t.bbox)&&((t.dirty||!this.realPath)&&(t.bboxwt=0,this.realPath=pe[this.type](this)),t.bbox=Te(me(this.realPath,this.matrix)),t.bbox.toString=f,t.dirty=t.dirtyT=0),t.bbox)},Ke.clone=function(){if(this.removed)return null;var e=this.paper[this.type]().attr(this.attr());return this.__set__&&this.__set__.push(e),e},Ke.glow=function(e){if("text"==this.type)return null;e=e||{};var t={width:(e.width||10)+(+this.attr("stroke-width")||1),fill:e.fill||!1,opacity:e.opacity||.5,offsetx:e.offsetx||0,offsety:e.offsety||0,color:e.color||"#000"},n=t.width/2,i=this.paper,r=i.set(),o=this.realPath||pe[this.type](this);o=this.matrix?me(o,this.matrix):o;for(var a=1;n+1>a;a++)r.push(i.path(o).attr({stroke:t.color,fill:t.fill?t.color:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(t.width/n*a).toFixed(3),opacity:+(t.opacity/n).toFixed(3)}));return r.insertBefore(this).translate(t.offsetx,t.offsety)};var Ze=function(t,n,i,r,o,a,c,d,u){return null==u?s(t,n,i,r,o,a,c,d):e.findDotsAtSegment(t,n,i,r,o,a,c,d,l(t,n,i,r,o,a,c,d,u))},et=function(t,n){return function(i,r,o){i=Oe(i);for(var a,s,l,c,d,u="",h={},f=0,p=0,m=i.length;m>p;p++){if(l=i[p],"M"==l[0])a=+l[1],s=+l[2];else{if(c=Ze(a,s,l[1],l[2],l[3],l[4],l[5],l[6]),f+c>r){if(n&&!h.start){if(d=Ze(a,s,l[1],l[2],l[3],l[4],l[5],l[6],r-f),u+=["C"+d.start.x,d.start.y,d.m.x,d.m.y,d.x,d.y],o)return u;h.start=u,u=["M"+d.x,d.y+"C"+d.n.x,d.n.y,d.end.x,d.end.y,l[5],l[6]].join(),f+=c,a=+l[5],s=+l[6];continue}if(!t&&!n)return d=Ze(a,s,l[1],l[2],l[3],l[4],l[5],l[6],r-f),{x:d.x,y:d.y,alpha:d.alpha}}f+=c,a=+l[5],s=+l[6]}u+=l.shift()+l}return h.end=u,d=t?f:n?h:e.findDotsAtSegment(a,s,l[0],l[1],l[2],l[3],l[4],l[5],1),d.alpha&&(d={x:d.x,y:d.y,alpha:d.alpha}),d}},tt=et(1),nt=et(),it=et(0,1);e.getTotalLength=tt,e.getPointAtLength=nt,e.getSubpath=function(e,t,n){if(this.getTotalLength(e)-n<1e-6)return it(e,t).end;var i=it(e,n,1);return t?it(i,t).end:i},Ke.getTotalLength=function(){return"path"==this.type?this.node.getTotalLength?this.node.getTotalLength():tt(this.attrs.path):void 0},Ke.getPointAtLength=function(e){return"path"==this.type?nt(this.attrs.path,e):void 0},Ke.getSubpath=function(t,n){return"path"==this.type?e.getSubpath(this.attrs.path,t,n):void 0};var rt=e.easing_formulas={linear:function(e){return e},"<":function(e){return R(e,1.7)},">":function(e){return R(e,.48)},"<>":function(e){var t=.48-e/1.04,n=H.sqrt(.1734+t*t),i=n-t,r=R(G(i),1/3)*(0>i?-1:1),o=-n-t,a=R(G(o),1/3)*(0>o?-1:1),s=r+a+.5;return 3*(1-s)*s*s+s*s*s},backIn:function(e){var t=1.70158;return e*e*((t+1)*e-t)},backOut:function(e){e-=1;var t=1.70158;return e*e*((t+1)*e+t)+1},elastic:function(e){return e==!!e?e:R(2,-10*e)*H.sin((e-.075)*(2*V)/.3)+1},bounce:function(e){var t,n=7.5625,i=2.75;return 1/i>e?t=n*e*e:2/i>e?(e-=1.5/i,t=n*e*e+.75):2.5/i>e?(e-=2.25/i,t=n*e*e+.9375):(e-=2.625/i,t=n*e*e+.984375),t}};rt.easeIn=rt["ease-in"]=rt["<"],rt.easeOut=rt["ease-out"]=rt[">"],rt.easeInOut=rt["ease-in-out"]=rt["<>"],rt["back-in"]=rt.backIn,rt["back-out"]=rt.backOut;var ot=[],at=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,16)},st=function(){for(var t=+new Date,n=0;n<ot.length;n++){var i=ot[n];if(!i.el.removed&&!i.paused){var r,o,a=t-i.start,s=i.ms,l=i.easing,c=i.from,d=i.diff,u=i.to,h=(i.t,i.el),f={},p={};if(i.initstatus?(a=(i.initstatus*i.anim.top-i.prev)/(i.percent-i.prev)*s,i.status=i.initstatus,delete i.initstatus,i.stop&&ot.splice(n--,1)):i.status=(i.prev+(i.percent-i.prev)*(a/s))/i.anim.top,!(0>a))if(s>a){var m=l(a/s);for(var v in c)if(c[C](v)){switch(te[v]){case F:r=+c[v]+m*s*d[v];break;case"colour":r="rgb("+[lt(J(c[v].r+m*s*d[v].r)),lt(J(c[v].g+m*s*d[v].g)),lt(J(c[v].b+m*s*d[v].b))].join(",")+")";break;case"path":r=[];for(var y=0,b=c[v].length;b>y;y++){r[y]=[c[v][y][0]];for(var w=1,k=c[v][y].length;k>w;w++)r[y][w]=+c[v][y][w]+m*s*d[v][y][w];r[y]=r[y].join(Q)}r=r.join(Q);break;case"transform":if(d[v].real)for(r=[],y=0,b=c[v].length;b>y;y++)for(r[y]=[c[v][y][0]],w=1,k=c[v][y].length;k>w;w++)r[y][w]=c[v][y][w]+m*s*d[v][y][w];else{var x=function(e){return+c[v][e]+m*s*d[v][e]};r=[["m",x(0),x(1),x(2),x(3),x(4),x(5)]]}break;case"csv":if("clip-rect"==v)for(r=[],y=4;y--;)r[y]=+c[v][y]+m*s*d[v][y];break;default:var j=[][I](c[v]);for(r=[],y=h.paper.customAttributes[v].length;y--;)r[y]=+j[y]+m*s*d[v][y]}f[v]=r}h.attr(f),function(e,t,n){setTimeout(function(){eve("raphael.anim.frame."+e,t,n)})}(h.id,h,i.anim)}else{if(function(t,n,i){setTimeout(function(){eve("raphael.anim.frame."+n.id,n,i),eve("raphael.anim.finish."+n.id,n,i),e.is(t,"function")&&t.call(n)})}(i.callback,h,i.anim),h.attr(u),ot.splice(n--,1),i.repeat>1&&!i.next){for(o in u)u[C](o)&&(p[o]=i.totalOrigin[o]);i.el.attr(p),g(i.anim,i.el,i.anim.percents[0],null,i.totalOrigin,i.repeat-1)}i.next&&!i.stop&&g(i.anim,i.el,i.next,null,i.totalOrigin,i.repeat)}}}e.svg&&h&&h.paper&&h.paper.safari(),ot.length&&at(st)},lt=function(e){return e>255?255:0>e?0:e};Ke.animateWith=function(t,n,i,r,o,a){var s=this;if(s.removed)return a&&a.call(s),s;var l=i instanceof m?i:e.animation(i,r,o,a);g(l,s,l.percents[0],null,s.attr());for(var c=0,d=ot.length;d>c;c++)if(ot[c].anim==n&&ot[c].el==t){ot[d-1].start=ot[c].start;break}return s},Ke.onAnimation=function(e){return e?eve.on("raphael.anim.frame."+this.id,e):eve.unbind("raphael.anim.frame."+this.id),this},m.prototype.delay=function(e){var t=new m(this.anim,this.ms);return t.times=this.times,t.del=+e||0,t},m.prototype.repeat=function(e){var t=new m(this.anim,this.ms);return t.del=this.del,t.times=H.floor(N(e,0))||1,t},e.animation=function(t,n,i,r){if(t instanceof m)return t;(e.is(i,"function")||!i)&&(r=r||i||null,i=null),t=Object(t),n=+n||0;var o,a,s={};for(a in t)t[C](a)&&X(a)!=a&&X(a)+"%"!=a&&(o=!0,s[a]=t[a]);return o?(i&&(s.easing=i),r&&(s.callback=r),new m({100:s},n)):new m(t,n)},Ke.animate=function(t,n,i,r){var o=this;if(o.removed)return r&&r.call(o),o;var a=t instanceof m?t:e.animation(t,n,i,r);return g(a,o,a.percents[0],null,o.attr()),o},Ke.setTime=function(e,t){return e&&null!=t&&this.status(e,L(t,e.ms)/e.ms),this},Ke.status=function(e,t){var n,i,r=[],o=0;if(null!=t)return g(e,this,-1,L(t,1)),this;for(n=ot.length;n>o;o++)if(i=ot[o],i.el.id==this.id&&(!e||i.anim==e)){if(e)return i.status;r.push({anim:i.anim,status:i.status})}return e?0:r},Ke.pause=function(e){for(var t=0;t<ot.length;t++)ot[t].el.id!=this.id||e&&ot[t].anim!=e||eve("raphael.anim.pause."+this.id,this,ot[t].anim)!==!1&&(ot[t].paused=!0);return this},Ke.resume=function(e){for(var t=0;t<ot.length;t++)if(ot[t].el.id==this.id&&(!e||ot[t].anim==e)){var n=ot[t];eve("raphael.anim.resume."+this.id,this,n.anim)!==!1&&(delete n.paused,this.status(n.anim,n.status))}return this},Ke.stop=function(e){for(var t=0;t<ot.length;t++)ot[t].el.id!=this.id||e&&ot[t].anim!=e||eve("raphael.anim.stop."+this.id,this,ot[t].anim)!==!1&&ot.splice(t--,1);return this},eve.on("raphael.remove",v),eve.on("raphael.clear",v),Ke.toString=function(){return"Raphaël’s object"};var ct=function(e){if(this.items=[],this.length=0,this.type="set",e)for(var t=0,n=e.length;n>t;t++)!e[t]||e[t].constructor!=Ke.constructor&&e[t].constructor!=ct||(this[this.items.length]=this.items[this.items.length]=e[t],this.length++)},dt=ct.prototype;dt.push=function(){for(var e,t,n=0,i=arguments.length;i>n;n++)e=arguments[n],!e||e.constructor!=Ke.constructor&&e.constructor!=ct||(t=this.items.length,this[t]=this.items[t]=e,this.length++);return this},dt.pop=function(){return this.length&&delete this[this.length--],this.items.pop()},dt.forEach=function(e,t){for(var n=0,i=this.items.length;i>n;n++)if(e.call(t,this.items[n],n)===!1)return this;return this};for(var ut in Ke)Ke[C](ut)&&(dt[ut]=function(e){return function(){var t=arguments;return this.forEach(function(n){n[e][S](n,t)})}}(ut));dt.attr=function(t,n){if(t&&e.is(t,U)&&e.is(t[0],"object"))for(var i=0,r=t.length;r>i;i++)this.items[i].attr(t[i]);else for(var o=0,a=this.items.length;a>o;o++)this.items[o].attr(t,n);return this},dt.clear=function(){for(;this.length;)this.pop()},dt.splice=function(e,t,n){e=0>e?N(this.length+e,0):e,t=N(0,L(this.length-e,t));var i,r=[],o=[],a=[];for(i=2;i<arguments.length;i++)a.push(arguments[i]);for(i=0;t>i;i++)o.push(this[e+i]);for(;i<this.length-e;i++)r.push(this[e+i]);var s=a.length;for(i=0;i<s+r.length;i++)this.items[e+i]=this[e+i]=s>i?a[i]:r[i-s];for(i=this.items.length=this.length-=t-s;this[i];)delete this[i++];return new ct(o)},dt.exclude=function(e){for(var t=0,n=this.length;n>t;t++)if(this[t]==e)return this.splice(t,1),!0},dt.animate=function(t,n,i,r){(e.is(i,"function")||!i)&&(r=i||null);var o,a,s=this.items.length,l=s,c=this;if(!s)return this;r&&(a=function(){!--s&&r.call(c)}),i=e.is(i,z)?i:a;var d=e.animation(t,n,i,a);for(o=this.items[--l].animate(d);l--;)this.items[l]&&!this.items[l].removed&&this.items[l].animateWith(o,d,d);return this},dt.insertAfter=function(e){for(var t=this.items.length;t--;)this.items[t].insertAfter(e);return this},dt.getBBox=function(){for(var e=[],t=[],n=[],i=[],r=this.items.length;r--;)if(!this.items[r].removed){var o=this.items[r].getBBox();e.push(o.x),t.push(o.y),n.push(o.x+o.width),i.push(o.y+o.height)}return e=L[S](0,e),t=L[S](0,t),n=N[S](0,n),i=N[S](0,i),{x:e,y:t,x2:n,y2:i,width:n-e,height:i-t}},dt.clone=function(e){e=new ct;for(var t=0,n=this.items.length;n>t;t++)e.push(this.items[t].clone());return e},dt.toString=function(){return"Raphaël‘s set"},e.registerFont=function(e){if(!e.face)return e;this.fonts=this.fonts||{};var t={w:e.w,face:{},glyphs:{}},n=e.face["font-family"];for(var i in e.face)e.face[C](i)&&(t.face[i]=e.face[i]);if(this.fonts[n]?this.fonts[n].push(t):this.fonts[n]=[t],!e.svg){t.face["units-per-em"]=Y(e.face["units-per-em"],10);for(var r in e.glyphs)if(e.glyphs[C](r)){var o=e.glyphs[r];if(t.glyphs[r]={w:o.w,k:{},d:o.d&&"M"+o.d.replace(/[mlcxtrv]/g,function(e){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[e]||"M"})+"z"},o.k)for(var a in o.k)o[C](a)&&(t.glyphs[r].k[a]=o.k[a])}}return e},b.getFont=function(t,n,i,r){if(r=r||"normal",i=i||"normal",n=+n||{normal:400,bold:700,lighter:300,bolder:800}[n]||400,e.fonts){var o=e.fonts[t];if(!o){var a=new RegExp("(^|\\s)"+t.replace(/[^\w\d\s+!~.:_-]/g,M)+"(\\s|$)","i");for(var s in e.fonts)if(e.fonts[C](s)&&a.test(s)){o=e.fonts[s];break}}var l;if(o)for(var c=0,d=o.length;d>c&&(l=o[c],l.face["font-weight"]!=n||l.face["font-style"]!=i&&l.face["font-style"]||l.face["font-stretch"]!=r);c++);return l}},b.print=function(t,n,i,r,o,a,s){a=a||"middle",s=N(L(s||0,1),-1);var l,c=B(i)[E](M),d=0,u=0,h=M;if(e.is(r,i)&&(r=this.getFont(r)),r){l=(o||16)/r.face["units-per-em"];for(var f=r.face.bbox[E](w),p=+f[0],m=f[3]-f[1],g=0,v=+f[1]+("baseline"==a?m+ +r.face.descent:m/2),y=0,b=c.length;b>y;y++){if("\n"==c[y])d=0,x=0,u=0,g+=m;else{var k=u&&r.glyphs[c[y-1]]||{},x=r.glyphs[c[y]];d+=u?(k.w||r.w)+(k.k&&k.k[c[y]]||0)+r.w*s:0,u=1}x&&x.d&&(h+=e.transformPath(x.d,["t",d*l,g*l,"s",l,l,p,v,"t",(t-p)/l,(n-v)/l]))}}return this.path(h).attr({fill:"#000",stroke:"none"})},b.add=function(t){if(e.is(t,"array"))for(var n,i=this.set(),r=0,o=t.length;o>r;r++)n=t[r]||{},k[C](n.type)&&i.push(this[n.type]().attr(n));return i},e.format=function(t,n){var i=e.is(n,U)?[0][I](n):arguments;return t&&e.is(t,z)&&i.length-1&&(t=t.replace(x,function(e,t){return null==i[++t]?M:i[t]})),t||M},e.fullfill=function(){var e=/\{([^\}]+)\}/g,t=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,n=function(e,n,i){var r=i;return n.replace(t,function(e,t,n,i,o){t=t||i,r&&(t in r&&(r=r[t]),"function"==typeof r&&o&&(r=r()))}),r=(null==r||r==i?e:r)+""};return function(t,i){return String(t).replace(e,function(e,t){return n(e,t,i)})}}(),e.ninja=function(){return T.was?j.win.Raphael=T.is:delete Raphael,e},e.st=dt,function(t,n,i){function r(){/in/.test(t.readyState)?setTimeout(r,9):e.eve("raphael.DOMload")}null==t.readyState&&t.addEventListener&&(t.addEventListener(n,i=function(){t.removeEventListener(n,i,!1),t.readyState="complete"},!1),t.readyState="loading"),r()}(document,"DOMContentLoaded"),T.was?j.win.Raphael=e:Raphael=e,eve.on("raphael.DOMload",function(){y=!0})}(),window.Raphael.svg&&function(e){var t="hasOwnProperty",n=String,i=parseFloat,r=parseInt,o=Math,a=o.max,s=o.abs,l=o.pow,c=/[, ]+/,d=e.eve,u="",h=" ",f="http://www.w3.org/1999/xlink",p={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},m={};e.toString=function(){return"Your browser supports SVG.\nYou are running Raphaël "+this.version};var g=function(i,r){if(r){"string"==typeof i&&(i=g(i));for(var o in r)r[t](o)&&("xlink:"==o.substring(0,6)?i.setAttributeNS(f,o.substring(6),n(r[o])):i.setAttribute(o,n(r[o])))}else i=e._g.doc.createElementNS("http://www.w3.org/2000/svg",i),i.style&&(i.style.webkitTapHighlightColor="rgba(0,0,0,0)");return i},v=function(t,r){var c="linear",d=t.id+r,h=.5,f=.5,p=t.node,m=t.paper,v=p.style,y=e._g.doc.getElementById(d);if(!y){if(r=n(r).replace(e._radial_gradient,function(e,t,n){if(c="radial",t&&n){h=i(t),f=i(n);var r=2*(f>.5)-1;l(h-.5,2)+l(f-.5,2)>.25&&(f=o.sqrt(.25-l(h-.5,2))*r+.5)&&.5!=f&&(f=f.toFixed(5)-1e-5*r)}return u}),r=r.split(/\s*\-\s*/),"linear"==c){var b=r.shift();if(b=-i(b),isNaN(b))return null;var w=[0,0,o.cos(e.rad(b)),o.sin(e.rad(b))],k=1/(a(s(w[2]),s(w[3]))||1);w[2]*=k,w[3]*=k,w[2]<0&&(w[0]=-w[2],w[2]=0),w[3]<0&&(w[1]=-w[3],w[3]=0)}var x=e._parseDots(r);if(!x)return null;if(d=d.replace(/[\(\)\s,\xb0#]/g,"_"),t.gradient&&d!=t.gradient.id&&(m.defs.removeChild(t.gradient),delete t.gradient),!t.gradient){y=g(c+"Gradient",{id:d}),t.gradient=y,g(y,"radial"==c?{fx:h,fy:f}:{x1:w[0],y1:w[1],x2:w[2],y2:w[3],gradientTransform:t.matrix.invert()}),m.defs.appendChild(y);for(var C=0,j=x.length;j>C;C++)y.appendChild(g("stop",{offset:x[C].offset?x[C].offset:C?"100%":"0%","stop-color":x[C].color||"#fff"}))}}return g(p,{fill:"url(#"+d+")",opacity:1,"fill-opacity":1}),v.fill=u,v.opacity=1,v.fillOpacity=1,1},y=function(e){var t=e.getBBox(1);g(e.pattern,{patternTransform:e.matrix.invert()+" translate("+t.x+","+t.y+")"})},b=function(i,r,o){if("path"==i.type){for(var a,s,l,c,d,h=n(r).toLowerCase().split("-"),f=i.paper,v=o?"end":"start",y=i.node,b=i.attrs,w=b["stroke-width"],k=h.length,x="classic",C=3,j=3,T=5;k--;)switch(h[k]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":x=h[k];break;case"wide":j=5;break;case"narrow":j=2;break;case"long":C=5;break;case"short":C=2}if("open"==x?(C+=2,j+=2,T+=2,l=1,c=o?4:1,d={fill:"none",stroke:b.stroke}):(c=l=C/2,d={fill:b.stroke,stroke:"none"}),i._.arrows?o?(i._.arrows.endPath&&m[i._.arrows.endPath]--,i._.arrows.endMarker&&m[i._.arrows.endMarker]--):(i._.arrows.startPath&&m[i._.arrows.startPath]--,i._.arrows.startMarker&&m[i._.arrows.startMarker]--):i._.arrows={},"none"!=x){var _="raphael-marker-"+x,S="raphael-marker-"+v+x+C+j;e._g.doc.getElementById(_)?m[_]++:(f.defs.appendChild(g(g("path"),{"stroke-linecap":"round",d:p[x],id:_})),m[_]=1);var I,P=e._g.doc.getElementById(S);P?(m[S]++,I=P.getElementsByTagName("use")[0]):(P=g(g("marker"),{id:S,markerHeight:j,markerWidth:C,orient:"auto",refX:c,refY:j/2}),I=g(g("use"),{"xlink:href":"#"+_,transform:(o?"rotate(180 "+C/2+" "+j/2+") ":u)+"scale("+C/T+","+j/T+")","stroke-width":(1/((C/T+j/T)/2)).toFixed(4)}),P.appendChild(I),f.defs.appendChild(P),m[S]=1),g(I,d);var M=l*("diamond"!=x&&"oval"!=x);o?(a=i._.arrows.startdx*w||0,s=e.getTotalLength(b.path)-M*w):(a=M*w,s=e.getTotalLength(b.path)-(i._.arrows.enddx*w||0)),d={},d["marker-"+v]="url(#"+S+")",(s||a)&&(d.d=Raphael.getSubpath(b.path,a,s)),g(y,d),i._.arrows[v+"Path"]=_,i._.arrows[v+"Marker"]=S,i._.arrows[v+"dx"]=M,i._.arrows[v+"Type"]=x,i._.arrows[v+"String"]=r}else o?(a=i._.arrows.startdx*w||0,s=e.getTotalLength(b.path)-a):(a=0,s=e.getTotalLength(b.path)-(i._.arrows.enddx*w||0)),i._.arrows[v+"Path"]&&g(y,{d:Raphael.getSubpath(b.path,a,s)}),delete i._.arrows[v+"Path"],delete i._.arrows[v+"Marker"],delete i._.arrows[v+"dx"],delete i._.arrows[v+"Type"],delete i._.arrows[v+"String"];for(d in m)if(m[t](d)&&!m[d]){var Q=e._g.doc.getElementById(d);Q&&Q.parentNode.removeChild(Q)}}},w={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},k=function(e,t,i){if(t=w[n(t).toLowerCase()]){for(var r=e.attrs["stroke-width"]||"1",o={round:r,square:r,butt:0}[e.attrs["stroke-linecap"]||i["stroke-linecap"]]||0,a=[],s=t.length;s--;)a[s]=t[s]*r+(s%2?1:-1)*o;g(e.node,{"stroke-dasharray":a.join(",")})}},x=function(i,o){var l=i.node,d=i.attrs,h=l.style.visibility;l.style.visibility="hidden";for(var p in o)if(o[t](p)){if(!e._availableAttrs[t](p))continue;var m=o[p];switch(d[p]=m,p){case"blur":i.blur(m);break;case"href":case"title":case"target":var w=l.parentNode;if("a"!=w.tagName.toLowerCase()){var x=g("a");w.insertBefore(x,l),x.appendChild(l),w=x}"target"==p?w.setAttributeNS(f,"show","blank"==m?"new":m):w.setAttributeNS(f,p,m);break;case"cursor":l.style.cursor=m;break;case"transform":i.transform(m);break;case"arrow-start":b(i,m);break;case"arrow-end":b(i,m,1);break;case"clip-rect":var C=n(m).split(c);if(4==C.length){i.clip&&i.clip.parentNode.parentNode.removeChild(i.clip.parentNode);var T=g("clipPath"),_=g("rect");T.id=e.createUUID(),g(_,{x:C[0],y:C[1],width:C[2],height:C[3]}),T.appendChild(_),i.paper.defs.appendChild(T),g(l,{"clip-path":"url(#"+T.id+")"}),i.clip=_}if(!m){var S=l.getAttribute("clip-path");if(S){var I=e._g.doc.getElementById(S.replace(/(^url\(#|\)$)/g,u));I&&I.parentNode.removeChild(I),g(l,{"clip-path":u}),delete i.clip}}break;case"path":"path"==i.type&&(g(l,{d:m?d.path=e._pathToAbsolute(m):"M0,0"}),i._.dirty=1,i._.arrows&&("startString"in i._.arrows&&b(i,i._.arrows.startString),"endString"in i._.arrows&&b(i,i._.arrows.endString,1)));break;case"width":if(l.setAttribute(p,m),i._.dirty=1,!d.fx)break;p="x",m=d.x;case"x":d.fx&&(m=-d.x-(d.width||0));case"rx":if("rx"==p&&"rect"==i.type)break;case"cx":l.setAttribute(p,m),i.pattern&&y(i),i._.dirty=1;break;case"height":if(l.setAttribute(p,m),i._.dirty=1,!d.fy)break;p="y",m=d.y;case"y":d.fy&&(m=-d.y-(d.height||0));case"ry":if("ry"==p&&"rect"==i.type)break;case"cy":l.setAttribute(p,m),i.pattern&&y(i),i._.dirty=1;break;case"r":"rect"==i.type?g(l,{rx:m,ry:m}):l.setAttribute(p,m),i._.dirty=1;break;case"src":"image"==i.type&&l.setAttributeNS(f,"href",m);break;case"stroke-width":(1!=i._.sx||1!=i._.sy)&&(m/=a(s(i._.sx),s(i._.sy))||1),i.paper._vbSize&&(m*=i.paper._vbSize),l.setAttribute(p,m),d["stroke-dasharray"]&&k(i,d["stroke-dasharray"],o),i._.arrows&&("startString"in i._.arrows&&b(i,i._.arrows.startString),"endString"in i._.arrows&&b(i,i._.arrows.endString,1));break;case"stroke-dasharray":k(i,m,o);break;case"fill":var P=n(m).match(e._ISURL);if(P){T=g("pattern");var M=g("image");T.id=e.createUUID(),g(T,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1}),g(M,{x:0,y:0,"xlink:href":P[1]}),T.appendChild(M),function(t){e._preload(P[1],function(){var e=this.offsetWidth,n=this.offsetHeight;g(t,{width:e,height:n}),g(M,{width:e,height:n}),i.paper.safari()})}(T),i.paper.defs.appendChild(T),g(l,{fill:"url(#"+T.id+")"}),i.pattern=T,i.pattern&&y(i);break}var Q=e.getRGB(m);if(Q.error){if(("circle"==i.type||"ellipse"==i.type||"r"!=n(m).charAt())&&v(i,m)){if("opacity"in d||"fill-opacity"in d){var B=e._g.doc.getElementById(l.getAttribute("fill").replace(/^url\(#|\)$/g,u));if(B){var E=B.getElementsByTagName("stop");g(E[E.length-1],{"stop-opacity":("opacity"in d?d.opacity:1)*("fill-opacity"in d?d["fill-opacity"]:1)})}}d.gradient=m,d.fill="none";break}}else delete o.gradient,delete d.gradient,!e.is(d.opacity,"undefined")&&e.is(o.opacity,"undefined")&&g(l,{opacity:d.opacity}),!e.is(d["fill-opacity"],"undefined")&&e.is(o["fill-opacity"],"undefined")&&g(l,{"fill-opacity":d["fill-opacity"]});Q[t]("opacity")&&g(l,{"fill-opacity":Q.opacity>1?Q.opacity/100:Q.opacity});case"stroke":Q=e.getRGB(m),l.setAttribute(p,Q.hex),"stroke"==p&&Q[t]("opacity")&&g(l,{"stroke-opacity":Q.opacity>1?Q.opacity/100:Q.opacity}),"stroke"==p&&i._.arrows&&("startString"in i._.arrows&&b(i,i._.arrows.startString),"endString"in i._.arrows&&b(i,i._.arrows.endString,1));break;case"gradient":("circle"==i.type||"ellipse"==i.type||"r"!=n(m).charAt())&&v(i,m);break;case"opacity":d.gradient&&!d[t]("stroke-opacity")&&g(l,{"stroke-opacity":m>1?m/100:m});case"fill-opacity":if(d.gradient){B=e._g.doc.getElementById(l.getAttribute("fill").replace(/^url\(#|\)$/g,u)),B&&(E=B.getElementsByTagName("stop"),g(E[E.length-1],{"stop-opacity":m}));break}default:"font-size"==p&&(m=r(m,10)+"px");var O=p.replace(/(\-.)/g,function(e){return e.substring(1).toUpperCase()});l.style[O]=m,i._.dirty=1,l.setAttribute(p,m)}}j(i,o),l.style.visibility=h},C=1.2,j=function(i,o){if("text"==i.type&&(o[t]("text")||o[t]("font")||o[t]("font-size")||o[t]("x")||o[t]("y"))){var a=i.attrs,s=i.node,l=s.firstChild?r(e._g.doc.defaultView.getComputedStyle(s.firstChild,u).getPropertyValue("font-size"),10):10;if(o[t]("text")){for(a.text=o.text;s.firstChild;)s.removeChild(s.firstChild);for(var c,d=n(o.text).split("\n"),h=[],f=0,p=d.length;p>f;f++)c=g("tspan"),f&&g(c,{dy:l*C,x:a.x}),c.appendChild(e._g.doc.createTextNode(d[f])),s.appendChild(c),h[f]=c}else for(h=s.getElementsByTagName("tspan"),f=0,p=h.length;p>f;f++)f?g(h[f],{dy:l*C,x:a.x}):g(h[0],{dy:0});g(s,{x:a.x,y:a.y}),i._.dirty=1;var m=i._getBBox(),v=a.y-(m.y+m.height/2);v&&e.is(v,"finite")&&g(h[0],{dy:v})}},T=function(t,n){this[0]=this.node=t,t.raphael=!0,this.id=e._oid++,t.raphaelid=this.id,this.matrix=e.matrix(),this.realPath=null,this.paper=n,this.attrs=this.attrs||{},this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1},!n.bottom&&(n.bottom=this),this.prev=n.top,n.top&&(n.top.next=this),n.top=this,this.next=null},_=e.el;T.prototype=_,_.constructor=T,e._engine.path=function(e,t){var n=g("path");t.canvas&&t.canvas.appendChild(n);var i=new T(n,t);return i.type="path",x(i,{fill:"none",stroke:"#000",path:e}),i},_.rotate=function(e,t,r){if(this.removed)return this;if(e=n(e).split(c),e.length-1&&(t=i(e[1]),r=i(e[2])),e=i(e[0]),null==r&&(t=r),null==t||null==r){var o=this.getBBox(1);t=o.x+o.width/2,r=o.y+o.height/2}return this.transform(this._.transform.concat([["r",e,t,r]])),this},_.scale=function(e,t,r,o){if(this.removed)return this;if(e=n(e).split(c),e.length-1&&(t=i(e[1]),r=i(e[2]),o=i(e[3])),e=i(e[0]),null==t&&(t=e),null==o&&(r=o),null==r||null==o)var a=this.getBBox(1);return r=null==r?a.x+a.width/2:r,o=null==o?a.y+a.height/2:o,this.transform(this._.transform.concat([["s",e,t,r,o]])),this},_.translate=function(e,t){return this.removed?this:(e=n(e).split(c),e.length-1&&(t=i(e[1])),e=i(e[0])||0,t=+t||0,this.transform(this._.transform.concat([["t",e,t]])),this)},_.transform=function(n){var i=this._;if(null==n)return i.transform;if(e._extractTransform(this,n),this.clip&&g(this.clip,{transform:this.matrix.invert()}),this.pattern&&y(this),this.node&&g(this.node,{transform:this.matrix}),1!=i.sx||1!=i.sy){var r=this.attrs[t]("stroke-width")?this.attrs["stroke-width"]:1;this.attr({"stroke-width":r})}return this},_.hide=function(){return!this.removed&&this.paper.safari(this.node.style.display="none"),
this},_.show=function(){return!this.removed&&this.paper.safari(this.node.style.display=""),this},_.remove=function(){if(!this.removed&&this.node.parentNode){var t=this.paper;t.__set__&&t.__set__.exclude(this),d.unbind("raphael.*.*."+this.id),this.gradient&&t.defs.removeChild(this.gradient),e._tear(this,t),"a"==this.node.parentNode.tagName.toLowerCase()?this.node.parentNode.parentNode.removeChild(this.node.parentNode):this.node.parentNode.removeChild(this.node);for(var n in this)this[n]="function"==typeof this[n]?e._removedFactory(n):null;this.removed=!0}},_._getBBox=function(){if("none"==this.node.style.display){this.show();var e=!0}var t={};try{t=this.node.getBBox()}catch(n){}finally{t=t||{}}return e&&this.hide(),t},_.attr=function(n,i){if(this.removed)return this;if(null==n){var r={};for(var o in this.attrs)this.attrs[t](o)&&(r[o]=this.attrs[o]);return r.gradient&&"none"==r.fill&&(r.fill=r.gradient)&&delete r.gradient,r.transform=this._.transform,r}if(null==i&&e.is(n,"string")){if("fill"==n&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;if("transform"==n)return this._.transform;for(var a=n.split(c),s={},l=0,u=a.length;u>l;l++)n=a[l],n in this.attrs?s[n]=this.attrs[n]:e.is(this.paper.customAttributes[n],"function")?s[n]=this.paper.customAttributes[n].def:s[n]=e._availableAttrs[n];return u-1?s:s[a[0]]}if(null==i&&e.is(n,"array")){for(s={},l=0,u=n.length;u>l;l++)s[n[l]]=this.attr(n[l]);return s}if(null!=i){var h={};h[n]=i}else null!=n&&e.is(n,"object")&&(h=n);for(var f in h)d("raphael.attr."+f+"."+this.id,this,h[f]);for(f in this.paper.customAttributes)if(this.paper.customAttributes[t](f)&&h[t](f)&&e.is(this.paper.customAttributes[f],"function")){var p=this.paper.customAttributes[f].apply(this,[].concat(h[f]));this.attrs[f]=h[f];for(var m in p)p[t](m)&&(h[m]=p[m])}return x(this,h),this},_.toFront=function(){if(this.removed)return this;"a"==this.node.parentNode.tagName.toLowerCase()?this.node.parentNode.parentNode.appendChild(this.node.parentNode):this.node.parentNode.appendChild(this.node);var t=this.paper;return t.top!=this&&e._tofront(this,t),this},_.toBack=function(){if(this.removed)return this;var t=this.node.parentNode;"a"==t.tagName.toLowerCase()?t.parentNode.insertBefore(this.node.parentNode,this.node.parentNode.parentNode.firstChild):t.firstChild!=this.node&&t.insertBefore(this.node,this.node.parentNode.firstChild),e._toback(this,this.paper);this.paper;return this},_.insertAfter=function(t){if(this.removed)return this;var n=t.node||t[t.length-1].node;return n.nextSibling?n.parentNode.insertBefore(this.node,n.nextSibling):n.parentNode.appendChild(this.node),e._insertafter(this,t,this.paper),this},_.insertBefore=function(t){if(this.removed)return this;var n=t.node||t[0].node;return n.parentNode.insertBefore(this.node,n),e._insertbefore(this,t,this.paper),this},_.blur=function(t){var n=this;if(0!==+t){var i=g("filter"),r=g("feGaussianBlur");n.attrs.blur=t,i.id=e.createUUID(),g(r,{stdDeviation:+t||1.5}),i.appendChild(r),n.paper.defs.appendChild(i),n._blur=i,g(n.node,{filter:"url(#"+i.id+")"})}else n._blur&&(n._blur.parentNode.removeChild(n._blur),delete n._blur,delete n.attrs.blur),n.node.removeAttribute("filter")},e._engine.circle=function(e,t,n,i){var r=g("circle");e.canvas&&e.canvas.appendChild(r);var o=new T(r,e);return o.attrs={cx:t,cy:n,r:i,fill:"none",stroke:"#000"},o.type="circle",g(r,o.attrs),o},e._engine.rect=function(e,t,n,i,r,o){var a=g("rect");e.canvas&&e.canvas.appendChild(a);var s=new T(a,e);return s.attrs={x:t,y:n,width:i,height:r,r:o||0,rx:o||0,ry:o||0,fill:"none",stroke:"#000"},s.type="rect",g(a,s.attrs),s},e._engine.ellipse=function(e,t,n,i,r){var o=g("ellipse");e.canvas&&e.canvas.appendChild(o);var a=new T(o,e);return a.attrs={cx:t,cy:n,rx:i,ry:r,fill:"none",stroke:"#000"},a.type="ellipse",g(o,a.attrs),a},e._engine.image=function(e,t,n,i,r,o){var a=g("image");g(a,{x:n,y:i,width:r,height:o,preserveAspectRatio:"none"}),a.setAttributeNS(f,"href",t),e.canvas&&e.canvas.appendChild(a);var s=new T(a,e);return s.attrs={x:n,y:i,width:r,height:o,src:t},s.type="image",s},e._engine.text=function(t,n,i,r){var o=g("text");t.canvas&&t.canvas.appendChild(o);var a=new T(o,t);return a.attrs={x:n,y:i,"text-anchor":"middle",text:r,font:e._availableAttrs.font,stroke:"none",fill:"#000"},a.type="text",x(a,a.attrs),a},e._engine.setSize=function(e,t){return this.width=e||this.width,this.height=t||this.height,this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this._viewBox&&this.setViewBox.apply(this,this._viewBox),this},e._engine.create=function(){var t=e._getContainer.apply(0,arguments),n=t&&t.container,i=t.x,r=t.y,o=t.width,a=t.height;if(!n)throw new Error("SVG container not found.");var s,l=g("svg"),c="overflow:hidden;";return i=i||0,r=r||0,o=o||512,a=a||342,g(l,{height:a,version:1.1,width:o,xmlns:"http://www.w3.org/2000/svg"}),1==n?(l.style.cssText=c+"position:absolute;left:"+i+"px;top:"+r+"px",e._g.doc.body.appendChild(l),s=1):(l.style.cssText=c+"position:relative",n.firstChild?n.insertBefore(l,n.firstChild):n.appendChild(l)),n=new e._Paper,n.width=o,n.height=a,n.canvas=l,n.clear(),n._left=n._top=0,s&&(n.renderfix=function(){}),n.renderfix(),n},e._engine.setViewBox=function(e,t,n,i,r){d("raphael.setViewBox",this,this._viewBox,[e,t,n,i,r]);var o,s,l=a(n/this.width,i/this.height),c=this.top,u=r?"meet":"xMinYMin";for(null==e?(this._vbSize&&(l=1),delete this._vbSize,o="0 0 "+this.width+h+this.height):(this._vbSize=l,o=e+h+t+h+n+h+i),g(this.canvas,{viewBox:o,preserveAspectRatio:u});l&&c;)s="stroke-width"in c.attrs?c.attrs["stroke-width"]:1,c.attr({"stroke-width":s}),c._.dirty=1,c._.dirtyT=1,c=c.prev;return this._viewBox=[e,t,n,i,!!r],this},e.prototype.renderfix=function(){var e,t=this.canvas,n=t.style;try{e=t.getScreenCTM()||t.createSVGMatrix()}catch(i){e=t.createSVGMatrix()}var r=-e.e%1,o=-e.f%1;(r||o)&&(r&&(this._left=(this._left+r)%1,n.left=this._left+"px"),o&&(this._top=(this._top+o)%1,n.top=this._top+"px"))},e.prototype.clear=function(){e.eve("raphael.clear",this);for(var t=this.canvas;t.firstChild;)t.removeChild(t.firstChild);this.bottom=this.top=null,(this.desc=g("desc")).appendChild(e._g.doc.createTextNode("Created with Raphaël "+e.version)),t.appendChild(this.desc),t.appendChild(this.defs=g("defs"))},e.prototype.remove=function(){d("raphael.remove",this),this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var t in this)this[t]="function"==typeof this[t]?e._removedFactory(t):null};var S=e.st;for(var I in _)_[t](I)&&!S[t](I)&&(S[I]=function(e){return function(){var t=arguments;return this.forEach(function(n){n[e].apply(n,t)})}}(I))}(window.Raphael),window.Raphael.vml&&function(e){var t="hasOwnProperty",n=String,i=parseFloat,r=Math,o=r.round,a=r.max,s=r.min,l=r.abs,c="fill",d=/[, ]+/,u=e.eve,h=" progid:DXImageTransform.Microsoft",f=" ",p="",m={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},g=/([clmz]),?([^clmz]*)/gi,v=/ progid:\S+Blur\([^\)]+\)/g,y=/-?[^,\s-]+/g,b="position:absolute;left:0;top:0;width:1px;height:1px",w=21600,k={path:1,rect:1,image:1},x={circle:1,ellipse:1},C=function(t){var i=/[ahqstv]/gi,r=e._pathToAbsolute;if(n(t).match(i)&&(r=e._path2curve),i=/[clmz]/g,r==e._pathToAbsolute&&!n(t).match(i)){var a=n(t).replace(g,function(e,t,n){var i=[],r="m"==t.toLowerCase(),a=m[t];return n.replace(y,function(e){r&&2==i.length&&(a+=i+m["m"==t?"l":"L"],i=[]),i.push(o(e*w))}),a+i});return a}var s,l,c=r(t);a=[];for(var d=0,u=c.length;u>d;d++){s=c[d],l=c[d][0].toLowerCase(),"z"==l&&(l="x");for(var h=1,v=s.length;v>h;h++)l+=o(s[h]*w)+(h!=v-1?",":p);a.push(l)}return a.join(f)},j=function(t,n,i){var r=e.matrix();return r.rotate(-t,.5,.5),{dx:r.x(n,i),dy:r.y(n,i)}},T=function(e,t,n,i,r,o){var a=e._,s=e.matrix,d=a.fillpos,u=e.node,h=u.style,p=1,m="",g=w/t,v=w/n;if(h.visibility="hidden",t&&n){if(u.coordsize=l(g)+f+l(v),h.rotation=o*(0>t*n?-1:1),o){var y=j(o,i,r);i=y.dx,r=y.dy}if(0>t&&(m+="x"),0>n&&(m+=" y")&&(p=-1),h.flip=m,u.coordorigin=i*-g+f+r*-v,d||a.fillsize){var b=u.getElementsByTagName(c);b=b&&b[0],u.removeChild(b),d&&(y=j(o,s.x(d[0],d[1]),s.y(d[0],d[1])),b.position=y.dx*p+f+y.dy*p),a.fillsize&&(b.size=a.fillsize[0]*l(t)+f+a.fillsize[1]*l(n)),u.appendChild(b)}h.visibility="visible"}};e.toString=function(){return"Your browser doesn’t support SVG. Falling down to VML.\nYou are running Raphaël "+this.version};var _=function(e,t,i){for(var r=n(t).toLowerCase().split("-"),o=i?"end":"start",a=r.length,s="classic",l="medium",c="medium";a--;)switch(r[a]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":s=r[a];break;case"wide":case"narrow":c=r[a];break;case"long":case"short":l=r[a]}var d=e.node.getElementsByTagName("stroke")[0];d[o+"arrow"]=s,d[o+"arrowlength"]=l,d[o+"arrowwidth"]=c},S=function(r,l){r.attrs=r.attrs||{};var u=r.node,h=r.attrs,m=u.style,g=k[r.type]&&(l.x!=h.x||l.y!=h.y||l.width!=h.width||l.height!=h.height||l.cx!=h.cx||l.cy!=h.cy||l.rx!=h.rx||l.ry!=h.ry||l.r!=h.r),v=x[r.type]&&(h.cx!=l.cx||h.cy!=l.cy||h.r!=l.r||h.rx!=l.rx||h.ry!=l.ry),y=r;for(var b in l)l[t](b)&&(h[b]=l[b]);if(g&&(h.path=e._getPath[r.type](r),r._.dirty=1),l.href&&(u.href=l.href),l.title&&(u.title=l.title),l.target&&(u.target=l.target),l.cursor&&(m.cursor=l.cursor),"blur"in l&&r.blur(l.blur),(l.path&&"path"==r.type||g)&&(u.path=C(~n(h.path).toLowerCase().indexOf("r")?e._pathToAbsolute(h.path):h.path),"image"==r.type&&(r._.fillpos=[h.x,h.y],r._.fillsize=[h.width,h.height],T(r,1,1,0,0,0))),"transform"in l&&r.transform(l.transform),v){var j=+h.cx,S=+h.cy,P=+h.rx||+h.r||0,M=+h.ry||+h.r||0;u.path=e.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",o((j-P)*w),o((S-M)*w),o((j+P)*w),o((S+M)*w),o(j*w))}if("clip-rect"in l){var B=n(l["clip-rect"]).split(d);if(4==B.length){B[2]=+B[2]+ +B[0],B[3]=+B[3]+ +B[1];var E=u.clipRect||e._g.doc.createElement("div"),O=E.style;O.clip=e.format("rect({1}px {2}px {3}px {0}px)",B),u.clipRect||(O.position="absolute",O.top=0,O.left=0,O.width=r.paper.width+"px",O.height=r.paper.height+"px",u.parentNode.insertBefore(E,u),E.appendChild(u),u.clipRect=E)}l["clip-rect"]||u.clipRect&&(u.clipRect.style.clip="auto")}if(r.textpath){var A=r.textpath.style;l.font&&(A.font=l.font),l["font-family"]&&(A.fontFamily='"'+l["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,p)+'"'),l["font-size"]&&(A.fontSize=l["font-size"]),l["font-weight"]&&(A.fontWeight=l["font-weight"]),l["font-style"]&&(A.fontStyle=l["font-style"])}if("arrow-start"in l&&_(y,l["arrow-start"]),"arrow-end"in l&&_(y,l["arrow-end"],1),null!=l.opacity||null!=l["stroke-width"]||null!=l.fill||null!=l.src||null!=l.stroke||null!=l["stroke-width"]||null!=l["stroke-opacity"]||null!=l["fill-opacity"]||null!=l["stroke-dasharray"]||null!=l["stroke-miterlimit"]||null!=l["stroke-linejoin"]||null!=l["stroke-linecap"]){var D=u.getElementsByTagName(c),H=!1;if(D=D&&D[0],!D&&(H=D=Q(c)),"image"==r.type&&l.src&&(D.src=l.src),l.fill&&(D.on=!0),(null==D.on||"none"==l.fill||null===l.fill)&&(D.on=!1),D.on&&l.fill){var N=n(l.fill).match(e._ISURL);if(N){D.parentNode==u&&u.removeChild(D),D.rotate=!0,D.src=N[1],D.type="tile";var L=r.getBBox(1);D.position=L.x+f+L.y,r._.fillpos=[L.x,L.y],e._preload(N[1],function(){r._.fillsize=[this.offsetWidth,this.offsetHeight]})}else D.color=e.getRGB(l.fill).hex,D.src=p,D.type="solid",e.getRGB(l.fill).error&&(y.type in{circle:1,ellipse:1}||"r"!=n(l.fill).charAt())&&I(y,l.fill,D)&&(h.fill="none",h.gradient=l.fill,D.rotate=!1)}if("fill-opacity"in l||"opacity"in l){var G=((+h["fill-opacity"]+1||2)-1)*((+h.opacity+1||2)-1)*((+e.getRGB(l.fill).o+1||2)-1);G=s(a(G,0),1),D.opacity=G,D.src&&(D.color="none")}u.appendChild(D);var R=u.getElementsByTagName("stroke")&&u.getElementsByTagName("stroke")[0],V=!1;!R&&(V=R=Q("stroke")),(l.stroke&&"none"!=l.stroke||l["stroke-width"]||null!=l["stroke-opacity"]||l["stroke-dasharray"]||l["stroke-miterlimit"]||l["stroke-linejoin"]||l["stroke-linecap"])&&(R.on=!0),("none"==l.stroke||null===l.stroke||null==R.on||0==l.stroke||0==l["stroke-width"])&&(R.on=!1);var F=e.getRGB(l.stroke);R.on&&l.stroke&&(R.color=F.hex),G=((+h["stroke-opacity"]+1||2)-1)*((+h.opacity+1||2)-1)*((+F.o+1||2)-1);var z=.75*(i(l["stroke-width"])||1);if(G=s(a(G,0),1),null==l["stroke-width"]&&(z=h["stroke-width"]),l["stroke-width"]&&(R.weight=z),z&&1>z&&(G*=z)&&(R.weight=1),R.opacity=G,l["stroke-linejoin"]&&(R.joinstyle=l["stroke-linejoin"]||"miter"),R.miterlimit=l["stroke-miterlimit"]||8,l["stroke-linecap"]&&(R.endcap="butt"==l["stroke-linecap"]?"flat":"square"==l["stroke-linecap"]?"square":"round"),l["stroke-dasharray"]){var U={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};R.dashstyle=U[t](l["stroke-dasharray"])?U[l["stroke-dasharray"]]:p}V&&u.appendChild(R)}if("text"==y.type){y.paper.canvas.style.display=p;var W=y.paper.span,q=100,$=h.font&&h.font.match(/\d+(?:\.\d*)?(?=px)/);m=W.style,h.font&&(m.font=h.font),h["font-family"]&&(m.fontFamily=h["font-family"]),h["font-weight"]&&(m.fontWeight=h["font-weight"]),h["font-style"]&&(m.fontStyle=h["font-style"]),$=i(h["font-size"]||$&&$[0])||10,m.fontSize=$*q+"px",y.textpath.string&&(W.innerHTML=n(y.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));var K=W.getBoundingClientRect();y.W=h.w=(K.right-K.left)/q,y.H=h.h=(K.bottom-K.top)/q,y.X=h.x,y.Y=h.y+y.H/2,("x"in l||"y"in l)&&(y.path.v=e.format("m{0},{1}l{2},{1}",o(h.x*w),o(h.y*w),o(h.x*w)+1));for(var J=["x","y","text","font","font-family","font-weight","font-style","font-size"],X=0,Y=J.length;Y>X;X++)if(J[X]in l){y._.dirty=1;break}switch(h["text-anchor"]){case"start":y.textpath.style["v-text-align"]="left",y.bbx=y.W/2;break;case"end":y.textpath.style["v-text-align"]="right",y.bbx=-y.W/2;break;default:y.textpath.style["v-text-align"]="center",y.bbx=0}y.textpath.style["v-text-kern"]=!0}},I=function(t,o,a){t.attrs=t.attrs||{};var s=(t.attrs,Math.pow),l="linear",c=".5 .5";if(t.attrs.gradient=o,o=n(o).replace(e._radial_gradient,function(e,t,n){return l="radial",t&&n&&(t=i(t),n=i(n),s(t-.5,2)+s(n-.5,2)>.25&&(n=r.sqrt(.25-s(t-.5,2))*(2*(n>.5)-1)+.5),c=t+f+n),p}),o=o.split(/\s*\-\s*/),"linear"==l){var d=o.shift();if(d=-i(d),isNaN(d))return null}var u=e._parseDots(o);if(!u)return null;if(t=t.shape||t.node,u.length){t.removeChild(a),a.on=!0,a.method="none",a.color=u[0].color,a.color2=u[u.length-1].color;for(var h=[],m=0,g=u.length;g>m;m++)u[m].offset&&h.push(u[m].offset+f+u[m].color);a.colors=h.length?h.join():"0% "+a.color,"radial"==l?(a.type="gradientTitle",a.focus="100%",a.focussize="0 0",a.focusposition=c,a.angle=0):(a.type="gradient",a.angle=(270-d)%360),t.appendChild(a)}return 1},P=function(t,n){this[0]=this.node=t,t.raphael=!0,this.id=e._oid++,t.raphaelid=this.id,this.X=0,this.Y=0,this.attrs={},this.paper=n,this.matrix=e.matrix(),this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1},!n.bottom&&(n.bottom=this),this.prev=n.top,n.top&&(n.top.next=this),n.top=this,this.next=null},M=e.el;P.prototype=M,M.constructor=P,M.transform=function(t){if(null==t)return this._.transform;var i,r=this.paper._viewBoxShift,o=r?"s"+[r.scale,r.scale]+"-1-1t"+[r.dx,r.dy]:p;r&&(i=t=n(t).replace(/\.{3}|\u2026/g,this._.transform||p)),e._extractTransform(this,o+t);var a,s=this.matrix.clone(),l=this.skew,c=this.node,d=~n(this.attrs.fill).indexOf("-"),u=!n(this.attrs.fill).indexOf("url(");if(s.translate(-.5,-.5),u||d||"image"==this.type)if(l.matrix="1 0 0 1",l.offset="0 0",a=s.split(),d&&a.noRotation||!a.isSimple){c.style.filter=s.toFilter();var h=this.getBBox(),m=this.getBBox(1),g=h.x-m.x,v=h.y-m.y;c.coordorigin=g*-w+f+v*-w,T(this,1,1,g,v,0)}else c.style.filter=p,T(this,a.scalex,a.scaley,a.dx,a.dy,a.rotate);else c.style.filter=p,l.matrix=n(s),l.offset=s.offset();return i&&(this._.transform=i),this},M.rotate=function(e,t,r){if(this.removed)return this;if(null!=e){if(e=n(e).split(d),e.length-1&&(t=i(e[1]),r=i(e[2])),e=i(e[0]),null==r&&(t=r),null==t||null==r){var o=this.getBBox(1);t=o.x+o.width/2,r=o.y+o.height/2}return this._.dirtyT=1,this.transform(this._.transform.concat([["r",e,t,r]])),this}},M.translate=function(e,t){return this.removed?this:(e=n(e).split(d),e.length-1&&(t=i(e[1])),e=i(e[0])||0,t=+t||0,this._.bbox&&(this._.bbox.x+=e,this._.bbox.y+=t),this.transform(this._.transform.concat([["t",e,t]])),this)},M.scale=function(e,t,r,o){if(this.removed)return this;if(e=n(e).split(d),e.length-1&&(t=i(e[1]),r=i(e[2]),o=i(e[3]),isNaN(r)&&(r=null),isNaN(o)&&(o=null)),e=i(e[0]),null==t&&(t=e),null==o&&(r=o),null==r||null==o)var a=this.getBBox(1);return r=null==r?a.x+a.width/2:r,o=null==o?a.y+a.height/2:o,this.transform(this._.transform.concat([["s",e,t,r,o]])),this._.dirtyT=1,this},M.hide=function(){return!this.removed&&(this.node.style.display="none"),this},M.show=function(){return!this.removed&&(this.node.style.display=p),this},M._getBBox=function(){return this.removed?{}:{x:this.X+(this.bbx||0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H}},M.remove=function(){if(!this.removed&&this.node.parentNode){this.paper.__set__&&this.paper.__set__.exclude(this),e.eve.unbind("raphael.*.*."+this.id),e._tear(this,this.paper),this.node.parentNode.removeChild(this.node),this.shape&&this.shape.parentNode.removeChild(this.shape);for(var t in this)this[t]="function"==typeof this[t]?e._removedFactory(t):null;this.removed=!0}},M.attr=function(n,i){if(this.removed)return this;if(null==n){var r={};for(var o in this.attrs)this.attrs[t](o)&&(r[o]=this.attrs[o]);return r.gradient&&"none"==r.fill&&(r.fill=r.gradient)&&delete r.gradient,r.transform=this._.transform,r}if(null==i&&e.is(n,"string")){if(n==c&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;for(var a=n.split(d),s={},l=0,h=a.length;h>l;l++)n=a[l],n in this.attrs?s[n]=this.attrs[n]:e.is(this.paper.customAttributes[n],"function")?s[n]=this.paper.customAttributes[n].def:s[n]=e._availableAttrs[n];return h-1?s:s[a[0]]}if(this.attrs&&null==i&&e.is(n,"array")){for(s={},l=0,h=n.length;h>l;l++)s[n[l]]=this.attr(n[l]);return s}var f;null!=i&&(f={},f[n]=i),null==i&&e.is(n,"object")&&(f=n);for(var p in f)u("raphael.attr."+p+"."+this.id,this,f[p]);if(f){for(p in this.paper.customAttributes)if(this.paper.customAttributes[t](p)&&f[t](p)&&e.is(this.paper.customAttributes[p],"function")){var m=this.paper.customAttributes[p].apply(this,[].concat(f[p]));this.attrs[p]=f[p];for(var g in m)m[t](g)&&(f[g]=m[g])}f.text&&"text"==this.type&&(this.textpath.string=f.text),S(this,f)}return this},M.toFront=function(){return!this.removed&&this.node.parentNode.appendChild(this.node),this.paper&&this.paper.top!=this&&e._tofront(this,this.paper),this},M.toBack=function(){return this.removed?this:(this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),e._toback(this,this.paper)),this)},M.insertAfter=function(t){return this.removed?this:(t.constructor==e.st.constructor&&(t=t[t.length-1]),t.node.nextSibling?t.node.parentNode.insertBefore(this.node,t.node.nextSibling):t.node.parentNode.appendChild(this.node),e._insertafter(this,t,this.paper),this)},M.insertBefore=function(t){return this.removed?this:(t.constructor==e.st.constructor&&(t=t[0]),t.node.parentNode.insertBefore(this.node,t.node),e._insertbefore(this,t,this.paper),this)},M.blur=function(t){var n=this.node.runtimeStyle,i=n.filter;i=i.replace(v,p),0!==+t?(this.attrs.blur=t,n.filter=i+f+h+".Blur(pixelradius="+(+t||1.5)+")",n.margin=e.format("-{0}px 0 0 -{0}px",o(+t||1.5))):(n.filter=i,n.margin=0,delete this.attrs.blur)},e._engine.path=function(e,t){var n=Q("shape");n.style.cssText=b,n.coordsize=w+f+w,n.coordorigin=t.coordorigin;var i=new P(n,t),r={fill:"none",stroke:"#000"};e&&(r.path=e),i.type="path",i.path=[],i.Path=p,S(i,r),t.canvas.appendChild(n);var o=Q("skew");return o.on=!0,n.appendChild(o),i.skew=o,i.transform(p),i},e._engine.rect=function(t,n,i,r,o,a){var s=e._rectPath(n,i,r,o,a),l=t.path(s),c=l.attrs;return l.X=c.x=n,l.Y=c.y=i,l.W=c.width=r,l.H=c.height=o,c.r=a,c.path=s,l.type="rect",l},e._engine.ellipse=function(e,t,n,i,r){var o=e.path();o.attrs;return o.X=t-i,o.Y=n-r,o.W=2*i,o.H=2*r,o.type="ellipse",S(o,{cx:t,cy:n,rx:i,ry:r}),o},e._engine.circle=function(e,t,n,i){var r=e.path();r.attrs;return r.X=t-i,r.Y=n-i,r.W=r.H=2*i,r.type="circle",S(r,{cx:t,cy:n,r:i}),r},e._engine.image=function(t,n,i,r,o,a){var s=e._rectPath(i,r,o,a),l=t.path(s).attr({stroke:"none"}),d=l.attrs,u=l.node,h=u.getElementsByTagName(c)[0];return d.src=n,l.X=d.x=i,l.Y=d.y=r,l.W=d.width=o,l.H=d.height=a,d.path=s,l.type="image",h.parentNode==u&&u.removeChild(h),h.rotate=!0,h.src=n,h.type="tile",l._.fillpos=[i,r],l._.fillsize=[o,a],u.appendChild(h),T(l,1,1,0,0,0),l},e._engine.text=function(t,i,r,a){var s=Q("shape"),l=Q("path"),c=Q("textpath");i=i||0,r=r||0,a=a||"",l.v=e.format("m{0},{1}l{2},{1}",o(i*w),o(r*w),o(i*w)+1),l.textpathok=!0,c.string=n(a),c.on=!0,s.style.cssText=b,s.coordsize=w+f+w,s.coordorigin="0 0";var d=new P(s,t),u={fill:"#000",stroke:"none",font:e._availableAttrs.font,text:a};d.shape=s,d.path=l,d.textpath=c,d.type="text",d.attrs.text=n(a),d.attrs.x=i,d.attrs.y=r,d.attrs.w=1,d.attrs.h=1,S(d,u),s.appendChild(c),s.appendChild(l),t.canvas.appendChild(s);var h=Q("skew");return h.on=!0,s.appendChild(h),d.skew=h,d.transform(p),d},e._engine.setSize=function(t,n){var i=this.canvas.style;return this.width=t,this.height=n,t==+t&&(t+="px"),n==+n&&(n+="px"),i.width=t,i.height=n,i.clip="rect(0 "+t+" "+n+" 0)",this._viewBox&&e._engine.setViewBox.apply(this,this._viewBox),this},e._engine.setViewBox=function(t,n,i,r,o){e.eve("raphael.setViewBox",this,this._viewBox,[t,n,i,r,o]);var s,l,c=this.width,d=this.height,u=1/a(i/c,r/d);return o&&(s=d/r,l=c/i,c>i*s&&(t-=(c-i*s)/2/s),d>r*l&&(n-=(d-r*l)/2/l)),this._viewBox=[t,n,i,r,!!o],this._viewBoxShift={dx:-t,dy:-n,scale:u},this.forEach(function(e){e.transform("...")}),this};var Q;e._engine.initWin=function(e){var t=e.document;t.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!t.namespaces.rvml&&t.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),Q=function(e){return t.createElement("<rvml:"+e+' class="rvml">')}}catch(n){Q=function(e){return t.createElement("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}},e._engine.initWin(e._g.win),e._engine.create=function(){var t=e._getContainer.apply(0,arguments),n=t.container,i=t.height,r=t.width,o=t.x,a=t.y;if(!n)throw new Error("VML container not found.");var s=new e._Paper,l=s.canvas=e._g.doc.createElement("div"),c=l.style;return o=o||0,a=a||0,r=r||512,i=i||342,s.width=r,s.height=i,r==+r&&(r+="px"),i==+i&&(i+="px"),s.coordsize=1e3*w+f+1e3*w,s.coordorigin="0 0",s.span=e._g.doc.createElement("span"),s.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;",l.appendChild(s.span),c.cssText=e.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",r,i),1==n?(e._g.doc.body.appendChild(l),c.left=o+"px",c.top=a+"px",c.position="absolute"):n.firstChild?n.insertBefore(l,n.firstChild):n.appendChild(l),s.renderfix=function(){},s},e.prototype.clear=function(){e.eve("raphael.clear",this),this.canvas.innerHTML=p,this.span=e._g.doc.createElement("span"),this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;",this.canvas.appendChild(this.span),this.bottom=this.top=null},e.prototype.remove=function(){e.eve("raphael.remove",this),this.canvas.parentNode.removeChild(this.canvas);for(var t in this)this[t]="function"==typeof this[t]?e._removedFactory(t):null;return!0};var B=e.st;for(var E in M)M[t](E)&&!B[t](E)&&(B[E]=function(e){return function(){var t=arguments;return this.forEach(function(n){n[e].apply(n,t)})}}(E))}(window.Raphael),Raphael.fn.arrow=function(e,t,n,i,r,o,a){a=a||"black";var s=Math.atan2(t-i,r-n);s=s/(2*Math.PI)*360;var l=t-i,c=r-n,d=Math.sqrt(c*c+l*l),u=(d-e/6)/d,h=t+(i-t)*u,f=n+(r-n)*u,p=this.path("M"+i+" "+r+" L"+(i-o)+" "+(r-o)+" L"+(i-o)+" "+(r+o)+" L"+i+" "+r).attr("fill",a).attr("stroke",a).rotate(90+s,i,r),m=this.path("M"+t+" "+n+" L"+h+" "+f).attr("stroke-linecap","round").attr("stroke",a).attr("stroke-width",Math.floor(o/2));return[m,p]},function(){function e(e){function n(){if(0===r.length)return void(s=!1);var e=t();if(e>=a){a=e+o;var i=r.shift();"function"==typeof i&&i.call()}setTimeout(n,a-e),s=!0}function i(e){r.push(e),s||n()}var r=[],o=e.interval,a=0,s=!1;return{add:i}}function t(){return(new Date).getTime()}var n=this;n.rateLimit={createQueue:e}}(window);var io="undefined"==typeof module?{}:module.exports;!function(){if(function(e,t){var n=e;n.version="0.9.16",n.protocol=1,n.transports=[],n.j=[],n.sockets={},n.connect=function(e,i){var r,o,a=n.util.parseUri(e);t&&t.location&&(a.protocol=a.protocol||t.location.protocol.slice(0,-1),a.host=a.host||(t.document?t.document.domain:t.location.hostname),a.port=a.port||t.location.port),r=n.util.uniqueUri(a);var s={host:a.host,secure:"https"==a.protocol,port:a.port||("https"==a.protocol?443:80),query:a.query||""};return n.util.merge(s,i),(s["force new connection"]||!n.sockets[r])&&(o=new n.Socket(s)),!s["force new connection"]&&o&&(n.sockets[r]=o),o=o||n.sockets[r],o.of(a.path.length>1?a.path:"")}}("object"==typeof module?module.exports:this.io={},this),function(e,t){var n=e.util={},i=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,r=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];n.parseUri=function(e){for(var t=i.exec(e||""),n={},o=14;o--;)n[r[o]]=t[o]||"";return n},n.uniqueUri=function(e){var n=e.protocol,i=e.host,r=e.port;return"document"in t?(i=i||document.domain,r=r||("https"==n&&"https:"!==document.location.protocol?443:document.location.port)):(i=i||"localhost",r||"https"!=n||(r=443)),(n||"http")+"://"+i+":"+(r||80)},n.query=function(e,t){var i=n.chunkQuery(e||""),r=[];n.merge(i,n.chunkQuery(t||""));for(var o in i)i.hasOwnProperty(o)&&r.push(o+"="+i[o]);return r.length?"?"+r.join("&"):""},n.chunkQuery=function(e){for(var t,n={},i=e.split("&"),r=0,o=i.length;o>r;++r)t=i[r].split("="),t[0]&&(n[t[0]]=t[1]);return n};var o=!1;n.load=function(e){return"document"in t&&"complete"===document.readyState||o?e():void n.on(t,"load",e,!1)},n.on=function(e,t,n,i){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener&&e.addEventListener(t,n,i)},n.request=function(e){if(e&&"undefined"!=typeof XDomainRequest&&!n.ua.hasCORS)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!e||n.ua.hasCORS))return new XMLHttpRequest;if(!e)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}return null},"undefined"!=typeof window&&n.load(function(){o=!0}),n.defer=function(e){return n.ua.webkit&&"undefined"==typeof importScripts?void n.load(function(){setTimeout(e,100)}):e()},n.merge=function(e,t,i,r){var o,a=r||[],s="undefined"==typeof i?2:i;for(o in t)t.hasOwnProperty(o)&&n.indexOf(a,o)<0&&("object"==typeof e[o]&&s?n.merge(e[o],t[o],s-1,a):(e[o]=t[o],a.push(t[o])));return e},n.mixin=function(e,t){n.merge(e.prototype,t.prototype)},n.inherit=function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n},n.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},n.intersect=function(e,t){for(var i=[],r=e.length>t.length?e:t,o=e.length>t.length?t:e,a=0,s=o.length;s>a;a++)~n.indexOf(r,o[a])&&i.push(o[a]);return i},n.indexOf=function(e,t,n){for(var i=e.length,n=0>n?0>n+i?0:n+i:n||0;i>n&&e[n]!==t;n++);return n>=i?-1:n},n.toArray=function(e){for(var t=[],n=0,i=e.length;i>n;n++)t.push(e[n]);return t},n.ua={},n.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var e=new XMLHttpRequest}catch(t){return!1}return void 0!=e.withCredentials}(),n.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent),n.ua.iDevice="undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)}("undefined"!=typeof io?io:module.exports,this),function(e,t){function n(){}e.EventEmitter=n,n.prototype.on=function(e,n){return this.$events||(this.$events={}),this.$events[e]?t.util.isArray(this.$events[e])?this.$events[e].push(n):this.$events[e]=[this.$events[e],n]:this.$events[e]=n,this},n.prototype.addListener=n.prototype.on,n.prototype.once=function(e,t){function n(){i.removeListener(e,n),t.apply(this,arguments)}var i=this;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,n){if(this.$events&&this.$events[e]){var i=this.$events[e];if(t.util.isArray(i)){for(var r=-1,o=0,a=i.length;a>o;o++)if(i[o]===n||i[o].listener&&i[o].listener===n){r=o;break}if(0>r)return this;i.splice(r,1),i.length||delete this.$events[e]}else(i===n||i.listener&&i.listener===n)&&delete this.$events[e]}return this},n.prototype.removeAllListeners=function(e){return void 0===e?(this.$events={},this):(this.$events&&this.$events[e]&&(this.$events[e]=null),this)},n.prototype.listeners=function(e){return this.$events||(this.$events={}),this.$events[e]||(this.$events[e]=[]),t.util.isArray(this.$events[e])||(this.$events[e]=[this.$events[e]]),this.$events[e]},n.prototype.emit=function(e){if(!this.$events)return!1;var n=this.$events[e];if(!n)return!1;var i=Array.prototype.slice.call(arguments,1);if("function"==typeof n)n.apply(this,i);else{if(!t.util.isArray(n))return!1;for(var r=n.slice(),o=0,a=r.length;a>o;o++)r[o].apply(this,i)}return!0}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(exports,nativeJSON){"use strict";function f(e){return 10>e?"0"+e:e}function date(e,t){return isFinite(e.valueOf())?e.getUTCFullYear()+"-"+f(e.getUTCMonth()+1)+"-"+f(e.getUTCDate())+"T"+f(e.getUTCHours())+":"+f(e.getUTCMinutes())+":"+f(e.getUTCSeconds())+"Z":null}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,i,r,o,a,s=gap,l=t[e];switch(l instanceof Date&&(l=date(e)),"function"==typeof rep&&(l=rep.call(t,e,l)),typeof l){case"string":return quote(l);case"number":return isFinite(l)?String(l):"null";case"boolean":case"null":return String(l);case"object":if(!l)return"null";if(gap+=indent,a=[],"[object Array]"===Object.prototype.toString.apply(l)){for(o=l.length,n=0;o>n;n+=1)a[n]=str(n,l)||"null";return r=0===a.length?"[]":gap?"[\n"+gap+a.join(",\n"+gap)+"\n"+s+"]":"["+a.join(",")+"]",gap=s,r}if(rep&&"object"==typeof rep)for(o=rep.length,n=0;o>n;n+=1)"string"==typeof rep[n]&&(i=rep[n],r=str(i,l),r&&a.push(quote(i)+(gap?": ":":")+r));else for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(r=str(i,l),r&&a.push(quote(i)+(gap?": ":":")+r));return r=0===a.length?"{}":gap?"{\n"+gap+a.join(",\n"+gap)+"\n"+s+"}":"{"+a.join(",")+"}",gap=s,r}}if(nativeJSON&&nativeJSON.parse)return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify};var JSON=exports.JSON={},cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;JSON.stringify=function(e,t,n){var i;if(gap="",indent="","number"==typeof n)for(i=0;n>i;i+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})},JSON.parse=function(text,reviver){function walk(e,t){var n,i,r=e[t];if(r&&"object"==typeof r)for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(i=walk(r,n),void 0!==i?r[n]=i:delete r[n]);return reviver.call(e,t,r)}var j;if(text=String(text),cx.lastIndex=0,
cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof JSON?JSON:void 0),function(e,t){var n=e.parser={},i=n.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],r=n.reasons=["transport not supported","client not handshaken","unauthorized"],o=n.advice=["reconnect"],a=t.JSON,s=t.util.indexOf;n.encodePacket=function(e){var t=s(i,e.type),n=e.id||"",l=e.endpoint||"",c=e.ack,d=null;switch(e.type){case"error":var u=e.reason?s(r,e.reason):"",h=e.advice?s(o,e.advice):"";(""!==u||""!==h)&&(d=u+(""!==h?"+"+h:""));break;case"message":""!==e.data&&(d=e.data);break;case"event":var f={name:e.name};e.args&&e.args.length&&(f.args=e.args),d=a.stringify(f);break;case"json":d=a.stringify(e.data);break;case"connect":e.qs&&(d=e.qs);break;case"ack":d=e.ackId+(e.args&&e.args.length?"+"+a.stringify(e.args):"")}var p=[t,n+("data"==c?"+":""),l];return null!==d&&void 0!==d&&p.push(d),p.join(":")},n.encodePayload=function(e){var t="";if(1==e.length)return e[0];for(var n=0,i=e.length;i>n;n++){var r=e[n];t+="�"+r.length+"�"+e[n]}return t};var l=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;n.decodePacket=function(e){var t=e.match(l);if(!t)return{};var n=t[2]||"",e=t[5]||"",s={type:i[t[1]],endpoint:t[4]||""};switch(n&&(s.id=n,t[3]?s.ack="data":s.ack=!0),s.type){case"error":var t=e.split("+");s.reason=r[t[0]]||"",s.advice=o[t[1]]||"";break;case"message":s.data=e||"";break;case"event":try{var c=a.parse(e);s.name=c.name,s.args=c.args}catch(d){}s.args=s.args||[];break;case"json":try{s.data=a.parse(e)}catch(d){}break;case"connect":s.qs=e||"";break;case"ack":var t=e.match(/^([0-9]+)(\+)?(.*)/);if(t&&(s.ackId=t[1],s.args=[],t[3]))try{s.args=t[3]?a.parse(t[3]):[]}catch(d){}break;case"disconnect":case"heartbeat":}return s},n.decodePayload=function(e){if("�"==e.charAt(0)){for(var t=[],i=1,r="";i<e.length;i++)"�"==e.charAt(i)?(t.push(n.decodePacket(e.substr(i+1).substr(0,r))),i+=Number(r)+1,r=""):r+=e.charAt(i);return t}return[n.decodePacket(e)]}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t){function n(e,t){this.socket=e,this.sessid=t}e.Transport=n,t.util.mixin(n,t.EventEmitter),n.prototype.heartbeats=function(){return!0},n.prototype.onData=function(e){if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==e){var n=t.parser.decodePayload(e);if(n&&n.length)for(var i=0,r=n.length;r>i;i++)this.onPacket(n[i])}return this},n.prototype.onPacket=function(e){return this.socket.setHeartbeatTimeout(),"heartbeat"==e.type?this.onHeartbeat():("connect"==e.type&&""==e.endpoint&&this.onConnect(),"error"==e.type&&"reconnect"==e.advice&&(this.isOpen=!1),this.socket.onPacket(e),this)},n.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var e=this;this.closeTimeout=setTimeout(function(){e.onDisconnect()},this.socket.closeTimeout)}},n.prototype.onDisconnect=function(){return this.isOpen&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},n.prototype.onConnect=function(){return this.socket.onConnect(),this},n.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},n.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},n.prototype.packet=function(e){this.send(t.parser.encodePacket(e))},n.prototype.onHeartbeat=function(e){this.packet({type:"heartbeat"})},n.prototype.onOpen=function(){this.isOpen=!0,this.clearCloseTimeout(),this.socket.onOpen()},n.prototype.onClose=function(){this.isOpen=!1,this.socket.onClose(),this.onDisconnect()},n.prototype.prepareUrl=function(){var e=this.socket.options;return this.scheme()+"://"+e.host+":"+e.port+"/"+e.resource+"/"+t.protocol+"/"+this.name+"/"+this.sessid},n.prototype.ready=function(e,t){t.call(this)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t,n){function i(e){if(this.options={port:80,secure:!1,document:"document"in n?document:!1,resource:"socket.io",transports:t.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!1,"auto connect":!0,"flash policy port":10843,manualFlush:!1},t.util.merge(this.options,e),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||t.util.ua.hasCORS)){var i=this;t.util.on(n,"beforeunload",function(){i.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function r(){}e.Socket=i,t.util.mixin(i,t.EventEmitter),i.prototype.of=function(e){return this.namespaces[e]||(this.namespaces[e]=new t.SocketNamespace(this,e),""!==e&&this.namespaces[e].packet({type:"connect"})),this.namespaces[e]},i.prototype.publish=function(){this.emit.apply(this,arguments);var e;for(var t in this.namespaces)this.namespaces.hasOwnProperty(t)&&(e=this.of(t),e.$emit.apply(e,arguments))},i.prototype.handshake=function(e){function n(t){t instanceof Error?(i.connecting=!1,i.onError(t.message)):e.apply(null,t.split(":"))}var i=this,o=this.options,a=["http"+(o.secure?"s":"")+":/",o.host+":"+o.port,o.resource,t.protocol,t.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!t.util.ua.hasCORS){var s=document.getElementsByTagName("script")[0],l=document.createElement("script");l.src=a+"&jsonp="+t.j.length,s.parentNode.insertBefore(l,s),t.j.push(function(e){n(e),l.parentNode.removeChild(l)})}else{var c=t.util.request();c.open("GET",a,!0),this.isXDomain()&&(c.withCredentials=!0),c.onreadystatechange=function(){4==c.readyState&&(c.onreadystatechange=r,200==c.status?n(c.responseText):403==c.status?i.onError(c.responseText):(i.connecting=!1,!i.reconnecting&&i.onError(c.responseText)))},c.send(null)}},i.prototype.getTransport=function(e){for(var n,i=e||this.transports,r=0;n=i[r];r++)if(t.Transport[n]&&t.Transport[n].check(this)&&(!this.isXDomain()||t.Transport[n].xdomainCheck(this)))return new t.Transport[n](this,this.sessionid);return null},i.prototype.connect=function(e){if(this.connecting)return this;var n=this;return n.connecting=!0,this.handshake(function(i,r,o,a){function s(e){return n.transport&&n.transport.clearTimeouts(),n.transport=n.getTransport(e),n.transport?void n.transport.ready(n,function(){n.connecting=!0,n.publish("connecting",n.transport.name),n.transport.open(),n.options["connect timeout"]&&(n.connectTimeoutTimer=setTimeout(function(){if(!n.connected&&(n.connecting=!1,n.options["try multiple transports"])){for(var e=n.transports;e.length>0&&e.splice(0,1)[0]!=n.transport.name;);e.length?s(e):n.publish("connect_failed")}},n.options["connect timeout"]))}):n.publish("connect_failed")}n.sessionid=i,n.closeTimeout=1e3*o,n.heartbeatTimeout=1e3*r,n.transports||(n.transports=n.origTransports=a?t.util.intersect(a.split(","),n.options.transports):n.options.transports),n.setHeartbeatTimeout(),s(n.transports),n.once("connect",function(){clearTimeout(n.connectTimeoutTimer),e&&"function"==typeof e&&e()})}),this},i.prototype.setHeartbeatTimeout=function(){if(clearTimeout(this.heartbeatTimeoutTimer),!this.transport||this.transport.heartbeats()){var e=this;this.heartbeatTimeoutTimer=setTimeout(function(){e.transport.onClose()},this.heartbeatTimeout)}},i.prototype.packet=function(e){return this.connected&&!this.doBuffer?this.transport.packet(e):this.buffer.push(e),this},i.prototype.setBuffer=function(e){this.doBuffer=e,!e&&this.connected&&this.buffer.length&&(this.options.manualFlush||this.flushBuffer())},i.prototype.flushBuffer=function(){this.transport.payload(this.buffer),this.buffer=[]},i.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this},i.prototype.disconnectSync=function(){var e=t.util.request(),n=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,t.protocol,"",this.sessionid].join("/")+"/?disconnect=1";e.open("GET",n,!1),e.send(null),this.onDisconnect("booted")},i.prototype.isXDomain=function(){var e=n.location.port||("https:"==n.location.protocol?443:80);return this.options.host!==n.location.hostname||this.options.port!=e},i.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},i.prototype.onOpen=function(){this.open=!0},i.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},i.prototype.onPacket=function(e){this.of(e.endpoint).onPacket(e)},i.prototype.onError=function(e){e&&e.advice&&"reconnect"===e.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",e&&e.reason?e.reason:e)},i.prototype.onDisconnect=function(e){var t=this.connected,n=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(t||n)&&(this.transport.close(),this.transport.clearTimeouts(),t&&(this.publish("disconnect",e),"booted"!=e&&this.options.reconnect&&!this.reconnecting&&this.reconnect()))},i.prototype.reconnect=function(){function e(){if(n.connected){for(var e in n.namespaces)n.namespaces.hasOwnProperty(e)&&""!==e&&n.namespaces[e].packet({type:"connect"});n.publish("reconnect",n.transport.name,n.reconnectionAttempts)}clearTimeout(n.reconnectionTimer),n.removeListener("connect_failed",t),n.removeListener("connect",t),n.reconnecting=!1,delete n.reconnectionAttempts,delete n.reconnectionDelay,delete n.reconnectionTimer,delete n.redoTransports,n.options["try multiple transports"]=r}function t(){return n.reconnecting?n.connected?e():n.connecting&&n.reconnecting?n.reconnectionTimer=setTimeout(t,1e3):void(n.reconnectionAttempts++>=i?n.redoTransports?(n.publish("reconnect_failed"),e()):(n.on("connect_failed",t),n.options["try multiple transports"]=!0,n.transports=n.origTransports,n.transport=n.getTransport(),n.redoTransports=!0,n.connect()):(n.reconnectionDelay<o&&(n.reconnectionDelay*=2),n.connect(),n.publish("reconnecting",n.reconnectionDelay,n.reconnectionAttempts),n.reconnectionTimer=setTimeout(t,n.reconnectionDelay))):void 0}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var n=this,i=this.options["max reconnection attempts"],r=this.options["try multiple transports"],o=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(t,this.reconnectionDelay),this.on("connect",t)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t){function n(e,t){this.socket=e,this.name=t||"",this.flags={},this.json=new i(this,"json"),this.ackPackets=0,this.acks={}}function i(e,t){this.namespace=e,this.name=t}e.SocketNamespace=n,t.util.mixin(n,t.EventEmitter),n.prototype.$emit=t.EventEmitter.prototype.emit,n.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},n.prototype.packet=function(e){return e.endpoint=this.name,this.socket.packet(e),this.flags={},this},n.prototype.send=function(e,t){var n={type:this.flags.json?"json":"message",data:e};return"function"==typeof t&&(n.id=++this.ackPackets,n.ack=!0,this.acks[n.id]=t),this.packet(n)},n.prototype.emit=function(e){var t=Array.prototype.slice.call(arguments,1),n=t[t.length-1],i={type:"event",name:e};return"function"==typeof n&&(i.id=++this.ackPackets,i.ack="data",this.acks[i.id]=n,t=t.slice(0,t.length-1)),i.args=t,this.packet(i)},n.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},n.prototype.onPacket=function(e){function n(){i.packet({type:"ack",args:t.util.toArray(arguments),ackId:e.id})}var i=this;switch(e.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(e.reason||"booted"):this.$emit("disconnect",e.reason);break;case"message":case"json":var r=["message",e.data];"data"==e.ack?r.push(n):e.ack&&this.packet({type:"ack",ackId:e.id}),this.$emit.apply(this,r);break;case"event":var r=[e.name].concat(e.args);"data"==e.ack&&r.push(n),this.$emit.apply(this,r);break;case"ack":this.acks[e.ackId]&&(this.acks[e.ackId].apply(this,e.args),delete this.acks[e.ackId]);break;case"error":e.advice?this.socket.onError(e):"unauthorized"==e.reason?this.$emit("connect_failed",e.reason):this.$emit("error",e.reason)}},i.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},i.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t,n){function i(e){t.Transport.apply(this,arguments)}e.websocket=i,t.util.inherit(i,t.Transport),i.prototype.name="websocket",i.prototype.open=function(){var e,i=t.util.query(this.socket.options.query),r=this;return e||(e=n.MozWebSocket||n.WebSocket),this.websocket=new e(this.prepareUrl()+i),this.websocket.onopen=function(){r.onOpen(),r.socket.setBuffer(!1)},this.websocket.onmessage=function(e){r.onData(e.data)},this.websocket.onclose=function(){r.onClose(),r.socket.setBuffer(!0)},this.websocket.onerror=function(e){r.onError(e)},this},t.util.ua.iDevice?i.prototype.send=function(e){var t=this;return setTimeout(function(){t.websocket.send(e)},0),this}:i.prototype.send=function(e){return this.websocket.send(e),this},i.prototype.payload=function(e){for(var t=0,n=e.length;n>t;t++)this.packet(e[t]);return this},i.prototype.close=function(){return this.websocket.close(),this},i.prototype.onError=function(e){this.socket.onError(e)},i.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},i.check=function(){return"WebSocket"in n&&!("__addTask"in WebSocket)||"MozWebSocket"in n},i.xdomainCheck=function(){return!0},t.transports.push("websocket")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t){function n(){t.Transport.websocket.apply(this,arguments)}e.flashsocket=n,t.util.inherit(n,t.Transport.websocket),n.prototype.name="flashsocket",n.prototype.open=function(){var e=this,n=arguments;return WebSocket.__addTask(function(){t.Transport.websocket.prototype.open.apply(e,n)}),this},n.prototype.send=function(){var e=this,n=arguments;return WebSocket.__addTask(function(){t.Transport.websocket.prototype.send.apply(e,n)}),this},n.prototype.close=function(){return WebSocket.__tasks.length=0,t.Transport.websocket.prototype.close.call(this),this},n.prototype.ready=function(e,i){function r(){var t=e.options,r=t["flash policy port"],a=["http"+(t.secure?"s":"")+":/",t.host+":"+t.port,t.resource,"static/flashsocket","WebSocketMain"+(e.isXDomain()?"Insecure":"")+".swf"];n.loaded||("undefined"==typeof WEB_SOCKET_SWF_LOCATION&&(WEB_SOCKET_SWF_LOCATION=a.join("/")),843!==r&&WebSocket.loadFlashPolicyFile("xmlsocket://"+t.host+":"+r),WebSocket.__initialize(),n.loaded=!0),i.call(o)}var o=this;return document.body?r():void t.util.load(r)},n.check=function(){return"undefined"!=typeof WebSocket&&"__initialize"in WebSocket&&swfobject?swfobject.getFlashPlayerVersion().major>=10:!1},n.xdomainCheck=function(){return!0},"undefined"!=typeof window&&(WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0),t.transports.push("flashsocket")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports),"undefined"!=typeof window)var swfobject=function(){function e(){if(!F){try{var e=D.getElementsByTagName("body")[0].appendChild(g("span"));e.parentNode.removeChild(e)}catch(t){return}F=!0;for(var n=L.length,i=0;n>i;i++)L[i]()}}function t(e){F?e():L[L.length]=e}function n(e){if(typeof A.addEventListener!=I)A.addEventListener("load",e,!1);else if(typeof D.addEventListener!=I)D.addEventListener("load",e,!1);else if(typeof A.attachEvent!=I)v(A,"onload",e);else if("function"==typeof A.onload){var t=A.onload;A.onload=function(){t(),e()}}else A.onload=e}function i(){N?r():o()}function r(){var e=D.getElementsByTagName("body")[0],t=g(P);t.setAttribute("type",B);var n=e.appendChild(t);if(n){var i=0;!function(){if(typeof n.GetVariable!=I){var r=n.GetVariable("$version");r&&(r=r.split(" ")[1].split(","),W.pv=[parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10)])}else if(10>i)return i++,void setTimeout(arguments.callee,10);e.removeChild(t),n=null,o()}()}else o()}function o(){var e=G.length;if(e>0)for(var t=0;e>t;t++){var n=G[t].id,i=G[t].callbackFn,r={success:!1,id:n};if(W.pv[0]>0){var o=m(n);if(o)if(!y(G[t].swfVersion)||W.wk&&W.wk<312)if(G[t].expressInstall&&s()){var d={};d.data=G[t].expressInstall,d.width=o.getAttribute("width")||"0",d.height=o.getAttribute("height")||"0",o.getAttribute("class")&&(d.styleclass=o.getAttribute("class")),o.getAttribute("align")&&(d.align=o.getAttribute("align"));for(var u={},h=o.getElementsByTagName("param"),f=h.length,p=0;f>p;p++)"movie"!=h[p].getAttribute("name").toLowerCase()&&(u[h[p].getAttribute("name")]=h[p].getAttribute("value"));l(d,u,n,i)}else c(o),i&&i(r);else w(n,!0),i&&(r.success=!0,r.ref=a(n),i(r))}else if(w(n,!0),i){var g=a(n);g&&typeof g.SetVariable!=I&&(r.success=!0,r.ref=g),i(r)}}}function a(e){var t=null,n=m(e);if(n&&"OBJECT"==n.nodeName)if(typeof n.SetVariable!=I)t=n;else{var i=n.getElementsByTagName(P)[0];i&&(t=i)}return t}function s(){return!z&&y("6.0.65")&&(W.win||W.mac)&&!(W.wk&&W.wk<312)}function l(e,t,n,i){z=!0,j=i||null,T={success:!1,id:n};var r=m(n);if(r){"OBJECT"==r.nodeName?(x=d(r),C=null):(x=r,C=n),e.id=E,(typeof e.width==I||!/%$/.test(e.width)&&parseInt(e.width,10)<310)&&(e.width="310"),(typeof e.height==I||!/%$/.test(e.height)&&parseInt(e.height,10)<137)&&(e.height="137"),D.title=D.title.slice(0,47)+" - Flash Player Installation";var o=W.ie&&W.win?["Active"].concat("").join("X"):"PlugIn",a="MMredirectURL="+A.location.toString().replace(/&/g,"%26")+"&MMplayerType="+o+"&MMdoctitle="+D.title;if(typeof t.flashvars!=I?t.flashvars+="&"+a:t.flashvars=a,W.ie&&W.win&&4!=r.readyState){var s=g("div");n+="SWFObjectNew",s.setAttribute("id",n),r.parentNode.insertBefore(s,r),r.style.display="none",function(){4==r.readyState?r.parentNode.removeChild(r):setTimeout(arguments.callee,10)}()}u(e,t,n)}}function c(e){if(W.ie&&W.win&&4!=e.readyState){var t=g("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(d(e),t),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}else e.parentNode.replaceChild(d(e),e)}function d(e){var t=g("div");if(W.win&&W.ie)t.innerHTML=e.innerHTML;else{var n=e.getElementsByTagName(P)[0];if(n){var i=n.childNodes;if(i)for(var r=i.length,o=0;r>o;o++)1==i[o].nodeType&&"PARAM"==i[o].nodeName||8==i[o].nodeType||t.appendChild(i[o].cloneNode(!0))}}return t}function u(e,t,n){var i,r=m(n);if(W.wk&&W.wk<312)return i;if(r)if(typeof e.id==I&&(e.id=n),W.ie&&W.win){var o="";for(var a in e)e[a]!=Object.prototype[a]&&("data"==a.toLowerCase()?t.movie=e[a]:"styleclass"==a.toLowerCase()?o+=' class="'+e[a]+'"':"classid"!=a.toLowerCase()&&(o+=" "+a+'="'+e[a]+'"'));var s="";for(var l in t)t[l]!=Object.prototype[l]&&(s+='<param name="'+l+'" value="'+t[l]+'" />');r.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+o+">"+s+"</object>",R[R.length]=e.id,i=m(e.id)}else{var c=g(P);c.setAttribute("type",B);for(var d in e)e[d]!=Object.prototype[d]&&("styleclass"==d.toLowerCase()?c.setAttribute("class",e[d]):"classid"!=d.toLowerCase()&&c.setAttribute(d,e[d]));for(var u in t)t[u]!=Object.prototype[u]&&"movie"!=u.toLowerCase()&&h(c,u,t[u]);r.parentNode.replaceChild(c,r),i=c}return i}function h(e,t,n){var i=g("param");i.setAttribute("name",t),i.setAttribute("value",n),e.appendChild(i)}function f(e){var t=m(e);t&&"OBJECT"==t.nodeName&&(W.ie&&W.win?(t.style.display="none",function(){4==t.readyState?p(e):setTimeout(arguments.callee,10)}()):t.parentNode.removeChild(t))}function p(e){var t=m(e);if(t){for(var n in t)"function"==typeof t[n]&&(t[n]=null);t.parentNode.removeChild(t)}}function m(e){var t=null;try{t=D.getElementById(e)}catch(n){}return t}function g(e){return D.createElement(e)}function v(e,t,n){e.attachEvent(t,n),V[V.length]=[e,t,n]}function y(e){var t=W.pv,n=e.split(".");return n[0]=parseInt(n[0],10),n[1]=parseInt(n[1],10)||0,n[2]=parseInt(n[2],10)||0,t[0]>n[0]||t[0]==n[0]&&t[1]>n[1]||t[0]==n[0]&&t[1]==n[1]&&t[2]>=n[2]?!0:!1}function b(e,t,n,i){if(!W.ie||!W.mac){var r=D.getElementsByTagName("head")[0];if(r){var o=n&&"string"==typeof n?n:"screen";if(i&&(_=null,S=null),!_||S!=o){var a=g("style");a.setAttribute("type","text/css"),a.setAttribute("media",o),_=r.appendChild(a),W.ie&&W.win&&typeof D.styleSheets!=I&&D.styleSheets.length>0&&(_=D.styleSheets[D.styleSheets.length-1]),S=o}W.ie&&W.win?_&&typeof _.addRule==P&&_.addRule(e,t):_&&typeof D.createTextNode!=I&&_.appendChild(D.createTextNode(e+" {"+t+"}"))}}}function w(e,t){if(U){var n=t?"visible":"hidden";F&&m(e)?m(e).style.visibility=n:b("#"+e,"visibility:"+n)}}function k(e){var t=/[\\\"<>\.;]/,n=null!=t.exec(e);return n&&typeof encodeURIComponent!=I?encodeURIComponent(e):e}var x,C,j,T,_,S,I="undefined",P="object",M="Shockwave Flash",Q="ShockwaveFlash.ShockwaveFlash",B="application/x-shockwave-flash",E="SWFObjectExprInst",O="onreadystatechange",A=window,D=document,H=navigator,N=!1,L=[i],G=[],R=[],V=[],F=!1,z=!1,U=!0,W=function(){var e=typeof D.getElementById!=I&&typeof D.getElementsByTagName!=I&&typeof D.createElement!=I,t=H.userAgent.toLowerCase(),n=H.platform.toLowerCase(),i=n?/win/.test(n):/win/.test(t),r=n?/mac/.test(n):/mac/.test(t),o=/webkit/.test(t)?parseFloat(t.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,a=!1,s=[0,0,0],l=null;if(typeof H.plugins!=I&&typeof H.plugins[M]==P)l=H.plugins[M].description,!l||typeof H.mimeTypes!=I&&H.mimeTypes[B]&&!H.mimeTypes[B].enabledPlugin||(N=!0,a=!1,l=l.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),s[0]=parseInt(l.replace(/^(.*)\..*$/,"$1"),10),s[1]=parseInt(l.replace(/^.*\.(.*)\s.*$/,"$1"),10),s[2]=/[a-zA-Z]/.test(l)?parseInt(l.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof A[["Active"].concat("Object").join("X")]!=I)try{var c=new(window[["Active"].concat("Object").join("X")])(Q);c&&(l=c.GetVariable("$version"),l&&(a=!0,l=l.split(" ")[1].split(","),s=[parseInt(l[0],10),parseInt(l[1],10),parseInt(l[2],10)]))}catch(d){}return{w3:e,pv:s,wk:o,ie:a,win:i,mac:r}}();(function(){W.w3&&((typeof D.readyState!=I&&"complete"==D.readyState||typeof D.readyState==I&&(D.getElementsByTagName("body")[0]||D.body))&&e(),F||(typeof D.addEventListener!=I&&D.addEventListener("DOMContentLoaded",e,!1),W.ie&&W.win&&(D.attachEvent(O,function(){"complete"==D.readyState&&(D.detachEvent(O,arguments.callee),e())}),A==top&&!function(){if(!F){try{D.documentElement.doScroll("left")}catch(t){return void setTimeout(arguments.callee,0)}e()}}()),W.wk&&!function(){return F?void 0:/loaded|complete/.test(D.readyState)?void e():void setTimeout(arguments.callee,0)}(),n(e)))})(),function(){W.ie&&W.win&&window.attachEvent("onunload",function(){for(var e=V.length,t=0;e>t;t++)V[t][0].detachEvent(V[t][1],V[t][2]);for(var n=R.length,i=0;n>i;i++)f(R[i]);for(var r in W)W[r]=null;W=null;for(var o in swfobject)swfobject[o]=null;swfobject=null})}();return{registerObject:function(e,t,n,i){if(W.w3&&e&&t){var r={};r.id=e,r.swfVersion=t,r.expressInstall=n,r.callbackFn=i,G[G.length]=r,w(e,!1)}else i&&i({success:!1,id:e})},getObjectById:function(e){return W.w3?a(e):void 0},embedSWF:function(e,n,i,r,o,a,c,d,h,f){var p={success:!1,id:n};W.w3&&!(W.wk&&W.wk<312)&&e&&n&&i&&r&&o?(w(n,!1),t(function(){i+="",r+="";var t={};if(h&&typeof h===P)for(var m in h)t[m]=h[m];t.data=e,t.width=i,t.height=r;var g={};if(d&&typeof d===P)for(var v in d)g[v]=d[v];if(c&&typeof c===P)for(var b in c)typeof g.flashvars!=I?g.flashvars+="&"+b+"="+c[b]:g.flashvars=b+"="+c[b];if(y(o)){var k=u(t,g,n);t.id==n&&w(n,!0),p.success=!0,p.ref=k}else{if(a&&s())return t.data=a,void l(t,g,n,f);w(n,!0)}f&&f(p)})):f&&f(p)},switchOffAutoHideShow:function(){U=!1},ua:W,getFlashPlayerVersion:function(){return{major:W.pv[0],minor:W.pv[1],release:W.pv[2]}},hasFlashPlayerVersion:y,createSWF:function(e,t,n){return W.w3?u(e,t,n):void 0},showExpressInstall:function(e,t,n,i){W.w3&&s()&&l(e,t,n,i)},removeSWF:function(e){W.w3&&f(e)},createCSS:function(e,t,n,i){W.w3&&b(e,t,n,i)},addDomLoadEvent:t,addLoadEvent:n,getQueryParamValue:function(e){var t=D.location.search||D.location.hash;if(t){if(/\?/.test(t)&&(t=t.split("?")[1]),null==e)return k(t);for(var n=t.split("&"),i=0;i<n.length;i++)if(n[i].substring(0,n[i].indexOf("="))==e)return k(n[i].substring(n[i].indexOf("=")+1))}return""},expressInstallCallback:function(){if(z){var e=m(E);e&&x&&(e.parentNode.replaceChild(x,e),C&&(w(C,!0),W.ie&&W.win&&(x.style.display="block")),j&&j(T)),z=!1}}}}();!function(){if("undefined"!=typeof window&&!window.WebSocket){var e=window.console;if(e&&e.log&&e.error||(e={log:function(){},error:function(){}}),!swfobject.hasFlashPlayerVersion("10.0.0"))return void e.error("Flash Player >= 10.0.0 is required.");"file:"==location.protocol&&e.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://..."),WebSocket=function(e,t,n,i,r){var o=this;o.__id=WebSocket.__nextId++,WebSocket.__instances[o.__id]=o,o.readyState=WebSocket.CONNECTING,o.bufferedAmount=0,o.__events={},t?"string"==typeof t&&(t=[t]):t=[],setTimeout(function(){WebSocket.__addTask(function(){WebSocket.__flash.create(o.__id,e,t,n||null,i||0,r||null)})},0)},WebSocket.prototype.send=function(e){if(this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";var t=WebSocket.__flash.send(this.__id,encodeURIComponent(e));return 0>t?!0:(this.bufferedAmount+=t,!1)},WebSocket.prototype.close=function(){this.readyState!=WebSocket.CLOSED&&this.readyState!=WebSocket.CLOSING&&(this.readyState=WebSocket.CLOSING,WebSocket.__flash.close(this.__id))},WebSocket.prototype.addEventListener=function(e,t,n){e in this.__events||(this.__events[e]=[]),this.__events[e].push(t)},WebSocket.prototype.removeEventListener=function(e,t,n){if(e in this.__events)for(var i=this.__events[e],r=i.length-1;r>=0;--r)if(i[r]===t){i.splice(r,1);break}},WebSocket.prototype.dispatchEvent=function(e){for(var t=this.__events[e.type]||[],n=0;n<t.length;++n)t[n](e);var i=this["on"+e.type];i&&i(e)},WebSocket.prototype.__handleEvent=function(e){"readyState"in e&&(this.readyState=e.readyState),"protocol"in e&&(this.protocol=e.protocol);var t;if("open"==e.type||"error"==e.type)t=this.__createSimpleEvent(e.type);else if("close"==e.type)t=this.__createSimpleEvent("close");else{if("message"!=e.type)throw"unknown event type: "+e.type;var n=decodeURIComponent(e.message);t=this.__createMessageEvent("message",n)}this.dispatchEvent(t)},WebSocket.prototype.__createSimpleEvent=function(e){if(document.createEvent&&window.Event){var t=document.createEvent("Event");return t.initEvent(e,!1,!1),t}return{type:e,bubbles:!1,cancelable:!1}},WebSocket.prototype.__createMessageEvent=function(e,t){if(document.createEvent&&window.MessageEvent&&!window.opera){var n=document.createEvent("MessageEvent");return n.initMessageEvent("message",!1,!1,t,null,null,window,null),n}return{type:e,data:t,bubbles:!1,cancelable:!1}},WebSocket.CONNECTING=0,WebSocket.OPEN=1,WebSocket.CLOSING=2,WebSocket.CLOSED=3,WebSocket.__flash=null,WebSocket.__instances={},WebSocket.__tasks=[],WebSocket.__nextId=0,WebSocket.loadFlashPolicyFile=function(e){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(e)})},WebSocket.__initialize=function(){if(!WebSocket.__flash){if(WebSocket.__swfLocation&&(window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation),!window.WEB_SOCKET_SWF_LOCATION)return void e.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf");var t=document.createElement("div");t.id="webSocketContainer",t.style.position="absolute",WebSocket.__isFlashLite()?(t.style.left="0px",t.style.top="0px"):(t.style.left="-100px",t.style.top="-100px");var n=document.createElement("div");n.id="webSocketFlash",t.appendChild(n),document.body.appendChild(t),swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:!0,swliveconnect:!0,allowScriptAccess:"always"},null,function(t){t.success||e.error("[WebSocket] swfobject.embedSWF failed")})}},WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash"),WebSocket.__flash.setCallerUrl(location.href),WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var e=0;e<WebSocket.__tasks.length;++e)WebSocket.__tasks[e]();WebSocket.__tasks=[]},0)},WebSocket.__onFlashEvent=function(){return setTimeout(function(){try{for(var t=WebSocket.__flash.receiveEvents(),n=0;n<t.length;++n)WebSocket.__instances[t[n].webSocketId].__handleEvent(t[n])}catch(i){e.error(i)}},0),!0},WebSocket.__log=function(t){e.log(decodeURIComponent(t))},WebSocket.__error=function(t){e.error(decodeURIComponent(t))},WebSocket.__addTask=function(e){WebSocket.__flash?e():WebSocket.__tasks.push(e)},WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return!1;var e=window.navigator.mimeTypes["application/x-shockwave-flash"];return e&&e.enabledPlugin&&e.enabledPlugin.filename&&e.enabledPlugin.filename.match(/flashlite/i)?!0:!1},window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||(window.addEventListener?window.addEventListener("load",function(){WebSocket.__initialize()},!1):window.attachEvent("onload",function(){WebSocket.__initialize()}))}}(),function(e,t,n){function i(e){e&&(t.Transport.apply(this,arguments),this.sendBuffer=[])}function r(){}e.XHR=i,t.util.inherit(i,t.Transport),i.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},i.prototype.payload=function(e){for(var n=[],i=0,r=e.length;r>i;i++)n.push(t.parser.encodePacket(e[i]));this.send(t.parser.encodePayload(n))},i.prototype.send=function(e){return this.post(e),this},i.prototype.post=function(e){function t(){4==this.readyState&&(this.onreadystatechange=r,o.posting=!1,200==this.status?o.socket.setBuffer(!1):o.onClose())}function i(){this.onload=r,o.socket.setBuffer(!1)}var o=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),n.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=i:this.sendXHR.onreadystatechange=t,this.sendXHR.send(e)},i.prototype.close=function(){return this.onClose(),this},i.prototype.request=function(e){var n=t.util.request(this.socket.isXDomain()),i=t.util.query(this.socket.options.query,"t="+ +new Date);if(n.open(e||"GET",this.prepareUrl()+i,!0),"POST"==e)try{n.setRequestHeader?n.setRequestHeader("Content-type","text/plain;charset=UTF-8"):n.contentType="text/plain"}catch(r){}return n},i.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},i.check=function(e,i){try{var r=t.util.request(i),o=n.XDomainRequest&&r instanceof XDomainRequest,a=e&&e.options&&e.options.secure?"https:":"http:",s=n.location&&a!=n.location.protocol;if(r&&(!o||!s))return!0}catch(l){}return!1},i.xdomainCheck=function(e){return i.check(e,!0)}}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t){function n(e){t.Transport.XHR.apply(this,arguments)}e.htmlfile=n,
t.util.inherit(n,t.Transport.XHR),n.prototype.name="htmlfile",n.prototype.get=function(){this.doc=new(window[["Active"].concat("Object").join("X")])("htmlfile"),this.doc.open(),this.doc.write("<html></html>"),this.doc.close(),this.doc.parentWindow.s=this;var e=this.doc.createElement("div");e.className="socketio",this.doc.body.appendChild(e),this.iframe=this.doc.createElement("iframe"),e.appendChild(this.iframe);var n=this,i=t.util.query(this.socket.options.query,"t="+ +new Date);this.iframe.src=this.prepareUrl()+i,t.util.on(window,"unload",function(){n.destroy()})},n.prototype._=function(e,t){e=e.replace(/\\\//g,"/"),this.onData(e);try{var n=t.getElementsByTagName("script")[0];n.parentNode.removeChild(n)}catch(i){}},n.prototype.destroy=function(){if(this.iframe){try{this.iframe.src="about:blank"}catch(e){}this.doc=null,this.iframe.parentNode.removeChild(this.iframe),this.iframe=null,CollectGarbage()}},n.prototype.close=function(){return this.destroy(),t.Transport.XHR.prototype.close.call(this)},n.check=function(e){if("undefined"!=typeof window&&["Active"].concat("Object").join("X")in window)try{var n=new(window[["Active"].concat("Object").join("X")])("htmlfile");return n&&t.Transport.XHR.check(e)}catch(i){}return!1},n.xdomainCheck=function(){return!1},t.transports.push("htmlfile")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(e,t,n){function i(){t.Transport.XHR.apply(this,arguments)}function r(){}e["xhr-polling"]=i,t.util.inherit(i,t.Transport.XHR),t.util.merge(i,t.Transport.XHR),i.prototype.name="xhr-polling",i.prototype.heartbeats=function(){return!1},i.prototype.open=function(){var e=this;return t.Transport.XHR.prototype.open.call(e),!1},i.prototype.get=function(){function e(){4==this.readyState&&(this.onreadystatechange=r,200==this.status?(o.onData(this.responseText),o.get()):o.onClose())}function t(){this.onload=r,this.onerror=r,o.retryCounter=1,o.onData(this.responseText),o.get()}function i(){o.retryCounter++,!o.retryCounter||o.retryCounter>3?o.onClose():o.get()}if(this.isOpen){var o=this;this.xhr=this.request(),n.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=t,this.xhr.onerror=i):this.xhr.onreadystatechange=e,this.xhr.send(null)}},i.prototype.onClose=function(){if(t.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=r;try{this.xhr.abort()}catch(e){}this.xhr=null}},i.prototype.ready=function(e,n){var i=this;t.util.defer(function(){n.call(i)})},t.transports.push("xhr-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(e,t,n){function i(e){t.Transport["xhr-polling"].apply(this,arguments),this.index=t.j.length;var n=this;t.j.push(function(e){n._(e)})}var r=n.document&&"MozAppearance"in n.document.documentElement.style;e["jsonp-polling"]=i,t.util.inherit(i,t.Transport["xhr-polling"]),i.prototype.name="jsonp-polling",i.prototype.post=function(e){function n(){i(),r.socket.setBuffer(!1)}function i(){r.iframe&&r.form.removeChild(r.iframe);try{a=document.createElement('<iframe name="'+r.iframeId+'">')}catch(e){a=document.createElement("iframe"),a.name=r.iframeId}a.id=r.iframeId,r.form.appendChild(a),r.iframe=a}var r=this,o=t.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);if(!this.form){var a,s=document.createElement("form"),l=document.createElement("textarea"),c=this.iframeId="socketio_iframe_"+this.index;s.className="socketio",s.style.position="absolute",s.style.top="0px",s.style.left="0px",s.style.display="none",s.target=c,s.method="POST",s.setAttribute("accept-charset","utf-8"),l.name="d",s.appendChild(l),document.body.appendChild(s),this.form=s,this.area=l}this.form.action=this.prepareUrl()+o,i(),this.area.value=t.JSON.stringify(e);try{this.form.submit()}catch(d){}this.iframe.attachEvent?a.onreadystatechange=function(){"complete"==r.iframe.readyState&&n()}:this.iframe.onload=n,this.socket.setBuffer(!0)},i.prototype.get=function(){var e=this,n=document.createElement("script"),i=t.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),n.async=!0,n.src=this.prepareUrl()+i,n.onerror=function(){e.onClose()};var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(n,o),this.script=n,r&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},i.prototype._=function(e){return this.onData(e),this.isOpen&&this.get(),this},i.prototype.ready=function(e,n){var i=this;return r?void t.util.load(function(){n.call(i)}):n.call(this)},i.check=function(){return"document"in n},i.xdomainCheck=function(){return!0},t.transports.push("jsonp-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),"function"==typeof define&&define.amd&&define([],function(){return io})}(),function(e,t){"use strict";function n(n,i){function r(e){return fe.preferFlash&&oe&&!fe.ignoreFlash&&fe.flash[e]!==t&&fe.flash[e]}function o(e){return function(t){var n,i=this._s;return n=i&&i._a?e.call(this,t):null}}this.setupOptions={url:n||null,flashVersion:8,debugMode:!0,debugFlash:!1,useConsole:!0,consoleOnly:!0,waitForWindowLoad:!1,bgColor:"#ffffff",useHighPerformance:!1,flashPollingInterval:null,html5PollingInterval:null,flashLoadTimeout:1e3,wmode:null,allowScriptAccess:"always",useFlashBlock:!1,useHTML5Audio:!0,forceUseGlobalHTML5Audio:!1,ignoreMobileRestrictions:!1,html5Test:/^(probably|maybe)$/i,preferFlash:!1,noSWFCache:!1,idPrefix:"sound"},this.defaultOptions={autoLoad:!1,autoPlay:!1,from:null,loops:1,onid3:null,onload:null,whileloading:null,onplay:null,onpause:null,onresume:null,whileplaying:null,onposition:null,onstop:null,onfailure:null,onfinish:null,multiShot:!0,multiShotEvents:!1,position:null,pan:0,stream:!0,to:null,type:null,usePolicyFile:!1,volume:100},this.flash9Options={isMovieStar:null,usePeakData:!1,useWaveformData:!1,useEQData:!1,onbufferchange:null,ondataerror:null},this.movieStarOptions={bufferTime:3,serverURL:null,onconnect:null,duration:null},this.audioFormats={mp3:{type:['audio/mpeg; codecs="mp3"',"audio/mpeg","audio/mp3","audio/MPA","audio/mpa-robust"],required:!0},mp4:{related:["aac","m4a","m4b"],type:['audio/mp4; codecs="mp4a.40.2"',"audio/aac","audio/x-m4a","audio/MP4A-LATM","audio/mpeg4-generic"],required:!1},ogg:{type:["audio/ogg; codecs=vorbis"],required:!1},opus:{type:["audio/ogg; codecs=opus","audio/opus"],required:!1},wav:{type:['audio/wav; codecs="1"',"audio/wav","audio/wave","audio/x-wav"],required:!1}},this.movieID="sm2-container",this.id=i||"sm2movie",this.debugID="soundmanager-debug",this.debugURLParam=/([#?&])debug=1/i,this.versionNumber="V2.97a.20150601",this.version=null,this.movieURL=null,this.altURL=null,this.swfLoaded=!1,this.enabled=!1,this.oMC=null,this.sounds={},this.soundIDs=[],this.muted=!1,this.didFlashBlock=!1,this.filePattern=null,this.filePatterns={flash8:/\.mp3(\?.*)?$/i,flash9:/\.mp3(\?.*)?$/i},this.features={buffering:!1,peakData:!1,waveformData:!1,eqData:!1,movieStar:!1},this.sandbox={},this.html5={usingFlash:null},this.flash={},this.html5Only=!1,this.ignoreFlash=!1;var a,s,l,c,d,u,h,f,p,m,g,v,y,b,w,k,x,C,j,T,_,S,I,P,M,Q,B,E,O,A,D,H,N,L,G,R,V,F,z,U,W,q,$,K,J,X,Y,Z,ee,te,ne,ie,re,oe,ae,se,le,ce,de,ue,he,fe=this,pe=null,me=null,ge=navigator.userAgent,ve=e.location.href.toString(),ye=document,be=[],we=!1,ke=!1,xe=!1,Ce=!1,je=!1,Te=8,_e=null,Se=null,Ie=!1,Pe=!1,Me=0,Qe=null,Be=[],Ee=null,Oe=Array.prototype.slice,Ae=!1,De=0,He=1e3,Ne=ge.match(/(ipad|iphone|ipod)/i),Le=ge.match(/android/i),Ge=ge.match(/msie/i),Re=ge.match(/webkit/i),Ve=ge.match(/safari/i)&&!ge.match(/chrome/i),Fe=ge.match(/opera/i),ze=ge.match(/(mobile|pre\/|xoom)/i)||Ne||Le,Ue=!ve.match(/usehtml5audio/i)&&!ve.match(/sm2\-ignorebadua/i)&&Ve&&!ge.match(/silk/i)&&ge.match(/OS X 10_6_([3-7])/i),We=(e.console!==t&&console.log!==t,ye.hasFocus!==t?ye.hasFocus():null),qe=Ve&&(ye.hasFocus===t||!ye.hasFocus()),$e=!qe,Ke=/(mp3|mp4|mpa|m4a|m4b)/i,Je="about:blank",Xe="data:audio/wave;base64,/UklGRiYAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQIAAAD//w==",Ye=ye.location?ye.location.protocol.match(/http/i):null,Ze=Ye?"":"http://",et=/^\s*audio\/(?:x-)?(?:mpeg4|aac|flv|mov|mp4||m4v|m4a|m4b|mp4v|3gp|3g2)\s*(?:$|;)/i,tt=["mpeg4","aac","flv","mov","mp4","m4v","f4v","m4a","m4b","mp4v","3gp","3g2"],nt=new RegExp("\\.("+tt.join("|")+")(\\?.*)?$","i");this.mimePattern=/^\s*audio\/(?:x-)?(?:mp(?:eg|3))\s*(?:$|;)/i,this.useAltURL=!Ye,G={swfBox:"sm2-object-box",swfDefault:"movieContainer",swfError:"swf_error",swfTimedout:"swf_timedout",swfLoaded:"swf_loaded",swfUnblocked:"swf_unblocked",sm2Debug:"sm2_debug",highPerf:"high_performance",flashDebug:"flash_debug"},this.hasHTML5=function(){try{return Audio!==t&&(Fe&&opera!==t&&opera.version()<10?new Audio(null):new Audio).canPlayType!==t}catch(e){return!1}}(),this.setup=function(e){var n=!fe.url;return e!==t&&xe&&Ee&&fe.ok()&&(e.flashVersion!==t||e.url!==t||e.html5Test!==t),p(e),Ae||(ze?(!fe.setupOptions.ignoreMobileRestrictions||fe.setupOptions.forceUseGlobalHTML5Audio)&&(Be.push(j.globalHTML5),Ae=!0):fe.setupOptions.forceUseGlobalHTML5Audio&&(Be.push(j.globalHTML5),Ae=!0)),!he&&ze&&(fe.setupOptions.ignoreMobileRestrictions?Be.push(j.ignoreMobile):(fe.setupOptions.useHTML5Audio=!0,fe.setupOptions.preferFlash=!1,Ne?fe.ignoreFlash=!0:(Le&&!ge.match(/android\s2\.3/i)||!Le)&&(Ae=!0))),e&&(n&&I&&e.url!==t&&fe.beginDelayedInit(),I||e.url===t||"complete"!==ye.readyState||setTimeout(_,1)),he=!0,fe},this.ok=function(){return Ee?xe&&!Ce:fe.useHTML5Audio&&fe.hasHTML5},this.supported=this.ok,this.getMovie=function(t){return s(t)||ye[t]||e[t]},this.createSound=function(e,n){function i(){return o=R(o),fe.sounds[o.id]=new a(o),fe.soundIDs.push(o.id),fe.sounds[o.id]}var r,o,s=null;if(!xe||!fe.ok())return!1;if(n!==t&&(e={id:e,url:n}),o=f(e),o.url=$(o.url),o.id===t&&(o.id=fe.setupOptions.idPrefix+De++),z(o.id,!0))return fe.sounds[o.id];if(X(o))s=i(),s._setup_html5(o);else{if(fe.html5Only)return i();if(fe.html5.usingFlash&&o.url&&o.url.match(/data\:/i))return i();u>8&&null===o.isMovieStar&&(o.isMovieStar=!!(o.serverURL||(o.type?o.type.match(et):!1)||o.url&&o.url.match(nt))),o=V(o,r),s=i(),8===u?me._createSound(o.id,o.loops||1,o.usePolicyFile):(me._createSound(o.id,o.url,o.usePeakData,o.useWaveformData,o.useEQData,o.isMovieStar,o.isMovieStar?o.bufferTime:!1,o.loops||1,o.serverURL,o.duration||null,o.autoPlay,!0,o.autoLoad,o.usePolicyFile),o.serverURL||(s.connected=!0,o.onconnect&&o.onconnect.apply(s))),o.serverURL||!o.autoLoad&&!o.autoPlay||s.load(o)}return!o.serverURL&&o.autoPlay&&s.play(),s},this.destroySound=function(e,t){if(!z(e))return!1;var n,i=fe.sounds[e];for(i.stop(),i._iO={},i.unload(),n=0;n<fe.soundIDs.length;n++)if(fe.soundIDs[n]===e){fe.soundIDs.splice(n,1);break}return t||i.destruct(!0),i=null,delete fe.sounds[e],!0},this.load=function(e,t){return z(e)?fe.sounds[e].load(t):!1},this.unload=function(e){return z(e)?fe.sounds[e].unload():!1},this.onPosition=function(e,t,n,i){return z(e)?fe.sounds[e].onposition(t,n,i):!1},this.onposition=this.onPosition,this.clearOnPosition=function(e,t,n){return z(e)?fe.sounds[e].clearOnPosition(t,n):!1},this.play=function(e,t){var n=null,i=t&&!(t instanceof Object);if(!xe||!fe.ok())return!1;if(z(e,i))i&&(t={url:t});else{if(!i)return!1;i&&(t={url:t}),t&&t.url&&(t.id=e,n=fe.createSound(t).play())}return null===n&&(n=fe.sounds[e].play(t)),n},this.start=this.play,this.setPosition=function(e,t){return z(e)?fe.sounds[e].setPosition(t):!1},this.stop=function(e){return z(e)?fe.sounds[e].stop():!1},this.stopAll=function(){var e;for(e in fe.sounds)fe.sounds.hasOwnProperty(e)&&fe.sounds[e].stop()},this.pause=function(e){return z(e)?fe.sounds[e].pause():!1},this.pauseAll=function(){var e;for(e=fe.soundIDs.length-1;e>=0;e--)fe.sounds[fe.soundIDs[e]].pause()},this.resume=function(e){return z(e)?fe.sounds[e].resume():!1},this.resumeAll=function(){var e;for(e=fe.soundIDs.length-1;e>=0;e--)fe.sounds[fe.soundIDs[e]].resume()},this.togglePause=function(e){return z(e)?fe.sounds[e].togglePause():!1},this.setPan=function(e,t){return z(e)?fe.sounds[e].setPan(t):!1},this.setVolume=function(e,n){var i,r;{if(e===t||isNaN(e)||n!==t)return z(e)?fe.sounds[e].setVolume(n):!1;for(i=0,r=fe.soundIDs.length;r>i;i++)fe.sounds[fe.soundIDs[i]].setVolume(e)}},this.mute=function(e){var t=0;if(e instanceof String&&(e=null),e)return z(e)?fe.sounds[e].mute():!1;for(t=fe.soundIDs.length-1;t>=0;t--)fe.sounds[fe.soundIDs[t]].mute();return fe.muted=!0,!0},this.muteAll=function(){fe.mute()},this.unmute=function(e){var t;if(e instanceof String&&(e=null),e)return z(e)?fe.sounds[e].unmute():!1;for(t=fe.soundIDs.length-1;t>=0;t--)fe.sounds[fe.soundIDs[t]].unmute();return fe.muted=!1,!0},this.unmuteAll=function(){fe.unmute()},this.toggleMute=function(e){return z(e)?fe.sounds[e].toggleMute():!1},this.getMemoryUse=function(){var e=0;return me&&8!==u&&(e=parseInt(me._getMemoryUse(),10)),e},this.disable=function(n){var i;if(n===t&&(n=!1),Ce)return!1;for(Ce=!0,i=fe.soundIDs.length-1;i>=0;i--)O(fe.sounds[fe.soundIDs[i]]);return h(n),ie.remove(e,"load",y),!0},this.canPlayMIME=function(e){var t;return fe.hasHTML5&&(t=Y({type:e})),!t&&Ee&&(t=e&&fe.ok()?!!((u>8?e.match(et):null)||e.match(fe.mimePattern)):null),t},this.canPlayURL=function(e){var t;return fe.hasHTML5&&(t=Y({url:e})),!t&&Ee&&(t=e&&fe.ok()?!!e.match(fe.filePattern):null),t},this.canPlayLink=function(e){return e.type!==t&&e.type&&fe.canPlayMIME(e.type)?!0:fe.canPlayURL(e.href)},this.getSoundById=function(e,t){if(!e)return null;var n=fe.sounds[e];return n},this.onready=function(t,n){var i="onready",r=!1;if("function"!=typeof t)throw H("needFunction",i);return n||(n=e),g(i,t,n),v(),r=!0,r},this.ontimeout=function(t,n){var i="ontimeout",r=!1;if("function"!=typeof t)throw H("needFunction",i);return n||(n=e),g(i,t,n),v({type:i}),r=!0,r},this._writeDebug=function(e,t){return!0},this._wD=this._writeDebug,this._debug=function(){},this.reboot=function(t,n){var i,r,o;for(i=fe.soundIDs.length-1;i>=0;i--)fe.sounds[fe.soundIDs[i]].destruct();if(me)try{Ge&&(Se=me.innerHTML),_e=me.parentNode.removeChild(me)}catch(a){}if(Se=_e=Ee=me=null,fe.enabled=I=xe=Ie=Pe=we=ke=Ce=Ae=fe.swfLoaded=!1,fe.soundIDs=[],fe.sounds={},De=0,he=!1,t)be=[];else for(i in be)if(be.hasOwnProperty(i))for(r=0,o=be[i].length;o>r;r++)be[i][r].fired=!1;return fe.html5={usingFlash:null},fe.flash={},fe.html5Only=!1,fe.ignoreFlash=!1,e.setTimeout(function(){n||fe.beginDelayedInit()},20),fe},this.reset=function(){return fe.reboot(!0,!0)},this.getMoviePercent=function(){return me&&"PercentLoaded"in me?me.PercentLoaded():null},this.beginDelayedInit=function(){je=!0,_(),setTimeout(function(){return Pe?!1:(M(),T(),Pe=!0,!0)},20),b()},this.destruct=function(){fe.disable(!0)},a=function(e){var n,i,r,o,a,s,l,c,d,h,p=this,m=!1,g=[],v=0,y=null;d={duration:null,time:null},this.id=e.id,this.sID=this.id,this.url=e.url,this.options=f(e),this.instanceOptions=this.options,this._iO=this.instanceOptions,this.pan=this.options.pan,this.volume=this.options.volume,this.isHTML5=!1,this._a=null,h=this.url?!1:!0,this.id3={},this._debug=function(){},this.load=function(e){var n,i=null;if(e!==t?p._iO=f(e,p.options):(e=p.options,p._iO=e,y&&y!==p.url&&(p._iO.url=p.url,p.url=null)),p._iO.url||(p._iO.url=p.url),p._iO.url=$(p._iO.url),p.instanceOptions=p._iO,n=p._iO,!n.url&&!p.url)return p;if(n.url===p.url&&0!==p.readyState&&2!==p.readyState)return 3===p.readyState&&n.onload&&ue(p,function(){n.onload.apply(p,[!!p.duration])}),p;if(p.loaded=!1,p.readyState=1,p.playState=0,p.id3={},X(n))i=p._setup_html5(n),i._called_load||(p._html5_canplay=!1,p.url!==n.url&&(p._a.src=n.url,p.setPosition(0)),p._a.autobuffer="auto",p._a.preload="auto",p._a._called_load=!0);else{if(fe.html5Only)return p;if(p._iO.url&&p._iO.url.match(/data\:/i))return p;try{p.isHTML5=!1,p._iO=V(R(n)),p._iO.autoPlay&&(p._iO.position||p._iO.from)&&(p._iO.autoPlay=!1),n=p._iO,8===u?me._load(p.id,n.url,n.stream,n.autoPlay,n.usePolicyFile):me._load(p.id,n.url,!!n.stream,!!n.autoPlay,n.loops||1,!!n.autoLoad,n.usePolicyFile)}catch(r){Q({type:"SMSOUND_LOAD_JS_EXCEPTION",fatal:!0})}}return p.url=n.url,p},this.unload=function(){return 0!==p.readyState&&(p.isHTML5?(o(),p._a&&(p._a.pause(),y=ee(p._a))):8===u?me._unload(p.id,Je):me._unload(p.id),n()),p},this.destruct=function(e){p.isHTML5?(o(),p._a&&(p._a.pause(),ee(p._a),Ae||r(),p._a._s=null,p._a=null)):(p._iO.onfailure=null,me._destroySound(p.id)),e||fe.destroySound(p.id,!0)},this.play=function(e,n){var i,r,o,l,d,g,v=!0,y=null;if(n=n===t?!0:n,e||(e={}),p.url&&(p._iO.url=p.url),p._iO=f(p._iO,p.options),p._iO=f(e,p._iO),p._iO.url=$(p._iO.url),p.instanceOptions=p._iO,!p.isHTML5&&p._iO.serverURL&&!p.connected)return p.getAutoPlay()||p.setAutoPlay(!0),p;if(X(p._iO)&&(p._setup_html5(p._iO),a()),1!==p.playState||p.paused||(i=p._iO.multiShot,i||(p.isHTML5&&p.setPosition(p._iO.position),y=p)),null!==y)return y;if(e.url&&e.url!==p.url&&(p.readyState||p.isHTML5||8!==u||!h?p.load(p._iO):h=!1),p.loaded||(0===p.readyState?(p.isHTML5||fe.html5Only?p.isHTML5?p.load(p._iO):y=p:(p._iO.autoPlay=!0,p.load(p._iO)),p.instanceOptions=p._iO):2===p.readyState&&(y=p)),null!==y)return y;if(!p.isHTML5&&9===u&&p.position>0&&p.position===p.duration&&(e.position=0),p.paused&&p.position>=0&&(!p._iO.serverURL||p.position>0))p.resume();else{if(p._iO=f(e,p._iO),(!p.isHTML5&&null!==p._iO.position&&p._iO.position>0||null!==p._iO.from&&p._iO.from>0||null!==p._iO.to)&&0===p.instanceCount&&0===p.playState&&!p._iO.serverURL){if(o=function(){p._iO=f(e,p._iO),p.play(p._iO)},p.isHTML5&&!p._html5_canplay?(p.load({_oncanplay:o}),y=!1):p.isHTML5||p.loaded||p.readyState&&2===p.readyState||(p.load({onload:o}),y=!1),null!==y)return y;p._iO=c()}(!p.instanceCount||p._iO.multiShotEvents||p.isHTML5&&p._iO.multiShot&&!Ae||!p.isHTML5&&u>8&&!p.getAutoPlay())&&p.instanceCount++,p._iO.onposition&&0===p.playState&&s(p),p.playState=1,p.paused=!1,p.position=p._iO.position===t||isNaN(p._iO.position)?0:p._iO.position,p.isHTML5||(p._iO=V(R(p._iO))),p._iO.onplay&&n&&(p._iO.onplay.apply(p),m=!0),p.setVolume(p._iO.volume,!0),p.setPan(p._iO.pan,!0),p.isHTML5?p.instanceCount<2?(a(),r=p._setup_html5(),p.setPosition(p._iO.position),r.play()):(l=new Audio(p._iO.url),d=function(){ie.remove(l,"ended",d),p._onfinish(p),ee(l),l=null},g=function(){ie.remove(l,"canplay",g);try{l.currentTime=p._iO.position/He}catch(e){}l.play()},ie.add(l,"ended",d),p._iO.volume!==t&&(l.volume=Math.max(0,Math.min(1,p._iO.volume/100))),p.muted&&(l.muted=!0),p._iO.position?ie.add(l,"canplay",g):l.play()):(v=me._start(p.id,p._iO.loops||1,9===u?p.position:p.position/He,p._iO.multiShot||!1),9!==u||v||p._iO.onplayerror&&p._iO.onplayerror.apply(p))}return p},this.start=this.play,this.stop=function(e){var t,n=p._iO;return 1===p.playState&&(p._onbufferchange(0),p._resetOnPosition(0),p.paused=!1,p.isHTML5||(p.playState=0),l(),n.to&&p.clearOnPosition(n.to),p.isHTML5?p._a&&(t=p.position,p.setPosition(0),p.position=t,p._a.pause(),p.playState=0,p._onTimer(),o()):(me._stop(p.id,e),n.serverURL&&p.unload()),p.instanceCount=0,p._iO={},n.onstop&&n.onstop.apply(p)),p},this.setAutoPlay=function(e){p._iO.autoPlay=e,p.isHTML5||(me._setAutoPlay(p.id,e),e&&(p.instanceCount||1!==p.readyState||p.instanceCount++))},this.getAutoPlay=function(){return p._iO.autoPlay},this.setPosition=function(e){e===t&&(e=0);var n,i,r=p.isHTML5?Math.max(e,0):Math.min(p.duration||p._iO.duration,Math.max(e,0));if(p.position=r,i=p.position/He,p._resetOnPosition(p.position),p._iO.position=r,p.isHTML5){if(p._a){if(p._html5_canplay){if(p._a.currentTime!==i)try{p._a.currentTime=i,(0===p.playState||p.paused)&&p._a.pause()}catch(o){}}else if(i)return p;p.paused&&p._onTimer(!0)}}else n=9===u?p.position:i,p.readyState&&2!==p.readyState&&me._setPosition(p.id,n,p.paused||!p.playState,p._iO.multiShot);return p},this.pause=function(e){return p.paused||0===p.playState&&1!==p.readyState?p:(p.paused=!0,p.isHTML5?(p._setup_html5().pause(),o()):(e||e===t)&&me._pause(p.id,p._iO.multiShot),p._iO.onpause&&p._iO.onpause.apply(p),p)},this.resume=function(){var e=p._iO;return p.paused?(p.paused=!1,p.playState=1,p.isHTML5?(p._setup_html5().play(),a()):(e.isMovieStar&&!e.serverURL&&p.setPosition(p.position),me._pause(p.id,e.multiShot)),!m&&e.onplay?(e.onplay.apply(p),m=!0):e.onresume&&e.onresume.apply(p),p):p},this.togglePause=function(){return 0===p.playState?(p.play({position:9!==u||p.isHTML5?p.position/He:p.position}),p):(p.paused?p.resume():p.pause(),p)},this.setPan=function(e,n){return e===t&&(e=0),n===t&&(n=!1),p.isHTML5||me._setPan(p.id,e),p._iO.pan=e,n||(p.pan=e,p.options.pan=e),p},this.setVolume=function(e,n){return e===t&&(e=100),n===t&&(n=!1),p.isHTML5?p._a&&(fe.muted&&!p.muted&&(p.muted=!0,p._a.muted=!0),p._a.volume=Math.max(0,Math.min(1,e/100))):me._setVolume(p.id,fe.muted&&!p.muted||p.muted?0:e),p._iO.volume=e,n||(p.volume=e,p.options.volume=e),p},this.mute=function(){return p.muted=!0,p.isHTML5?p._a&&(p._a.muted=!0):me._setVolume(p.id,0),p},this.unmute=function(){p.muted=!1;var e=p._iO.volume!==t;return p.isHTML5?p._a&&(p._a.muted=!1):me._setVolume(p.id,e?p._iO.volume:p.options.volume),p},this.toggleMute=function(){return p.muted?p.unmute():p.mute()},this.onPosition=function(e,n,i){return g.push({position:parseInt(e,10),method:n,scope:i!==t?i:p,fired:!1}),p},this.onposition=this.onPosition,this.clearOnPosition=function(e,t){var n;if(e=parseInt(e,10),isNaN(e))return!1;for(n=0;n<g.length;n++)e===g[n].position&&(t&&t!==g[n].method||(g[n].fired&&v--,g.splice(n,1)))},this._processOnPosition=function(){var e,t,n=g.length;if(!n||!p.playState||v>=n)return!1;for(e=n-1;e>=0;e--)t=g[e],!t.fired&&p.position>=t.position&&(t.fired=!0,v++,t.method.apply(t.scope,[t.position]),n=g.length);return!0},this._resetOnPosition=function(e){var t,n,i=g.length;if(!i)return!1;for(t=i-1;t>=0;t--)n=g[t],n.fired&&e<=n.position&&(n.fired=!1,v--);return!0},c=function(){var e,t,n=p._iO,i=n.from,r=n.to;return t=function(){p.clearOnPosition(r,t),p.stop()},e=function(){null===r||isNaN(r)||p.onPosition(r,t)},null===i||isNaN(i)||(n.position=i,n.multiShot=!1,e()),n},s=function(){var e,t=p._iO.onposition;if(t)for(e in t)t.hasOwnProperty(e)&&p.onPosition(parseInt(e,10),t[e])},l=function(){var e,t=p._iO.onposition;if(t)for(e in t)t.hasOwnProperty(e)&&p.clearOnPosition(parseInt(e,10))},a=function(){p.isHTML5&&U(p)},o=function(){p.isHTML5&&W(p)},n=function(e){e||(g=[],v=0),m=!1,p._hasTimer=null,p._a=null,p._html5_canplay=!1,p.bytesLoaded=null,p.bytesTotal=null,p.duration=p._iO&&p._iO.duration?p._iO.duration:null,p.durationEstimate=null,p.buffered=[],p.eqData=[],p.eqData.left=[],p.eqData.right=[],p.failures=0,p.isBuffering=!1,p.instanceOptions={},p.instanceCount=0,p.loaded=!1,p.metadata={},p.readyState=0,p.muted=!1,p.paused=!1,p.peakData={left:0,right:0},p.waveformData={left:[],right:[]},p.playState=0,p.position=null,p.id3={}},n(),this._onTimer=function(e){var t,n,i=!1,r={};return p._hasTimer||e?(p._a&&(e||(p.playState>0||1===p.readyState)&&!p.paused)&&(t=p._get_html5_duration(),t!==d.duration&&(d.duration=t,p.duration=t,i=!0),p.durationEstimate=p.duration,n=p._a.currentTime*He||0,n!==d.time&&(d.time=n,i=!0),(i||e)&&p._whileplaying(n,r,r,r,r)),i):void 0},this._get_html5_duration=function(){var e=p._iO,t=p._a&&p._a.duration?p._a.duration*He:e&&e.duration?e.duration:null,n=t&&!isNaN(t)&&t!==1/0?t:null;return n},this._apply_loop=function(e,t){e.loop=t>1?"loop":""},this._setup_html5=function(e){var t,r=f(p._iO,e),o=Ae?pe:p._a,a=decodeURI(r.url);if(Ae?a===decodeURI(re)&&(t=!0):a===decodeURI(y)&&(t=!0),o){if(o._s)if(Ae)o._s&&o._s.playState&&!t&&o._s.stop();else if(!Ae&&a===decodeURI(y))return p._apply_loop(o,r.loops),o;t||(y&&n(!1),o.src=r.url,p.url=r.url,y=r.url,re=r.url,o._called_load=!1)}else r.autoLoad||r.autoPlay?(p._a=new Audio(r.url),p._a.load()):p._a=Fe&&opera.version()<10?new Audio(null):new Audio,o=p._a,o._called_load=!1,Ae&&(pe=o);return p.isHTML5=!0,p._a=o,o._s=p,i(),p._apply_loop(o,r.loops),r.autoLoad||r.autoPlay?p.load():(o.autobuffer=!1,o.preload="auto"),o},i=function(){function e(e,t,n){return p._a?p._a.addEventListener(e,t,n||!1):null}if(p._a._added_events)return!1;var t;p._a._added_events=!0;for(t in le)le.hasOwnProperty(t)&&e(t,le[t]);return!0},r=function(){function e(e,t,n){return p._a?p._a.removeEventListener(e,t,n||!1):null}var t;p._a._added_events=!1;for(t in le)le.hasOwnProperty(t)&&e(t,le[t])},this._onload=function(e){var t=!!e||!p.isHTML5&&8===u&&p.duration;return p.loaded=t,p.readyState=t?3:2,p._onbufferchange(0),p._iO.onload&&ue(p,function(){p._iO.onload.apply(p,[t])}),!0},this._onbufferchange=function(e){return 0===p.playState?!1:e&&p.isBuffering||!e&&!p.isBuffering?!1:(p.isBuffering=1===e,p._iO.onbufferchange&&p._iO.onbufferchange.apply(p,[e]),!0)},this._onsuspend=function(){return p._iO.onsuspend&&p._iO.onsuspend.apply(p),!0},this._onfailure=function(e,t,n){p.failures++,p._iO.onfailure&&1===p.failures&&p._iO.onfailure(e,t,n)},this._onwarning=function(e,t,n){p._iO.onwarning&&p._iO.onwarning(e,t,n)},this._onfinish=function(){var e=p._iO.onfinish;p._onbufferchange(0),p._resetOnPosition(0),p.instanceCount&&(p.instanceCount--,p.instanceCount||(l(),p.playState=0,p.paused=!1,p.instanceCount=0,p.instanceOptions={},p._iO={},o(),p.isHTML5&&(p.position=0)),(!p.instanceCount||p._iO.multiShotEvents)&&e&&ue(p,function(){e.apply(p)}))},this._whileloading=function(e,t,n,i){var r=p._iO;p.bytesLoaded=e,p.bytesTotal=t,p.duration=Math.floor(n),p.bufferLength=i,p.isHTML5||r.isMovieStar?p.durationEstimate=p.duration:r.duration?p.durationEstimate=p.duration>r.duration?p.duration:r.duration:p.durationEstimate=parseInt(p.bytesTotal/p.bytesLoaded*p.duration,10),p.isHTML5||(p.buffered=[{start:0,end:p.duration}]),(3!==p.readyState||p.isHTML5)&&r.whileloading&&r.whileloading.apply(p)},this._whileplaying=function(e,n,i,r,o){var a,s=p._iO;return isNaN(e)||null===e?!1:(p.position=Math.max(0,e),p._processOnPosition(),!p.isHTML5&&u>8&&(s.usePeakData&&n!==t&&n&&(p.peakData={left:n.leftPeak,right:n.rightPeak}),s.useWaveformData&&i!==t&&i&&(p.waveformData={left:i.split(","),right:r.split(",")}),s.useEQData&&o!==t&&o&&o.leftEQ&&(a=o.leftEQ.split(","),p.eqData=a,p.eqData.left=a,o.rightEQ!==t&&o.rightEQ&&(p.eqData.right=o.rightEQ.split(",")))),1===p.playState&&(p.isHTML5||8!==u||p.position||!p.isBuffering||p._onbufferchange(0),s.whileplaying&&s.whileplaying.apply(p)),!0)},this._oncaptiondata=function(e){p.captiondata=e,p._iO.oncaptiondata&&p._iO.oncaptiondata.apply(p,[e])},this._onmetadata=function(e,t){var n,i,r={};for(n=0,i=e.length;i>n;n++)r[e[n]]=t[n];p.metadata=r,p._iO.onmetadata&&p._iO.onmetadata.call(p,p.metadata)},this._onid3=function(e,t){var n,i,r=[];for(n=0,i=e.length;i>n;n++)r[e[n]]=t[n];p.id3=f(p.id3,r),p._iO.onid3&&p._iO.onid3.apply(p)},this._onconnect=function(e){e=1===e,p.connected=e,e&&(p.failures=0,z(p.id)&&(p.getAutoPlay()?p.play(t,p.getAutoPlay()):p._iO.autoLoad&&p.load()),p._iO.onconnect&&p._iO.onconnect.apply(p,[e]))},this._ondataerror=function(e){p.playState>0&&p._iO.ondataerror&&p._iO.ondataerror.apply(p)}},P=function(){return ye.body||ye.getElementsByTagName("div")[0]},s=function(e){return ye.getElementById(e)},f=function(e,n){var i,r,o=e||{};i=n===t?fe.defaultOptions:n;for(r in i)i.hasOwnProperty(r)&&o[r]===t&&("object"!=typeof i[r]||null===i[r]?o[r]=i[r]:o[r]=f(o[r],i[r]));return o},ue=function(t,n){t.isHTML5||8!==u?n():e.setTimeout(n,0)},m={onready:1,ontimeout:1,defaultOptions:1,flash9Options:1,movieStarOptions:1},p=function(e,n){var i,r=!0,o=n!==t,a=fe.setupOptions,s=m;for(i in e)if(e.hasOwnProperty(i))if("object"!=typeof e[i]||null===e[i]||e[i]instanceof Array||e[i]instanceof RegExp)o&&s[n]!==t?fe[n][i]=e[i]:a[i]!==t?(fe.setupOptions[i]=e[i],fe[i]=e[i]):s[i]===t?r=!1:fe[i]instanceof Function?fe[i].apply(fe,e[i]instanceof Array?e[i]:[e[i]]):fe[i]=e[i];else{if(s[i]!==t)return p(e[i],i);r=!1}return r},ie=function(){function t(e){var t=Oe.call(e),n=t.length;return o?(t[1]="on"+t[1],n>3&&t.pop()):3===n&&t.push(!1),t}function n(e,t){var n=e.shift(),i=[a[t]];o?n[i](e[0],e[1]):n[i].apply(n,e)}function i(){n(t(arguments),"add")}function r(){n(t(arguments),"remove")}var o=e.attachEvent,a={add:o?"attachEvent":"addEventListener",remove:o?"detachEvent":"removeEventListener"};return{add:i,remove:r}}(),le={abort:o(function(){}),canplay:o(function(){var e,n=this._s;if(n._html5_canplay)return!0;if(n._html5_canplay=!0,n._onbufferchange(0),e=n._iO.position===t||isNaN(n._iO.position)?null:n._iO.position/He,this.currentTime!==e)try{this.currentTime=e}catch(i){}n._iO._oncanplay&&n._iO._oncanplay()}),canplaythrough:o(function(){var e=this._s;e.loaded||(e._onbufferchange(0),e._whileloading(e.bytesLoaded,e.bytesTotal,e._get_html5_duration()),e._onload(!0))}),durationchange:o(function(){var e,t=this._s;e=t._get_html5_duration(),isNaN(e)||e===t.duration||(t.durationEstimate=t.duration=e)}),ended:o(function(){var e=this._s;e._onfinish()}),error:o(function(){this._s._onload(!1)}),loadeddata:o(function(){var e=this._s;e._loaded||Ve||(e.duration=e._get_html5_duration())}),loadedmetadata:o(function(){}),loadstart:o(function(){this._s._onbufferchange(1)}),play:o(function(){this._s._onbufferchange(0)}),playing:o(function(){this._s._onbufferchange(0)}),progress:o(function(e){var t,n,i=this._s,r=0,o=("progress"===e.type,e.target.buffered),a=e.loaded||0,s=e.total||1;if(i.buffered=[],o&&o.length){for(t=0,n=o.length;n>t;t++)i.buffered.push({start:o.start(t)*He,end:o.end(t)*He});r=(o.end(0)-o.start(0))*He,a=Math.min(1,r/(e.target.duration*He))}isNaN(a)||(i._whileloading(a,s,i._get_html5_duration()),a&&s&&a===s&&le.canplaythrough.call(this,e))}),ratechange:o(function(){}),suspend:o(function(e){var t=this._s;le.progress.call(this,e),t._onsuspend()}),stalled:o(function(){}),timeupdate:o(function(){this._s._onTimer()}),waiting:o(function(){var e=this._s;e._onbufferchange(1)})},X=function(e){var t;return t=e&&(e.type||e.url||e.serverURL)?e.serverURL||e.type&&r(e.type)?!1:e.type?Y({type:e.type}):Y({url:e.url})||fe.html5Only||e.url.match(/data\:/i):!1},ee=function(e){var n;return e&&(n=Ve?Je:fe.html5.canPlayType("audio/wav")?Xe:Je,e.src=n,e._called_unload!==t&&(e._called_load=!1)),Ae&&(re=null),n},Y=function(e){if(!fe.useHTML5Audio||!fe.hasHTML5)return!1;var n,i,o,a,s=e.url||null,l=e.type||null,c=fe.audioFormats;if(l&&fe.html5[l]!==t)return fe.html5[l]&&!r(l);if(!Z){Z=[];for(a in c)c.hasOwnProperty(a)&&(Z.push(a),c[a].related&&(Z=Z.concat(c[a].related)));Z=new RegExp("\\.("+Z.join("|")+")(\\?.*)?$","i")}return o=s?s.toLowerCase().match(Z):null,o&&o.length?o=o[1]:l?(i=l.indexOf(";"),o=(-1!==i?l.substr(0,i):l).substr(6)):n=!1,o&&fe.html5[o]!==t?n=fe.html5[o]&&!r(o):(l="audio/"+o,n=fe.html5.canPlayType({type:l}),fe.html5[o]=n,n=n&&fe.html5[l]&&!r(l)),n},ne=function(){function e(e){var t,n,i=!1,r=!1;if(!a||"function"!=typeof a.canPlayType)return i;if(e instanceof Array){for(o=0,n=e.length;n>o;o++)(fe.html5[e[o]]||a.canPlayType(e[o]).match(fe.html5Test))&&(r=!0,fe.html5[e[o]]=!0,fe.flash[e[o]]=!!e[o].match(Ke));i=r}else t=a&&"function"==typeof a.canPlayType?a.canPlayType(e):!1,i=!(!t||!t.match(fe.html5Test));return i}if(!fe.useHTML5Audio||!fe.hasHTML5)return fe.html5.usingFlash=!0,Ee=!0,!1;var n,i,r,o,a=Audio!==t?Fe&&opera.version()<10?new Audio(null):new Audio:null,s={};r=fe.audioFormats;for(n in r)if(r.hasOwnProperty(n)&&(i="audio/"+n,s[n]=e(r[n].type),s[i]=s[n],n.match(Ke)?(fe.flash[n]=!0,fe.flash[i]=!0):(fe.flash[n]=!1,fe.flash[i]=!1),r[n]&&r[n].related))for(o=r[n].related.length-1;o>=0;o--)s["audio/"+r[n].related[o]]=s[n],fe.html5[r[n].related[o]]=s[n],fe.flash[r[n].related[o]]=s[n];return s.canPlayType=a?e:null,fe.html5=f(fe.html5,s),fe.html5.usingFlash=J(),Ee=fe.html5.usingFlash,!0},j={},H=function(){},R=function(e){return 8===u&&e.loops>1&&e.stream&&(e.stream=!1),e},V=function(e,t){return e&&!e.usePolicyFile&&(e.onid3||e.usePeakData||e.useWaveformData||e.useEQData)&&(e.usePolicyFile=!0),e},F=function(e){},
l=function(){return!1},O=function(e){var t;for(t in e)e.hasOwnProperty(t)&&"function"==typeof e[t]&&(e[t]=l);t=null},A=function(e){e===t&&(e=!1),(Ce||e)&&fe.disable(e)},D=function(e){var t,n=null;if(e)if(e.match(/\.swf(\?.*)?$/i)){if(n=e.substr(e.toLowerCase().lastIndexOf(".swf?")+4))return e}else e.lastIndexOf("/")!==e.length-1&&(e+="/");return t=(e&&-1!==e.lastIndexOf("/")?e.substr(0,e.lastIndexOf("/")+1):"./")+fe.movieURL,fe.noSWFCache&&(t+="?ts="+(new Date).getTime()),t},x=function(){u=parseInt(fe.flashVersion,10),8!==u&&9!==u&&(fe.flashVersion=u=Te);var e=fe.debugMode||fe.debugFlash?"_debug.swf":".swf";fe.useHTML5Audio&&!fe.html5Only&&fe.audioFormats.mp4.required&&9>u&&(fe.flashVersion=u=9),fe.version=fe.versionNumber+(fe.html5Only?" (HTML5-only mode)":9===u?" (AS3/Flash 9)":" (AS2/Flash 8)"),u>8?(fe.defaultOptions=f(fe.defaultOptions,fe.flash9Options),fe.features.buffering=!0,fe.defaultOptions=f(fe.defaultOptions,fe.movieStarOptions),fe.filePatterns.flash9=new RegExp("\\.(mp3|"+tt.join("|")+")(\\?.*)?$","i"),fe.features.movieStar=!0):fe.features.movieStar=!1,fe.filePattern=fe.filePatterns[8!==u?"flash9":"flash8"],fe.movieURL=(8===u?"soundmanager2.swf":"soundmanager2_flash9.swf").replace(".swf",e),fe.features.peakData=fe.features.waveformData=fe.features.eqData=u>8},B=function(e,t){return me?void me._setPolling(e,t):!1},E=function(){},z=this.getSoundById,L=function(){var e=[];return fe.debugMode&&e.push(G.sm2Debug),fe.debugFlash&&e.push(G.flashDebug),fe.useHighPerformance&&e.push(G.highPerf),e.join(" ")},N=function(){var e=(H("fbHandler"),fe.getMoviePercent()),t=G,n={type:"FLASHBLOCK"};return fe.html5Only?!1:void(fe.ok()?fe.oMC&&(fe.oMC.className=[L(),t.swfDefault,t.swfLoaded+(fe.didFlashBlock?" "+t.swfUnblocked:"")].join(" ")):(Ee&&(fe.oMC.className=L()+" "+t.swfDefault+" "+(null===e?t.swfTimedout:t.swfError)),fe.didFlashBlock=!0,v({type:"ontimeout",ignoreInit:!0,error:n}),Q(n)))},g=function(e,n,i){be[e]===t&&(be[e]=[]),be[e].push({method:n,scope:i||null,fired:!1})},v=function(e){if(e||(e={type:fe.ok()?"onready":"ontimeout"}),!xe&&e&&!e.ignoreInit)return!1;if("ontimeout"===e.type&&(fe.ok()||Ce&&!e.ignoreInit))return!1;var t,n,i={success:e&&e.ignoreInit?fe.ok():!Ce},r=e&&e.type?be[e.type]||[]:[],o=[],a=[i],s=Ee&&!fe.ok();for(e.error&&(a[0].error=e.error),t=0,n=r.length;n>t;t++)r[t].fired!==!0&&o.push(r[t]);if(o.length)for(t=0,n=o.length;n>t;t++)o[t].scope?o[t].method.apply(o[t].scope,a):o[t].method.apply(this,a),s||(o[t].fired=!0);return!0},y=function(){e.setTimeout(function(){fe.useFlashBlock&&N(),v(),"function"==typeof fe.onload&&fe.onload.apply(e),fe.waitForWindowLoad&&ie.add(e,"load",y)},1)},ae=function(){if(oe!==t)return oe;var n,i,r,o=!1,a=navigator,s=a.plugins,l=e.ActiveXObject;if(s&&s.length)i="application/x-shockwave-flash",r=a.mimeTypes,r&&r[i]&&r[i].enabledPlugin&&r[i].enabledPlugin.description&&(o=!0);else if(l!==t&&!ge.match(/MSAppHost/i)){try{n=new l("ShockwaveFlash.ShockwaveFlash")}catch(c){n=null}o=!!n,n=null}return oe=o,o},J=function(){var e,t,n=fe.audioFormats,i=Ne&&!!ge.match(/os (1|2|3_0|3_1)\s/i);if(i?(fe.hasHTML5=!1,fe.html5Only=!0,fe.oMC&&(fe.oMC.style.display="none")):fe.useHTML5Audio&&(fe.html5&&fe.html5.canPlayType||(fe.hasHTML5=!1)),fe.useHTML5Audio&&fe.hasHTML5){K=!0;for(t in n)n.hasOwnProperty(t)&&n[t].required&&(fe.html5.canPlayType(n[t].type)?fe.preferFlash&&(fe.flash[t]||fe.flash[n[t].type])&&(e=!0):(K=!1,e=!0))}return fe.ignoreFlash&&(e=!1,K=!0),fe.html5Only=fe.hasHTML5&&fe.useHTML5Audio&&!e,!fe.html5Only},$=function(e){var t,n,i,r=0;if(e instanceof Array){for(t=0,n=e.length;n>t;t++)if(e[t]instanceof Object){if(fe.canPlayMIME(e[t].type)){r=t;break}}else if(fe.canPlayURL(e[t])){r=t;break}e[r].url&&(e[r]=e[r].url),i=e[r]}else i=e;return i},U=function(e){e._hasTimer||(e._hasTimer=!0,!ze&&fe.html5PollingInterval&&(null===Qe&&0===Me&&(Qe=setInterval(q,fe.html5PollingInterval)),Me++))},W=function(e){e._hasTimer&&(e._hasTimer=!1,!ze&&fe.html5PollingInterval&&Me--)},q=function(){var e;if(null!==Qe&&!Me)return clearInterval(Qe),Qe=null,!1;for(e=fe.soundIDs.length-1;e>=0;e--)fe.sounds[fe.soundIDs[e]].isHTML5&&fe.sounds[fe.soundIDs[e]]._hasTimer&&fe.sounds[fe.soundIDs[e]]._onTimer()},Q=function(n){n=n!==t?n:{},"function"==typeof fe.onerror&&fe.onerror.apply(e,[{type:n.type!==t?n.type:null}]),n.fatal!==t&&n.fatal&&fe.disable()},se=function(){if(!Ue||!ae())return!1;var e,t,n=fe.audioFormats;for(t in n)if(n.hasOwnProperty(t)&&("mp3"===t||"mp4"===t)&&(fe.html5[t]=!1,n[t]&&n[t].related))for(e=n[t].related.length-1;e>=0;e--)fe.html5[n[t].related[e]]=!1},this._setSandboxType=function(e){},this._externalInterfaceOK=function(e){if(fe.swfLoaded)return!1;fe.swfLoaded=!0,qe=!1,Ue&&se(),setTimeout(d,Ge?100:1)},M=function(e,n){function i(){}function r(e,t){return'<param name="'+e+'" value="'+t+'" />'}if(we&&ke)return!1;if(fe.html5Only)return x(),i(),fe.oMC=s(fe.movieID),d(),we=!0,ke=!0,!1;var o,a,l,c,u,h,f,p,m=n||fe.url,g=fe.altURL||m,v="JS/Flash audio component (SoundManager 2)",y=P(),b=L(),w=null,k=ye.getElementsByTagName("html")[0];if(w=k&&k.dir&&k.dir.match(/rtl/i),e=e===t?fe.id:e,x(),fe.url=D(Ye?m:g),n=fe.url,fe.wmode=!fe.wmode&&fe.useHighPerformance?"transparent":fe.wmode,null!==fe.wmode&&(ge.match(/msie 8/i)||!Ge&&!fe.useHighPerformance)&&navigator.platform.match(/win32|win64/i)&&(Be.push(j.spcWmode),fe.wmode=null),o={name:e,id:e,src:n,quality:"high",allowScriptAccess:fe.allowScriptAccess,bgcolor:fe.bgColor,pluginspage:Ze+"www.macromedia.com/go/getflashplayer",title:v,type:"application/x-shockwave-flash",wmode:fe.wmode,hasPriority:"true"},fe.debugFlash&&(o.FlashVars="debug=1"),fe.wmode||delete o.wmode,Ge)a=ye.createElement("div"),c=['<object id="'+e+'" data="'+n+'" type="'+o.type+'" title="'+o.title+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0">',r("movie",n),r("AllowScriptAccess",fe.allowScriptAccess),r("quality",o.quality),fe.wmode?r("wmode",fe.wmode):"",r("bgcolor",fe.bgColor),r("hasPriority","true"),fe.debugFlash?r("FlashVars",o.FlashVars):"","</object>"].join("");else{a=ye.createElement("embed");for(l in o)o.hasOwnProperty(l)&&a.setAttribute(l,o[l])}if(E(),b=L(),y=P())if(fe.oMC=s(fe.movieID)||ye.createElement("div"),fe.oMC.id)p=fe.oMC.className,fe.oMC.className=(p?p+" ":G.swfDefault)+(b?" "+b:""),fe.oMC.appendChild(a),Ge&&(u=fe.oMC.appendChild(ye.createElement("div")),u.className=G.swfBox,u.innerHTML=c),ke=!0;else{if(fe.oMC.id=fe.movieID,fe.oMC.className=G.swfDefault+" "+b,h=null,u=null,fe.useFlashBlock||(fe.useHighPerformance?h={position:"fixed",width:"8px",height:"8px",bottom:"0px",left:"0px",overflow:"hidden"}:(h={position:"absolute",width:"6px",height:"6px",top:"-9999px",left:"-9999px"},w&&(h.left=Math.abs(parseInt(h.left,10))+"px"))),Re&&(fe.oMC.style.zIndex=1e4),!fe.debugFlash)for(f in h)h.hasOwnProperty(f)&&(fe.oMC.style[f]=h[f]);try{Ge||fe.oMC.appendChild(a),y.appendChild(fe.oMC),Ge&&(u=fe.oMC.appendChild(ye.createElement("div")),u.className=G.swfBox,u.innerHTML=c),ke=!0}catch(C){throw new Error(H("domError")+" \n"+C.toString())}}return we=!0,i(),!0},T=function(){return fe.html5Only?(M(),!1):me?!1:fe.url?(me=fe.getMovie(fe.id),me||(_e?(Ge?fe.oMC.innerHTML=Se:fe.oMC.appendChild(_e),_e=null,we=!0):M(fe.id,fe.url),me=fe.getMovie(fe.id)),"function"==typeof fe.oninitmovie&&setTimeout(fe.oninitmovie,1),!0):!1},b=function(){setTimeout(w,1e3)},k=function(){e.setTimeout(function(){fe.setup({preferFlash:!1}).reboot(),fe.didFlashBlock=!0,fe.beginDelayedInit()},1)},w=function(){var t,n=!1;return fe.url?Ie?!1:(Ie=!0,ie.remove(e,"load",b),oe&&qe&&!We?!1:(xe||(t=fe.getMoviePercent(),t>0&&100>t&&(n=!0)),void setTimeout(function(){return t=fe.getMoviePercent(),n?(Ie=!1,e.setTimeout(b,1),!1):void(!xe&&$e&&(null===t?fe.useFlashBlock||0===fe.flashLoadTimeout?fe.useFlashBlock&&N():!fe.useFlashBlock&&K?k():v({type:"ontimeout",ignoreInit:!0,error:{type:"INIT_FLASHBLOCK"}}):0===fe.flashLoadTimeout||(!fe.useFlashBlock&&K?k():A(!0))))},fe.flashLoadTimeout))):!1},C=function(){function t(){ie.remove(e,"focus",C)}return We||!qe?(t(),!0):($e=!0,We=!0,Ie=!1,b(),t(),!0)},de=function(){},ce=function(){},h=function(t){if(xe)return!1;if(fe.html5Only)return xe=!0,y(),!0;var n,i=fe.useFlashBlock&&fe.flashLoadTimeout&&!fe.getMoviePercent(),r=!0;return i||(xe=!0),n={type:!oe&&Ee?"NO_FLASH":"INIT_TIMEOUT"},(Ce||t)&&(fe.useFlashBlock&&fe.oMC&&(fe.oMC.className=L()+" "+(null===fe.getMoviePercent()?G.swfTimedout:G.swfError)),v({type:"ontimeout",error:n,ignoreInit:!0}),Q(n),r=!1),Ce||(fe.waitForWindowLoad&&!je?ie.add(e,"load",y):y()),r},c=function(){var e,n=fe.setupOptions;for(e in n)n.hasOwnProperty(e)&&(fe[e]===t?fe[e]=n[e]:fe[e]!==n[e]&&(fe.setupOptions[e]=fe[e]))},d=function(){function t(){ie.remove(e,"load",fe.beginDelayedInit)}if(xe)return!1;if(fe.html5Only)return xe||(t(),fe.enabled=!0,h()),!0;T();try{me._externalInterfaceTest(!1),B(!0,fe.flashPollingInterval||(fe.useHighPerformance?10:50)),fe.debugMode||me._disableDebug(),fe.enabled=!0,fe.html5Only||ie.add(e,"unload",l)}catch(n){return Q({type:"JS_TO_FLASH_EXCEPTION",fatal:!0}),A(!0),h(),!1}return h(),t(),!0},_=function(){return I?!1:(I=!0,c(),E(),!oe&&fe.hasHTML5&&fe.setup({useHTML5Audio:!0,preferFlash:!1}),ne(),!oe&&Ee&&(Be.push(j.needFlash),fe.setup({flashLoadTimeout:1})),ye.removeEventListener&&ye.removeEventListener("DOMContentLoaded",_,!1),T(),!0)},te=function(){return"complete"===ye.readyState&&(_(),ye.detachEvent("onreadystatechange",te)),!0},S=function(){je=!0,_(),ie.remove(e,"load",S)},ae(),ie.add(e,"focus",C),ie.add(e,"load",b),ie.add(e,"load",S),ye.addEventListener?ye.addEventListener("DOMContentLoaded",_,!1):ye.attachEvent?ye.attachEvent("onreadystatechange",te):Q({type:"NO_DOM2_EVENTS",fatal:!0})}if(!e||!e.document)throw new Error("SoundManager requires a browser with window and document objects.");var i=null;e.SM2_DEFER!==t&&SM2_DEFER||(i=new n),"object"==typeof module&&module&&"object"==typeof module.exports?(module.exports.SoundManager=n,module.exports.soundManager=i):"function"==typeof define&&define.amd&&define(function(){function t(t){if(!e.soundManager&&t instanceof Function){var i=t(n);i instanceof n&&(e.soundManager=i)}return e.soundManager}return{constructor:n,getInstance:t}}),e.SoundManager=n,e.soundManager=i}(window),"undefined"==typeof Widgets&&(Widgets={}),Widgets.Base=function(){return{keys:{VK_RETURN:13,VK_ESCAPE:27,VK_PAGE_UP:33,VK_PAGE_DOWN:34,VK_END:35,VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40,VK_DELETE:46,VK_F1:112,VK_F2:113,VK_F3:114,VK_F4:115,VK_F5:116,VK_F6:117,VK_F7:118,VK_F8:119,VK_F9:120,VK_F10:121,VK_F11:122,VK_F12:123,VK_COPY:67,VK_PASTE:86},setup:function(e){var t;e=jQuery(e),0!==e.length&&(e.find("widget").each(function(){t=t||new Handler.Template("widgets");var e=jQuery(this),n=jQuery.parseJSON(e.attr("data")),i=t.render("widget-"+n.wid+"-content",n),r=jQuery(i).attr("data-widget",jQuery.toJSON(n));e.replaceWith(r)}),e.find(".widgetcontainer").each(this.setupSingleWidget),e.find(".widgetcontainer-inline").each(this.setupSingleWidget))},setupSingleWidget:function(){var e=jQuery(this),t=e.attr("data");if(t){t=jQuery.parseJSON(t);var n=Widgets[t.wid.toCamelCase(!0)];n&&n().create(e)}},properties:{},collectJson:function(e){var t={};return e.find("[json-data]").each(function(){var e=jQuery(this),n=e.attr("json-data"),i=this.tagName;switch(i.toLowerCase()){case"input":case"textarea":case"select":("checkbox"!==this.type&&"radio"!==this.type||this.checked)&&(t[n]=e.val());break;case"div":t[n]=e.html();break;case"a":t[n]=e.attr("href");break;case"img":t[n]=e.attr("src")}e=null}),t},saveJson:function(e){e.find("[json-target]").val(jQuery.toJSON(this.collectJson(e)))},create:function(e,t){var n=e.get(0).style.height;"%"===n.substr(n.length-1)&&e.css("height",e.width()*parseFloat(n)/100+"px"),"left"===e.css("float")?e.css("margin","0px 10px 10px 0px"):"right"===e.css("float")?e.css("margin","0px 0px 10px 10px"):e.css("margin","0px auto 0px auto");var i;if(t){var r=e.data("widget");if(e.resizef||(e.resizef=function(n,i){if(!i){var o=e.find(".widget-resize"),a=e.find(".widget-float");if(o.length+a.length!==0){if(o.length){var s=e.width(),l=e.height();if(!e.attr("style").match(/width\s*:\s*auto/i)){var c=jQuery("<p/>").html("&nbsp;").appendTo(t),d=c.width();c.remove(),l="auto"==r.properties.height?"auto":l/s*100+"%",s=d?Math.round(100*s/d)+"%":s+"px",void 0!==r.properties.width&&(r.properties.width=s),void 0!==r.properties.height&&(r.properties.height=l)}}a.length&&void 0!==r.properties["float"]&&(r.properties["float"]=e.css("float")||"none"),e.attr("data-widget",jQuery.toJSON(r)),e.css({"margin-left":"right"===r.properties["float"]?"10px":"left"===r.properties["float"]?"0px":"auto","margin-right":"left"===r.properties["float"]?"10px":"left"===r.properties["float"]?"0px":"auto"})}}}),e.off("resize",e.resizef).on("resize",e.resizef),i=e.css("float"),e.css({"margin-left":"right"===i?"10px":"none"===i?"auto":"0px","margin-right":"left"===i?"10px":"none"===i?"auto":"0px"}),e.is(t.widgetmask)){e.find(".cover").length||e.append(jQuery("<div/>").addClass("cover"));var o=function(){e.find(".cover").css({width:e.outerWidth()+"px",height:e.outerHeight()+"px"}).appendTo(e)};e.on("resize",o),o()}}else i=e.css("float"),e.css({"margin-left":"right"===i?"10px":"none"===i?"auto":"0px","margin-right":"left"===i?"10px":"none"===i?"auto":"0px"}),e.find(".cover").remove();return e},dialog:function(e,t,n,i,r){return e.find("a.back").on("click",function(){t.extensions.widgets.index()}),e},remove:function(e,t,n){return!1},extend:function(e){var t=this;return function(){var n=jQuery.extend({},t);n.parent={};for(var i in t)"function"==typeof t[i]?n.parent[i]=function(e){return function(){var i=n.parent;n.parent=t.parent;var r=t[e].apply(n,arguments);return n.parent=i,r}}(i):n.parent[i]=t[i];for(var i in e)n[i]=e[i];return n}}}},"undefined"==typeof Widgets&&(Widgets={}),Widgets.Chess=Widgets.Base().extend(function(){var e={},t={},n={},i={},r={},o={},a=Date.now(),s=function(e,t){for(var n=0;n<e.moves.length;n++)if(e.moves[n].fen===t)return e.moves[n].knotId;return 0},l=function(e,t){for(var n=0;n<e.moves.length;n++)if(e.moves[n].knotId==t)return e.moves[n].fen;return""},c={events:{},initialized:!1,lastCopyId:0,on:function(e,t){e&&"function"==typeof t&&(this.events[e]?this.events[e].push(t):this.events[e]=[t])},off:function(e,t){"undefined"!=typeof t?this.events[e]&&this.events[e].removeByValue(t):this.events[e]=[]},notify:function(e){if(this.events[e])for(var t=0;t<this.events[e].length;t++)this.events[e][t].apply(null,Array.convert(arguments).slice(1))},addController:function(n,i){var r=n+"@"+i;return e[r]||(e[r]=new Chess.GameHandler,e[r].addGame(n,t[n]),e[r].setCurrentGame(n),e[r].gotoStart(),this.decorateController(e[r]),this.notify("newcontroller",e[r])),r},addView:function(e,t,n){var e=e||++a;return a=Math.max(e,a),r[e]=t,this.unlinkView(e),n||this.linkView(e,"main"),e},linkView:function(t,n){r[t]&&e[n]&&("undefined"==typeof o[t]&&(o[t]=[]),o[t].contains(n)||(o[t].push(n),r[t].link(e[n])))},unlinkView:function(t,n){if(r[t]){"undefined"==typeof o[t]&&(o[t]=[]);for(var i=n?[n]:o[t],a=[],s=0;s<i.length;s++)o[t].contains(i[s])&&r[t].unlink(e[i[s]]);for(var s=0;s<o[t].length;s++)i.contains(o[t][s])||a.push(o[t][s]);o[t]=a}},createCopyId:function(){return++this.lastCopyId},separateView:function(t,n,i){if(!i){for(var r=!0,o=0;o<n.length;o++)if(!this.isViewSeparated(t,n[o],i)){r=!1;break}if(r)return}this.unlinkView(t);for(var a=this.addController(n[0],t),s=e[a],o=i?0:1;o<n.length;o++)s.addGame(n[o],this.getGame(n[o],i));i&&s.setCurrentGame(n[0]),s.gotoStart(),this.linkView(t,a)},isViewSeparated:function(e,t){for(var n=this.getControllersForView(e),i=0;i<n.length;i++)if("main"!=n[i]){var r=this.getController(n[i]);if(r.getGame(t))return!0}return!1},isViewLinked:function(e,t){return"undefined"==typeof o[e]?!1:o[e].contains(t)},checkSeparatedViews:function(t,n){var i=[];n.find("a").each(function(){var e=jQuery(this),t=e.attr("data");if(t&&(t=jQuery.parseJSON(t),t&&"chess-jump-to-link"==t.wid&&t.views&&t.views))for(var n=0;n<t.views.length;n++)i.contains(t.views[n])||i.push(t.views[n])});for(var r=0;r<t.length;r++)if(!this.isViewLinked(t[r],"main")&&!i.contains(t[r])){if(this.isStaticView(t[r]))continue;this.unlinkView(t[r]),this.linkView(t[r],"main")}var a=[],s=[];for(var l in o)a=a.concat(o[l]);for(var l in e)"main"==l||a.contains(l)||s.push(l);for(var r=0;r<s.length;r++)delete e[s[r]]},makeStaticView:function(t,n,i){var r=this.getGameJson(n);if(r){var o=l(r,i);if(o){this.unlinkView(t);var a=t+"@static";e[a]=new Chess.GameHandler,e[a].addGame(a,new Chess.Game({fen:o})),this.linkView(t,a)}}},isStaticView:function(e){for(var t=this.getControllersForView(e),n=0;n<t.length;n++)if("@static"==t[n].substr(t[n].length-7))return!0;return!1},getMoveByIndex:function(e,t){var n=this.getGameJson(e);return n&&n.moves[t]?n.moves[t]:null},getMoveByKnotId:function(e,t){var n=this.getGameJson(e);if(!n)return null;for(var i=0;i<n.moves.length;i++)if(n.moves[i].knotId==t)return n.moves[i];return null},getPositionByKnotId:function(e,t){var n=this.getGame(e);if(!n)return null;var i=function(e,t){if(!e)return null;if(e.knotId==t)return e;if(!e.childrenMoves)return null;for(var n=0;n<e.childrenMoves.length;n++){var r=i(e.childrenMoves[n],t);if(r)return r}return null};return i(n.getStartPosition(),t)},getParentMoveByKnotId:function(e,t){var n=this.getGameJson(e);if(!n)return null;for(var i=0;i<n.moves.length&&n.moves[i].knotId!=t;i++);if(i>=n.moves.length)return null;for(var r=0;r<n.moves.length;r++)if(n.moves[r].children&&n.moves[r].children.contains(i))return n.moves[r];return null},getController:function(t){return e[t]},getGames:function(){return jQuery.extend({},t)},getGamesJson:function(){return jQuery.extend({},n)},getGame:function(e,r){return r?(i[e]||(i[e]={}),i[e][r]||(i[e][r]=new Chess.couchToGame(n[e]),i[e][r].copyId=r),i[e][r]):t[e]},getGameJson:function(e){return n[e]?jQuery.extend({},n[e]):void 0},getViews:function(){return r},getView:function(e){return r[e]},getControllersForView:function(e){return o[e]||[]},decorateController:function(e){var t=new View.Highlight("highlighted");t.link(e)},addGame:function(i,r){t[i]||(n[i]=r,t[i]=new Chess.couchToGame(r),e.main.addGame(i,t[i]),e.main.setCurrentGame(i),r.meta&&r.meta.Fen?e.main.gotoId(i,s(r,r.meta.Fen)):e.main.gotoStart())},init:function(n){if(!this.initialized){if(e.main=new Chess.GameHandler,n&&!jQuery.isArray(n))for(var i in t){e.main.setCurrentGame(i),e.main.gotoStart();break}this.decorateController(e.main),this.initialized=!0}if(n&&!jQuery.isArray(n))for(var i in n)this.addGame(i,n[i])}};return{chessBase:c,create:function(e,t,n){return e=this.parent.create(e,t,n),t&&this.chessBase.init(n.chessGames),e}}}()),"undefined"==typeof Widgets&&(Widgets={}),Widgets.ChessView=Widgets.Chess().extend(function(){var e=function(e){var t=e.extensions.dom.getSelection();if(!t)return null;for(var n=e.extensions.dom.treeToVector(t.commonAncestorContainer.childNodes),i=t.startContainer,r=t.endContainer,o=jQuery("nothing"),a=0;a<n.length;a++)if(n[a]==i){for(;a<n.length&&n[a]!=r;a++){var s=jQuery(n[a]);if(s.is("a")&&s.hasClass("widgetcontainer-inline")){var l=s.data("widget");l&&"chess-jump-to-link"==l.wid&&(o=o.add(s))}}break}return o.length?o:null},t=function(e){var t=e.find("a.jump-to-link");return t.length?t:null};return{linkLinksToWidget:function(n,i,r,o){var a=o?e(n):t(n);if(a){var s=this,l=parseInt(i.data("widget").properties.viewId)||0,c=[];a.each(function(){var e=jQuery(this),t=e.data("widget");c.contains(t.resources[0].reference_id)||(c.push(t.resources[0].reference_id),s.chessBase.separateView(l,[t.resources[0].reference_id])),t.properties.views?t.properties.views.contains(l)||t.properties.views.push(l):t.properties.views=[l],e.attr("data-widget",jQuery.toJSON(t))}),n.trigger("mouseover")}},unlinkLinksFromWidget:function(n,i,r,o){var a=o?e(n):t(n);if(a){var s=parseInt(i.data("widget").properties.viewId)||0;a.each(function(){var e=jQuery(this),t=e.data("widget");if(t.properties.views){var n=t.properties.views.indexOf(s);-1!=n&&(t.properties.views.splice(n,1),e.attr("data-widget",jQuery.toJSON(t)))}})}},remove:function(e,t,n){var i=parseInt(e.data("widget").properties.viewId)||0;this.parent.remove(e,t,n);var r=this.chessBase.getView(i);if(r)for(var o=this.chessBase.getControllersForView(i),a=0;a<o.length;a++)r.unlink(this.chessBase.getController(o[a]));return t.find("a").each(function(){var e=jQuery(this);if(e.is(t.widgetmaskInline)){var n=e.data("widget");if(n&&"chess-jump-to-link"==n.wid&&n.properties.views){var r=n.properties.views.indexOf(i);if(-1!=r){var n=e.data("widget");n.properties.views.splice(r,1),e.attr("data",jQuery.toJSON(n))}}}}),!1},create:function(t,n,i){t=this.parent.create(t,n,i);var r=this,o=parseInt(t.data("widget").properties.viewId)||0;if(n){t.find(".widget-buttons").remove();var a=jQuery("<div/>").addClass("widget-buttons").appendTo(t),s=jQuery("<a/>").html(window.t("link")).append(jQuery("<span/>")).off("click").on("click",function(){r.linkLinksToWidget(n,t,i,!0),t.trigger("mouseover")}),l=jQuery("<a/>").html(window.t("unlink")).append(jQuery("<span/>")).off("click").on("click",function(){r.unlinkLinksFromWidget(n,t,i,!0),r.chessBase.checkSeparatedViews([o],n),t.trigger("mouseover")}),c=jQuery("<a/>").html(window.t("unlink all")).append(jQuery("<span/>")).off("click").on("click",function(){r.unlinkLinksFromWidget(n,t,i,!1),r.chessBase.checkSeparatedViews([o],n),t.trigger("mouseover"),n.find(".view-highlighted").removeClass("view-highlighted")});a.append(s).append(l).append(c),t.on("mouseover",function(){var t=n.extensions.dom.getSelection();if(!t||t.startContainer==t.endContainer&&t.startOffset==t.endOffset){var i=0;n.find(n.widgetmaskInline).each(function(){var e=jQuery(this).data("widget").properties.views;e&&e.contains(o)&&(i++,jQuery(this).addClass("view-highlighted"))}),i>0?(s.hide(),l.hide(),c.find("span").html(" ("+i+")").end().show()):(l.hide(),s.hide(),c.hide())}else{var r=e(n),i=0,d=0,u=0;r&&r.each(function(){var e=jQuery(this).data("widget").properties.views;e&&e.contains(o)?i++:d++,u++}),d>0?s.find("span").html(" ("+d+")").end().show():s.hide(),i>0?l.find("span").html(" ("+i+")").end().show():l.hide(),c.hide()}a.show()}).on("mouseout",function(){n.find(n.widgetmaskInline).filter(".view-highlighted").removeClass("view-highlighted"),a.hide()})}return t}}}()),"undefined"==typeof Widgets&&(Widgets={}),Widgets.Upload=Widgets.Base().extend({multiple:!1,callbacks:{add:function(){},done:function(){},error:function(){},change:function(){},progressall:function(){}},dialog:function(e,t,n,i,r){return e=this.parent.dialog(e,t,n,i,r),e.find("input[type=file]").on("chess24:add",function(e,n){n&&(n.formData=jQuery.extend(n.formData||{},t.config.formData))}).on("chess24:done",function(t,n){n&&e.find("[data-resource-property=reference_id]").val(n.result.data.reference_id)}).on("chess24:error",function(e,n,i,r){n&&t.showToolDialogErrors(jQuery.parseJSON(n.responseText.replace(/&quot;/g,'"')))}),e}}),jQuery(document).ready(function(){function e(){new View.ActivityStream(".communityStream","community").link(notificationHandler);var e=jQuery(".topicDialog").modal({close:!0});jQuery(".postStory").on("click",function(){e.modal("show")})}function n(){var e=jQuery("#ContentTopic_permalink"),t=jQuery("#ContentTopic_title"),n=0==e.val().trim().length;t.on("keyup",function(){n&&setTimeout(function(){e.val(t.val().permalink())},1)}),e.on("change",function(){n=0==e.val().trim().length})}function i(){function e(e){var t=e.target.parentElement.parentElement.id.substring(2);jQuery.post("/communityAdmin/topicDown",{id:t,csrf:config.csrf()},function(e){if(1==e.data.result){var n=jQuery("#tr"+t);n.insertAfter(n.next())}})}function t(e){var t=e.target.parentElement.parentElement.id.substring(2);jQuery.post("/communityAdmin/topicUp",{id:t,csrf:config.csrf()},function(e){if(1==e.data.result){var n=jQuery("#tr"+t);n.insertBefore(n.prev())}})}var n=$(".topicListMoveDown");n.each(function(){var t=jQuery(this);t.off("click").on("click",e)});var i=$(".topicListMoveUp");i.each(function(){var e=jQuery(this);e.off("click").on("click",t)})}function r(e){jQuery("td.online").each(function(){var t=jQuery(this),n=t.parent().find("td.id").text(),i=jQuery("<a/>").append(t.contents()).appendTo(t).on("click",function(){jQuery.getJSON(e+"?story="+n,function(e){i.html(1==e.data.result?"yes":"no")})})})}function o(e){new Controller.LiveVideo(jQuery(".liveVideoContainer"),e)}function a(e){var t=["lobby_en","lobby_de","lobby_es"],n=new RegExp("_"+config.language()),i=t.find(function(e){return n.test(e)})||t[0];chatHandler.addChat(".chatContainer",t,{showSpecialInput:!0,header:e,defaultChatRoom:i})}function s(){new View.GameSessionList("div.gameSessionList div.gridView > table > tbody .nativeScrollInsider > table","div.counterBox.onlineGames > span.counterNumber").link(notificationHandler)}function l(){($("#watchBuyVideoSeriesId").length>0||$("#learnBuyVideoSeriesId").length>0||$("#userBuyVideoSeriesId").length>0)&&jQuery(".buyVideoSeries").addVideoSeriesPurchasePopUp()}function c(){function e(e,t){t.hasClass("premium")&&(e?t.removeClass("premium"):t.children("input").attr("disabled","disabled"))}var t=config.level().isPremium;jQuery(".themeSelector.boards .themeSliderInner div.board").each(function(){e(t,jQuery(this))}),jQuery(".themeSelector.pieces .themeSliderInner div.piece").each(function(){e(t,jQuery(this))})}function d(){function e(e,n){n.hasClass("premium")&&(e||n.on("click",function(){t()}))}function t(e){n||(e&&"function"==typeof e.preventDefault&&e.preventDefault(),jQuery(Dialog.conversionGoPremium("premiumBoards",{returnHTML:!1,logo:!1,featureTable:!1,cancelButton:!1,rootClasses:"popupInsider conversionDialog conversionDialogGoPremium"})))}var n=config.level().isPremium;jQuery(".themeSelector.boards .themeSliderInner div.board").each(function(){e(n,jQuery(this))}),jQuery(".themeSelector.pieces .themeSliderInner div.piece").each(function(){e(n,jQuery(this))}),jQuery("input.premium").on("click",t)}function u(e){var t=$("#chessDatabaseIndexInitObjectId").attr("data");if(t){t=JSON.parse(t);var n=new Controller.ChessDB(".contentContainerInsider",t);e&&n.subscribe(e)}}function h(){jQuery("#metabrowser").val(navigator.appName+" "+navigator.appVersion),jQuery("#metaos").val(navigator.platform)}function f(){new View.OnlineUserList("div.userOnlineList div.gridView > table > tbody .nativeScrollInsider > table","div.counterBox.onlineUsers > span.counterNumber").link(notificationHandler)}function p(e){jQuery("body").addClass(e)}function m(){new View.LessonPages(".lessonPagesViewport",".afterLessonDialog",".lessonContainer header.lessonHeader",".lessonContainer .lessonProgressBar",showSchoolLessonInfo.lessonId,showSchoolLessonInfo.lessonFinished,showSchoolLessonInfo.pageIds,showSchoolLessonInfo.pageStates,"/api/web/SchoolAPI/preloadPages","/api/web/SchoolAPI/setPageState","/api/web/SchoolAPI/finishLesson",showSchoolLessonInfo.coursePermalink)}function g(){new BroadcastConfig.Editor(".broadcastConfigurator")}function v(){new achievementsManager}function y(){function e(){jQuery(".buyVideoSeries").addVideoSeriesPurchasePopUp();var e=$("#targetEloRange .cPatternSlider");e.on("afterstop",function(e,t){var n="level",i=t.values[0]+","+t.values[1],r=window.location.href;r=r.replace(new RegExp(n+"=[^&]*"),"").replace("&&","&").replace(/&$/,"").replace(/\?&?$/,"").replace("?&","?"),i&&(r+=(-1!=r.indexOf("?")?"&":"?")+n+"="+i),jQuery("#targetEloRangeLink").attr("href",r).get(0).click()}),jQuery("#purchasedOnly").click(function(e){var t="purchased",n=this.checked?1:0,i=window.location.href;i=i.replace(new RegExp(t+"=[^&]*"),"").replace("&&","&").replace(/&$/,"").replace(/\?&?$/,"").replace("?&","?"),i+=(-1!=i.indexOf("?")?"&":"?")+t+"="+n,jQuery("#priceCategoryLink").attr("href",i).get(0).click()}),layout("#learnOverview"),layout.oneTime.colorHeader(),jQuery(".rangeSliderContainer").styleRangeSlider()}e()}function b(e){chatHandler.addChat(".chatContainer",[e],{showSpecialInput:!0,autoscroll:!0,getMessagesLimit:50})}function w(){jQuery("#videoHolder").videoDisplay(showVideoSeriesInfo.video_series,showVideoSeriesInfo.videoUrls,showVideoSeriesInfo.videoImageUrls,showVideoSeriesInfo.securityCode),jQuery("#videoHolder").one("videoDisplayInitialized",function(e,t){var n=jQuery("#videoHolder").data("chessGameHandler"),i=new View.ChessDBMovesWithSelector("#databaseMovesTable").link(n),r=new View.ChessDBGames("#databaseGamesTable").link(n);new View.VideoExercises("#exercisesTab",t.exerciseGroups,t.videoApi,t.timeline,"#exerciseTabBtn","#afterVideoDialog",showVideoSeriesInfo.promoteSeries,".promoToBuyAfterPreview").link(n);var o=new View.EngineGroup("#videoEngineContent").link(n);jQuery("#videoTabDatabaseMoves").suspendResume(i),jQuery("#videoTabDatabaseGames").suspendResume(r),jQuery("#videoTabEngine").suspendResume(o),jQuery(".buyVideoSeries").addVideoSeriesPurchasePopUp()})}function k(e){var t=jQuery("#player1"),n=jQuery("#player2"),i=t.next(".selectBox-dropdown"),r=n.next(".selectBox-dropdown");jQuery("#compare").on("click",function(){var o=e,a=t.find(":selected").val(),s=n.find(":selected").val();return a.length?s.length?(o=o.replace("player1",a),o=o.replace("player2",s),void(window.location.href=o)):(r.addClass("inputError"),void n.on("change",function(){r.removeClass("inputError")})):(i.addClass("inputError"),void t.one("change",function(){i.removeClass("inputError")}))})}function x(){jQuery(".eventConditionSelector").eventConditionSelector()}function C(){jQuery(".translationTableWrapper").translationTable()}function j(e){missionBadgeManager(e)}function T(e){function t(t){if(t.origin===n){var i=t.data.substring((n+"/hc/"+e.langZendesk).length),r="/"+e.lang+"/faq"+i;window.history.pushState("","",r)}}if(e){e=JSON.parse(e);var n=e.ORIGIN;window.addEventListener("message",t)}}function _(){var e=jQuery(".container--video");e.flowplayer({playlist:[[{webm:e.data("webm"),mp4:e.data("mp4")}]],embed:!1,poster:e.data("poster"),keyboard:!1}),e.flowplayerErrorHandler()}function S(e){var t=e.attr("id");if("undefined"!=typeof editContentInfoObject){var n=editContentInfoObject["editContentInfo_"+t];n&&setTimeout(function(){$(".editor[data-cid="+n.formData.cid+"]").editor({input:jQuery(n.input),extensions:n.extensions,uploadUrl:n.uploadUrl,validateWidgetUrl:n.validateWidgetUrl,metaUploadUrl:n.metaUploadUrl,metaCropUrl:n.metaCropUrl,extraClass:n.extraClass,language:n.language,maxLength:n.maxLength,watermark:n.watermark,formData:n.formData,height:n.height,scrollToolbar:n.scrollToolbar,localBackup:n.localBackup,widgetsLayout:n.widgetsLayout,widgets:n.widgets,inlineWidgets:n.inlineWidgets,chessGames:n.chessGames})},10)}}function I(e){e=e||$(document),$.each(e,function(e,t){var n=$(t).find(".editContentId");S(n)})}function P(e){var t=e.attr("id");if(!A.contains(t)){var n=e.find("#viewContentChessgameId_"+t);if(n.length>0&&"undefined"!=typeof viewContentChessgameObject){var i=viewContentChessgameObject["viewContentChessgame_"+t];if(i){var r=i.chessGames;r&&Widgets.ChessView().chessBase.init(r)}}var o=e.find("#viewContentCid_"+t);if(o.length>0){var a=o.attr("data");return initGoogleMaps(),Widgets.Base().setup(".couch-content[data-cid="+a+"]"),A.push(t),!0}}return!1}function M(e){e=e||$(document);var t=!1;return $.each(e,function(e,n){var i=$(n).find(".viewContentInfoId");P(i)&&(t=!0)}),t}function Q(e){function t(){o.on("movedPositionPointer.current",i),a.movementHandler.isActive()||a.movementHandler.activate()}function n(){o.off("movedPositionPointer.current",i),setTimeout(function(){a.movementHandler.isActive()&&a.movementHandler.deactivate()})}function i(e,t){var i=o.getCurrentPosition().getSan();jQuery(".userMove").val(i),s.removeClass("disabled"),l.removeClass("disabled"),n()}var r=e,o=new Chess.Game({fen:r}),a=new View.ChessBoard(jQuery(".puzzleBoard"),!0).link(o),s=jQuery(".cBtnFlexi.undo"),l=jQuery(".cBtnFlexi.submit"),c=jQuery(".cBtnFlexi.register");
o.getCurrentPosition().moveRight===Chess.colors.white.letter?jQuery(".BWmove.white").show():(jQuery(".BWmove.black").show(),a.flip()),config.level().isGuest?(jQuery(".loggedOff").show(),n()):(jQuery(".loggedIn").show(),t()),s.on("click",function(){return s.is(".disabled")?!1:(o.deleteMove(void 0,!0),t(),s.addClass("disabled"),void l.addClass("disabled"))}),l.on("click",function(){l.is(".disabled")||(jQuery("form.puzzle .csrf").val(config.csrf()),jQuery("form.puzzle .fen").val(r),jQuery("form.puzzle").submit())}),c.on("click",function(){jQuery(".register-link:first").trigger("click")})}function B(){jQuery(".validatable").validatable()}function E(e){var n=$("form.easterForm");n.on("submit",function(n){n.preventDefault(),setTimeout(function(){$(".field-errors:visible").length<=0&&jQuery.post("/api/web/NewsletterAPI/subscribe",{email:$("#campagneEmailId").val(),channel:e,csrf:config.csrf()}).success(function(){$(".easterFormContainer").fadeOut(500,function(){$(".newsletter .message").html(t("Email was successfully sent")).parent().parent().removeClass("error").addClass("success").fadeIn()})}).error(function(e){var t=JSON.parse(e.responseText),n=t.errors.error[0];$(".newsletter .message").html(n).parent().parent().removeClass("success").addClass("error").show()})})})}function O(e,t){var n;if(t){var i=$("#"+t);if(i.length<=0)return;n=i.attr("data")}e(n)}var A=[];O(e,"loadCommunityId"),O(n,"editTopicId"),O(i,"listTopicId"),O(r,"listStoryId"),O(o,"listLiveVideoId"),O(a,"playChatId"),O(s,"watchGameSessionsId"),O(l),O(c,"profileSettingsThemesId"),O(d,"profilePremiumId"),O(loadTopTournamentPage,"topTournamentPageId"),O(u,"chessDatabaseIndexId"),O(h,"contactBrowserInfoId"),O(f,"onlineUsersId"),O(p,"listLiveTournamentId"),O(m,"schoolLessonId"),O(g,"broadcastConfigIndexId"),O(v,"loadAchievementsId"),O(y,"listVideoSeriesId"),O(b,"chatShowRoomId"),O(w,"showVideoSeriesId"),O(k,"headToHeadId"),O(x,"eventConditionSelectorId"),O(C,"translationTableId"),O(j,"missionBadgeId"),O(T,"siteFaqFrameId"),O(_,"siteIndexId"),O(I),O(M),O(Q,"usChampionshipPuzlleFenId"),O(B),O(E,"campagneSubmitId"),$.fn.initFilters=function(){y()},$.renderEditorContent=function(e){I(e)},$.renderContentChessGame=function(e){return M(e)}}),jQuery(document).on("onCommentsLoaded",function(){function e(){var e=jQuery(".commentContent");$.renderContentChessGame(e),$.renderEditorContent(e)}e()}),jQuery(document).on("onLessonPageLoaded",function(e){function t(){var t=$(e.target);"undefined"!=typeof $.renderContentChessGame&&"undefined"!=typeof $.renderEditorContent&&$.renderContentChessGame(t)}t()}),jQuery(document).on("ready",function(){var e=jQuery(".liveTournamentContainer");if(e.length){var t={},n=!!e.data("embed"),i=e.data("round"),r=e.data("match"),o=e.data("game"),a=e.data("c24"),s=e.data("customer"),l=e.data("overrides"),c=""+e.data("tournament");c&&(c=c.split("|"));var d=(window.location.hash||"").replace("#","");c&&(t.startWith=c[0]),(n&&c||c&&!d&&!i)&&(t.whiteList=c);var u=new Controller.Broadcast(e,{tournamentIds:t,roundId:i,embedded:n,c24:a,overrides:l,customer:s});if(e.is(".dualDisplay")){var h=e.data("id1"),f=e.data("id2");u.setSpecialMode("dual",{id1:h,id2:f}),t&&t.startWith&&i&&r&&o&&u.showGameWhenReady(t.startWith,i,r,o)}else e.is(".singleDisplay")?(u.setSpecialMode("single"),t.startWith&&(i&&r&&o||"live"===d?u.showGameWhenReady(t.startWith,i,r,o):"play"===d&&u.showOwnGame(t.startWith))):e.is(".multiBoardOnly")?u.setSpecialMode("multiBoardOnly"):t&&t.startWith&&(i&&r&&o||"live"===d?u.showGameWhenReady(t.startWith,i,r,o):"play"===d&&u.showOwnGame(t.startWith))}}),jQuery(document).on("ready chess24:comments",function(){var e=jQuery(".commentsContainer");if(!e.length)return void jQuery(".globalSharing").removeClass("withComments");var t=jQuery(".comment-count");jQuery(".globalSharing").toggleClass("withComments",e.is(":visible")).find(".commentsCount").html(t.html()).addClass(t.attr("class").replace(/.*(comment-count-[\w-]+).*/,"$1"));var n=jQuery((new Handler.Template).render("commonLoader")),i="/api/web/CommentAPI/comments?lang="+config.language()+"&"+e.data("name")+"="+e.data("reference"),r=e.find(".commentList"),o=!1;r.lazyload({url:i,selector:".commentItem",onload:function(e){n.detach();var t=jQuery(e.data.html),i=window.location.hash.replace("#","");if(i&&"comments"!=i&&!o){var a=t.find('a[name="'+i+'"]');a.length&&(setTimeout(function(){jQuery("html,body").animate({scrollTop:a.offset().top-100},200)}),o=!0)}r.append(t.find(".commentItem").add(t.filter(".commentItem"))),jQuery(document).trigger("newhtml"),r.find(".commentItem").length?r.find(".noComments").hide():r.find(".noComments").show(),jQuery(document).trigger("onCommentsLoaded")},onstart:function(){e.append(n)}});var a=e.find(".commentItemAddCount");e.on("change",".commentItemAdd .editor",function(t,n){if(!n){var i=jQuery(this),r=i.editor("text").trim();if(r.length){var o=(new Handler.Template,a.data("template"));a.find("p").html(Handler.Template.renderString(o,{characters:i.editor("configuration").maxLength-r.length})),a.show(),e.find(".commentItemAddEmpty, .commentItemAddWait").hide()}else a.hide()}}),e.off("click").on("click",".commentButtonComplain",function(){var e=jQuery(this),t=e.parents("li"),n=t.data("comment-uuid"),i={commentUUID:n,csrf:config.csrf()};return jQuery.post("/api/web/commentAPI/complain",i,function(t){0===t.status&&(0===t.data.btn_state?e.addClass("cBtnInactive"):e.removeClass("cBtnInactive"))}),!1}),e.on("click",".commentButtonReply",function(){var e=jQuery(this).closest(".commentItem").find(".commentContent .couch-content").clone();e.find("div, script, blockquote").remove();var t=e.find("p").filter(function(){return"p"==this.tagName.toLowerCase()&&(this.childNodes.length>1||1==this.childNodes.length&&(3==this.childNodes[0].nodeType||"br"!=this.childNodes[0].tagName.toLowerCase()))}),n=jQuery("<blockquote/>").append(t).attr("contenteditable",!1);jQuery(".commentItemAdd .editor").html("<p><br/></p>").focus().prepend(n.get(0).outerHTML)}),e.on("click",".commentOrder .cTooltipBoxContainer span",function(){var e=jQuery(this),t=jQuery(".commentOrder .selected");return t.data("value")!==e.data("value")&&jQuery.post("/api/web/commentAPI/order",{csrf:config.csrf(),value:e.data("value")},function(e){0===e.status&&(t.text(e.data.name).data("value",e.data.value),jQuery(".commentList").find(".commentItem").remove().end().lazyload("refresh"))}),!1}),e.on("click",".commentButtonDelete",function(){var e=jQuery(this),t=e.parents("li"),n=t.data("comment-uuid"),i={commentUUID:n,csrf:config.csrf()};return jQuery.post("/api/web/commentAPI/delete",i,function(n){if(0==n.status){var i=e.closest(".commentsContainer").data("reference");t.remove(),jQuery(".comment-count-"+i).text(n.data.count)}}),!1});var s;jQuery("#comment-add-new").off("click").on("click",function(){var t=jQuery(this),n=jQuery("form.comment-form .editor").editor("html");if(0==jQuery("<div/>").html(n).text().trim().length)return jQuery(".commentItemAddEmpty").show(),jQuery("form.comment-form .editor").one("change",function(){jQuery(".commentItemAddEmpty").hide()}),!1;var i={csrf:config.csrf(),comment:n,referenceUUID:jQuery("form.comment-form input[name=referenceUUID]").val()},r=jQuery(this).closest(".commentItemAdd").data("url");return jQuery.post(r,i,function(n){if(0==n.status){var i=t.closest(".commentsContainer"),r=i.data("reference");jQuery("ul.comments-list").find(".noComments").remove(),jQuery("ul.comments-list").prepend(n.data.html),jQuery(".comment-count-"+r).text(n.data.count),jQuery("form.comment-form .editor").editor("reset"),jQuery.renderContentChessGame(i),jQuery(document).trigger("newhtml"),e.find("input.optInOut").prop("checked",n.data.subscribed),Handler.tracking("comment",t.closest(".commentsContainer").data("name"))}}).error(function(e){var n=jQuery.parseJSON(e.responseText),i=t.closest("form").find(".commentEditorContainer .field-errors");if(i.length||(i=jQuery("<span/>").addClass("field-errors").appendTo(t.closest("form").find(".commentEditorContainer"))),i.html("").hide(),n.errors)for(var r in n.errors)if("spam-filter"==r){a.hide();var o=jQuery(".commentItemAddWait").show().find(".commentItemAddWaitTime");clearTimeout(s),function l(e){o.html(e),e>1?s=setTimeout(function(){l(e-1)},1e3):jQuery(".commentItemAddWait").hide()}(n.data.seconds)}else i.append(n.errors[r].join("<br/>")+"<br/>").show();t.closest("form").find(".editor").one("change click focus",function(){i.hide()})}),!1}),e.on("click",".commentButtonEdit",function(){if(config.level().isAdmin){var e=jQuery(this),t=e.closest(".commentItem");if(t.length){var n=t.data("comment-uuid");jQuery.getJSON("/api/web/commentAPI/getComment?uuid="+n).success(function(i){function r(){l.remove(),s.show(),o.hide(),a.hide(),e.show()}var o=e.siblings(".commentButtonEditCancel"),a=e.siblings(".commentButtonEditSave"),s=t.find(".commentContent").hide(),l=jQuery('<div class="commentEditor"/>').insertAfter(s).html(i.data.comment);$.renderEditorContent(l),e.hide(),o.show().off("click").on("click",r),a.show().off("click").on("click",function(){var e=l.find(".editor").editor("html"),t={csrf:config.csrf(),content:e,uuid:n};jQuery.post("/api/web/commentAPI/saveComment",t,function(e){0==e.status&&(s.html(e.data.html).show(),jQuery.renderContentChessGame(s),l.remove(),jQuery(document).trigger("newhtml"))}).error(function(e){var t=jQuery.parseJSON(e.responseText),n=l.find(".field-errors");if(n.length||(n=jQuery("<span/>").addClass("field-errors").appendTo(l)),n.html("").hide(),t.errors)for(var i in t.errors)n.append(t.errors[i].join("<br/>")+"<br/>").show();l.find(".editor").one("change click focus",function(){n.hide()})}).always(r)})})}}}),e.find("input.optInOut").on("change",function(){var t=jQuery(this),n={uuid:e.data("reference"),type:e.data("name"),csrf:config.csrf()};jQuery.post("/api/web/commentAPI/toggleOptIn",n,function(e){t.prop("checked",!!e.data.result)})})}),jQuery(document).on("ready",function(){!function(){function e(){n.hide(),jQuery(".communityPreviewBar").hide(),t.css("height",""),t.find("form").removeClass("inactive"),jQuery(window).off("scroll.preview")}var t=jQuery(".community_edit .storyForm");if(t.length){var n=jQuery(".communityPreview");jQuery(".cFormButtons .preview").on("click",function(){var e=jQuery('[name*="teaser_image_couch_id"]').val();n.find("h1").html(jQuery("#ContentGroup_title").val()),n.find(".couch-content").html(t.find(".editor").editor("html")),e?jQuery.getJSON("/api/web/contentWidgetAPI/getImageUrl?id="+e,function(e){n.find(".previewImage").attr("src",e.data.url).show()}):n.find(".previewImage").hide(),t.find("form").addClass("inactive"),jQuery("html, body").animate({scrollTop:0}),jQuery(".communityPreviewBar").appendTo("body").show(),n.show(),Widgets.Base().setup(n);var i=parseInt(n.css("padding-top"),10)+parseInt(n.css("padding-bottom"),10);n.outerHeight()<t.outerHeight()-i?n.css("height",t.outerHeight()-i+"px"):t.css("height",n.outerHeight()+"px")}),jQuery(".communityPreviewBar .goBack").on("click",e),jQuery(".communityPreviewBar .publish").on("click",function(){t.find("form").submit()}),t.find("form").on("validatable:error",e),jQuery("#ContentGroup_teaser_image_couch_id").on("chess24:error",function(e,t){jQuery(this).closest("dt").next("dd").find("span").addClass("error")}).on("chess24:done chess24:add",function(){jQuery(this).closest("dt").next("dd").find("span").removeClass("error")})}}(),function(){jQuery(".communityPopularList, .communityFeaturedTopics, .communityTopics").find(".ribbonSizeM a").on("click",function(){Dialog.conversionGoPremium("communityTopic")})}(),function(){var e=jQuery(".community_topic .topicStoriesList .communityTiles");e.lazyload({url:location.href,selector:"li",offset:e.find("li").length,onload:function(t){e.append(jQuery(t.data.html).find("li"))}})}(),function(){jQuery(".community_show .storyControls .delete").on("click",function(){var e=jQuery(this),t=e.attr("href");return Dialog.confirmation(e.data("prompt"),function(){window.location=t}),!1})}(),function(){jQuery(".communityLanguagePicker").on("change",function(){var e=jQuery(this).val(),t=window.location.href.replace(/\?.*/,"");window.location=t+(e?"?language="+e:"")})}(),function(){jQuery(".forceSingleLineTrigger").each(function(){var e=jQuery(this),t=e.parent("p");t.height()>24?(e.insertAfter(t.addClass("forceSingleLine")).show(),jQuery(this).data("p",t)):e.remove()}).on("click",function(){var e=jQuery(this),t=e.data("p");if(t&&t.length){var n=e.data("altText");e.data("alt-text",e.html()).html(n),t.is(".forceSingleLine")?e.appendTo(t).before(" "):e.insertAfter(t),t.toggleClass("forceSingleLine")}})}()}),jQuery(document).on("ready",function(){var e=jQuery("#ContentGroup_permalink"),t=jQuery("#ContentGroup_title");if(e.length&&t.length){var n=0==e.val().trim().length;t.on("keyup",function(){n&&setTimeout(function(){e.val(t.val().permalink())},1)}),e.on("change",function(){n=0==e.val().trim().length})}var i=jQuery("#ContentGroup_teaser_image_couch_id, #ContentTopic_image_couch_id");if(i.length){var r,o,a=i.closest("dl"),s=a.siblings(".preview"),l=s.find(".empty"),c=s.find("input"),d=s.find("img");setTimeout(function(){r=a.find("input[type=hidden]").val(),o=d.attr("src"),c.add(c.parent()).add(d)[o?"show":"hide"](),l[d.attr("src")?"hide":"show"]()},100),c.on("click",function(){a.find("input[type=hidden]").val(""),a.find(".fileUploadDetails span").click(),d.hide().attr("src","about:blank"),c.add(c.parent()).hide(),l.show(),r=void 0}),i.on("chess24:done",function(e,t){if(i.is(".scale")){var n=jQuery(".editor-meta-thumbnail");n.length||(n=jQuery("<div/>").addClass("editor-meta-thumbnail").appendTo("body").css("padding","10px"));var r=jQuery("<img/>").attr("src",t.result.data.reference_url);n.html("").append(r).modal().modal("show").on("chess24:hide",function(){r.thumbnail("hide")}),r.on("load",function(){n.modal("show");var e=jQuery("#upload-width").val(),o=jQuery("#upload-height").val();r.thumbnail({width:parseInt(e,10),height:parseInt(o,10),scale:"save-ratio",callback:function(r,s,u,h){var f={csrf:config.csrf(),image:t.result.data.reference_id,left:Math.round(r),top:Math.round(s),width:Math.round(u),height:Math.round(h),sourcewidth:e,sourceheight:o};jQuery.post("/api/web/ContentWidgetAPI/cropMetaImage",f,function(e){0==e.status&&(n.modal("hide"),d.length||(d=jQuery("<img/>").insertBefore(c.parent())),d.attr("src",e.data.url).show(),c.add(c.parent()).show(),i=a.find("input[type=file]"),l.hide())})}})})}else d.length||(d=jQuery("<img/>").insertBefore(c.parent())),d.attr("src",t.result.data.reference_url).show(),c.add(c.parent()).show(),i=a.find("input[type=file]"),l.hide()}),i.on("chess24:cancel",function(e){r?(a.find("input[type=hidden]").val(r),d.attr("src",o)):(a.find("input[type=hidden]").val(""),d.attr("src","about:blank").hide(),c.add(c.parent()).hide(),l.show()),i=a.find("input[type=file]")})}var u=jQuery(".confirm-delete");u.length&&u.on("click",function(){jQuery(this);return confirm("Do you really want ro delete this item?")?void 0:!1});var h=jQuery("#insert-teaser");h.length&&h.on("click",function(){var e=jQuery(this),t={csrf:config.csrf()};t.ccid=e.data("api-url").replace(/.*ccid=(.+)/,"$1"),(!jQuery("textarea.teaser-text-target").val()||confirm("Override the current teasertext with text from content?"))&&jQuery.post(e.data("api-url"),t,function(e){0===e.status&&jQuery(".teaser-text-target").val(e.data.text)})});var f=jQuery(".headToHead .selectAnother select");f.length&&f.on("change",function(){var e=jQuery(this),t=e.closest(".player.one").length?"left":"right",n=e.val(),i=jQuery(".player"+("left"==t?".one":".two")),r=jQuery(".comparison ."+t),o=window.location.pathname.split("/")[1],a={permalink:n,lang:o,csrf:config.csrf()};jQuery.post("/api/web/biographyAPI/playerDetails",a,function(e){if(0==e.status){var t=e.data.player;i.find("img").attr("src",t.image),i.find(".name a").html(t.name),i.find(".title").html(t.title),i.find(".rank").html(parseInt(t.rank)||"-"),i.find(".rating").html(t.rating||"-"),i.find(".federation").html(t.federation+' <span class="icoFlag flag3-'+t.federationiso3+'"></span>'),i.find(".link").attr("href",t.url),r.filter(".age").html(t.age+(t.death?" ("+window.t("d. ")+t.death+")":" ("+window.t("b. ")+t.birth+")")),r.filter(".birthplace").html(t.birthplace||"-"),r.filter(".federation").html(t.federation),r.filter(".peak").html(t.peak?t.peak+" ("+t.peakdate+")":"-"),r.filter(".blitz").html(t.blitz||"-"),r.filter(".rapid").html(t.rapid||"-")}})});var p=jQuery(".bodyContainer");if(p.is(".news_view, .tromso2014_view")&&jQuery(".newsMeta .arrow").shareButtons({noLabel:!0,facebook:!0,twitter:jQuery(".oneNews h1").text(),google:!0,mail:!1,embed:!1}),p.is(".news, .tromso2014_home, .tromso2014_dashboard, .user_dashboard")&&jQuery(".topNewsHeadline .arrow, .topNews .arrow, .allNews .arrow, .dashboardTopNews .arrow").each(function(){jQuery(this).shareButtons({noLabel:!0,url:jQuery(this).closest(".newsMeta").parent().find("> a, h3 a").attr("href"),facebook:!0,twitter:jQuery(this).closest(".newsMeta").parent().find("h3, .newsInfo a").text(),google:!0,mail:!1,embed:!1})}),p.is(".news_edit")){var m=p.find(".editor");m.length&&setTimeout(function(){m.on("change",function(e,t){t||window.onbeforeunload||(window.onbeforeunload=function(){return"Are you sure you want to leave this page? There are unsaved changed in the editor."},jQuery(".cFormButtons input").on("click",function(){window.onbeforeunload=void 0}))})},1e4)}}),jQuery(function(){function e(){jQuery(".tacticsTrainerSlider").each(function(){var e=jQuery(this);e.find("> div:first").fadeOut(1e3).next().fadeIn(1e3).end().appendTo(e)})}function t(e,t,n,i,r,o){var a=r?"lang="+config.language():"";a+=o?o:"",$.ajax({url:"/api/web/UserAPI/"+e,type:"GET",data:a,dataType:"json"}).done(function(e){e&&0===e.status&&e.data&&t(e.data)}).fail(function(e){errorHandler.msg(n,new Error("error getting "+e+" info"),!1)}).always(function(){i&&i()})}if(jQuery(".dashboardTileAchievements .profileBadgeIcon").length>0){var n=jQuery("<div>",{id:"achievementsBubble"}).append(jQuery("<h3>",{id:"bubbleTitle"}).html("&nbsp;")).append(jQuery("<p>",{id:"bubbleDescription"}).html("&nbsp;"));jQuery("body").append(n),n.bubble({side:"bottom",point:"precise",flexible:!0,noanimation:!0}),jQuery(".dashboardTileAchievements .profileBadgeIcon").on("mouseover",function(){var e=jQuery(this);n.bubble("hide"),setTimeout(function(){n.find("#bubbleTitle").html(e.data("title")),n.find("#bubbleDescription").html(e.data("description")),n.show().bubble("realign",e).bubble("show")},1)}),jQuery(".dashboardTileAchievements .profileBadgeIcon").on("mouseout",function(){n.bubble("hide")})}if(1==jQuery("#latestGameBoardContainer").length){var i=jQuery("#latestGameBoardContainer").data("fen"),r=new Chess.Game(i?{fen:i}:void 0).setNoTimeout(!0);new View.ChessBoard("#latestGameBoardContainer").link(r),jQuery(".dashboardTileGame .playNowLink").off("click").on("click",function(){Controller.getPlayZone().playNow()})}if(jQuery(".tacticsTrainerSlider").length>0){jQuery(".dashboardTileGame .board.latestPuzzle").each(function(){var e=jQuery(this),t=e.data("fen"),n=new Chess.Game(t?{fen:t}:void 0);new View.ChessBoard(e).link(n)});var o=setInterval(e,4e3);jQuery(".tacticsTrainerSlider").hover(function(e){clearInterval(o)},function(t){o=setInterval(e,4e3)})}jQuery(".playBtn").on("click",function(){Controller.getPlayZone().playNow()});var a=new Handler.Template("dashboard");(function(){function e(e){$stats=jQuery(a.render("_dashboard_user_stats",{username:e.username,isPremiumWelcomeMessage:e.isPremiumWelcomeMessage,bulletInfo:e.bulletInfo,blitzInfo:e.blitzInfo,classicalInfo:e.classicalInfo,allGames:e.allGames,wins:e.wins,losses:e.losses,draws:e.draws,badgesInfo:e.badgesInfo})),n.append($stats),n.off("click",".playBtn").on("click",".playBtn",function(){Controller.getPlayZone().playNow()})}var n=$(".dashboardUserStatsContainer");if(0!=n.length)if(config.level().isGuest){var i=$(".pageSidebar").css("margin-top");$(".pageSidebar").css({"margin-top":"-1px"}),n.hide(function(){$(".pageSidebar").css({"margin-top":i})})}else{n.show();var r=config.user().uuid+"dashboardUserStatistics",o=new Helper.Cache(6e5),s=o.get(r);s&&e(s),t("getUserStatistics",e,"user statistics")}})(),function(){function e(e){var t=$(a.render("LatestNewsWidget",{topNews:e.latestNewsInfo.topNews,news:e.latestNewsInfo.news}));n.replaceWith(t)}var n=$(".userContentLatestNews");if(0!=n.length){var i=new Date;t("getLatestNews",e,"latest news",null,!0,"&offset="+i.getTimezoneOffset())}}(),function(){function e(){function e(e){function t(){var t=$(".userContentLiveEvents");s(t,10,e.items,e.liveVideo,!0,!0,!1)}function n(){var t=$(".mainMenuLiveEvents");s(t,10,e.items,"",!1,!1,!1)}function i(){var t=$(".sidebarLiveEvents");s(t,10,e.items,"",!1,!0,!1)}function r(){var t=$(".urlWatchLiveEvents");s(t,15,e.items,"",!1,!1,!1)}function o(){var t=$(".urlEventsLiveEvents");s(t,50,e.items,"",!1,!1,!0)}function s(e,t,n,i,r,o,s){if(n.length>=t&&(n=n.slice(0,t-1)),0!=e.length){var l=$(a.render("LiveEventsWidget",{items:n,liveVideo:i,title:r,footer:o,eventsTitle:s}));e.replaceWith(l),l.trigger("newhtml")}}t(),n(),i(),r(),o()}t("getLiveEvents",e,"live events",null,!0,"&maxItems=50")}e()}(),function(){function e(){function e(e){var t=$(a.render("PlaynowWidget",{}));i.replaceWith(t),new View.PlayButton("li.playButton",e.data).link(notificationHandler)}var i=$(".sidebarPlaynow");0!=i.length&&t("getSidebarPlaynow",e,"play now button",n)}function n(){function e(e){var t=$(a.render("ChallengesWidget",{incomingMessagesNumber:e.incomingMessagesNumber,outgoingMessagesNumber:e.outgoingMessagesNumber,unseenMessagesNumber:e.unseenMessagesNumber}));n.replaceWith(t)}if(config.level().isGuest)r();else{var n=$(".sidebarChallenge");0!=n.length&&t("getSidebarChallenge",e,"challenge",i)}}function i(){function e(e){var t="0"===e.incomingMessagesNumber?"":e.incomingMessagesNumber,i=$(a.render("MyFriendsWidget",{incomingMessagesNumber:t,urlToProfile:e.urlToProfile}));n.replaceWith(i)}if(!config.level().isGuest){var n=$(".sidebarMyFriends");0!=n.length&&t("getSidebarMyFriends",e,"my friends",r)}}function r(){function e(e){t(),e.addClass("active"),e.find(".sidebarMenuContent").show(),$(document).on(r,n)}function t(){i.find("> ul > li").removeClass("active"),i.find(".sidebarMenuContent").hide(),$(document).off(r,n)}function n(e){i.is(e.target)||i.has(e.target).length||t()}var i=$("nav.sidebarMenu"),r="mouseup.closeSidebar";i.find("> ul > li > a").not(".playNowLink, .customLink").on("click",function(){var n=$(this).closest("li");return n.hasClass("active")?void t():void e(n)});var a=i.find(".challenges");if(a.length){var s=i.find(".navChallengeAccepted");new View.Challenge(a,s).link(notificationHandler)}var l=i.find(".myFriends");l.length&&(new View.FriendshipButton("csrf",config.csrf()),new View.FriendshipSidebar),o()}function o(){function e(){"-1px"!==t.css("margin-top")?t.stick_in_parent({offset_top:77,spacer:".sidebarWrapper",parent:".pageWrap"}):t.trigger("sticky_kit:detach")}var t=$(".pageSidebar");$(window).resize(e),e(),$(".contentContainer").resize(function(){t.trigger("sticky_kit:recalc")})}e()}(),function(){function e(e){var t=config.level(),i=(config.language(),e.html);i&&(t.isGuest?i=i.guest:t.isPremium?i=i.premium:t.isRegistered&&(i=i.registered));var r=$(a.render("ConversionCustomWidget",{html:i}));n.replaceWith(r),r.trigger("newhtml"),new View.ConversionSidebar("#customSidebarWidget").link(notificationHandler)}var n=$(".sidebarConversionWidget");0!=n.length&&t("getSidebarCustomWidget",e,"sidebar conversion widget",null,!0)}(),function(){function e(){var e=config.level(),n=$(a.render("AdminWidget",{showAdmin:e.isAdmin||e.isTournamentOrganiser||e.isEditor,showReadCreate:e.isAdmin||e.isEditor,showBroadcastConfig:e.isAdmin||e.isTournamentOrganiser,showAdministrationLinks:e.isAdmin}));t.replaceWith(n)}var t=$(".sidebarAdmin");0!=t.length&&e()}(),function(){function e(){function e(){function e(e){var t=$(a.render("_user_content_top_players",{}));n.replaceWith(t),n=$(".topPlayers");var i=new Handler.Template("lobby"),r=$(i.render("topPlayers",{players:e.topPlayers})),o=n.find(".topPlayersContent");o.append(r);var s=$("div.topPlayers .topPlayersContent");$(".userDashboard").length>0&&s.length>0&&new View.TopActivePlayers(s,$("div.topPlayers .playzoneStreamGameTypes li")).link(notificationHandler)}var n=$(".topPlayers");t("getTopPlayers",e,"content")}function n(){function e(e){var t=$(a.render("_user_content_top_games",{}));n.replaceWith(t);var i=Controller.getPlayZone(),r=e.topGamesOptions,o={gameSessionToken:r.gameSessionToken,authToken:r.authToken,role:r.role,mode:r.gameSessionToken?r.gameSessionIsRunning?"human":"analysis":"standby",chessGame:r.chessGame,stream:r.stream,playingServer:{host:r.host,port:r.port},container:r.container,template:r.template,nonExclusiveView:r.nonExclusiveView};i.initGameSession(o)}var n=$(".topGames");t("getTopGames",e,"content")}var r=$(a.render("_user_content_section_play",{}));i.append(r),n(),e()}function n(e){function n(e){var t=$(a.render("_user_content_stories",{storiesInfo:e.storiesInfo}));i.append(t)}var i=$(".userContentStories");t("getStories",n,"content",null,!0)}var i=$(".userContentGamesPlayers");0!=i.length&&e(),n()}(),function(){function e(e){var t=$(a.render("LatestVideosWidget",{videos:e.videos}));n.replaceWith(t),jQuery(".buyVideoSeries").addVideoSeriesPurchasePopUp()}var n=$(".userContentLatestVideos");0!=n.length&&t("getLatestVideos",e,"latest videos",null,!0)}(),function(){function e(e){n.attr("href",e.permalink)}var n=$("#footerReferralsPermalink");0!=n.length&&t("getFooterReferralsPermalink",e,"Referrals Permalink",null,!0)}(),function(){function e(e){var t=$(a.render("ConversionGetPremiumWidget",{premiumUrl:e.premiumUrl,top:e.top}));i.replaceWith(t)}var n=config.level();if(!n.isGuest&&!n.isPremium){var i=$(".conversionPremiumWidget");0!=i.length&&t("getConversionPremiumWidget",e,"premium widget",null,!0)}}(),function(){function e(){var e=[];e.push({bulletText:"Unlimited games & more! Free"}),e.push({bulletText:"Quick & easy"}),e.push({bulletText:"A no-brainer"});var t=$(a.render("ConversionBecomeMemberWidget",{bulletPoints:e}));n.replaceWith(t)}var t=config.level();if(t.isGuest){var n=$(".conversionBecomeMemberWidget");0!=n.length&&e()}}(),function(){function e(e){n.switchClass(t,e)}var t="sUserLevelCSS",n=$("."+t);if(0!=n.length){var i="userIsGuest";config.level().isGuest||(i="userIsRegistered",config.level().isPremium&&(i+=" userIsPremium")),e(i)}}(),function(){var e=$(".dashboardAdvert");0!=e.length&&config.level().isGuest}(),function(){function e(e){var t=$(a.render("_playnow_shortcuts",{}));n.replaceWith(t),new View.PlayShortcuts(".playnowShortcuts",e.active).link(notificationHandler)}var n=$(".dashboardPlayShortcuts");0!=n.length&&t("getPlayShortcuts",e,"play shortcuts",null,!0)}()}),$(document).on("ready",function(){$(".contentContainerInsider.ebook").length&&(jQuery(".buyVideoSeries").addVideoSeriesPurchasePopUp(),$(".contentContainerInsider.ebook").each(function(){var e={};e.ebook=$(this),e.meta=e.ebook.next(".ebookMeta"),e.ebookCurrentSection=e.ebook.find(".ebookCurrentSection"),e.banner=e.ebook.find(".ebookCurrentSection .banner"),e.lastMove=e.ebook.find(".ebookLastMove"),e.scroller=e.ebook.find(".ebookScroll"),e.scrollerContent=e.ebook.find(".ebookScrollInsider"),e.sectionname=e.ebook.find(".section-name"),e.timeline=e.ebook.find(".fp-timeline"),e.progress=e.ebook.find(".fp-progress"),e.buffer=e.ebook.find(".fp-buffer");var t,n=[],i=e.scroller.height(),r=e.scroller[0].scrollHeight,o=1/(1-i/r),a=e.timeline.width(),s=function(){var i,s=e.scroller.scrollTop()*o;if(n.length){for(var l,c=-1,d=0;d<n.length&&n[d].top<s;d++)c=d;-1==c&&n[0]&&(c=0),l=n[c].header,i=c<n.length-1?n[c+1].top:r}else i=r;e.sectionname.html(l?l.find(".header").text():"");var u=Math.round(a*Math.min(s/r,1))+"px";e.progress.stop().css("width",u);var h=Math.round(a*Math.min(i/r,1))+"px";t!==h&&(e.buffer.stop().animate({width:h},200),t=h);var f=e.meta.find("ul li.current ul li").removeClass("completed");f.eq(c).add(f.eq(c).prevAll()).addClass("completed")},l=function(t,n){var i=n.getFan();return i?(i="w"==n.moveRight?n.moveCounter-1+"... "+i:n.moveCounter+". "+i,void e.lastMove.html(window.t("Last move")+": "+i+", "+("w"==n.moveRight?window.t("White to play"):window.t("Black to play"))).show()):void e.lastMove.hide()},c=function(t,n){var i=n.getCurrentPosition(),r=n.getMeta();if(r){var o;if(r.Title)o=r.Title;else{var a=r.White,s=a.Name&&"?"!==a.Name?a.Name:"",c=r.Black,d=c.Name&&"?"!==c.Name?c.Name:"",u=s&&d?" vs. ":"";o=s+u+d+(r.Result?" "+r.Result:"")}var h;if(r.Description)h=r.Description;else{var f=r.Site&&"?"!==r.Site?r.Site:r.Event&&"?"!==r.Event?r.Event:"",p=r.Date||"";p&&(p=p.replace(".??","").replace(".??","").replace("????","")),h=f+(f&&p?", ":"")+p}o||h?(e.banner.find(".title").html(o).attr("title",o),e.banner.find(".locationdate").html(h),e.ebookCurrentSection.show(),e.banner.show()):e.ebookCurrentSection.hide()}else e.ebookCurrentSection.hide();l(t,i),v.setCurrentGame(n)},d=function(t){for(var o=0;o<n.length;o++){var a=n[o].header.data("widget");if(a.vid==t||a.properties.uuid==t){var s=Math.min(Math.max(0,n[o].header.offset().top-e.scrollerContent.offset().top-10),r-i);e.scroller.stop().animate({scrollTop:s},200,"swing")}}};if(e.scrollerContent.height()>e.scroller.height()){e.ebook.find(".widgetcontainer.ebook-section").each(function(){var e=$(this);n.push({top:e.position().top,header:e})}),e.scroller.scroll(s),s();var u,h,f,p=$("<span/>").hide().appendTo(e.timeline).addClass("fp-timeline-tooltip cTooltipTop").on("mousemove",function(){e.timeline.trigger("mousemove")}),m=!1,g=function(t){u||(u=e.timeline.offset()),h||(h=e.timeline.width());var i;i=u.left>t.pageX?0:t.pageX>u.left+h?100:100*(t.pageX-u.left)/h;for(var a=r*i/100,s=-1,l=0;l<n.length&&n[l].top<a;l++)s=l;if(s!=f&&(-1==s&&n[0]&&(s=0),-1!=s&&p.attr("data-tooltip",n[s].header.find(".header").text()),f=s),m?e.progress.css("width",i+"%"):p.css("left",t.pageX-u.left+"px"),m){var c=e.progress.width()/(o*e.timeline.width());e.scroller.scrollTop(e.scroller.prop("scrollHeight")*c)}return t.preventDefault(),!1};e.timeline.on("mousedown",function(t){u=e.timeline.offset(),h=e.timeline.width(),m=!0,p.hide(),g(t),$(document).one("mouseup",function(){m=!1})}),e.timeline.on("mousemove",g),e.timeline.on("mouseover",function(e){m||p.show()}),e.timeline.on("mouseout",function(e){p.hide()})}var v,y=Widgets.Chess().chessBase,b=new View.ChessBoard(e.ebook.find(".ebookDiagram"),!0),w=new View.Cursor(e.ebook.find(".cursor")).addEventButtons();e.ebook.find(".cursor .chess-cursor").addClass("cursorView stylePlain");var k=e.ebook.find(".burgerMenu");layout.tooltipOnClick(k),k.find(".flipBoard").on("click",function(){b.flip()}),k.find(".settings").on("click",function(){(new Dialog.PlayzoneSettings).getContent().modal("show")}),k.find(".playPosition").on("click",function(){var e=v||new Chess.Game;new Dialog.Engine({fen:e.toString()})}),e.ebook.find(".chess-cursor .start").attr("title",window.t("Go to first move")),e.ebook.find(".chess-cursor .prev").attr("title",window.t("Go to previous move")),e.ebook.find(".chess-cursor .next").attr("title",window.t("Go to next move")),e.ebook.find(".chess-cursor .last").attr("title",window.t("Go to last move")),e.ebook.find(".chess-cursor .textPrev").attr("title",window.t("Go to previous move in text")),e.ebook.find(".chess-cursor .textNext").attr("title",window.t("Go to next move in text")),e.ebook.find(".flipBoard").attr("title",window.t("Flip board"));var x=y.getGames();for(var C in x)"object"==typeof x[C]&&(v||(v=new Chess.GameHandler),v.addGame(C,x[C]));v||b.link(new Chess.Game);var j=y.getViews(),T=[];for(var _ in j)if("object"==typeof j[_])for(var S=y.getControllersForView(_),I=0;I<S.length;I++)T.contains(S[I])||T.push(S[I]);T.length||(T=["main"]);for(var P,M,I=0;I<T.length;I++){var Q=y.getController(T[I]);Q&&(P||(P=Q.getCurrentGame(),M=Q),Q.on("movedPositionPointer",l),Q.on("currentGameChanged",c),
b.link(Q),w.link(Q))}P&&c({publisher:M},P);var B={},E=e.ebook.find(".jump-to-link"),O=null;if(E.length){for(var I=0;I<E.length;I++){var A=E.eq(I).data("widget"),D=A.resources[0].reference_id+"_"+A.properties.index;B[D]={previous:I>0?E.eq(I-1):void 0,next:I<E.length-1?E.eq(I+1):void 0}}$(document).on("chess24:nextlink",function(){if(!O)return void E.eq(0).trigger("click");var e=O.data("widget"),t=e.resources[0].reference_id+"_"+e.properties.index;B[t]&&B[t].next&&B[t].next.trigger("click")}),$(document).on("chess24:previouslink",function(){if(!O)return void E.eq(E.length-1).trigger("click");var e=O.data("widget"),t=e.resources[0].reference_id+"_"+e.properties.index;B[t]&&B[t].previous&&B[t].previous.trigger("click")}),E.on("highlight",function(){var t=$(this);e.ebook.find(".jump-to-link.highlight").removeClass("highlighted"),O=t.addClass("highlighted");var n,o=e.scroller.scrollTop(),a=o+i,s=t.offset().top-e.scrollerContent.offset().top,l=s+t.height();o>s-30?(n=Math.max(0,s-30),e.scroller.stop().animate({scrollTop:n},200,"swing")):l+30>a&&(n=Math.min(r-i,s+30-i),e.scroller.stop().animate({scrollTop:n},200,"swing"))})}else e.ebook.find(".ebookCurrentSection").remove();v&&(E.eq(0).trigger("click"),v.getCurrentGame().gotoStart());var H=e.meta.find(".videosList > ul > li.subExercises").each(function(){var t=$(this),i=t.hasClass("current");if(i&&n){var r=new RegExp(window.location.origin+window.location.pathname+"#section-","g");e.ebook.find("a").filter(function(){return this.href.match(r)}).on("click",function(){var e=this.href.replace(/.*section-(.+)?$/,"$1");return d(e),!1})}t.on("click",function(){H.removeClass("open"),t.addClass("open")}),t.find("> h3 > a").on("click",function(){return t.hasClass("open")?!i:(H.removeClass("open"),t.addClass("open"),!1)}),i&&n&&t.find("ul a").on("click",function(){var e=this.href.replace(/.*section-(\d+)(\D.*)?$/,"$1");return d(e),!1})});if(v){e.meta.find("#capturedPiecesContainer").capturedPieces({chessGameHandler:v});var N=new View.ChessDBMovesWithSelector(e.meta.find("#databaseMovesTable")).link(v),L=new View.ChessDBGames(e.meta.find("#databaseGamesTable"),N).link(v);new View.EngineGroup("#videoEngineContent").link(v),e.meta.find("#videoTabDatabaseMoves").suspendResume(N),e.meta.find("#videoTabDatabaseGames").suspendResume(L)}else e.meta.find("[data-tab-content-id=videoTabDatabaseMoves]").parent().remove(),e.meta.find("[data-tab-content-id=videoTabDatabaseGames]").parent().remove(),e.meta.find("[data-tab-content-id=videoTabEngine]").parent().remove(),e.meta.find("#videoTabDatabaseMoves").remove(),e.meta.find("#videoTabEngine").remove(),e.meta.find("#videoTabDatabaseGames").remove();var G=new Handler.Template("videoSeries"),R=[],V=[],F=e.ebook.find(".widgetcontainer.ebook-exercise");if(F.each(function(e){var t=$(this),n=t.data("exercises"),i={groupIndex:e,number:e+1,exercises:[]};if(n){V.push(n);for(var r=0;r<n.length;r++)i.exercises.push({exerciseIndex:r})}R.push(i)}),V.length>0){e.meta.find("#exercisesTab").html(G.render("exerciseGroups",{noVideo:!0,groupsInfo:R})).find(".exerciseGroupTabButton").on("click",function(){var t=$(this);t.hasClass("disabled")||e.meta.find(".exerciseGroup"+t.data("group-index")).trigger("chess24:show"),$("body,html").animate({scrollTop:e.meta.offset().top-200})});var z=e.scrollerContent.height();F.each(function(t){var n=$(this),i=$(G.render("exerciseKnobOnVideo")).css("left",100*Math.min(1,n.position().top/z)+"%").addClass("preventSelection").appendTo(e.timeline);i.css("left",parseInt(i.css("left"))-i.width()/2);var r=e.meta.find(".exerciseGroupContent.exerciseGroup"+t).addClass("exercises-from-"+n.data("widget").vid).on("chess24:show",function(n,i){i&&(e.meta.find("#exerciseTabBtn").trigger("click"),$("body,html").animate({scrollTop:e.meta.offset().top-200},200,"swing")),e.meta.find(".exerciseGroupTabButton").removeClass("open").filter(".tabBtn"+t).addClass("open"),e.meta.find(".exerciseGroupContent").hide().filter(".exerciseGroup"+t).show()});new View.VideoExercises.exerciseGroup(V[t],r,"",i,e.meta.find(".exerciseGroupTabButton.tabBtn"+t).removeClass("disabled"),function(){})}),e.meta.find(".exerciseGroup0").trigger("chess24:show")}else e.meta.find("[data-tab-content-id=videoTabExercises]").parent().remove(),e.meta.find("#videoTabExercises").remove();if(window.location.hash){var U=window.location.hash.replace(/.*section-(\d+)(\D.*)?$/,"$1");$("body,html").get(0).scrollTop=0,parseInt(U,10)&&d(U)}else e.scroller.stop(),e.scroller.attr("scrollTop",0)}))}),jQuery(document).on("ready",function(){var e=jQuery("#search-glossary");if(e.length){e.on("chess24:select",function(e){window.location=jQuery(this).data("submit-url")+"#word-"+this.value});var t=jQuery(".glossaryLetters");if(0!==t.length){var n=jQuery(".pageHeader").height(),i=t.clone(!0).addClass("detached").css({left:t.offset().left+"px",top:n+"px",width:t.width()+"px"}).hide().insertAfter(t),r=t.offset().top,o=!1,a={};jQuery(".glossaryList h2 a").each(function(){var e=this.name;a[e]=jQuery(this).offset().top}),jQuery(window).on("scroll",function(){var e=jQuery(document).scrollTop();!o&&e+n>r?(o=!0,i.show()):o&&r>e+n&&(o=!1,i.hide());var s;for(var l in a)e+20>=a[l]&&(!s||s&&a[l]>a[s])&&(s=l);t.find("a").add(i.find("a")).removeClass("current"),s&&t.find('a[data-letter="'+s+'"]').add(i.find('a[data-letter="'+s+'"]')).addClass("current")}),jQuery(".glossaryLetters").on("change keyup chess24:select","input.suggestField",function(e){var t=jQuery(this);setTimeout(function(){jQuery(".glossaryLetters input.suggestField").not(t).val(t.val())},1)}),jQuery(".glossaryLetters").on("chess24:select","input",function(e){var t=jQuery(this).next().find("input");setTimeout(function(){jQuery(".glossaryLetters input.suggestField").not(t).val(t.val())},1)})}}}),jQuery(document).on("ready chess24:lazyloaddone",function(){var e="active",t=jQuery(".likeContainer");if(t.length){var n="/api/web/likeAPI/",i={csrf:config.csrf()};t.each(function(){var r=jQuery(this),o=r.find(".like"),a=r.find(".unlike");config.level().isGuest||o.add(a).off("click.like").on("click.like",function(){var o=jQuery(this),s=r.data("uuid"),l=o.is("."+e)?"revoke":"add",c=o.is(".like")?1:-1,d=Object.merge(i,{uuid:s,type:r.data("type"),value:c});jQuery.post(n+l,d,function(n){t.filter('[data-uuid="'+s+'"]').find(".like").toggleClass(e,1==n.data.summary.user).find("span").html(n.data.summary.likes),a.length&&t.filter('[data-uuid="'+s+'"]').find(".unlike").toggleClass(e,-1==n.data.summary.user).find("span").html(n.data.summary.unlikes)})})})}}),jQuery(function(){jQuery(".imagesWidget").each(function(){var e=jQuery(this),t=e.find("a");t.each(function(){var e=jQuery(this),t=e.find("img");e.css("background-image","url("+t.attr("src")+")"),t.remove()}),t.not(t.first()).hide(),function n(){jQuery(t[0]).stop().css("opacity",1).animate({opacity:0},500,function(){jQuery(t[0]).hide().appendTo(e),t=e.find("a")}),jQuery(t[1]).stop().css("opacity",0).show().animate({opacity:1},500),setTimeout(n,5e3)}()})}),jQuery(function(){if(0!==jQuery(".bodyContainer.play_leaderboard").length){var e=new Handler.Template("playZone").append(new Handler.Template),t=0,n=0,i=0,r=20,o=function(a,s,l){var c=jQuery(".playzoneLeaderboard."+a+" .leaderboardList").addClass("loading");jQuery(".playzoneLeaderboard."+a+" .overview").css("top",0);var d=jQuery(e.render("leaderboard.list",{list:[{attributes:{title:{code:"GM"},staff:!0,premium:!0,moderator:!0,fraud:!0,cop:!0}}]})),u=d.find(".attributeTitle"),h=d.find(".attributeStaff").get(0).outerHTML,f=d.find(".attributeModerator").get(0).outerHTML,p=d.find(".attributeFraud").get(0).outerHTML,m=d.find(".attributeCop").get(0).outerHTML,g=d.find(".attributePremium").get(0).outerHTML;jQuery.getJSON("/api/web/playzoneAPI/leaderboard?type="+a+(l&&l!==!0?"&locate="+l:"&page="+s),function(l){"undefined"!=typeof l.data.page&&(s=l.data.page),"bullet"==a?t=s:"blitz"==a?n=s:i=s;for(var d="bullet"===a?t:"blitz"===a?n:i,v=d*r,y=0;y<l.data.table.length;y++)l.data.table[y].nick=l.data.table[y].nick.ellipsis({pixels:127,css:{"font-style":"italic","font-size":"12px"},append:(l.data.table[y].attributes.title?u.find("span").html(l.data.table[y].attributes.title.code).end().get(0).outerHTML:"")+(l.data.table[y].attributes.staff?h:"")+(l.data.table[y].attributes.moderator?f:"")+(l.data.table[y].attributes.fraud?p:"")+(l.data.table[y].attributes.cop?m:"")+(l.data.table[y].attributes.premium?g:"")}),l.data.table[y].i=v+y+1,l.data.table[y].change_class=l.data.table[y].elo_change_period>0?"positive":l.data.table[y].elo_change_period<0?"negative":"neutral";var b=e.render("leaderboard.list",{list:l.data.table});c.removeClass("loading").html(b),jQuery(document).trigger("newhtml"),jQuery(".playzoneLeaderboard."+a+" .nativeScroll").trigger("scroll");var w=jQuery(".playzoneLeaderboard."+a+" .cPagination");w.find("li").not(".goFirst,.goPrev,.goNext,.goLast").remove(),l.data.pages>0?(jQuery("<a/>").html(window.t("{current} of {all}",{"{current}":d+1,"{all}":l.data.pages})).addClass("active").appendTo(jQuery("<li/>").insertBefore(w.find(".goNext"))),d>0?(w.find(".goFirst").removeClass("inactive").find("a").off("click").on("click",function(){o(a,0,!0)}),w.find(".goPrev").removeClass("inactive").find("a").off("click").on("click",function(){o(a,d-1,!0)})):w.find(".goFirst, .goPrev").addClass("inactive").find("a").off("click"),d<l.data.pages-1?(w.find(".goLast").removeClass("inactive").find("a").off("click").on("click",function(){o(a,l.data.pages-1,!0)}),w.find(".goNext").removeClass("inactive").find("a").off("click").on("click",function(){o(a,d+1,!0)})):w.find(".goLast, .goNext").addClass("inactive").find("a").off("click"),w.show()):w.hide(),c.find("ul li").on("click",function(){var e,t=jQuery(this),n=(t.prevAll("li").length,c.closest(".nativeScroll")),i=t.position().top,r=parseInt(c.parent().css("top"),10)||0;e=0>r+i?Math.max(0,i-10):r+i+t.height()>n.height()?Math.max(0,Math.min(c.height()-n.height(),r+i+t.height()-n.height()+10)):-r,void 0!==e&&e!=-r&&c.parent().animate({top:"-"+e+"px"},200,function(){})}),void 0!==l.data.locate&&null!==l.data.locate&&(c.find(".selected").removeClass("selected"),c.find("ul li:eq("+l.data.locate+")").addClass("selected")),jQuery(document).trigger("newhtml")}).error(function(){c.removeClass("loading")})};o("bullet",0),o("blitz",0),o("classic",0),jQuery(".playzoneLeaderboard.bullet [data-auto-suggest]").on("chess24:select",function(){this.value&&o("bullet",0,this.value)}),jQuery(".playzoneLeaderboard.blitz [data-auto-suggest]").on("chess24:select",function(){this.value&&o("blitz",0,this.value)}),jQuery(".playzoneLeaderboard.classic [data-auto-suggest]").on("chess24:select",function(){this.value&&o("classic",0,this.value)}),jQuery(".playzoneLeaderboard.bullet a.me").on("click",function(){return jQuery(this).is(".cBtnInactive")?!1:void o("bullet",0,"me")}),jQuery(".playzoneLeaderboard.blitz a.me").on("click",function(){return jQuery(this).is(".cBtnInactive")?!1:void o("blitz",0,"me")}),jQuery(".playzoneLeaderboard.classic a.me").on("click",function(){return jQuery(this).is(".cBtnInactive")?!1:void o("classic",0,"me")})}}),jQuery(function(){function e(e,t){var n=Handler.socket.getSocket(Handler.socket.types.NOTIFICATION),i="model:PlayzoneTournamentRedisAR",r=i+":"+e,o={type:i,id:e,rkey:r},a=new Record.TournamentSocketPR(o,n,function(){t(a)})}if(0!==jQuery(".bodyContainer.play_lobby, .bodyContainer.play_index, .bodyContainer.play_playnow").length){var t=Controller.getPlayZone();new View.PlayShortcuts(jQuery(".playVsHumans .opponentSelector"),!0).link(notificationHandler),jQuery(".playVsEngines .opponentSelector a").on("click",function(){var e=jQuery(this).data("engine");t.playNow(function(){Dialog.playZone.playNow().showEngine(e).start()})});var n=jQuery(".nextTournament"),i=n.data("id");if(i){var r=new Controller.BroadcastTournament;new Controller.Broadcast(n,{norender:!0}),e(i,function(e){r.add(e,i);var t=n.find("h3"),o=n.find(".standings"),a=n.find(".playzoneTournamentTime"),s=n.find(".playzoneTournamentHeader"),l=n.find(".enrollButton"),c=[];c.push(new View.OpenStandings(o,i)),c.push(new View.TournamentTime(a,i)),c.push(new View.EnrollButton(l,i)),c.push(new View.TournamentAttribute(t,i,{attribute:"titles",action:"content"})),c.push(new View.Header(s,i)),c.push(new View.TournamentAttribute(s,i,{attribute:"status",action:"classname",predicate:function(){var e=r.getAttribute(i,"status");return s.removeClass("stateRunning statePending"),"running"==e?"stateRunning":"statePending"}})),c.forEach(function(e){e.link&&e.link(r),e.resume&&e.resume()})})}var o=jQuery(".lobbyCounters .onlineUsers .counterNumber"),a=jQuery(".lobbyCounters .onlineGames .counterNumber");new View.OnlineUserCount(o,o.data("count")).link(notificationHandler),new View.RunningGamesCount(a).link(notificationHandler);var s=jQuery(".topPlayers"),l=s.find(".playzoneStreamGameTypes li"),c=s.find(".topPlayersContent");new View.TopActivePlayers(c,l).link(notificationHandler),jQuery(".playBtn").on("click",function(){var e=jQuery(this).hasClass("engine");t.playNow(function(){e&&Dialog.playZone.playNow().showEngine()})})}}),jQuery(function(){function e(e,t){e.modal({destroyOnClose:!0,alignX:jQuery(".contentContainer"),close:!0}).modal("show"),e.find("li.gameShare").shareButtons({url:t,noIcon:!0,facebook:!0,twitter:jQuery('meta[property="og:title"]').attr("content")||!0,google:!0,mail:!1,embed:!1}),e.find(".gameNew a").on("click",function(){e.modal("hide"),Controller.getPlayZone().playNow()})}var t=jQuery("#tabAchievements");t.length&&(jQuery(".popupBadgeDialog").length&&e(jQuery(".popupBadgeDialog"),window.location.href),jQuery("#tabAchievements").one("chess24:show",function(){var t=jQuery(this);t.find(".badgeLink").on("click",function(){var t=jQuery(this);return jQuery.getJSON("/api/web/UserAPI/badge?uuid="+jQuery(this).data("award"),function(n){var i=new Handler.Template,r=jQuery(i.render("badgeDialog",n.data));e(r,t.attr("href"))}),!1})}))}),jQuery(function(){function e(e){e.find(".pinboardChessGame").add(e.filter(".pinboardChessGame")).each(function(){t(this)}),e.find(".pinboardItem").each(function(){var e=jQuery(this);e.find(".date.formatTimeAgo").showAge()}),config.level().isPremium||e.find(".cIconEngine").removeAttr("href").on("click",function(){return new Dialog.conversionGoPremium("analysisMode"),!1});for(var n=e.find(".ofMiniProfile"),i=jQuery(),r=n.length-1;r>=0;r--){var o=n.eq(r);if(o.data("initializedMiniprofile"))break;i=i.add(o)}i.length&&i.addMiniprofile()}function t(e){var t=jQuery(e),n=t.data("game"),i=t.data("role");"object"!=typeof n&&(n=jQuery.parseJSON(n));var r=new Chess.GameHandler,o=new View.ChessBoard(t.find(".chessBoardView")).link(r);o.movementHandler.setPremove(!1),"black"===i&&o.flip(),new View.Cursor(t.find(".cursorView")).link(r),new View.FloatingNotation(t.find(".floatingNotationView")).link(r),Chess.couchToGame(n).setMoveMode({afterGame:{mainline:!0,sideline:!0}}).link(r),t.attr("data-game","").attr("data-role","").data("game","").data("role","");var a=t.find(".pinboardEntrySocialBar");a.find(".pinboardEntrySocialNetwork").shareButtons({url:t.find(".pinboardEntryView a.gameUrl").attr("href"),facebook:!0,twitter:t.find(".textContainer p").text(),google:!0,mail:!1,embed:!1}),a.find(".cIconGamesList").on("click",function(){jQuery('a[data-tab-content-id="tabRating"]').trigger("click")}),config.level().isPremium?a.find(".cIconPgn").on("click",function(){return Handler.tracking("pgn","pinboard"),!0}):a.find(".cIconPgn").removeAttr("href").on("click",function(){Handler.tracking("pgn","pinboardConversion"),Dialog.conversionGoPremium("pgnDownload")})}var n=jQuery("#tabPinboard");n.length&&jQuery("#tabPinboard .tabContentInsider").one("chess24:show",function(){e(n);var t=jQuery((new Handler.Template).render("commonLoader")),i=n.find(".pinboardEntry").length,r=n.find("#pinboard-container");r.lazyload({url:r.data("url"),offset:i,selector:".pinboardEntry",onload:function(n){t.detach(),e(jQuery(n.data.html).appendTo("#pinboard-container"))},onstart:function(){n.append(t)}})})}),jQuery(function(){function e(){function n(e){var n=u.val()||7;y=Math.max(y,a(b,n)),w=y==a(l(),n);var i=v.replace("{{days}}",n).replace("{{start}}",y);jQuery.getJSON(i,function(n){t.find(".dateLegend").html(n.data.startDate+" - "+n.data.endDate),d.lineChart({}).lineChart("reset");for(var i in n.data.start)n.data[i].start=n.data.start[i];d.lineChart("path","classical",n.data.classical,"#3f9e00",!1),d.lineChart("path","bullet",n.data.bullet,"#009fe3",!1),d.lineChart("path","blitz",n.data.blitz,"#2d0367",!1),d.lineChart("path","trainerClassic",n.data.trainerClassic,"#b84d23",!1),d.lineChart("path","trainerSpeed",n.data.trainerSpeed,"#004b9e"),"function"==typeof e&&e()}),k=!1}function i(e){var t=v.replace("{{days}}",1).replace("{{start}}",e);jQuery.getJSON(t,function(e){d.lineChart("reset");for(var t in e.data.start)e.data[t].start=e.data.start[t];for(var n in e.data)for(var i=0;i<e.data[n].length;i++){var r=new Date(1e3*e.data[n][i][2]);e.data[n][i][1]=r.toLocaleTimeString().substr(0,5)}d.lineChart("path","classical",e.data.classical,void 0,!1),d.lineChart("path","bullet",e.data.bullet,void 0,!1),d.lineChart("path","blitz",e.data.blitz,void 0,!1),d.lineChart("path","trainerClassic",e.data.trainerClassic,void 0,!1),d.lineChart("path","trainerSpeed",e.data.trainerSpeed)}),h.css("display","inline-block"),k=!0}function r(){jQuery(document).trigger("newhtml"),config.level().isPremium?(jQuery("#rating-container").on("click",".cIconPgn",function(){return Handler.tracking("pgn","rating"),!0}),jQuery("#rating-container").on("click",".cIconEngine",function(){return Handler.tracking("engine","rating"),!0})):(jQuery("#rating-container").on("click",".cIconPgn",function(){return Handler.tracking("pgn","ratingConversion"),Dialog.conversionGoPremium("pgnDownload"),!1}),jQuery("#rating-container").on("click",".cIconEngine",function(){return Handler.tracking("engine","ratingConversion"),Dialog.conversionGoPremium("analysisMode"),!1}));var e=jQuery("#rating-container .customTabs section");e.filter("#ratingTableClassical").lazyload({url:"/api/web/userAPI/tabledata?table=classical&uuid="+g+"&language="+config.language(),selector:"tr.game",onload:C}),e.filter("#ratingTableBlitz").lazyload({url:"/api/web/userAPI/tabledata?table=blitz&uuid="+g+"&language="+config.language(),selector:"tr.game",onload:C}),e.filter("#ratingTableBullet").lazyload({url:"/api/web/userAPI/tabledata?table=bullet&uuid="+g+"&language="+config.language(),selector:"tr.game",onload:C}),e.filter("#ratingTableTrainerClassic").lazyload({url:"/api/web/userAPI/tabledata?table=trainerClassic&uuid="+g+"&language="+config.language(),selector:"tr.session",onload:C}),e.filter("#ratingTableTrainerSpeed").lazyload({url:"/api/web/userAPI/tabledata?table=trainerSpeed&uuid="+g+"&language="+config.language(),selector:"tr.session",onload:C}),d.on("chartover",function(e,t){t.dot.removeClass("classical blitz bullet trainerClassic trainerSpeed").addClass("cTooltipBox position-top "+t.setname).append(x.html("<h2>"+t.value+"</h2><br/>"+t.label))}).on("chartclick",function(e,t){k||i(t.label)}),f.on("change",function(){var e=jQuery(this),t=e.is(":checked"),n=e.data("chart");n?(d.lineChart("toggle",n,t),f.filter("[name=all]").get(0).checked=f.filter("[data-chart]:checked").length==f.filter("[data-chart]").length):(f.not(this).each(function(){this.checked=t}),d.lineChart("toggle","classical bullet blitz trainerClassic trainerSpeed",t))}),u.on("change",function(){y=w?l():y,n()}),h.on("click",function(){h.hide(),n()}),p.find(".start").on("click",function(){y=b,n()}),p.find(".prev").on("click",function(){var e=u.val();7==e?y=o(y,-7):31==e?y=o(y,0,-1):91==e?y=o(y,0,-3):182==e?y=o(y,0,-6):365==e&&(y=o(y,0,0,-1)),b>y&&(y=b),n()}),p.find(".next").on("click",function(){var e=u.val();7==e?y=o(y,7):31==e?y=o(y,0,1):91==e?y=o(y,0,3):182==e?y=o(y,0,6):365==e&&(y=o(y,0,0,1)),y>l()&&(y=l()),n()}),p.find(".last").on("click",function(){y=l(),n()})}function o(e,t,n,i){t=t||0,n=n||0,i=i||0;var r=s(1e3*e),o=s(r.getFullYear()+i,r.getMonth()+n,r.getDate()+t,0,0,0);return(o.getTime()/1e3).toFixed()}function a(e,t){var n,i=new Date(1e3*e),r=864e5;if(7==t){var o=(i.getDay()||7)-1;n=new Date(i.getTime()-o*r),n=s(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0)}else if(31==t)n=new Date(i.getTime()-(i.getDate()-1)*r),n=s(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0);else if(91==t){var a=i.getMonth()-i.getMonth()%3;n=s(i.getFullYear(),a,1,0,0,0)}else if(182==t){var l=i.getMonth()-i.getMonth()%6;n=s(i.getFullYear(),l,1,0,0,0)}else n=365==t?s(i.getFullYear(),0,1,0,0,0):s();return n.getTime()/1e3}function s(e,t,n,i,r,o){var a;a="undefined"!=typeof e&&"undefined"!=typeof t&&"undefined"!=typeof n?new Date(e,t,n,i||0,r||0,o||0):"undefined"!=typeof e?new Date(e):new Date;var s=6e4*a.getTimezoneOffset();return new Date(a.getTime()-s)}function l(){return s().getTime()/1e3}function c(e){j.pieChart({className:"gameStatisticsPieChart",defaultColor:"colorLightGrey",data:[{value:T[e+".share.wins"],label:window.t("Won: {wins}%",{"{wins}":T[e+".share.wins"]}),color:"colorGreen"},{value:T[e+".share.losses"],label:window.t("Lost: {losses}%",{"{losses}":T[e+".share.losses"]}),color:"colorOrange"},{value:T[e+".share.draws"],label:window.t("Drawn: {draws}%",{"{draws}":T[e+".share.draws"]}),color:"colorNavyBlue"}]})}var d=t.find(".lineChart"),u=jQuery(".chartFilters select",t),h=t.find("a.return"),f=t.find(":checkbox"),p=t.find(".chess-cursor"),m=t.find(".statistics");if(!u.length)return void setTimeout(e,500);var g=jQuery(".userProfilePage").data("uuid"),v="/api/web/userAPI/chartdata?uuid="+g+"&days={{days}}&start={{start}}",y=Math.round(l()),b=d.data("chart-start")||0,w=!0,k=!1,x=jQuery("<span/>").addClass("cTooltipBoxContainer"),C=function(e){this.find("tbody").append(e.data.html),jQuery(document).trigger("newhtml")},j=jQuery("#rating-container .pieChart"),T=j.data("graph");j.removeAttr("data-graph"),jQuery(".gameTypeSelector select").on("change",function(){m.removeClass("all bullet blitz classic").addClass(this.value),c(this.value)}).trigger("change"),setTimeout(function(){n(r)},200),jQuery(".downloadPgn").on("click",function(){if(!config.level().isPremium)return void Dialog.conversionGoPremium("pgnDownload");var e=jQuery(".downloadPgnMonth").val(),t=jQuery(".userProfilePage").data("uuid");jQuery.getJSON("/api/web/UserAPI/requestPgn",{month:e,uuid:t}).done(function(){Dialog.alert({content:window.t("PGN download"),comment:window.t("You will receive an e-mail with the link to<br/>your file within next couple of minutes")})})})}var t=jQuery("#tabRating");t.length&&jQuery("#tabRating").one("chess24:show",function(){setTimeout(e,500)})}),jQuery(document).on("ready",function(){function e(){return t().get("hideFideTitlePromo")}function t(){return jQuery.initNamespaceStorage("common").localStorage}function n(){t().set("hideFideTitlePromo",!0),a.animate({opacity:0},function(){a.remove()})}if(jQuery(".bodyContainer.profile .customTabSettings").length){$("nav.sidebarMenu > ul > li.tellAfriendReferral > a").on("click",function(){$(".customTabPartner > a").trigger("click")}),$tabs=jQuery(".userProfileTabs"),$tabs.on("click",".playBtn",function(){Controller.getPlayZone().playNow()}),$tabs.on("click",".cBtnCompleteProfile",function(){$tabs.find('a[data-tab-content-id="tabSettings"]').trigger("click")}),jQuery(".bodyContainer.profile").on("click",".btnShowFriendsList",function(){$tabs.find('a[data-tab-content-id="tabFriends"]').trigger("click"),this.preventDefault=!0}),window.settings.attach(".setGroup",!0);var i=jQuery(".playzoneSettings");i.length&&new Dialog.PlayzoneSettings(i),window.settings.on("settings",function(e,t){var n=jQuery("span.cIcon."+t.name);n.length&&(n.removeClass("cIconPrivacyVisible cIconPrivacyOnlyFriends cIconPrivacyNotVisible").addClass(privacyIcons[t.value]),n.parent().attr("data-tooltip")&&n.parent().attr("data-tooltip",privacyText[t.value]))}),jQuery(".updateImg").addClass("uploadReady").find("input[type=file]").on("chess24:add",function(e,t){jQuery(".userDetails .userPic").addClass("uploadingImage")}).on("chess24:done chess24:cancel",function(e,t){jQuery(".userDetails .userPic").removeClass("uploadingImage")}).on("chess24:done",function(e,t){jQuery(".userDetails .userPic img").attr("src",t.result.data.reference_url),jQuery(".userMenu .userPic img").attr("src",t.result.data.reference_url)}),jQuery(".cancelUserSettings").click(function(e){jQuery(this).closest(".editValues").find("form").validatable("clear"),jQuery(this).closest(".editValues").hide().prev(".showValues").show(),e.preventDefault()}),jQuery(".editUserSettings").click(function(e){jQuery(this).closest(".showValues").hide().next(".cForm").show().find("select").selectBox("destroy").selectBox(),e.preventDefault()}),jQuery(".editValues form").on("submit",function(e){e.preventDefault()}),jQuery(".editValues input[type=text],.editValues input[type=password]").keyup(function(e){13==e.keyCode&&jQuery(this).closest(".editValues").find(".saveUserSettings").click()}),jQuery(".saveUserSettings").click(function(e){var t=jQuery(this);if(t.hasClass("cBtnIcon"))return void e.preventDefault();if(t.closest("form").validatable("clientvalidate")!==!1){var n="/api/web/userAPI/saveUserSettings",i=t.closest(".editValues").find("input,select").serializeArray();i.push({name:"lang",value:config.language()}),t.addClass("cBtnIcon cIconFileUploading"),jQuery.post(n,i,function(e,n){if(0===e.status&&e.data){if("geo_country_id"in e.data.attributes){var i=e.data.attributes.geo_country_iso2,r=jQuery('#UserSettingsForm_geo_country_id option[value="'+e.data.attributes.geo_country_id+'"]').text();e.data.attributes.geo_country='<span class="icoFlag flag-'+i+'"></span> '+r,e.data.attributes.geo_country_short='<span class="icoFlag flag-'+i+'"></span> '+r}else if("quote"in e.data.attributes){var o=jQuery("<div/>").html(e.data.attributes.quote).text(),a=jQuery(".userQuoteText");o?a.text(o):a.text(a.attr("default-text"));var s=o?window.t("Edit"):window.t("Add");jQuery(".btnAddEditQuote").text(s);var l=o?"":window.t("default");jQuery(".userQuoteText").removeClass("default").addClass(l)}else"website"in e.data.attributes&&(e.data.attributes.website='<a href="'+e.data.attributes.website+'" target="_blank">'+e.data.attributes.website.replace(/http:\/\/|https:\/\//g,"")+"</a>");jQuery.each(e.data.attributes,function(e,t){jQuery("[data-user-profile-attr="+e+"]").html(t)}),jQuery(".editValues input[type=password]").val(""),t.removeClass("cIconFileUploading").addClass("cIconOKwhite"),setTimeout(function(){t.removeClass("cBtnIcon cIconOKwhite").next(".cancelUserSettings").click()},2e3)}},"json").fail(function(e,n,i){try{var r=jQuery.parseJSON(e.responseText);1===r.status&&jQuery.each(r.errors,function(e,n){t.closest(".editValues").find("#UserSettingsForm_"+e).trigger("validatable:error",{name:"",errors:n})})}catch(o){}t.removeClass("cBtnIcon cIconFileUploading")})}});var r=jQuery(".tabMessagesContent");r.length&&new View.Conversation.Conversation(r),jQuery('a[data-tab-content-id="tabSettingsGame"]').on("click",function(){setTimeout(function(){jQuery("#tabSettingsGame select").selectBox("destroy").selectBox()},300)}),jQuery(".editAffiliateSettings").click(function(e){jQuery(this).closest(".partnerIdDisplay").hide().next(".editValues").show().find("select").selectBox("destroy").selectBox(),e.preventDefault()});var o=function(e){jQuery.each(e,function(e,t){switch(e){case"url":jQuery("#partnerUrl").attr("value",t);var n=jQuery(".textLink .arrow");n.each(function(){n.data("share-buttons",!1),n.html("")}),n.shareButtons({url:t,noLabel:!0,facebook:!0,twitter:!0,google:!0,mail:!1,embed:!1});break;case"link_text":jQuery("#refLinkText").text(t);break;case"link_banner_portrait":jQuery("#refLogoPortraitHTML").text(t);break;case"link_banner_landscape":jQuery("#refLogoLandscapeHTML").text(t);break;case"link_banner_portrait_special":jQuery("#refLogoPortraitSpecialHTML").text(t);break;case"link_banner_landscape_special":jQuery("#refLogoLandscapeSpecialHTML").text(t);break;case"iframe_playzone":jQuery("#embeddedPlayzoneHTML").text(t)}})};jQuery(".saveAffiliateSettings").click(function(e){var t=jQuery(this);if(t.hasClass("cBtnIcon"))return void e.preventDefault();if(t.closest("form").validatable("clientvalidate")!==!1){var n="/api/web/affiliateAPI/saveAffiliateSettings",i=t.closest(".editValues").find("input,select").serialize();t.addClass("cBtnIcon cIconFileUploading"),jQuery.post(n,i,function(e,n){0===e.status&&(jQuery.each(e.data.attributes,function(e,t){switch(e){case"code":jQuery("[data-affiliate-attr="+e+"]").html(t);break;case"links":o(t)}}),t.removeClass("cIconFileUploading").addClass("cIconOKwhite"),t.removeClass("cBtnIcon cIconOKwhite").next(".cancelAffiliateSettings").click())}).fail(function(e,n,i){try{var r=jQuery.parseJSON(e.responseText);1===r.status&&jQuery.each(r.errors,function(e,n){t.closest(".editValues").find("#Affiliate_"+e).trigger("validatable:error",{name:"",errors:n})})}catch(o){}t.removeClass("cBtnIcon cIconFileUploading")})}}),jQuery(".registerAffiliate").click(function(e){var t=jQuery(this);if(t.hasClass("cBtnIcon"))return void e.preventDefault();var n="/api/web/affiliateAPI/registerPartner";t.addClass("cBtnIcon cIconFileUploading");var i={csrf:config.csrf()};jQuery.post(n,i,function(e,n){0===e.status&&(t.removeClass("cIconFileUploading"),jQuery(".partnerUnregistered").hide().next().show(),jQuery.each(e.data.attributes,function(e,t){switch(e){case"code":jQuery("#Affiliate_code").attr("value",t),jQuery("[data-affiliate-attr="+e+"]").html(t);break;case"since":jQuery(".partnerSinceDate").text(t);break;case"links":o(t)}}))}).fail(function(e,n,i){try{jQuery.parseJSON(e.responseText)}catch(r){}t.removeClass("cBtnIcon cIconFileUploading")})}),jQuery(".cancelAffiliateSettings").click(function(e){jQuery(this).closest(".editValues").find("form").validatable("clear"),jQuery(this).closest(".editValues").hide().prev(".partnerIdDisplay").show(),e.preventDefault()}),jQuery(".btnCopyRefLinkText").click(function(e){var t=jQuery("#refLinkText").text(),n='<a href="'+t+'">chess24.com your playground</a>';e.preventDefault();var i=jQuery("<div/>").addClass("popupInsider").append(jQuery("<div/>").addClass("dialogContent").html('<textarea rows="5" class="cPattern" style="width: 400px;">'+n+'</textarea><br class="clear"/>')).append(jQuery("<div/>").addClass("dialogFooter"));i.modal({classes:"defaultPopup inlineBtnCloseDialog",close:!0,destroyOnClose:!0}).modal("show"),i.find("textarea").select();var r=$("<textarea>");$("body").append(r),r.val(t).select(),document.execCommand("copy"),r.remove()}),jQuery(".btnCopyEmbeddedPlayzone").click(function(e){var t=jQuery("#embeddedPlayzoneHTML").text();e.preventDefault();var n=jQuery("<div/>").addClass("popupInsider").append(jQuery("<div/>").addClass("dialogContent").html('<textarea rows="5" class="cPattern" style="width: 400px;">'+t+'</textarea><br class="clear"/>')).append(jQuery("<div/>").addClass("dialogFooter"));n.modal({classes:"defaultPopup inlineBtnCloseDialog",close:!0,destroyOnClose:!0}).modal("show"),n.find("textarea").select()}),jQuery(".btnCopyBannerPortrait").click(function(e){var t=jQuery("#refLogoPortraitHTML").text();e.preventDefault();var n=jQuery("<div/>").addClass("popupInsider").append(jQuery("<div/>").addClass("dialogContent").html('<textarea rows="5" class="cPattern" style="width: 400px;">'+t+'</textarea><br class="clear"/>')).append(jQuery("<div/>").addClass("dialogFooter"));n.modal({classes:"defaultPopup inlineBtnCloseDialog",close:!0,destroyOnClose:!0}).modal("show"),n.find("textarea").select()}),jQuery(".btnCopyBannerLandscape").click(function(e){var t=jQuery("#refLogoLandscapeHTML").text();e.preventDefault();var n=jQuery("<div/>").addClass("popupInsider").append(jQuery("<div/>").addClass("dialogContent").html('<textarea rows="5" class="cPattern" style="width: 400px;">'+t+'</textarea><br class="clear"/>')).append(jQuery("<div/>").addClass("dialogFooter"));n.modal({classes:"defaultPopup inlineBtnCloseDialog",close:!0,destroyOnClose:!0
}).modal("show"),n.find("textarea").select()}),jQuery(".shareLinkWithFriends").shareButtons({url:jQuery("#partnerUrl").attr("value"),noLabel:!0,facebook:!0,twitter:!0,google:!0,mail:!1,embed:!1}),jQuery(".btnPreviewEmbeddedPlayzone").click(function(e){e.preventDefault();var t=$("<div/>").addClass("popupInsider").append($("<div/>").addClass("dialogContent").attr("style","width:480;height:96;").append($("<p>").text("embedded playzone")).append($("<div>").html(jQuery("#embeddedPlayzoneHTML").attr("preview-data"))).append($("<input>").attr("style","left: 0;bottom: 0;opacity: 0;position: absolute;"))).append($("<div/>").addClass("dialogFooter"));t.modal({classes:"defaultPopup",close:!0,destroyOnClose:!0}).modal("show"),t.find("input").select(),setTimeout(function(){jQuery(window).trigger("resize")},100)}),jQuery(".btnPreviewBannerPortrait").click(function(e){e.preventDefault();var t=$("<div/>").addClass("popupInsider").append($("<div/>").addClass("dialogContent").append($("<p>").text($("#wideScyscraperBanner").text().trim()+" 160 x 620")).append($("<img>").attr("src",config.assetDir()+"/images/partner/skyscraper.png").attr("style","width:144px;height:558px").load(function(){setTimeout(function(){jQuery(window).trigger("resize")},100)})).append($("<input>").attr("style","left: 0;bottom: 0;opacity: 0;position: absolute;"))).append($("<div/>").addClass("dialogFooter"));t.modal({classes:"defaultPopup",close:!0,destroyOnClose:!0}).modal("show"),t.find("input").select()}),jQuery(".btnPreviewBannerLandscape").click(function(e){e.preventDefault();var t=$("<div/>").addClass("popupInsider").append($("<div/>").addClass("dialogContent").attr("style","width:480;height:96;").append($("<p>").text($("#fullBanner").text().trim()+" 480 x 60")).append($("<img>").attr("src",config.assetDir()+"/images/partner/wide.png").load(function(){setTimeout(function(){jQuery(window).trigger("resize")},100)})).append($("<input>").attr("style","left: 0;bottom: 0;opacity: 0;position: absolute;"))).append($("<div/>").addClass("dialogFooter"));t.modal({classes:"defaultPopup",close:!0,destroyOnClose:!0}).modal("show"),t.find("input").select(),setTimeout(function(){jQuery(window).trigger("resize")},100)}),jQuery("#UserSettingsForm_quote").on("input",function(){var e=150,t=jQuery(this),n=t.val();n.length>e&&(n=n.substr(0,e),t.val(n));var i=e-n.length;jQuery("#quoteCharsLeft").text(i)});var a=jQuery(".fideTitlePromo");a&&(e()?a.remove():a.css("opacity",0).show().animate({opacity:1}),a.find("a.yes").on("click",function(){jQuery('a[data-tab-content-id="tabSettings"]').trigger("click"),setTimeout(function(){jQuery("#tabSettingsGeneral .editUserSettings:first").trigger("click")},1e3),n()}),a.find("a.no").on("click",n)),jQuery("#tabSettingsBlockedUsers").one("chess24:show",function(){var e=jQuery(".blockedUsers").lazyload({url:"/api/web/userAPI/getBlockedUsers",array:"users",onload:function(t){var n=new Handler.Template("friendship"),i=jQuery();t.data.users.forEach(function(e){i=i.add(jQuery(n.render("blockedUser",e)))}),e.append(i),layout.formatTimeAgo(i).userMiniprofile(i),i.find(".cBtn").on("click",function(){var e=jQuery(this);jQuery.post("/api/web/UserFriendAPI/UpdateFriendshipRelation",{csrf:config.csrf(),relationType:"Unblock",relatedUser:e.data("uuid")}).done(function(){e.closest("li").remove()})})}})})}}),jQuery(document).on("ready",function(){function e(e,t,i,r){n.removeClass("stats").addClass("loading"),jQuery.getJSON("/api/web/tacticTrainerAPI/summary?session="+e+"&puzzles=1",function(e){n.removeClass("loading"),jQuery(".tacticTrainerDashboard").hide();var o="classic"==t?TacticTrainer.ClassicServer:TacticTrainer.SpeedServer,a=new o(".tacticTrainerRoot");if(a.showSummary(e.data.summary,r),i)for(var s=0;s<e.data.summary.puzzles.length;s++)if(e.data.summary.puzzles[s].id==i){setTimeout(function(){a.summaryDetails(e.data.summary.puzzles[s])},1e3);break}})}var t=new Handler.Template("tacticTrainer").append(new Handler.Template),n=jQuery(".tacticTrainer .contentContainerInsider");if(n.length){var i=n.find(".tacticTrainerRoot").data("session");if(i){var r=(window.location.hash||"").replace("#","");e(i.id,i.type,r,!0)}jQuery(".tacticTrainerDashboard").length&&(jQuery(".cBtn.classic").on("click",function(){jQuery(".tacticTrainerDashboard").hide();var e=new TacticTrainer.ClassicServer(".tacticTrainerRoot");return e.start(),!1}),jQuery(".cBtn.speed").on("click",function(){jQuery(".tacticTrainerDashboard").hide();var e=new TacticTrainer.SpeedServer(".tacticTrainerRoot",{time:60*window.settings.getNumber("tactics-length")});return e.start(),!1}),window.settings.attach(".tacticTrainerDashboard"));var o=!1,a=function(i){var r=n.find(".tacticStats");return o?void r.find('.tabNav a[data-tab-content-id="stats-'+i+'"]').trigger("click"):(n.addClass("loading"),void jQuery.getJSON("/api/web/TacticTrainerAPI/sessions",function(a){if(n.removeClass("loading"),0===a.status){var s=t.render("tactics-stats",a.data);r.find(".tacticStatsRoot").html(s),r.find(".tabNav li.current").removeClass("current"),r.find('.tabNav a[data-tab-content-id="stats-'+i+'"]').closest("li").addClass("current"),jQuery(document).trigger("newhtml");var l=r.find("table.items tbody tr");l.on("click",function(){var t=jQuery(this),n=t.data("id");n&&e(n,t.closest("#stats-classic").length?"classic":"speed")}),jQuery.getJSON("/api/web/TacticTrainerAPI/chartdata",function(e){if(0===e.status){var t,n,i={classic:r.find("#stats-classic .lineChart").lineChart({loading:!0}),speed:r.find("#stats-speed .lineChart").lineChart({loading:!0})},o=jQuery("<span/>").addClass("cTooltipBoxContainer");r.find(".lineChart").each(function(){var i=jQuery(this),r=i.closest("#stats-speed").length?"speed":"classic";"classic"==r?t="rating":n="rating",i.lineChart("path",e.data[r].rating).on("chartover",function(e,t){t.dot.addClass("cTooltipBox position-top").append(o.html("<h2>"+t.value+"</h2>"+t.label))})}),r.find(".cPagination a").on("click",function(){var r=jQuery(this),o=r.closest("#stats-classic").length?"classic":"speed",a=r.data("sort");r.closest("ul").find("a").removeClass("active"),r.addClass("active"),i[o].lineChart("path",e.data[o][a]),"classic"==o?t=a:n=a}),r.find("[data-tab-content-id=stats-classic]").on("click",function(){t&&setTimeout(function(){i.classic.lineChart("path",e.data.classic[t])},300)}),r.find("[data-tab-content-id=stats-speed]").on("click",function(){n&&setTimeout(function(){i.speed.lineChart("path",e.data.speed[n])},300)})}}),o=!0}}))};if(n.on("click",".tacticTrainerClassic a.cBtn.stats, a.statsClassic",function(){n.addClass("stats"),a("classic")}),n.on("click",".tacticTrainerSpeed a.cBtn.stats, a.statsSpeed",function(){n.addClass("stats"),a("speed")}),jQuery(".leaderboard.classic").length){var s=0,l=0,c=50,d=function(e,n,i,r){var o=jQuery(".leaderboard."+e+" .leaderboardList").addClass("loading"),a=jQuery(".leaderboard."+e+" .nativeScroll"),u=jQuery(t.render("leaderboard-list",{list:[{attributes:{title:{code:"GM"},staff:!0,premium:!0,moderator:!0,fraud:!0,cop:!0}}]})),h=u.find(".attributeTitle"),f=u.find(".attributeStaff").get(0).outerHTML,p=u.find(".attributeModerator").get(0).outerHTML,m=u.find(".attributeFraud").get(0).outerHTML,g=u.find(".attributeCop").get(0).outerHTML,v=u.find(".attributePremium").get(0).outerHTML;jQuery.getJSON("/api/web/tacticTrainerAPI/leaderboard?type="+e+"&sort="+n+(r&&r!==!0?"&locate="+r:"&page="+i),function(u){"undefined"!=typeof u.data.page&&(i=u.data.page),"classic"==e?s=i:l=i;for(var y="classic"==e?s:l,b=y*c,w=0;w<u.data.table.length;w++)u.data.table[w].nick=u.data.table[w].nick.ellipsis({pixels:137,css:{"font-style":"italic","font-size":"14px"},append:(u.data.table[w].attributes.title?h.find("span").html(u.data.table[w].attributes.title.code).end().get(0).outerHTML:"")+(u.data.table[w].attributes.staff?f:"")+(u.data.table[w].attributes.moderator?p:"")+(u.data.table[w].attributes.fraud?m:"")+(u.data.table[w].attributes.cop?g:"")+(u.data.table[w].attributes.premium?v:"")}),u.data.table[w].i=b+w+1,u.data.table[w].item="ratio"==n?"%":"tempo"==n?" "+window.t("s/pos."):"";var k=t.render("leaderboard-list",{list:u.data.table});o.removeClass("loading").html(k),jQuery(document).trigger("newhtml");var x=jQuery(".leaderboard."+e+" .cPagination");x.find("li").not(".goFirst,.goPrev,.goNext,.goLast").remove(),u.data.pages>0?(jQuery("<a/>").html(window.t("{current} of {all}",{"{current}":y+1,"{all}":u.data.pages})).addClass("active").appendTo(jQuery("<li/>").insertBefore(x.find(".goNext"))),y>0?(x.find(".goFirst").removeClass("inactive").find("a").off("click").on("click",function(){d(e,n,0,!0)}),x.find(".goPrev").removeClass("inactive").find("a").off("click").on("click",function(){d(e,n,y-1,!0)})):x.find(".goFirst, .goPrev").addClass("inactive").find("a").off("click"),y<u.data.pages-1?(x.find(".goLast").removeClass("inactive").find("a").off("click").on("click",function(){d(e,n,u.data.pages-1,!0)}),x.find(".goNext").removeClass("inactive").find("a").off("click").on("click",function(){d(e,n,y+1,!0)})):x.find(".goLast, .goNext").addClass("inactive").find("a").off("click"),x.show()):x.hide(),o.find("ul li").on("click",function(){var i=jQuery(this);jQuery(".leaderboard.classic li.selected, .leaderboard.speed li.selected").removeClass("selected");var r=i.prevAll("li").length;i.addClass("selected");var s=t.render("leaderboard-profile",{profile:u.data.table[r]});jQuery(".leaderboardProfile").html(s).find("li.active").removeClass("active").end().find(".leaderboardResults."+e+" li."+n).addClass("active");var l,c=i.position().top,d=a.scrollTop();l=0>d+c?Math.max(0,c-10):d+c+i.height()>a.height()?Math.max(0,Math.min(o.height()-a.height(),d+c+i.height()-a.height()+10)):-d,void 0!==l&&l!=-d&&a.animate({scrollTop:l+"px"},200)}),r===!0?o.find("ul li:first").trigger("click"):"undefined"!=typeof u.data.locate&&o.find("ul li:eq("+u.data.locate+")").trigger("click"),jQuery(document).trigger("newhtml")}).error(function(){o.removeClass("loading")})};d("classic","rating",0,!0),d("speed","rating",0),jQuery(".leaderboard.classic select").on("change",function(){d("classic",this.value,0,!0)}),jQuery(".leaderboard.speed select").on("change",function(){d("speed",this.value,0,!0)}),jQuery(".leaderboard.classic [data-auto-suggest]").on("chess24:select",function(){d("classic",jQuery(".leaderboard.classic select").val(),0,this.value)}),jQuery(".leaderboard.speed [data-auto-suggest]").on("chess24:select",function(){d("speed",jQuery(".leaderboard.speed select").val(),0,this.value)}),jQuery(".leaderboard.classic a.me").on("click",function(){d("classic",jQuery(".leaderboard.classic select").val(),0,"me")}),jQuery(".leaderboard.speed a.me").on("click",function(){d("speed",jQuery(".leaderboard.speed select").val(),0,"me")})}n.on("click",".reportPuzzle",function(){var e=jQuery(this).data("puzzle-id");Dialog.userReport({source:"tactic-trainer",referenceId:e})})}}),jQuery(function(){jQuery(".bodyContainer").is(".tromso2014, .tromso2014Staticpage")&&(jQuery(".olympiad2014Faq li a, .olympiad2014Faq li h2").on("click",function(){jQuery(this).closest("li").toggleClass("open")}),jQuery(".olympiad2014Partners img").on("mouseenter",function(){var e=jQuery(this);e.data("backup",e.attr("src")),e.attr("src",e.data("src"))}).on("mouseleave",function(){var e=jQuery(this);e.attr("src",e.data("backup"))}))}),jQuery(function(){function e(e,t){t.find("img").attr("src",e.media),t.find("h2").html(e.title),t.find("h3").html(e.author+(e.authorTitle?" ("+e.authorTitle+")":""));var n=t.find("p a").detach().attr("href",e.url);t.find("p").html(e.description).append("&nbsp;").append(n),e.freeVideoUrl?t.find(".preview").attr("href",e.freeVideoUrl):t.find(".preview").hide(),t.find(".price").html(e.price),t.find(".buy").data("content-id",e.seriesId).addVideoSeriesPurchasePopUp(),t.find(".watch").attr("href",e.url),config.level().isPremium?t.find(".non-premium").remove():t.find(".premium").remove()}function t(e){var n=l.eq(e);n.length&&(n.prevAll(".seriesTeaser").each(function(t){jQuery(this).stop().animate({left:-(e-t)*o+"px"},200)}),n.nextAll(".seriesTeaser").each(function(e){jQuery(this).stop().animate({left:(e+1)*o+"px"},200)}),n.stop().animate({left:"0px"},200),d.find("a").removeClass("active").eq(e).addClass("active"),clearTimeout(a),a=setTimeout(function(){t(e+1<l.length?e+1:0)},s))}function n(){function e(e){var t=jQuery(e),n=window.location.href;n=n.replace(new RegExp(t.attr("name")+"=[^&]*"),"").replace("&&","&").replace(/&$/,"").replace(/\?&?$/,"").replace("?&","?"),t.val()&&(n+=(-1!=n.indexOf("?")?"&":"?")+t.attr("name")+"="+t.val()),jQuery(".fakeSearchLink").attr("href",n).trigger("click")}jQuery(document).on("keypress",".filterBar .cIconSearch .cInputText",function(t){13===t.which&&e(this)}).on("click",".filterBar .cIconSearch",function(t){var n=jQuery(this);n.width()-t.offsetX<24&&e(n.find(".cInputText"))})}var i=jQuery(".seriesTeasers");if(!i.length){var r=$("#listVideoSeriesId");return void(r.length>0&&n())}var o,a,s=7e3,l=jQuery(),c=i.find(".seriesTeaser"),d=i.find(".navigation");jQuery(".rangeSliderContainer").styleRangeSlider(),jQuery.getJSON("/api/web/advertisementAPI/getSeriesTeasers?language="+config.language()+"&level="+config.level().toString(),function(n){n.data.advertisements&&n.data.advertisements.length&&(i.show(),o=c.width(),c.detach(),n.data.advertisements.forEach(function(n,i){var r=c.clone().css("left",i*o+"px").show();e(n,r),l=l.add(r),d.append(jQuery("<a/>").on("click",function(){t(i)}))}),1==n.data.advertisements.length&&d.hide(),l.appendTo(".seriesTeasers"),t(0))}),n()}),"undefined"==typeof View&&(View={}),function(){var e={};View.NotationArea=function(t,n){function i(){return Array.prototype.concat.apply([],Object.values(f).map(Object.values))}function r(){t.html(h.render("main",{extensions:Object.map(f,function(e){return Object.keys(e)})}))}function o(e,n){return t.find(".extension-"+e+" .extension-item."+n)}function a(e,n){var i=o(e,n),r=f[e][n].getContent();if(i.length)return void i.replaceWith(r);var a=$(h.render("extensions.item",n));a.append(r),t.find(".extension-"+e).append(a),t.addClass("with-"+e)}function s(e,n){o(e,n).remove();var i=t.find(".extension-"+e);i.children().length||t.removeClass("with-"+e)}function l(t,n){var i=e[t].position;if(!f[i][t]){var r=new e[t].extension(n);f[i][t]=r,a(i,t),u&&r.link(u)}}function c(t){var n=e[t].position,i=f&&f[n]&&f[n][t];i&&(delete f[n][t],s(n,t),u&&i.unlink(u))}var d=this;t=jQuery(t),t.length||errorHandler.error(new Error("container not found in NotationArea"));var u,h=new Handler.Template("notationTable"),f={before:{},main:{},after:{},bottom:{}};n=n||"default";var p=View.NotationArea.ConfigSet[n];return Extend.Suspendable(d).onSuspend(function(){i().forEach(function(e){e.suspend&&e.suspend()})}).onResume(function(){i().forEach(function(e){e.resume&&e.resume()})}),Extend.Subscriber(d,{},{afterLink:function(e){u=e.publisher,i().forEach(function(t){t.link(e.publisher)})},afterUnlink:function(e){u=void 0,i().forEach(function(t){t.unlink(e.publisher)})}}),d.toggleExtension=function(e,t,n){return t?(l(e,n),d):(c(e),d)},d.setBlindfold=function(e){return i().forEach(function(t){t.setBlindfold&&t.setBlindfold(e)}),d},d.setUserCommentWritePermission=function(e){return i().forEach(function(t){t.setUserCommentWritePermission&&t.setUserCommentWritePermission(e)}),d},r(),Object.forEach(p,function(e,t){l(t,e)}),d},View.NotationArea.registerExtension=function(t,n,i){return e[t]={position:n,extension:i},View.NotationArea},View.NotationArea.ConfigSet={"default":{GameEnd:!0,Moves:!0},positionDetails:{GameEnd:!0,Moves:{time:!1}},tooltip:{Moves:{engine:!1,time:!1}},playing:{GameEnd:{score:!1},AfterGameControls:!0,PlayingVsGuest:!0,Moves:{engine:!1},PlayZoneChat:!0},broadcast:{Moves:{ms:!1}},videoDisplay:{GameEnd:!0,Moves:{time:!1}},analyse:{GameEnd:!0,Moves:!0,Comment:!0}}}(),jQuery(function(){notificationHandler.on("engine",function(e,t){t.content.source="Cloud",Handler.engine.set(e.channel.replace("engine.",""),Handler.engine.DETAILED_ENGINE_TYPE,t.content)});var e={};Handler.engine.setDataGetter(Handler.engine.DETAILED_ENGINE_TYPE,function(t){return e[t]?!0:(e[t]=!0,notificationHandler.subscribeRequest("engine."+t),!0)})}),"undefined"==typeof Dialog&&(Dialog={}),Dialog.AfterTheGame=function(e){function n(e){d.init(f,p);var n=e.gameSessionToken,C=config.user().authToken;h=new Handler.Playing(n,C),u=new Handler.Pairing;var P="ABORTED"===e.chessGame.getGameStatus().endedBy;P&&x.remove(),x.one("click.reMatch",function(){i(n,C)}),h.on("noReMatch",function(){r(n,C)}),d.on("hide",function(){r(n,C)}),h.on("reMatchOffered",o),u.off("initGameSession").on("initGameSession",function(e,t){d.close(),Controller.getPlayZone().initGameSession(t)}),j.one("click.newGame",a),_.shareButtons({url:e.url,noIcon:!0,facebook:!0,twitter:jQuery('meta[property="og:title"]').attr("content")||!0,google:!0,mail:!1,embed:!1}),e.tournamentUuid?s():T.remove();var M=e.chessGame,Q=M.getGameStatus(),B=config.assetDir()+"/images/img";"w"===e.role&&Q.result.white>Q.result.black||"b"===e.role&&Q.result.black>Q.result.white?(m.html(t("Congratulations you won!")),v.attr("src",B+"/smiley_win.png"),S.hide(),I.show()):Q.result.black===Q.result.white?(m.html(t("You can't win 'em all!")),v.attr("src",B+"/smiley_draw.png"),S.show(),I.hide()):(m.html(t("Bad luck, you lost!")),v.attr("src",B+"/smiley_loose.png"),S.show(),I.hide());var E,O,A,D,H,N,L,G,R,V="",F="",z=M.getType(),U=M.getMeta();if("w"===e.role?(E=U.Black.Name,O=U.Black.UUID,A=U.Black.Link,D=M.additionalInformation.scoreTotal.white,H=M.additionalInformation.scoreTotal.black,N=M.additionalInformation.eloNew.white,R=M.additionalInformation.badges.white,L=M.additionalInformation.eloNew.whiteChange,G=M.additionalInformation.lockedEngines.white):"b"===e.role&&(E=U.White.Name,O=U.White.UUID,A=U.White.Link,D=M.additionalInformation.scoreTotal.black,H=M.additionalInformation.scoreTotal.white,N=M.additionalInformation.eloNew.black,R=M.additionalInformation.badges.black,L=M.additionalInformation.eloNew.blackChange,G=M.additionalInformation.lockedEngines.black),R&&R.length){var W=[];jQuery.each(R,function(e,t){var n={};n.title=t.title[config.language()],n.image=t.image[config.language()],W.push(n)});var q=d.templates.render("dialogs.play.content.afterGameBadges",{badges:W,onlyOne:1===W.length,badgesCount:W.length});f.append(q)}var $="";0!==L?(0>L?(L=-1*L,$="down"):L>0&&($="up"),w.html(t('Your new "{elo_type}" rating is now:',{"{elo_type}":z})),k.html(Handler.Template.renderString('<strong><span>{{elo_new}}</span></strong> | <strong><span class="{{css_class}}">{{elo_change}}</span></strong>',{elo_new:N,elo_change:L,css_class:$}))):(w.html(t('Your "{elo_type}" rating remains unchanged and is:',{"{elo_type}":z,"{elo_new}":N})),k.html(Handler.Template.renderString('<strong class="singleValue"><span class="{{css_class}}">{{elo_new}}</span></strong>',{elo_new:N,css_class:$}))),g.html(l(M,E,O,A)),D%1>0&&(D=Math.floor(D),D=0===D?"":D,V="&#189;"),H%1>0&&(H=Math.floor(H),H=0===H?"":H,F="&#189;");var K=c({name:E,uuid:O,link:A});"ABORTED"!==Q.endedBy&&(y.html(t("Your total score against {opponent} is now:",{"{opponent}":K})),b.html(Handler.Template.renderString("<strong><span>{{&games_won}}</span></strong> : <strong><span>{{&games_won_opponent}}</span></strong>",{games_won:D+V,games_won_opponent:H+F})))}function i(e,n){P=!0,M||(x.removeClass("active").addClass("inactive"),C.html(t("Wait for your opponent to accept your re-match offer")).show()),u.reMatch({gameSessionToken:e,authToken:n}),h.reMatch({gameSessionToken:e,authToken:n})}function r(e,t){x.removeClass("active").addClass("inactive"),C.hide(),x.off("click.reMatch"),h.noReMatch({gameSessionToken:e,authToken:t})}function o(){M=!0,P||(x.removeClass("inactive").addClass("active"),C.show())}function a(){d.close(),Controller.getPlayZone().playNow()}function s(){var t=jQuery(d.templates.render("dialogs.play.content.afterTheGameInTournament")),n=new Controller.BroadcastTournament,i=n.getAttribute(e.tournamentUuid,"rounds"),r=n.getAttribute(e.tournamentUuid,"currentRound");r<Object.getLength(i)?(t.find(".gameComingUp").show(),t.find(".lastGame").hide(),window.settings.attach(t)):(t.find(".gameComingUp").hide(),t.find(".lastGame").show()),f.append(t)}function l(n,i,r,o){var a,s=n.getGameStatus(),l=n.getClockInformation(),d=c({name:i,uuid:r,link:o});if("w"===e.role&&s.result.white>s.result.black||"b"===e.role&&s.result.black>s.result.white)switch(s.endedBy){case"CHECKMATE":a=t("You checkmated {opponent}",{"{opponent}":d});break;case"RESIGN":a=t("{opponent} resigned",{"{opponent}":d});break;case"TOURNAMENT_NO_SHOW":a=t("{opponent} didn't start playing in time",{"{opponent}":d});break;case"CLOCKFLAG":a=t("{opponent} lost on time",{"{opponent}":d});break;case"DISCONNECT_TIMEOUT":a=t("{opponent} failed to reconnect on time",{"{opponent}":d})}else if("w"===e.role&&s.result.white<s.result.black||"b"===e.role&&s.result.black<s.result.white)switch(s.endedBy){case"CHECKMATE":a=t("{opponent} checkmated you",{"{opponent}":d});break;case"RESIGN":a=t("you resigned");break;case"TOURNAMENT_NO_SHOW":a=t("you didn't start playing in time");break;case"CLOCKFLAG":a=t("you lost on time");break;case"DISCONNECT_TIMEOUT":a=t("you failed to reconnect on time")}else if(void 0!==s.result.black&&void 0!==s.result.white&&s.result.black===s.result.white)switch(s.endedBy){case"CLOCKFLAG_VS_INSUFFICENT_MATERIAL":"w"===e.role&&l.white.flagDown===!0||"b"===e.role&&l.black.flagDown===!0?a=t("Draw as you ran out of time but {opponent} has insufficient material to mate",{"{opponent}":d}):("w"===e.role&&l.black.flagDown===!0||"b"===e.role&&l.white.flagDown===!0)&&(a=t("Draw as {opponent} ran out of time but you have insufficient material to mate",{"{opponent}":d}));break;case"DISCONNECT_VS_INSUFFICENT_MATERIAL":a=n.getEndOfMainlinePosition().isInsufficentMaterial(e.role)?t("Draw as {opponent} disconnected, but you have insufficient material to mate",{"{opponent}":d}):t("Draw as you disconnected, but {opponent} have insufficient material to mate",{"{opponent}":d});break;case"DRAW_AGREED":a=t("Draw by agreement");break;case"STALEMATE":"w"===e.role&&"w"===n.getMoveRight()||"b"===e.role&&"b"===n.getMoveRight()?a=t("Draw by stalemate you are unable to move but not in check"):("w"===e.role&&"b"===n.getMoveRight()||"b"===e.role&&"w"===n.getMoveRight())&&(a=t("Draw by stalemate {opponent} is unable to move but is not in check",{"{opponent}":d}));break;case"INSUFFICENT_MATERIAL":a=t("Draw as neither side has enough material to mate");break;case"REPETITION":a=t("Draw as the position was repeated 3 times");break;case"NO_ACTION":a=t("Draw as there were no pawn moves or captures in 50 moves")}else switch(s.endedBy){case"ABORTED":a=t("Game aborted")}return a}function c(e){return Handler.Template.renderString('<strong class="ofMiniProfile" data-uuid="{{uuid}}"><a href="{{link}}">{{name}}</a></strong>',{uuid:e.uuid,link:e.link,name:e.name})}var d=new Dialog.PlayZone(this);e.isPremium=config.level().isPremium,e.playzoneTournament=!(!e.chessGame||!e.chessGame.getMeta().TournamentUUID);var u,h,f=jQuery(d.templates.render("dialogs.play.content.afterTheGame",e)),p=jQuery(d.templates.render("dialogs.play.footer.afterTheGame",e)),m=f.find(".title"),g=f.find(".explanation"),v=f.find("img.smiley"),y=f.find(".scoreContainer > h5.text"),b=f.find(".scoreContainer > div.value"),w=f.find(".eloContainer > h5.text"),k=f.find(".eloContainer > div.value"),x=p.find("li.gameRematch"),C=p.find("li.gameRematch > a > span.cTooltipBoxContainer"),j=p.find("li.gameNew"),T=p.find("li.gameOverview"),_=p.find("li.gameShare"),S=p.find("li.btnImprove"),I=p.find("li.btnTacticTrainer");n(e);var P=!1,M=!1;return d.getContent=function(){return f},d},"undefined"==typeof Dialog&&(Dialog={}),Dialog.AnalysisShare=function(e){function t(t){i=jQuery(c.render("share",{id:e,username:config.user().permalink})),i.modal({classes:"customPopup",destroyOnClose:!0,close:!0,alignX:".contentContainer"}).modal("show"),r=i.find(".invite"),o=i.find("input.code"),a=i.find(".copy"),s=i.find(".btnCancel a"),l=i.find("input:checkbox").prop("checked",t),l.on("change",function(){Dialog.AnalysisShare.togglePublic(e,l.prop("checked"))}),a.clipboard({path:config.assetDir()+"/images/swf/jquery.clipboard.swf",copy:function(){return n(a),o.val()}}),o.on("focus",function(){setTimeout(function(){o.select()})}),r.on("click",function(){var t=[];i.find('.suggestField span [name="users[]"]').each(function(){t.push(jQuery(this).val())});var o={csrf:config.csrf(),id:e,users:t};jQuery.post("/api/web/chessDatabaseAPI/analysisShare",o).done(function(e){var t=e.data.sent?window.t("Sent {number} invitations",{"{number}":e.data.sent}):window.t("No invitations sent");r.find(".copyTooltip").attr("data-tooltip",t),n(r)})}),s.on("click",function(){i.modal("hide")})}function n(e){var t=jQuery(e),n=t.find(".copyTooltip"),i=n.data("timeout");clearTimeout(i),n.addClass("fixed").show(),i=setTimeout(function(){n.removeClass("fixed").hide()},2e3),n.data("timeout",i)}var i,r,o,a,s,l,c=new Handler.Template("database");Dialog.AnalysisShare.togglePublic(e,!0,t)},Dialog.AnalysisShare.togglePublic=function(e,t,n){var i={id:e,status:t?"public":"private",csrf:config.csrf()};jQuery.post("/api/web/ChessDatabaseAPI/sessionToggleStatus",i).done(function(){n&&n(t)})},"undefined"==typeof Dialog&&(Dialog={}),Dialog.Challenge=function(e,n){function i(){if(w(),l(),c(jQuery.parseJSON(q.attr("settings")),!0),q.on("click",function(){if(q.hasClass(_))return!1;var t=q.attr("settings"),i=jQuery.parseJSON(t);if(null!==i){if(Y){if(!X.getCurrentPosition().isValid())return $.html(window.t("Please make sure the starting position is valid")).show(),void X.on("movedPositionPointer.start",x);i.fen=X.toString();var o=parseInt(P.find("input.clockWhiteMinutes").val(),10)||0,a=parseInt(P.find("input.clockWhiteSeconds").val(),10)||0,s=parseInt(P.find("input.clockBlackMinutes").val(),10)||0,l=parseInt(P.find("input.clockBlackSeconds").val(),10)||0;(o||a)&&(s||l)&&(i.whiteClock=1e3*(60*o+a),i.blackClock=1e3*(60*s+l),delete i.clock)}i.user=e,jQuery.post("/api/web/challengeAPI/gameRequest",jQuery.extend(i,K),function(t){if(0===t.status){if(r(),t.data.isEngineChallenge)return;notificationHandler.emit("game_challenge",{content:{action:"sent",challenge:t.data.challenge,color:i.color,clock:1e3*i.clock,increment:1e3*i.increment,rating:i.rating,userUuid:e,toUuid:t.data.toUuid,userName:n.name,userOnline:!0,cancelled:t.data.cancelled}})}}).error(function(e){try{var t=jQuery.parseJSON(e.responseText);for(var n in t.errors){$.html(window.t(t.errors[n][0])).show();break}}catch(i){}})}}),W.on("click",function(){r()}),Q.find("a").on("click",function(){B.hide(),M.show(),P.modal("adjust")}),E.find("a").on("click",function(){M.hide(),B.show(),P.modal("adjust")}),O.positionBuilder(X),Y){var t=B.find(".clocks input");t.on("change",function(){var e;t.each(function(){jQuery(this).val().length>0&&(e=!0)}),e&&(c({clock:void 0,increment:t.filter(".customIncrement").val()||0},!1),P.find(".cTime.active").removeClass("active")),j()}),B.find("input.customIncrement").on("change",function(){c({increment:parseInt(jQuery(this).val(),10)||0},!1),P.find(".cTime.active").removeClass("active")}),X.on("movedPositionPointer.start",function(){setTimeout(j)})}else P.addClass("showConversion"),P.find(".containerOverlayConversion .btnCancel a").on("click",function(){B.hide(),M.show(),P.modal("adjust")});jQuery.ajax({type:"GET",url:"/api/web/playzoneAPI/playNow?authToken="+config.user().authToken,success:function(e){!e.data.isAllowed&&e.data.suspended?o(window.t("Playzone is temporarily disabled, please try again in a couple of minutes.")):void 0!==e.data.nextTournamentStartsAt&&(e.data.nextTournamentRunning?o(window.t("You are playing in a currently running tournament!")):e.data.nextTournamentStartsTooSoon?o(window.t("A tournament is about to start soon, you can't send challenges now.")):(S=e.data.nextTournamentStartsAt,k()))}})}function r(){P.modal("hide")}function o(e){J=!0,q.addClass(_),$.html(e).show()}function a(){J=!1,q.removeClass(_),$.empty().hide()}function s(e){e?(q.removeClass(_),$.empty().hide()):(q.addClass(_),$.html(window.t("Your opponent went offline. You can wait or cancel challenge.")).show())}function l(){D.on("click.timePredefined",function(){u(jQuery(this))}),H.on("click.timeCustomButton",function(){h()}),L.on("click.timeCustomSelect",function(){b()}),V.on("click.timeCustom",function(e){f(e,jQuery(this))}),jQuery(document).on("click.closeCutomTimeList",function(){y()}),F.on("click",function(){p(jQuery(this))}),z.on("change",function(){m(jQuery(this))})}function c(e,t){"string"==typeof e&&(e=jQuery.parseJSON(e));var n=jQuery.parseJSON(q.attr("settings"));jQuery.extend(n,e),q.attr("settings",jQuery.toJSON(n)),t&&d(e),k()}function d(e){Y&&(void 0!==e.clock&&(P.find(".clockWhiteMinutes, .clockBlackMinutes").val(Math.floor(e.clock/60)),P.find(".clockWhiteSeconds, .clockBlackSeconds").val(e.clock%60||"")),void 0!==e.increment&&P.find(".customIncrement").val(e.increment||0))}function u(e){D.removeClass("active"),e.addClass("active"),e.hasClass("mPlus")||v(),c(e.attr("settings"),!0),j()}function h(){g(),c(R.find("li > a.active").attr("settings"),!0),j()}function f(e,t){V.removeClass("active"),t.addClass("active"),c(t.attr("settings"),!0),G.removeClass().addClass("cTime").addClass(t.attr("time")),y(),j(),e.stopPropagation()}function p(e){F.parent().filter(".active").removeClass("active"),e.parent().addClass("active"),c(jQuery.parseJSON(e.attr("settings")),!1)}function m(e){var t={};t[e.attr("setting")]=e.is(":checked")?1:0,c(t,!1)}function g(){N.slideDown()}function v(){N.slideUp(),y()}function y(){R.hasClass("open")&&R.slideUp().removeClass("open")}function b(){R.toggleClass("open"),R.slideToggle()}function w(){q.html(t("Challenge")),q.css("display","inline-block"),W.html(t("Cancel")),U.removeClass("inactive")}function k(){if(void 0!==S){try{var e=q.attr("settings");e=jQuery.parseJSON(e)}catch(t){return}var n=2*(e.clock+40*e.increment)*1e3;n||(n=72e5),a(),Date.now()+n>S&&o(Date.now()>S?window.t("You are playing in a currently running tournament!"):window.t("Selected timeframe for the game might overlap the tournament that you are enrolled to!"))}}function x(){X.getCurrentPosition().isValid()&&$.hide(),X.off("movedPositionPointer.start",x)}function C(){var e={},t=X.toString();if(t!==Chess.defaultFen){var n=t.split(" ");"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR"!=n[0]?e.position=!0:e.other=!0}return 0===P.find(".cTime.active").length&&(e.clocks=!0),Object.getLength(e)?e:!1}function j(){var e=z.filter("[setting=rating]"),t=C();if(t){e.prop("disabled")||e.data("backup-value",e.prop("checked")).prop("checked",!1).prop("disabled",!0),E.addClass("enabled");var n=[];t.position&&n.push(window.t("custom position")),t.clocks&&n.push(window.t("custom clocks")),t.other&&n.push(window.t("opening conditions")),n.length?A.html(n.join(", ")):A.empty()}else e.prop("disabled",!1).prop("checked",e.data("backup-value")),E.removeClass("enabled"),A.empty();m(e)}var T=this,_="cBtnInactive";n=n||{};var S,I=new Handler.Template("challenges").append(new Handler.Template),P=jQuery(I.render("dialogs.challengeGame",n)),M=P.find(".basicSettings"),Q=P.find(".basicSettingsLink"),B=P.find(".advancedSettings"),E=P.find(".advancedSettingsLink"),O=P.find(".challengePositionBuilder"),A=P.find(".enabledOptions"),D=P.find("ul.chooseTimeList > li > a.cTime"),H=P.find("ul.chooseTimeList > li > a.mPlus"),N=P.find(".chooseCustomTime"),L=P.find(".chooseCustomTime .selectCustomTime"),G=L.find("div span"),R=L.find("ul"),V=R.find("li > a"),F=P.find(".cColor"),z=P.find(".cSetting"),U=P.find("ul"),W=P.find(".cancelButton"),q=P.find(".submitButton"),$=P.find(".opponentOffline"),K={csrf:config.csrf()},J=!1,X=new Chess.Game,Y=config.level().isPremium;return s(View.Online.getState(e)),notificationHandler.on("channel:online:"+e,function(e,t){s("online"===t.content.action)}),T.getContent=function(){return P},i(),T},"undefined"==typeof Dialog&&(Dialog={}),"undefined"==typeof Dialog.Chat&&(Dialog.Chat={}),
Dialog.Chat.banUser=function(e,n){var i=new Handler.Template("chat"),r=jQuery(i.render("dialogs.banUser",{userName:e})).modal({classes:"customPopup commonDialog",persistent:!0,alignX:".contentContainer",destroyOnClose:!0}),o=r.find(".dialogFooter > ul > li > a.yes"),a=r.find(".dialogFooter > ul > li > a.no"),s=r.find(".inputRemoveMessages");return o.html(t("yes")),o.on("click.yes",function(){if(r.modal("hide",!0),"function"==typeof n){var e=s.is(":checked");n(e)}}),a.html(t("no")),a.on("click.no",function(){r.modal("hide",!0)}),r.modal("show"),r},"undefined"==typeof Dialog&&(Dialog={}),Dialog.Coaching=function(e,t){function n(n){var o=jQuery(r.render("settings",{uuid:e,username:config.user().permalink,nofriends:!n}));o.modal({classes:"customPopup",destroyOnClose:!0,close:!0,alignX:".contentContainer"}).modal("show");var a=o.find(".invite"),s=o.find("input.code"),l=o.find(".copy"),c=o.find(".yes"),d=o.find(".no");l.clipboard({path:config.assetDir()+"/images/swf/jquery.clipboard.swf",copy:function(){return i(l),s.val()}}),s.on("focus",function(){setTimeout(function(){s.select()})}),a.on("click",function(){var n=t.get("coaching"),r=n.invited||[],s=[];o.find('.suggestField span [name="users[]"]').each(function(){s.push(jQuery(this).val())});var l=s.filter(function(e){return!r.contains(e)}),c={csrf:config.csrf(),uuid:e,users:l};jQuery.post("/api/web/chessDatabaseAPI/coachingInvite",c,function(e){e.data.sent?a.find(".copyTooltip").attr("data-tooltip",window.t("Sent {number} invitations",{"{number}":e.data.sent})):a.find(".copyTooltip").attr("data-tooltip",window.t("No invitations sent")),i(a)})});var u=o.find(".restriction"),h=t.get("coaching").restrictions;u.each(function(){var e=jQuery(this),t=e.data("attribute");e.prop("checked",!h[t])}),d.on("click",function(){o.modal("hide")}),c.on("click",function(){var t={restrictions:{}};u.each(function(){var e=jQuery(this),n=e.data("attribute");t.restrictions[n]=!e.is(":checked")}),notificationHandler.sendMessage("coaching.properties",{uuid:e,data:t}),o.modal("hide")})}function i(e){var t=jQuery(e),n=t.find(".copyTooltip"),i=n.data("timeout");clearTimeout(i),n.addClass("fixed").show(),i=setTimeout(function(){n.removeClass("fixed").hide()},2e3),n.data("timeout",i)}var r=new Handler.Template("database");jQuery.getJSON("/api/web/userFriendAPI/count",function(e){n(e.data&&e.data.count)})},"undefined"==typeof Dialog&&(Dialog={}),function(){function e(e){e=e||{};var t={returnHTML:!1,logo:!0,featureTable:!0,cancelButton:!1,rootClasses:"popupInsider conversionDialog conversionDialogGoPremium"};return jQuery.extend(t,e)}function n(e,n,i){var r={"default":{title:"Go Premium to use this feature",message:"This feature is only available to Premium members. To gain access why not upgrade to a Premium account today!"},chatCooldown:{goPremium:{title:t("Go Premium for unlimited chat"),message:t("<strong>What's the wait?</strong> To keep chat readable non-Premium Members must wait {{n}} seconds before posting again. Go Premium to post as often as you like! Other benefits include:",{"{{n}}":i?i.cooldown:""})}},chatPremiumOnly:{goPremium:{title:t("Go Premium for unlimited chat"),message:t("Go premium to post messages to chat rooms which are restricted to our premium members! Other benefits include:")}},playZone:{register:{title:t("Register to play more chess"),message:t("<strong>You are quite a player!</strong> You have reached the maximum number of games for unregistered users today. If you want to play more just register, it is:")}},analysis:{goPremium:{title:t("Go Premium to view full database"),message:t("Registered users can view only three rows of our database results. Upgrade to Premium to unlock unlimited access to the database.")},register:{title:t("Register to use all analysis feature"),message:t("This feature is only available to registered members. In order to use it please create an account, it is:")}},customOpeningTree:{goPremium:{title:t("Go Premium to build custom opening Trees"),message:t("Upgrade to Premium to unlock unlimited access to the database and custom opening trees.")},register:{title:t("Register to use all analysis feature"),message:t("This feature is only available to registered members. In order to use it please create an account.")}},engine:{register:{title:t("Register to get evaluations faster"),message:t("As a guest evaluations you request have a lower priority than the evaluations of premium and registered users. If you want faster evaluations, please register.")},goPremium:{title:t("Go Premium to get evaluations faster"),message:t("As a registered user evaluations you request have a lower prioirty than the evaluations of premium users. If you want faster evaluations, become premium.")}},challenge:{register:{title:t("Register to challenge people"),message:t("As a guest user you are not allowed to challenge people. If you want more, please register.")},goPremium:{title:t("Go premium to challenge more people"),message:t("<strong>You are a kind of warrior!</strong> You have reached the maximum number of challenges for basic users. If you want to challenge more, become premium.")}},tacticTrainer:{goPremium:{title:t("Daily training is over"),message:t("Unless you are a premium user, you can only play 5 puzzles daily. If you want more, please subscribe to our premium membership.")},register:{title:t("Demo is over"),message:t("As a guest user you only can play the 3 puzzles which you have just played. If you want more, please register.")}},pgnDownload:{goPremium:{title:t("Go Premium to download PGN files"),message:t("This feature is only available to premium members. If you want to have access to it please subscribe to our premium membership.")}},playzoneTournament:{goPremium:{title:t("Register to participate in tournaments"),message:t("<strong>You are a player!</strong> If you want to participate in playzone tournaments you must have an account. Please create an account, it is:")},register:{title:t("Register to participate in tournaments"),message:t("<strong>You are a player!</strong> If you want to participate in playzone tournaments you must have an account. Please create an account, it is:")}},analysisMode:{goPremium:{title:t("Go Premium to use all analysis features"),message:t("This feature is only available to Premium members. To gain access why not upgrade to a Premium account today!")},register:{title:t("Go Premium for computer analysis"),message:t("This feature is only available to Premium members. To gain access why not upgrade to a Premium account today!")}},premiumBoards:{goPremium:{title:t("You picked a Premium setting"),message:t("As a non-Premium user you can not use these settings. Why not upgrade to Premium to get unlimited access to all settings and much, much more!")}},enroll:{goPremium:{title:t("Go Premium to join premium-only tournaments"),message:t("This tournament is only open for Premium members. To gain access why not upgrade to a Premium account today!")}},communityTopic:{register:{title:t("Register to access member-only community topics"),message:t("This topic is only open for chess24 members. To gain access why not register today!")},goPremium:{title:t("Go Premium to access premium-only community topics"),message:t("This topic is only open for Premium members. To gain access why not upgrade to a Premium account today!")}},multiboard:{goPremium:{title:t("Go Premium to use custom multiboard view"),message:t("This feature is only available to Premium members. To gain access why not upgrade to a Premium account today!")}},biggerBoard:{goPremium:{title:t("Go Premium to expand the board"),message:t("This feature is only available to Premium members. To gain access why not upgrade to a Premium account today!")}}},o={};return o.strings=r[e]&&r[e][n]||r["default"],o.embed=1===parseInt(jQuery("body").data("embed"),10),o}Dialog.alert=function(e,n){n=n||dummy;var i=new Handler.Template("dialogs"),r=jQuery(i.render("alert")).modal({classes:"customPopup commonDialog",persistent:!0,alignX:".contentContainer",destroyOnClose:!0}),o=r.find(".dialogContent > h3"),a=r.find(".dialogContent > p"),s=r.find(".dialogFooter > ul .ok");return"object"==typeof e?(o.html(e.content),a.html(e.comment)):(o.html(e),a.remove()),s.html(t("ok")),s.on("click.ok",function(){r.modal("hide",!0),n()}),r.modal("show"),r},Dialog.confirmation=function(e,n,i){if("function"==typeof n)var r=n,o=t("yes"),a="";else"object"==typeof n&&(r=n.callback,o=n.label,a=n.className);if("function"==typeof i)var s=i,l=t("no"),c="";else"object"==typeof i&&(s=i.callback,l=i.label,c=i.className);var d=new Handler.Template("dialogs"),u=jQuery(d.render("confirm")).modal({classes:"customPopup commonDialog",persistent:!0,alignX:".contentContainer",destroyOnClose:!0}),h=u.find(".dialogContent > h3"),f=u.find(".dialogContent > p"),p=u.find(".dialogFooter > ul > li > a.yes"),m=u.find(".dialogFooter > ul > li > a.no");return"object"==typeof e?(h.html(e.content),f.html(e.comment)):(h.html(e),f.remove()),p.html(o||t("yes")).addClass(a||""),p.on("click.yes",function(){u.modal("hide",!0),"function"==typeof r&&r()}),m.html(l||t("no")).addClass(c||""),m.on("click.no",function(){u.modal("hide",!0),"function"==typeof s&&s()}),u.modal("show"),u},Dialog.prompt=function(e){function t(){switch(e.input){case"short":break;case"long":return o.find(".prompt").val();case"editor":}}var n=new Helper.Deferred,i=Object.merge(e,{"short":"short"===e.input,"long":"long"===e.input,editor:"editor"===e.input}),r=new Handler.Template("dialogs"),o=jQuery(r.render("prompt",i)).modal({classes:"customPopup",persistent:!0,alignX:".contentContainer",destroyOnClose:!0});return o.find("a.yes").on("click.yes",function(){o.modal("hide",!0),n.resolve(t())}),o.find("a.no").on("click.no",function(){o.modal("hide",!0)}),o.modal("show"),n.promise},Dialog.conversionRegister=function(t,i){i=e(i);var r=new Handler.Template("dialogs"),o=n(t,"register"),a=r.render("register",jQuery.extend(i,o));if(Handler.tracking("conversionDialog","register",t),i.returnHTML)return a;var s=jQuery(a).modal({classes:"customPopup",persistent:!1,alignX:".contentContainer",destroyOnClose:!0});return s.modal("show"),s},Dialog.conversionGoPremium=function(t,i,r){i=e(i);var o=new Handler.Template("dialogs"),a=n(t,"goPremium",r);a.sourceId="dlg-"+t;var s=o.render("goPremium",jQuery.extend(i,a));if(Handler.tracking("conversionDialog","premium",t),i.returnHTML)return s;var l=jQuery(s).modal({classes:"customPopup",persistent:!1,alignX:".contentContainer",close:!0,destroyOnClose:!0});return l.modal("show"),l},Dialog.showMobilePremiumPackages=function(){var e=new Handler.Template("dialogs"),t=e.render("mobilePremiumPackages");Handler.tracking("conversionDialog","premium","mobilePremiumPackage");var n=jQuery(t).modal({classes:"customPopup",persistent:!1,alignX:".contentContainer",close:!0,destroyOnClose:!0});return n.modal("show"),n},Dialog.editChessGame=function(e,t){function n(e){var t=l.find("select.endedBy"),n=e.endedBy;t.find("option").prop("selected",!1),t.find('option[value="'+n+'"]').prop("selected",!0)}function i(e){var t=l.find("select.result"),n=Chess.GameStatus.resultToString(e.result);t.find("option").prop("selected",!1),t.find('option[value="'+n+'"]').prop("selected",!0),r(e.result),t.on("change",function(){var e=jQuery(this).val();r(Chess.GameStatus.stringToResult(e))})}function r(e){l.find("#gameStatus-result-white").val(e&&e.white),l.find("#gameStatus-result-black").val(e&&e.black),l.find("#meta-Result").val(Chess.GameStatus.resultToString(e))}t=t||dummy;var o=new Handler.Template("dialogs"),a=o.render("editChessGame",e),s=jQuery(a).modal({classes:"customPopup",persistent:!1,alignX:".contentContainer",close:!0,destroyOnClose:!0}),l=s.find(".dialogContent form");return n(e.gameStatus),i(e.gameStatus),s.find(".dialogFooter .btnOk > a").on("click",function(){var e={};l.serializeArray().forEach(function(t){Object.setByPath(e,t.name,t.value,"-")}),t(e),s.modal("hide",!0)}),s.find(".dialogFooter .btnCancel > a").on("click",function(){s.modal("hide",!0)}),s.modal("show"),s},Dialog.setupPosition=function(e,t){var n=new Handler.Template("dialogs"),i=n.render("setupPosition"),r=new Chess.Game({ruleSet:"build",fen:t}),o=jQuery(i).modal({classes:"customPopup",persistent:!1,alignX:".contentContainer",close:!0,destroyOnClose:!0});return o.find(".positionBuilder").positionBuilder(r),o.find(".dialogFooter > ul > li.btnOk > a").on("click",function(){return r.getCurrentPosition().isValid()?(o.modal("hide",!0),"function"==typeof e&&e(r),void $(".cIconMoveMode").click()):(o.find(".error").html(window.t("The given position is invalid")).show(),void o.modal("adjust"))}),o.find(".dialogFooter > ul > li.btnCancel > a").on("click",function(){o.modal("hide",!0)}),o.modal("show"),o},Dialog.confirmMove=function(e,t,n){var i=new Handler.Template("dialogs"),r=i.render("confirmMove",{san:e.getCurrentPosition().getSan()}),o=jQuery(r).modal({classes:"customPopup",persistent:!0,alignX:".contentContainer",close:!0,destroyOnClose:!0}),a=o.find(".board");o.find(".yes").html(window.t("yes")).on("click",function(){o.modal("hide"),t()}),o.find(".no").html(window.t("no")).on("click",function(){o.modal("hide")});var s=new View.ChessBoard(a,!1).link(e);n&&s.flip(),o.modal("show")}}(),"undefined"==typeof Dialog&&(Dialog={}),Dialog.Engine=function(e){function t(t){h=jQuery(T.render("dialogs.play.content.engine",Object.merge(t,{minutesWhite:e.clock&&e.clock.white?Math.floor(e.clock.white/6e4):15,secondsWhite:e.clock&&e.clock.white?Math.floor(e.clock.white%6e4/1e3):0,minutesBlack:e.clock&&e.clock.black?Math.floor(e.clock.black/6e4):15,secondsBlack:e.clock&&e.clock.black?Math.floor(e.clock.black%6e4/1e3):0,increment:e.increment/1e3||0}))),f=h.find(".challengePositionBuilder"),p=h.find(".chooseCompOpponenet li"),m=h.find(".cColor"),g=h.find(".clocks"),v=h.find(".cancelButton"),y=h.find(".submitButton"),w=h.find("input.timed"),b=h.find(".errorMessage"),I?(void 0!==t.nextTournamentStartsAt&&(t.nextTournamentRunning?r(window.t("You are playing in a currently running tournament!")):t.nextTournamentStartsTooSoon?r(window.t("A tournament is about to start soon, you can't start new games now.")):(k=t.nextTournamentStartsAt,c())),a(),y.on("click",function(){if(y.parent().hasClass(C))return!1;var e=u();if(null!==e){if(j&&new View.Challenge(jQuery("<div/>")).link(notificationHandler),!S.getCurrentPosition().isValid())return b.html(window.t("Please make sure the starting position is valid")).show(),void S.on("movedPositionPointer.start",d);jQuery.post("/api/web/challengeAPI/gameRequest",jQuery.extend(e,_)).done(i).error(function(e){try{var t=jQuery.parseJSON(e.responseText);for(var n in t.errors){b.html(window.t(t.errors[n][0])).show(),h.modal("adjust");break}}catch(i){}})}}),v.on("click",function(){i()})):(h.addClass("showConversion"),h.find(".containerOverlayConversion .btnCancel a").on("click",i)),f.positionBuilder(S),n()}function n(){h.modal({close:!0,destroyOnClose:!0,classes:"customPopup"}).modal("show")}function i(){h.modal("hide")}function r(e){y.parent().addClass(C),b.html(e).show()}function o(){y.parent().removeClass(C),b.empty().hide()}function a(){w.on("change",function(){g[this.checked?"fadeIn":"fadeOut"](function(){h.modal("adjust")}),c()}),p.children(".engineAvatar").on("click.engine",function(){l(jQuery(this).parent())}),m.on("click",function(){s(jQuery(this))}),g.find("input").on("change",c),m.parent().removeClass("active"),m.filter("."+("w"==S.getMoveRight()?"white":"black")).parent().addClass("active")}function s(e){m.parent().filter(".active").removeClass("active"),e.parent().addClass("active")}function l(e){e.hasClass("locked")||(p.removeClass("active"),e.addClass("active"))}function c(){if(void 0!==k){var e=u(),t=e.whiteClock+e.blackClock+80*e.increment;t||(t=72e5),o(),Date.now()+t>k&&r(Date.now()>k?window.t("You are playing in a currently running tournament!"):window.t("Selected timeframe for the game might overlap the tournament that you are enrolled to!"))}}function d(){S.getCurrentPosition().isValid()&&b.hide(),S.off("movedPositionPointer.start",d)}function u(){var e=!!w.prop("checked");if(e){var t=parseInt(h.find("input.clockWhiteMinutes").val(),10)||0,n=parseInt(h.find("input.clockWhiteSeconds").val(),10)||0,i=parseInt(h.find("input.clockBlackMinutes").val(),10)||0,r=parseInt(h.find("input.clockBlackSeconds").val(),10)||0;(!t&&!n||!i&&!r)&&(e=!1)}return{fen:S.toString(!0),engine:p.filter(".active").data("engine"),whiteClock:e?1e3*(60*t+n):0,blackClock:e?1e3*(60*i+r):0,increment:e?h.find("input.customIncrement").val()||0:0,rated:0,immediate:1,color:m.parent().filter(".active").find("a").attr("color")}}var h,f,p,m,g,v,y,b,w,k,x=this,C="inactive",j=parseInt(jQuery("body").data("embed"),10),T=new Handler.Template("playZone"),_={csrf:config.csrf()},S=new Chess.Game(e.fen&&{fen:e.fen}||void 0),I=config.level().isPremium;return jQuery.getJSON("/api/web/playzoneAPI/playNow",{authToken:config.user().authToken},function(e){t(e.data)}),x},"undefined"==typeof Dialog&&(Dialog={}),function(){var e=[];Dialog.Enroll=function(t,n,i){function r(e,t){clearTimeout(s),a=t.value,s=setTimeout(o,1e3-Controller.Broadcast.offsetCorrectedDateNow()%1e3)}function o(e){if(clearTimeout(s),void 0===e&&(e=a-Controller.Broadcast.offsetCorrectedDateNow()),!(0>=e)){s=setTimeout(function(){o(e-1e3)},1e3-Controller.Broadcast.offsetCorrectedDateNow()%1e3);var t=Date.getSplitedTime(e);f.text((""+t.hours).lpad("0",2)),p.text((""+t.minutes).lpad("0",2)),m.text((""+t.seconds).lpad("0",2)),h.text((""+t.days).lpad("0",2)),u.toggleClass("withDays",!!t.days)}}var a,s,l=this,c=new Handler.Template("playZone"),d=jQuery(c.render("dialogs.play.content.enroll")).addClass(n?"success":"failure"),u=d.find(".clock"),h=u.find(".days"),f=u.find(".hours"),p=u.find(".minutes"),m=u.find(".seconds");return d=d.modal({classes:"customPopup",alignX:".contentContainer",close:!0,destroyOnClose:!0}),d.on("chess24:show",function(){e.push(d)}).on("chess24:hide",function(){e.removeByValue(d)}),window.settings.attach(d),i&&d.find("h2.dialogTitle").html(i),d.on("chess24:hide",function(){clearTimeout(s)}),d.find(".buttons .gameRematch").on("click",function(){d.modal("hide")}),d.find(".buttons .gameShare a").shareButtons({noLabel:!0,noIcon:!0,facebook:!0,twitter:!0,google:!0,mail:!1,embed:!1}),Extend.Subscriber(l,{},{afterLink:function(e){e.publisher.on("set."+t+":1.startDate",r);var n=e.publisher.getAttribute(t,"title");d.find(".name strong").html(n);var i=e.publisher.getAttribute(t,"rounds"),o=i&&i[1]?i[1].startDate:0;r(e,{value:o})}}),l.getContent=function(){return d},l},Dialog.Enroll.close=function(){for(var t=e.length-1;t>=0;t--)e[t].modal("hide")}}(),"undefined"==typeof Dialog&&(Dialog={}),Dialog.GameSelector=function(e,t,n,i){function r(e,t){if(u[t])return u[t];for(var n in e)for(var i in e[n].rooster)if(e[n].rooster[i]==t)return u[t]=n}function o(e,t){return!n||0===n.length||!!n.find(function(n){return n.matchId==e&&n.gameId==t})}function a(){var n=d.getAttribute(e,"rounds"),i=0,a=0;if(h)var s=d.getAttribute(e,"teams"),l=d.getAttribute(e,"gamesPerMatch");var u=[];for(var m in n[t].matches){var g=n[t].matches[m];if(!h||!g.teams||g.teams[1]&&g.teams[2]){var v=[],y={games:v};if(h){Object.extend(y,{teamA:s[g.teams[1]].name,teamB:s[g.teams[2]].name,teamIdA:g.teams[1],teamIdB:g.teams[2],scoreA:0,scoreB:0,matchId:m});var b=0,w=r(s,g.games[1]&&g.games[1].player.white),k=w!==g.teams[1];k&&(b=1)}u.push(y);for(var x in g.games){x=parseInt(x,10);var C=g.games[x],j=h&&!((b+x)%2),T=j?"black":"white",_=j?"white":"black",S=d.getPlayer(e,C.player[T]),I=d.getPlayer(e,C.player[_]);v.push({gameId:m+"-"+x,tournamentId:e,roundNo:t,matchNo:m,gameNo:x,reverse:j,showEngine:p,url:c.getGameUrl(e,t,m,x),engine:Controller.Broadcast.convertEvaluationToPercent(C.engine,!j),player:{white:Object.merge(S,{name:c.shorterFirstName(S.name,18)}),black:Object.merge(I,{name:c.shorterFirstName(I.name,18)})},status:{finished:"finished"===C.gameStatus.status,running:"running"===C.gameStatus.status,upcoming:"upcoming"===C.gameStatus.status,playerA:{score:Controller.Broadcast.scoreToString(C.gameStatus.result&&C.gameStatus.result[T]),won:C.gameStatus.result&&1===C.gameStatus.result[T]},playerB:{score:Controller.Broadcast.scoreToString(C.gameStatus.result&&C.gameStatus.result[_]),won:C.gameStatus.result&&1===C.gameStatus.result[_]}},checked:o(m,x),noLink:!0}),C.gameStatus.result&&(C.gameStatus.result[T]&&(y.scoreA+=C.gameStatus.result[T]),C.gameStatus.result[_]&&(y.scoreB+=C.gameStatus.result[_])),i++,a+=["running","upcoming"].contains(C.gameStatus.status)?1:0}y.winnerA=y.scoreA>y.scoreB&&y.scoreA>l/2,y.winnerB=y.scoreB>y.scoreA&&y.scoreB>l/2,y.scoreA=Controller.Broadcast.scoreToString(y.scoreA),y.scoreB=Controller.Broadcast.scoreToString(y.scoreB)}}var P={matches:u,knockoutEvent:f,teamEvent:h,showCheckbox:!0,countAllGames:i,countRunningGames:a};return P}function s(){var e=[];return m.find("input:checkbox:checked").each(function(){var t=jQuery(this);e.push({matchId:t.data("match"),gameId:t.data("game")})}),e}var l=new Handler.Template("broadcast"),c=new Controller.Broadcast,d=new Controller.BroadcastTournament,u={},h=d.isTeamEvent(e),f=d.isKnockoutEvent(e),p=window.settings.getBoolean("game-broadcast-engine"),m=jQuery(l.render("multiboard.setup",a()));m.modal({classes:"customPopup",destroyOnClose:!0,close:!0,alignX:".contentContainer"}).modal("show"),m.find(".cancel").on("click",function(){m.modal("hide")}),m.find(".ok").on("click",function(){i(s()),m.modal("hide")}),m.find(".selectall").on("click",function(){m.find("input:checkbox").prop("checked",!0)}),m.find(".reset").on("click",function(){m.find("input:checkbox").each(function(){var e=jQuery(this),t=e.data("match"),n=e.data("game");e.prop("checked",o(t,n))})}),m.find(".default").on("click",function(){var e=c.getCurrentGamePath();m.find("input:checkbox").each(function(){var t=jQuery(this);t.prop("checked",t.data("match")==e.match)})}),m.find(".onlyrunning").on("click",function(){m.find("input:checkbox").each(function(){var n=jQuery(this),i=n.data("match"),r=n.data("game"),o="finished"!=d.getAttribute(e,"rounds")[t].matches[i].games[r].gameStatus.status;n.prop("checked",o)})}),m.find(".unselect").on("click",function(){m.find("input:checkbox").prop("checked",!1)}),m.find("tr").on("click",function(){var e=jQuery(this),t=e.find("input:checkbox");t.length&&t.prop("checked",!t.prop("checked"))}),m.find("tr input:checkbox").on("click",function(e){e.stopPropagation()})},"undefined"==typeof Dialog&&(Dialog={}),Dialog.Games=function(e){function t(){y.find(".cancel").on("click",function(){y.modal("hide")}),y.find(".yes").on("click",function(){var e=y.find(".gamesList"),t=[].slice.apply(e.find("input:checked").map(function(){return v[parseInt(this.value,10)]})),n=y.find("div.suggestField").suggestField("values",!0);u(t,n)});var t=y.find(".cIconListView, .cIconGridView").on("click",function(){var e=jQuery(this);e.is(".disabled")||h(t,e.is(".cIconListView"))});h(t,window.settings.getBoolean("analysis-list-mode"));var o=y.find(".selectAll, .deselectAll");o.off("click").on("click",function(){var e=jQuery(this),t=e.is(".selectAll");k.find("input:checkbox").each(function(){jQuery(this).prop("checked",t)}),e.hide(),o.not(e).show()}),e.playzone&&n(),e.pgn&&i(),e.sessions&&r()}function n(){var e=y.find("input#importuser");y.find("a.cIconSearch").on("click",function(t){return p.emit("search",{pattern:e.val()}),t.stopPropagation(),t.preventDefault(),!1})}function i(){}function r(){function e(){return p.setCurrentTag(),p.emit("search",{pattern:t.val().trim()}),!1}x.on("click",function(){p.emit("alltags")}),C.on("click",function(){p.emit("allgames")}),y.find(".new").on("click",function(){p.emit("newgame")}),j.on("click",a),T.on("click",s),y.find(".confirmDeleteSessions").on("click",l),y.find(".deleteBatch").on("click",d),y.find(".cancelBatch").on("click",c);var t=y.find(".search input"),n=y.find(".search .cBtn");n.on("click",e),t.on("keyup",function(t){return 13===t.which?e():void 0})}function o(e){e.filter("li").each(function(){var e=jQuery(this);f(function(){var t=e.find(".chessBoard");new View.ChessBoard(t,!1).link(new Chess.Game({fen:t.data("fen")}))}),e.find(".cIconPrivacyNotVisible, .cIconPrivacyVisible").on("click",function(t){Dialog.AnalysisShare.togglePublic(e.data("id"),jQuery(this).is(".cIconPrivacyNotVisible"),function(t){e.toggleClass("public",t)}),t.stopPropagation()}),e.find(".shareLink").on("click",function(t){new Dialog.AnalysisShare(e.data("id"),!1),y.modal("hide"),t.stopPropagation()}),e.find(".deleteLink").on("click",function(t){e.addClass("promptDelete");var n=e.find(".confirmDelete");n.on("click",function(e){e.stopPropagation()}),n.find(".cancel").off("click").on("click",function(){e.removeClass("promptDelete")}),n.find(".delete").off("click").on("click",function(){jQuery(this).off("click").addClass("disabled"),p.emit("delete",{id:e.data("id")})}),t.stopPropagation()})}).on("click",function(e){if(g){var t=jQuery(this).data("token"),n=jQuery(this).data("id"),i=v.find(function(e){return t&&e.gameSessionToken===t||n&&e.id===n});i&&u([i])}else{if(jQuery(e.target).is("input:checkbox"))return e.stopPropagation(),!0;var r=jQuery(this).find("input:checkbox");r.prop("checked",!r.prop("checked"))}return!1}),e.find(".time").showAge()}function a(){p.switchToGames(),g=!1,j.addClass("disabled"),T.removeClass("disabled"),y.find(".deletionControls").show(),y.modal("adjust"),k.find("li").each(function(e){var t=jQuery(this),n=t.find(".sessionName");n.length||(n=jQuery('<a class="sessionName"/>').appendTo(t).data("deleteAfterDeletion",!0)),n.append('<input type="checkbox" value="'+e+'"/><label></label>')})}function s(){g||(g=!0,j.removeClass("disabled"),T.addClass("disabled"),y.find(".deletionControls").hide(),y.modal("adjust"),k.find("li").each(function(){var e=jQuery(this);e.data("deleteAfterDeletion")?e.remove():e.find("input:checkbox").remove()}))}function l(){y.find(".deletionControls .confirmDelete").show(),y.modal("adjust")}function c(){y.find(".deletionControls .confirmDelete").hide(),y.modal("adjust")}function d(){c();var e=[].slice.apply(k.find("input:checked").map(function(){return jQuery(this).closest("li").data("id")}));p.emit("delete",{id:e})}function u(e,t){p.emit("select",{games:e,tags:t})}function h(e,t){e.each(function(){var e=jQuery(this);jQuery(this).toggleClass("disabled",t===e.is(".cIconListView"))}),k.toggleClass("listMode",t).toggleClass("gridMode",!t),window.settings.set("analysis-list-mode",t?1:0)}function f(e){f.queue=f.queue||[],window.settings.getBoolean("analysis-list-mode")?f.queue.push(e):e()}var p=this,m=new Handler.Template("database").append(new Handler.Template),g=e.playzone||e.sessions,v=[],y=jQuery(m.render("dialogGames",e)).modal({persistent:!0,close:!0,destroyOnClose:!0}),b=y.find(".currentTag"),w=y.find("input:text"),k=y.find(".gamesList"),x=y.find(".allTags"),C=y.find(".allGames"),j=y.find(".deleteSessions"),T=y.find(".cancelDeleteSessions"),_=y.find(".nativeScroll.games"),S=y.find(".nativeScroll.tags");return layout(y),Extend.Publisher(p),t(),p.show=function(){return y.modal("show"),layout(y),p},p.hide=function(){return y.modal("hide"),p},p.loading=function(e){return y.find(".loading").toggle(e),p},p.emptyMessage=function(e){return y.find(".empty").toggle(!!e),"search"===e?y.find(".empty span").hide().filter(".searchEmpty").show():"general"===e&&y.find(".empty span").hide().filter(".generalEmpty").show(),p},p.selectAll=function(){return y.find(".selectAll").trigger("click"),p},p.switchToTags=function(e){s(),x.addClass("disabled"),C.removeClass("disabled");var t=jQuery(m.render("tags",{tag:e}));return _.hide(),S.show().find(".nativeScrollInsider").empty().append(t),t.filter(".tag").on("click",function(){var e=jQuery(this).data("tag");p.setCurrentTag(e),p.emit("tag",{tag:e}),w.val("")}),S.find(".tagsEmpty").toggle(!e.length),S.find(".tagsEmpty a").off("click").on("click",p.switchToGames),p},p.switchToGames=function(){return s(),x.removeClass("disabled"),C.addClass("disabled"),S.hide(),_.show(),p},p.addTags=function(e){y.find(".gamesDialog").addClass("ready");var t=y.find("div.suggestField");return e&&e.length&&e.forEach(function(e){t.suggestField("add",{name:e,value:e})}),y.find(".gamesDialog").on("chess24:select",function(){y.find(".tagCount").html(t.suggestField("count"))}),y.find(".tagCount").html(t.suggestField("count")),y.find(".showTags").on("click",function(){y.find(".pgnTags").toggle(),t.suggestField("adjust"),y.modal("adjust")}),p},p.setCurrentTag=function(e){return b.length&&(e?b.text(e).removeClass("hidden"):b.addClass("hidden")),p},p.addGames=function(t){t=t.map(function(e,t){if(!e.fen){for(var n=0;;){if(!e.moves[n].children||!e.moves[n].children[0])break;n=e.moves[n].children[0]}e.fen=e.moves[n].fen}return e.index=t,e}),v=v.concat(t);var n=jQuery(m.render("dialogGamesList",Object.merge(e,{games:t})));return k.append(n),o(n),p},p.countRendered=function(){return k.find("li").length},p.setupInfiniteLoading=function(e){return y.find(".gamesList li").remove(),y.find(".nativeScrollInsider").lazyload("reset").lazyload(e),p},p.deleteGame=function(e){if(Array.isArray(e)){var t=jQuery();e.forEach(function(e){t=t.add(y.find(".gamesList li[data-id="+e+"]"))})}else t=y.find(".gamesList li[data-id="+e+"]");t.fadeOut(function(){t.remove()}),setTimeout(function(){y.find(".nativeScrollInsider").trigger("scroll")},1e3),s()},window.settings.on("settings.analysis-list-mode.off",function(){for(;f.queue&&f.queue.length;)f.queue.shift()()}),p},"undefined"==typeof Dialog&&(Dialog={}),Dialog.PlayNow=function(e){function n(){return O.init(L,G),H=new Handler.Pairing,H.off("initGameSession").on("initGameSession",function(e,t){O.close(),N.initGameSession(t)}),H.off("noMatch").on("noMatch",O.noMatch),H.off("informNotAllowed").on("informNotAllowed",O.informNotAllowed),H.off("connectionError").on("connectionError",function(){T(),O.message.show(t("An error occured during connect. Please check your connection."),"red")}),H.off("serverError").on("serverError",function(e){T();var n=e&&e.errorId;if(n)var i=t("An error occured. ErrorId: {{errorId}}",{"{{errorId}}":n});else i=t("An error occured.");O.message.show(i,"red")}),E=!1,F.show(),z.hide(),R.children("a").off("click").on("click",a),V.children("a").off("click").on("click",s),_(),T(),config.level().isGuest||X.remove(),J.off("click").on("click",b),i(),O}function i(){Y.off("slidechange").on("slidechange",function(){var e=Y.slider("values");window.settings.set({"play-elo-range-min":e[0],"play-elo-range-max":e[1]})})}function r(){E!==!0&&(U.on("click.timePredefined",function(){d(jQuery(this))}),q.children(".engineAvatar").on("click.engine",function(){u(jQuery(this).parent())}),E=!0)}function o(){E!==!1&&(U.off("click.timePredefined"),q.off("click.engine"),E=!1)}function a(){y(),d(L.find(".playWithHuman a.cTime.active")),c(A),l(A)}function s(e,t){y(),t=t||"claudia";var n="";switch(t){case"casper":n=L.find("li.compCasper");break;case"kevin":n=L.find("li.compKevin");break;case"claudia":n=L.find("li.compClaudia");break;case"magnus":n=L.find("li.compMagnus");break;case"donhugo":n=L.find("li.compDonHugo");break;case"victoria":n=L.find("li.compVictoria")}u(n),c(D),setTimeout(function(){l(D)}),layout.inputElements(z)}function l(e){e===A?(F.slideDown(function(){}),z.slideUp(function(){O.adjust()})):e===D&&(F.slideUp(function(){}),z.slideDown(function(){O.adjust()}))}function c(e){e===A?(V.removeClass("active"),R.addClass("active"),K.removeClass(D).addClass(A)):e===D&&(R.removeClass("active"),V.addClass("active"),K.removeClass(A).addClass(D))}function d(e){U.removeClass("active"),e.addClass("active"),x(JSON.parse(e.attr("clockSettings"))),B()}function u(e){e.hasClass("locked")||(q.removeClass("active"),e.addClass("active"),$.prop("disabled",!e.hasClass("rated")),j(e.attr("engineSettings")),B())}function h(){if(!te){var e=f();e.eloRange=m(),e.rated=v(),null!==e&&(I(p()),H.play(e))}}function f(){return R.hasClass("active")?k():V.hasClass("active")?C():{}}function p(){return V.hasClass("active")?!0:!1;
}function m(){var e=Y.data("min-value"),t=Y.data("max-value"),n=parseInt(g().min||e,10),i=parseInt(g().max||t,10);return{min:-500!==n?n:void 0,max:500!==i?i:void 0}}function g(){var e={min:window.settings.get("play-elo-range-min"),max:window.settings.get("play-elo-range-max")};return e}function v(){return $.is(":checked")&&!$.prop("disabled")}function y(){H.cancel(),T()}function b(){H.cancel(),O.close()}function w(){var e={clock:window.settings.getNumber("game-clock"),increment:window.settings.getNumber("game-increment")};return e}function k(){var e=U.filter(".active"),t={clock:300,increment:0};return e.length>0&&e[0].attributes.clocksettings&&(t=JSON.parse(e[0].attributes.clocksettings.value)),t}function x(e){K.attr("clockSettings",JSON.stringify(e)),window.settings.set({"game-clock":e.clock,"game-increment":e.increment})}function C(){return JSON.parse(K.attr("engineSettings"))}function j(e){K.attr("engineSettings",e)}function T(){K.removeClass().html(t("Play Now")).addClass("playNowButton human"),K.parent().removeClass("gameSearch").addClass("gameNew"),K.off("click.playNow").on("click.playNow",h),O.message.hide(),K.css("display","inline-block"),W.removeClass("inactive"),r(),M()}function _(){var t={clock:e.settings&&parseInt(e.settings.clock,10)||w().clock,increment:e.settings&&void 0!==e.settings.increment?parseInt(e.settings.increment,10):w().increment};60===t.clock&&0===t.increment?S(".m1"):180===t.clock&&0===t.increment?S(".m3"):300===t.clock&&0===t.increment?S(".m5"):900===t.clock&&0===t.increment?S(".m15"):180===t.clock&&1===t.increment?S(".m3s1"):240===t.clock&&2===t.increment?S(".m4s2"):600===t.clock&&0===t.increment?S(".m10"):1800===t.clock&&0===t.increment?S(".m30"):3600===t.clock&&30===t.increment?S(".m60s30"):(S(".m5"),t.clock=300,t.increment=0),x(t),B()}function S(e){U.removeClass("active"),U.filter(e).addClass("active")}function I(e){if(e=e||!1)var n=t("Connecting to engine");else n=t("Searching for an Opponent");K.removeClass().html(t("stop searching")),K.parent().removeClass("gameNew").addClass("gameSearch"),K.off("click.playNow").on("click.playNow",y),O.message.show(n),W.addClass("inactive"),o(),Q()}function P(){K.html(t("try again")),K.removeClass().html(t("try again")).addClass("playNowButton human"),K.off("click.playNow").on("click.playNow",h),K.css("display","inline-block"),O.message.show(t("Unfortunately no Opponent was found"),"cMessage"),W.removeClass("inactive"),r(),M()}function M(){ne&&Y.slider("enable"),Y.off("slidecreate").on("slidecreate",function(){ne=!0,Y.slider("enable")})}function Q(){ne&&Y.slider("disable")}function B(){if("function"==typeof Z)try{Z(1e3*clockSettings.clock,1e3*clockSettings.increment)}catch(e){return}}var E,O=new Dialog.PlayZone(this);const A="human",D="engine";var H,N=Controller.getPlayZone();e.chessGame&&e.chessGame.additionalInformation&&e.chessGame.additionalInformation.lockedEngines&&("w"===e.role?e.lockedEngines=e.chessGame.additionalInformation.lockedEngines.white:"b"===e.role&&(e.lockedEngines=e.chessGame.additionalInformation.lockedEngines.black)),e.chessGame&&e.chessGame.additionalInformation&&e.chessGame.additionalInformation.ratedEngines&&("w"===e.role?e.ratedEngines=e.chessGame.additionalInformation.ratedEngines.white:"b"===e.role&&(e.ratedEngines=e.chessGame.additionalInformation.ratedEngines.black)),e.initialMinValue=parseInt(g().min,10),e.initialMaxValue=parseInt(g().max,10);var L=jQuery(O.templates.render("dialogs.play.content.playNow",e)),G=jQuery(O.templates.render("dialogs.play.footer.playNow",e));jQuery(".rangeSliderContainer",L).styleRangeSlider();var R=L.find("header li.playWithHuman"),V=L.find("header li.playWithEngine"),F=L.find("section.playWithHuman"),z=L.find("section.playWithEngine"),U=F.find("ul.chooseTimeList > li > a.cTime"),W=F.find("ul"),q=z.find(".chooseCompOpponenet li"),$=z.find(".playRatedGames input"),K=G.find("li.gameNew > a"),J=G.find("li.btnCancel > a"),X=F.find(".chooseEloRange .conversionOverlay"),Y=F.find(".chooseEloRange .eloRange > .cPatternSlider");jQuery("body").data("embed")&&J.remove();var Z,ee,te=!1;O.showHuman=function(){return a(void 0),O},O.showEngine=function(e){return s(void 0,e),O},O.start=function(){return setTimeout(function(){K.trigger("click.playNow")}),O};var ne=!1;return O.noMatch=function(){return P(),O},O.informNotAllowed=function(e,n){switch(n=n||{reason:"limit"},ee=!1,T(),n.reason){case"limit":O.close(),Dialog.conversionRegister("playZone");break;case"playing":O.message.show(t("You are already playing another game."));break;case"tournament":O.message.show(t("You are playing in a currently running tournament!"));break;case"suspended":O.message.show(t("You are temporarily suspended."));break;default:O.message.show(t("You are not allowed to play."))}return O},O.onTimeSelection=function(e){Z=e},O.disable=function(){te=!0,K.addClass("disabled")},O.enable=function(){te=!1,K.removeClass("disabled")},n()},"undefined"==typeof Dialog&&(Dialog={}),Dialog.playZone||(Dialog.playZone={}),function(){var e,t,n=[];Dialog.playZone.playNow=function(t){return e||t||errorHandler.error(new Error("Play now dialog not rendered yet and no data to render.")),t&&(e=new Dialog.PlayNow(t)),e},Dialog.playZone.afterTheGame=function(e){return t||e||errorHandler.error(new Eror("After the game dialog not rendered yet and no data to render.")),e&&(t=new Dialog.AfterTheGame(e)),t},Dialog.PlayZone=function(e){var t=Extend.Publisher(e||this),i={classes:"customPopup",persistent:!0,alignX:".contentContainer",close:!0,destroyOnClose:!0};t.templates=new Handler.Template("playZone");var r=jQuery(t.templates.render("dialogs.play.main"));return r.on("chess24:show",function(){n.push(r)}).on("chess24:hide",function(){n.removeByValue(r)}),t.init=function(e,n){return r.find(".dialogContent").html(e),r.find(".dialogFooter").html(n),t},t.show=function(e){return e=e||0,setTimeout(function(){r.modal(i).show().on("chess24:hide",function(){t.emit("hide")})},e),t},t.setTimeWarning=function(e,n){Dialog.playZone.playNow().onTimeSelection(function(i,r){var o=2*(i+40*r),a=!0;o||(o=72e5),Date.now()+o>=e?n||Date.now()>e?(t.message.show(window.t("You are playing in a currently running tournament!")),a=!1):t.message.show(window.t("Selected timeframe for the game might overlap the tournament that you are enrolled to!")):t.message.hide(),t.toggleAllowed(a)})},t.close=function(){return t.hide(!0)},t.hide=function(e){return e=e||!1,r.modal().hide(e),t.emit("hide"),t},t.message={},t.message.show=function(e,n){n=n||"";var i=r.find(".dialogMessage");return i.removeClass().addClass("dialogMessage cMessage "+n).html(e).stop(!0).slideDown(),t},t.message.hide=function(){var e=r.find(".dialogMessage");return e.is(":visible")&&r.find(".dialogMessage").stop(!0).slideUp(),t},t.adjust=function(){return r.modal("adjust",300),t},t},Dialog.PlayZone.close=function(){for(var e=n.length-1;e>=0;e--)n[e].modal("hide")}}(),"undefined"==typeof Dialog&&(Dialog={}),Dialog.PlayzoneSettings=function(e,t){function n(){function t(e){return function(){d.prop("checked")?c.find(".section.soundSettings")[e?"fadeIn":"show"]():c.find(".section.soundSettings")[e?"fadeOut":"hide"]()}}if(e&&jQuery(e).length)c=jQuery(e);else{var n=new Handler.Template("playZone");c=jQuery(n.render("dialogs.settings",l)),c.modal({destroyOnClose:!0,close:!0,classes:"customPopup"})}i();var s=c.find("[data-settings-save]").length>0;window.settings.attach(c,s);var d=c.find("input[name=sound-category]");r(),o(d,c.find("[data-setting^=game-sound-category]")),o(c.find("input[name=highlight]"),c.find("[data-setting^=game-highlight]")),a(),d.on("change",t(!0)),t(!1)()}function i(){function e(e){e.preventDefault(),n=!0,jQuery(".themeSelector.boards .themeSliderInner div.board.premium").off("click.premium"),jQuery(".themeSelector.pieces .themeSliderInner div.piece.premium").off("click.premium");var i=jQuery(Dialog.conversionGoPremium("premiumBoards",{returnHTML:!0,logo:!1,featureTable:!1,cancelButton:!0,rootClasses:"containerInsiderWrapper"}));i.find(".dialogContent").removeClass().addClass("content position position--h-center"),i.find("h2").removeClass("titleWicon"),i.find(".dialogFooter").addClass("special premium"),i.find(".dialogFooter .cBtnPremium").addClass("test").attr("target","_blank"),jQuery(".containerOverlayConversion .containerInsider").empty().prepend(i),jQuery(".dialogContent").addClass("showConversion"),jQuery(".dialogFooter .btnCancel").on("click",t)}function t(){n&&(jQuery(".dialogContent").removeClass("showConversion"),jQuery(".themeSelector.boards .themeSliderInner div.board.premium").on("click.premium",e),jQuery(".themeSelector.pieces .themeSliderInner div.piece.premium").on("click.premium",e))}var n=!1,i=config.level().isPremium;i?(jQuery(".themeSelector.boards .themeSliderInner div.board.premium").removeClass("premium"),jQuery(".themeSelector.pieces .themeSliderInner div.piece.premium").removeClass("premium")):(jQuery(".themeSelector.boards .themeSliderInner div.board.premium").on("click.premium",e),jQuery(".themeSelector.pieces .themeSliderInner div.piece.premium").on("click.premium",e),jQuery(".themeSelector.boards .themeSliderInner div.board:not(.premium)").on("click.nonpremium",t),jQuery(".themeSelector.pieces .themeSliderInner div.piece:not(.premium)").on("click.nonpremium",t),jQuery("input.premium").on("click",e))}function r(){function e(e){e?l.addClass("cIconSoundOn").removeClass("cIconSoundOff"):l.addClass("cIconSoundOff").removeClass("cIconSoundOn"),soundManager.setVolume("sample-"+o.filter(":checked").val(),e)}function t(){var e=config.assetDir()+"/sounds";o.each(function(){var t=jQuery(this),n=t.val();soundManager.createSound({id:"sample-"+n,url:[{type:"audio/mp3",url:e+"/"+n+"/theme.mp3"},{type:"audio/ogg",url:e+"/"+n+"/theme.oga"},{type:"audio/m4a",url:e+"/"+n+"/theme.m4a"}],autoLoad:!0,autoPlay:!1})})}function n(e,t){soundManager.stopAll();var i=parseInt(a.val(),10);0!==i&&(e=e||o.filter(":checked").val(),s.removeClass("cIconPause").addClass("cIconSoundPlay").filter("[data-theme="+e+"]").addClass("cIconPause").removeClass("cIconSoundPlay"),soundManager.play("sample-"+e,{volume:i,onfinish:function(){s.filter("[data-theme="+e+"]").removeClass("cIconPause").addClass("cIconSoundPlay"),t&&n(e,t)}}))}function i(){if(r.length){var e=!r.get(0).checked;o.each(function(){this.disabled=e})}}var r=c.find("input[data-setting=game-sounds]"),o=c.find("input[data-setting=game-sounds-theme]"),a=c.find("input[data-setting=game-sounds-volume]"),s=c.find(".soundSettings .cIconSoundPlay"),l=c.find(".soundLevel .cIcon");r.on("change",i),i(),a.parent(".cPatternSlider").on("slidestart",function(t,i){n(void 0,!0),e(i.value)}).on("slidestop",function(t,n){soundManager.stopAll(),e(n.value)}).on("slide",function(t,n){e(n.value)}),s.on("click",function(){var e=jQuery(this);e.hasClass("cIconPause")?(soundManager.stopAll(),e.removeClass("cIconPause").addClass("cIconSoundPlay")):n(e.data("theme"))});var d=0;l.on("click",function(){soundManager.stopAll(),l.hasClass("cIconSoundOff")?(a.parent(".cPatternSlider").slider("value",d),d=0):(d=a.val(),a.parent(".cPatternSlider").slider("value",0)),l.toggleClass("cIconSoundOff")}),soundManager.setup({url:config.assetDir()+"/images/swf",flashVersion:9,useHTML5Audio:!0,preferFlash:!1,html5Only:!1,debugMode:!1,onready:t})}function o(e,t){function n(n,i){if(e.length&&!i){var r=!1;t.each(function(){this.checked&&(r=!0)}),e.prop("checked")!=r&&e.prop("checked",r).trigger("change",!0)}}t.on("change",n),n(),e.on("change",function(e,n){if(!n){var i=this.checked;t.each(function(){this.checked!=i&&(this.checked=i,jQuery(this).trigger("change",!0))})}})}function a(){var e=c.find("input[name=engine-local]");e.attr("disabled",!window.settings.getBoolean("game-broadcast-engine")),window.settings.on("settings.game-broadcast-engine.on",function(){e.attr("disabled",!1)}),window.settings.on("settings.game-broadcast-engine.off",function(){e.attr("disabled",!0)})}var s=this,l={};["broadcast","playzone","tacticTrainer"].contains(t)?l[t]=!0:l.playzone=!0;var c;return s.getContent=function(){return c},n(),s},"undefined"==typeof Dialog&&(Dialog={}),function(){var e=[];Dialog.PlayzoneTournamentGame=function(t,n){function i(){o=jQuery(g.render("dialogs.play.content.playzoneTournamentGame",{title:v.getTitle(t)})),a=o.find(".gameStarted"),s=o.find(".gameWon"),l=o.find(".gameSkipped"),c=o.find(".gameAborted"),d=o.find(".gameBye"),u=o.find(".buttonPlay"),h=o.find(".buttonOverview"),f=o.find(".buttonClose"),o.modal({classes:"customPopup",alignX:".contentContainer",close:!0,destroyOnClose:!0}).on("chess24:show",function(){e.push(o)}).on("chess24:hide",function(){e.removeByValue(o)}),window.settings.attach(o)}function r(){function e(){if(Dialog.Enroll.close(),Dialog.PlayzoneTournamentGame.close(),Dialog.PlayZone.close(),r){var e=Handler.Template.renderString(decodeURIComponent(n),r);m?Handler.singleTab("tournament-game-"+t+"-"+r.roundId,function(){b.showGame(t,r.roundId,r.matchId,r.gameId)}):Handler.singleTab("tournament-game-"+t+"-"+r.roundId,function(){window.location=e})}}var i=v.getAttribute(t,"players");if(i[config.user().uuid]&&!i[config.user().uuid].removed){var r=v.findPlayersGame(t,config.user().uuid);if(r)if("string"==typeof r)if("ABORTED"===r)a.hide(),s.hide(),l.hide(),c.show(),d.hide();else if("TOURNAMENT_BYE"===r){a.hide(),s.hide(),l.hide(),c.hide(),d.show();var p=v.getAttribute(t,"currentRound"),g=v.getAttribute(t,"rounds")[p];errorHandler.warning("tournament.bye",{url:window.location.href,userUuid:config.user().uuid,version:config.version(),dateNow:Date.now(),tournamentId:t,roundId:p,games:g&&g.matches&&g.matches[1]&&g.matches[1].games})}else a.hide(),s.show(),l.hide(),c.hide(),d.hide();else{if(window.settings.getBoolean("game-tournament-immediate"))return void e();a.show(),s.hide(),l.hide(),c.hide(),d.hide()}else a.hide(),s.hide(),l.show(),c.hide(),d.hide();Dialog.Enroll.close(),Dialog.PlayzoneTournamentGame.close(),Dialog.PlayZone.close(),f.on("click",function(){o.modal("hide")}),h.on("click",function(){return o.modal("hide"),m?(b.showOverview(h.attr("href")),!1):!0}),u.on("click",e),o.modal("show")}}var o,a,s,l,c,d,u,h,f,p=this,m=!!jQuery("body > div.liveTournament").length,g=new Handler.Template("playZone"),v=new Controller.BroadcastTournament,y=new Helper.Deferred;if(m){var b=new Controller.Broadcast;y.resolve()}else{var w=Handler.socket.getSocket(Handler.socket.types.NOTIFICATION),k="model:PlayzoneTournamentRedisAR",x=k+":"+t,C={type:k,id:t,rkey:x},j=new Record.TournamentSocketPR(C,w,function(){v.add(j,t),y.resolve()});b=new Controller.Broadcast(jQuery("<div/>"),{norender:!0})}return y.promise.done(function(){i(),r()}),p},Dialog.PlayzoneTournamentGame.close=function(){for(var t=e.length-1;t>=0;t--)e[t].modal("hide")}}(),"undefined"==typeof Dialog&&(Dialog={}),Dialog.UserMessage=function(e){function t(){return a?(n(),a.modal({classes:"defaultPopup",destroyOnClose:!0,close:!0}).modal("show"),void s.focus()):(errorHandler.msg("critical",new Error("No template loaded for Message Send"),!0),{})}function n(){l.click(function(t){t.preventDefault(),l.hasClass("cBtnInactive")||(c.hide(),l.addClass("cBtnInactive"),conversationHandler.sendPrivateMessage(e,s.val(),function(e){!e||e.sent?i():l.removeClass("cBtnInactive")}))})}function i(){a.modal("hide")}var r=this,o=new Handler.Template,a=jQuery(o.render("userMessage")),s=a.find(".messageBody"),l=a.find(".messageSubmit"),c=a.find(".cFormErrors");({csrf:config.csrf()});return r.getContent=function(){return a},t(),r},"undefined"==typeof Dialog&&(Dialog={}),function(){function e(e,t,n,i,o){var a={csrf:config.csrf(),source:e,reason:t,reported_user_uuid:n,description:i,reference_id:o},s=r+"sendReport";jQuery.post(s,a,function(){Dialog.userReportConfirmation()},"json").fail(function(e){var t=e.responseJSON,n=t&&t.data&&t.data.message,i=n?t.data.message:"report failed, unknown reason...";Dialog.alert(i)})}var t=0,n=1,i=2,r="/api/web/userReportAPI/",o=!1;Dialog.userReport=function(a,s){if(o)return self;var l;switch(a.source){case"playzone":l=n;break;case"tactic-trainer":l=i;break;default:l=t}var c=r+"getReportData",d={language:window.config.language(),source:l};o=!0,jQuery.get(c,d,function(t,n){if(o=!1,0===t.status){var i=new Handler.Template("dialogs");t.data.users=a.users;var r=jQuery(i.render("userReport",t.data)).modal({classes:"customPopup commonDialog",close:!0,persistent:!0,alignX:".contentContainer",destroyOnClose:!0});$inputReason=r.find("#inputReason"),$inputUser=r.find("#inputUser"),$inputDescription=r.find("#inputDescription"),$charactersLeft=r.find("#charactersLeft"),descriptionMaxLen=2e3,$charactersLeft.text(descriptionMaxLen);var c=r.find(".btnOk > a");c.on("click",function(){if(!c.hasClass("disabled")){r.modal("hide",!0);var t=$inputReason.find(":selected").val(),n=$inputUser.find(":selected").val(),i=$inputDescription.val();"function"==typeof s?s(t,i):e(l,t,n,i,a.referenceId)}});var d=r.find(".btnCancel > a");d.on("click",function(){r.modal("hide",!0)});var u=r.find("#inputReason");u.on("change",function(){2==$(this).val()?r.find("div.reportUser").css("display","inline"):r.find("div.reportUser").css("display","none")});var h=function(){var e=$inputReason.find(":selected").val(),t=$inputUser.find(":selected").val(),n=$inputDescription.val();""===e||!n||2==e&&""==t?c.addClass("disabled"):c.removeClass("disabled"),$charactersLeft.text(descriptionMaxLen-n.length),n.length>=descriptionMaxLen&&$inputDescription.val(n.substr(0,descriptionMaxLen))};return $inputReason.change(h),$inputUser.change(h),$inputDescription.on("keyup",h),r.modal("show"),r.find("div.reportUser").css("display","none"),r}},"json").fail(function(e,t,n){o=!1})},Dialog.userReportConfirmation=function(){var e=new Handler.Template("dialogs"),t=jQuery(e.render("userReportConfirmation")).modal({classes:"customPopup commonDialog",close:!0,persistent:!0,alignX:".contentContainer",destroyOnClose:!0}),n=t.find(".btnOk > a");return n.on("click",function(){t.modal("hide",!0)}),t.modal("show"),t}}();var PuzzleFactory=function(){function e(e,n){if(t=t||new Handler.Template("puzzle"),"multiple_choice"===n.type){for(var i=!1,l=0;l<n.options.length;l++)if(n.options[l].fen){i=!0;break}return i?new o(e,n):new r(e,n)}if("move"===n.type)return new a(e,n);if("select_tiles"===n.type)return new s(e,n);throw new Error("I don't know exercise type "+n.type)}var t,n=inheritable.extend({__constructor:function(e,t){throw new Error("BasePuzzle can't be instantiated")},init:function(e,t){return Extend.Publisher(this),this.container=jQuery(e),this.data=t,this},start:function(){return this.html=this.buildHtml(),this},remove:function(){return this.container.html(""),this},submit:function(){return this},feedback:function(e){return this.emit(e?"success":"failure"),this},buildHtml:function(){return{}},highlightAnswer:function(){return this},stop:function(){return this},getAnswer:function(){return[]},setSubmitBtn:function(e){var t=this;this.html.submitBtn?this.html.submitBtn.remove():this.container.find("a.puzzleSubmitBtn").remove(),this.html.submitBtn=e,this.html.submitBtn.on("click",function(){t.submit()})},giveAnswer:function(e){return this},showGameHighlights:function(e,t){if(!e||!t||!t.length)return!1;for(var n=0;n<t.length;n++){var i=t[n];"square"===i.type?e.addHighlight({color:i.color,frame:Chess.getSquare(i.y,i.x)}):"arrow"===i.type&&e.addHighlight({color:i.color,line:Chess.translate.canToMove(i.from+i.to)})}}}),i=n.extend({__constructor:function(e,t){throw new Error("MultipleChoicePuzzle can't be instantiated")},submit:function(){if(0==this.selectedOptions().length||this.html.submitBtn.hasClass("cBtnInactive"))return this;for(var e=[],t=0;t<this.data.options.length;t++)this.data.options[t].correct&&e.push(t);var n=this.selectedOptions();return e.sort(),n.sort(),this.feedback(e.join("-")==n.join("-")),this},selectedOptions:function(){var e=[];return this.html.options.each(function(){var t=jQuery(this);t.is(":checked")&&e.push(parseInt(t.data("index")))}),e},getOptionContainers:function(){return null},highlightAnswer:function(){var e=this.getOptionContainers();e.removeClass("correct").removeClass("incorrect");for(var t={},n=0;n<this.data.options.length;n++)if(this.data.options[n].correct){t[n]=n;var i=jQuery(e.get(n));i.addClass("correct"),i.removeClass("checked")}for(var r=this.selectedOptions(),o=0;o<r.length;o++){var a=r[o];if(!t.hasOwnProperty(a)){var i=jQuery(e.get(a));i.addClass("incorrect"),i.removeClass("checked")}}return this},getAnswer:function(){return this.selectedOptions()},afterBuildHtml:function(e){var t=this;e.options.on("change",function(){return 0==t.selectedOptions().length?e.submitBtn.addClass("cBtnInactive"):e.submitBtn.removeClass("cBtnInactive"),!0})}}),r=i.extend({__constructor:function(e,t){this.init(e,t)},feedback:function(e){return this.highlightAnswer(),this.parent.feedback(e),this},buildHtml:function(){for(var e=this,n=0;n<this.data.options.length;n++)this.data.options[n].index=n;var i=t.render("puzzle-text",this.data);if(!i)return errorHandler.msg("critical",new Error("No template loaded for TextMultipleChoicePuzzle"),!0),{};if(this.container.html(i),this.data.header_fen){var r=new Chess.Game({fen:this.data.header_fen});new View.ChessBoard(this.container.find(".textExerciseBoard"),!1).link(r),this.showGameHighlights(r,this.data.header_highlights)}else this.container.find(".textExerciseBoard").remove();var o={question:this.container.find("h3"),options:this.container.find("ul input[type=checkbox]"),submitBtn:this.container.find("a")};return layout.inputElements(o.options),o.submitBtn.on("click",function(){e.submit()}),o.options.on("change",function(){var e=jQuery(this).parents(".puzzleOptionContainer");return this.checked?e.addClass("checked"):e.removeClass("checked"),!0}),this.afterBuildHtml(o),o},getOptionContainers:function(){return this.container.find(".puzzleOptionContainer")},stop:function(){return this.container.find('input[type="checkbox"]').attr("disabled","disabled"),this},giveAnswer:function(e){for(var t=0;t<e.length;t++){var n=this.container.find(".puzzleOptionContainer.puzzleOptionContainer"+e[t]+" label.checkBox");jQuery(n).trigger("click")}return this.submit(),this}}),o=i.extend({__constructor:function(e,t){this.init(e,t)},feedback:function(e){return this.highlightAnswer(),this.parent.feedback(e),this},buildHtml:function(){for(var e=this,n=0;n<this.data.options.length;n++)this.data.options[n].index=n;var i=t.render("puzzle-boards",this.data);if(!i)return errorHandler.msg("critical",new Error("No template loaded for TextMultipleChoicePuzzle"),!0),{};this.container.html(i);var r={question:this.container.find("h3"),options:this.container.find("ul input[type=checkbox]"),submitBtn:this.container.find("a.cBtn")};r.options.length%2==0&&this.container.find(".puzzleBoardOptionContainer.last").remove();for(var o=this.container.find("ul .board"),n=0;n<this.data.options.length;n++){var a=new Chess.Game({fen:this.data.options[n].fen});new View.ChessBoard(o.eq(n),!1).link(a)}var s=this.container.find(".boardOverlay");return jQuery.each(s,function(t,n){var i=jQuery(n);i.on("mouseover",function(){i.addClass("mouseOver")}),i.on("mouseout",function(){i.removeClass("mouseOver")}),i.click(function(){e.triggerBoardSelection(t)})}),r.submitBtn.on("click",function(){e.submit()}),this.afterBuildHtml(r),r},triggerBoardSelection:function(e){var t=this.container.find('input[type="checkbox"][data-index='+e+"]"),n=jQuery(this.container.find(".puzzleBoardOptionContainer").get(e));if(t.prop("checked"))t.prop("checked",!1),t.triggerHandler("change"),n.removeClass("checked");else{var i=this.container.find(".puzzleBoardOptionContainer");i.removeClass("checked");var r=this.container.find('input[type="checkbox"]');r.prop("checked",!1),t.prop("checked",!0),t.triggerHandler("change"),n.addClass("checked")}return this},getOptionContainers:function(){return this.container.find(".puzzleBoardOptionContainer")},stop:function(){return this.container.find(".boardOverlay").off("mouseover mouseout click"),this},giveAnswer:function(e){for(var t=0;t<e.length;t++){var n=this.container.find(".puzzleBoardOptionContainer").get(e[t]),i=jQuery(n).find(".boardOverlay");jQuery(i).trigger("click")}return this.submit(),this}}),a=n.extend({__constructor:function(e,t){this.init(e,t)},start:function(){var e=this,t=!0;return this.html=this.buildHtml(),this.game=new Chess.Game({fen:this.data.fen}).setCheckForGameEnd(!1),this.html.board.link(this.game),"b"===this.game.getCurrentPosition().moveRight&&this.game.emit("flipBoard"),this.html.board.movementHandler.switchAutoQueen(!1),new View.Color(this.html.nextColorIndicator,"b").link(this.game),this.showGameHighlights(this.game,this.data.highlights),this.unifiedMoves=this.parseMoves(e.data.moves),this.currentLine=this.unifiedMoves.slice(),this.userMoves=[],this.listener=function(n,i){if(!t)return t=!0,void e.currentLine.splice(0,1);var r=!1;if(i.moveCoords===Chess.translate.sanToMove(e.currentLine[0].move,i.parentMove))r=!0;else for(var o=0;o<e.currentLine[0].sublines.length;o++)if(i.moveCoords===Chess.translate.sanToMove(e.currentLine[0].sublines[o][0].move,i.parentMove)){e.currentLine=e.currentLine[0].sublines[o],r=!0;break}e.userMoves.push(i.getSan()),r?(e.currentLine.splice(0,1),e.currentLine.length>0?(t=!1,e.rebuildingAnswer!==!0?setTimeout(function(){e.game.moveSan(e.currentLine[0].move)},500):e.game.moveSan(e.currentLine[0].move)):setTimeout(function(){e.feedback(!0)},e.rebuildingAnswer?1:1e3)):setTimeout(function(){e.feedback(!1)},e.rebuildingAnswer?1:1e3)},this.game.on("movedPositionPointer.current",this.listener),this},parseMoves:function(e){if(e.length&&e[0].move)return e;for(var t=[],n=0;n<e.length;n++)t.push({move:e[n],sublines:[]});return t},remove:function(){return this.html.board.unlink(this.game),this.parent.remove(),this},feedback:function(e){this.game.getCurrentPosition();return this.answer=this.userMoves,this.highlightAnswer(e),this.parent.feedback(e),this.html.nextColorIndicator.hide(),this},buildHtml:function(){var e=t.render("puzzle-move",this.data);if(!e)return errorHandler.msg("critical",new Error("No template loaded for TextMultipleChoicePuzzle"),!0),{};this.container.html(e);var n={question:this.container.find("h3"),board:new View.ChessBoard(this.container.find(".board"),!0),nextColorIndicator:this.container.find(".puzzleMoveNextColor")};return n},highlightAnswer:function(e){function t(e){for(var n=0;n<e.length;n++){var r=i.game.getCurrentPosition();i.game.moveSan(e[n].move,void 0,!0);var s=i.game.getCurrentPosition();if(r.knotId==o.knotId&&!a){var l=r.childrenMoves[0];r.childrenMoves[0]=r.childrenMoves[1],r.childrenMoves[1]=l,a=!0}for(var c=0;c<e[n].sublines.length;c++)i.game.gotoParentPosition(),t(e[n].sublines[c]),i.game.setCurrentPosition(s)}}var n=this.container.find(".puzzleChessBoard");if(this.game.off("movedPositionPointer.current",this.listener),e)n.addClass("correct");else{n.addClass("incorrect");var i=this,r=this.game.getCurrentPosition(),o=r.parentMove,a=!1;this.game.gotoStart(),t(this.unifiedMoves),this.game.gotoStart();var s=this.container.find(".puzzleMoveNotation");s.show(),new View.FloatingNotation(s).link(this.game),s.find(".moveId_"+r.knotId).addClass("wrongMove")}return this},stop:function(){return this.container.find(".boardOverlay").show(),this},getAnswer:function(){return this.answer},giveAnswer:function(e){this.rebuildingAnswer=!0;for(var t=0;t<e.length;t++)this.game.moveSan(e[t]);return this}}),s=n.extend({__constructor:function(e,t){this.init(e,t)},start:function(){var e=this;e.selectedSquares={},this.html=this.buildHtml(),this.game=new Chess.Game({fen:this.data.fen}),this.html.board.link(this.game);var t={a:"0",b:"1",c:"2",d:"3",e:"4",f:"5",g:"6",h:"7"},n={1:"0",2:"1",3:"2",4:"3",5:"4",6:"5",7:"6",8:"7"};this.correctSquares=[];for(var i=0;i<this.data.squares.length;i++){var r=this.data.squares[i];this.correctSquares.push(n[r[1]]+t[r[0]])}return this.game.setMoveMode({duringGame:{mainline:!1,sideline:!1},afterGame:{mainline:!1,sideline:!1}}),new View.Color(this.html.nextColorIndicator,"b").link(this.game),this.showGameHighlights(this.game,this.data.highlights),this.container.find(".board .cell").on("click",function(){var t=jQuery(this).data("coordinates");return e.game.addHighlight({color:"green",frame:Chess.getSquare(t[0],t[1])}),e.selectedSquares[t]?delete e.selectedSquares[t]:e.selectedSquares[t]=t,Object.keys(e.selectedSquares).length>0?e.html.submitBtn.removeClass("cBtnInactive"):e.html.submitBtn.addClass("cBtnInactive"),!1}),this},buildHtml:function(){var e=this,n=t.render("puzzle-select-tiles",this.data);if(!n)return errorHandler.msg("critical",new Error("No template loaded for SelectTilesPuzzle"),!0),{};this.container.html(n);var i={board:new View.ChessBoard(this.container.find(".board"),!1),submitBtn:this.container.find("a"),nextColorIndicator:this.container.find(".puzzleMoveNextColor")};return i.submitBtn.on("click",function(){e.submit()}),i},remove:function(){return this.html.board.unlink(this.game),this.parent.remove(),this},feedback:function(e){return this.answer=this.selectedSquares,this.highlightAnswer(e),this.parent.feedback(e),this.html.nextColorIndicator.hide(),this},submit:function(){if(0==Object.keys(this.selectedSquares).length||this.html.submitBtn.hasClass("cBtnInactive"))return this;var e=[];for(var t in this.selectedSquares)e.push(t);var n=this.correctSquares.slice();return n.sort(),e.sort(),this.feedback(n.join("-")==e.join("-")),this},highlightAnswer:function(e){var t=this.container.find(".puzzleChessBoard");if(e)t.addClass("correct");else{t.addClass("incorrect");for(var n=[],i=Object.merge(this.selectedSquares),r=0;r<this.correctSquares.length;r++){var o=this.correctSquares[r];this.selectedSquares[o]?delete i[o]:n.push(o)}for(var r=0;r<n.length;r++)this.game.addHighlight({color:"green",frame:Chess.getSquare(n[r][0],n[r][1])});for(var o in i)this.game.addHighlight({color:"red",frame:Chess.getSquare(o[0],o[1])})}return this},stop:function(){return this.container.find(".boardOverlay").show(),this},getAnswer:function(){return this.answer},giveAnswer:function(e){for(var t in e)this.container.find(".board .cell._"+t).trigger("click");return this.submit(),this}});return e}();if("undefined"==typeof TacticTrainer&&(TacticTrainer={}),TacticTrainer.PuzzleHandler=inheritable.extend({__constructor:function(e,t,n){var i=this;return Extend.Publisher(this),this.settings=jQuery.extend({},n),this.container=jQuery(e),this.puzzle=t.puzzle,this.id=t.id||TacticTrainer.PuzzleHandler.nextId++,this.game=Chess.couchToGame(t.puzzle),this.started=Date.now(),this.playing=!1,this.expecting=[],this.result={status:"progress",time:0,failure:void 0},this.html=this.buildHtml(),TacticTrainer.PuzzleHandler.handler||(TacticTrainer.PuzzleHandler.handler=new Chess.GameHandler),TacticTrainer.PuzzleHandler.handler.addGame(this.id,this.game).setCurrentGame(this.id),this.board=new View.ChessBoard(this.html.board,!0),this.sound=new View.Sound("tactic"),this.listening=!1,this.subscriber={movedPositionPointer:function(){i.listening&&setTimeout(function(){i.check()},1)},afterLink:function(){i.board.link(TacticTrainer.PuzzleHandler.handler),i.board.movementHandler.switchAutoQueen(!1),i.board.movementHandler.setPremove(!1),i.sound.link(TacticTrainer.PuzzleHandler.handler),TacticTrainer.PuzzleHandler.handler.gotoStart();var e=i.game.getCurrentPosition();t.lastmove?("w"===e.moveRight&&i.board.flip(),TacticTrainer.PuzzleHandler.handler.gotoNextPosition(),e=i.game.getCurrentPosition()):"b"===e.moveRight&&i.board.flip(),i.sound.setUserRole(e.moveRight),i.expecting=[];for(var n=0;n<e.childrenMoves.length;n++)i.expecting.push(e.childrenMoves[n].knotId);i.listening=!0;var r=i.game.getMoveRight();i.html.mr.white["w"===r?"show":"hide"](),i.html.mr.black["b"===r?"show":"hide"](),i.html.mr.you.show(),i.hint()}},Extend.Subscriber(this.subscriber,this.subscriber,this.subscriber),this.subscriber.link(TacticTrainer.PuzzleHandler.handler),this},start:function(){},cancel:function(e){return"progress"!==this.result.status?this:(this.listening=!1,
this.result.time=(Date.now()-this.started)/1e3,this.result.status=e?"failure":"cancelled",this.cleanup(),this)},ended:function(e,t){return"progress"!==this.result.status?this:(this.listening=!1,this.result.time=(Date.now()-this.started)/1e3,this.result.status=e?"success":"failure",t&&(this.result.failure=t),this.showFeedback(e),this.cleanup(),this.emit(e?"success":"failure"),this)},cleanup:function(){this.sound.unlink(TacticTrainer.PuzzleHandler.handler),this.subscriber.unlink(TacticTrainer.PuzzleHandler.handler)},remove:function(){return this.container.html(""),this.cleanup(),this},check:function(){var e=this,t=this.game.getCurrentPosition();if(this.html.mr.you.hide(),this.expecting.contains(t.knotId))if(t.childrenMoves&&0!==t.childrenMoves.length){this.listening=!1;var n=Math.floor(Math.random()*t.childrenMoves.length);TacticTrainer.PuzzleHandler.handler.gotoId(t.childrenMoves[n].knotId),t=this.game.getCurrentPosition(),this.expecting=[];for(var i=0;i<t.childrenMoves.length;i++)this.expecting.push(t.childrenMoves[i].knotId);this.listening=!0,0===t.childrenMoves.length?e.ended(!0):setTimeout(function(){e.html.mr.you.show()},500),this.hint()}else e.ended(!0);else e.ended(!1,t.knotId)},summary:function(){return this.result},showFeedback:function(e){this.html.feedback.border.addClass(e?"success":"failure"),this.html.feedback.overlay.show().addClass(e?"success":"failure").animate({opacity:0},1e3)},buildHtml:function(){var e=this,t=new Handler.Template("tacticTrainer");return this.container.html(t.render("tactics-puzzle",{id:this.id,hint:"classic"===this.settings.type,hinttime:Math.round(.33*(this.puzzle.duration||TacticTrainer.BaseServer.DURATION))})),this.container.find(".hint").on("click",function(){e.hintFigure()}),{board:this.container.find(".tacticTrainerBoard"),feedback:{border:this.container.find(".tacticTrainerFeedback"),overlay:this.container.find(".tacticTrainerFadingFeedback")},mr:{white:this.container.find(".tacticMoveRight.white"),black:this.container.find(".tacticMoveRight.black"),you:this.container.find(".tacticYourMove .yourmove")}}},hint:function(){return this},hintFigure:function(){var e=this;return setTimeout(function(){var t=e.game.getCurrentPosition();if(t.childrenMoves[0]){var n=t.childrenMoves[0].moveCoords;e.board.highlightHandler.highlightCellTake(n.y1+""+n.x1,"red",!1)}},1),this.emit("hint"),this}}),TacticTrainer.PuzzleHandler.nextId=1,"undefined"==typeof TacticTrainer&&(TacticTrainer={}),TacticTrainer.PuzzleProvider=inheritable.extend({__constructor:function(e){var t={type:"classic",preload:4,preloadAt:2,url:"/api/web/TacticTrainerAPI/<action>",reset:!0};this.current=void 0,this.settings=jQuery.extend({},t,e),this.queue=[],this.sessionId="",this.stop=!1,this.stat={elo:0,success:0,failure:0};var n=location.pathname.split("/")[5];return n&&(this.sessionId=n),this},get:function(e,t){this.queue.length?(e(this.queue.shift()),!t&&this.queue.length<=this.settings.preloadAt&&(this.stop||this.preload())):t?e(null,this.stop):this.preload(e)},preload:function(e){var t=this,n=this.settings.url.replace("<action>","get");return n+="?count="+this.settings.preload+"&type="+this.settings.type,this.settings.reset?n+="&session="+this.sessionId:this.settings.reset=!1,jQuery.getJSON(n,function(n){0==n.status&&(t.sessionId=n.data.session,n.data.puzzles?t.queue=t.queue.concat(n.data.puzzles):t.stop=n.data.empty||!0,e&&t.get(e,!0))}).error(function(){this.stop=!0,e&&t.get(e,!0)}),this},report:function(e,t){var n=this,i=this.settings.url.replace("<action>","report");e.session=this.sessionId,e.csrf=config.csrf(),jQuery.post(i,e,function(e){0==e.status&&("function"==typeof t&&t(e.data),e.data&&(n.stat.elo=e.data.eloNew))}).error(function(){t(null)})},summary:function(){return this.stat},promise:function(e,t){"function"==typeof e&&"undefined"==typeof t&&(t=e,e=void 0);var n=this.settings.url.replace("<action>","promise");n+="?session="+this.sessionId+(e?"&promise="+e:""),jQuery.getJSON(n,function(e){0==e.status&&t(e.data)}).error(function(){t(null)})}}),"undefined"==typeof TacticTrainer&&(TacticTrainer={}),TacticTrainer.BaseServer=inheritable.extend({__constructor:function(e,t){throw new Error("I'm not supposed to be instantiated, please use my children")},type:function(){return void 0},showError:function(e,t){this.showSummary();var n=jQuery('<div class="popupWithClose popupInsider"/>').append(jQuery('<div class="dialogContent"/>').append("<h3>"+e+"</h3>"+(t?"<p>"+t+"</p>":""))).append(jQuery('<div class="dialogFooter"/>').append(jQuery('<a class="cBtn cBtnGrey">'+window.t("Close")+"</a>").on("click",function(){n.modal("hide")})));n.modal({destroyOnClose:!0,classes:"defaultPopup"}).modal("show")},showSettings:function(){new Dialog.PlayzoneSettings(void 0,"tacticTrainer").getContent().modal("show")},init:function(e){Extend.Publisher(this),this.container=jQuery(e).show(),this.session=[],this.results={},this.currentpuzzle=null,this.readonly=!1,this.html=this.buildHtml(),this.timeline=new TacticTrainer.Timeline(this.html.timeline)},start:function(){var e=this;this.resetTimer(!0);var t=function(){var t=(Date.now()-e.startedSession)/1e3,n=(Date.now()-e.startedPuzzle)/1e3;e.timer(n,t)};clearTimeout(this.timeout),this.timeout=setInterval(t,100),this.puzzle(!0)},stop:function(e){return this},next:function(e){return this},proceed:function(){return this},puzzle:function(e){var t=this;return this.timeline.update(this.session,!0),this.toggleKeyboard(!1),this.handler&&this.handler.remove(),this.provider.get(function(n,i){return t.resetTimer(),n?(t.handler=new TacticTrainer.PuzzleHandler(t.html.puzzle,n,{type:t.type()}),t.currentpuzzle={status:"none",lastmove:n.lastmove,handlerId:t.handler.id,puzzleId:parseInt(n.id),avg:parseFloat(n.avg),likes:parseInt(n.likes)||0,unlikes:parseInt(n.unlikes)||0,iLiked:!!n.iliked,iUnliked:!!n.iunliked,eloPuzzle:parseInt(n.elo),eloUser:t.feedback&&t.feedback.eloUser?parseInt(t.feedback.eloUser):void 0,eloSuccess:t.feedback&&t.feedback.eloSuccess?parseInt(t.feedback.eloSuccess):void 0,eloFailure:t.feedback&&t.feedback.eloFailure?parseInt(t.feedback.eloFailure):void 0,eloResult:void 0},t.feedback=null,t.session.push(t.currentpuzzle),e&&(t.subsessionStart=t.session.length-1),(1==t.session.length||e)&&t.provider.promise(t.session[t.subsessionStart].puzzleId,function(e){return e?(t.startElo=parseInt(e.eloUser),t.currentpuzzle.eloSuccess=parseInt(e.eloSuccess),t.currentpuzzle.eloFailure=parseInt(e.eloFailure),void(t.currentpuzzle.eloUser=parseInt(e.eloUser))):void t.showError(window.t("Your session is expired. Please restart the session."))}),t.handler.on("success",function(){t.next(!0,!0)}).on("failure",function(){t.next(!1,!0)}).on("hint",function(){t.currentpuzzle&&(t.startedPuzzle-=.33*(t.currentpuzzle.duration||TacticTrainer.BaseServer.DURATION)*1e3),t.handler.started-=.33*(t.currentpuzzle.duration||TacticTrainer.BaseServer.DURATION)*1e3}),void t.handler.start()):void("guest"==i?(Dialog.conversionRegister("tacticTrainer"),t.showSummary()):"daily"==i?(Dialog.conversionGoPremium("tacticTrainer"),t.showSummary()):t.showError(window.t("There are no more puzzles left to show"),window.t("Most likely it is because you solved all of the puzzles within your level range.")))}),this},timer:function(e){return this},resetTimer:function(e){return this.startedPuzzle=Date.now(),e&&(this.startedSession=this.startedPuzzle),this},stopTimer:function(){return clearTimeout(this.timeout),this},keydown:function(e){var t=TacticTrainer.PuzzleHandler.handler.getCurrentPosition(),n=!1;if(37==e.which)TacticTrainer.BaseServer.dialog&&(TacticTrainer.BaseServer.dialog.remove(),TacticTrainer.BaseServer.dialog=null),t.parentMove&&TacticTrainer.PuzzleHandler.handler.gotoId(t.parentMove.knotId);else if(39==e.which)if(TacticTrainer.BaseServer.dialog)TacticTrainer.BaseServer.dialog.select().remove(),TacticTrainer.BaseServer.dialog=null;else if(t.childrenMoves.length>1){for(var i=[],r=0;r<t.childrenMoves.length;r++){var o=t.childrenMoves[r].getSan();i.push({id:t.childrenMoves[r].knotId,text:("w"==t.moveRight?t.moveCounter+". ":t.moveCounter+"... ")+o})}TacticTrainer.BaseServer.dialog=new popupList(i,function(e){TacticTrainer.PuzzleHandler.handler.gotoId(e),TacticTrainer.BaseServer.dialog.remove(),TacticTrainer.BaseServer.dialog=null})}else 1==t.childrenMoves.length&&TacticTrainer.PuzzleHandler.handler.gotoId(t.childrenMoves[0].knotId);else 38==e.which?TacticTrainer.BaseServer.dialog&&(TacticTrainer.BaseServer.dialog.up(),n=!0):40==e.which?TacticTrainer.BaseServer.dialog&&(TacticTrainer.BaseServer.dialog.down(),n=!0):13==e.which?TacticTrainer.BaseServer.dialog&&(TacticTrainer.BaseServer.dialog.select().remove(),TacticTrainer.BaseServer.dialog=null):27==e.which&&TacticTrainer.BaseServer.dialog&&(TacticTrainer.BaseServer.dialog.remove(),TacticTrainer.BaseServer.dialog=null,n=!0);if(n)try{e.preventDefault(),e.stopPropagation()}catch(a){e.cancelBubble=!0,e.returnValue=!1}},cursorEvents:function(e){var t=!0;"chess24:lastmove"==e.type?TacticTrainer.PuzzleHandler.handler.gotoEndOfLine():"chess24:firstmove"==e.type?TacticTrainer.PuzzleHandler.handler.gotoStart():"chess24:previousmove"==e.type?TacticTrainer.PuzzleHandler.handler.gotoParentPosition():"chess24:nextmove"==e.type&&(t=!1,e.which=39,this.keydown(e)),t&&TacticTrainer.BaseServer.dialog&&(TacticTrainer.BaseServer.dialog.remove(),TacticTrainer.BaseServer.dialog=null)},importSession:function(e){TacticTrainer.PuzzleHandler.handler||(TacticTrainer.PuzzleHandler.handler=new Chess.GameHandler),this.session=[];for(var t=0;t<e.puzzles.length;t++){this.session.push(e.puzzles[t]);var n=Chess.couchToGame(e.puzzles[t].puzzle);if(e.puzzles[t].failure){try{var i=n.getPositionByKnotId(parseInt(e.puzzles[t].failureat));n.moveSan(e.puzzles[t].failure.trim(),i,!1);for(var r=0;r<i.childrenMoves.length;r++)i.childrenMoves[r].getSan()==e.puzzles[t].failure&&(e.puzzles[t].failure=i.childrenMoves[r].knotId)}catch(o){}e.puzzles[t].failureat=void 0}TacticTrainer.PuzzleHandler.handler.addGame(e.puzzles[t].id,n).setCurrentGame(n)}this.subsessionStart=0,this.readonly=!0},showSummary:function(e,t){var n=this;if(!this.html||!this.html.summary)return this;if(e&&this.importSession(e),TacticTrainer.PuzzleHandler.handler||(TacticTrainer.PuzzleHandler.handler=new Chess.GameHandler),this.report.working)return setTimeout(function(){n.showSummary()},50),this;var i=n.container.siblings(".tacticTrainerDashboard"),r=function(e){var r="w";e.tempo=Math.round(10*e.tempo)/10,e.time=0,e.countFailure=0;for(var o=0;o<e.puzzles.length;o++)e.time+=e.puzzles[o].time,e.countFailure+="failure"==e.puzzles[o].status?1:0;e.time=Math.round(10*e.time)/10,e[n.type()]=!0,e.readonly=n.readonly,e.standalone=!!t,e.eloChange=e.eloChange,e.eloChangeDisplay=Math.abs(e.eloChange),n.timeline.update(n.session,!1).callback(function(t,i){for(var o=0;o<e.puzzles.length;o++)if(e.puzzles[o].id==t){n.summaryDetails(e.puzzles[o],i);break}var a=TacticTrainer.PuzzleHandler.handler.getMoveRight();"1"==e.puzzles[o].lastmove&&(a="w"==a?"b":"w"),r!=a&&(n.summary.board.flip(),r=a);var s=n.html.summary.find(".analysis"),l=Handler.Template.renderString(s.data("url"),{sessionId:n.provider.sessionId,puzzleId:e.puzzles[o].id});s.attr("href",l)}),n.html.puzzleBundle.hide(),n.html.summary.html(new Handler.Template("tacticTrainer").render("tactics-summary",e)).show(),n.container.removeClass("smaller"),n.summary={},e.countTotal?(n.summary.board=new View.ChessBoard(n.html.summary.find(".board"),!1).link(TacticTrainer.PuzzleHandler.handler),n.summary.sound=new View.Sound("tactic").link(TacticTrainer.PuzzleHandler.handler),n.summary.cursor=new View.Cursor(n.html.summary.find(".cursor")).link(TacticTrainer.PuzzleHandler.handler),n.summary.notation=new View.FloatingNotation(n.html.summary.find(".notation")).link(TacticTrainer.PuzzleHandler.handler),n.summary.cursor.switchEventBased(!0)):n.summary.board=new View.ChessBoard(n.html.summary.find(".board"),!1),n.timeline.engage(n.subsessionStart),n.html.summary.find(".settings").on("click",n.showSettings),n.html.summary.find("a.continue").on("click",function(){n.proceed()}),n.html.summary.find("a.overview").on("click",function(){n.container.hide(),$("div.globalSharing").removeClass("withComments"),i.show()}),n.html.summary.find("a.classic").on("click",function(){n.hideSummary(),new TacticTrainer.ClassicServer(n.container).start()}),n.html.summary.find("a.speed").on("click",function(){var e,t=window.settings.getNumber("tactics-length"),i=function(t){e.modal("hide").remove(),n.hideSummary(),new TacticTrainer.SpeedServer(n.container,{time:60*t}).start()},r=function(n){return function(){t=n,e.find(".chooseTimeList a").removeClass("active"),jQuery(this).addClass("active")}};e=jQuery("<div/>").addClass("popupInsider").append(jQuery("<div/>").addClass("dialogContent").append(jQuery("<h3>"+window.t("Tactic Trainer Speed")+"</h3>")).append(jQuery("<p>"+window.t("Please choose a time interval")+"</p>")).append(jQuery('<ul class="chooseTimeList"/>').append(jQuery("<li/>").append(jQuery("<a/>").addClass("cTime m1"+(1==t?" active":"")).html(window.t("<strong>1</strong> min")).on("click",r(1)))).append(jQuery("<li/>").append(jQuery("<a/>").addClass("cTime m3"+(3==t?" active":"")).html(window.t("<strong>3</strong> min")).on("click",r(3)))).append(jQuery("<li/>").append(jQuery("<a/>").addClass("cTime m5"+(5==t?" active":"")).html(window.t("<strong>5</strong> min")).on("click",r(5))))).append(jQuery("<a/>").addClass("cBtnFlexi cBtnWhite cancel").html(window.t("Cancel")).on("click",function(){e.modal("hide").remove()})).append(jQuery("<a/>").addClass("cBtnFlexi cBtnGrey submit").html(window.t("Start")).on("click",function(){t&&i(t)})).append('<br class="clear"/>')).modal({classes:"tacticTrainerDialog"}).modal("show")}),n.toggleKeyboard(!0)};if(e)r(e);else{for(var o=0;o<this.session.length;o++)this.session[o].eloResult||(this.session[o].eloResult=o<this.session.length-1?this.session[o+1].eloUser:this.feedback?this.feedback.eloUser:null);jQuery.getJSON("/api/web/TacticTrainerAPI/summary?session="+this.provider.sessionId,function(e){if(0==e.status){var t=e.data.summary;r(t)}})}return this},toggleKeyboard:function(e){if(jQuery(document).off("chess24:lastmove.tactictrainer chess24:nextmove.tactictrainer chess24:previousmove.tactictrainer chess24:firstmove.tactictrainer").off("keydown.tactictrainer"),e){var t,n=this;jQuery(document).on("chess24:lastmove.tactictrainer chess24:nextmove.tactictrainer chess24:previousmove.tactictrainer chess24:firstmove.tactictrainer",function(e){clearTimeout(t),t=setTimeout(function(){n.cursorEvents(e)})}).on("keydown.tactictrainer",function(e){clearTimeout(t),t=setTimeout(function(){n.keydown(e)})})}},hideSummary:function(){this.summary&&(this.summary.board&&this.summary.board.unlink(TacticTrainer.PuzzleHandler.handler),this.summary.sound&&this.summary.sound.unlink(TacticTrainer.PuzzleHandler.handler),this.summary.cursor&&this.summary.cursor.unlink(TacticTrainer.PuzzleHandler.handler),this.summary.notation&&this.summary.notation.unlink(TacticTrainer.PuzzleHandler.handler),TacticTrainer.BaseServer.dialog&&(TacticTrainer.BaseServer.dialog.remove(),TacticTrainer.BaseServer.dialog=null),this.html.summary.hide().html(""),jQuery(document).off("keyup",this.keydown),jQuery(document).trigger("chess24:comments"),this.timeline.callback(null))},summaryDetails:function(e,t){var n=this.html.summary.find(".tacticTrainerDetails");n.find(".puzzle-no").html("#"+e.id),n.find(".elo-user").html(e.eloUser+' <span class="eloChange dif'+e.eloChange+'">'+Math.abs(e.eloChange)+"</span>"),n.find(".elo-puzzle").html(e.eloPuzzle),n.find(".time-user").html(e.time?Math.round(10*e.time)/10+"s":window.t("N/A")),n.find(".time-avg").html(e.timeAvg?Math.round(10*e.timeAvg)/10+"s":window.t("N/A")),this.container.find(".reportPuzzle").data("puzzle-id",e.id);var i=this.html.summary.find(".underBoard");i.find(".plus")[e.iLiked?"addClass":"removeClass"]("on").find("label").html(e.likes),i.find(".minus")[e.iUnliked?"addClass":"removeClass"]("on").find("label").html(e.unlikes),this.timeline.highlight(e.id),this.summary.board.highlightHandler.unHighlightAll(),TacticTrainer.PuzzleHandler.handler.setCurrentGame(e.id).gotoStart(),t&&this.html.summary.find(".notation .moveId_"+t).addClass("wrongMove"),i.find(".plus, .minus").off("click").on("click",function(){var t=jQuery(this),n="/api/web/TacticTrainerAPI/feedback?id="+e.id+"&feedback="+(t.is(".plus")?"1":"-1");jQuery.getJSON(n,function(t){0==t.status&&(e.likes=t.data.likes,e.unlikes=t.data.unlikes,e.iLiked=t.data.iliked,e.iUnliked=t.data.iunliked,i.find(".plus")[e.iLiked?"addClass":"removeClass"]("on").find("label").html(t.data.likes),i.find(".minus")[e.iUnliked?"addClass":"removeClass"]("on").find("label").html(t.data.unlikes))})});var r=this.html.summary.find(".comments").empty().addClass("loading"),o="/api/web/CommentAPI/comments?lang="+config.language()+"&puzzle="+e.id;jQuery.getJSON(o,function(e){e.data.html?r.show().append(e.data.html):r.hide(),jQuery(document).trigger("newhtml").trigger("chess24:comments")}),this.toggleKeyboard("cancelled"!=e.status),this.html.summary.find(".cursor,.notation")["cancelled"==e.status?"hide":"show"]()},buildHtml:function(){return{}},report:function(e,t,n){if(!t)return this;var i=this,r={puzzle:t.puzzleId,result:"success"==t.status?1:0,time:t.time,type:this.type()};return n&&(r.promise="on"),t.failure&&(r.failureat=TacticTrainer.PuzzleHandler.handler.getCurrentPosition().parentMove.knotId,r.failure=TacticTrainer.PuzzleHandler.handler.getCurrentPosition().getSan()),this.report.working=!0,this.provider.report(r,function(r){if(n){if(!r)return void(i.report.working=!1);var o=i.session.indexOf(t);o>=0&&i.session[o+1]?jQuery.extend(i.session[o+1],r):i.feedback=r}i.report.working=!1,"function"==typeof e&&e(),Handler.tracking("tactics-trainer",i.type(),t.status)}),this}}),TacticTrainer.BaseServer.DURATION=60,TacticTrainer.BaseServer.DELAY=1.5,TacticTrainer.ClassicServer=TacticTrainer.BaseServer.extend({__constructor:function(e,t){return this.provider=new TacticTrainer.PuzzleProvider({type:"classic"}),this.settings=jQuery.extend({},t),this.init(e),this},type:function(){return"classic"},stop:function(e){if(e)this.halt=!0;else if(this.handler){this.handler.cancel(),jQuery.extend(this.currentpuzzle,this.handler.summary()),this.handler.remove();var t=this;this.report(function(){t.showSummary()},this.currentpuzzle,!1)}return this},next:function(e,t){var n=this;this.handler&&jQuery.extend(this.currentpuzzle,this.handler.cancel().summary());var i=window.settings.get("tactics-stop");return this.halt||"always"==i||e===!1&&"failure"==i?("failure"==i&&(this.subsessionStart=this.session.length-1),this.report(function(){setTimeout(function(){n.showSummary()},t?1e3*TacticTrainer.BaseServer.DELAY:0)},this.currentpuzzle,!1)):(this.report(void 0,this.currentpuzzle,!0),setTimeout(function(){n.puzzle()},t?1e3*TacticTrainer.BaseServer.DELAY:0)),this},proceed:function(){this.switchTimeline(),this.hideSummary(),this.currentpuzzle=null,this.halt=!1,this.html.puzzleBundle.show(),"always"!=window.settings.get("tactics-stop")&&this.html.stoplater.show(),this.html.stoplateron.hide(),this.puzzle(!0)},timer:function(e,t){if(this.html.countdown&&this.currentpuzzle&&"undefined"!=typeof this.currentpuzzle.eloSuccess){var n=this.currentpuzzle.eloSuccess-this.currentpuzzle.eloUser,i=this.currentpuzzle.duration||TacticTrainer.BaseServer.DURATION,r=(10>e?0:e>i?i:e)/i,o=this.currentpuzzle.eloUser+n-n*Math.pow(r,2),a=Math.min(this.currentpuzzle.eloSuccess,this.currentpuzzle.eloUser,this.currentpuzzle.eloFailure),s=Math.max(this.currentpuzzle.eloSuccess,this.currentpuzzle.eloUser,this.currentpuzzle.eloFailure),l=s-a;if(this.html.countdown.data("id")!=this.currentpuzzle.handlerId){this.html.countdown.data("id",this.currentpuzzle.handlerId),0==this.html.countdown.find(".line").length&&(this.html.countdown.html(new Handler.Template("tacticTrainer").render("tactics-countdown-classic")),this.html.countdown.eloCurrent=this.html.countdown.find(".current"),this.html.countdown.eloSuccess=this.html.countdown.find(".success"),this.html.countdown.eloFailure=this.html.countdown.find(".failure"),this.html.countdown.eloPromise=this.html.countdown.find(".pointer"),this.html.countdown.labelCurrent=this.html.countdown.find(".label-current"),this.html.countdown.labelSuccess=this.html.countdown.find(".label-success"),this.html.countdown.labelFailure=this.html.countdown.find(".label-failure"),this.html.countdown.labelPromise=this.html.countdown.find(".label-pointer"),this.html.countdown.find(".boardSettings").on("click",this.showSettings));var c="animate"}else c="css";var d=100*(this.currentpuzzle.eloUser-a)/l,u=100*(this.currentpuzzle.eloSuccess-a)/l,h=100*(this.currentpuzzle.eloFailure-a)/l,f=100*(o-a)/l;this.html.countdown.eloCurrent.stop()[c]({width:d+"%"},100),this.html.countdown.eloSuccess.stop()[c]({width:u+"%"},100),this.html.countdown.eloFailure.stop()[c]({width:h+"%"},100),this.html.countdown.eloPromise.stop()[c]({width:f+"%"},100);var p=this.html.countdown.find(".line").width()/100;return this.html.countdown.labelCurrent.html(this.currentpuzzle.eloUser).stop()[c]({left:Math.round(d*p-this.html.countdown.labelCurrent.width()/2)+"px"},100),this.html.countdown.labelSuccess.html(this.currentpuzzle.eloSuccess).stop()[c]({left:Math.round(u*p-this.html.countdown.labelSuccess.width())+"px"},100),this.html.countdown.labelFailure.html(this.currentpuzzle.eloFailure).stop()[c]({left:Math.round(h*p)+"px"},100),this.html.countdown.labelPromise.html(Math.floor(o)).stop()[c]({left:Math.round(f*p-this.html.countdown.labelPromise.width()/2)+"px"},100),this}},buildHtml:function(){this.container.html(new Handler.Template("tacticTrainer").render("tactics-classic"));var e={puzzle:this.container.find(".tacticTrainerPuzzle"),timeline:this.container.find(".tacticTrainerTimeline"),summary:this.container.find(".tacticTrainerSummary"),countdown:this.container.find(".tacticTrainerCountdown"),stopnow:this.container.find(".cBtn.stopnow"),stoplater:this.container.find(".cBtn.stoplater"),stoplateron:this.container.find(".stoplateron")};e.puzzleBundle=e.puzzle.add(e.stopnow).add(e.stoplater).add(e.stoplateron).add(this.container.find(".tacticTrainerButtons"));var t=this;return e.stopnow.on("click",function(){return t.stop(!1),!1}),e.stoplater.on("click",function(){return t.stop(!0),e.stoplater.hide(),e.stoplateron.show().find(":checkbox").attr("checked","true"),!1}),e.stoplateron.find(":checkbox").on("click",function(){t.halt=!1,e.stoplater.show(),e.stoplateron.hide()}),"always"==window.settings.get("tactics-stop")&&e.stoplater.hide(),this.container.find(".cPremium")[config.level().isPremium||config.level().isGuest?"hide":"show"](),this.container.find(".cRegister")[config.level().isGuest?"show":"hide"](),this.container.find(".tacticHeader")[config.level().isPremium?"addClass":"removeClass"]("noButtons"),jQuery(document).trigger("newhtml"),this.switchTimeline=function(){if(e.puzzle.is(":visible")){var n=window.settings.getBoolean("tactics-timeline");n?(e.countdown.show(),e.puzzleBundle=e.puzzleBundle.add(e.countdown),t.container.removeClass("smaller")):(e.countdown.hide(),e.puzzleBundle=e.puzzleBundle.not(e.countdown),t.container.addClass("smaller"))}},window.settings.on("settings.tactics-timeline",this.switchTimeline),this.switchTimeline(),e}}),TacticTrainer.SpeedServer=TacticTrainer.BaseServer.extend({__constructor:function(e,t){return this.settings=jQuery.extend({time:20},t),this.provider=new TacticTrainer.PuzzleProvider({type:"speed"}),this.timeLeft=this.settings.time,this.totalTime=this.settings.time,this.maxTime=this.settings.time+60,this.renderedTime=0,this.playing=!0,this.pauseTimer=!1,this.init(e),this},type:function(){return"speed"},next:function(e,t){this.handler&&jQuery.extend(this.currentpuzzle,this.handler.cancel().summary()),t&&(this.pauseTimer=!0),this.report(void 0,this.currentpuzzle,!0),e&&(this.totalTime=Math.min(this.totalTime+TacticTrainer.SpeedServer.REWARD,this.maxTime),this.createTimer(this.html.countdown,Math.min(this.timeLeft+TacticTrainer.SpeedServer.REWARD,this.totalTime))),t&&(this.totalTime+=TacticTrainer.BaseServer.DELAY);var n=this;setTimeout(function(){n.pauseTimer=!1,n.playing&&n.puzzle()},t?1e3*TacticTrainer.BaseServer.DELAY:0)},timer:function(e,t){if(!this.pauseTimer)if(this.timeLeft=this.totalTime-t,this.timeLeft<=0){var n=this.handler?!!this.handler.playing:!1;this.playing=!1,this.stopTimer(),this.resetTimer(!0),this.handler&&(jQuery.extend(this.currentpuzzle,this.handler.cancel(n).summary()),this.handler.remove()),this.session.length>1&&(this.session[this.session.length-2].eloResult=this.currentpuzzle.eloUser);var i=this;n?this.report(function(){i.showSummary()},this.currentpuzzle,!1):i.showSummary()}else this.updateTimer()},proceed:function(){this.hideSummary(),this.session=[],this.provider=new TacticTrainer.PuzzleProvider({type:"speed"}),this.currentpuzzle=null,this.timeline.update(this.session,!0),this.hideSummary(),this.html.puzzleBundle.show(),this.resetTimer(!0),this.puzzle()},buildHtml:function(){this.container.html(new Handler.Template("tacticTrainer").render("tactics-speed"));var e={puzzle:this.container.find(".tacticTrainerPuzzle"),countdown:this.container.find(".tacticTrainerCountdown"),timeline:this.container.find(".tacticTrainerTimeline"),summary:this.container.find(".tacticTrainerSummary")};return e.puzzleBundle=e.puzzle.add(e.countdown).add(e.skip),this.createTimer(e.countdown),this.container.find(".boardSettings").on("click",this.showSettings),this.container.find(".cPremium")[config.level().isPremium||config.level().isGuest?"hide":"show"](),this.container.find(".cRegister")[config.level().isGuest?"show":"hide"](),this.container.find(".tacticHeader")[config.level().isPremium?"addClass":"removeClass"]("noButtons"),jQuery(document).trigger("newhtml"),e},updateTimer:function(){this.html.countdown.find(".pointer").css("width",this.timeLeft/this.renderedTime*100+"%")},createTimer:function(e,t){if(t=t||this.totalTime,t<=this.renderedTime)return this;this.renderedTime=t,e.html(new Handler.Template("tacticTrainer").render("tactics-countdown-speed"));for(var n=e.find(".line"),i=0,r=n.width(),o=0;o<=this.renderedTime;o+=60){var a=r*(o/this.renderedTime),s=(jQuery("<div/>").addClass("dash").appendTo(n).css("width",a+"px"),jQuery("<div/>").addClass("label").appendTo(n).html(i));s.css("left",a-s.width()/4+"px"),++i}return n.find(".pointer").css("width",n.width()+"px"),this}}),TacticTrainer.SpeedServer.REWARD=3,TacticTrainer.SpeedServer.MAX_REWARD=60,"undefined"==typeof TacticTrainer&&(TacticTrainer={}),TacticTrainer.Timeline=inheritable.extend({__constructor:function(e){return this.container=jQuery(e),this.container.length||(this.container=null),this},update:function(e,t){if(!this.container)return this;this.container.html(new Handler.Template("tacticTrainer").render("tactics-timeline",{items:e,playing:t})),this.container[t?"addClass":"removeClass"]("playing"),this.scroller=this.container.find(".tacticTrainerTimelineItems"),this.items=this.scroller.find("a"),this.pager=this.container.find(".pager");var n=this.items.first().outerWidth()+parseInt(this.items.first().css("margin-left"),10)+parseInt(this.items.first().css("margin-right"),10);return this.scroller.css("width",this.items.length*n+"px"),this.updatePager(),this.setupDragging(),this.scroll(e.length),this},updatePager:function(){if(!this.container)return this;for(var e=this.container.width()-2*parseInt(this.scroller.css("margin-left"),10),t=this.items.first(),n=this.scroller.find("a").length*(t.outerWidth()+parseInt(t.css("margin-left"),10)+parseInt(t.css("margin-right"),10)),i=this,r=Math.ceil(n/e),o=0;r>o;o++)this.pager.append(jQuery("<a/>").on("click",function(e){return function(){i.scroll(e)}}(o)));this.pager.find("a:first").addClass("active"),this.pager.show(),this.container.addClass("withPager")},setupDragging:function(){var e,t,n=this,i=function(i){n.scrollTo(e+i.pageX-t,!1);try{i.preventDefault()}catch(r){}return!1},r=function(e){Math.abs(e.pageX-t)>10&&n.pager.find(".active").removeClass("active"),jQuery(document).off("mousemove",i).off("mouseup",r)};return this.container.off("mousedown").on("mousedown",function(o){return e=parseInt(n.scroller.css("left"),10),t=o.pageX,jQuery(document).on("mousemove",i).on("mouseup",r),o.preventDefault(),!1}),this},realwidth:function(){var e=this.items.first();return this.scroller.find("a").length*(e.outerWidth()+parseInt(e.css("margin-left"),10)+parseInt(e.css("margin-right"),10))},scrollTo:function(e,t){var n=parseInt(this.scroller.css("margin-left"),10),i=this.container.width()-2*n,r=this.realwidth();return i>r?this:(e=Math.min(e,0),e=Math.max(e,-(r-i)),t?this.scroller.stop().animate({left:e+"px"},200):this.scroller.css("left",e+"px"),this)},scroll:function(e){if(!this.container)return this;var t=parseInt(this.scroller.css("margin-left"),10),n=this.container.width()-2*t;return this.scrollTo(-(n+t)*e,!0),this.pager.find("a").removeClass("active"),this.pager.find("a:eq("+e+")").addClass("active"),this},scrollItem:function(e){if(!this.container)return this;var t=parseInt(this.scroller.css("margin-left"),10),n=this.items.filter("[data-id="+e+"]");if(!n.length)return this;var i,r=n.offset(),o=this.container.offset(),a=o.left+2*t-r.left,s=r.left-(o.left+this.container.width()-3*t);a>0?(i=Math.min(0,parseInt(this.scroller.css("left"),10)+a),this.scrollTo(i,!0)):s>0&&(i=parseInt(this.scroller.css("left"),10)-Math.min(parseInt(this.scroller.width(),10),s),this.scrollTo(i,!0))},callback:function(e){return this.container?("function"!=typeof e?this.items.off("click"):this.items.on("click",function(){var t=jQuery(this);e(t.data("id"),t.data("failure"))}),this):this},engage:function(e){return this.container&&this.items.eq(e||0).click(),this},highlight:function(e){return this.container?(this.items.filter(".active").removeClass("active"),this.items.filter("[data-id="+e+"]").addClass("active"),void this.scrollItem(e)):this}}),jQuery.fn.editorextensions=jQuery.fn.editorextensions||{},jQuery.fn.editorextensions.align=function(e,t){return{index:function(t){return["left","right","center","justify"].contains(t)?function(n){var i=e.extensions.dom.getSelection();if(i){var r=i.startContainer,o=i.endContainer;if(r==e.get(0)&&(r=e.get(0).firstChild),o==e.get(0)&&(o=e.get(0).lastChild),r==o){for(var a=r;a&&(3==a.nodeType||!e.extensions.dom.isBlockElement(a));)a=a.parentNode;a&&(t=jQuery(a).hasClass("align"+t)?"left":t,jQuery(a).removeClass("alignleft alignright aligncenter alignjustify").addClass("align"+t))}else{var s=e.extensions.dom.treeToVector(e.get(0).childNodes,e.extensions.dom.isBlockElement);r=e.extensions.dom.findBlockParent(r),o=e.extensions.dom.findBlockParent(o),0==i.endOffset&&o.previousSibling&&(o=o.previousSibling);var l=s.indexOf(r),c=s.indexOf(o);if(-1==l)return t=e.hasClass("align"+t)?"left":t,void e.removeClass("alignleft alignright aligncenter alignjustify").addClass("align"+t);-1==c&&(c=s.length-1);for(var d=!0,u=l;c>=u;u++)if(!jQuery(s[u]).hasClass("align"+t)){d=!1;break}for(t=d?"left":t,u=l;c>=u;u++)jQuery(s[u]).removeClass("alignleft alignright aligncenter alignjustify").addClass("align"+t)}}}:function(){}},toolbuttons:{alignleft:{name:window.t("Align left"),icon:"alignleft.png",onclick:function(e){this.extensions.align.index("left")(e)},highlight:function(e){return this.extensions.highlight.check(e,"",{"text-align":"left start"})},shortcut:"Ctrl-L"},aligncenter:{name:window.t("Align center"),icon:"aligncenter.png",onclick:function(e){this.extensions.align.index("center")(e)},highlight:function(e){return this.extensions.highlight.check(e,".aligncenter")}},alignright:{name:window.t("Align right"),icon:"alignright.png",onclick:function(e){this.extensions.align.index("right")(e)},highlight:function(e){return this.extensions.highlight.check(e,".alignright")},shortcut:"Ctrl-R"},alignjustify:{name:window.t("Align full"),icon:"alignjustify.png",onclick:function(e){this.extensions.align.index("justify")(e)},highlight:function(e){
return this.extensions.highlight.check(e,".alignjustify")}}},provides:{attributes:{p:["class"],h1:["class"],h2:["class"],h3:["class"],blockquote:["class"],li:["class"]}}}},jQuery.fn.editorextensions=jQuery.fn.editorextensions||{},jQuery.fn.editorextensions.browser=function(e,t){var n,i,r,o,a,s;return{open:function(){n||(n=jQuery("<div/>").addClass("editor-browser").appendTo("body"),i=jQuery("<div/>").addClass("editor-browser-folders").appendTo(n),r=jQuery("<div/>").addClass("editor-browser-files").appendTo(n),o=jQuery("<div/>").addClass("editor-browser-meta").appendTo(n),n.modal()),n.modal("show")},close:function(){n.modal("hide")},renderFolders:function(e){var t=this,n=function(e){for(var i=jQuery("<ul/>"),r=0;r<e.length;r++){var o=jQuery("<li/>").appendTo(i).data("name",e[r].data.name),a=jQuery("<a/>").html(e[r].name).on("click",function(e){return function(){t.expandCollapseFolder(e.data.name),t.loadFiles(e)}}(e[r]));o.append(a),e[r].folders&&o.append(n(e[r].folders))}return i};i.html("").removeClass("loading").append(n(e))},renderFiles:function(e,t){for(var n=this,i=jQuery("<ul/>"),o=0;o<e.length;o++){var l=jQuery("<li/>").appendTo(i),c=jQuery("<a/>").html(e[o].name).addClass("folder").on("click",function(e){return function(){a=e.data.name,n.expandCollapseFolder(e.data.name),n.loadFiles(e)}}(e[o]));l.append(c)}for(var o=0;o<t.length;o++){var l=jQuery("<li/>").appendTo(i),c=jQuery("<a/>").addClass("file").html(t[o].name).on("click",function(e){return function(){s=e.data.name,n.renderMeta(e)}}(t[o])).on("dblclick",function(e){return function(){n.reportAndClose(e)}}(t[o]));l.append(c)}r.html("").removeClass("loading").append(i)},expandCollapseFolder:function(e){i.find("li").each(function(){var t=jQuery(this);t.data("name")==e&&(t.parentsUntil(i,"ul").show(),t.find("> ul").toggle())})},renderMeta:function(e){o.html("Chosen file: "+e.name)},loadFiles:function(e){var n=this;r.html("").addClass("loading"),jQuery.getJSON(t.browserFiles,{type:"file",folder:e?e.data.name:""},function(e){n.renderFiles(e.data.folders,e.data.files)})},reportAndClose:function(e){"function"==typeof this.callback&&this.callback(e),this.close()},load:function(e){var n=this;i.html("").addClass("loading"),jQuery.getJSON(t.browserFolders,{type:"file"},function(e){n.renderFolders(e.data.folders)}),this.loadFiles()},loading:function(){i&&i.addClass("loading"),r&&r.addClass("loading")},index:function(e){this.open(),this.load(e),this.callback=e?e.callback:null}}},jQuery.fn.editorextensions=jQuery.fn.editorextensions||{},jQuery.fn.editorextensions.character=function(e,t){var n=[{text:"&#33;",title:"Glyph 1"},{text:"&#63;",title:"Glyph 2"},{text:"&#x203C;",title:"Glyph 3"},{text:"&#x2047;",title:"Glyph 4"},{text:"&#x2049;",title:"Glyph 5"},{text:"&#x2048;",title:"Glyph 6"},{text:"&#x25A1;",title:"Glyph 7"},{text:"&#61;",title:"Glyph 8"},{text:"&#x221E;",title:"Glyph 9"},{text:"&#43;/&#61;",oldtext:"&#x2A72;",title:"Glyph 10"},{text:"&#61;/&#43;",oldtext:"&#x2A71;",title:"Glyph 11"},{text:"&plusmn;",title:"Glyph 12"},{text:"&#x2213;",title:"Glyph 13"},{text:"&#43;&minus;",title:"Glyph 14"},{text:"&minus;&#43;",title:"Glyph 15"},{text:"&#x2A00;",title:"Glyph 16"},{text:"&#x25CB;",title:"Glyph 17"},{text:"&#x27F3;",title:"Glyph 18"},{text:"&#x2192;",title:"Glyph 19"},{text:"&#x2191;",title:"Glyph 20"},{text:"&#61;/&#x221E;",title:"Glyph 21"},{text:"&#x21C6;",title:"Glyph 22"},{text:"&#x2295;",title:"Glyph 23"},{text:"&#x2206;",title:"Glyph 24"},{text:"&#x2313;",title:"Glyph 25"},{text:"N",title:"Glyph 26"},{text:"&#x21D4;",title:"Glyph 27"},{text:"&#x21D7;",title:"Glyph 28"},{text:"&#x27EB;",title:"Glyph 29"},{text:"&#x27EA;",title:"Glyph 30"},{text:"&#x2715;",title:"Glyph 31"},{text:"&#x22A5;",title:"Glyph 32"}],i=0;return{index:function(t){var r=e.extensions.dom.getSelection();if(r){for(var o=jQuery("<div/>"),a=0;a<n.length;a++)a>0&&a%8==0&&o.append("<br/>"),o.append(jQuery("<span/>").addClass("editor-dialog-character").html(n[a].text).attr("title",n[a].title).on("mousedown",function(t){e.setFocus(!0);var n=jQuery("<span/>").addClass("glyph").html(jQuery(this).html());e.insertAtCursor(n),n.after("&nbsp;");var i=n.get(0).nextSibling;return e.extensions.dom.setCursor(i,"after"),e.registerCursor(),e.hideToolDialog(),!1}));setTimeout(function(){e.hideToolDialog(i)||(i=e.showToolDialog(o,t))},10)}},toolbuttons:{character:{name:window.t("Special characters"),icon:"character.png",onclick:function(e){this.extensions.character.index(e)}}},provides:{tags:["span"],attributes:{span:["class"]}}}},jQuery.fn.editorextensions=jQuery.fn.editorextensions||{},jQuery.fn.editorextensions.chess=function(e,t){var n=0,i={csrf:config.csrf()},r=["Title","Description","Event","Site","Date","White.Name","White.Elo","Black.Name","Black.Elo","Round","ECO","Annotator","Result","Source"];t&&Widgets.Chess().chessBase.init(t.chessGames);var o=function(e){var t=jQuery("<div/>").addClass("game-builder"),n="4k3/8/8/8/8/8/8/4K3 w - - 0 1",i=!1;e?i=!0:e=new Chess.Game;var r,o,a,s,l=!!i,c=function(n){if(l){var i=e.getCurrentPosition(),r=!i.isRootPosition(),o=i.isRootPosition()?!1:i.parentMove.childrenMoves[0]!=i;t.find(".cBtn.remove")[r?"removeClass":"addClass"]("disabled"),t.find(".cBtn.promote")[o?"removeClass":"addClass"]("disabled"),"move"==n.currentChannel&&t.trigger("chess24:change")}else v(e.getCurrentPosition())},d=function(){var n=jQuery("<div/>").addClass("popupInsider").css("width","315px").append(jQuery("<div/>").addClass("dialogContent").append("<p>"+window.t("Please insert your FEN string here")+"</p>").append('<input type="text" class="cPattern"/>')).append(jQuery("<div/>").addClass("dialogFooter"));n.find(".dialogFooter").append(jQuery("<a/>").addClass("cBtn cBtnGrey").html("OK").on("click",function(){var t=n.find("input").val(),i=Chess.isFen(t);if(!i||!i.valid)return n.find(".dialogContent p").addClass("error").html(window.t("This is not a valid FEN string")+"</p>"),void n.find("span.inputTextWrapper, input").addClass("inputError");var o=new Chess.Position({fen:t,validators:e.getRules()});e.setStartPosition(o),r.gotoStart(),n.modal("hide"),m()})).append(jQuery("<a/>").addClass("cBtn cBtnWhite").html("Cancel").on("click",function(){n.modal("hide")})),n.modal({classes:"defaultPopup",align:t}).modal("show"),jQuery(document).trigger("newhtml")},u=function(){D.show(),t.find("h4").html(window.t("Step 1: set up the starting position")),t.find(".headline").html(window.t("Move pieces around to set up the position from which the game should start")),e.setRules("build"),o.movementHandler.activate(),o.highlightHandler.deactivate(),T.hide(),I.show(),_.hide(),S.hide(),j.find(".chess-board").css("overflow","visible")},h=function(){e.setStartPosition(new Chess.Position({fen:Chess.defaultFen,validators:e.getRules()})),r.gotoStart(),m()},f=function(){e.setStartPosition(new Chess.Position({fen:n,validators:e.getRules()})),r.gotoStart(),m()},p=function(){var n=e.getCurrentPosition();n.moveRight=t.find(".moveright-w").is(":checked")?"w":"b",n.moveCounter=B.find("input").val()||1,n.ep=E.find("select").get(0).selectedIndex>0?parseInt(E.find("select").val()):-1,n.castlingRights=[!!t.find(".castling-w-2").is(":checked"),!!t.find(".castling-w-3").is(":checked"),!!t.find(".castling-b-2").is(":checked"),!!t.find(".castling-b-3").is(":checked")],e.reOpen(),v(n)&&(l=!0,D.hide(),i||H.show(),t.find("h4").html(window.t("Step 2: create the game")),t.find(".headline").html(window.t("Make moves on the board")),i||e.setStartPosition(new Chess.Position({knotId:0,fen:n.toString(!0),dontCheckForInsufficentMaterial:!0})),e.setRules("play"),r.gotoStart(),o.movementHandler.activate(),o.highlightHandler.activate(),O.hide(),I.hide(),T.show(),_.show(),S.show(),H.removeClass("disabled"),j.find(".chess-board").css("overflow","hidden"))},m=function(){var n=e.getCurrentPosition();t.find(".moveright-w").attr("checked","w"==n.moveRight),t.find(".moveright-b").attr("checked","b"==n.moveRight),t.find(".castling-w-3").attr("checked",n.canCastleQueenside("w")),t.find(".castling-w-2").attr("checked",n.canCastleKingside("w")),t.find(".castling-b-3").attr("checked",n.canCastleQueenside("b")),t.find(".castling-b-2").attr("checked",n.canCastleKingside("b")),t.find(".game-builder-movenumber input").val(n.moveCounter)},g={k:[1,1],q:[0,9],r:[0,10],n:[0,10],b:[0,10],p:[0,8],white:[1,16],black:[1,16]},v=function(e){var n=!1,i=!1;O.removeClass("invalid").html(window.t("Position is valid"));for(var r=e.countPiecesOnBoard(),o=["k","q","r","n","b","p","K","Q","R","N","B","P","white","black"],a=0;a<o.length;a++)(r[o[a]]<g[o[a].toLowerCase()][0]||r[o[a]]>g[o[a].toLowerCase()][1])&&(n=!0);if(r.k&&r.K){var s=t.find(".moveright-w").is(":checked")?"w":"b";e.isAttacked(e.kingPos.b)&&e.isAttacked(e.kingPos.w)&&(i=!0),e.isAttacked(e.kingPos.b)&&"w"==s&&(i=!0),e.isAttacked(e.kingPos.w)&&"b"==s&&(i=!0)}var l="abcdefgh",c=t.find(".moveright-b").is(":checked")?3:4,d=t.find(".moveright-b").is(":checked")?"P":"p",u=3==c?2:5;E.find("option").not(":first").remove();for(var h=0;8>h;h++)e.getPiece(c,h)==d&&"-"==e.getPiece(u,h)&&E.find("select").append('<option value="'+h+'">'+l.substr(h,1)+"</option>");return E.find("select").selectBox("destroy").selectBox(),O[n||i?"addClass":"removeClass"]("invalid").html(window.t(n||i?"Invalid position":"Position is valid")),D[i?"addClass":"removeClass"]("disabled"),!i},y=function(){var n=e.getCurrentPosition();!n.isRootPosition()&&n.parentMove&&(e.deleteMove(),t.trigger("chess24:change"))},b=function(){var n=e.getCurrentPosition();!n.isRootPosition()&&n.parentMove&&0!=n.parentMove.childrenMoves.indexOf(n)&&(n.parentMove.childrenMoves.removeByValue(n),n.parentMove.childrenMoves.unshift(n),r.gotoId(n.knotId),t.trigger("chess24:change"))},w=function(){t.find("h4").html(window.t("Step 3: enter game details")),t.find(".headline").html(window.t("Please enter the basic game information. More details can be added after the game has been created")),H.hide(),N.show(),j.hide(),O.hide(),I.hide(),T.hide(),_.hide(),S.hide(),A.show(),A.find("select").selectBox("destroy").selectBox()},k=function(){e.setMeta("Title",A.find("[name=title]").val()),e.setMeta({White:{Name:A.find("[name=white]").val()||"?"}}),e.setMeta({Black:{Name:A.find("[name=black]").val()||"?"}}),e.setMeta("Result",A.find("[name=result]").val()||"*"),e.setMeta("SourceFile","Generated")},x=config.assetDir()+"/images",C=x+"/chess/themes/pieces/chess24/";jQuery("<p/>").appendTo(t).append(jQuery("<a/>").addClass("cBtn cBtnWhite").append('<img src="'+x+'/editor/exercise-back.png"/>').append(window.t("Back")).on("click",function(){t.trigger("chess24:hide")})).append(jQuery("<h4/>")).after(jQuery("<p/>").addClass("headline"));var j=jQuery("<div/>").attr("id","game-builder-board").addClass("game-builder-board").appendTo(t),T=jQuery("<div/>").addClass("game-builder-notation").appendTo(t).hide().append(jQuery("<div/>").attr("id","game-builder-notation"));t.append('<br class="clear"/>');var _=jQuery("<div/>").attr("id","game-builder-cursor").addClass("game-builder-cursor").appendTo(t),S=jQuery("<div/>").attr("id","game-builder-playbuttons").appendTo(t).append(jQuery("<a/>").html("Delete move").addClass("cBtn cBtnWhite remove disabled").on("click",y)).append(jQuery("<a/>").html("Promote move").addClass("cBtn cBtnWhite promote disabled").on("click",b)),I=jQuery("<div/>").addClass("game-builder-start").insertBefore(T).hide(),P=jQuery("<div/>").addClass("game-builder-figures").appendTo(I).append(jQuery("<img/>").attr("src",C+"white/p.png").data("new-piece","P")).append(jQuery("<img/>").attr("src",C+"white/r.png").data("new-piece","R")).append(jQuery("<img/>").attr("src",C+"white/n.png").data("new-piece","N")).append(jQuery("<img/>").attr("src",C+"white/b.png").data("new-piece","B")).append(jQuery("<img/>").attr("src",C+"white/q.png").data("new-piece","Q")).append(jQuery("<img/>").attr("src",C+"white/k.png").data("new-piece","K")).append("<br/>").append(jQuery("<img/>").attr("src",C+"black/p.png").data("new-piece","p")).append(jQuery("<img/>").attr("src",C+"black/r.png").data("new-piece","r")).append(jQuery("<img/>").attr("src",C+"black/n.png").data("new-piece","n")).append(jQuery("<img/>").attr("src",C+"black/b.png").data("new-piece","b")).append(jQuery("<img/>").attr("src",C+"black/q.png").data("new-piece","q")).append(jQuery("<img/>").attr("src",C+"black/k.png").data("new-piece","k")),M=jQuery("<div/>").addClass("game-builder-trash").html(window.t("drag here to remove pieces")).prependTo(P),Q=jQuery("<div/>").addClass("game-builder-options").appendTo(I).append(jQuery('<input type="radio"/>').addClass("cPattern moveright-w").attr("name","moveRight").val("w").attr("checked","w"==e.getMoveRight())).append('<span>White to move</span><br class="clear"/>').append(jQuery('<input type="radio"/>').addClass("cPattern moveright-b").attr("name","moveRight").val("b").attr("checked","b"==e.getMoveRight())).append("<span>Black to move</span>").append('<br class="clear"/>');Q.find("input:radio").on("click",function(){v(e.getCurrentPosition())});var B=jQuery("<div/>").addClass("game-builder-movenumber").appendTo(Q).append(jQuery('<input type="text" value="1"/>').addClass("cPattern inputTextMini")).append(jQuery("<span/>").html("Move number")),E=jQuery("<div/>").addClass("game-builder-enpassant").appendTo(Q).append(jQuery("<select/>").append("<option>"+window.t("En passant")+"</option>")),O=(jQuery("<div/>").addClass("game-builder-options").appendTo(I).append(jQuery('<input type="checkbox"/>').addClass("cPattern castling-w-3").attr("checked",!0)).append(jQuery('<span>White O-O-O</span><br class="clear"/>')).append(jQuery('<input type="checkbox"/>').addClass("cPattern castling-w-2").attr("checked",!0)).append(jQuery('<span>White O-O</span><br class="clear"/>')).append(jQuery('<input type="checkbox"/>').addClass("cPattern castling-b-3").attr("checked",!0)).append(jQuery('<span>Black O-O-O</span><br class="clear"/>')).append(jQuery('<input type="checkbox"/>').addClass("cPattern castling-b-2").attr("checked",!0)).append(jQuery("<span>Black O-O</span>")),jQuery("<div/>").addClass("game-builder-valid").html(window.t("Position is valid")).appendTo(I));I.append(jQuery("<div/>").addClass("game-buider-positionsetup").append(jQuery("<a/>").addClass("cBtn cBtnWhite").html(window.t("Enter FEN")).on("click",d)).append(jQuery("<a/>").addClass("cBtn cBtnWhite").html(window.t("Reset")).on("click",h)).append(jQuery("<a/>").addClass("cBtn cBtnWhite").html(window.t("Clear")).on("click",f)));var A=jQuery("<div/>").addClass("game-builder-meta").appendTo(t).hide().append("<label>Title for game</label>").append('<input type="text" class="cPattern" name="title"/>').append('<br class="clear"/>').append("<label>White player</label>").append('<input type="text" class="cPattern" name="white"/>').append('<br class="clear"/>').append("<label>Black player</label>").append('<input type="text" class="cPattern" name="black"/>').append('<br class="clear"/>').append("<label>Result</label>").append(jQuery('<select class="cPattern" name="result"/>').append('<option value="1-0">1-0</option>').append('<option value="0-1">0-1</option>').append('<option value="1/2-1/2">&#189;-&#189;</option>').append('<option value="*">*</option>'));t.append('<br class="clear"/>');var D=jQuery("<a/>").hide().appendTo(t).addClass("cBtn cBtnWhite position").html(window.t("Use this position")).on("click",p),H=jQuery("<a/>").hide().appendTo(t).addClass("cBtn cBtnWhite moves disabled").html(window.t("Proceed to entering the game details")).on("click",w),N=jQuery("<a/>").hide().appendTo(t).addClass("cBtn cBtnWhite submit").html(window.t("Save game")).on("click",function(){k(),t.trigger("chess24:done",e)});return M.droppable({drop:function(t,n){var i=n.draggable.parent();if(i.is("div.cell")){for(var o,a=i.attr("class").split(" "),s=0;s<a.length;s++)if(a[s].match(/^_\d\d$/)){o=a[s].substr(1);break}if(o){var l=Chess.getSquare(parseInt(o.substr(0,1)),parseInt(o.substr(1,1))),c=e.getCurrentPosition().setPiece(l,"-");e.setStartPosition(new Chess.Position({fen:c.toString(!0),validators:e.getRules()})),r.gotoStart(),M.removeClass("mouseover")}}},over:function(e,t){M.addClass("mouseover")},out:function(e,t){M.removeClass("mouseover")}}),P.find("img").draggable({helper:"clone",zIndex:100,distance:5,start:function(e,t){},stop:function(e,t){}}),t.start=function(){t.css({overflow:"visible",height:"auto"}),r=(new Chess.GameHandler).addGame("game-builder",e),o=new View.ChessBoard("#game-builder-board",!0).link(r),a=new View.NotationArea("#game-builder-notation").link(r),s=new View.Cursor("#game-builder-cursor",!1,function(){o.flip()}).link(r),o.movementHandler.switchAutoQueen(!1);var n={};Extend.Subscriber(n,{move:c,"movedPositionPointer.current":c}),n.link(r),i?p():u(),E.find("select").selectBox(),jQuery(document).trigger("newhtml")},t},a=function(e,t,n){e&&jQuery(e).length?e=jQuery(e).addClass("position-builder"):e&&jQuery(e).length||(e=jQuery("<div/>").addClass("position-builder"));var i="4k3/8/8/8/8/8/8/4K3 w - - 0 1",r=e.find(".position-builder-board"),o=e.find(".position-builder-fen"),a=e.find(".position-builder-reset"),s=e.find(".position-builder-clear");r.length||(r=jQuery("<div/>").addClass("position-builder-board").appendTo(e)),o.length||(o=jQuery("<div/>").addClass("position-builder-fen").appendTo(e));var l=new Chess.GameHandler,c=new View.ChessBoard(r,!0).link(l).attachPositionHandler(l),d=new Chess.Game({ruleSet:"build"});l.addGame("position-builder",d).setCurrentGame("position-builder"),c.movementHandler.switchPersistentHighlights(!0),c.movementHandler.deactivate("click"),d.on("movedPositionPointer.current",function(e,t){h(t)}),l.on("position.highlights",function(e,t){h(l.getCurrentPosition())}),l.on("currentGameChanged",function(){"position-builder"==l.getCurrentGameKey()?c.movementHandler.deactivate("click").activate("dragDrop"):c.movementHandler.deactivate()});var u=function(e){var t=Chess.isFen(e);return t&&t.valid?(c.movementHandler.deactivate("click").activate("dragDrop"),d.setStartPosition(new Chess.Position({fen:e,validators:d.getRules()})),!0):!1},h=function(t){e.trigger("chess24:change",{fen:t.toString(!0),highlights:f(t.getHighlights())})},f=function(e){for(var t=[],n=0;n<e.length;n++)e[n].square?t.push({square:{x:e[n].square.x,y:e[n].square.y},color:e[n].color}):e[n].frame?t.push({frame:{x:e[n].frame.x,y:e[n].frame.y},color:e[n].color}):e[n].line&&t.push({line:{x1:e[n].line.x1,y1:e[n].line.y1,x2:e[n].line.x2,y2:e[n].line.y2},color:e[n].color});return t};if(o.on("click",function(){var e=jQuery("<div/>").addClass("popupInsider").css("width","315px").append(jQuery("<div/>").addClass("dialogContent").append("<p>"+window.t("Please insert your FEN string here")+"</p>").append('<input type="text" class="cPattern"/>')).append(jQuery("<div/>").addClass("dialogFooter"));e.find(".dialogFooter").append(jQuery("<a/>").addClass("cBtn cBtnGrey").html("OK").on("click",function(){var t=e.find("input").val();u(t)?e.modal("hide"):(e.find(".dialogContent p").addClass("error").html(window.t("This is not a valid FEN string")+"</p>"),e.find("span.inputTextWrapper, input").addClass("inputError"))})).append(jQuery("<a/>").addClass("cBtn cBtnWhite").html("Cancel").on("click",function(){e.modal("hide")})),e.modal({classes:"defaultPopup"}).modal("show"),jQuery(document).trigger("newhtml")}),a.on("click",function(){u(Chess.defaultFen)}),s.on("click",function(){u(i)}),u(t||Chess.defaultFen),n)for(var p=0;p<n.length;p++)n[p].square?d.addHighlight({square:Chess.getSquare(n[p].square.y,n[p].square.x),color:n[p].color}):n[p].frame?d.addHighlight({frame:Chess.getSquare(n[p].frame.y,n[p].frame.x),color:n[p].color}):n[p].line&&d.addHighlight({line:Chess.getMove(n[p].line.y1,n[p].line.x1,n[p].line.y2,n[p].line.x2),color:n[p].color});return e.data("handler",l),e};return{gameBuilder:o,positionBuilder:a,helperBoard:null,showHelperBoard:function(){var t=this;if(this.helperBoardcontainer=jQuery(".helper-board"),this.helperBoardcontainer.length)this.helperBoardcontainer.show();else{this.helperBoardcontainer=jQuery("<div/>").addClass("helper-board").appendTo("body"),this.helperBoardcontainer.append(jQuery("<div/>").attr("id","helper-board-handle").on("mousedown",function(e){var n=t.helperBoardcontainer.offset().left-jQuery(document).scrollLeft(),i=t.helperBoardcontainer.offset().top-jQuery(document).scrollTop(),r=function(r){t.helperBoardcontainer.css({left:n+r.pageX-e.pageX+"px",top:i+r.pageY-e.pageY+"px"})},o=function(){jQuery(document).off("mousemove",r).off("mouseup",o)};return jQuery(document).on("mousemove",r).on("mouseup",o),e.preventDefault(),e.stopPropagation(),!1}).append(jQuery("<a/>").html(window.t("close")).on("click",function(){t.hideHelperBoard()}))),this.helperBoardcontainer.append(jQuery("<div/>").attr("id","helper-board-board")),e.extensions.widgets&&this.helperBoardcontainer.append(jQuery("<a/>").addClass("cBtn cBtnWhite").html("Insert Diagram").on("click",function(){var n={wid:"chess-board",vid:null,properties:jQuery.extend({},Widgets.ChessBoard().properties,{fen:t.helperBoard.getCurrentPosition().toString(!0)}),resources:[]};e.extensions.widgets.instantCreate(n)})),this.helperBoard=new View.ChessBoard("#helper-board-board",!1);var n=Widgets.Chess().chessBase,i=n.getViews(),r=[];for(var o in i)for(var a=n.getControllersForView(o),s=0;s<a.length;s++)r.contains(a[s])||r.push(a[s]);for(var s=0;s<r.length;s++)this.helperBoard.link(n.getController(r[s]));n.on("newcontroller",function(e){t.helperBoard.link(e)})}},hideHelperBoard:function(){this.helperBoardcontainer&&this.helperBoardcontainer.closest(".helper-board").hide()},convertLink:function(t){var n=jQuery(t);e.extensions.widgets.createWidget("chess-jump-to-link",n)},restoreLink:function(t){var n=jQuery(t),i=jQuery("<a/>").html(n.html()).attr("href","http://");n.replaceWith(i),e.extensions.link&&(e.extensions.link.setup(),i.trigger("dblclick"))},editGame:function(e,n){var o=Widgets.Chess().chessBase;o.init(t.chessGames);var a=this,s=n.find(".form");if(s.length)return void s.animate({height:"0px"},200,function(){s.remove()});s=jQuery("<div/>").addClass("form").appendTo(n).hide();for(var l=o.getGameJson(e),c=0;c<r.length;c++){var d,u=r[c];if(-1<r[c].indexOf(".")){for(var h=u.split("."),d=l.meta,f=0;f<h.length;f++)d=d[h[f]];u=r[c].replace("."," ")}else d=l.meta[r[c]];s.append(jQuery("<label/>").html(window.t(u))),s.append(jQuery('<input type="text"/>').attr("name",r[c]).val(d))}s.append(jQuery("<label/>").html("&nbsp;")),s.append(jQuery('<input type="button"/>').addClass("save cPattern").attr("value",window.t("Save")).on("click",function(){var t=jQuery.extend({id:e,attribute:"chessGame.meta"},i),r=o.getGame(e).getMeta();s.find("input").not(".save").each(function(){t["data["+this.name.replace(/\./g,"][")+"]"]=this.value;for(var e=this.name.split("."),n=r,i=0;i<e.length-1;i++)"undefined"==typeof n[e[i]]&&(n[e[i]]={}),n=n[e[i]];n[e[e.length-1]]=this.value}),o.getGame(e).setMeta(r),a.editGame(e,n),jQuery.post("/api/web/couchAPI/partialUpdate",t,function(){n.find("strong").html(r.Title);var e=o.getViews(),t=[];for(var i in e)for(var a=o.getControllersForView(i),s=0;s<a.length;s++)t.contains(a[s])||t.push(a[s]);for(var s=0;s<t.length;s++)o.getController(t[s]).emit("currentGameChanged")})}));var p=s.height();s.css("height","0px").show().animate({height:p+"px"},200,function(){s.css("height","auto")}),jQuery(document).trigger("newhtml")},loadList:function(){var t=this;this.listContainer.html("").show();var n={},i=0;for(var r in e.config.chessGames)if("object"==typeof e.config.chessGames[r]){i++;var o=jQuery.extend({id:r},e.config.chessGames[r]),a=o.meta.SourceFile||"_";n[a]||(n[a]=[]),n[a].push(o)}if(!i)return void t.empty.add(t.form.find(".hint")).show();t.empty.add(t.form.find(".hint")).hide();for(var a in n){var s=n[a];"_"!=a&&t.listContainer.append(jQuery('<div class="label">'+a+"</div>").append(jQuery("<a/>").html("remove").on("click",function(e){return function(){for(var n=[],i=0;i<e.length;i++)n.push(e[i].id);t.removeGames(n)}}(n[a])))).append(jQuery('<div class="label right"/>').append(jQuery("<a/>").html("Insert all as viewer").on("click",function(e){return function(){for(var n=[],i=0;i<e.length;i++)n.push(e[i].id);t.insertAllAsBubble(n)}}(n[a]))));for(var l=jQuery("<ul/>").appendTo(t.listContainer),c=0;c<s.length;c++){var d=s[c].meta.Title?s[c].meta.Title.replace(/\{([^}]+)\}/g,function(e){return s[c].meta[e.replace(/[\{\}]/g,"")]||"{"+e+"}"}):"";l.append(jQuery("<li/>").append(jQuery("<strong/>").html(d)).append(" - "+s[c].meta.Date).append("<br/>").append(window.t("Annotated by {annotator}",{"{annotator}":s[c].meta.Annotator})).append(" - ").append(jQuery("<a/>").html(window.t("Edit details")).on("click",function(e){return function(){t.editGame(e,jQuery(this).closest("li"))}}(s[c].id))).append(" - ").append(jQuery("<a/>").html(window.t("Remove")).on("click",function(e){return function(){t.removeGames([e])}}(s[c].id))).append(jQuery("<a/>").addClass("close").html("x").on("click",function(e){return function(){t.removeGames(e)}}(s[c].id))).append(jQuery("<a/>").addClass("cBtn cBtnGrey").html(window.t("insert")).on("click",function(e,n){return function(){t.insertContent(e,n)}}(s[c].id,s[c].meta.AnnotationId))))}}t.loading.html("").hide(),t.listContainer[t.listContainer.find("ul").length?"show":"hide"](),t.listContainer.get(0).scrollHeight>t.listContainer.height()?t.uploadContainer.addClass("overflow"):t.uploadContainer.removeClass("overflow")},insertAllAsBubble:function(t){if(e.extensions.widgets){var n=this;this.loading.html(window.t("Creating chess board view...")).show();for(var i={wid:"chess-bubble",vid:null,properties:{name:"Games",hidetools:!1},resources:[]},r=0;r<t.length;r++)i.resources.push({"class":"chessGame",reference_id:t[r],properties:{}});this.listContainer.hide(),this.loading.html(window.t("Loading data...")).show(),Widgets.Chess().chessBase.init(e.config.chessGames),e.extensions.widgets.instantCreate(i),n.loading.html(window.t("Finalizing...")).show(),e.hideToolDialog()}},insertContent:function(n,r){Widgets.Chess().chessBase.init(t.chessGames);var o=this;this.listContainer.hide(),this.loading.html(window.t("Loading data...")).show(),jQuery.post("/api/web/couchAPI/prepareMerge",jQuery.extend({source_id:r},i),function(i){if(0==i.status){o.loading.html(window.t("Auto-formatting content...")).show();var a=jQuery("<div/>"),s=jQuery("<p/>").append(i.data.content);a.append(s);var l=function(n){o.loading.html(window.t("Finalizing...")).show(),Widgets.Chess().chessBase.init(e.config.chessGames),n&&(a.prepend(jQuery("<p/>").append(n)),Widgets.ChessBubble().create(n,e,t),Widgets.ChessView().linkLinksToWidget(a,a.find(e.widgetmask),t,!1)),e.insertAtCursor(a.contents()),e.rescueOrphans(),e.removeUnwanted(),e.setupWidgets()};if(e.hideToolDialog(),e.extensions.widgets&&e.isWidgetAllowed("chess-bubble")){var c={wid:"chess-bubble",vid:null,properties:{name:r,hidetools:!1},resources:[{"class":"chessGame",reference_id:n,properties:{}}]};c.resources[0]["default"]=!0,o.loading.html(window.t("Creating chess board view...")).show(),e.extensions.widgets.borrowedWidgets(a.find(e.widgetmaskInline)),l(e.extensions.widgets.instantCreate(c,!0))}else l();a.remove(),delete a}else e.showToolDialogErrors(i.errors);o.loading.html("").hide(),o.listContainer.show()}).error(function(t,n,i){var r=jQuery.parseJSON(t.responseText);e.showToolDialogErrors(r.errors),o.loading.html("").hide(),o.listContainer.show()})},removeGames:function(n){var i=this,r=["id="+t.formData.cid];if(jQuery.isArray(n))for(var o=0;o<n.length;o++)r.push("reference_id[]="+n[o]);else r.push("reference_id="+n);r.push("csrf="+config.csrf()),jQuery.post("/api/web/couchAPI/remove",r.join("&"),function(t){0==t.status?(e.config.chessGames[n]=void 0,i.loadList(),e.hideToolDialogErrors()):e.showToolDialogErrors(t.errors)}).error(function(t,n,i){var r=jQuery.parseJSON(t.responseText);e.showToolDialogErrors(r.errors)})},setupUpload:function(){var n=this;jQuery('<input type="hidden"/>').appendTo(this.uploadContainer).attr("name","type").val("pgn").attr("id","editor-chess-type");var i=jQuery('<input type="file"/>').appendTo(this.uploadContainer).addClass("cPattern").attr("name","file").attr("data-url","/api/web/couchAPI/upload").attr("data-filters","editor-chess-type,editor-chess-link");i.on("chess24:add",function(t,n){n.formData=jQuery.extend(n.formData||{},e.config.formData),e.hideToolDialogErrors()}).on("chess24:done",function(i,r){var o=r.result;if(0==o.status){if(e.hideToolDialogErrors(),n.uploadContainer.find(".fileUploadProgress,.fileUploadDetails").remove(),o.data.result){var a=Widgets.Chess().chessBase;a.init(t.chessGames),e.config.chessGames||(e.config.chessGames={});for(var s in o.data.result)a.addGame(s,o.data.result[s]),e.config.chessGames[s]=o.data.result[s]}e.hideToolDialogErrors()}else e.showToolDialogErrors(o.errors);n.loadList(),n.uploadContainer.find(".inputFileUpload .cBtn").html(window.t("Add file"))}).on("chess24:error",function(t,i){try{var r=jQuery.parseJSON(jQuery("<div/>").html(i.responseText.replace(/\r\n/g,"")).text());e.showToolDialogErrors(r.errors)}catch(t){console.error(i.responseText)}n.uploadContainer.find(".fileUploadProgress,.fileUploadDetails").remove(),n.loadList()}).on("chess24:progress",function(e,t){100==t&&(n.listContainer.hide(),n.empty.add(n.form.find(".hint")).hide(),n.loading.html(window.t("Processing uploaded file...")).show())})},index:function(t){var i=this;this.form=jQuery("<div/>"),this.form.append(jQuery("<h2/>").html(window.t("Add games or exercises"))),this.form.append(jQuery('<p class="hint"/>').html(window.t("Here you can add a single game, a game viewer or exercises for your readers"))),this.empty=jQuery("<p/>").addClass("editor-chess-list-empty").html(window.t("Get started by uploading some games! Please note that the current limit is 5 games per PGN file.")).hide().appendTo(this.form),this.loading=jQuery("<div/>").addClass("editor-chess-loading").hide().appendTo(this.form),this.listContainer=jQuery("<div/>").addClass("editor-chess-list").appendTo(this.form),this.uploadContainer=jQuery("<div/>").addClass("editor-chess-upload").appendTo(this.form),this.loadList(),this.setupUpload(),jQuery("<a/>").addClass("cBtn cBtnWhite").html(window.t("Create game")).appendTo(this.uploadContainer).on("click",function(){i.form.hide();var t=i.gameBuilder();t.insertBefore(i.form).on("chess24:done",function(n,r){var o=Chess.gameToCouch(r),a={},s={0:0},l={},c=function(e){a[e.knotId]=e.getSan(),"b"==e.moveRight&&(l[e.knotId]=e.moveCounter);for(var t=0;t<e.childrenMoves.length;t++)s[e.childrenMoves[t].knotId]=s[e.knotId]+t,c(e.childrenMoves[t])};c(r.getStartPosition());var d="",u=function(e){l[e.knotId]&&(d+=l[e.knotId]+". "),a[e.knotId]&&(d+="[["+e.knotId+"]["+a[e.knotId]+"][0]["+s[e.knotId]+"]] ")},h=function(e){if(e.length){u(e[0]);for(var t=1;t<e.length;t++)u(e[t]),e[t].childrenMoves&&e[t].childrenMoves.length&&h(e[t].childrenMoves);e[0].childrenMoves&&e[0].childrenMoves.length&&h(e[0].childrenMoves)}};h(r.getStartPosition().childrenMoves);var f=jQuery.extend({data:jQuery.toJSON(o),content:d,type:"game"},e.config.formData);jQuery.post("/api/web/couchAPI/create",f,function(n){var r=Widgets.Chess().chessBase;r.init(),r.addGame(n.data.reference_id,o),o.meta.AnnotationId=n.data.annotation_id,e.config.chessGames[n.data.reference_id]=o,t.remove(),i.form.show(),i.loadList()})}).on("chess24:hide",function(){t.remove(),i.form.show()}),t.start()}),jQuery("<a/>").addClass("cBtn cBtnWhite").html(window.t("Show helper board")).appendTo(this.uploadContainer).on("click",function(){i.showHelperBoard(),e.hideToolDialog()}),setTimeout(function(){e.hideToolDialog(n)||(n=e.showToolDialog(i.form,t,{}),e.toggleToolDialogButtons(!1),jQuery(document).trigger("newhtml"))},10)},toolbuttons:{chess:{icon:"chess.png",name:window.t("Chess"),onclick:function(e){this.extensions.chess.index(e)},special:!0}},provides:{tags:["span","p"],attributes:{span:["class"],p:["class"]}}}},jQuery.fn.editorextensions=jQuery.fn.editorextensions||{},jQuery.fn.editorextensions.clear=function(e,t){
return{index:function(t){var n=e.extensions.dom.getSelection();if(n){var i=n.startContainer,r=n.endContainer,o=n.startOffset,a=n.endOffset;if(i=e.extensions.dom.findTextNode(i),r=e.extensions.dom.findTextNode(r,"back"),i==r){var s=e.extensions.dom.findBlockParent(i),l=e.extensions.dom.breakNode(s,[[i,o],[r,a]]);jQuery(s).html("").append(jQuery(l[0]).contents());var c=document.createTextNode(jQuery(l[1]).text());jQuery(s).append(c),jQuery(s).append(jQuery(l[2]).contents()),e.extensions.dom.flatten(s),e.extensions.dom.setSelection(c,c)}else{var d=e.extensions.dom.findBlockParent(i),u=e.extensions.dom.findBlockParent(r);if(d==u){var l=e.extensions.dom.breakNode(d,[[i,o],[r,a]]),c=document.createTextNode(jQuery(l[1]).text());jQuery(d).html("").append(jQuery(l[0]).contents()),jQuery(d).append(c),jQuery(d).append(jQuery(l[2]).contents()),e.extensions.dom.flatten(d),e.extensions.dom.setSelection(c,c)}else{var l=e.extensions.dom.breakNode(d,[[i,o]]),h=document.createTextNode(jQuery(l[1]).text());jQuery(d).html("").append(jQuery(l[0]).contents()),jQuery(d).append(h);for(var f=d.nextSibling;f!=u;)jQuery(f).find("*").each(function(){jQuery(this).is(e.widgetmask)||0!=jQuery(this).closest(e.widgetmask).length||jQuery(this).replaceWith(jQuery(this).contents())}),f=f.nextSibling;l=e.extensions.dom.breakNode(u,[[r,a]]);var p=document.createTextNode(jQuery(l[0]).text());jQuery(u).html("").append(jQuery(l[1]).contents()),jQuery(u).prepend(p),e.extensions.dom.flatten(d),e.extensions.dom.flatten(u),e.extensions.dom.setSelection(h,p)}}}},toolbuttons:{clear:{name:window.t("Remove formatting"),icon:"clear.png",onclick:function(e){this.extensions.clear.index(e)},shortcut:window.t("Ctrl-Del")}}}},jQuery.fn.editorextensions=jQuery.fn.editorextensions||{},jQuery.fn.editorextensions.dom=function(e,t){function n(t){if(!t)return null;var n=function(t,n){for(var i=null,r=-1,o=3==t.nodeType?[t]:e.extensions.dom.treeToVector(t.childNodes),a=0;a<o.length;a++){var s=o[a];if(3==s.nodeType){var l=s.nodeValue,c=n.indexOf(l);if(0!=c||n==l){i=s,r=n.length-1;break}n=n.substring(l.length)}}return{node:i,offset:r}};if(""==t.text){var i=t.duplicate();try{i.moveToElementText(i.parentElement()),i.setEndPoint("EndToEnd",t),t.startContainer=e.extensions.dom.findTextNode(i.parentElement(),"end"),t.endContainer=t.startContainer,t.startOffset=i.text.length;for(var r=e.extensions.dom.treeToVector(i.parentElement().childNodes),o=0;o<r.length&&r[o]!=t.startContainer;o++)3==r[o].nodeType&&(t.startOffset-=r[o].nodeValue.length);return t.endOffset=t.startOffset,t}catch(a){return null}}else if(""==t.htmlText){var i=t.duplicate();t.startContainer=t.parentElement(),t.endContainer=t.parentElement(),i.collapse(!0),i.moveStart("character",-1);for(var o=1;o<(t.startContainer.innerText||t.startContainer.textContent).length&&(t.startContainer.innerText||t.startContainer.textContent).substr(0,o)!=i.text;o++)i.moveStart("character",-1);if(""==i.text){var s=e.extensions.dom.findTextNode(t.startContainer);return s?(t.startContainer=s,t.startOffset=0,t.endOffset=0,t):null}var l=n(t.startContainer,i.text);return t.startContainer=l.node,t.startOffset=l.offset+1,t.endOffset=l.offset+1,t}if("undefined"==typeof t.duplicate)return null;var c=t.duplicate(),d=t.duplicate(),u=t.duplicate(),h=t.duplicate();c.collapse(!0),c.moveEnd("character",1),d.collapse(!1),d.moveStart("character",-1);var f=c.parentElement(),p=d.parentElement();u.moveToElementText(f),u.setEndPoint("EndToEnd",c),h.moveToElementText(p),h.setEndPoint("EndToEnd",d);var m=n(f,u.text),g=n(p,h.text);return t.startContainer=m.node,t.startOffset=m.offset,t.endContainer=g.node,t.endOffset=g.offset+1,t}var i=function(e){var t=e.outerHTML,n=e.innerHTML;if(!t)return["",""];var i=t.lastIndexOf("<"),r=t.substr(i);if(r==t)return[t,""];if(t=t.substr(0,i),n){i=t.lastIndexOf(n);var o=t.substr(0,i)}else var o=t;return delete t,delete n,[o,r]},r={valid:function(){return this.startContainer?"object"!=typeof this.startContainer.parentNode?!1:!0:!1},before:function(){if(!this.valid())return void 0;var t="",n=e.extensions.dom.findTextNode(this.startContainer,"forward"),r=e.get(0);n?t=n.nodeValue.substr(0,this.startOffset):(n=this.startContainer,t=i(n)[0]);for(var o=n;;){for(;o.previousSibling;)t=(o.previousSibling.outerHTML||o.previousSibling.nodeValue)+t,o=o.previousSibling;if(!o.parentNode||o.parentNode==r)break;t=i(o.parentNode)[0]+t,o=o.parentNode}return t},after:function(){if(!this.valid())return void 0;var t="",n=e.extensions.dom.findTextNode(this.endContainer,"back"),r=e.get(0);n?t=n.nodeValue.substr(this.endOffset):(n=this.endContainer,t=n.innerHTML+i(n)[1]);for(var o=n;;){for(;o.nextSibling;)t+=o.nextSibling.outerHTML||o.nextSibling.nodeValue,o=o.nextSibling;if(!o.parentNode||o.parentNode==r)break;t+=i(o.parentNode)[1],o=o.parentNode}return t}};return{ignore:["div"],mayBeEmpty:["div","br","hr","img"],mayBeJoined:["strong","i","u","strike"],msie:function(){for(var e=3,t=document.createElement("div"),n=t.getElementsByTagName("i");t.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->",n[0];);return e>4?e:void 0}(),treeToVector:function(e,t){for(var n=[],i=0;i<e.length;i++)1==e[i].nodeType&&this.ignore.contains(e[i].tagName.toLowerCase())||((!t||t&&t(e[i]))&&n.push(e[i]),n=n.concat(this.treeToVector(e[i].childNodes,t)));return n},closestChildOf:function(e,t){for(var n=e;n&&n.parentNode;){if(n.parentNode==t)return n;n=n.parentNode}return delete n,null},scrubNode:function(e){if(1==e.nodeType&&this.mayBeEmpty.contains(e.tagName.toLowerCase()))return!1;for(var t=0;t<e.childNodes.length;t++)3==e.childNodes[t].nodeType&&""==e.childNodes[t].nodeValue?(t>0&&3==e.childNodes[t-1].nodeType||t<e.childNodes.length-1&&3==e.childNodes[t+1].nodeType)&&(e.removeChild(e.childNodes[t]),t--):this.scrubNode(e.childNodes[t]);return 1==e.nodeType&&0==e.childNodes.length?(e.parentNode.removeChild(e),!0):!1},deduplicate:function(e){return this.ignore.contains(e.tagName.toLowerCase())?void 0:(jQuery(e).find(e.tagName).each(function(){jQuery(this).replaceWith(jQuery(this).contents())}),e)},flatten:function(t,n){if(1!=t.nodeType||!this.ignore.contains(t.tagName.toLowerCase())||e.is(t)){var i,r=!1,o=t.childNodes;for(i=0;i<o.length;i++)3==o[i].nodeType&&""==o[i].nodeValue?(i>0&&3==o[i-1].nodeType||i<o.length-1&&3==o[i+1].nodeType)&&(r=!0,t.removeChild(o[i--])):1==o[i].nodeType&&(r=this.flatten(o[i])||r);if(this.scrubNode(t))return void delete o;for(i=0;i<o.length-1;)1!=o[i].nodeType||this.mayBeJoined.contains(o[i].tagName.toLowerCase())?n&&3==o[i].nodeType&&3==o[i+1].nodeType?(o[i].nodeValue+=o[i+1].nodeValue,t.removeChild(o[i+1]),r=!0):1==o[i].nodeType&&1==o[i+1].nodeType&&o[i].tagName.toLowerCase()==o[i+1].tagName.toLowerCase()?(jQuery(o[i]).append(jQuery(o[i+1]).contents()),t.removeChild(o[i+1]),r=!0):1==o[i].nodeType&&o[i+2]&&1==o[i+2].nodeType&&o[i].tagName.toLowerCase()==o[i+2].tagName.toLowerCase()&&3==o[i+1].nodeType&&!o[i+1].nodeValue.trim()?(jQuery(o[i]).append(o[i+1].nodeValue).append(jQuery(o[i+2]).contents()),t.removeChild(o[i+2]),t.removeChild(o[i+1]),r=!0):i++:i++;return delete o,r?this.flatten(t):!1}},breakNode:function(e,t){for(var n=[],i=function(){jQuery(this).replaceWith(jQuery(this).contents())},r=0;r<t.length;r++)"editor-wrapper"!=t[r][0].parentNode.className&&jQuery("<span/>").addClass("editor-wrapper").insertAfter(t[r][0]).append(t[r][0]);for(var o=jQuery(e).clone(!0),r=0;r<t.length;r++){var a=o.clone(!0),s=r>0?t[r][0]==t[r-1][0]?0:1:0,l=r>0&&t[r][0]==t[r-1][0]?t[r][1]-t[r-1][1]:t[r][1],c=a.find(".editor-wrapper:eq("+s+")");for(c.text(c.text().substr(0,l)),c=c.get(0);c&&!a.is(c);){for(;c.nextSibling;)c.parentNode.removeChild(c.nextSibling);c=c.parentNode}for(c=o.find(".editor-wrapper:eq("+s+")"),c.text(c.text().substr(l)),c=c.get(0);c&&!o.is(c);){for(;c.previousSibling;)c.parentNode.removeChild(c.previousSibling);c=c.parentNode}a.find(".editor-wrapper").each(i),n.push(a.get(0)),delete a}return o.find(".editor-wrapper").each(i),n.push(o.get(0)),jQuery(e).find(".editor-wrapper").each(i),delete o,n},findTextNode:function(e,t){if(!e)return null;if(3==e.nodeType)return e;"undefined"==typeof t&&(t="forward");var n=this.findBlockParent(e);switch(t){case"forward":for(var i=this.treeToVector((n||e).childNodes),r=n?i.indexOf(e):0,o=r+1;o<i.length;o++)if(3==i[o].nodeType){var a=i[o];return delete i,a}break;case"back":for(var i=this.treeToVector((n||e).childNodes),r=n==e?i.length:n?i.indexOf(e):0,o=r-1;o>=0;o--)if(3==i[o].nodeType){var a=i[o];return delete i,a}break;case"end":for(i=this.treeToVector(e.childNodes),o=i.length-1;o>=0;o--)if(3==i[o].nodeType){var a=i[o];return delete i,a}break;default:if(t>0&&e.childNodes[t]&&3==e.childNodes[t].nodeType)return e.childNodes[t]}return delete i,null},findBlockParent:function(e){if(!e)return null;for(var t=e;t&&(1!=t.nodeType||!this.isBlockElement(t));)t=t.parentNode;return t},rangeIsValid:function(t){return t&&t.commonAncestorContainer&&(jQuery(t.commonAncestorContainer).is(e)||jQuery(t.commonAncestorContainer).closest(e).length>0)},isBlockElement:function(e){return 1==e.nodeType&&void 0!==jQuery(e).css("display")&&-1==jQuery(e).css("display").indexOf("inline")},findNonTextNode:function(t){if("object"!=typeof t.parentNode)return null;for(;t;){if(1==t.nodeType)return e.is(t)||0==e.find(t).length?null:t;t=t.parentNode}return null},findTextOffset:function(e,t){var n=this.treeToVector(t.childNodes),i=n.indexOf(e);if(-1==i)return 0;var r=0;for(i--;i>=0;i--)3==n[i].nodeType&&(r+=n[i].nodeValue.length);return r},getSelection:function(){var t=function(){return e.cursorLastSeenAt?jQuery.extend({startContainer:e.cursorLastSeenAt,endContainer:e.cursorLastSeenAt,startOffset:e.cursorLastSeenAtIndex||0,endOffset:e.cursorLastSeenAtIndex||0,commonAncestorContainer:e.extensions.dom.findNonTextNode(e.cursorLastSeenAt)},r):null};if(window.getSelection){var i=window.getSelection();if(0==i.rangeCount)return null;if(i=i.getRangeAt(0),this.rangeIsValid(i))return jQuery.extend(i,r)}else{var o=document.selection.createRange();if(!o.parentElement||jQuery(o.parentElement()).find(e).length)return t();var i=n(o);if(!i||!i.startContainer)return t();for(var a=i.startContainer.parentNode;a&&(1!=a.nodeType||!jQuery.contains(a,i.endContainer));)a=a.parentNode;if(a&&(i.commonAncestorContainer=a),this.rangeIsValid(i))return jQuery.extend(i,r)}return t()},setSelection:function(e,t,n,i){if(e&&t)if(window.getSelection){for(;e&&1==e.nodeType;)e=e.firstChild;for(;t&&1==t.nodeType;)t=t.lastChild;if(!e||!t)return;"undefined"==typeof n&&(n=0),"undefined"==typeof i&&(i=t.nodeValue.length);var r=document.createRange();r.setStart(e,n),r.setEnd(t,i),window.getSelection().removeAllRanges(),window.getSelection().addRange(r),delete e,delete t,delete r}else{if(e=this.findTextNode(e,"forward"),t=this.findTextNode(t,"end"),!e||!t)return;var o=this.findNonTextNode(e,"before"),a=this.findNonTextNode(t,"before"),s=this.findTextOffset(e,o)+(n||0),l=this.findTextOffset(t,a)+(i||t.nodeValue.length),c=document.body.createTextRange();c.moveToElementText(o),c.moveStart("character",s);var d=document.body.createTextRange();d.moveToElementText(a),d.collapse(!0),d.moveEnd("character",l),c.setEndPoint("EndToEnd",d),c.select(),delete o,delete a,delete e,delete t,delete c,delete d}},setCursor:function(e,t){if(e&&e.parentNode){if(isNaN(t)&&"after"!=t&&"before"!=t&&(t="before"),isNaN(t)||1!=e.nodeType)e=this.findTextNode(e,"before"==t?"forward":"end");else{for(var n=this.treeToVector(e.childNodes),i=0;i<n.length;i++)if(3==n[i].nodeType){if(t<n[i].nodeValue.length){e=n[i];break}if(t-=n[i].nodeValue.length,0==t){for(e=n[i],t=n[i].nodeValue.length,i++;i<n.length;i++)if(3==n[i].nodesType){e=n[i],t=0;break}break}}1==e.nodeType&&(e=this.findTextNode(e,"forward"))}if(e)if(window.getSelection){t>e.nodeValue.length&&(t="after");var r=document.createRange();"after"==t?t=e.nodeValue.length:"before"==t&&(t=0),isNaN(t)?(r.selectNode(e),r.collapse("after"!=t)):(t=Math.min(t,e.nodeValue.length),r.setStart(e,t),r.setEnd(e,t)),window.getSelection().removeAllRanges(),window.getSelection().addRange(r),delete r}else{e=this.findTextNode(e);var o=this.findNonTextNode(e);if(!o)return;isNaN(t)||(t+=this.findTextOffset(e,o));var r=document.body.createTextRange();r.moveToElementText(o),isNaN(t)?"after"==t?r.collapse(!1):"before"==t&&r.collapse(!0):(r.collapse(!0),t>0&&(r.moveEnd("character",t),r.collapse(!1))),r.select()}}},setSelectionXY:function(e,t){var n=document.elementFromPoint(e,t),i=jQuery(n);if(!i.hasClass("not-selectable")&&!i.closest(".not-selectable").length)if("undefined"!=typeof document.body.createTextRange)try{var r=document.body.createTextRange();r.moveToPoint(e,t),r.select(),delete r}catch(o){}else if("function"==typeof document.createRange){var r=document.createRange();r.setStart(n,0),r.setEnd(n,0),window.getSelection().removeAllRanges(),window.getSelection().addRange(r)}},getSelectionXY:function(){var e=0,t=0;if(window.getSelection){var n=window.getSelection();if(n.rangeCount){var i=n.getRangeAt(0).cloneRange();if(i.getClientRects){i.collapse(!0);var r=i.getClientRects()[0];r&&(e=r.left,t=r.top)}}}else window.selection&&"Control"!=n.type&&(i=n.createRange(),i.collapse(!0),e=i.boundingLeft,t=i.boundingTop);return{x:e,y:t}},unsetSelection:function(){if("function"==typeof document.body.createTextRange){var t=document.body.createTextRange();t.moveToElementText(e.get(0)),t.collapse(!0),t.select(),delete t}else if("function"==typeof document.createRange){var t=document.createRange();t.setStart(e.get(0),0),t.setEnd(e.get(0),0),window.getSelection().removeAllRanges(),window.getSelection().addRange(t)}},isEmpty:function(e){var t=e.innerHTML;return"<br>"==t||"<br/>"==t||""==t||"&nbsp;"==t||" "==t},makeNonEmpty:function(e){if(e&&1==e.nodeType&&this.isBlockElement(e)&&this.isEmpty(e)){for(;e.childNodes.length>0;)e.removeChild(e.childNodes[0]);this.msie?e.appendChild(document.createTextNode("")):(e.appendChild(document.createTextNode("")),e.appendChild(document.createElement("br")))}}}},jQuery.fn.editorextensions=jQuery.fn.editorextensions||{},jQuery.fn.editorextensions.emoticons=function(e,t){function n(){e.setFocus(!0);var t=e.extensions.dom.findBlockParent(e.extensions.dom.getSelection().startContainer);if(t){var n=e.extensions.dom.treeToVector(t.childNodes,function(e){return 1===e.nodeType});if(1===n.length&&"BR"==n[0].tagName)var i=n[0]}var r=jQuery(this).find("img").clone(),o=document.createTextNode("");return e.insertAtCursor(r),i&&i.parentNode&&i.parentNode.removeChild(i),r.after(o),r.on("click",function(t){var n=r.get(0);t.offsetX<r.width()/2?e.extensions.dom.setCursor(n.previousSibling,"after"):(n.nextSibling||n.parentNode.appendChild(document.createTextNode("")),e.extensions.dom.setCursor(n.nextSibling,"before"))}),e.extensions.dom.setCursor(o,0),e.registerCursor(),e.setFocus(!0),!1}function i(){var e=jQuery("<div/>").addClass("customTabs emoticonTabs tab-position-bottom").on("chess24:hide chess24:show",function(e){e.stopPropagation()}),t=Emoticons.getByCategory();return Emoticons.getCategories().forEach(function(i){var r=jQuery("<section/>").attr("id",(new Helper.UUID).getShort()).data("tab-class","emojiCat "+i.css).data("tab-title",'<span title="'+i.title+'"></span>');t[i.key].forEach(function(e){r.append(jQuery("<span/>").addClass("editor-dialog-character btnEmoticon").attr("title",e.title).append(jQuery("<img/>").addClass("emoticon emoji "+e.css).attr("src",config.assetDir()+"/images/empty.png").attr("key",e.key)).on("click",n))}),e.append(r)}),e}var r=t&&t.extensionConfig&&t.extensionConfig.emoticons?t.extensionConfig.emoticons.dialogContainer:null,o=!!r;return o&&r.each(function(){var e=jQuery(this);e.append(i())}),{toolbuttons:{emoticons:{customClasses:"cTooltipBox position-bottom",getCustomContent:function(e){return jQuery('<img src="'+e+'emoticons.png"/><span class="cTooltipBoxContainer">').append(jQuery("<span>").append(i()))}}},provides:{tags:["img"],attributes:{img:["class","src","key"]},attributeValueRestrictions:{img:{src:["/images/empty.png",document.location.origin+"/images/empty.png",config.assetDir()+"/images/empty.png"]}}}}},jQuery.fn.editorextensions=jQuery.fn.editorextensions||{},jQuery.fn.editorextensions.highlight=function(e){return{check:function(t,n,i){if(!t)return!1;var r=e.extensions.dom.findNonTextNode(t.startContainer);if(n){n=n.split(" ");for(var o=r,a=n.length-1;a>=0;a--){var s=jQuery(o).closest(n[a]);if(!s.length&&!s.closest(e).length)return!1}}if(i){for(var o=e.extensions.dom.findBlockParent(r);o;){if(jQuery(o).is(e))return!1;var l,c=!0;for(l in i){for(var d=i[l].split(" "),u=!1,a=0;a<d.length;a++)if(jQuery(o).css(l)==d[a]){u=!0;break}if(!u){c=!1;break}}if(c)return!0;o=o.parentNode}return!1}return!0}}},jQuery.fn.editorextensions=jQuery.fn.editorextensions||{},jQuery.fn.editorextensions.history=function(e,t){var n=!1,i=[],r=[],o=function(){var t=e.extensions.dom.getSelection();if(!t)return 0;for(var n=0,i=e.extensions.dom.treeToVector(e.get(0).childNodes,function(e){return 3==e.nodeType}),r=0;r<i.length;r++){if(i[r]==t.startContainer)return Math.min(n+t.startOffset,e.text().length);i[r].nodeValue&&(n+=i[r].nodeValue.length)}return delete i,n},a=function(t){if(t>=e.text().length){var n=e.extensions.dom.findTextNode(e.get(0),"end");if(n)e.extensions.dom.setCursor(n,n.nodeValue.length);else{var i=e.find("> *").get(0);i&&(e.extensions.dom.makeNonEmpty(i),e.extensions.dom.setCursor(i))}}else{for(var r=e.extensions.dom.treeToVector(e.get(0).childNodes,function(e){return 3==e.nodeType}),o=0;o<r.length;o++)if(r[o].nodeValue){if(r[o].nodeValue.length>t){e.extensions.dom.setCursor(r[o],t);break}t-=r[o].nodeValue.length}delete r}};return{start:function(){i.push({html:e.getHtml(),full:e.html(),cursor:o(),putcursor:o()}),e.on("change",function(){if(n)return void(n=!1);var t=e.getHtml(),r=e.html();t!=i[i.length-1].html&&i.push({html:t,full:r,cursor:o(),putcursor:o()})}),e.on("keypress click paste",function(){i[i.length-1].putcursor=o()}),e.on("keyup",function(){var t=e.extensions.dom.getSelection();if(t&&t.commonAncestorContainer){var n=t.commonAncestorContainer;3==n.nodeType&&(n=n.parentNode),n&&(n=jQuery(n),n.is("a.unusual-link")&&n.trigger("change"))}}),e.backupWidgets()},index:function(t){if("undo"==t){if(1==i.length)return;n=!0;for(var o=i[i.length-1].html.replace(/<[^>]+>/g,""),s=i[i.length-1].cursor,l=0,c=i.length-2;c>=0;c--){var d=i[c].html.replace(/<[^>]+>/g,""),u=i[c].cursor;if(d==o)break;var h=!0,f=!0,p=!0;if(o.substr(s)!=d.substr(d.length-(o.length-s))&&(h=!1,p=!1),o.substr(0,s-l-1)!=d.substr(0,u)&&(h=!1),o.substr(0,s)!=d.substr(0,u-l-1)&&(p=!1),o.substr(0,s)!=d.substr(0,s)&&(f=!1),o.substr(s)!=d.substr(u+l+1)&&(f=!1),!h&&!f&&!p)break;l++}r.push(i.pop()),i=i.slice(0,Math.max(1,i.length-l)),e.html(i[i.length-1].full),a(i[i.length-1].putcursor),e.setupWidgets()}else if("redo"==t){if(0==r.length)return;n=!0;var m=r.pop();i.push(m),e.html(m.full),a(m.putcursor),e.setupWidgets(),delete m}},toolbuttons:{}}},jQuery.fn.editorextensions=jQuery.fn.editorextensions||{},jQuery.fn.editorextensions.hr=function(e,t){return{index:function(t){var n=e.extensions.dom.getSelection();if(n){if(e.is(n.startContainer))return void e.append("<hr/>");var i=e.extensions.dom.findBlockParent(n.startContainer);if(i==n.startContainer){var r=jQuery("<hr/>");if(n.startOffset>0?jQuery(i).after(r):jQuery(i).before(r),r.next().length)e.extensions.dom.setCursor(r.next().get(0),0);else{var o=jQuery("<p/>").insertAfter(r).get(0);e.extensions.dom.makeNonEmpty(o),e.extensions.dom.setCursor(o,0)}}else{var a=e.extensions.dom.breakNode(i,[[n.startContainer,n.startOffset]]);jQuery(a[1]).insertAfter(i),jQuery("<hr/>").insertAfter(i),(a[0].innerText||a[0].textContent).trim()&&jQuery(a[0]).insertAfter(i),jQuery(i).remove(),e.extensions.dom.makeNonEmpty(a[1]),e.extensions.dom.setCursor(a[1],0)}e.setFocus()}},toolbuttons:{hr:{name:window.t("Horizontal line"),icon:"hr.png",onclick:function(e){this.extensions.hr.index(e)}}},provides:{tags:["hr"]}}},jQuery.fn.editorextensions=jQuery.fn.editorextensions||{},jQuery.fn.editorextensions.link=function(e,t){var n="",i=/^(https?\:\/\/[a-z][\w\.\-]+([\/\?].*)?)?$/i,r=0,o=[{name:"link",label:"URL",show:function(){return!0},onclick:function(t){if(t.length>0){var n=t.attr("data"),i=jQuery("<a/>").html(t.html()).attr("href","http://");t.replaceWith(i),e.extensions.link.setup(),i.trigger("dblclick"),n&&(n=jQuery.parseJSON(n),n.views&&Widgets.Chess().chessBase.checkSeparatedViews(n.views,e))}}},{name:"chess-jump-to-link",label:"Chess link",show:function(){return!!e.extensions.chess&&!!e.extensions.widgets&&e.isWidgetAllowed("chess-jump-to-link")},onclick:function(t){e.extensions.widgets.createWidget("chess-jump-to-link",t)}},{name:"glossary-link",label:"Glossary",show:function(){return!!e.extensions.widgets&&!!e.isWidgetAllowed("glossary-link")},onclick:function(t){e.extensions.widgets.createWidget("glossary-link",t)}},{name:"biography-link",label:"Biography",show:function(){return!!e.extensions.widgets&&!!e.isWidgetAllowed("biography-link")},onclick:function(t){e.extensions.widgets.createWidget("biography-link",t)}},{name:"ebook-link",label:"Ebook",show:function(){return!!e.extensions.widgets&&!!e.isWidgetAllowed("ebook-link")},onclick:function(t){e.extensions.widgets.createWidget("ebook-link",t)}}],a=function(o){var a={};a[window.t("Save")]=function(t){return t.href?("http://"!=t.href.substr(0,7).toLowerCase()&&"https://"!=t.href.substr(0,8).toLowerCase()&&"mailto:"!=t.href.substr(0,7)&&(t.href="http://"+t.href),jQuery(o).attr("href",t.href).attr("title",t.title).attr("target",t.blank?"_blank":"").data("just-created",""),void e.extensions.dom.setSelection(o,o)):void(a[window.t("Delete")]||a[window.t("x")])()},a[e.is(".white")?"x":window.t("Delete")]=function(t){var n=o.parentNode,i=e.extensions.dom.findTextNode(o,"forward"),r=e.extensions.dom.findTextNode(o,"end");jQuery(o).replaceWith(jQuery(o).contents()),e.extensions.dom.flatten(n),e.extensions.dom.setSelection(i,r)},a[window.t("Cancel")]=function(t){if(t.href==n&&jQuery(o).data("just-created")){var i=o.parentNode,r=e.extensions.dom.findTextNode(o,"forward"),a=e.extensions.dom.findTextNode(o,"end");jQuery(o).replaceWith(jQuery(o).contents()),e.extensions.dom.flatten(i),e.extensions.dom.setSelection(r,a)}else e.extensions.dom.setCursor(o,0)};var s=t.extraClass&&t.extraClass.match(/white/),l=jQuery("<div/>").append(jQuery("<h3>"+window.t("Link properties")+"</h3>")),c=(jQuery("<label/>").addClass("options").appendTo(l),jQuery("<div/>").addClass(s?"":"resource-properties").appendTo(l)),d="";jQuery(o).attr("href")&&(d=jQuery(o).attr("href")),!d&&jQuery(o).text().match(i)&&(d=jQuery(o).text());var u=jQuery("<div/>").addClass("url").appendTo(c);u.append(jQuery("<label/>").html(window.t("URL"))),u.append(jQuery('<input type="text"/>').addClass(s?"":"cPattern").attr("name","href").val(d).attr("size","50")),u.append(s?"":'<br class="clear"/>');var h=jQuery("<div/>").addClass("title").appendTo(c);h.append(jQuery("<label/>").html(window.t("Title"))),h.append(jQuery('<input type="text"/>').addClass(s?"":"cPattern").attr("name","title").val(jQuery(o).attr("title")||"").attr("size","50")),h.append(s?"":'<br class="clear"/>');var f=jQuery("<div/>").addClass("target").appendTo(c);f.append(jQuery('<input type="checkbox"/>').addClass("cPattern").attr("name","blank").val("_blank"==jQuery(o).attr("target")?1:0).attr("checked","_blank"==jQuery(o).attr("target"))),f.append(jQuery("<span/>").html(window.t("Open in a new window"))),f.append(s?"":'<br class="clear"/>'),e.extensions.link.formOptions(l,o,"link"),r=e.showToolDialog(l,o,a),jQuery(document).trigger("newhtml")};return{init:function(t){var n=this;return n.setup(),e.on("change",function(){n.setup()}),this},setup:function(){e.find("a").each(function(){jQuery(this).hasClass("unusual-link")||jQuery(this).closest("div").hasClass("editor")&&jQuery(this).off("dblclick").on("dblclick",function(){return a(this),!1})}).on("click",function(e){try{e.preventDefault()}catch(t){e.returnValue=!1}return!1})},formOptions:function(e,t,n){var i=e.find(".options");if(i.length){i.html("");for(var r=0;r<o.length;r++)o[r].show()&&(n==o[r].name?i.append(jQuery("<span/>").html(o[r].label)):jQuery("<a/>").html(o[r].label).on("click",function(e){return function(){e(jQuery(t))}}(o[r].onclick)).appendTo(i));var a=i.find("a,span");a.length<2?i.hide():a.not(a.last()).after(" - ")}},index:function(t){if(!e.hideToolDialog(r)){var i=e.extensions.dom.getSelection();if(i){var o=i.startContainer,s=i.endContainer,l=i.startOffset,c=i.endOffset;if(3!=o.nodeType&&(o=e.extensions.dom.findTextNode(o,"forward"),l=0),3!=s.nodeType&&(s=e.extensions.dom.findTextNode(s,"back"),c=s?s.nodeValue.length:c),o&&s){var d=n;if(o!=s||l!=c){for(;l<o.nodeValue.length&&!o.nodeValue.substr(l,1).trim();)l++;for(;c>1&&!s.nodeValue.substr(c-1,1).trim();)c--;var u=e.extensions.dom.findBlockParent(o),h=e.extensions.dom.findBlockParent(s);if(u!=h?(s=e.extensions.dom.findTextNode(u,"end"),c=s.nodeValue.length):u=i.commonAncestorContainer,3==u.nodeType&&(u=u.parentNode),jQuery(u).is("a"))return void jQuery(u).trigger("dblclick");var f=jQuery(u).closest("a").get(0);if(f)return void a(f);if(jQuery(u).find("a").each(function(){var t=jQuery(this);(e.extensions.dom.closestChildOf(o,this)||e.extensions.dom.closestChildOf(s,this))&&(d==n&&t.attr("href")&&(d=t.attr("href")),t.replaceWith(t.contents()))}),o==s&&3==o.nodeType){var p=document.createTextNode(o.nodeValue.substr(0,l)),m=document.createTextNode(o.nodeValue.substr(c)),g=jQuery("<a/>").attr("href",d).data("just-created",1).text(o.nodeValue.substr(l,c-l)).on("dblclick",function(){return a(this),!1}).get(0);return o.parentNode.insertBefore(p,o),o.parentNode.insertBefore(g,o),o.parentNode.insertBefore(m,o),o.parentNode.removeChild(o),a(g),void e.extensions.dom.setSelection(g,g)}var v=e.extensions.dom.breakNode(u,[[o,l],[s,c]]),g=jQuery("<a/>").attr("href",d).data("just-created",1).append(jQuery(v[1]).contents()).on("dblclick",function(){return a(this),!1}).get(0);jQuery(u).html("").append(jQuery(v[0]).contents()),jQuery(u).append(g),jQuery(u).append(jQuery(v[2]).contents()),e.extensions.dom.flatten(u),a(g),e.extensions.dom.setSelection(g,g)}else if(o){var y=jQuery(o).closest("a");y.length&&y.trigger("dblclick")}}}}},toolbuttons:{link:{name:window.t("Add link"),icon:"link.png",onclick:function(e){this.extensions.link.index(e)},highlight:function(e){return this.extensions.highlight.check(e,"a")}}},provides:{tags:["a"],attributes:{a:["href","class","data","contenteditable","unselectable","target","title","data-widget"]}}}},jQuery.fn.editorextensions=jQuery.fn.editorextensions||{},jQuery.fn.editorextensions.list=function(e,t){var n=["ul","ol"],i=function(e){var t,n=jQuery(e);return n.find("li").each(function(){var e=jQuery(this);e.find("*:first").is("h1,h2,h3,p,blockquote")?(t=e.find("*:last"),e.contents().insertBefore(n)):t=jQuery("<p/>").append(e.contents()).insertBefore(n)}),n.remove(),t},r=function(e,t){var n=jQuery(e);n.replaceWith(jQuery("<"+t+"/>").append(n.contents()))};return{keypress:function(e,t,n,i){return t||n||i?!1:8==e?this.keypressBackspace():!1},keypressBackspace:function(){setTimeout(function(){e.find(n.join(",")).each(function(){var e=jQuery(this);if(e.parent().length){for(this.tagName;e.next().is(this.tagName);)e.append(e.next().contents()),e.next().remove()}})},50);var t=e.extensions.dom.getSelection();if(!t)return!1;var i=t.startContainer;if(!i)return!1;if(t.startOffset>0)return!1;var r;3==i.nodeType&&(i=i.parentNode);var o=jQuery(i);if(!o.is("li")&&0==o.closest("li").length)return!1;if(o.is("li"))r=o;else{for(var a=o;;){if(0==a.length)return!1;if(a.is("li"))break;if(a.prevAll().html())return!1;a=a.parent()}r=a}var s=jQuery(t.startContainer).closest("ol,ul");if(!s.length||!r||!r.length)return!1;if(0!=t.startOffset)return!1;r.addClass("break-list");var l=s.clone(!0);l.find(".break-list").prevAll("li").remove(),l.find(".break-list").remove(),l.insertAfter(s),s.find(".break-list").nextAll("li").remove();var c=document.createTextNode(""),d=r.contents();return""==d.html()&&(d="&nbsp;"),jQuery("<p/>").append(c).append(d).insertAfter(s),r.remove(),e.extensions.dom.setCursor(c,"after"),0==s.find("li").length&&s.remove(),0==l.find("li").length&&l.remove(),!0},index:function(t){return n.contains(t)?function(o){var a=e.extensions.dom.getSelection();if(a){var s=n[1-n.indexOf(t)],l=a.startContainer,c=a.endContainer,d=a.startOffset,u=a.endOffset,h=a.startContainer,f=a.endContainer;if(h==e.get(0)&&(h=e.get(0).firstChild),f==e.get(0)&&(f=e.get(0).lastChild),h==f){var p=h;if(p=e.extensions.dom.findBlockParent(h),p==e.get(0)){var m=document.createTextNode(""),g=jQuery("<li/>").append(m);return void e.insertAtCursor(jQuery("<"+t+"/>").append(g))}if(p){var v=jQuery(p);if(v.is("h1,h2,h3")){var y=v.closest("li");y.length&&(v=y,p=v.get(0))}if(v.is(t))i(p);else if(v.is(s))r(p,t);else if(v.is("li")||v.closest("li").length)if(v.is("li")||(v=v.closest("li")),v.parent().is(t)){i(v.parent())}else v.parent().is(s)?r(v.parent(),t):v.replaceWith(jQuery("<p/>").append(v.contents()));else{l=a.startContainer,d=a.startOffset,c=a.endContainer,u=a.endOffset;var g=jQuery("<li/>");v.is("h1,h2,h3")?(jQuery("<"+t+"/>").append(g).insertBefore(v),g.append(v)):(g.append(v.contents()),v.replaceWith(jQuery("<"+t+"/>").append(g)))}}}else{var b=a.commonAncestorContainer,w=jQuery(b);if(w.is(s))w.replaceWith(jQuery("<"+t+"/>").append(w.contents()));else if(w.is(t)){i(w)}else{var k=e.extensions.dom.closestChildOf(h,b),x=e.extensions.dom.closestChildOf(f,b);if(!k||!x)return;var C=jQuery("<"+t+"/>").insertBefore(k),j=Array.convert(b.childNodes).indexOf(k),T=Array.convert(b.childNodes).indexOf(x);jQuery(k).is(s)&&jQuery(k).replaceWith(jQuery("<"+t+"/>").append(jQuery(k).contents())),jQuery(x).is(s)&&jQuery(x).replaceWith(jQuery("<"+t+"/>").append(jQuery(x).contents()));for(var _=Array.convert(b.childNodes).slice(j,T+1),S=0;S<_.length;S++){var I=jQuery(_[S]);3==_[S].nodeType?C.append(jQuery("<li/>").append(_[S])):I.is(t)?(C.append(I.contents()),I.remove()):I.is("p")?(C.append(jQuery("<li/>").append(I.contents())),I.remove()):C.append(jQuery("<li/>").append(I))}}}l!=c||d!=u?e.extensions.dom.setSelection(l,c,d,u):e.extensions.dom.setCursor(l,d)}}:function(){}},toolbuttons:{ulist:{name:window.t("Bullet list"),icon:"ulist.png",onclick:function(e){this.extensions.list.index("ul")(e)},highlight:function(e){return this.extensions.highlight.check(e,"ul li")}},olist:{name:window.t("Ordered list"),icon:"olist.png",onclick:function(e){this.extensions.list.index("ol")(e)},highlight:function(e){return this.extensions.highlight.check(e,"ol li")}}},provides:{tags:["ol","ul","li"]}}},jQuery.fn.editorextensions=jQuery.fn.editorextensions||{},jQuery.fn.editorextensions.paragraph=function(e,t){var n=["h1","h2","h3","blockquote","p"];return{keypress:function(e,t,n,i){return t||n||i?!1:8==e?this.keypressBackspace():13==e?this.keypressEnter():!1},keypressEnter:function(){var t=e.extensions.dom.getSelection();if(!t)return!1;var i=e.extensions.dom.findNonTextNode(t.startContainer,"before");if(!i)return!1;var r=e.extensions.dom.findBlockParent(i);if(!r||!jQuery(r).is(n.join(",")))return!1;var o=jQuery(r).closest("li");if(0==o.length||!e.find(o).length)return!1;var a=e.extensions.dom.breakNode(o.get(0),[[t.startContainer,t.startOffset]]);o.after(a[1]).replaceWith(a[0]);for(var s=0;s<a.length;s++)if(""==jQuery(a[s]).text()){var l=jQuery(a[s]).find("> *:first").get(0);e.extensions.dom.makeNonEmpty(l||a[1])}var c=e.extensions.dom.findTextNode(a[1]);return e.extensions.dom.setCursor(c,0),!0},keypressBackspace:function(){var t=e.extensions.dom.getSelection();if(!t)return!1;var i=e.extensions.dom.findNonTextNode(t.startContainer);if(!i)return!1;var r=e.extensions.dom.findBlockParent(i);if(!r||!jQuery(r).is(n.join(",")))return!1;var o=jQuery(r),a=o.closest("blockquote");if(!a.length)return!1;if(o.nextAll().length||""!=o.text())return!1;o.insertAfter(a);var s=document.createTextNode("");return o.append(s),e.extensions.dom.setCursor(s,0),!0},indent:function(t){
var n=e.extensions.dom.getSelection();if(n){var i,r,o=e.get(0);for(e.is(n.startContainer)?(i=o.childNodes[0],r=o.childNodes[o.childNodes.length-1]):(i=e.extensions.dom.closestChildOf(n.startContainer,o),r=e.extensions.dom.closestChildOf(n.endContainer,o));;){var a=parseInt(i.className.replace(/.*depth-(\d+).*/,"$1")||0);if((!t&&a>0||t&&24>a)&&jQuery(i).removeClass("depth-"+a).addClass("depth-"+(parseInt(a)+(t?1:-1))),i==r)break;i=i.nextSibling}}},index:function(t){return n.contains(t)?function(i){var r=e.extensions.dom.getSelection();if(r){var o=r.startContainer,a=r.startOffset,s=r.endContainer,l=r.endOffset,c=e.extensions.dom.findBlockParent(r.startContainer),d=e.extensions.dom.findBlockParent(r.endContainer);if(c==e.get(0)&&(c=e.get(0).firstChild),d==e.get(0)&&(d=e.get(0).lastChild),c==d){var u=e.extensions.dom.findBlockParent(c);if(u==e.get(0))return u=jQuery("<"+t+"/>"),e.insertAtCursor(u),void e.extensions.dom.setCursor(u,"after");if(u){var h,f=jQuery(u);if((h=f.closest(t))&&h.length)h.find(n.join(",")).length||h.closest("li").length?h.replaceWith(h.contents()):h.after(jQuery("<p/>").append(h.contents())).remove();else if(f.is(t))f.find(n.join(",")).length||f.closest("li").length?f.replaceWith(f.contents()):f.after(jQuery("<p/>").append(f.contents())).remove();else if((h=f.closest("ul,ol"))&&h.length)if("blockquote"==t){var p=f.closest("li");p.addClass("break-list");var m=h.clone(!0).insertAfter(h);h.find(".break-list").nextAll("li").remove(),m.find(".break-list").prevAll("li").remove(),m.find(".break-list").remove(),jQuery("<"+t+"/>").insertAfter(h).append(h.find(".break-list").contents()),h.find(".break-list").remove(),0==h.find("li").length&&h.remove(),0==m.find("li").length&&m.remove()}else f.append(jQuery("<"+t+"/>").append(f.contents()));else{var g=e.extensions.dom.closestChildOf(u,e.get(0));if(g){var v=jQuery(g);if("blockquote"==t)jQuery("<"+t+"/>").insertAfter(v).append(v);else if(v.is("blockquote"))f.replaceWith(jQuery("<"+t+"/>").append(f.contents()));else{var y=jQuery("<"+t+"/>").append(v.contents());if(v.replaceWith(y),""==y.text()){var b=document.createTextNode("");y.prepend(b),o=b,s=b,a=0,l=0}}}}}}else{0==r.endOffset&&d.previousSibling&&(d=d.previousSibling);var w,k,x;"blockquote"==t?(c=e.extensions.dom.closestChildOf(c,e.get(0)),d=e.extensions.dom.closestChildOf(d,e.get(0)),w=Array.convert(e.get(0).childNodes),k=w.indexOf(c),x=w.indexOf(d)):(w=e.extensions.dom.treeToVector(r.commonAncestorContainer.childNodes,e.extensions.dom.isBlockElement),k=w.indexOf(c),x=w.indexOf(d));for(var C=!0,j=k;x>=j;j++)if(!jQuery(w[j]).is(t)){C=!1;break}if("blockquote"==t)if(C)for(var j=k;x>=j;j++){var f=jQuery(w[j]);f.find(n.join(",")).length?f.replaceWith(f.contents()):f.replaceWith(jQuery("<p/>").append(f.contents()))}else for(var T=jQuery("<"+t+"/>").insertBefore(e.extensions.dom.closestChildOf(c,e.get(0))),j=k;x>=j;j++){var f=jQuery(w[j]);f.is(t)?(T.append(f.contents()),f.remove()):T.append(f)}else if(C)for(var j=k;x>=j;j++){var f=jQuery(w[j]);f.is(t)?f.find(n.join(",")).length?f.replaceWith(f.contents()):(f.replaceWith(jQuery("<p/>").append(f.contents())),f.remove()):f.find(t).length&&f.find(t).each(function(){jQuery(this).replaceWith(jQuery("<p/>").append(jQuery(this).contents()))})}else for(var j=k;x>=j;j++){var f=jQuery(w[j]);f.is(t)||(f.is("blockquote")?f.find(n.join(",")).length?f.find(n.join(",")).each(function(){jQuery(this).replaceWith(jQuery("<"+t+"/>").append(jQuery(this).contents()))}):f.append(jQuery("<"+t+"/>").append(f.contents())):f.is(n.join(","))&&f.after(jQuery("<"+t+"/>").append(f.contents())).remove())}}e.extensions.dom.setSelection(o,s,a,l)}}:function(){}},toolbuttons:{h1:{name:window.t("Header 1"),icon:"h1.png",onclick:function(e){this.extensions.paragraph.index("h1")(e)},highlight:function(e){return this.extensions.highlight.check(e,"h1")},shortcut:window.t("Ctrl-1")},h2:{name:window.t("Header 2"),icon:"h2.png",onclick:function(e){this.extensions.paragraph.index("h2")(e)},highlight:function(e){return this.extensions.highlight.check(e,"h2")},shortcut:window.t("Ctrl-2")},h3:{name:window.t("Header 3"),icon:"h3.png",onclick:function(e){this.extensions.paragraph.index("h3")(e)},highlight:function(e){return this.extensions.highlight.check(e,"h3")},shortcut:window.t("Ctrl-3")},blockquote:{name:window.t("Quote"),icon:"blockquote.png",onclick:function(e){this.extensions.paragraph.index("blockquote")(e)},highlight:function(e){return this.extensions.highlight.check(e,"blockquote")}},indent:{name:window.t("Increase indent"),icon:"indent.png",onclick:function(e){this.extensions.paragraph.indent(!0)},highlight:function(){return!1}},unindent:{name:window.t("Decrease indent"),icon:"unindent.png",onclick:function(e){this.extensions.paragraph.indent(!1)},highlight:function(){return!1}}},provides:{tags:["p","h1","h2","h3","blockquote"],attributes:{p:["class"],blockquote:["contenteditable"]}}}},jQuery.fn.editorextensions=jQuery.fn.editorextensions||{},jQuery.fn.editorextensions.resizable=function(e,t){return{index:function(t,n){var i=t.attr("properties")?jQuery.parseJSON(t.attr("properties")):{},r=[];switch(i.resizable){case"x":r=["e","w"];break;case"y":r=["n","s"];break;case"save-ratio":case"free":r=["n","ne","e","se","s","sw","w","nw"]}var o=i["resizable-xfrom"]||0,a=i["resizable-xto"]||0,s=i["resizable-yfrom"]||0,l=i["resizable-yto"]||0,c=i["resizable-xstep"]||1,d=i["resizable-ystep"]||1;t.find(".widget-resize, .widget-float").remove();var u=r.contains("n")?jQuery('<div class="widget-resize widget-resize-n"/>').appendTo(t):jQuery("null"),h=r.contains("e")?jQuery('<div class="widget-resize widget-resize-e"/>').appendTo(t):jQuery("null"),f=r.contains("w")?jQuery('<div class="widget-resize widget-resize-w"/>').appendTo(t):jQuery("null"),p=r.contains("s")?jQuery('<div class="widget-resize widget-resize-s"/>').appendTo(t):jQuery("null"),m=(r.contains("nw")?jQuery('<div class="widget-resize widget-resize-nw"/>').appendTo(t):jQuery("null"),r.contains("ne")?jQuery('<div class="widget-resize widget-resize-ne"/>').appendTo(t):jQuery("null"),r.contains("sw")?jQuery('<div class="widget-resize widget-resize-sw"/>').appendTo(t):jQuery("null"),r.contains("se")?jQuery('<div class="widget-resize widget-resize-se"/>').appendTo(t):jQuery("null"),jQuery('<div class="widget-float widget-float-left"/>').appendTo(t)),g=jQuery('<div class="widget-float widget-float-none"/>').appendTo(t),v=jQuery('<div class="widget-float widget-float-right"/>').appendTo(t),y=t.find(".widget-resize"),b=t.find(".widget-float"),w=function(){u.add(p).css("left",t.outerWidth()/2-u.width()/2+"px"),f.add(h).css("top",t.height()/2-f.height()/2+"px"),m.css("left",t.outerWidth()/2-40-m.width()+"px"),g.css("left",t.outerWidth()/2-g.width()/2+"px"),v.css("left",t.outerWidth()/2+40+"px"),b.css("top",t.height()/2-b.height()/2+"px"),b.removeClass("highlighted"),t.find(".widget-float-"+t.css("float")).addClass("highlighted")};t.on("resize.resizable",w),w();var k=o||parseInt(e.css("line-height"))||16,x=jQuery("<p/>").appendTo(e),C=a||x.width()-(t.outerWidth()-t.width());x.remove();var j=s||parseInt(e.css("line-height"))||16,T=l||e.height(),_=!1;y.hide(),b.hide(),t.on("mouseover.resizable",function(){y.show(),b.show()}).on("mouseout.resizable",function(){_||(y.hide(),b.hide())}),b.on("click",function(){var e=this.className.match(/widget-float-(\w+)/)[1];t.css({"float":e,clear:"none"===e?"both":"none",margin:"left"===e?"0px 10px 10px 0px":"right"===e?"0px 0px 10px 10px":"0px auto 0px auto"}),t.trigger("resize"),w()}),y.each(function(){var e=this.className.match(/widget-resize-(\w+)/)[1],r=jQuery(this);r.on("mousedown",function(o){jQuery("body").css("cursor",r.css("cursor")),_=!0;var a=o.clientX,s=o.clientY,l=t.width(),u=t.height(),h=l/u;try{o.stopPropagation(),o.preventDefault()}catch(f){o.cancelBubble=!0,o.returnValue=!1}var p=function(r){var o=["nw","w","sw"].contains(e)?-1:1,f=["nw","n","ne"].contains(e)?-1:1,p=r.clientX-a,m=r.clientY-s;"none"==t.css("float")&&(p*=2);var g=l+o*p,v=u+f*m;if(g=["e","w","se","sw","ne","nw"].contains(e)?Math.min(C,Math.max(k,g)):l,v=["s","n","se","sw","ne","nw"].contains(e)?Math.min(T,Math.max(j,v)):u,g=c*Math.round(g/c),v=d*Math.round(v/d),"save-ratio"==n){var y="v";["e","w"].contains(e)&&(y="h"),["se","sw","ne","nw"].contains(e)&&(y=p>m?"h":"v"),"v"==y?g=v*h:v=g/h,k>g&&(g=k,v=g/h),g>C&&(g=C,v=g/h)}(g!=t.width()||v!=t.height())&&(t.css("width","y"==i.resizable?"auto":g+"px"),t.css("height","x"==i.resizable?"auto":v+"px"),w(),t.trigger("resize",[!0]))},m=function(){_=!1,jQuery("body").css("cursor",""),jQuery(document).off("mousemove",p),t.trigger("resize"),t.trigger("mouseout")};jQuery(document).on("mousemove",p),jQuery(document).one("mouseup",m)})})},reset:function(e){e.find(".widget-resize, .widget-float").remove(),e.off("resize.resizable mouseover.resizable mouseout.resizable"),e.css({margin:"0px auto 0px auto","float":"none"})}}},jQuery.fn.editorextensions=jQuery.fn.editorextensions||{},jQuery.fn.editorextensions.source=function(e,t){var n=function(e){var t=jQuery("<div/>").html(e);return e="",t.find("> *").each(function(){if(jQuery(this).is("ol,ul")){var t=[];jQuery(this).find("> li").each(function(){this.innerHTML=this.innerHTML.replace(/<widget>/gi,"[widget]").replace(/<\/widget>/gi,"[/widget]").trim(),t.push(this.outerHTML.replace(/\[(\/?widget)\]/gi,"<$1>"))}),this.innerHTML="\n"+t.join("\n")+"\n"}else this.innerHTML=this.innerHTML.replace(/<widget>/gi,"[widget]").replace(/<\/widget>/gi,"[/widget]").trim();e+=this.outerHTML.replace(/\[(\/?widget)\]/gi,"<$1>")+"\n\n"}),t.remove(),e};return{leave:function(t){var n=this.getContainer(!0);if(n&&n.length){e.toggleToolbarButtons(!0,null,["source"]),e.html(n.val()).restoreWidgets(),e.removeUnwanted(),e.rescueOrphans(),n.hide(),e.show(),t&&e.trigger("change");var i=e.extensions.dom.findTextNode(e.get(0));if(!i){var r=e.find("> *:first").get(0);r||(e.rescueOrphans(),r=e.find("> *:first").get(0)),e.extensions.dom.makeNonEmpty(r),i=r}e.extensions.dom.setCursor(i,0)}},getContainer:function(t){var n=e.siblings(".editor-source:first"+(t?":visible":""));return n.length?n:null},index:function(){var t=e.siblings(".editor-source:first");t.length||(t=jQuery("<textarea/>").addClass("editor-source").insertAfter(e),t.css({width:e.outerWidth()-parseInt(t.css("padding-left"))-parseInt(t.css("padding-right"))+"px",height:e.outerHeight()+"px",resize:"vertical"}).hide()),"block"==t.css("display")?this.leave(!0):(e.toggleToolbarButtons(!1,null,["source"]),e.backupWidgets(!1),t.val(n(e.getHtml())),e.hide(),t.show())},toolbuttons:{source:{name:window.t("Toggle visual/HTML mode"),icon:"source.png",onclick:function(e){this.extensions.source.index(e)},special:!0}}}},jQuery.fn.editorextensions=jQuery.fn.editorextensions||{},jQuery.fn.editorextensions.widgets=function(e,t){var n,i=t.widgets||[],r=t.widgetsLayout||[["image","slideshow","audio","file","broadcast"],["chess-board","tournament","table","simple-chess-board","author"],["ebook-section","ebook-exercise","external-video","google-maps","twitter","html"]],o=0,a=new Handler.Template("widgets");return{lastwidgetid:0,widgetid:function(){return"new"+ ++this.lastwidgetid},borrowedWidgets:function(e){var t=this;e.each(function(){var e=jQuery(this),n=t.widgetid(),i=jQuery.parseJSON(e.attr("data"));i&&(i.vid=n,e.attr("data",jQuery.toJSON(i)));var r=e.data("widget");r&&(r.vid=n,e.data("widget",r))})},setupButtons:function(){var e=this;this.form.on("click",".add-button",function(){var t=jQuery(this).data("key");e.addResource(t),e.form.find(".resources-previews").hide(),e.form.find(".resource-properties[data-key="+t+"]").show()}),this.form.on("click",".edit-button",function(){var t=jQuery(this).closest(".resources-preview-item").data("resource-id");e.editResource(t)}),this.form.on("click",".save-button",function(){var t=jQuery(this).closest(".resource-properties"),n=t.data("resource-id");e.saveResource(n,t)}),this.form.on("click",".delete-button",function(){var t=jQuery(this).closest(".resources-preview-item").data("resource-id");e.removeResource(t)})},collectResource:function(e){var t={"class":void 0,reference_id:void 0,properties:{}};return e.find("input,select,textarea").each(function(){var e=jQuery(this);if(!e.is("input[type=radio],input[type=checkbox]")||e.is(":checked")){var n=e.val();e.is("input[type=hidden]")&&e.parent().is(".checkbox")&&(n=e.parent().is(".checked")?"on"==e.val()?1:e.parent().attr("data")||1:""),"json"==e.data("format")&&n&&(n=jQuery.parseJSON(n));var i=jQuery(this).data("resource-property");switch(i){case"reference_id":t.reference_id=n;break;case"class":t["class"]=n;break;default:i&&("[]"==i.substr(i.length-2)?(i=i.substr(0,i.length-2),Array.isArray(t.properties[i])?t.properties[i].push(n):t.properties[i]=[n]):t.properties[i]=n)}}}),t},collectProperties:function(e){var t={wid:void 0,vid:void 0,properties:{}};return e.find("input,select,textarea").each(function(){var e=jQuery(this),n=e.val();e.is("input[type=radio],input[type=checkbox]")?n=e.is(":checked")?"on"==n?1:n:"on"==n?0:"":e.is("input[type=hidden]")&&e.parent().is(".checkbox")&&(n=e.parent().is(".checked")?"on"==e.val()?1:e.parent().attr("data")||1:""),"json"==e.data("format")&&n&&(n=jQuery.parseJSON(n));var i=jQuery(this).data("widget-property");switch(i){case"wid":t.wid=n;break;case"vid":t.vid=n;break;default:i&&("[]"==i.substr(i.length-2)?(i=i.substr(0,i.length-2),Array.isArray(t.properties[i])?t.properties[i].push(n):t.properties[i]=[n]):t.properties[i]=n)}}),t},addResource:function(e){this.form.find(".resources-previews").hide();var t=this.form.find(".resource-properties[data-key="+e+"]").show().trigger("show");t.find("[data-resource-property]").val("").html(""),t.find("[data-resource-property=class]").val(e),t.find("[data-resource-property=reference_id]").val(""),t.data("resource-id",-1)},editResource:function(e){var t=this.widgetdata.resources[e];this.form.find(".resources-previews").hide();var n=this.form.find(".resource-properties[data-key="+t["class"]+"]").show().trigger("show");n.find("[data-resource-property=class]").val(t["class"]),n.find("[data-resource-property=reference_id]").val(t.reference_id),n.data("resource-id",e);for(var i in t.properties)n.find("[data-resource-property="+i+"]").each(function(){var e=jQuery(this);e.is(".editor")?e.html(t.properties[i]):e.val(t.properties[i])})},saveResource:function(e,t){(0>e||"undefined"==typeof e)&&(e=this.widgetdata.resources.length);var n=this.collectResource(t);n._id=e,this.widgetdata.resources[e]=n;var i=a.render("widget-"+this.widgetdata.wid+"-preview-"+n["class"],n),r=jQuery(i).attr("data-resource-id",e);return this.form.find(".resources-previews [data-resource-id="+e+"]").length?this.form.find(".resources-previews [data-resource-id="+e+"]").replaceWith(r):this.form.find(".resources-previews .resources-previews-list").append(r),this.form.trigger("update"),this.form.find(".resources-previews").show(),this.form.find(".resource-properties").hide(),e},removeResource:function(e){this.widgetdata.resources.remove(e),this.form.find(".resources-previews [data-resource-id="+e+"]").remove(),this.form.trigger("update")},reorderResources:function(e){for(var t=[],n=0;n<e.length;n++){var i=this.widgetdata.resources[e[n]];i._id=n,t.push(i)}this.widgetdata.resources=t},createWidget:function(n,i){var r=this,o=Widgets[n.toCamelCase(!0)]();this.widgetdata={vid:this.widgetid(),wid:n,properties:jQuery.extend({},o.properties),resources:[]},this.widget=i||null;var s=a.render("widget-"+this.widgetdata.wid+"-dialog",this.widgetdata);this.form=jQuery(s);var l={};l[window.t("Insert")]=function(e){return r.save(),!0},e.showToolDialog(this.form,null,l),this.setupButtons(),o.dialog(this.form,e,t,{},this.widget)},editWidget:function(n){var i=this;this.widgetdata=jQuery.extend({},n.data("widget"));for(var r=0;r<this.widgetdata.resources.length;r++)this.widgetdata.resources[r]._id=r;this.widget=n;var o=a.render("widget-"+this.widgetdata.wid+"-dialog",this.widgetdata);this.form=jQuery(o);var s=Widgets[this.widgetdata.wid.toCamelCase(!0)](),l={};l[window.t("Save")]=function(e){return i.save(),!0},l[window.t("Delete")]=n?function(r){jQuery.parseJSON(n.attr("data"));s.remove(n,e,t)||i.remove(n)}:null,e.showToolDialog(this.form,n,l),this.setupButtons(),s.dialog(this.form,e,t,{},n),jQuery(document).trigger("newhtml")},save:function(){var n=this,i=Widgets[this.widgetdata.wid.toCamelCase(!0)](),r=this.collectProperties(this.form);this.widgetdata.vid=r.vid||this.widgetdata.vid,this.widgetdata.wid=r.wid||this.widgetdata.wid,this.widgetdata.properties=jQuery.extend({},i.properties,this.widgetdata.properties,r.properties),this.form.is(".singleresource")&&(this.widgetdata.resources=[this.collectResource(this.form)]);for(var o=this.widgetdata.resources.length-1;o>=0;o--)this.widgetdata.resources[o]&&this.widgetdata.resources[o]["class"]||this.widgetdata.resources.remove(o);var s=[];for(var l in t.formData)s.push(l+"="+t.formData[l]);s.push("widget[wid]="+this.widgetdata.wid),s.push("widget[vid]="+this.widgetdata.vid);for(var c in this.widgetdata.properties)if("function"!=typeof this.widgetdata.properties[c])if(Array.isArray(this.widgetdata.properties[c]))for(var o=0;o<this.widgetdata.properties[c].length;o++)s.push("widget[properties]["+c+"][]="+this.widgetdata.properties[c][o]);else s.push("widget[properties]["+c+"]="+this.widgetdata.properties[c]);for(var o=0;o<this.widgetdata.resources.length;o++){s.push("widget[resources]["+o+"][class]="+this.widgetdata.resources[o]["class"]),this.widgetdata.resources[o].reference_id&&s.push("widget[resources]["+o+"][reference_id]="+this.widgetdata.resources[o].reference_id);for(var c in this.widgetdata.resources[o].properties)if("function"!=typeof this.widgetdata.resources[o].properties[c])if(Array.isArray(this.widgetdata.resources[o].properties[c]))for(var d=0;d<this.widgetdata.resources[o].properties[c].length;d++)s.push("widget[resources]["+o+"][properties]["+c+"][]="+this.widgetdata.resources[o].properties[c][d]);else s.push("widget[resources]["+o+"][properties]["+c+"]="+this.widgetdata.resources[o].properties[c])}jQuery.post(t.validateWidgetUrl,s.join("&")).success(function(t){if(0==t.status){var i=a.render("widget-"+n.widgetdata.wid+"-content",n.widgetdata),r=jQuery(i).attr("data-widget",jQuery.toJSON(n.widgetdata));n.widget?n.widget.replaceWith(r):e.insertAtCursor(r),e.setupWidgets(),e.hideToolDialog()}}).error(function(t){e.showToolDialogErrors(jQuery.parseJSON(t.responseText).errors)})},instantCreate:function(t,n){if(!t||!t.wid)return null;t.vid=this.widgetid();var i=a.render("widget-"+t.wid+"-content",t),r=jQuery(i).attr("data-widget",jQuery.toJSON(t));return n?r:(e.insertAtCursor(r),e.setupWidgets(),e.hideToolDialog(),void 0)},remove:function(n){var i=n.data("widget");Widgets[i.wid.toCamelCase(!0)]().remove(n,e,t)||(n.remove(),e.rescueOrphans())},checkBack:function(){var t=e.find(e.widgetmask).last(),n=t;if(n.length){for(;!e.is(n)&&n.length;){if(n.next().length||n.get(0).nextSibling)return;n=n.parent()}var i=e.find("> *").last();if(t.closest(i).length){var r=jQuery("<p/>").appendTo(e);e.extensions.dom.makeNonEmpty(r.get(0))}}},initialize:function(n){var i=this,r=n.attr("data");if(r){r=jQuery.parseJSON(r),Widgets[r.wid.toCamelCase(!0)]().create(n,e,t),n.off("dblclick").on("dblclick",function(){e.extensions.dom.unsetSelection(),i.editWidget(n)});var o=n.attr("properties");if(o&&(o=jQuery.parseJSON(o),o.resizable&&e.extensions.resizable&&e.extensions.resizable.index(n,o.resizable)),!n.is(e.widgetmaskInline)){var a=jQuery("<div/>").addClass("widget-main-buttons").appendTo(n);a.append(jQuery("<a/>").addClass("edit").on("click",function(){n.trigger("dblclick")})),a.append(jQuery("<a/>").addClass("delete").on("click",function(){e.extensions.widgets.remove(n)}))}}},index:function(t){var a=this;e.extensions.dom.getSelection();n=t;var s=jQuery("<div/>").addClass("widget-groups");s.append(jQuery("<h3/>").html(window.t("Insert Media")));for(var l={},c=0;c<i.length;c++)l[i[c].name]=i[c].label;for(var c=0;c<r.length;c++){for(var d=jQuery("<div/>"),u=!1,h=0;h<r[c].length;h++){var f=r[c][h];l[f]&&(u=!0,d.append(jQuery("<span/>").html(l[f]).on("mousedown",function(e){return function(t){return a.createWidget(e),!1}}(f))))}u&&d.appendTo(s)}setTimeout(function(){e.hideToolDialog(o)||(o=e.showToolDialog(s,t))},10)},toolbuttons:{widgets:{name:window.t("Widgets"),icon:"image.png",onclick:function(e){this.extensions.widgets.index(e)},special:!0},simplechessboard:{name:window.t("Insert Diagram"),icon:"simplechessboard.png",onclick:function(e){var t=this;t.find(".widgetcontainer.simple-chess-board").length?t.extensions.widgets.editWidget(t.find(".widgetcontainer.simple-chess-board")):t.extensions.widgets.createWidget("simple-chess-board")},special:!0},chessboard:{name:window.t("Insert Diagram"),icon:"simplechessboard.png",onclick:function(e){this.toolDialog.is(":visible")?this.hideToolDialog():this.extensions.widgets.createWidget("chess-board")}}}}},jQuery.fn.editorextensions=jQuery.fn.editorextensions||{},jQuery.fn.editorextensions.wrapper=function(e,t){return{index:function(t){return function(n){var i=e.extensions.dom.getSelection();if(i){var r=i.startContainer,o=i.endContainer,a=i.startOffset,s=i.endOffset;if(r==o&&a==s&&0==jQuery(r).closest(t).length){var l=document.createElement(t);l.innerHTML="&zwnj;";var c=l.childNodes[0];if(1==r.nodeType)0==a?r.insertBefore(l,r.childNodes[0]):r.appendChild(l);else if(3==r.nodeType){var d=document.createTextNode(r.nodeValue.substr(a));r.nodeValue=r.nodeValue.substr(0,a),r.parentNode.insertBefore(d,r.nextSibling),r.parentNode.insertBefore(l,d)}return void e.extensions.dom.setCursor(c,"after")}var u=e.extensions.dom.treeToVector(e.get(0).childNodes);if(1==r.nodeType&&(a?(r=r.childNodes[a-1],a=r.nodeValue.length):r=r.childNodes[0]),1==o.nodeType&&(o=s?o.childNodes[s-1]:o.childNodes[0],s=o.nodeValue.length),r&&o&&u.contains(r)&&u.contains(o)){for(;a<r.nodeValue.length&&" "==r.nodeValue.substr(a,1);a++);for(;s>0&&" "==o.nodeValue.substr(s-1,1);s--);C=u.indexOf(r);var h=null,f=void 0,p=null,m=void 0,g=jQuery(r).closest(t),v=jQuery(o).closest(t);if(g.length&&v.length&&g.is(v)){var y=e.extensions.dom.breakNode(g,[[r,a],[o,s]]);g.after(y[2]);var b=jQuery(y[1]).contents();1==b.length&&3==b[0].nodeType&&""==b[0].nodeValue?g.after("&zwnj;"):g.after(jQuery(y[1]).contents()),g.replaceWith(y[0]),h=e.extensions.dom.findTextNode(y[0].nextSibling,"forward"),f=0,p=e.extensions.dom.findTextNode(y[2].previousSibling,"back"),m=p.nodeValue.length}else{for(var w=!1,k=u.indexOf(r),x=u.indexOf(o),C=k;x>=C;C++){var l=u[C],j=jQuery(l);1==l.nodeType&&j.is(t)&&(j.is(v)||j.is(g)||(h||(h=e.extensions.dom.findTextNode(j.get(0))),p=e.extensions.dom.findTextNode(j.get(0),"end"),j.replaceWith(j.contents()),w=!0))}if(g.length){var y=e.extensions.dom.breakNode(g,[[r,a]]);g.after(jQuery(y[1]).contents()).after(y[0]).remove(),h=e.extensions.dom.findTextNode(y[0].nextSibling,"after"),f=0,p=null,m=void 0,w=!0}if(v.length){var y=e.extensions.dom.breakNode(v,[[o,s]]);v.before(jQuery(y[0]).contents()).after(y[1]).remove(),h?(p=e.extensions.dom.findTextNode(y[1],"back"),m=p.nodeValue.length):(h=e.extensions.dom.findTextNode(y[1],"back"),f=0,p=null,m=void 0),w=!0}if(!w){var T=e.extensions.dom.findBlockParent(r),_=e.extensions.dom.findBlockParent(o);if(r==o){var S=jQuery("<"+t+"/>").text(r.nodeValue.substr(a,s-a)).get(0),d=document.createTextNode(r.nodeValue.substr(s));r.nodeValue=r.nodeValue.substr(0,a),r.parentNode.insertBefore(S,r.nextSibling),r.parentNode.insertBefore(d,S.nextSibling),jQuery(S).find(e.widgetmask).insertBefore(S),h=S.childNodes[0],f=0,p=S.childNodes[0],m=S.innerHTML.length}else if(T==_){var I=i.commonAncestorContainer,y=e.extensions.dom.breakNode(I,[[r,a],[o,s]]),S=jQuery("<"+t+"/>").append(jQuery(y[1]).contents());jQuery(I).html("").append(jQuery(y[0]).contents()),jQuery(I).append(S),jQuery(I).append(jQuery(y[2]).contents()),h=e.extensions.dom.findTextNode(S.get(0)),p=e.extensions.dom.findTextNode(S.get(0),"end"),jQuery(S).find(e.widgetmask).insertBefore(S)}else{var y=e.extensions.dom.breakNode(T,[[r,a]]),S=jQuery("<"+t+"/>").append(jQuery(y[1]).contents());jQuery(T).html("").append(jQuery(y[0]).contents()),jQuery(T).append(S),h=e.extensions.dom.findTextNode(S.get(0)),jQuery(S).find(e.widgetmask).insertBefore(S);for(var P=e.extensions.dom.treeToVector(T.parentNode.childNodes,e.extensions.dom.isBlockElement),C=P.indexOf(T)+1;P[C]!=_&&C<P.length;C++)jQuery(P[C]).find(_).length>0||jQuery("<"+t+"/>").append(jQuery(P[C]).contents()).appendTo(jQuery(P[C]));y=e.extensions.dom.breakNode(_,[[o,s]]),S=jQuery("<"+t+"/>").append(jQuery(y[0]).contents()),jQuery(_).html("").append(jQuery(y[1]).contents()),jQuery(_).prepend(S),p=e.extensions.dom.findTextNode(S.get(0),"end"),jQuery(S).find(e.widgetmask).insertBefore(S)}}}e.find(t).each(function(){e.extensions.dom.deduplicate(this)}),h&&h.parentNode&&p&&p.parentNode?e.extensions.dom.setSelection(h,p,f,m):e.extensions.dom.setCursor(h,0)}}}},toolbuttons:{bold:{name:window.t("Bold"),icon:"bold.png",onclick:function(e){this.extensions.wrapper.index("strong")(e)},highlight:function(e){return this.extensions.highlight.check(e,"strong")},shortcut:window.t("Ctrl-B")},italic:{name:window.t("Italic"),icon:"italic.png",onclick:function(e){this.extensions.wrapper.index("i")(e)},highlight:function(e){return this.extensions.highlight.check(e,"i")},shortcut:window.t("Ctrl-I")},underline:{name:window.t("Underline"),icon:"underline.png",onclick:function(e){this.extensions.wrapper.index("u")(e)},highlight:function(e){return this.extensions.highlight.check(e,"u")},shortcut:window.t("Ctrl-U")},strike:{name:window.t("Strikethrough"),icon:"strike.png",onclick:function(e){this.extensions.wrapper.index("strike")(e)},highlight:function(e){return this.extensions.highlight.check(e,"strike")}}},provides:{options:{bold:{tags:["strong"]},italic:{tags:["i"]},underline:{tags:["u"]},strike:{tags:["strike"]}}}}},function(jQuery){var editorInstances={},tools={},dragging=null,defaultConfig={input:jQuery("null"),allowed:["p","br","span"],allowedInside:["div"],allowedAttributes:{span:["class"]},allowedCssProperties:[],attributeValueRestrictions:{},restricted:{div:function(e){return e.is(this.widgetmask)||e.is(this.widgetmaskInline)}},iconsUrl:config.assetDir()+"/images/editor/toolbar/",saveResource:"/",formData:{},extensions_url:"/js/editor/",extensions:[],toolbar:{left:["widgets","chess","source","simplechessboard","chessboard","|","character","bold","italic","underline","strike","link","emoticons","|","h1","h2","h3","|","alignleft","aligncenter","alignright","alignjustify","|","ulist","olist","|","indent","unindent","blockquote","hr"],right:["|","clear","undo","redo"]},height:600},lastid=0,init=function(e){var t=jQuery.extend(this,editor);if(t.extensions={},t.config=jQuery.extend(!0,{},defaultConfig,e),t.config.formData.csrf=config.csrf(),e.localBackup){jQuery.initNamespaceStorage("editor").localStorage}t.attr("id")||t.attr("id","editor-"+ ++lastid);for(var n=["dom","highlight","resizable"].concat(t.config.extensions),i=0;i<n.length;i++)t.load(n[i],t.config.extensions_url+"editor-"+n[i]+".js");t.attr("contenteditable",!0).attr("designmode",!1).css("min-height",parseInt(t.config.height)+"px").css("width",t.config.width?parseInt(t.config.width)+"px":""),t.find("div").attr("contenteditable",!1).attr("unselectable","on"),t.config.extraClass&&t.addClass(t.config.extraClass),t.config.watermark&&t.setWatermark(t.config.watermark),t.rescueOrphans(),t.setupWidgets(),t.createToolbar(),t.setupDialogs(),t.removeUnwanted(),t.pollChanges(),t.config.input&&0!==jQuery(t.config.input).length?t.config.input=jQuery(t.config.input):t.config.input=jQuery('<input type="hidden"/>').insertAfter(t),t.config.input.attr("value",t.config.escape?escape(t.getHtml(!0)):t.getHtml(!0)),t.on("change",function(e,n){t.handleOnChange(e,n)}).on("paste",function(e){setTimeout(function(){t.handleOnPaste(e)},10)}).on("keydown",function(e){t.handleOnKeyDown(e)}).on("keyup",function(e){t.handleOnKeyUp(e)}).on("keypress",t.config.maxLength?function(e){t.handleOnKeyPress(e)}:null).on("click focus",function(){t.handleOnFocus()}).on("cleanup",function(){t.removeUnwanted()}).on("drop",function(){setTimeout(function(){t.removeUnwanted()})}),t.closest("form").on("submit",function(e){t.handleOnFormSubmit(e)}),t.extensions.history&&t.extensions.history.start(),t.extensions.dom.flatten(t.get(0)),t.trigger("change",!0),e.localBackup&&setTimeout(function(){t.doLocalBackup.call(t)},10);try{document.execCommand("enableObjectResizing",null,!1)}catch(r){}return this},editor={widgetmask:"div.widgetcontainer",widgetmaskInline:"a.widgetcontainer-inline"};editor.load=function(name,url){var self=this,match=name.match(/^(\w+)\((.*)?\)$/),options=null;return match&&(name=match[1],options=match[2]?match[2].split(","):[]),"function"==typeof this.editorextensions[name]?this.registerExtension(name,this.editorextensions[name](this,this.config),options):jQuery.ajax({url:url,cache:!0,dataType:"text",async:!1,success:function(code){if("function"==typeof jQuery.fn.editorextensions[name])self.registerExtension(name,jQuery.fn.editorextensions[name](self,self.config),options);else{var $editor=self,$config=self.config;eval(code),"object"==typeof extension&&self.registerExtension(name,extension,options)}},error:function(e,t){errorHandler.msg("error",t,!1,{name:name,url:url})}}),this},editor.registerExtension=function(e,t,n){if(!(!t instanceof Object)){if("function"==typeof t.init&&t.init(this,this.config),this.extensions[e]=jQuery.extend({},t),t.toolbuttons)for(var i in t.toolbuttons)(!n||n.contains(i))&&(tools[i]=t.toolbuttons[i]);if(t.provides){if(t.provides.options){if(!n||!n.length){n=[];for(var r in t.provides.options)t.provides.options.hasOwnProperty(r)&&n.push(r)}for(var o=0;o<n.length;o++){var r=t.provides.options[n[o]];r.tags&&(t.provides.tags=(t.provides.tags||[]).concat(r.tags)),r.attributes&&(t.provides.attributes=jQuery.extend(t.provides.attributes||{},r.attributes)),r.cssProperties&&(t.provides.cssProperties=(t.provides.cssProperties||[]).concat(r.cssProperties))}}if(t.provides.tags&&(this.config.allowed=this.config.allowed.concat(t.provides.tags)),t.provides.attributes)for(var i in t.provides.attributes)this.config.allowedAttributes[i]?this.config.allowedAttributes[i]=this.config.allowedAttributes[i].concat(t.provides.attributes[i]):this.config.allowedAttributes[i]=t.provides.attributes[i];if(t.provides.cssProperties&&(this.config.allowedCssProperties=this.config.allowedCssProperties.concat(t.provides.cssProperties)),t.provides.attributeValueRestrictions){var a=this.config.attributeValueRestrictions,s=t.provides.attributeValueRestrictions;for(var l in s)if(a[l])for(var c in s[l])a[l][c]&&(a[l][c]=a[l][c].concat(s[l][c])),a[l][c]=s[l][c];else a[l]=s[l]}}}},editor.insertAtCursor=function(e){var t=this.extensions.dom.getSelection();if(t&&t.startContainer&&!this.is(t.startContainer)){var n=this.extensions.dom.findTextNode(t.startContainer,t.startOffset);if(n){var i=n;if(3==i.nodeType&&(i=this.extensions.dom.findNonTextNode(i)),i){var r=jQuery(i).is(this.widgetmaskInline)?jQuery(i):jQuery(i).closest(this.widgetmaskInline);if(r.length)return void r.before(e)}}else{if(1==t.startContainer.childNodes.length&&t.startContainer.firstChild.tagName&&"br"==t.startContainer.firstChild.tagName.toLowerCase()){if(e instanceof jQuery&&e.is(this.widgetmask))return e.insertBefore(t.startContainer),this.extensions.dom.makeNonEmpty(t.startContainer),this.extensions.dom.setCursor(t.startContainer,0),void this.registerCursor();try{var o=jQuery(e);if(o.is(this.widgetmask)||o.is(this.widgetmaskInline))return o.insertBefore(t.startContainer),this.extensions.dom.makeNonEmpty(t.startContainer),this.extensions.dom.setCursor(t.startContainer,0),void this.registerCursor()}catch(a){}jQuery(t.startContainer).find("*").remove()}n=document.createTextNode(""),t.startContainer.appendChild(n)}var s=n.parentNode,l=document.createTextNode(n.nodeValue.substr(t.startOffset)),c=t.startOffset;if("string"==typeof e)try{
c+=jQuery(e).text().length}catch(a){c+=e.length}else e instanceof jQuery?c+=e.text().length:("undefined"!=typeof Node&&e instanceof Node||"undefined"!=typeof e.nodeType)&&(c+=(e.innerText||e.textContent||e.nodeValue||"").length);n.nodeValue=n.nodeValue.substr(0,t.startOffset),s.insertBefore(l,n.nextSibling),jQuery(n).after(e);var d=this.extensions.dom.findTextOffset(l,s);this.extensions.dom.flatten(n.parentNode,!0),this.extensions.dom.setCursor(s,d),this.registerCursor(),delete l,delete n}else if(this.cursorLastSeenAt){if(jQuery(this.cursorLastSeenAt).is(this.widgetmask)||jQuery(this.cursorLastSeenAt).is(this.widgetmaskInline))jQuery(this.cursorLastSeenAt).before(e);else if(this.extensions.dom.isBlockElement(this.cursorLastSeenAt))jQuery(this.cursorLastSeenAt).prepend(e);else if(1==this.cursorLastSeenAt.nodeType)this.cursorLastSeenAt.after(e);else if(3==this.cursorLastSeenAt.nodeType){var n=this.cursorLastSeenAt,u=this.cursorLastSeenAtIndex,l=document.createTextNode(n.nodeValue.substr(u));n.nodeValue=n.nodeValue.substr(0,u),n.parentNode.insertBefore(l,n.nextSibling);try{jQuery(n).after(e)}catch(a){jQuery(document.createTextNode(e)).insertAfter(n)}this.registerCursor(),delete l,delete n}}else this.append(jQuery("<p/>").append(e));return delete t,this},editor.registerCursor=function(){var e=this.extensions.dom.getSelection();if(e&&e.startContainer){var t=jQuery(this.extensions.dom.findNonTextNode(e.startContainer));if(t.is(this.widgetmask)||t.closest(this.widgetmask).length>0){var n=t.is(this.widgetmask)?t:t.closest(this.widgetmask),i=this.extensions.dom.treeToVector(this.get(0).childNodes),r=i.indexOf(n.parent().get(0));if(-1==r)return;for(var o=r+1;o<i.length;o++)if(3==i[o].nodeType&&i[o].nodeValue.trim())return this.extensions.dom.setCursor(i[o],0),void this.registerCursor();for(o=r-1;o>=0;o--)if(3==i[o].nodeType&&i[o].nodeValue.trim())return this.extensions.dom.setCursor(i[o],i[o].nodeValue.length-1),void this.registerCursor()}this.cursorLastSeenAt=e.startContainer,this.cursorLastSeenAtIndex=e.startOffset}e&&delete e},editor.setFocus=function(e){if(this.preventFocus)return void(this.preventFocus=!1);if(this.extensions.dom.msie||this.focus(),this.is(document.activeElement)||e){var t=this.extensions.dom.getSelection();if(t&&t.startContainer==t.endContainer&&t.startOffset==t.endOffset&&this.cursorLastSeenAt){var n,i;1==this.cursorLastSeenAt.nodeType?(n=this.cursorLastSeenAt.childNodes[this.cursorLastSeenAtIndex],i=0):(n=this.extensions.dom.findTextNode(this.cursorLastSeenAt),i=this.cursorLastSeenAtIndex),n&&n.parentNode&&n.parentNode.parentNode&&this.extensions.dom.setCursor(n,i||0)}}},editor.doLocalBackup=function(){var e=this;if(storage.isSet(e.config.input.attr("id"))){var t=jQuery("<div/>").append(storage.get(e.config.input.attr("id"))).find(e.widgetmask+","+e.widgetmaskInline).remove().end().html().replace(/<[^>]+>/gm,"").replace(/[\s\n\t]+/g," ").trim(),n=jQuery("<div/>").append(jQuery(e.html())).find(e.widgetmask+","+e.widgetmaskInline).remove().end().html().replace(/<[^>]+>/gm,"").replace(/[\s\n\t]+/g," ").trim();t!=n&&Dialog.confirmation(window.t("An unsaved backed up version of this article is found, do you want to restore it?"),function(){e.html(storage.get(e.config.input.attr("id"))),e.removeUnwanted(),e.extensions.dom.flatten(e.get(0)),e.setupWidgets(),e.rescueOrphans(),e.trigger("afterpaste")})}},editor.createToolbar=function(e){var t=this;e=e||t.config.toolbar,jQuery.isArray(e)&&(e={left:e,right:[]});var n=function(e,n){for(var i=0;i<e.length;i++){var r=e[i];if("|"!=r){var o=tools[r];if(o){var a=o.getCustomContent?o.getCustomContent(t.config.iconsUrl):jQuery('<img src="'+t.config.iconsUrl+o.icon+'"/>'),s=o.name+(o.shortcut?" ("+o.shortcut+")":""),l="toolbar-"+r+(o.special?" special":"")+(o.customClasses?" "+o.customClasses:""),c=jQuery("<span/>").addClass(l).empty().append(a).attr("title",s);o.onclick&&c.on("click",function(e){return function(){jQuery(this).hasClass("disabled")||(t.setFocus(),e.call(t,jQuery(this)))}}(o.onclick)),n.append(c)}}else{var d=n.find("> :last");if(d.is(".separator")||0===d.length)continue;n.append(jQuery("<span>").html('<img src="'+config.assetDir()+'/images/editor/toolbar/separator.png"/>').addClass("separator"))}}},i=jQuery("<div/>").addClass("editor-toolbar"+(t.config.extraClass?" "+t.config.extraClass:"")).insertBefore(this).append(jQuery('<div class="banner"/>').html(t.config.banner||""));if(!this.config.hideToolbar){var r=jQuery("<div/>").addClass("editor-toolbar-right").appendTo(i);n(e.right,r);var o=jQuery("<div/>").addClass("editor-toolbar-left").appendTo(i);n(e.left,o)}var a=jQuery("<div/>").addClass("info").appendTo(i);if(a.append(jQuery("<div/>").addClass("info-right").html(window.t("autosaved at")+" <span>17:34</span>")),a.append(jQuery("<div/>").addClass("info-left").html(window.t("created on")+" <span>05.05.2013</span>")),a.append(jQuery("<div/>").addClass("info-center").html(window.t("modified on")+" <span>05.05.2013</span>")),!this.config.scrollToolbar)return void i.css("width","auto");var s=i.clone(!0),l=function(){var e=t;if(!e.is(":visible")&&t.extensions.source){var n=t.extensions.source.getContainer();n&&n.is(":visible")&&(e=n)}return e.outerWidth()-parseInt(i.css("padding-left"))-parseInt(i.css("padding-right"))-parseInt(i.css("border-left-width"))-parseInt(i.css("border-right-width"))};return i.css("width","auto"),jQuery(window).on("scroll resize",function(){if(i.is(":visible")){var e=t;t.extensions.source&&(e=t.extensions.source.getContainer(!0)||e);var n=jQuery(":visible").filter(function(){return"fixed"==jQuery(this).css("position")&&0==parseInt(jQuery(this).css("top"))}).outerHeight()||0;n=Math.max(0,n-5-parseInt(i.css("margin-top")));var r=l(),o=e.offset().top-i.outerHeight()+(s.parent().length&&i.find(".editor-dialog").is(":visible")?i.find(".editor-dialog").outerHeight():0);if(i.css("width",r+"px"),o<jQuery(document).scrollTop()+n){var a=e.offset().left-parseInt(i.css("margin-left"));"fixed"!=i.css("position")?(s.insertBefore(i),i.addClass("detached").css({left:a+"px",top:n+"px"})):i.css("left",a+"px")}else s.detach(),i.removeClass("detached").css({left:"auto",top:"auto"})}}),this},editor.toggleToolbarButtons=function(e,t,n){var i=jQuery("null"),r=this.prev(".editor-toolbar");if(t)for(var o=0;o<t.length;o++)i=i.add(r.find(".toolbar-"+t[o]));if(n){t||(i=r.find("span"));for(var o=0;o<n.length;o++)i=i.not(".toolbar-"+n[o])}i[e?"removeClass":"addClass"]("disabled")},editor.setupDialogs=function(){var e=this,t=this.prev(".editor-toolbar");return this.toolDialog=jQuery('<div class="editor-dialog" />').hide().append('<div class="decoration"/>').insertBefore(t.find(".info")),this.toolDialog.append(jQuery("<a/>").addClass("collapse").on("click",function(){e.hideToolDialog()})),this.toolDialogErrors=jQuery('<div class="editor-dialog-errors"/>').appendTo(this.toolDialog).hide(),this.toolDialogContent=jQuery('<div class="editor-dialog-content"/>').appendTo(this.toolDialog),this.toolDialogButtons=jQuery('<div class="editor-dialog-buttons"/>').appendTo(this.toolDialog),jQuery(document).trigger("newhtml"),this},editor.setupWidgets=function(e){var t=this;e||(e=t.find(t.widgetmask).add(t.find(t.widgetmaskInline)));var n=function(e){t.setupDragging();try{e.originalEvent.dataTransfer.setData("text/html",'<span class="editor-movement"/>'),e.originalEvent.dataTransfer.dropEffect="copy",e.originalEvent.dataTransfer.effectAllowed="copy"}catch(e){e.returnValue=!1,e.cancelBubble=!0}dragging=jQuery(this)};return setTimeout(function(){var i=[];if(t.config.widgets)for(var r=0;r<t.config.widgets.length;r++)i.push(t.config.widgets[r].name);if(t.config.inlineWidgets)for(var r=0;r<t.config.inlineWidgets.length;r++)i.push(t.config.inlineWidgets[r].name);var o=function(){var e=jQuery(this),r=jQuery(this).is(t.widgetmaskInline),o=e.attr("data");if(o){if(o=jQuery.parseJSON(o),!i.contains(o.wid))return void jQuery(this).remove();r||(e.attr("draggable","true").attr("contenteditable","false").addClass("not-selectable"),e.find("*").attr("draggable",!1),t.extensions.dom.msie?e.off("mousedown").on("mousedown",n):e.off("dragstart").on("dragstart",n),e.css("overflow","visible")),t.extensions.widgets&&t.extensions.widgets.initialize(e)}},a=[];e.each(function(){var e=jQuery(this),n=e.data("widget");if(a.contains(n.vid)){n.vid=t.extensions.widgets.widgetid(),e.attr("data-widget",jQuery.toJSON(n));var i=jQuery.parseJSON(e.attr("data"));i.vid=n.vid,e.attr("data",jQuery.toJSON(i))}a.push(n.vid)}),e.filter(t.widgetmask).attr("contenteditable",!1).attr("unselectable","on").each(o),e.filter(t.widgetmaskInline).each(o)},1),this},editor.backupWidgets=function(e){var t=this;return this.widgetsCache={},this.find(this.widgetmask+", "+this.widgetmaskInline).each(function(){var n=jQuery(this),i=jQuery.parseJSON(n.attr("data")).vid;t.widgetsCache[i]=n.get(0).outerHTML,e&&n.replaceWith('<widget data="'+(n.attr("data-widget").replace(/"/g,"&quot;")||"")+'">'+i+"</widget>")}),this},editor.restoreWidgets=function(){if(!this.widgetsCache)return this;var e=this;return this.find("widget").each(function(){var t,n=jQuery(this);if("<widget"!=this.outerHTML.toLowerCase().substr(0,7)||this.innerHTML)var t=n.text();else{var t=this.nextSibling.nodeValue;this.parentNode.removeChild(this.nextSibling),this.parentNode.removeChild(this.nextSibling)}if(e.widgetsCache[t])n.replaceWith(e.widgetsCache[t]);else if(e.extensions.widgets){var i=n.attr("data");if(i)try{i=jQuery.parseJSON(i);var r=e.extensions.widgets.instantCreate(i,!0);r?n.replaceWith(r):n.remove()}catch(o){n.remove()}}}),this.setupWidgets(),this},editor.isWidgetAllowed=function(e){var t=[];if(this.config.widgets)for(var n=0;n<this.config.widgets.length;n++)t.push(this.config.widgets[n].name);if(this.config.inlineWidgets)for(var n=0;n<this.config.inlineWidgets.length;n++)t.push(this.config.inlineWidgets[n].name);return t.contains(e)},editor.setupDragging=function(){var e=this,t=function(t){if(dragging&&!e.extensions.dom.msie){if(t.preventDefault(),document.caretRangeFromPoint)var n=document.caretRangeFromPoint(t.originalEvent.clientX,t.originalEvent.clientY);else t.originalEvent.rangeParent&&(n=document.createRange(),n.setStart(t.originalEvent.rangeParent,t.originalEvent.rangeOffset));var i=n.offsetNode||n.startContainer,r=n.offset||n.startOffset;if(3==i.nodeType){var o=i.splitText(r);i.parentNode.insertBefore(dragging.get(0),o)}else jQuery(i).before(dragging);return void(dragging=void 0)}if(dragging){e.off("mousemove").off("dragend").off("mouseup").off("selectstart");var a=e.find(".editor-movement:first");if(a.length>0)if(a.parent().is(e))e.insertAtCursor(dragging);else{var s=a.closest(e.widgetmask).add(a.closest(e.widgetmaskInline));s.length&&a.insertAfter(s);var l=e.extensions.dom.findBlockParent(a.get(0)),c=e.extensions.dom.closestChildOf(a.get(0),l);c!=a.get(0)&&a.insertBefore(c);var d=jQuery(l).clone().find(".editor-movement").remove().end();e.extensions.dom.isEmpty(d.get(0))?jQuery(l).html("").append(dragging):a.replaceWith(dragging),e.extensions.dom.flatten(l),d.remove(),delete d}else{var u;if(t.originalEvent.clientX||t.originalEvent.clientY){var u=document.elementFromPoint(t.originalEvent.clientX,t.originalEvent.clientY);if(u&&!jQuery(u).is(e)&&0==e.find(u).length)return e.find(".editor-movement").remove(),void(dragging=null)}if(u){var h=jQuery(u);if(h.is(e.widgetmaskInline)){for(var f="",p=u.className.split(" "),m=0;m<p.length;m++)if("vid-"==p[m].substr(0,4)){f=p[m];break}f&&jQuery("."+f).not(":first").each(function(){h.append(jQuery(this).contents())}).remove(),h.after(dragging)}else h.is(e.widgetmask)||h.closest(e.widgetmask).length||(e.extensions.dom.isEmpty(u)?h.html("").append(dragging):e.insertAtCursor(dragging))}else{e.insertAtCursor(dragging);var l=e.extensions.dom.findBlockParent(dragging.get(0).parentNode),c=e.extensions.dom.closestChildOf(dragging.get(0),l);c!=dragging.get(0)&&dragging.insertBefore(c)}}dragging.trigger("chess24:dragend")}e.find(".editor-movement").each(function(){jQuery(this).replaceWith(jQuery(this).contents())}),dragging=null,e.rescueOrphans()},n=function(t){e.extensions.dom.msie&&e.extensions.dom.setSelectionXY(t.clientX,t.clientY)};return this.extensions.dom.msie?(this.off("mousemove").on("mousemove",n),this.off("mouseup").on("mouseup",t),this.off("selectstart").on("selectstart",function(e){return e.originalEvent.returnValue=!1,!1})):this.off("dragover").on("dragover",function(e){e.stopPropagation()}).off("drop").on("drop",t),this},editor.pollChanges=function(e){var t=this,n=this.getHtml(!0);"undefined"!=typeof MutationObserver?new MutationObserver(function(){var e=t.getHtml(!0);e!=n&&(n=e,t.pcto&&clearTimeout(t.pcto),t.pcto=setTimeout(function(){t.trigger("change")},100))}).observe(t.get(0),{childList:!0,attributes:!0,characterData:!0,subtree:!0,attributeOldValue:!0,characterDataOldValue:!0}):"undefined"!=typeof MutationEvent?this.on("DOMSubtreeModified DOMAttrModified",function(){t.pcto&&clearTimeout(t.pcto),t.pcto=setTimeout(function(){var e=t.getHtml(!0);e!=n&&(n=e,t.trigger("change"))},10)}):("undefined"!=typeof e&&n!=e&&this.trigger("change"),setTimeout(function(){t.pollChanges(n)},100))},editor.scrollToolDialog=function(e){var t=e.offset().top-this.toolDialogContent.offset().top-20;this.toolDialogContent.animate({scrollTop:t},200)},editor.toggleToolDialogButtons=function(e){return this.toolDialogButtons[e?"show":"hide"](),this},editor.showToolDialogErrors=function(e){var t=jQuery("<ul/>");for(var n in e)for(var i=0;i<e[n].length;i++)t.append(jQuery("<li/>").html(e[n][i]));return this.toolDialogErrors.html("").append(t).show(),this.toolDialog.bubble("adjust"),this},editor.hideToolDialogErrors=function(){return this.toolDialogErrors.hide(),this.toolDialog.bubble("adjust"),this},editor.serializeToolDialog=function(e){var t={},n=this.toolDialogContent;return n.length||(n=this.toolDialogContent),n.find("input, select, textarea").each(function(){var n=jQuery(this);("function"!=typeof e||e(n))&&this.name&&("checkbox"!=n.attr("type")&&'"radio'!=n.attr("type")||n.get(0).checked)&&("[]"==this.name.substr(this.name.length-2)?t[this.name]?t[this.name].push(this.value):t[this.name]=[this.value]:t[this.name]=this.value)}),t},editor.showToolDialog=function(e,t,n,i){var r=this;if(r.toolDialogContent.html("").append(e),r.toolDialogButtons.show().find("*").remove().end().removeClass("overflow"),r.toolDialogErrors.hide().find("*").remove(),n){this.toolDialogButtons.show();var o=0;for(var a in n)"function"==typeof n[a]&&jQuery("<a/>").addClass("cBtn cBtnGrey button-"+ ++o).attr("data-cancel",a==window.t("Cancel")?1:0).html(a).appendTo(this.toolDialogButtons).one("click",function(e){return function(){n[e](r.serializeToolDialog(i))||r.hideToolDialog()}}(a))}else this.toolDialogButtons.hide();var s=r.toolDialog.css("height","auto").height();return r.toolDialog.css("height","0px").show().stop().animate({height:s+"px"},200,function(){r.toolDialog.css("height","auto"),layout(r.toolDialog)}),r.toolDialog.on("keypress keyup",function(e){if(13==e.which){var t=jQuery(e.target);t.is("textarea")||t.is("[contenteditable]")||e.preventDefault()}}),this.dialogCounter=this.dialogCounter?this.dialogCounter+1:1,this.dialogCounter},editor.hideToolDialog=function(e){var t=this;if("undefined"!=typeof e){if(t.dialogCounter!=e)return!1;if("none"==t.toolDialog.css("display"))return t.dialogCounter=void 0,!1}return t.toolDialogButtons.find("a[data-cancel=1]")&&t.toolDialogButtons.find("a[data-cancel=1]").trigger("click"),t.dialogCounter=void 0,t.toolDialog.stop().animate({height:"0px"},200,function(){t.toolDialog.hide().css("height","auto")}),!0},editor.rescueOrphans=function(){var e="p,h1,h2,h3,ul,ol,hr";if(0==this.find(e).length){var t=jQuery("<p/>").append(this.contents()).appendTo(this);return this.extensions.dom.makeNonEmpty(t.get(0)),delete t,this}for(var n=this.get(0).childNodes,i=0;i<n.length;i++)jQuery(n[i]).is(this.widgetmask)||(!n[i]||3!=n[i].nodeType&&this.extensions.dom.isBlockElement(n[i])?this.extensions.dom.isBlockElement(n[i])&&""==n[i].innerHTML&&"hr"!=n[i].tagName.toLowerCase()&&(jQuery(n[i]).next().is(this.widgetmask)?jQuery(n[i]).append(jQuery(n[i]).next()):(n[i].parentNode.removeChild(n[i]),i--)):(n[i].nodeValue||n[i].innerText||n[i].textContent).length?1==n[i].nodeType?jQuery(n[i]).prev().is(e)?(jQuery(n[i]).appendTo(jQuery(n[i]).prev()),i--):jQuery(n[i]).wrap(jQuery("<p/>")):n[i].previousSibling&&jQuery(n[i].previousSibling).is(e)?(jQuery(n[i].previousSibling).append(n[i]),i--):(this.get(0).insertBefore(jQuery("<p/>").text(n[i].nodeValue).get(0),n[i]),this.get(0).removeChild(n[i+1])):(n[i].parentNode.removeChild(n[i]),i--));if(0==this.get(0).childNodes.length){var t=jQuery("<p/>").appendTo(this);this.extensions.dom.makeNonEmpty(t.get(0)),delete t}return this},editor.removeUnwanted=function(e){var t,n,i,r=jQuery(e),o={b:"strong",em:"i",s:"strike"};for(n in o)this.find(n).each(function(e){return function(){jQuery(this).after(jQuery("<"+o[e]+"/>").append(jQuery(this).contents())).remove()}}(n));var a=this.config.allowed.concat(this.config.allowedInside),s=[];if(e)if(1==e.nodeType){var l=e.tagName.toLowerCase();if(a.contains(l)){if(this.config.attributeValueRestrictions[l]){var c=this.config.attributeValueRestrictions[l];Object.every(c,function(t,n){return t.indexOf(e.getAttribute(n))>=0})||(s=Array.convert(e.childNodes),r.replaceWith(r.contents()))}if(this.config.restricted[l])if("function"==typeof this.config.restricted[l])this.config.restricted[l].call(this,r)||(s=s.concat(Array.convert(e.childNodes)),r.replaceWith(r.contents()));else{var d=this.config.restricted[l];for(t=0;t<d.length;t++){var u=!0;for(n in d[t])if(e.getAttribute(n)!=d[t][n]){u=!1;break}if(u)break}if(u)return;s=s.concat(Array.convert(e.childNodes)),r.replaceWith(r.contents())}else{var h=[];if(this.config.allowedAttributes[l]&&this.config.allowedAttributes[l].contains("style"))for(i=e.style.length,t=0;i>t;t++)this.config.allowedCssProperties.contains(e.style[t])||h.push(e.style[t]);for(i=h.length,t=0;i>t;t++)try{e.style.removeProperty(h[t])}catch(f){e.style[e.style[t]]=""}for(h=[],i=e.attributes.length,t=0;i>t;t++)this.config.allowedAttributes[l]&&this.config.allowedAttributes[l].contains(e.attributes[t].nodeName)||h.push(e.attributes[t].nodeName);if(e.className){var p=e.className.split(" ");for(i=p.length,t=0;i>t;t++)"mso"==p[t].substr(0,3).toLowerCase()&&r.removeClass(p[t]);""==e.className&&h.push("class")}for(""===r.attr("style")&&h.push("style"),i=h.length,t=0;i>t;t++)e.removeAttribute(h[t]);s=s.concat(Array.convert(e.childNodes))}}else"span"==l||"a"==l?(s=Array.convert(e.childNodes),r.replaceWith(r.contents())):(s=[],r.remove())}else 3==e.nodeType&&-1<e.nodeValue.indexOf("&nbsp;")&&(e.nodeValue=e.nodeValue.replace(/\&nbsp\;/g," "));else e=this.get(0),s=Array.convert(e.childNodes);for(i=s.length,t=0;i>t;t++)this.removeUnwanted(s[t])},editor.checkLength=function(){if(this.config.maxLength){var e=this.text().trim().length-this.config.maxLength;if(e>0){for(var t=this.extensions.dom.treeToVector(this.get(0).childNodes,function(e){return 3==e.nodeType}),n=t[t.length-1],i=t.length,r=i-1;r>=0;r--){var o=t[r].nodeValue.length;if(!(e>=o)){t[r].nodeValue=t[r].nodeValue.substr(0,o-e),n=t[r];break}if(e-=o,t[r].parentNode.removeChild(t[r]),n=r>0?t[r-1]:null,0==e)break}this.extensions.dom.setCursor(n,"after")}}},editor.quickClean=function(){var e=this;this.find("span").each(function(){var t=jQuery(this);if(!t.closest(e.widgetmask).length&&!t.attr("class")){var n=e.extensions.dom.getSelection();if(n&&n.startContainer&&t.find(n.startContainer).length){var i=!0;startContainer=this.childNodes[this.childNodes.length-1],startOffset=startContainer.nodeValue.length}for(;this.childNodes.length>0;)this.parentNode.insertBefore(this.childNodes[0],this);t.remove(),i&&e.extensions.dom.setCursor(startContainer,startOffset)}}),this.find("p").each(function(){for(var e=jQuery(this),t=Array.convert(this.childNodes),n=!1,i=e,r=t.length,o=0;r>o;o++){var a=jQuery(t[o]);a.is("p,h1,h2,h3,blockquote")?(i=a.insertAfter(i),n=!0):n&&(i=jQuery("<p/>").append(t[o]).insertAfter(i))}});var t=jQuery("nothing");this.find("p").each(function(){0==this.childNodes.length?t=t.add(this):1!=this.childNodes.length||3!=this.childNodes[0].nodeType||this.childNodes[0].nodeValue.trim()||(t=t.add(this))}),t.remove(),this.extensions.widgets&&this.extensions.widgets.checkBack()},editor.highlightToolbar=function(){return this},editor.setWatermark=function(e){jQuery.domCss("#"+this.attr("id")+'.watermark:before { content: "'+e+'" !important; }'),this.toggleWatermark()},editor.toggleWatermark=function(){if(this.config.watermark){var e=this.get(0).innerHTML,t=""===e||"<p><br></p>"===e||"<p></p>"===e;this[t?"addClass":"removeClass"]("watermark")}},editor.keypress=function(e,t,n,i){var r={del:46,entf:46,tab:9,back:8,enter:13},o=function(e){var t={ctrl:!1,shift:!1,alt:!1,code1:0,code2:0},n=e.match(/^((.*)\s*[-\+]\s*)?(.*)$/);if(n){var i=n[2]?n[2].toLowerCase().replace("+","-").replace(" ","").split("-"):[];t.ctrl=i.contains("ctrl")||i.contains("strg"),t.shift=i.contains("shift"),t.alt=i.contains("alt"),t.code1=n[3]?r[n[3].toLowerCase()]?r[n[3].toLowerCase()]:n[3].toLowerCase().charCodeAt(0):0,t.code2=n[3]?r[n[3].toLowerCase()]?r[n[3].toLowerCase()]:n[3].toUpperCase().charCodeAt(0):0}return t},a=[];jQuery.isArray(this.config.toolbar)&&(a=a.concat(this.config.toolbar)),jQuery.isArray(this.config.toolbar.left)&&(a=a.concat(this.config.toolbar.left)),jQuery.isArray(this.config.toolbar.right)&&(a=a.concat(this.config.toolbar.right));for(var s=0;s<a.length;s++)if(tools[a[s]]&&tools[a[s]].shortcut){var l=o(tools[a[s]].shortcut);if(l.ctrl==!!t&&l.shift==!!n&&l.alt==!!i&&(l.code1==e||l.code2==e))return tools[a[s]].onclick.call(this,this),!0}for(var c in this.extensions){var d=this.extensions[c];if(d&&"function"==typeof d.keypress&&d.keypress(e,t,n,i))return!0}var u=this;return setTimeout(function(){var e=u.extensions.dom.getSelectionXY().y;if(e>0){e+=jQuery(document).scrollTop();var t=u.prev(".editor-toolbar:first"),n=t.offset().top+t.outerHeight(),i=n-e;i>0&&jQuery(document).scrollTop(jQuery(document).scrollTop()-i)}},100),!1},editor.getHtml=function(e){var t=this;return!e&&t._renderedHtml?t._renderedHtml:(this.find("span.editor-movement").remove(),this._renderedHtml=t.clone().find(t.widgetmask+", "+t.widgetmaskInline).each(function(){var e=jQuery(this),t=jQuery.parseJSON(e.attr("data"));e.replaceWith('<widget data="'+(e.attr("data-widget").replace(/"/g,"&quot;")||"")+'">'+t.vid+"</widget>")}).end().html())},editor.getText=function(e){var t="";this.find("span.editor-movement").remove();var n=this,i=function(e,t){var r=jQuery(e);if(r.length>0){if(r.is(n.widgetmask)||r.is(n.widgetmaskInline))return"";for(var o=e.childNodes.length,a="",s=0;o>s;s++){var l=e.childNodes[s];switch(l.nodeType){case 1:switch(l.tagName){case"IMG":var c=jQuery(l).attr("key");c&&(a+=":"+jQuery(l).attr("key")+":");break;case"BR":n.config.removeLineBreaks||(a+="\n");break;default:a+=i(l)}break;case 3:a+=l.nodeValue;break;default:a+=i(l)}}return a}};return t=i(n.get(0),!0),t=t.replace(/<(\w+)><\/(\w+)>/g,function(e,t,n){return t==n?"<"+t+"/>":e})},editor.handleOnChange=function(e,t){var n=this;n.quickClean(),n.toggleWatermark();var i=n.getHtml(!0);if(""==i.trim()||"<br>"==i.trim().replace(/[ \/]/g,"")){var r=jQuery("<p/>");n.append(r),n.extensions.dom.makeNonEmpty(r.get(0)),t||n.setFocus(),i=n.html()}n.config.input.attr("value",n.config.escape?escape(i):i),n.highlightToolbar(),n.registerCursor(),n.find("image,blockquote,div").on("resizestart",function(e){e.originalEvent.returnValue=!1}),n.extensions.dom.msie&&n.find("blockquote").off("mousedown").on("mousedown",function(e){if(!jQuery(this).closest(n.widgetmask).length){var t=n.extensions.dom.getSelection();if(t&&t.startContainer){var i=n.extensions.dom.findNonTextNode(t.startContainer,"before");if(jQuery(this).find(i).length||jQuery(this).is(i))return}n.extensions.dom.setSelectionXY(e.clientX,e.clientY)}}).css("outline","0")},editor.handleOnPaste=function(){var e=this;if(e.config.removeLineBreaks){e.find("br").remove();var t=e.find("p:first");t.length||(t=jQuery("<p/>").prependTo(e));var n=e.find("p").not(t);t.append(n.contents()),n.remove()}e.checkLength(),e.toggleWatermark();for(var i=e.extensions.dom.getSelection(),r=e.extensions.dom.treeToVector(e.get(0).childNodes,function(e){return 1!=e.nodeType&&3!=e.nodeType}),o=0;o<r.length;o++)r[o].parentNode&&r[o].parentNode.removeChild(r[o]);var a=e.extensions.dom.treeToVector(e.get(0).childNodes,function(e){return 3==e.nodeType}),s=null,l=null;if(a.length)if(e.is(i.endContainer))l=a[a.length-1];else if(a.length)if(3==i.endContainer.nodeType)s=0==i.endOffset?i.endContainer:a[a.indexOf(i.endContainer)+1],s||(l=i.startContainer);else for(var c=i.endContainer;;){if(e.is(c)){l=a[a.length-1];break}if(3==c.nodeType){s=c;break}if(c.nextSibling)for(c=c.nextSibling;c.childNodes[0];)c=c.childNodes[0];else c=c.parentNode}e.removeUnwanted(),e.extensions.dom.flatten(e.get(0)),e.setupWidgets(),e.rescueOrphans(),e.trigger("afterpaste"),l?e.extensions.dom.setCursor(l,"after"):s?e.extensions.dom.setCursor(s,"before"):e.extensions.dom.setCursor(e.get(0),"after"),e.registerCursor()},editor.handleOnKeyDown=function(e){var t=this;if(t.keypress(e.which||e.keyCode,e.ctrlKey,e.shiftKey,e.altKey))try{e.originalEvent.preventDefault(),e.originalEvent.stopPropagation(),t.registerCursor()}catch(n){e.originalEvent.cancelBubble=!0,e.originalEvent.returnValue=!1}},editor.handleOnKeyUp=function(e){var t=this;t.registerCursor(),t.highlightToolbar()},editor.handleOnKeyPress=function(e){var t=this,n=String.fromCharCode(e.charCode);return e.charCode&&n&&n.length>0&&(t.text().trim()+n).length>t.config.maxLength?(e.preventDefault(),e.returnValue=!1,!1):void 0},editor.handleOnFocus=function(){var e=this;e.highlightToolbar(),e.registerCursor()},editor.handleOnFormSubmit=function(){var e=this;if(e.extensions.source&&e.extensions.source.leave(!1),e.removeUnwanted(),e.trigger("change",!0),e.config.localBackup){for(var t=storage.keys(),n=0;n<t.length-19;n++)storage.remove(t[n]);storage.set(e.config.input.attr("id"),e.html())}return""==e.config.input.val()?confirm("An error occurred, most likely no content will be saved. Are you sure you want to save it?"):void 0};var publ={html:function(e){var t=jQuery(this).attr("id"),n=editorInstances[t];return n.trigger("cleanup"),n.getHtml()},text:function(e){var t=jQuery(this).attr("id"),n=editorInstances[t];return n.trigger("cleanup"),n.getText()},insert:function(e){var t=jQuery(this).attr("id"),n=editorInstances[t];n.insertAtCursor(e)},reset:function(){var e=jQuery(this).attr("id"),t=editorInstances[e];this.empty();var n=jQuery("<p/>").get(0);t.extensions.dom.makeNonEmpty(n),t.append(n),t.extensions.dom.setCursor(n)},setValue:function(e,t){var n=jQuery(this).attr("id"),i=editorInstances[n];i.preventFocus=!!t,i.html(e)},isEmpty:function(){var e=this.get(0).innerHTML;return""===e||"<p><br></p>"===e||"<p></p>"===e},configuration:function(){var e=jQuery(this).attr("id"),t=editorInstances[e];return jQuery.extend(!0,{},t.config)},debug:function(){var e=jQuery.extend(this,editor);return e[arguments[0]](Array.convert(arguments).slice(1))}};jQuery.fn.editor=function(){if("string"==typeof arguments[0]&&"function"==typeof publ[arguments[0]]){var e=jQuery.extend(this,publ);return e[arguments[0]].apply(e,[].slice.call(arguments,1))}var t=arguments[0]||{};return"undefined"==typeof window.editors&&(window.editors=[]),this.each(function(){if(!jQuery(this).data("editor-initialized")){var e=init.call(jQuery(this),t),n=e.attr("id");editorInstances[n]=e,window.editors.push(e),jQuery(this).data("editor-initialized",!0)}})}}(jQuery),Emoticons={},function(){function e(){return a=[{key:"dog",title:"dog face",category:"nature",css:"emoji_dog"},{key:"wolf",title:"wolf face",category:"nature",css:"emoji_wolf"},{key:"cat",title:"cat face",category:"nature",css:"emoji_cat"},{key:"mouse",title:"mouse face",category:"nature",css:"emoji_mouse"},{key:"hamster",title:"hamster face",category:"nature",css:"emoji_hamster"},{key:"rabbit",title:"rabbit face",category:"nature",css:"emoji_rabbit"},{key:"frog",title:"frog face",category:"nature",css:"emoji_frog"},{key:"tiger",title:"tiger face",category:"nature",css:"emoji_tiger"},{key:"koala",title:"koala",category:"nature",css:"emoji_koala"},{key:"bear",title:"bear face",category:"nature",css:"emoji_bear"},{key:"pig",title:"pig face",category:"nature",css:"emoji_pig"},{key:"pig_nose",title:"pig nose",category:"nature",css:"emoji_pig_nose"},{key:"cow",title:"cow face",category:"nature",css:"emoji_cow"},{key:"boar",title:"boar",category:"nature",css:"emoji_boar"},{key:"monkey_face",title:"monkey face",category:"nature",css:"emoji_monkey_face"},{key:"monkey",title:"monkey",category:"nature",css:"emoji_monkey"},{key:"horse",title:"horse face",category:"nature",css:"emoji_horse"},{key:"sheep",title:"sheep",category:"nature",css:"emoji_sheep"},{key:"elephant",title:"elephant",category:"nature",css:"emoji_elephant"},{key:"panda_face",title:"panda face",category:"nature",css:"emoji_panda_face"},{key:"penguin",title:"penguin",category:"nature",css:"emoji_penguin"},{key:"bird",title:"bird",category:"nature",css:"emoji_bird"},{key:"baby_chick",title:"baby chick",category:"nature",css:"emoji_baby_chick"},{key:"hatched_chick",title:"front-facing baby chick",category:"nature",css:"emoji_hatched_chick"},{key:"hatching_chick",title:"hatching chick",category:"nature",css:"emoji_hatching_chick"},{key:"chicken",title:"chicken",category:"nature",css:"emoji_chicken"},{key:"snake",title:"snake",category:"nature",css:"emoji_snake"},{key:"turtle",title:"turtle",category:"nature",css:"emoji_turtle"},{key:"bug",title:"bug",category:"nature",css:"emoji_bug"},{key:"bee",title:"honeybee",category:"nature",css:"emoji_bee"},{key:"ant",title:"ant",category:"nature",css:"emoji_ant"},{key:"beetle",title:"lady beetle",category:"nature",css:"emoji_beetle"},{key:"snail",title:"snail",category:"nature",css:"emoji_snail"},{key:"octopus",title:"octopus",category:"nature",css:"emoji_octopus"},{key:"shell",title:"spiral shell",category:"nature",css:"emoji_shell"},{key:"tropical_fish",title:"tropical fish",category:"nature",css:"emoji_tropical_fish"},{key:"fish",title:"fish",category:"nature",css:"emoji_fish"},{key:"dolphin",title:"dolphin",category:"nature",css:"emoji_dolphin"},{key:"whale",title:"spouting whale",category:"nature",css:"emoji_whale"},{key:"whale2",title:"whale",category:"nature",css:"emoji_whale2"},{key:"cow2",title:"cow",category:"nature",css:"emoji_cow2"},{key:"ram",title:"ram",category:"nature",css:"emoji_ram"},{key:"rat",title:"rat",category:"nature",css:"emoji_rat"},{key:"water_buffalo",title:"water buffalo",category:"nature",css:"emoji_water_buffalo"},{key:"tiger2",title:"tiger",category:"nature",css:"emoji_tiger2"},{key:"rabbit2",title:"rabbit",category:"nature",css:"emoji_rabbit2"},{key:"dragon",title:"dragon",category:"nature",css:"emoji_dragon"},{key:"racehorse",title:"horse",category:"nature",css:"emoji_racehorse"},{key:"goat",title:"goat",category:"nature",css:"emoji_goat"},{key:"rooster",title:"rooster",category:"nature",css:"emoji_rooster"},{key:"dog2",title:"dog",category:"nature",css:"emoji_dog2"},{key:"pig2",title:"pig",category:"nature",css:"emoji_pig2"},{key:"mouse2",title:"mouse",category:"nature",css:"emoji_mouse2"},{key:"ox",title:"ox",category:"nature",css:"emoji_ox"},{key:"dragon_face",title:"dragon face",category:"nature",css:"emoji_dragon_face"},{key:"blowfish",title:"blowfish",category:"nature",css:"emoji_blowfish"},{key:"crocodile",title:"crocodile",category:"nature",css:"emoji_crocodile"},{key:"camel",title:"bactrian camel",category:"nature",css:"emoji_camel"},{key:"dromedary_camel",title:"dromedary camel",category:"nature",css:"emoji_dromedary_camel"},{key:"leopard",title:"leopard",category:"nature",css:"emoji_leopard"},{key:"cat2",title:"cat",category:"nature",css:"emoji_cat2"},{key:"poodle",title:"poodle",category:"nature",css:"emoji_poodle"
},{key:"feet",title:"paw prints",category:"nature",css:"emoji_feet"},{key:"bouquet",title:"bouquet",category:"nature",css:"emoji_bouquet"},{key:"cherry_blossom",title:"cherry blossom",category:"nature",css:"emoji_cherry_blossom"},{key:"tulip",title:"tulip",category:"nature",css:"emoji_tulip"},{key:"four_leaf_clover",title:"four leaf clover",category:"nature",css:"emoji_four_leaf_clover"},{key:"rose",title:"rose",category:"nature",css:"emoji_rose"},{key:"sunflower",title:"sunflower",category:"nature",css:"emoji_sunflower"},{key:"hibiscus",title:"hibiscus",category:"nature",css:"emoji_hibiscus"},{key:"maple_leaf",title:"maple leaf",category:"nature",css:"emoji_maple_leaf"},{key:"leaves",title:"leaf fluttering in wind",category:"nature",css:"emoji_leaves"},{key:"fallen_leaf",title:"fallen leaf",category:"nature",css:"emoji_fallen_leaf"},{key:"herb",title:"herb",category:"nature",css:"emoji_herb"},{key:"ear_of_rice",title:"ear of rice",category:"nature",css:"emoji_ear_of_rice"},{key:"mushroom",title:"mushroom",category:"nature",css:"emoji_mushroom"},{key:"cactus",title:"cactus",category:"nature",css:"emoji_cactus"},{key:"palm_tree",title:"palm tree",category:"nature",css:"emoji_palm_tree"},{key:"evergreen_tree",title:"evergreen tree",category:"nature",css:"emoji_evergreen_tree"},{key:"deciduous_tree",title:"deciduous tree",category:"nature",css:"emoji_deciduous_tree"},{key:"chestnut",title:"chestnut",category:"nature",css:"emoji_chestnut"},{key:"seedling",title:"seedling",category:"nature",css:"emoji_seedling"},{key:"blossom",title:"blossom",category:"nature",css:"emoji_blossom"},{key:"globe_with_meridians",title:"globe with meridians",category:"nature",css:"emoji_globe_with_meridians"},{key:"sun_with_face",title:"sun with face",category:"nature",css:"emoji_sun_with_face"},{key:"full_moon_with_face",title:"full moon with face",category:"nature",css:"emoji_full_moon_with_face"},{key:"new_moon_with_face",title:"new moon with face",category:"nature",css:"emoji_new_moon_with_face"},{key:"new_moon",title:"new moon symbol",category:"nature",css:"emoji_new_moon"},{key:"waxing_crescent_moon",title:"waxing crescent moon symbol",category:"nature",css:"emoji_waxing_crescent_moon"},{key:"first_quarter_moon",title:"first quarter moon symbol",category:"nature",css:"emoji_first_quarter_moon"},{key:"moon",title:"waxing gibbous moon symbol",category:"nature",css:"emoji_moon"},{key:"full_moon",title:"full moon symbol",category:"nature",css:"emoji_full_moon"},{key:"waning_gibbous_moon",title:"waning gibbous moon symbol",category:"nature",css:"emoji_waning_gibbous_moon"},{key:"last_quarter_moon",title:"last quarter moon symbol",category:"nature",css:"emoji_last_quarter_moon"},{key:"waning_crescent_moon",title:"waning crescent moon symbol",category:"nature",css:"emoji_waning_crescent_moon"},{key:"last_quarter_moon_with_face",title:"last quarter moon with face",category:"nature",css:"emoji_last_quarter_moon_with_face"},{key:"first_quarter_moon_with_face",title:"first quarter moon with face",category:"nature",css:"emoji_first_quarter_moon_with_face"},{key:"crescent_moon",title:"crescent moon",category:"nature",css:"emoji_crescent_moon"},{key:"earth_africa",title:"earth globe europe-africa",category:"nature",css:"emoji_earth_africa"},{key:"earth_americas",title:"earth globe americas",category:"nature",css:"emoji_earth_americas"},{key:"earth_asia",title:"earth globe asia-australia",category:"nature",css:"emoji_earth_asia"},{key:"volcano",title:"volcano",category:"nature",css:"emoji_volcano"},{key:"milky_way",title:"milky way",category:"nature",css:"emoji_milky_way"},{key:"stars",title:"shooting star",category:"nature",css:"emoji_stars"},{key:"star",title:"white medium star",category:"nature",css:"emoji_star"},{key:"sunny",title:"black sun with rays",category:"nature",css:"emoji_sunny"},{key:"partly_sunny",title:"sun behind cloud",category:"nature",css:"emoji_partly_sunny"},{key:"cloud",title:"cloud",category:"nature",css:"emoji_cloud"},{key:"zap",title:"high voltage sign",category:"nature",css:"emoji_zap"},{key:"umbrella",title:"umbrella with rain drops",category:"nature",css:"emoji_umbrella"},{key:"snowflake",title:"snowflake",category:"nature",css:"emoji_snowflake"},{key:"snowman",title:"snowman without snow",category:"nature",css:"emoji_snowman"},{key:"cyclone",title:"cyclone",category:"nature",css:"emoji_cyclone"},{key:"foggy",title:"foggy",category:"nature",css:"emoji_foggy"},{key:"rainbow",title:"rainbow",category:"nature",css:"emoji_rainbow"},{key:"ocean",title:"water wave",category:"nature",css:"emoji_ocean"},{key:"bamboo",title:"pine decoration",category:"objects",css:"emoji_bamboo"},{key:"gift_heart",title:"heart with ribbon",category:"objects",css:"emoji_gift_heart"},{key:"dolls",title:"japanese dolls",category:"objects",css:"emoji_dolls"},{key:"school_satchel",title:"school satchel",category:"objects",css:"emoji_school_satchel"},{key:"mortar_board",title:"graduation cap",category:"objects",css:"emoji_mortar_board"},{key:"flags",title:"carp streamer",category:"objects",css:"emoji_flags"},{key:"fireworks",title:"fireworks",category:"objects",css:"emoji_fireworks"},{key:"sparkler",title:"firework sparkler",category:"objects",css:"emoji_sparkler"},{key:"wind_chime",title:"wind chime",category:"objects",css:"emoji_wind_chime"},{key:"rice_scene",title:"moon viewing ceremony",category:"objects",css:"emoji_rice_scene"},{key:"jack_o_lantern",title:"jack-o-lantern",category:"objects",css:"emoji_jack_o_lantern"},{key:"ghost",title:"ghost",category:"objects",css:"emoji_ghost"},{key:"santa",title:"father christmas",category:"objects",css:"emoji_santa"},{key:"christmas_tree",title:"christmas tree",category:"objects",css:"emoji_christmas_tree"},{key:"gift",title:"wrapped present",category:"objects",css:"emoji_gift"},{key:"tanabata_tree",title:"tanabata tree",category:"objects",css:"emoji_tanabata_tree"},{key:"tada",title:"party popper",category:"objects",css:"emoji_tada"},{key:"confetti_ball",title:"confetti ball",category:"objects",css:"emoji_confetti_ball"},{key:"balloon",title:"balloon",category:"objects",css:"emoji_balloon"},{key:"crossed_flags",title:"crossed flags",category:"objects",css:"emoji_crossed_flags"},{key:"crystal_ball",title:"crystal ball",category:"objects",css:"emoji_crystal_ball"},{key:"movie_camera",title:"movie camera",category:"objects",css:"emoji_movie_camera"},{key:"camera",title:"camera",category:"objects",css:"emoji_camera"},{key:"video_camera",title:"video camera",category:"objects",css:"emoji_video_camera"},{key:"vhs",title:"videocassette",category:"objects",css:"emoji_vhs"},{key:"cd",title:"optical disc",category:"objects",css:"emoji_cd"},{key:"dvd",title:"dvd",category:"objects",css:"emoji_dvd"},{key:"minidisc",title:"minidisc",category:"objects",css:"emoji_minidisc"},{key:"floppy_disk",title:"floppy disk",category:"objects",css:"emoji_floppy_disk"},{key:"computer",title:"personal computer",category:"objects",css:"emoji_computer"},{key:"iphone",title:"mobile phone",category:"objects",css:"emoji_iphone"},{key:"phone",title:"black telephone",category:"objects",css:"emoji_phone"},{key:"telephone_receiver",title:"telephone receiver",category:"objects",css:"emoji_telephone_receiver"},{key:"pager",title:"pager",category:"objects",css:"emoji_pager"},{key:"fax",title:"fax machine",category:"objects",css:"emoji_fax"},{key:"satellite",title:"satellite antenna",category:"objects",css:"emoji_satellite"},{key:"tv",title:"television",category:"objects",css:"emoji_tv"},{key:"radio",title:"radio",category:"objects",css:"emoji_radio"},{key:"loud_sound",title:"speaker with three sound waves",category:"objects",css:"emoji_loud_sound"},{key:"sound",title:"speaker with one sound wave",category:"objects",css:"emoji_sound"},{key:"speaker",title:"speaker",category:"objects",css:"emoji_speaker"},{key:"mute",title:"speaker with cancellation stroke",category:"objects",css:"emoji_mute"},{key:"bell",title:"bell",category:"objects",css:"emoji_bell"},{key:"no_bell",title:"bell with cancellation stroke",category:"objects",css:"emoji_no_bell"},{key:"loudspeaker",title:"public address loudspeaker",category:"objects",css:"emoji_loudspeaker"},{key:"mega",title:"cheering megaphone",category:"objects",css:"emoji_mega"},{key:"hourglass",title:"hourglass",category:"objects",css:"emoji_hourglass"},{key:"alarm_clock",title:"alarm clock",category:"objects",css:"emoji_alarm_clock"},{key:"hourglass_flowing_sand",title:"hourglass with flowing sand",category:"objects",css:"emoji_hourglass_flowing_sand"},{key:"watch",title:"watch",category:"objects",css:"emoji_watch"},{key:"unlock",title:"open lock",category:"objects",css:"emoji_unlock"},{key:"lock",title:"lock",category:"objects",css:"emoji_lock"},{key:"lock_with_ink_pen",title:"lock with ink pen",category:"objects",css:"emoji_lock_with_ink_pen"},{key:"closed_lock_with_key",title:"closed lock with key",category:"objects",css:"emoji_closed_lock_with_key"},{key:"key",title:"key",category:"objects",css:"emoji_key"},{key:"mag_right",title:"right-pointing magnifying glass",category:"objects",css:"emoji_mag_right"},{key:"bulb",title:"electric light bulb",category:"objects",css:"emoji_bulb"},{key:"flashlight",title:"electric torch",category:"objects",css:"emoji_flashlight"},{key:"high_brightness",title:"high brightness symbol",category:"objects",css:"emoji_high_brightness"},{key:"low_brightness",title:"low brightness symbol",category:"objects",css:"emoji_low_brightness"},{key:"electric_plug",title:"electric plug",category:"objects",css:"emoji_electric_plug"},{key:"battery",title:"battery",category:"objects",css:"emoji_battery"},{key:"mag",title:"left-pointing magnifying glass",category:"objects",css:"emoji_mag"},{key:"bath",title:"bath",category:"objects",css:"emoji_bath"},{key:"bathtub",title:"bathtub",category:"objects",css:"emoji_bathtub"},{key:"shower",title:"shower",category:"objects",css:"emoji_shower"},{key:"toilet",title:"toilet",category:"objects",css:"emoji_toilet"},{key:"wrench",title:"wrench",category:"objects",css:"emoji_wrench"},{key:"nut_and_bolt",title:"nut and bolt",category:"objects",css:"emoji_nut_and_bolt"},{key:"hammer",title:"hammer",category:"objects",css:"emoji_hammer"},{key:"door",title:"door",category:"objects",css:"emoji_door"},{key:"smoking",title:"smoking symbol",category:"objects",css:"emoji_smoking"},{key:"bomb",title:"bomb",category:"objects",css:"emoji_bomb"},{key:"gun",title:"pistol",category:"objects",css:"emoji_gun"},{key:"hocho",title:"hocho",category:"objects",css:"emoji_hocho"},{key:"pill",title:"pill",category:"objects",css:"emoji_pill"},{key:"syringe",title:"syringe",category:"objects",css:"emoji_syringe"},{key:"moneybag",title:"money bag",category:"objects",css:"emoji_moneybag"},{key:"yen",title:"banknote with yen sign",category:"objects",css:"emoji_yen"},{key:"dollar",title:"banknote with dollar sign",category:"objects",css:"emoji_dollar"},{key:"pound",title:"banknote with pound sign",category:"objects",css:"emoji_pound"},{key:"euro",title:"banknote with euro sign",category:"objects",css:"emoji_euro"},{key:"credit_card",title:"credit card",category:"objects",css:"emoji_credit_card"},{key:"money_with_wings",title:"money with wings",category:"objects",css:"emoji_money_with_wings"},{key:"calling",title:"mobile phone with rightwards arrow at left",category:"objects",css:"emoji_calling"},{key:"e-mail",title:"e-mail symbol",category:"objects",css:"emoji_e-mail"},{key:"outbox_tray",title:"outbox tray",category:"objects",css:"emoji_outbox_tray"},{key:"inbox_tray",title:"inbox tray",category:"objects",css:"emoji_inbox_tray"},{key:"email",title:"envelope",category:"objects",css:"emoji_email"},{key:"envelope_with_arrow",title:"envelope with downwards arrow above",category:"objects",css:"emoji_envelope_with_arrow"},{key:"incoming_envelope",title:"incoming envelope",category:"objects",css:"emoji_incoming_envelope"},{key:"postal_horn",title:"postal horn",category:"objects",css:"emoji_postal_horn"},{key:"mailbox",title:"closed mailbox with raised flag",category:"objects",css:"emoji_mailbox"},{key:"mailbox_closed",title:"closed mailbox with lowered flag",category:"objects",css:"emoji_mailbox_closed"},{key:"mailbox_with_mail",title:"open mailbox with raised flag",category:"objects",css:"emoji_mailbox_with_mail"},{key:"mailbox_with_no_mail",title:"open mailbox with lowered flag",category:"objects",css:"emoji_mailbox_with_no_mail"},{key:"postbox",title:"postbox",category:"objects",css:"emoji_postbox"},{key:"package",title:"package",category:"objects",css:"emoji_package"},{key:"memo",title:"memo",category:"objects",css:"emoji_memo"},{key:"page_facing_up",title:"page facing up",category:"objects",css:"emoji_page_facing_up"},{key:"page_with_curl",title:"page with curl",category:"objects",css:"emoji_page_with_curl"},{key:"bookmark_tabs",title:"bookmark tabs",category:"objects",css:"emoji_bookmark_tabs"},{key:"bar_chart",title:"bar chart",category:"objects",css:"emoji_bar_chart"},{key:"chart_with_upwards_trend",title:"chart with upwards trend",category:"objects",css:"emoji_chart_with_upwards_trend"},{key:"chart_with_downwards_trend",title:"chart with downwards trend",category:"objects",css:"emoji_chart_with_downwards_trend"},{key:"scroll",title:"scroll",category:"objects",css:"emoji_scroll"},{key:"clipboard",title:"clipboard",category:"objects",css:"emoji_clipboard"},{key:"date",title:"calendar",category:"objects",css:"emoji_date"},{key:"calendar",title:"tear-off calendar",category:"objects",css:"emoji_calendar"},{key:"card_index",title:"card index",category:"objects",css:"emoji_card_index"},{key:"file_folder",title:"file folder",category:"objects",css:"emoji_file_folder"},{key:"open_file_folder",title:"open file folder",category:"objects",css:"emoji_open_file_folder"},{key:"scissors",title:"black scissors",category:"objects",css:"emoji_scissors"},{key:"pushpin",title:"pushpin",category:"objects",css:"emoji_pushpin"},{key:"paperclip",title:"paperclip",category:"objects",css:"emoji_paperclip"},{key:"black_nib",title:"black nib",category:"objects",css:"emoji_black_nib"},{key:"pencil2",title:"pencil",category:"objects",css:"emoji_pencil2"},{key:"straight_ruler",title:"straight ruler",category:"objects",css:"emoji_straight_ruler"},{key:"triangular_ruler",title:"triangular ruler",category:"objects",css:"emoji_triangular_ruler"},{key:"closed_book",title:"closed book",category:"objects",css:"emoji_closed_book"},{key:"green_book",title:"green book",category:"objects",css:"emoji_green_book"},{key:"blue_book",title:"blue book",category:"objects",css:"emoji_blue_book"},{key:"orange_book",title:"orange book",category:"objects",css:"emoji_orange_book"},{key:"notebook",title:"notebook",category:"objects",css:"emoji_notebook"},{key:"notebook_with_decorative_cover",title:"notebook with decorative cover",category:"objects",css:"emoji_notebook_with_decorative_cover"},{key:"ledger",title:"ledger",category:"objects",css:"emoji_ledger"},{key:"books",title:"books",category:"objects",css:"emoji_books"},{key:"book",title:"open book",category:"objects",css:"emoji_book"},{key:"tomato",title:"tomato",category:"objects",css:"emoji_tomato"},{key:"bookmark",title:"bookmark",category:"objects",css:"emoji_bookmark"},{key:"name_badge",title:"name badge",category:"objects",css:"emoji_name_badge"},{key:"microscope",title:"microscope",category:"objects",css:"emoji_microscope"},{key:"telescope",title:"telescope",category:"objects",css:"emoji_telescope"},{key:"newspaper",title:"newspaper",category:"objects",css:"emoji_newspaper"},{key:"art",title:"artist palette",category:"objects",css:"emoji_art"},{key:"clapper",title:"clapper board",category:"objects",css:"emoji_clapper"},{key:"microphone",title:"microphone",category:"objects",css:"emoji_microphone"},{key:"headphones",title:"headphone",category:"objects",css:"emoji_headphones"},{key:"musical_score",title:"musical score",category:"objects",css:"emoji_musical_score"},{key:"musical_note",title:"musical note",category:"objects",css:"emoji_musical_note"},{key:"notes",title:"multiple musical notes",category:"objects",css:"emoji_notes"},{key:"musical_keyboard",title:"musical keyboard",category:"objects",css:"emoji_musical_keyboard"},{key:"violin",title:"violin",category:"objects",css:"emoji_violin"},{key:"trumpet",title:"trumpet",category:"objects",css:"emoji_trumpet"},{key:"saxophone",title:"saxophone",category:"objects",css:"emoji_saxophone"},{key:"guitar",title:"guitar",category:"objects",css:"emoji_guitar"},{key:"space_invader",title:"alien monster",category:"objects",css:"emoji_space_invader"},{key:"video_game",title:"video game",category:"objects",css:"emoji_video_game"},{key:"black_joker",title:"playing card black joker",category:"objects",css:"emoji_black_joker"},{key:"flower_playing_cards",title:"flower playing cards",category:"objects",css:"emoji_flower_playing_cards"},{key:"mahjong",title:"mahjong tile red dragon",category:"objects",css:"emoji_mahjong"},{key:"game_die",title:"game die",category:"objects",css:"emoji_game_die"},{key:"dart",title:"direct hit",category:"objects",css:"emoji_dart"},{key:"football",title:"american football",category:"objects",css:"emoji_football"},{key:"basketball",title:"basketball and hoop",category:"objects",css:"emoji_basketball"},{key:"soccer",title:"soccer ball",category:"objects",css:"emoji_soccer"},{key:"baseball",title:"baseball",category:"objects",css:"emoji_baseball"},{key:"tennis",title:"tennis racquet and ball",category:"objects",css:"emoji_tennis"},{key:"8ball",title:"billiards",category:"objects",css:"emoji_8ball"},{key:"rugby_football",title:"rugby football",category:"objects",css:"emoji_rugby_football"},{key:"bowling",title:"bowling",category:"objects",css:"emoji_bowling"},{key:"golf",title:"flag in hole",category:"objects",css:"emoji_golf"},{key:"mountain_bicyclist",title:"mountain bicyclist",category:"objects",css:"emoji_mountain_bicyclist"},{key:"bicyclist",title:"bicyclist",category:"objects",css:"emoji_bicyclist"},{key:"checkered_flag",title:"chequered flag",category:"objects",css:"emoji_checkered_flag"},{key:"horse_racing",title:"horse racing",category:"objects",css:"emoji_horse_racing"},{key:"trophy",title:"trophy",category:"objects",css:"emoji_trophy"},{key:"ski",title:"ski and ski boot",category:"objects",css:"emoji_ski"},{key:"snowboarder",title:"snowboarder",category:"objects",css:"emoji_snowboarder"},{key:"swimmer",title:"swimmer",category:"objects",css:"emoji_swimmer"},{key:"surfer",title:"surfer",category:"objects",css:"emoji_surfer"},{key:"fishing_pole_and_fish",title:"fishing pole and fish",category:"objects",css:"emoji_fishing_pole_and_fish"},{key:"coffee",title:"hot beverage",category:"objects",css:"emoji_coffee"},{key:"tea",title:"teacup without handle",category:"objects",css:"emoji_tea"},{key:"sake",title:"sake bottle and cup",category:"objects",css:"emoji_sake"},{key:"baby_bottle",title:"baby bottle",category:"objects",css:"emoji_baby_bottle"},{key:"beer",title:"beer mug",category:"objects",css:"emoji_beer"},{key:"beers",title:"clinking beer mugs",category:"objects",css:"emoji_beers"},{key:"cocktail",title:"cocktail glass",category:"objects",css:"emoji_cocktail"},{key:"tropical_drink",title:"tropical drink",category:"objects",css:"emoji_tropical_drink"},{key:"wine_glass",title:"wine glass",category:"objects",css:"emoji_wine_glass"},{key:"fork_and_knife",title:"fork and knife",category:"objects",css:"emoji_fork_and_knife"},{key:"pizza",title:"slice of pizza",category:"objects",css:"emoji_pizza"},{key:"hamburger",title:"hamburger",category:"objects",css:"emoji_hamburger"},{key:"fries",title:"french fries",category:"objects",css:"emoji_fries"},{key:"poultry_leg",title:"poultry leg",category:"objects",css:"emoji_poultry_leg"},{key:"meat_on_bone",title:"meat on bone",category:"objects",css:"emoji_meat_on_bone"},{key:"spaghetti",title:"spaghetti",category:"objects",css:"emoji_spaghetti"},{key:"curry",title:"curry and rice",category:"objects",css:"emoji_curry"},{key:"fried_shrimp",title:"fried shrimp",category:"objects",css:"emoji_fried_shrimp"},{key:"bento",title:"bento box",category:"objects",css:"emoji_bento"},{key:"sushi",title:"sushi",category:"objects",css:"emoji_sushi"},{key:"fish_cake",title:"fish cake with swirl design",category:"objects",css:"emoji_fish_cake"},{key:"rice_ball",title:"rice ball",category:"objects",css:"emoji_rice_ball"},{key:"rice_cracker",title:"rice cracker",category:"objects",css:"emoji_rice_cracker"},{key:"rice",title:"cooked rice",category:"objects",css:"emoji_rice"},{key:"ramen",title:"steaming bowl",category:"objects",css:"emoji_ramen"},{key:"stew",title:"pot of food",category:"objects",css:"emoji_stew"},{key:"oden",title:"oden",category:"objects",css:"emoji_oden"},{key:"dango",title:"dango",category:"objects",css:"emoji_dango"},{key:"egg",title:"cooking",category:"objects",css:"emoji_egg"},{key:"bread",title:"bread",category:"objects",css:"emoji_bread"},{key:"doughnut",title:"doughnut",category:"objects",css:"emoji_doughnut"},{key:"custard",title:"custard",category:"objects",css:"emoji_custard"},{key:"icecream",title:"soft ice cream",category:"objects",css:"emoji_icecream"},{key:"ice_cream",title:"ice cream",category:"objects",css:"emoji_ice_cream"},{key:"shaved_ice",title:"shaved ice",category:"objects",css:"emoji_shaved_ice"},{key:"birthday",title:"birthday cake",category:"objects",css:"emoji_birthday"},{key:"cake",title:"shortcake",category:"objects",css:"emoji_cake"},{key:"cookie",title:"cookie",category:"objects",css:"emoji_cookie"},{key:"chocolate_bar",title:"chocolate bar",category:"objects",css:"emoji_chocolate_bar"},{key:"candy",title:"candy",category:"objects",css:"emoji_candy"},{key:"lollipop",title:"lollipop",category:"objects",css:"emoji_lollipop"},{key:"honey_pot",title:"honey pot",category:"objects",css:"emoji_honey_pot"},{key:"apple",title:"red apple",category:"objects",css:"emoji_apple"},{key:"green_apple",title:"green apple",category:"objects",css:"emoji_green_apple"},{key:"tangerine",title:"tangerine",category:"objects",css:"emoji_tangerine"},{key:"lemon",title:"lemon",category:"objects",css:"emoji_lemon"},{key:"cherries",title:"cherries",category:"objects",css:"emoji_cherries"},{key:"grapes",title:"grapes",category:"objects",css:"emoji_grapes"},{key:"watermelon",title:"watermelon",category:"objects",css:"emoji_watermelon"},{key:"strawberry",title:"strawberry",category:"objects",css:"emoji_strawberry"},{key:"peach",title:"peach",category:"objects",css:"emoji_peach"},{key:"melon",title:"melon",category:"objects",css:"emoji_melon"},{key:"banana",title:"banana",category:"objects",css:"emoji_banana"},{key:"pear",title:"pear",category:"objects",css:"emoji_pear"},{key:"pineapple",title:"pineapple",category:"objects",css:"emoji_pineapple"},{key:"sweet_potato",title:"roasted sweet potato",category:"objects",css:"emoji_sweet_potato"},{key:"eggplant",title:"aubergine",category:"objects",css:"emoji_eggplant"},{key:"corn",title:"ear of maize",category:"objects",css:"emoji_corn"},{key:"smile",title:"smiling face with open mouth and smiling eyes",category:"people",css:"emoji_smile",ascii:[":)",":-)"]},{key:"smiley",title:"smiling face with open mouth",category:"people",css:"emoji_smiley"},{key:"grinning",title:"grinning face",category:"people",css:"emoji_grinning",ascii:[":D"]},{key:"blush",title:"smiling face with smiling eyes",category:"people",css:"emoji_blush"},{key:"relaxed",title:"white smiling face",category:"people",css:"emoji_relaxed"},{key:"wink",title:"winking face",category:"people",css:"emoji_wink",ascii:[";)",";-)"]},{key:"heart_eyes",title:"smiling face with heart-shaped eyes",category:"people",css:"emoji_heart_eyes"},{key:"kissing_heart",title:"face throwing a kiss",category:"people",css:"emoji_kissing_heart"},{key:"kissing_closed_eyes",title:"kissing face with closed eyes",category:"people",css:"emoji_kissing_closed_eyes"},{key:"kissing",title:"kissing face",category:"people",css:"emoji_kissing"},{key:"kissing_smiling_eyes",title:"kissing face with smiling eyes",category:"people",css:"emoji_kissing_smiling_eyes"},{key:"stuck_out_tongue_winking_eye",title:"face with stuck-out tongue and winking eye",category:"people",css:"emoji_stuck_out_tongue_winking_eye"},{key:"stuck_out_tongue_closed_eyes",title:"face with stuck-out tongue and tightly-closed eyes",category:"people",css:"emoji_stuck_out_tongue_closed_eyes"},{key:"stuck_out_tongue",title:"face with stuck-out tongue",category:"people",css:"emoji_stuck_out_tongue",ascii:[":p",":-p",":P",":-P"]},{key:"flushed",title:"flushed face",category:"people",css:"emoji_flushed"},{key:"grin",title:"grinning face with smiling eyes",category:"people",css:"emoji_grin"},{key:"pensive",title:"pensive face",category:"people",css:"emoji_pensive"},{key:"relieved",title:"relieved face",category:"people",css:"emoji_relieved"},{key:"unamused",title:"unamused face",category:"people",css:"emoji_unamused"},{key:"disappointed",title:"disappointed face",category:"people",css:"emoji_disappointed",ascii:[":(",":-("]},{key:"persevere",title:"persevering face",category:"people",css:"emoji_persevere"},{key:"cry",title:"crying face",category:"people",css:"emoji_cry",ascii:[":'("]},{key:"joy",title:"face with tears of joy",category:"people",css:"emoji_joy"},{key:"sob",title:"loudly crying face",category:"people",css:"emoji_p1"},{key:"sleepy",title:"sleepy face",category:"people",css:"emoji_m1"},{key:"disappointed_relieved",title:"disappointed but relieved face",category:"people",css:"emoji_disappointed_relieved"},{key:"cold_sweat",title:"face with open mouth and cold sweat",category:"people",css:"emoji_cold_sweat"},{key:"sweat_smile",title:"smiling face with open mouth and cold sweat",category:"people",css:"emoji_sweat_smile"},{key:"sweat",title:"face with cold sweat",category:"people",css:"emoji_sweat"},{key:"weary",title:"weary face",category:"people",css:"emoji_weary"},{key:"tired_face",title:"tired face",category:"people",css:"emoji_tired_face"},{key:"fearful",title:"fearful face",category:"people",css:"emoji_fearful"},{key:"scream",title:"face screaming in fear",category:"people",css:"emoji_scream"},{key:"angry",title:"angry face",category:"people",css:"emoji_angry"},{key:"rage",title:"pouting face",category:"people",css:"emoji_rage"},{key:"triumph",title:"face with look of triumph",category:"people",css:"emoji_triumph"},{key:"confounded",title:"confounded face",category:"people",css:"emoji_confounded"},{key:"laughing",title:"smiling face with open mouth and tightly-closed eyes",category:"people",css:"emoji_laughing"},{key:"yum",title:"face savouring delicious food",category:"people",css:"emoji_yum"},{key:"mask",title:"face with medical mask",category:"people",css:"emoji_mask"},{key:"sunglasses",title:"smiling face with sunglasses",category:"people",css:"emoji_sunglasses"},{key:"sleeping",title:"sleeping face",category:"people",css:"emoji_sleeping"},{key:"dizzy_face",title:"dizzy face",category:"people",css:"emoji_dizzy_face"},{key:"astonished",title:"astonished face",category:"people",css:"emoji_astonished"},{key:"worried",title:"worried face",category:"people",css:"emoji_worried"},{key:"frowning",title:"frowning face with open mouth",category:"people",css:"emoji_frowning"},{key:"smiling_imp",title:"smiling face with horns",category:"people",css:"emoji_smiling_imp"},{key:"anguished",title:"anguished face",category:"people",css:"emoji_anguished"},{key:"imp",title:"imp",category:"people",css:"emoji_imp"},{key:"open_mouth",title:"face with open mouth",category:"people",css:"emoji_open_mouth"},{key:"grimacing",title:"grimacing face",category:"people",css:"emoji_grimacing"},{key:"neutral_face",title:"neutral face",category:"people",css:"emoji_neutral_face"},{key:"confused",title:"confused face",category:"people",css:"emoji_confused"},{key:"hushed",title:"hushed face",category:"people",css:"emoji_hushed"},{key:"no_mouth",title:"face without mouth",category:"people",css:"emoji_no_mouth"},{key:"innocent",title:"smiling face with halo",category:"people",css:"emoji_innocent"},{key:"smirk",title:"smirking face",category:"people",css:"emoji_smirk"},{key:"expressionless",title:"expressionless face",category:"people",css:"emoji_expressionless"},{key:"man_with_gua_pi_mao",title:"man with gua pi mao",category:"people",css:"emoji_man_with_gua_pi_mao"},{key:"man_with_turban",title:"man with turban",category:"people",css:"emoji_man_with_turban"},{key:"cop",title:"police officer",category:"people",css:"emoji_cop"},{key:"construction_worker",title:"construction worker",category:"people",css:"emoji_construction_worker"},{key:"guardsman",title:"guardsman",category:"people",css:"emoji_guardsman"},{key:"baby",title:"baby",category:"people",css:"emoji_baby"},{key:"boy",title:"boy",category:"people",css:"emoji_boy"},{key:"girl",title:"girl",category:"people",css:"emoji_girl"},{key:"man",title:"man",category:"people",css:"emoji_man"},{key:"woman",title:"woman",category:"people",css:"emoji_woman"},{key:"older_man",title:"older man",category:"people",css:"emoji_older_man"},{key:"older_woman",title:"older woman",category:"people",css:"emoji_older_woman"},{key:"person_with_blond_hair",title:"person with blond hair",category:"people",css:"emoji_person_with_blond_hair"},{key:"angel",title:"baby angel",category:"people",css:"emoji_angel"},{key:"princess",title:"princess",category:"people",css:"emoji_princess"},{key:"smiley_cat",title:"smiling cat face with open mouth",category:"people",css:"emoji_smiley_cat"},{key:"smile_cat",title:"grinning cat face with smiling eyes",category:"people",css:"emoji_smile_cat"},{key:"heart_eyes_cat",title:"smiling cat face with heart-shaped eyes",category:"people",css:"emoji_heart_eyes_cat"},{key:"kissing_cat",title:"kissing cat face with closed eyes",category:"people",css:"emoji_kissing_cat"},{key:"smirk_cat",title:"cat face with wry smile",category:"people",css:"emoji_smirk_cat"},{key:"scream_cat",title:"weary cat face",category:"people",css:"emoji_scream_cat"},{key:"crying_cat_face",title:"crying cat face",category:"people",css:"emoji_crying_cat_face"},{key:"joy_cat",title:"cat face with tears of joy",category:"people",css:"emoji_joy_cat"},{key:"pouting_cat",title:"pouting cat face",category:"people",css:"emoji_pouting_cat"},{key:"japanese_ogre",title:"japanese ogre",category:"people",css:"emoji_japanese_ogre"},{key:"japanese_goblin",title:"japanese goblin",category:"people",css:"emoji_japanese_goblin"},{key:"see_no_evil",title:"see-no-evil monkey",category:"people",css:"emoji_see_no_evil"},{key:"hear_no_evil",title:"hear-no-evil monkey",category:"people",css:"emoji_hear_no_evil"},{key:"speak_no_evil",title:"speak-no-evil monkey",category:"people",css:"emoji_speak_no_evil"},{key:"skull",title:"skull",category:"people",css:"emoji_skull"},{key:"alien",title:"extraterrestrial alien",category:"people",css:"emoji_alien"},{key:"hankey",title:"pile of poo",category:"people",css:"emoji_hankey"},{key:"fire",title:"fire",category:"people",css:"emoji_fire"},{key:"sparkles",title:"sparkles",category:"people",css:"emoji_sparkles"},{key:"star2",title:"glowing star",category:"people",css:"emoji_star2"},{key:"dizzy",title:"dizzy symbol",category:"people",css:"emoji_dizzy"},{key:"boom",title:"collision symbol",category:"people",css:"emoji_boom"},{key:"anger",title:"anger symbol",category:"people",css:"emoji_anger"},{key:"sweat_drops",title:"splashing sweat symbol",category:"people",css:"emoji_sweat_drops"},{key:"droplet",title:"droplet",category:"people",css:"emoji_droplet"},{key:"zzz",title:"sleeping symbol",category:"people",css:"emoji_zzz"},{key:"dash",title:"dash symbol",category:"people",css:"emoji_dash"},{key:"ear",title:"ear",category:"people",css:"emoji_ear"},{key:"eyes",title:"eyes",category:"people",css:"emoji_eyes"},{key:"nose",title:"nose",category:"people",css:"emoji_nose"},{key:"tongue",title:"tongue",category:"people",css:"emoji_tongue"},{key:"lips",title:"mouth",category:"people",css:"emoji_lips"},{key:"+1",title:"thumbs up sign",category:"people",css:"emoji_p1"},{key:"-1",title:"thumbs down sign",category:"people",
css:"emoji_m1"},{key:"ok_hand",title:"ok hand sign",category:"people",css:"emoji_ok_hand"},{key:"facepunch",title:"fisted hand sign",category:"people",css:"emoji_facepunch"},{key:"fist",title:"raised fist",category:"people",css:"emoji_fist"},{key:"v",title:"victory hand",category:"people",css:"emoji_v"},{key:"wave",title:"waving hand sign",category:"people",css:"emoji_wave"},{key:"hand",title:"raised hand",category:"people",css:"emoji_hand"},{key:"open_hands",title:"open hands sign",category:"people",css:"emoji_open_hands"},{key:"point_up_2",title:"white up pointing backhand index",category:"people",css:"emoji_point_up_2"},{key:"point_down",title:"white down pointing backhand index",category:"people",css:"emoji_point_down"},{key:"point_right",title:"white right pointing backhand index",category:"people",css:"emoji_point_right"},{key:"point_left",title:"white left pointing backhand index",category:"people",css:"emoji_point_left"},{key:"raised_hands",title:"person raising both hands in celebration",category:"people",css:"emoji_raised_hands"},{key:"pray",title:"person with folded hands",category:"people",css:"emoji_pray"},{key:"point_up",title:"white up pointing index",category:"people",css:"emoji_point_up"},{key:"clap",title:"clapping hands sign",category:"people",css:"emoji_clap"},{key:"muscle",title:"flexed biceps",category:"people",css:"emoji_muscle"},{key:"walking",title:"pedestrian",category:"people",css:"emoji_walking"},{key:"runner",title:"runner",category:"people",css:"emoji_runner"},{key:"dancer",title:"dancer",category:"people",css:"emoji_dancer"},{key:"couple",title:"man and woman holding hands",category:"people",css:"emoji_couple"},{key:"family",title:"family",category:"people",css:"emoji_family"},{key:"two_men_holding_hands",title:"two men holding hands",category:"people",css:"emoji_two_men_holding_hands"},{key:"two_women_holding_hands",title:"two women holding hands",category:"people",css:"emoji_two_women_holding_hands"},{key:"couplekiss",title:"kiss",category:"people",css:"emoji_couplekiss"},{key:"couple_with_heart",title:"couple with heart",category:"people",css:"emoji_couple_with_heart"},{key:"dancers",title:"woman with bunny ears",category:"people",css:"emoji_dancers"},{key:"ok_woman",title:"face with ok gesture",category:"people",css:"emoji_ok_woman"},{key:"no_good",title:"face with no good gesture",category:"people",css:"emoji_no_good"},{key:"information_desk_person",title:"information desk person",category:"people",css:"emoji_information_desk_person"},{key:"raising_hand",title:"happy person raising one hand",category:"people",css:"emoji_raising_hand"},{key:"massage",title:"face massage",category:"people",css:"emoji_massage"},{key:"haircut",title:"haircut",category:"people",css:"emoji_haircut"},{key:"nail_care",title:"nail polish",category:"people",css:"emoji_nail_care"},{key:"bride_with_veil",title:"bride with veil",category:"people",css:"emoji_bride_with_veil"},{key:"person_with_pouting_face",title:"person with pouting face",category:"people",css:"emoji_person_with_pouting_face"},{key:"person_frowning",title:"person frowning",category:"people",css:"emoji_person_frowning"},{key:"bow",title:"person bowing deeply",category:"people",css:"emoji_bow"},{key:"tophat",title:"top hat",category:"people",css:"emoji_tophat"},{key:"crown",title:"crown",category:"people",css:"emoji_crown"},{key:"womans_hat",title:"womans hat",category:"people",css:"emoji_womans_hat"},{key:"athletic_shoe",title:"athletic shoe",category:"people",css:"emoji_athletic_shoe"},{key:"mans_shoe",title:"mans shoe",category:"people",css:"emoji_mans_shoe"},{key:"sandal",title:"womans sandal",category:"people",css:"emoji_sandal"},{key:"high_heel",title:"high-heeled shoe",category:"people",css:"emoji_high_heel"},{key:"boot",title:"womans boots",category:"people",css:"emoji_boot"},{key:"shirt",title:"t-shirt",category:"people",css:"emoji_shirt"},{key:"necktie",title:"necktie",category:"people",css:"emoji_necktie"},{key:"womans_clothes",title:"womans clothes",category:"people",css:"emoji_womans_clothes"},{key:"dress",title:"dress",category:"people",css:"emoji_dress"},{key:"running_shirt_with_sash",title:"running shirt with sash",category:"people",css:"emoji_running_shirt_with_sash"},{key:"jeans",title:"jeans",category:"people",css:"emoji_jeans"},{key:"kimono",title:"kimono",category:"people",css:"emoji_kimono"},{key:"bikini",title:"bikini",category:"people",css:"emoji_bikini"},{key:"briefcase",title:"briefcase",category:"people",css:"emoji_briefcase"},{key:"handbag",title:"handbag",category:"people",css:"emoji_handbag"},{key:"pouch",title:"pouch",category:"people",css:"emoji_pouch"},{key:"purse",title:"purse",category:"people",css:"emoji_purse"},{key:"eyeglasses",title:"eyeglasses",category:"people",css:"emoji_eyeglasses"},{key:"ribbon",title:"ribbon",category:"people",css:"emoji_ribbon"},{key:"closed_umbrella",title:"closed umbrella",category:"people",css:"emoji_closed_umbrella"},{key:"lipstick",title:"lipstick",category:"people",css:"emoji_lipstick"},{key:"yellow_heart",title:"yellow heart",category:"people",css:"emoji_yellow_heart"},{key:"blue_heart",title:"blue heart",category:"people",css:"emoji_blue_heart"},{key:"purple_heart",title:"purple heart",category:"people",css:"emoji_purple_heart"},{key:"green_heart",title:"green heart",category:"people",css:"emoji_green_heart"},{key:"heart",title:"heavy black heart",category:"people",css:"emoji_heart"},{key:"broken_heart",title:"broken heart",category:"people",css:"emoji_broken_heart"},{key:"heartpulse",title:"growing heart",category:"people",css:"emoji_heartpulse"},{key:"heartbeat",title:"beating heart",category:"people",css:"emoji_heartbeat"},{key:"two_hearts",title:"two hearts",category:"people",css:"emoji_two_hearts"},{key:"sparkling_heart",title:"sparkling heart",category:"people",css:"emoji_sparkling_heart"},{key:"revolving_hearts",title:"revolving hearts",category:"people",css:"emoji_revolving_hearts"},{key:"cupid",title:"heart with arrow",category:"people",css:"emoji_cupid"},{key:"love_letter",title:"love letter",category:"people",css:"emoji_love_letter"},{key:"kiss",title:"kiss mark",category:"people",css:"emoji_kiss"},{key:"ring",title:"ring",category:"people",css:"emoji_ring"},{key:"gem",title:"gem stone",category:"people",css:"emoji_gem"},{key:"bust_in_silhouette",title:"bust in silhouette",category:"people",css:"emoji_bust_in_silhouette"},{key:"busts_in_silhouette",title:"busts in silhouette",category:"people",css:"emoji_busts_in_silhouette"},{key:"speech_balloon",title:"speech balloon",category:"people",css:"emoji_speech_balloon"},{key:"footprints",title:"footprints",category:"people",css:"emoji_footprints"},{key:"thought_balloon",title:"thought balloon",category:"people",css:"emoji_thought_balloon"},{key:"church",title:"church",category:"places",css:"emoji_church"},{key:"city_sunrise",title:"sunset over buildings",category:"places",css:"emoji_city_sunrise"},{key:"city_sunset",title:"cityscape at dusk",category:"places",css:"emoji_city_sunset"},{key:"tent",title:"tent",category:"places",css:"emoji_tent"},{key:"sunrise_over_mountains",title:"sunrise over mountains",category:"places",css:"emoji_sunrise_over_mountains"},{key:"sunrise",title:"sunrise",category:"places",css:"emoji_sunrise"},{key:"night_with_stars",title:"night with stars",category:"places",css:"emoji_night_with_stars"},{key:"bridge_at_night",title:"bridge at night",category:"places",css:"emoji_bridge_at_night"},{key:"carousel_horse",title:"carousel horse",category:"places",css:"emoji_carousel_horse"},{key:"ferris_wheel",title:"ferris wheel",category:"places",css:"emoji_ferris_wheel"},{key:"fountain",title:"fountain",category:"places",css:"emoji_fountain"},{key:"boat",title:"sailboat",category:"places",css:"emoji_boat"},{key:"airplane",title:"airplane",category:"places",css:"emoji_airplane"},{key:"anchor",title:"anchor",category:"places",css:"emoji_anchor"},{key:"ticket",title:"ticket",category:"places",css:"emoji_ticket"},{key:"warning",title:"warning sign",category:"places",css:"emoji_warning"},{key:"fuelpump",title:"fuel pump",category:"places",css:"emoji_fuelpump"},{key:"slot_machine",title:"slot machine",category:"places",css:"emoji_slot_machine"},{key:"hotsprings",title:"hot springs",category:"places",css:"emoji_hotsprings"},{key:"circus_tent",title:"circus tent",category:"places",css:"emoji_circus_tent"},{key:"performing_arts",title:"performing arts",category:"places",css:"emoji_performing_arts"},{key:"house",title:"house building",category:"places",css:"emoji_house"},{key:"house_with_garden",title:"house with garden",category:"places",css:"emoji_house_with_garden"},{key:"school",title:"school",category:"places",css:"emoji_school"},{key:"office",title:"office building",category:"places",css:"emoji_office"},{key:"post_office",title:"japanese post office",category:"places",css:"emoji_post_office"},{key:"hospital",title:"hospital",category:"places",css:"emoji_hospital"},{key:"bank",title:"bank",category:"places",css:"emoji_bank"},{key:"convenience_store",title:"convenience store",category:"places",css:"emoji_convenience_store"},{key:"love_hotel",title:"love hotel",category:"places",css:"emoji_love_hotel"},{key:"hotel",title:"hotel",category:"places",css:"emoji_hotel"},{key:"wedding",title:"wedding",category:"places",css:"emoji_wedding"},{key:"department_store",title:"department store",category:"places",css:"emoji_department_store"},{key:"european_post_office",title:"european post office",category:"places",css:"emoji_european_post_office"},{key:"japanese_castle",title:"japanese castle",category:"places",css:"emoji_japanese_castle"},{key:"european_castle",title:"european castle",category:"places",css:"emoji_european_castle"},{key:"factory",title:"factory",category:"places",css:"emoji_factory"},{key:"tokyo_tower",title:"tokyo tower",category:"places",css:"emoji_tokyo_tower"},{key:"japan",title:"silhouette of japan",category:"places",css:"emoji_japan"},{key:"mount_fuji",title:"mount fuji",category:"places",css:"emoji_mount_fuji"},{key:"statue_of_liberty",title:"statue of liberty",category:"places",css:"emoji_statue_of_liberty"},{key:"roller_coaster",title:"roller coaster",category:"places",css:"emoji_roller_coaster"},{key:"ship",title:"ship",category:"places",css:"emoji_ship"},{key:"speedboat",title:"speedboat",category:"places",css:"emoji_speedboat"},{key:"rowboat",title:"rowboat",category:"places",css:"emoji_rowboat"},{key:"rocket",title:"rocket",category:"places",css:"emoji_rocket"},{key:"seat",title:"seat",category:"places",css:"emoji_seat"},{key:"helicopter",title:"helicopter",category:"places",css:"emoji_helicopter"},{key:"steam_locomotive",title:"steam locomotive",category:"places",css:"emoji_steam_locomotive"},{key:"tram",title:"tram",category:"places",css:"emoji_tram"},{key:"station",title:"station",category:"places",css:"emoji_station"},{key:"mountain_railway",title:"mountain railway",category:"places",css:"emoji_mountain_railway"},{key:"train2",title:"train",category:"places",css:"emoji_train2"},{key:"bullettrain_side",title:"high-speed train",category:"places",css:"emoji_bullettrain_side"},{key:"bullettrain_front",title:"high-speed train with bullet nose",category:"places",css:"emoji_bullettrain_front"},{key:"light_rail",title:"light rail",category:"places",css:"emoji_light_rail"},{key:"metro",title:"metro",category:"places",css:"emoji_metro"},{key:"monorail",title:"monorail",category:"places",css:"emoji_monorail"},{key:"train",title:"tram car",category:"places",css:"emoji_train"},{key:"railway_car",title:"railway car",category:"places",css:"emoji_railway_car"},{key:"trolleybus",title:"trolleybus",category:"places",css:"emoji_trolleybus"},{key:"bus",title:"bus",category:"places",css:"emoji_bus"},{key:"oncoming_bus",title:"oncoming bus",category:"places",css:"emoji_oncoming_bus"},{key:"blue_car",title:"recreational vehicle",category:"places",css:"emoji_blue_car"},{key:"oncoming_automobile",title:"oncoming automobile",category:"places",css:"emoji_oncoming_automobile"},{key:"car",title:"automobile",category:"places",css:"emoji_car"},{key:"taxi",title:"taxi",category:"places",css:"emoji_taxi"},{key:"oncoming_taxi",title:"oncoming taxi",category:"places",css:"emoji_oncoming_taxi"},{key:"articulated_lorry",title:"articulated lorry",category:"places",css:"emoji_articulated_lorry"},{key:"truck",title:"delivery truck",category:"places",css:"emoji_truck"},{key:"rotating_light",title:"police cars revolving light",category:"places",css:"emoji_rotating_light"},{key:"police_car",title:"police car",category:"places",css:"emoji_police_car"},{key:"oncoming_police_car",title:"oncoming police car",category:"places",css:"emoji_oncoming_police_car"},{key:"fire_engine",title:"fire engine",category:"places",css:"emoji_fire_engine"},{key:"ambulance",title:"ambulance",category:"places",css:"emoji_ambulance"},{key:"minibus",title:"minibus",category:"places",css:"emoji_minibus"},{key:"bike",title:"bicycle",category:"places",css:"emoji_bike"},{key:"aerial_tramway",title:"aerial tramway",category:"places",css:"emoji_aerial_tramway"},{key:"suspension_railway",title:"suspension railway",category:"places",css:"emoji_suspension_railway"},{key:"mountain_cableway",title:"mountain cableway",category:"places",css:"emoji_mountain_cableway"},{key:"tractor",title:"tractor",category:"places",css:"emoji_tractor"},{key:"barber",title:"barber pole",category:"places",css:"emoji_barber"},{key:"busstop",title:"bus stop",category:"places",css:"emoji_busstop"},{key:"vertical_traffic_light",title:"vertical traffic light",category:"places",css:"emoji_vertical_traffic_light"},{key:"traffic_light",title:"horizontal traffic light",category:"places",css:"emoji_traffic_light"},{key:"construction",title:"construction sign",category:"places",css:"emoji_construction"},{key:"beginner",title:"japanese symbol for beginner",category:"places",css:"emoji_beginner"},{key:"izakaya_lantern",title:"izakaya lantern",category:"places",css:"emoji_izakaya_lantern"},{key:"moyai",title:"moyai",category:"places",css:"emoji_moyai"},{key:"round_pushpin",title:"round pushpin",category:"places",css:"emoji_round_pushpin"},{key:"triangular_flag_on_post",title:"triangular flag on post",category:"places",css:"emoji_triangular_flag_on_post"},{key:"jp",title:"regional indicator symbol letters jp",category:"places",css:"emoji_jp"},{key:"kr",title:"regional indicator symbol letters kr",category:"places",css:"emoji_kr"},{key:"de",title:"regional indicator symbol letters de",category:"places",css:"emoji_de"},{key:"cn",title:"regional indicator symbol letters cn",category:"places",css:"emoji_cn"},{key:"us",title:"regional indicator symbol letters us",category:"places",css:"emoji_us"},{key:"fr",title:"regional indicator symbol letters fr",category:"places",css:"emoji_fr"},{key:"es",title:"regional indicator symbol letters es",category:"places",css:"emoji_es"},{key:"it",title:"regional indicator symbol letters it",category:"places",css:"emoji_it"},{key:"ru",title:"regional indicator symbol letters ru",category:"places",css:"emoji_ru"},{key:"gb",title:"regional indicator symbol letters gb",category:"places",css:"emoji_gb"},{key:"one",title:"keycap 1",category:"symbols",css:"emoji_one"},{key:"two",title:"keycap 2",category:"symbols",css:"emoji_two"},{key:"three",title:"keycap 3",category:"symbols",css:"emoji_three"},{key:"four",title:"keycap 4",category:"symbols",css:"emoji_four"},{key:"five",title:"keycap 5",category:"symbols",css:"emoji_five"},{key:"six",title:"keycap 6",category:"symbols",css:"emoji_six"},{key:"seven",title:"keycap 7",category:"symbols",css:"emoji_seven"},{key:"eight",title:"keycap 8",category:"symbols",css:"emoji_eight"},{key:"nine",title:"keycap 9",category:"symbols",css:"emoji_nine"},{key:"zero",title:"keycap 0",category:"symbols",css:"emoji_zero"},{key:"keycap_ten",title:"keycap ten",category:"symbols",css:"emoji_keycap_ten"},{key:"1234",title:"input symbol for numbers",category:"symbols",css:"emoji_1234"},{key:"hash",title:"hash key",category:"symbols",css:"emoji_hash"},{key:"symbols",title:"input symbol for symbols",category:"symbols",css:"emoji_symbols"},{key:"arrow_up",title:"upwards black arrow",category:"symbols",css:"emoji_arrow_up"},{key:"arrow_down",title:"downwards black arrow",category:"symbols",css:"emoji_arrow_down"},{key:"arrow_left",title:"leftwards black arrow",category:"symbols",css:"emoji_arrow_left"},{key:"arrow_right",title:"black rightwards arrow",category:"symbols",css:"emoji_arrow_right"},{key:"capital_abcd",title:"input symbol for latin capital letters",category:"symbols",css:"emoji_capital_abcd"},{key:"abcd",title:"input symbol for latin small letters",category:"symbols",css:"emoji_abcd"},{key:"abc",title:"input symbol for latin letters",category:"symbols",css:"emoji_abc"},{key:"arrow_upper_right",title:"north east arrow",category:"symbols",css:"emoji_arrow_upper_right"},{key:"arrow_upper_left",title:"north west arrow",category:"symbols",css:"emoji_arrow_upper_left"},{key:"arrow_lower_left",title:"south west arrow",category:"symbols",css:"emoji_arrow_lower_left"},{key:"arrow_lower_right",title:"south east arrow",category:"symbols",css:"emoji_arrow_lower_right"},{key:"left_right_arrow",title:"left right arrow",category:"symbols",css:"emoji_left_right_arrow"},{key:"arrow_up_down",title:"up down arrow",category:"symbols",css:"emoji_arrow_up_down"},{key:"arrows_counterclockwise",title:"anticlockwise downwards and upwards open circle arrows",category:"symbols",css:"emoji_arrows_counterclockwise"},{key:"arrow_up_small",title:"up-pointing small red triangle",category:"symbols",css:"emoji_arrow_up_small"},{key:"arrow_down_small",title:"down-pointing small red triangle",category:"symbols",css:"emoji_arrow_down_small"},{key:"leftwards_arrow_with_hook",title:"leftwards arrow with hook",category:"symbols",css:"emoji_leftwards_arrow_with_hook"},{key:"arrow_right_hook",title:"rightwards arrow with hook",category:"symbols",css:"emoji_arrow_right_hook"},{key:"information_source",title:"information source",category:"symbols",css:"emoji_information_source"},{key:"rewind",title:"black left-pointing double triangle",category:"symbols",css:"emoji_rewind"},{key:"fast_forward",title:"black right-pointing double triangle",category:"symbols",css:"emoji_fast_forward"},{key:"arrow_double_up",title:"black up-pointing double triangle",category:"symbols",css:"emoji_arrow_double_up"},{key:"arrow_double_down",title:"black down-pointing double triangle",category:"symbols",css:"emoji_arrow_double_down"},{key:"arrow_heading_down",title:"arrow pointing rightwards then curving downwards",category:"symbols",css:"emoji_arrow_heading_down"},{key:"arrow_heading_up",title:"arrow pointing rightwards then curving upwards",category:"symbols",css:"emoji_arrow_heading_up"},{key:"ok",title:"squared ok",category:"symbols",css:"emoji_ok"},{key:"twisted_rightwards_arrows",title:"twisted rightwards arrows",category:"symbols",css:"emoji_twisted_rightwards_arrows"},{key:"repeat",title:"clockwise rightwards and leftwards open circle arrows",category:"symbols",css:"emoji_repeat"},{key:"repeat_one",title:"clockwise rightwards and leftwards open circle arrows with circled one overlay",category:"symbols",css:"emoji_repeat_one"},{key:"new",title:"squared new",category:"symbols",css:"emoji_new"},{key:"up",title:"squared up with exclamation mark",category:"symbols",css:"emoji_up"},{key:"cool",title:"squared cool",category:"symbols",css:"emoji_cool"},{key:"free",title:"squared free",category:"symbols",css:"emoji_free"},{key:"ng",title:"squared ng",category:"symbols",css:"emoji_ng"},{key:"signal_strength",title:"antenna with bars",category:"symbols",css:"emoji_signal_strength"},{key:"cinema",title:"cinema",category:"symbols",css:"emoji_cinema"},{key:"koko",title:"squared katakana koko",category:"symbols",css:"emoji_koko"},{key:"u6307",title:"squared cjk unified ideograph-6307",category:"symbols",css:"emoji_u6307"},{key:"u7a7a",title:"squared cjk unified ideograph-7a7a",category:"symbols",css:"emoji_u7a7a"},{key:"u6e80",title:"squared cjk unified ideograph-6e80",category:"symbols",css:"emoji_u6e80"},{key:"u5408",title:"squared cjk unified ideograph-5408",category:"symbols",css:"emoji_u5408"},{key:"u7981",title:"squared cjk unified ideograph-7981",category:"symbols",css:"emoji_u7981"},{key:"ideograph_advantage",title:"circled ideograph advantage",category:"symbols",css:"emoji_ideograph_advantage"},{key:"u5272",title:"squared cjk unified ideograph-5272",category:"symbols",css:"emoji_u5272"},{key:"u55b6",title:"squared cjk unified ideograph-55b6",category:"symbols",css:"emoji_u55b6"},{key:"u6709",title:"squared cjk unified ideograph-6709",category:"symbols",css:"emoji_u6709"},{key:"u7121",title:"squared cjk unified ideograph-7121",category:"symbols",css:"emoji_u7121"},{key:"restroom",title:"restroom",category:"symbols",css:"emoji_restroom"},{key:"mens",title:"mens symbol",category:"symbols",css:"emoji_mens"},{key:"womens",title:"womens symbol",category:"symbols",css:"emoji_womens"},{key:"baby_symbol",title:"baby symbol",category:"symbols",css:"emoji_baby_symbol"},{key:"wc",title:"water closet",category:"symbols",css:"emoji_wc"},{key:"potable_water",title:"potable water symbol",category:"symbols",css:"emoji_potable_water"},{key:"put_litter_in_its_place",title:"put litter in its place symbol",category:"symbols",css:"emoji_put_litter_in_its_place"},{key:"parking",title:"negative squared latin capital letter p",category:"symbols",css:"emoji_parking"},{key:"no_smoking",title:"no smoking symbol",category:"symbols",css:"emoji_no_smoking"},{key:"u6708",title:"squared cjk unified ideograph-6708",category:"symbols",css:"emoji_u6708"},{key:"u7533",title:"squared cjk unified ideograph-7533",category:"symbols",css:"emoji_u7533"},{key:"sa",title:"squared katakana sa",category:"symbols",css:"emoji_sa"},{key:"m",title:"circled latin capital letter m",category:"symbols",css:"emoji_m"},{key:"passport_control",title:"passport control",category:"symbols",css:"emoji_passport_control"},{key:"baggage_claim",title:"baggage claim",category:"symbols",css:"emoji_baggage_claim"},{key:"left_luggage",title:"left luggage",category:"symbols",css:"emoji_left_luggage"},{key:"customs",title:"customs",category:"symbols",css:"emoji_customs"},{key:"accept",title:"circled ideograph accept",category:"symbols",css:"emoji_accept"},{key:"secret",title:"circled ideograph secret",category:"symbols",css:"emoji_secret"},{key:"congratulations",title:"circled ideograph congratulation",category:"symbols",css:"emoji_congratulations"},{key:"cl",title:"squared cl",category:"symbols",css:"emoji_cl"},{key:"sos",title:"squared sos",category:"symbols",css:"emoji_sos"},{key:"id",title:"squared id",category:"symbols",css:"emoji_id"},{key:"no_entry_sign",title:"no entry sign",category:"symbols",css:"emoji_no_entry_sign"},{key:"underage",title:"no one under eighteen symbol",category:"symbols",css:"emoji_underage"},{key:"no_mobile_phones",title:"no mobile phones",category:"symbols",css:"emoji_no_mobile_phones"},{key:"do_not_litter",title:"do not litter symbol",category:"symbols",css:"emoji_do_not_litter"},{key:"non-potable_water",title:"non-potable water symbol",category:"symbols",css:"emoji_non-potable_water"},{key:"no_bicycles",title:"no bicycles",category:"symbols",css:"emoji_no_bicycles"},{key:"no_pedestrians",title:"no pedestrians",category:"symbols",css:"emoji_no_pedestrians"},{key:"children_crossing",title:"children crossing",category:"symbols",css:"emoji_children_crossing"},{key:"no_entry",title:"no entry",category:"symbols",css:"emoji_no_entry"},{key:"eight_spoked_asterisk",title:"eight spoked asterisk",category:"symbols",css:"emoji_eight_spoked_asterisk"},{key:"sparkle",title:"sparkle",category:"symbols",css:"emoji_sparkle"},{key:"negative_squared_cross_mark",title:"negative squared cross mark",category:"symbols",css:"emoji_negative_squared_cross_mark"},{key:"white_check_mark",title:"white heavy check mark",category:"symbols",css:"emoji_white_check_mark"},{key:"eight_pointed_black_star",title:"eight pointed black star",category:"symbols",css:"emoji_eight_pointed_black_star"},{key:"heart_decoration",title:"heart decoration",category:"symbols",css:"emoji_heart_decoration"},{key:"vs",title:"squared vs",category:"symbols",css:"emoji_vs"},{key:"vibration_mode",title:"vibration mode",category:"symbols",css:"emoji_vibration_mode"},{key:"mobile_phone_off",title:"mobile phone off",category:"symbols",css:"emoji_mobile_phone_off"},{key:"a",title:"negative squared latin capital letter a",category:"symbols",css:"emoji_a"},{key:"b",title:"negative squared latin capital letter b",category:"symbols",css:"emoji_b"},{key:"ab",title:"negative squared ab",category:"symbols",css:"emoji_ab"},{key:"o2",title:"negative squared latin capital letter o",category:"symbols",css:"emoji_o2"},{key:"diamond_shape_with_a_dot_inside",title:"diamond shape with a dot inside",category:"symbols",css:"emoji_diamond_shape_with_a_dot_inside"},{key:"loop",title:"double curly loop",category:"symbols",css:"emoji_loop"},{key:"recycle",title:"black universal recycling symbol",category:"symbols",css:"emoji_recycle"},{key:"aries",title:"aries",category:"symbols",css:"emoji_aries"},{key:"taurus",title:"taurus",category:"symbols",css:"emoji_taurus"},{key:"gemini",title:"gemini",category:"symbols",css:"emoji_gemini"},{key:"cancer",title:"cancer",category:"symbols",css:"emoji_cancer"},{key:"leo",title:"leo",category:"symbols",css:"emoji_leo"},{key:"virgo",title:"virgo",category:"symbols",css:"emoji_virgo"},{key:"libra",title:"libra",category:"symbols",css:"emoji_libra"},{key:"scorpius",title:"scorpius",category:"symbols",css:"emoji_scorpius"},{key:"sagittarius",title:"sagittarius",category:"symbols",css:"emoji_sagittarius"},{key:"capricorn",title:"capricorn",category:"symbols",css:"emoji_capricorn"},{key:"aquarius",title:"aquarius",category:"symbols",css:"emoji_aquarius"},{key:"pisces",title:"pisces",category:"symbols",css:"emoji_pisces"},{key:"ophiuchus",title:"ophiuchus",category:"symbols",css:"emoji_ophiuchus"},{key:"six_pointed_star",title:"six pointed star with middle dot",category:"symbols",css:"emoji_six_pointed_star"},{key:"atm",title:"automated teller machine",category:"symbols",css:"emoji_atm"},{key:"chart",title:"chart with upwards trend and yen sign",category:"symbols",css:"emoji_chart"},{key:"arrow_backward",title:"black left-pointing triangle",category:"symbols",css:"emoji_arrow_backward"},{key:"heavy_dollar_sign",title:"heavy dollar sign",category:"symbols",css:"emoji_heavy_dollar_sign"},{key:"arrow_forward",title:"black right-pointing triangle",category:"symbols",css:"emoji_arrow_forward"},{key:"currency_exchange",title:"currency exchange",category:"symbols",css:"emoji_currency_exchange"},{key:"copyright",title:"copyright sign",category:"symbols",css:"emoji_copyright"},{key:"registered",title:"registered sign",category:"symbols",css:"emoji_registered"},{key:"tm",title:"trade mark sign",category:"symbols",css:"emoji_tm"},{key:"x",title:"cross mark",category:"symbols",css:"emoji_x"},{key:"bangbang",title:"double exclamation mark",category:"symbols",css:"emoji_bangbang"},{key:"interrobang",title:"exclamation question mark",category:"symbols",css:"emoji_interrobang"},{key:"exclamation",title:"heavy exclamation mark symbol",category:"symbols",css:"emoji_exclamation"},{key:"question",title:"black question mark ornament",category:"symbols",css:"emoji_question"},{key:"grey_exclamation",title:"white exclamation mark ornament",category:"symbols",css:"emoji_grey_exclamation"},{key:"grey_question",title:"white question mark ornament",category:"symbols",css:"emoji_grey_question"},{key:"o",title:"heavy large circle",category:"symbols",css:"emoji_o"},{key:"top",title:"top with upwards arrow above",category:"symbols",css:"emoji_top"},{key:"end",title:"end with leftwards arrow above",category:"symbols",css:"emoji_end"},{key:"back",title:"back with leftwards arrow above",category:"symbols",css:"emoji_back"},{key:"on",title:"on with exclamation mark with left right arrow above",category:"symbols",css:"emoji_on"},{key:"soon",title:"soon with rightwards arrow above",category:"symbols",css:"emoji_soon"},{key:"arrows_clockwise",title:"clockwise downwards and upwards open circle arrows",category:"symbols",css:"emoji_arrows_clockwise"},{key:"clock12",title:"clock face twelve oclock",category:"symbols",css:"emoji_clock12"},{key:"clock1230",title:"clock face twelve-thirty",category:"symbols",css:"emoji_clock1230"},{key:"clock1",title:"clock face one oclock",category:"symbols",css:"emoji_clock1"},{key:"clock130",title:"clock face one-thirty",category:"symbols",css:"emoji_clock130"},{key:"clock2",title:"clock face two oclock",category:"symbols",css:"emoji_clock2"},{key:"clock230",title:"clock face two-thirty",category:"symbols",css:"emoji_clock230"},{key:"clock3",title:"clock face three oclock",category:"symbols",css:"emoji_clock3"},{key:"clock330",title:"clock face three-thirty",category:"symbols",css:"emoji_clock330"},{key:"clock4",title:"clock face four oclock",category:"symbols",css:"emoji_clock4"},{key:"clock430",title:"clock face four-thirty",category:"symbols",css:"emoji_clock430"},{key:"clock5",title:"clock face five oclock",category:"symbols",css:"emoji_clock5"},{key:"clock530",title:"clock face five-thirty",category:"symbols",css:"emoji_clock530"},{key:"clock6",title:"clock face six oclock",category:"symbols",css:"emoji_clock6"},{key:"clock630",title:"clock face six-thirty",category:"symbols",css:"emoji_clock630"},{key:"clock7",title:"clock face seven oclock",category:"symbols",css:"emoji_clock7"},{key:"clock730",title:"clock face seven-thirty",category:"symbols",css:"emoji_clock730"},{key:"clock8",title:"clock face eight oclock",category:"symbols",css:"emoji_clock8"},{key:"clock830",title:"clock face eight-thirty",category:"symbols",css:"emoji_clock830"},{key:"clock9",title:"clock face nine oclock",category:"symbols",css:"emoji_clock9"},{key:"clock930",title:"clock face nine-thirty",category:"symbols",css:"emoji_clock930"},{key:"clock10",title:"clock face ten oclock",category:"symbols",css:"emoji_clock10"},{key:"clock1030",title:"clock face ten-thirty",category:"symbols",css:"emoji_clock1030"},{key:"clock11",title:"clock face eleven oclock",category:"symbols",css:"emoji_clock11"},{key:"clock1130",title:"clock face eleven-thirty",category:"symbols",css:"emoji_clock1130"},{key:"wheelchair",title:"wheelchair symbol",category:"symbols",css:"emoji_wheelchair"},{key:"heavy_multiplication_x",title:"heavy multiplication x",category:"symbols",css:"emoji_heavy_multiplication_x"},{key:"heavy_plus_sign",title:"heavy plus sign",category:"symbols",css:"emoji_heavy_plus_sign"},{key:"heavy_minus_sign",title:"heavy minus sign",category:"symbols",css:"emoji_heavy_minus_sign"},{key:"heavy_division_sign",title:"heavy division sign",category:"symbols",css:"emoji_heavy_division_sign"},{key:"spades",title:"black spade suit",category:"symbols",css:"emoji_spades"},{key:"hearts",title:"black heart suit",category:"symbols",css:"emoji_hearts"},{key:"clubs",title:"black club suit",category:"symbols",css:"emoji_clubs"},{key:"diamonds",title:"black diamond suit",category:"symbols",css:"emoji_diamonds"},{key:"white_flower",title:"white flower",category:"symbols",css:"emoji_white_flower"},{key:"100",title:"hundred points symbol",category:"symbols",css:"emoji_100"},{key:"heavy_check_mark",title:"heavy check mark",category:"symbols",css:"emoji_heavy_check_mark"},{key:"ballot_box_with_check",title:"ballot box with check",category:"symbols",css:"emoji_ballot_box_with_check"},{key:"radio_button",title:"radio button",category:"symbols",css:"emoji_radio_button"},{key:"link",title:"link symbol",category:"symbols",css:"emoji_link"},{key:"curly_loop",title:"curly loop",category:"symbols",css:"emoji_curly_loop"},{key:"wavy_dash",title:"wavy dash",category:"symbols",css:"emoji_wavy_dash"},{key:"part_alternation_mark",title:"part alternation mark",category:"symbols",css:"emoji_part_alternation_mark"},{key:"trident",title:"trident emblem",
category:"symbols",css:"emoji_trident"},{key:"black_medium_small_square",title:"black medium small square",category:"symbols",css:"emoji_black_medium_small_square"},{key:"white_medium_small_square",title:"white medium small square",category:"symbols",css:"emoji_white_medium_small_square"},{key:"black_medium_square",title:"black medium square",category:"symbols",css:"emoji_black_medium_square"},{key:"white_medium_square",title:"white medium square",category:"symbols",css:"emoji_white_medium_square"},{key:"black_small_square",title:"black small square",category:"symbols",css:"emoji_black_small_square"},{key:"white_small_square",title:"white small square",category:"symbols",css:"emoji_white_small_square"},{key:"small_red_triangle",title:"up-pointing red triangle",category:"symbols",css:"emoji_small_red_triangle"},{key:"black_square_button",title:"black square button",category:"symbols",css:"emoji_black_square_button"},{key:"white_square_button",title:"white square button",category:"symbols",css:"emoji_white_square_button"},{key:"black_circle",title:"medium black circle",category:"symbols",css:"emoji_black_circle"},{key:"white_circle",title:"medium white circle",category:"symbols",css:"emoji_white_circle"},{key:"red_circle",title:"large red circle",category:"symbols",css:"emoji_red_circle"},{key:"large_blue_circle",title:"large blue circle",category:"symbols",css:"emoji_large_blue_circle"},{key:"small_red_triangle_down",title:"down-pointing red triangle",category:"symbols",css:"emoji_small_red_triangle_down"},{key:"white_large_square",title:"white large square",category:"symbols",css:"emoji_white_large_square"},{key:"black_large_square",title:"black large square",category:"symbols",css:"emoji_black_large_square"},{key:"large_orange_diamond",title:"large orange diamond",category:"symbols",css:"emoji_large_orange_diamond"},{key:"large_blue_diamond",title:"large blue diamond",category:"symbols",css:"emoji_large_blue_diamond"},{key:"small_orange_diamond",title:"small orange diamond",category:"symbols",css:"emoji_small_orange_diamond"},{key:"small_blue_diamond",title:"small blue diamond",category:"symbols",css:"emoji_small_blue_diamond"}]}function n(){return s=[{key:"people",title:t("emojiCatPeople"),css:"emojiCatPeople"},{key:"nature",title:t("emojiCatNature"),css:"emojiCatNature"},{key:"objects",title:t("emojiCatObjects"),css:"emojiCatObjects"},{key:"places",title:t("emojiCatPlaces"),css:"emojiCatPlaces"},{key:"symbols",title:t("emojiCatSymbols"),css:"emojiCatSymbols"}]}function i(){return l={},Emoticons.getDefs().forEach(function(e){e.category||(e.category="symbols"),l[e.category]||(l[e.category]=[]),l[e.category].push(e)}),l}function r(){return c={},Emoticons.getDefs().forEach(function(e){c[e.key]=e}),c}function o(){var e=[];return Emoticons.getDefs().forEach(function(t){e.push(t.key)}),e}var a,s,l,c,d;Emoticons.getDefs=function(){return a||e()},Emoticons.getDefsByKey=function(){return c||r()},Emoticons.getCategories=function(){return s||n()},Emoticons.getByCategory=function(){return l||i()},Emoticons.getKeys=function(){return d||o()}}(),"undefined"==typeof Controller&&(Controller={}),Controller.Broadcast=function(e,n){function i(){jQuery("div.modalOverlay.loader").hide(),jQuery("div.modalOverlay.error").show()}function r(){if(O={},ee?ne=B:(B.empty().append(z.render("main",{listUrl:B.data("list-url"),playzoneTournaments:G,headless:q})),ne=B.find("#tabTournaments .tabContentInsider"),re=B.find("div.searchCore"),M(!0)),R)switch(R){case"condensed":window.settings.setOverride("game-board-theme","chess24new"),window.settings.setOverride("game-piece-theme","chess24")}E=Handler.socket.getSocket(Handler.socket.types.NOTIFICATION),E.on("error",i),E.on("connect_failed",i),E.on("model:add"+F+V,c),"multiBoardOnly"===ee&&H.startWith?setTimeout(function(){l([H.startWith])}):n.c24?E.emit("getPlayzoneTournamentIds",F,l):E.emit("getTournamentIds",F,o),B.on("click",".tournamentTabs > .tabsList > li > div:not(:first)",function(){D=jQuery(this).attr("tournamentid");var e=jQuery(z.render("dialogs.embed",{tournamentId:D,roundId:K[D],matchId:J[D],gameId:X[D]}));jQuery(document).trigger("chess24:embedurl",{html:e,events:{"chess24:show":{"*":function(){setTimeout(function(){e.find(".copy").clipboard({path:config.assetDir()+"/images/swf/jquery.clipboard.swf",copy:function(){var e=jQuery(this),t=e.find(".copyTooltip"),n=t.data("timeout");return clearTimeout(n),t.addClass("fixed").show(),n=setTimeout(function(){t.removeClass("fixed").hide()},2e3),t.data("timeout",n),e.siblings(".code").text()}})},500)}}}});var t="Round "+K[D];"knockout"==U.getAttribute(D,"eventType")&&(t+="."+X[D]),M({title:U.getTitle(D),logo:U.getAttribute(D,"logo"),round:t}),re.hide()}).on("click",".tournamentTabs > .tabsList > li > div:first",function(){jQuery(document).trigger("chess24:embedurl",!1),M(!0),re.show()}),re&&a(re)}function o(e){oe=e,l(e)}function a(e){var t=e.find("input.searchTournamentOrPlayer"),n=e.find("a.searchTournamentOrPlayer");t.on("keydown",function(e){e.keyCode===Handler.Keyboard.keys.VK_RETURN&&s(t.val())}),t.on("input",function(){n.toggle($(this).val().trim().length>0)}),n.on("click",function(){s(t.val())})}function s(e){e.length>0?jQuery.getJSON("/api/web/broadcastAPI/searchTournaments",{q:e}).done(function(e){var t=e.data&&e.data.tournaments;t.length>0&&(le=[],ne.empty(),l(t))}):(le=[],ne.empty(),l(oe))}function l(e){if("dual"===ee)return void p(e);for(var t=0;t<e.length;t++)le.push(function(e){return function(t){d(e,!1,function(){setTimeout(t)})}}(e[t]));if(Z){layout(B);var i=H.startWith;if(i)if(Y[i])Z(Y[i]);else{var r="model:"+F+V,o=r+":"+i,a={rkey:o};Y[i]="connecting";var s=new Record.TournamentSocketPR(a,E,function(){"object"!=typeof Y[i]&&(Y[i]=s,U.add(s,i)),Z(s)});n&&n.overrides&&s.setOverrides(n.overrides)}}h()}function c(e){return d(e,!0)}function d(e,t,i){function r(){return u(e,o)?("object"!=typeof Y[e]&&(Y[e]=o,U.add(o,e)),t?f(o,e,!0):(f(o,e),Z&&Z(o)),void(i&&i())):(o.unsubscribe(),delete Y[e],void(i&&i()))}if(H&&H.blackList&&H.blackList.contains(e)||H&&H.whiteList&&!H.whiteList.contains(e))return void i();var o;if(Y[e])return void function c(){Y[e]instanceof Record.TournamentSocketPR?(o=Y[e],setTimeout(r)):setTimeout(c,5)}();var a="model:"+F+V,s=a+":"+e,l={rkey:s};o=new Record.TournamentSocketPR(l,E,r),n&&n.overrides&&o.setOverrides(n.overrides),Y[e]="connecting"}function u(e,t){var n=!!t.get("c24");if(G!==n)return!1;if(n){var i=t.get("private");if(i&&(!H.whiteList||1!==H.whiteList.length||H.whiteList[0]!==e))return!1;var r=t.get("enrollingFrom"),o=t.get("rounds");if(o[1]&&o[1].startDate-r>Date.now()&&(!H.whiteList||!H.whiteList.contains(e)))return!1}return!0}function h(){h.already?jQuery(window).trigger("scroll"):(h.already=!0,ne.lazyload({distance:300,onstart:function(e){var t=le.shift();"function"==typeof t?t(function(){e(!0)}):(e(!1),h.already=!1)}}))}function f(e,t,r){var o=e.get("currentRound"),a=N||o,s=!!e.get("c24"),l=(e.get("video")||[]).map(function(e){return e.language}).unique();if("multiBoardOnly"===ee){a=n.roundId||a;var c=new View.MultiBoard(ne,t,a,1);return c.resume(),layout(B),void jQuery("div.modalOverlay.loader").hide()}var d=z.render("tournament.main",{tournamentId:t,languages:l,playzone:s});r?ne.prepend(d):ne.append(d);var u=B.find("div.tournamentId"+t),h=[],f=u.find(".tournamentHeader");f.length&&h.push(new View.Header(f,t,a).setTournamentUrl(Q.getGameUrl(t,a,1,1)).link(U));var p=u.find(s?".playzoneTournament":".tournamentIntro .colInsider p");p.length&&h.push(new View.Intro(p,t).link(U));var m=u.find(".specialTournamentTitle");m.length&&h.push(new View.TournamentAttribute(m.find("h3"),t,{attribute:"headline",action:"content",hideOnEmpty:m}));var g=u.find(".specialTournamentDescription");g.length&&h.push(new View.TournamentAttribute(g,t,{attribute:"prizes",action:"content",hideOnEmpty:!0})),h.push(new View.TournamentAttribute(u,t,{attribute:"classname",action:"classname"})),h.push(new View.TournamentAttribute(u,t,{attribute:"headline",action:"toggleClass",classname:"specialTournament"})),s&&h.push(new View.TournamentAttribute(u,t,{attribute:"enrollingFrom",action:"toggleClass",classname:"pending",predicate:function(){var t=e.get("enrollingFrom"),n=e.get("rounds");return n[1]&&n[1].startDate-t>Date.now()}}));var v=e.get("eventType"),y=u.find(".tournamentDataContainer"),b="div.tournamentId"+t+" .tournamentDataContainer";switch(v){case"knockout":y.addClass("tournamentKnockoutTree"),y.length&&h.push(new View.KnockoutTreeGroup(y,b,t,a).link(U));break;case"teamRoundRobin":y.length&&y.addClass("tournamentTeamRoundRobin"),h.push(new View.TeamRoundRobin(y,t,a));break;case"open":u.append(z.render("open.main"));var w=u.find(".tournamentStandings"),k=u.find(".tournamentOngoingGames");k.length&&h.push(new View.OpenGames(k,t,a,!0).link(U)),w.length&&h.push(new View.OpenStandings(w,t,a).link(U));break;case"bunchOfGames":default:u.append(z.render("bunchOfGames.main")),k=u.find(".tournamentOngoingGames"),h.push(new View.OpenGames(k,t,a,!0).link(U))}"single"==ee?(h.forEach(function(e){e.resume()}),B.suspendResume(h)):B.find("#tabTournaments").suspendResume(h),layout(B),jQuery("div.modalOverlay.loader").hide(),E.off("error",i),E.off("connect_failed",i)}function p(e){var t,i;e.forEach(function(e){if(e===ae.id1){var r="model:"+F+V,o=r+":"+e,a={rkey:o};Y[e]="connecting";var s=new Record.TournamentSocketPR(a,E,function(){var n=!!s.get("c24");G===n&&(Y[e]=s,U.add(s,e),e===ae.id1?t=s:i=s,g(t,i,ae.id1,ae.id2),Z&&Z(s))});n&&n.overrides&&s.setOverrides(n.overrides)}})}function m(e,t){if(e===ae.id2&&!Y[e]){var i="model:"+F+V,r=i+":"+e,o={rkey:r};Y[e]="connecting";var a=new Record.TournamentSocketPR(o,E,function(){Y[e]=a,U.add(a,e),t()});n&&n.overrides&&a.setOverrides(n.overrides)}}function g(e,t,n,i){var r=e.get("currentRound"),o=N||r,a=[],s=e.get("video")||t&&t.get("video");if(s)for(var l in s)l=l.split("-")[0],a.contains(l)||a.push(l);var c=[Q.getGameUrl(n,r,1,1),Q.getGameUrl(i,r,1,1)],d=z.render("tournament.dualMain",{tournamentId:n,languages:a,tournamentUrl:c[0]});B.prepend(d);var u=B.find("div.tournamentId"+n);u.find(".tournamentLiveStream a").on("click",function(e){return Q.showGame(n,r),!1});var h,f=[u.find(".tournamentHeader:eq(0)"),u.find(".tournamentHeader:eq(1)").hide()],p=new View.Header(f[0],n,o).setTournamentUrl(c[0]).link(U),g=u.find(".tournamentIntro .colInsider p"),v=new View.Intro(g,n).link(U),y=u.find(".tournamentDataContainer"),b=new View.Dual(U,y,n,i,o,m,"olympiad2014women"===n);b.on("switch",function(e,t){var n=(t+1)%2;if(f[t].show(),f[n].hide(),!h&&1===t){f[1].replaceWith(z.render("tournament.header",{tournamentId:i,languages:a,tournamentUrl:c[1]})),f[1]=u.find(".tournamentHeader:eq(1)");var r=new View.Header(u.find(".tournamentHeader:eq(1)"),i,o).setTournamentUrl(c[1]).link(U);B.suspendResume(r),h=!0}}),[n,i].contains(H.startWith)&&b.showTournament(H.startWith),B.suspendResume(p,v,b),layout(B),jQuery("div.modalOverlay.loader").hide()}function v(e){return he[e]||(he[e]=function(){x(e)})}function y(e,t,n){var i=e.get("rounds")[t];if(i)for(var r in i.matches){var o=i.matches[r];if(o.games[n])return r}}function b(e,n,i,r,o,a){var s=U.getRounds(e),l=s[n],c=l.matches[i].games[r];if(!c||!c.server){var d=!0;c={player:{},gameSessionToken:""}}w(e,n,i,r);var u=U.getTitle(e),h=Controller.getPlayZone(),f="s";c.player.white==config.user().uuid?f="w":c.player.black==config.user().uuid&&(f="b"),void 0!==O[e]&&T(e)||(O[e]=_(B,e,u));var p=O[e].tab.content;if(O[e].isNewlyCreated){if("knockout"===o)var m=t("Knockout Tree");else"teamRoundRobin"===o?m=t("Round Table"):"open"===o&&(m=t("Tournament"));h.resetLayout(),p.html(z.render("game.playzone",{tournamentTabTitle:m,separate:!!te,separateUrl:B.data("list-url"),showTabTournamentStandings:Object.getLength(Object.without(U.getAttribute(e,"players"),"unknown"))<=View.StandingsTable.MAX_PLAYERS}));var g=p.find(".tabTournamentGames").attr("id","tabTournamentGamesShared"),v=p.find(".tabMultiboard").attr("id","tabMultiboardShared"),y=p.find(".tabTournamentStandings").attr("id","tabTournamentStandingsShared"),b=p.find(".tabInformation").attr("id","tabInformationShared"),k=p.find(".tabPgn").attr("id","tabPgnShared");if("teamRoundRobin"===o){var x=new View.TeamRoundRobin(g,e,n);g.suspendResume(x)}else if("open"===o){g.append(z.render("open.main"));var j=g.find(".tournamentStandings"),S=g.find(".tournamentOngoingGames"),I=new View.OpenGames(S,e,void 0,!0).link(U),P=new View.OpenStandings(j,e).link(U);g.suspendResume(I,P)}if(Q.snapshotsAvailable(e)){var M=new View.MultiBoard(v,e,n,i,C(e));M.setCurrentGame(i,r),v.suspendResume(M),O[e].matchViews.push(M)}else v.remove();if(y.length){var E=new View.StandingsTable(y,e).link(U);y.suspendResume(E)}if(b.length){var A=new View.TournamentInformation(b,e,n);b.suspendResume(A)}if(k.length){var D=new View.PgnDownload(k,e,n,i,r);k.suspendResume(D)}if(te){var H=p.find(".returnToOverview a");H.data("view",new View.OverviewButton(H,e,n,i,r))}O[e].isNewlyCreated=!1,layout(p)}else{k=p.find("section.tabPgn").data("view").changeGame(e,n,i,r);for(var N in O[e].matchViews)O[e].matchViews[N]instanceof View.MultiBoard&&O[e].matchViews[N].setCurrentRound(n,i).setCurrentGame(i,r);var H=p.find(".returnToOverview a"),L=H.data("view");L&&L.switchGame(e,n,i,r)}O[e].tab.nav.find("> *").first().click(),te&&(p.suspendResume(h),p.show().trigger("chess24:show"),B.hide().trigger("chess24:hide")),Controller.getPlayingServer(c.gameSessionToken).done(function(t){h.initGameSession({broadcast:!0,gameSessionToken:c.gameSessionToken,authToken:config.user().authToken,mode:d?"standby":"human",role:f,clock:parseInt(l.timeControl.base,10)/1e3,increment:parseInt(l.timeControl.incrementPerMove,10)/1e3,playingServer:d?{}:{host:t.host,port:t.port},container:O[e].tab.content.find(".playzoneTournamentGame"),tournamentUuid:e,url:a})}).fail(function(e){errorHandler.error(e)})}function w(e,t,n,i){for(var r in Y)if(Y[r]instanceof Record.TournamentSocketPR){var o=U.findPlayersGame(r,config.user().uuid);o&&o.gameId&&(e==r&&t==o.roundId&&n==o.matchId&&i==o.gameId?notificationHandler.emit("channel:gameSession:add:self",{}):notificationHandler.emit("playzone_tournament",{content:{action:"playing",tournamentId:r,roundId:o.roundId,matchId:o.matchId,gameId:o.gameId}}))}M(e?{title:U.getTitle(e),round:t,game:i}:!0)}function k(e,n,i,r,o){var a={},s={};if("dual"===ee){if(!O[e]){var l=e===ae.id1?ae.id2:ae.id1;O[l]&&(O[e]=O[l])}}else if("single"===ee&&!O[e])for(var l in O){O[e]=O[l];break}void 0===O[e]&&(O[e]=_(B,e),jQuery("html, body").animate({scrollTop:0},"fast")),jQuery("div.modalOverlay.loader").show();var c=O[e].tab.content;if(c.data("embed-url",Q.getEmbedUrl(e,n,i,r)),O[e].isNewlyCreated){switch(o){case"knockout":var d=t("Knockout Tree");break;case"teamRoundRobin":d=t("Round Table");break;case"open":case"bunchOfGames":default:d=t("Tournament")}var u="main";R&&(u="embeds."+R),c.html(jQuery(z.render("game."+u,{tournamentTabTitle:d,showTabTournamentGames:!se,isKnockout:"knockout"===o,headless:q,showTabTournamentCrossTable:!se&&"open"===o&&Object.getLength(Object.without(U.getAttribute(e,"players"),"unknown"))<=View.StandingsTable.MAX_PLAYERS,showTabTournamentStandings:!se&&"teamRoundRobin"===o,separate:!!te,betting:!config.level().isGuest&&!!U.getAttribute(e,"betting")}))),a.chessGame=c.find(".gameInsider .chessGame"),a.chessGameLeft=a.chessGame.children(".left"),a.chessGameRight=a.chessGame.children(".right"),a.chessGameLeftTop=a.chessGameLeft.children(".top"),a.chessGameLeftBottom=a.chessGameLeft.children(".bottom"),a.chessBoardInsider=a.chessGameLeft.children(".chessBoardInsider"),a.chessGameLeftLeft=a.chessBoardInsider.children(".left"),a.chessGameLeftRight=a.chessBoardInsider.children(".right"),a.chessGameRightTop=a.chessGameRight.children(".top"),a.chessGameRightBottom=a.chessGameRight.children(".bottom"),a.chessBoard=a.chessBoardInsider.children(".chessBoard"),a.engineLines=c.find(".engineLines"),a.playerInfoTop=a.chessGameLeftTop.children(".playerInfo"),a.playerInfoBottom=a.chessGameLeftBottom.children(".playerInfo"),a.evalIndicator=a.chessGameLeftLeft.children(".evalIndicator"),a.evalIndicatorTooltip=a.chessGameLeftLeft.children(".evalindicatorTooltip").children("span"),a.clockTop=a.chessGameLeftRight.find(".clocks .top"),a.clockBottom=a.chessGameLeftRight.find(".clocks .bottom"),a.userMoveMode=a.chessGameLeftRight.children(".userMoveMode"),a.flipBoard=a.chessGameLeftBottom.find(".burgerMenu .flipBoard"),a.settings=a.chessGameLeftBottom.find(".burgerMenu .settings"),a.playPosition=a.chessGameLeftBottom.find(".burgerMenu .playPosition"),a.cursor=a.chessGameLeftBottom.find(".cursor"),a.gameSlidingTabs=a.chessGameRight.find(".gameSlidingTabs"),a.notationTable=a.chessGameRight.find(".notationTable"),a.video=a.chessGameRightTop.children(".video"),a.navigation=a.chessGameRightTop.find(".navigation"),a.navigation.length||(a.navigation=B.find(".externalRoundNavigation")),a.autoPlayButton=a.chessGameLeftBottom.find(".btnAutoPlay"),a.engineToggleButton=a.chessGameLeftBottom.find(".btnEngineToggle"),a.tabGamesEngine=c.find(".tabGamesEngine").attr("id","tabGamesEngine"+e),a.tabDatabaseMoves=c.find(".tabDatabaseMoves").attr("id","tabDatabaseMoves"+e),a.tabDatabaseGames=c.find(".tabDatabaseGames").attr("id","tabDatabaseGames"+e),a.tabTournamentGames=c.find(".tabTournamentGames").attr("id","tabTournamentGames"+e),a.tabTournamentStandings=c.find(".tabTournamentStandings").attr("id","tabTournamentStandings"+e),a.tabMultiboard=c.find(".tabMultiboard").attr("id","tabMultiboard"+e),a.tabPgn=c.find(".tabPgn").attr("id","tabPgn"+e),a.tabInformation=c.find(".tabInformation").attr("id","tabInformation"+e),a.tabBetting=c.find(".tabBetting").attr("id","tabBetting"+e),s.soundView=new View.Sound("broadcast").link(W[e]),s.broadcastPageTitle=new View.BroadcastPageTitle(e).link(W[e]),a.gameSlidingTabs.length?s.tournamentChat=new View.ChatTournament(a.gameSlidingTabs,e,L).link(W[e]):a.notationTable.length&&(s.notationTable=new View.NotationArea(a.notationTable,"broadcast").link(W[e])),a.chessBoard.length&&(R&&["condensed"].contains(R)?(s.chessBoard=new View.ChessBoard(a.chessBoard,!1).link(W[e]),s.boardLink=new View.BoardLink(a.chessBoard,e)):(s.chessBoard=new View.ChessBoard(a.chessBoard,!0).link(W[e]),s.chessBoard.movementHandler.setPremove(!1))),a.engineLines.length&&(s.engineLines=new View.Engine(a.engineLines).link(W[e])),a.playerInfoTop.length&&(s.playerInfoTop=new View.PlayerInfo(a.playerInfoTop,"b",void 0,e).link(W[e])),a.playerInfoBottom.length&&(s.playerInfoBottom=new View.PlayerInfo(a.playerInfoBottom,"w",void 0,e).link(W[e])),a.clockTop.length&&(s.clockTop=new View.ChessClock(a.clockTop,"b").link(W[e])),a.clockBottom.length&&(s.clockBottom=new View.ChessClock(a.clockBottom,"w").link(W[e])),a.cursor.length&&(s.cursor=new View.Cursor(a.cursor,!1,void 0,!0).link(W[e])),a.evalIndicator.length&&(s.evalIndicator=new View.EvalIndicator(a.evalIndicator,a.evalIndicatorTooltip).link(W[e])),a.userMoveMode.length&&(s.userMoveMode=new View.UserMoveMode(a.userMoveMode,"right").link(W[e])),a.flipBoard.length&&(s.flipBoard=new View.FlipBoard(a.flipBoard).link(W[e])),a.navigation.length&&(s.navigation=new View.RoundNavigation(a.navigation,e,n,i,r)),a.autoPlayButton.length&&(s.autoPlay=new View.AutoPlay(a.autoPlayButton),s.autoPlay.link(W[e]).link(s.chessBoard.movementHandler)),a.engineToggleButton.length&&(s.engineToggle=new View.EngineToggle(a.engineToggleButton)),a.settings.length&&a.settings.on("click",function(){new Dialog.PlayzoneSettings(void 0,"broadcast").getContent().modal("show")}),a.playPosition.length&&a.playPosition.on("click",function(){var t=W[e].getClockInformation(),n={clock:{white:t.white.timeLeft,black:t.black.timeLeft},increment:t.white.incrementPerMove||t.black.incrementPerMove||0,fen:W[e].toString()};new Dialog.Engine(n)});var h=(new Handler.Keyboard).link(W[e]).link(Q);if(Handler.KeyboardDispatcher.add(h,a.chessGame),a.tabGamesEngine.length){var f=new View.EngineGroup(a.tabGamesEngine,["Engine"]);a.tabGamesEngine.suspendResume(f),f.link(W[e])}if(a.tabDatabaseMoves.length){var p=new View.ChessDBMovesWithSelector(a.tabDatabaseMoves.find(".databaseMovesWithScroller"));a.tabDatabaseMoves.suspendResume(p),p.link(W[e])}if(a.tabDatabaseGames.length){var m=new View.ChessDBGames(a.tabDatabaseGames.find(".databaseGames"),p);a.tabDatabaseGames.suspendResume(m),m.link(W[e])}if(a.tabPgn.length&&(s.tabPgn=new View.PgnDownload(a.tabPgn,e,n,i,r),a.tabPgn.suspendResume(s.tabPgn)),a.tabGamesEngine.length)if("knockout"===o)new View.KnockoutTreeGroup(a.tabTournamentGames,".tournamentId"+e+" .tabTournamentGames",e,n).link(U);else if("teamRoundRobin"===o){if(a.tabTournamentGames.length){var g=new View.TeamRoundRobin(a.tabTournamentGames,e,n);a.tabTournamentGames.suspendResume(g)}if(a.tabTournamentStandings.length){var v=new View.StandingsTable(a.tabTournamentStandings,e).link(U);a.tabTournamentStandings.suspendResume(v)}}else if("open"===o){var y=a.tabTournamentGames;y.append(z.render("open.main"));var b=y.find(".tournamentStandings"),w=y.find(".tournamentOngoingGames"),k=new View.OpenGames(w,e,n,!0).link(U),x=new View.OpenStandings(b,e).link(U);y.suspendResume(k,x),a.tabTournamentStandings.length&&(v=new View.StandingsTable(a.tabTournamentStandings,e).link(U),a.tabTournamentStandings.suspendResume(v))}else if("bunchOfGames"===o){var y=a.tabTournamentGames;y.append(z.render("bunchOfGames.main"));var w=y.find(".tournamentOngoingGames"),k=new View.OpenGames(w,e,n,!0).link(U);y.suspendResume(k,x)}if(a.tabBetting.length){var j=U.getAttribute(e,"betting");if(j.standings){var T=new View.StandingsBetting(a.tabBetting,e);a.tabBetting.suspendResume(T)}}te&&c.find(".returnToOverview").on("click",function(){Q.showOverview(B.data("list-url"))}),O[e].views=s,O[e].$containers=a,O[e].isNewlyCreated=!1,layout(c)}else O[e].views.navigation.setCurrentGame(e,n,i,r),O[e].views.tabPgn&&O[e].views.tabPgn.changeGame(e,n,i,r);if(O[e].matchViews&&O[e].matchViews.length)for(var S=0;S<O[e].matchViews.length;S++)O[e].matchViews[S]instanceof View.MultiBoard&&O[e].matchViews[S].setCurrentRound(n,i).setCurrentGame(i,r);else if(O[e].roundNo=n,O[e].matchNo=i,O[e].$containers.tabMultiboard.length){var I=new View.MultiBoard(O[e].$containers.tabMultiboard,e,n,i,C(e));I.setCurrentGame(i,r),O[e].$containers.tabMultiboard.suspendResume(I),O[e].matchViews.push(I)}else O[e].$containers.tabMultiboard.remove();if(O[e].$containers.tabInformation.length){var P=new View.TournamentInformation(O[e].$containers.tabInformation,e,n);O[e].$containers.tabInformation.suspendResume(P)}return te&&(c.show().trigger("chess24:show"),B.hide().trigger("chess24:hide")),O[e].views}function x(e){var t=U.getAttribute(e,"video"),n=O[e].$containers,i=O[e].views.video;t?i||(n.chessGame.addClass("withVideo"),n.video.length&&(O[e].views.video=new View.VideoSimple(n.video,e,!R).link(U)),O[e].views.video&&(R||(O[e].views.overlay=new View.AdvertisementOverlay(e,O[e].views.video).link(notificationHandler))),n.chessGameRightTop.append(n.video),n.chessGameLeftTop.prepend(n.playerInfoTop),n.chessGameLeftBottom.prepend(n.playerInfoBottom),n.navigation.is(".externalRoundNavigation")||n.chessGame.prepend(n.navigation),O[e].tab.content.suspendResume(O[e].views.video)):(i&&(i.unlink(U),delete O[e].views.video),n.chessGame.removeClass("withVideo"),n.video.remove(),n.chessGameRightTop.prepend(n.playerInfoTop),n.navigation.is(".externalRoundNavigation")||n.chessGameRightTop.prepend(n.navigation),n.chessGameRightBottom.append(n.playerInfoBottom))}function C(e){return function(t,n,i){Q.showGame(e,t,n,i)}}function j(e){return"separateDisplayGame_"+e}function T(e){var t=j(e),n=jQuery("#"+t);return n.length>0?!0:!1}function _(e,t,n){return{tab:S(e.find(".tournamentTabs"),t,n),current:{},roundNo:void 0,matchNo:void 0,matchViews:[],isNewlyCreated:!0}}function S(e,t,n){if(te)return jQuery(".separateDisplayGame").attr("id",j(t)),{nav:jQuery(),content:jQuery(".separateDisplayGame")};var i="tabTournament"+t;n=n&&window.t(n)||U.getTitle(t);var r={tabContentId:i,tabLabel:n,tournamentId:t},o=jQuery(z.render("tabNavItem",r)),a=jQuery("<section />").attr("id",i).addClass("gameViewContainer tournamentId"+t),s={};return s.nav=o,e.click(function(){D=t}),e.find("> .tabsList").append(o),s.content=a,e.append(a),s}function I(e,t,n){var i=[],r=U.getRounds(e);for(var o in r)if(o==t){var a=r[o];for(var s in a.matches){var l=a.matches[s];for(var c in l.games)c==n&&void 0!==l.games[c]&&i.push(parseInt(s,10))}}return i}function P(e,t,n,i,r){return Handler.Template.renderString(e,{tournamentId:t,roundId:n,matchId:i,gameId:r})}function M(e){void 0!==e&&e!==!0&&(e={template:"broadcast",data:e}),layout.safe(function(){jQuery(document).trigger("chess24:header",e)})}if(Controller.Broadcast.instance)return Controller.Broadcast.instance;var Q=this,B=jQuery(e);B.length||errorHandler.error(new Error("container not found"),{container:B});var E,O,A,D,H=n.tournamentIds,N=n.defaultRoundId,L=n.embedded,G=!!n.c24,R=n.customer,V=G?"PlayzoneTournamentRedisAR":"TournamentRedisAR",F=G?"":"web",z=new Handler.Template("broadcast"),U=new Controller.BroadcastTournament,W={},q=B.hasClass("headless"),K={},J={},X={},Y={};Handler.engine.setDataGetter(Handler.engine.NUMERICAL_ENGINE_TYPE,function(){return!1});var Z,ee,te,ne,ie,re,oe,ae={},se=!1,le=[],ce=jQuery(".contentContainerInsider > .dailyTournamentSchedule"),de=B.data("game-url"),ue=B.data("game-embed-url");Q.isEmbedded=function(){return L},Q.showPrevGame=function(){var e=O[D].current,t=e.matchNos.indexOf(e.matchNo),n=t-1;if(-1!==t&&void 0!==e.matchNos[n]){var i=e.matchNos[n];Q.showGame(D,e.roundNo,i,e.gameNo)}},Q.showNextGame=function(){var e=O[D].current,t=e.matchNos.indexOf(e.matchNo),n=t+1;if(-1!==t&&void 0!==e.matchNos[n]){var i=e.matchNos[n];Q.showGame(D,e.roundNo,i,e.gameNo)}};var he={};return Q.getCurrentGamePath=function(){return{round:K[D],match:J[D],game:X[D]}},Q.showGame=function(e,t,i,r,o){t=t||1,i=i||1,r=r||1;var a=Q.getGameUrl(e,t,i,r);if(n.norender)return void(window.location=a);ce.hide(),D=e,K[D]=parseInt(t||1,10),J[D]=parseInt(i||1,10),X[D]=parseInt(r||1,10),jQuery(".jTooltipBox").hide(),ie&&ie.reset(),W[e]instanceof Chess.GameHandler||(W[e]=new Chess.GameHandler);var s=U.getRounds(e);if(void 0===s[t]||void 0===s[t].matches[i]||void 0===s[t].matches[i].games[r]){var l="fakeTemporaryGame";W[e].hasGame(l)||W[e].addGame(l,(new Chess.Game).setNoTimeout(!0).setCheckForGameEnd(!1)),ie=function(){var n=U.getAttribute(e,"rounds");n[t]&&n[t].matches[i]&&n[t].matches[i].games[r]&&(ie.reset(),Q.showGame(e,t,i,r,o),O[e].views.navigation.setCurrentGame(e,t,i,r,!0))},ie.reset=function(){U.off("set."+e+":"+t+":"+i+":"+r,ie),ie=void 0},U.on("set."+e+":"+t+":"+i+":"+r,ie)}else{l=s[t].matches[i].games[r].fullGameRKey;var c={rkey:l}}var d=e;K[D]&&(d+="/"+K[D],J[D]&&(d+="/"+J[D],X[D]&&(d+="/"+X[D]))),Handler.tracking("broadcast","showGame",d),void 0===a||Q.isEmbedded()||window.history.pushState({},"game",a);var u=U.getAttribute(e,"eventType"),h=!!U.getAttribute(e,"c24");if(h)return void b(e,t,i,r,u,a);if("dual"==ee){if(!(W[e]instanceof Chess.GameHandler)){var f=e==ae.id1?ae.id2:ae.id1;W[f]instanceof Chess.GameHandler&&(W[e]=W[f])}}else if("single"==ee&&!(W[e]instanceof Chess.GameHandler))for(var f in W){W[e]=W[f];break}var p=k(e,t,i,r,u);if(p.boardLink&&p.boardLink.updateUrl(Q.getGameUrl(e,t,i,r,!0)),x(e),U.off("set."+e+".video",v(e)).on("set."+e+".video",v(e)),W[e].hasGame(l))jQuery("div.modalOverlay.loader").hide(),W[e].setCurrentGame(l);else{jQuery("div.modalOverlay.loader").show();var m=new Record.ChessGameSocketPR(c,E,function(){m.get("chessGame").link(W[e],l),W[e].setCurrentGame(l),jQuery("div.modalOverlay.loader").hide()},notificationHandler.getTimeOffset())}if(O[e].tab.nav.find("div").data("href",a).trigger("click"),O[e].current.subRound!==t.toString()+"-"+r.toString()&&U.emit("subRoundChanged",{roundNo:t,matchNo:i,gameNo:r}),O[e].current={roundNo:t,matchNo:i,gameNo:r,subRound:t.toString()+"-"+r.toString(),matchNos:I(e,t,r)},A instanceof jQuery&&A.removeClass("currentGame"),A=jQuery(".tournamentId"+e+" .roundId"+t+" .matchId"+i+" .gameId"+r).addClass("currentGame"),"string"==typeof o){var g=O[e].tab.content.find("div[data-tab-content-id="+o+e+"]");g.trigger("click")}var y=$(".gameControlsContainer .burgerMenu a.analysis");if(y){var w=Handler.Template.renderString(y.data("url"),{tournamentId:e,roundId:t,matchId:i,gameId:r});y.attr("href",w)}},Q.showGameWhenReady=function(e,t,n,i){Y[e]instanceof Record.TournamentSocketPR?(B.find(".tabsList li:first div").one("click",function(){setTimeout(function(){jQuery(window).trigger("scroll")})}),Q.showGame(e,t,n,i),Z=void 0):Z=function(r){t=t||r.get("currentRound"),i=i||r.get("currentGame")||1,n=n||"knockout"===r.get("eventType")&&y(r,t,i)||1,Q.showGameWhenReady(e,t,n,i)}},Q.showOwnGame=function(e){if(Y[e]instanceof Record.TournamentSocketPR){var t=U.findPlayersGame(e,config.user().uuid);t&&t.gameId&&(Q.showGame(e,t.roundId,t.matchId,t.gameId),Z=void 0)}else Z=function(){Q.showOwnGame(e)}},Q.jumpToDefaultGame=function(e,t){var n=U.getAttribute(e,"c24");if(n){var i=U.findPlayersGame(e,config.user().uuid,t);i?Q.showGame(e,i.roundId,i.matchId,i.gameId):Q.showGame(e,t)}else Q.showGame(e,t)},Q.showOverview=function(e){if(e&&window.history.pushState({},"overview",e),jQuery(document).trigger("chess24:embedurl",""),te&&te.length){if(B.is(":visible")&&!te.is(":visible"))return;te.hide().trigger("chess24:hide"),B.show().trigger("chess24:show")}else{var t=B.find(".tournamentTabs section:visible"),n=B.find(".tournamentTabs section:first");if(t.is(n))return;B.find(".tournamentTabs > ul.tabsList li:first div").trigger("click")}ce.show(),w()},Q.setSpecialMode=function(e,t){return"dual"===e?(ee=e,ae=t,te=jQuery(".separateDisplayGame"),se=!0):"single"===e?(ee=e,ae=void 0,te=jQuery(".separateDisplayGame"),se=!0):"multiBoardOnly"===e?ee=e:(ee=void 0,ae=void 0,te=void 0,se=!1),Q},Q.shorterFirstName=function(e,t){if(!e)return"";t=t||13;var n=e.match(/^([^,]+),([-\w\u00C0-\u017F ]+)/);if(n){var i=n[1],r="";if(i.length>t)i=i.substr(0,t-1)+".",r="";else{for(var o=n[2].trim().split(" "),a=o.length-1;a>=0&&!((i+", "+o.join(" ")).length<=t);a--)o[a]=o[a].substr(0,1)+".";for(;o.length>0&&(i+", "+o.join(" ")).length>t;)o.pop();r=o.join(" ")}var s=e.substr(n[0].length,1);return i+(r?", "+r:"")+([".",","].contains(s)?"":" ")+e.substr(n[0].length)}if(n=e.match(/^([-\w\u00C0-\u017F ]+)/)){for(var l=n[1].trim().split(" "),a=l.length-2;a>=0&&!(l.join(" ").length<=t);a--)l[a]=l[a].substr(0,1)+".";for(;l.join(" ").length>t&&l.length>1;)l.splice(l.length-2,1);l.join(" ").length>t&&(l[0]=l[0].substr(0,t-1)+".");var s=e.substr(n[0].length,1);return l.join(" ")+([".",","].contains(s)?"":" ")+e.substr(n[0].length)}return e},Q.renderLastMoves=function(e,t,n){var i="";if(!t)return i;n=n||2;for(var r=new Chess.Position({fen:e}),o=t.map(function(e){return r=r.move({dontCheckForInsufficentMaterial:!0,move:Chess.translate.canToMove(e)}),{nr:"b"===r.moveRight?r.moveCounter:r.moveCounter-1,san:r.getSan(),moveRight:r.moveRight}}),a=Math.max(o.length-n,0);a<o.length;a++)i+="w"===o[a].moveRight?i.length?" "+o[a].san:o[a].nr+"... "+o[a].san:(i.length?" ":"")+o[a].nr+". "+o[a].san;return i},Q.getTemplates=function(){return z},Q.getGameUrl=function(e,t,n,i,r){if(r||!L)var o=de;else o=ue;return P(o,e,t,n,i)},Q.getEmbedUrl=function(e,t,n,i){return P(ue,e,t,n,i)},Q.snapshotsAvailable=function(e,t,n,i){function r(e){return!!e&&!!(e.currentFen||e.earlierFen&&e.lastMoves||e.gameStatus&&"upcoming"===e.gameStatus.status)}var o=U.getAttribute(e,"rounds");return t&&n&&i?o[t]&&o[t].matches[n]&&r(o[t].matches[n].games[i]):!!o[1].matches&&Object.every(o[1].matches,function(e){return Object.some(e.games,r)})},ce.length&&new View.TournamentSchedule(ce,ce.data("tournaments")),Controller.Broadcast.instance=Q,n.norender||setTimeout(r),Q},Controller.Broadcast.offsetCorrectedDateNow=function(){return Date.now()-Controller.Broadcast.getTimeOffset()},Controller.Broadcast.getTimeOffset=function(){var e=notificationHandler.getTimeOffset();
return isNaN(e)&&(e=0),e},function(){var e;Controller.Broadcast.getOutcomePrediction=function(t){e=e||Math.Gaussian(0,Math.pow(60,2));var n=t.score||0;if(void 0!==t.mate&&("-0"===t.mate||t.mate<0?n=-(1/0):t.mate>=0&&(n=1/0)),n/=100,n>5)return[100,0,0];if(-5>n)return[0,0,100];var i=e.pdf(60*n),r=Math.pow(Math.ChiSquare(-1*n+5,2),2),o=Math.pow(Math.ChiSquare(n+5,2),2),a=[1e5*r,1e5*i,1e5*o];return Math.getPercentages(a)}}(),Controller.Broadcast.getPhraseForEvaluation=function(e,n){var i=[{abs:50,phrase:"Equal"},{abs:100,phrase:"{{color}} is slightly better"},{abs:200,phrase:"{{color}} is much better"},{abs:1/0,phrase:"{{color}} is winning"}];if(void 0===e&&void 0===n)return"";var r=0>e||0>n?"Black":"White";if(0===n)return t("Mate");if(n){var o=Math.abs(n),a=o>1?"s":"";return t(r+" can mate in {{mate}} move"+a,{"{{mate}}":o})}for(var s=Math.abs(e),l=0;l<i.length;l++)if(s<=i[l].abs)return t(i[l].phrase.replace(/{{color}}/g,r))},Controller.Broadcast.convertEvaluationToPercent=function(e,t){if(e){if(void 0!==e.score)return Math.min(100,Math.max(0,(t?1:-1)*e.score/8+50));if(void 0!==e.mate){var n;return n=0===e.mate?0:"-0"===e.mate?100:100*(e.mate>0?t:!t)}}return 50},Controller.Broadcast.scoreToString=function(e){return e%1!==0?(Math.floor(e)?Math.floor(e).toString():"")+"½":e},"undefined"==typeof Controller&&(Controller={}),Controller.BroadcastTournament=function(){var e=this;if(Controller.BroadcastTournament.instance)return Controller.BroadcastTournament.instance;Extend.Publisher(e);var t={},n=["teamRoundRobin"];e.add=function(n,i){void 0===t[i]&&(t[i]=n,e.emit("tournamentAdded",{id:i}),n.on("set",function(t,n){var r,o=i;if("rounds"===n.key)for(var a in n.diff){isNaN(a)&&errorHandler.msg("critical",new Error("non numeric index as roundId in tournament.rounds property"),!0,{tournamentPRId:o,roundId:a});var s=n.diff[a];for(var l in s)"matches"!==l&&(r="set."+o+":"+a+"."+l,e.emit(r,{key:l,tournamentId:o,roundId:a,value:n.value[a][l],full:n.value[a]}));if(s&&"object"==typeof s.matches)for(var c in s.matches){isNaN(c)&&errorHandler.msg("critical",new Error("non numeric index as matchId in tournament.rounds property"),!0,{tournamentPRId:o,roundId:a,matchId:c});var d=s.matches[c];for(var u in d)"games"!==u&&(r="set."+o+":"+a+":"+c+"."+u,e.emit(r,{key:u,tournamentId:o,roundId:a,matchId:c,value:n.value[a].matches[c][u],full:n.value[a].matches[c][u]}));if("object"==typeof d.games)for(var h in d.games){isNaN(c)&&errorHandler.msg("critical",new Error("non numeric index as gameId in tournament.rounds property"),!0,{tournamentPRId:o,roundId:a,matchId:c,gameId:c});var f=d.games[h];for(var p in f)r="set."+o+":"+a+":"+c+":"+h+"."+p,e.emit(r,{key:p,tournamentId:o,roundId:a,matchId:c,gameId:h,value:n.value[a].matches[c].games[h][p],full:n.value[a].matches[c].games[h]})}}}else n.tournamentId=o,e.emit("set."+o+"."+n.key,n)}))},e.getAttribute=function(e,n){return t[e].get(n)},e.getYear=function(t){var n=e.getRounds(t)[1],i=new Date(n.startDate[1]||n.startDate);return i.getFullYear()},e.getRounds=function(t){return e.getAttribute(t,"rounds")},e.getTitles=function(t){return e.getAttribute(t,"titles")},e.getTitle=function(t){var n=e.getAttribute(t,"titles");return n[config.language()]||n.en},e.getDescription=function(t){var n=e.getAttribute(t,"descriptions");return n&&(n[config.language()]||n.en)},e.getPlayer=function(t,n){var i=e.getAttribute(t,"players");return i[n]},e.getTournamentPR=function(e){return t[e]},e.isTeamEvent=function(t){return n.contains(e.getAttribute(t,"eventType"))},e.isKnockoutEvent=function(t){return"knockout"===e.getAttribute(t,"eventType")};var i=["teamRoundRobin","bunchOfGames","knockout"];return e.showPlayerScoreHistory=function(t){return!i.contains(e.getAttribute(t,"eventType"))},e.hasMatches=function(t){return e.isTeamEvent(t)||e.isKnockoutEvent(t)},e.getTeamResultsForRound=function(t,n,i){var r=e.getTeamResults(t,n,i),o=e.getTeamResults(t,n,i-1);return Object.map(r,function(e,t){return Math.max(0,e-o[t])})},e.getTeamResults=function(t,n,i){var r={wins:0,loses:0,draws:0,mp:0,bp:0},o=e.getAttribute(t,"teams");if(!o||!o[n])return r;if("live"===i)i=parseInt(e.getAttribute(t,"currentRound"),10);else if("round"===i&&(i=parseInt(e.getAttribute(t,"currentRound"),10)-1,0===i))return r;return o[n].results&&o[n].results.rounds[i]?o[n].results.rounds[i]:r},e.getAllGamesForAPlayer=function(t,n){var i=e.getRounds(t),r=[];return Object.forEach(i,function(e,t){Object.forEach(e.matches,function(i,o){Object.forEach(i.games,function(i,a){!i.player||i.player.white!=n&&i.player.black!=n||r.push(Object.extend({roundLabel:e.label,roundId:t,matchId:o,gameId:a},i))})})}),r},e.getPlayerResults=function(t,n,i){var r={games:0,p:0},o=e.getAttribute(t,"players");if(!o||!o[n])return r;if("live"===i)i=parseInt(e.getAttribute(t,"currentRound"),10);else if("round"===i&&(i=parseInt(e.getAttribute(t,"currentRound"),10)-1,0===i))return r;return o[n].results?o[n].results.rounds[i]?o[n].results.rounds[i]:o[n].results.rounds[Object.keys(o[n].results.rounds).pop()]||r:r},e.getAllPlayersPoints=function(t,n){var i=e.getAttribute(t,"players"),r=e.getAttribute(t,"rounds");return"live"===n?n=parseInt(e.getAttribute(t,"currentRound"),10):"round"===n&&(n=parseInt(e.getAttribute(t,"currentRound"),10)-1),r[n]?Object.map(i,function(e){if(e.results){if(e.results.rounds[n])return e.results.rounds[n].p;var t=Object.keys(e.results.rounds).pop();return e.results.rounds[t]&&e.results.rounds[t].p||0}return 0}):Object.map(i,function(){return 0})},e.findPlayersGame=function(n,i,r){if(t[n]&&(r||(r=e.getAttribute(n,"currentRound")))){var o=e.getAttribute(n,"rounds")[r];if(o)for(var a in o.matches)for(var s in o.matches[a].games)if(o.matches[a].games[s].player.white==i||o.matches[a].games[s].player.black==i)return o.matches[a].games[s].gameStatus.endedBy?o.matches[a].games[s].gameStatus.endedBy:{roundId:r,matchId:a,gameId:s}}},e.remove=function(e){},e.set=function(e){},e.unset=function(e){},Controller.BroadcastTournament.instance=e},"undefined"==typeof Controller)var Controller={};!function(){var e="/api/web/ChessDatabaseAPI/",t="move position.highlights position.glyph position.comment currentGameChanged meta replaceChessGame movedPositionPointer.start",n="movedPositionPointer",i="game-broadcast-engine",r=["timeGoneSinceLastMove","endOfMainlineMoveMadeAt"];Controller.ChessDB=function(o,a){function s(){if(H=new Chess.GameHandler,d(),O){var e=A&&window.location.hash.replace("#","")||void 0;c(Chess.couchToGame(O),e),O.meta&&O.meta.Black&&O.meta.Black.UUID==config.user().uuid&&H.emit("flipBoard")}else c();return window.settings.on("settings."+i,l),l(),D}function l(){o.find(".chessDB").toggleClass("engineVisible",window.settings.getBoolean(i))}function c(e,t,n){e=e||new Chess.Game,void 0!==t?e.gotoId(parseInt(t,10)):e.gotoStart(),H.addGame(void 0,e),H.setCurrentGame(e),H.setMoveMode(ce).setDeleteMode(ce),oe.meta.setTags(n||[]).refresh();var i=e.getMeta();i.Title||i.White&&i.White.Name&&i.Black&&i.Black.Name&&(i.Title=window.t("{white}{whiteelo} vs. {black}{blackelo}",{"{white}":i.White.Name,"{black}":i.Black.Name,"{whiteelo}":i.White.Elo?" ("+i.White.Elo+")":"","{blackelo}":i.Black.Elo?" ("+i.Black.Elo+")":""}),e.setMeta("Title",i.Title)),B(),re.name.text(i.Title||""),y()}function d(){re.tabs=o.find(".radioTabs"),re.evalIndicator=o.find(".evalIndicator"),re.evalIndicatorTooltip=o.find(".evalindicatorTooltip .cTooltipRight"),re.chessBoard=o.find(".chessBoard"),re.cursor=o.find(".cursor"),re.notationArea=o.find(".notationTableMoveTreeSwitch .notationTable"),re.moveTree=o.find(".notationTableMoveTreeSwitch .moveTree"),re.settings=o.find(".gameControlsContainer .settings"),re.downloadPgn=o.find(".gameControlsContainer .downloadPgn"),re.downloadForm=o.find("form[name=pgn]"),re.boardXLButton=o.find(".btnBiggerBoard"),re.flipBoard=o.find(".gameControlsContainer .flipBoard"),re.engineLines=o.find(".engineLines"),re.playPosition=o.find(".playPosition"),re.tabDatabaseMoves=o.find(".tabDatabaseMoves > .databaseMovesWithScroller"),re.tabDatabaseGames=o.find(".tabDatabaseGames > .databaseGamesList"),re.autoPlayButton=o.find(".btnAutoPlay"),re.tabGamesEngine=o.find(".tabGamesEngine"),re.tabFraud=o.find(".tabFraud"),re.name=o.find(".analysisName"),re.coachingSettings=o.find(".coachingSettings"),re.coachingStart=o.find(".startCoaching"),re.chat=o.find(".tabContainer.tabChat .chatContainer"),re.chatTab=o.find(".tabContainer.tabChat").detach(),re.upload=o.find(".uploadControls input:file"),re.meta=o.find(".gameMeta");var e=o.find(".notationTableMoveTreeSwitch .tabContent");o.find(".notationTableMoveTreeSwitch input[type=radio]").on("change",function(){var t=jQuery(this).siblings(".tabContent"),n=e.not(t);t.trigger("chess24:show"),n.trigger("chess24:hide")}),u(),h(),g(),re.chatTab.find("> label").on("click",function(){I.queue=[],P()}),f(),H.on(t,function(e,t){"move"===e.currentChannel&&t instanceof Chess.Position&&(t.timeUsage=0),ee.removeClass("disabled"),Z.removeClass("disabled"),v()}),H.on(n,v)}function u(){if(re.evalIndicator.length&&(oe.evalIndicator=new View.EvalIndicator(re.evalIndicator,re.evalIndicatorTooltip).link(H)),re.chessBoard.length&&(oe.chessBoard=new View.ChessBoard(re.chessBoard).link(H),oe.chessBoard.attachKeyboardHandler(),Handler.KeyboardDispatcher.add(oe.chessBoard.getKeyboardHandler(),o.find(".chessGame"))),re.cursor.length&&(oe.cursor=new View.Cursor(re.cursor,!1,void 0,!0).link(H)),re.notationArea.length&&(oe.notationArea=new View.NotationArea(re.notationArea,"analyse").link(H),re.notationArea.suspendResume(oe.notationArea)),re.moveTree.length){var e=new View.ChessDBMoves(re.moveTree,["move","count","avgEloPlayer","percent"]).link(H);re.moveTree.suspendResume(e)}if(re.meta.length&&(oe.meta=new View.MetaEditor(re.meta,!0).setTags([]).link(H),re.meta.parent().suspendResume(oe.meta),oe.meta.on("change",function(){Z.removeClass("disabled"),ee.removeClass("disabled")}),oe.meta.on("click",function(e,t){w(t)})),re.flipBoard.length&&(oe.flipBoard=new View.FlipBoard(re.flipBoard).link(H)),re.engineLines.length&&(oe.engineLines=new View.Engine(re.engineLines).link(H)),re.tabDatabaseMoves.length){var t=new View.ChessDBMovesWithSelector(re.tabDatabaseMoves).link(H);re.tabDatabaseMoves.parent().suspendResume(t)}if(re.tabDatabaseGames.length){var n=new View.ChessDBGames(re.tabDatabaseGames,t||void 0).link(H);re.tabDatabaseGames.parent().suspendResume(n)}if(re.autoPlayButton.length&&(oe.autoPlay=new View.AutoPlay(re.autoPlayButton).link(H).link(oe.chessBoard.movementHandler)),re.tabGamesEngine.length){var i=new View.EngineGroup(re.tabGamesEngine,["Engine"]);re.tabGamesEngine.suspendResume(i),i.link(H)}re.tabFraud.length&&re.tabFraud.suspendResume(new View.FraudReport(re.tabFraud,void 0,A)),re.boardXLButton.length&&(oe.boardXL=new View.BoardXL(re.boardXLButton))}function h(){re.settings.length&&re.settings.on("click",function(){new Dialog.PlayzoneSettings(void 0,"broadcast").getContent().modal("show")}),re.downloadPgn.length&&re.downloadPgn.on("click",function(){return config.level().isPremium?(re.downloadForm.find("input[name=game]").val(JSON.stringify(Chess.gameToCouch(H.getCurrentGame()))),void re.downloadForm.get(0).submit()):void Dialog.conversionGoPremium("pgnDownload")}),re.playPosition.length&&re.playPosition.on("click",function(){var e={fen:H.toString()};new Dialog.Engine(e)}),R=o.find(".setupPosition a"),V=o.find(".importPgn a"),F=o.find(".pastePgn a"),z=o.find(".importGame a"),U=o.find(".shareSession"),W=o.find("a.cIconCoaching.start"),q=o.find("a.cIconCoaching.stop"),J=o.find("a.cIconCoachingActive"),K=o.find("a.stopViewing"),X=o.find(".promoteMove a"),Y=o.find(".deleteMove a"),$btnReplace=o.find(".replaceMove a"),Z=o.find(".newSession"),ee=o.find(".saveSession"),te=o.find(".loadSessions"),Z.on("click",function(){Z.hasClass("disabled")||(re.tabFraud.length&&re.tabFraud.closest(".customTabs").trigger("chess24:remove",re.tabFraud.attr("id")),de=void 0,ue=!1,G=void 0,c(),B(Z.data("url")),Z.addClass("disabled"))}),R.on("click",function(){Dialog.setupPosition(D.setCurrentGame,H.toString())}),V.on("click",function(){if(!config.level().isPremium)return void Dialog.conversionGoPremium("analysisMode");if(!V.is(".disabled"))return o.find(".uploadControls input:file").click(),!1}),F.on("click",function(){return config.level().isPremium?void(F.is(".disabled")||Dialog.prompt({title:window.t("Paste PGN"),message:window.t("Please paste the content of your PGN file into the box below"),input:"long"}).done(function(e){ne=new Dialog.Games({pgn:!0}),ne.loading(!0).show(),setTimeout(function(){var t=e.replace(/[\r\t]/g,"").split(/\n\n\[/g).map(function(e,t){try{return Chess.gameToCouch(Chess.pgnToGame((t&&"["||"")+e))}catch(n){return void 0}}).filter(function(e){return!!e});ne.loading(!1).addTags().addGames(t).selectAll().on("select",function(e,t){p(t.games||[],t.tags||[]),ne.hide()})},500)})):void Dialog.conversionGoPremium("analysisMode")}),z.on("click",function(){function e(e){ne.setupInfiniteLoading({url:"/api/web/ChessDatabaseAPI/getPlayzoneGames"+(e?"?username="+e:""),array:"games",onstart:function(){ne.loading(!0).emptyMessage(!1)},onerror:function(){ne.loading(!1).emptyMessage(!0)},onload:function(e){ne.loading(!1).addGames(e.data.games)}})}return config.level().isPremium?void(z.is(".disabled")||(ne=new Dialog.Games({playzone:!0}),ne.show().on("select",function(e,t){t.games&&t.games[0]&&jQuery.getJSON("/api/web/ChessDatabaseAPI/getPlayzoneGame",{gameSessionToken:t.games[0].gameSessionToken}).done(function(e){c(Chess.couchToGame(e.data.game)),ne.hide()})}).on("search",function(t,n){e(n.pattern)}),e())):void Dialog.conversionGoPremium("analysisMode")}),ee.on("click",function(){ee.hasClass("disabled")||b()&&ee.addClass("disabled")}),te.on("click",function(){w()}),X.on("click",function(){se||X.is(".disabled")||H.promote()}),Y.on("click",function(){se||Y.is(".disabled")||H.deleteMove()}),$btnReplace.on("click",function(){var e=oe.chessBoard.movementHandler.getReplaceMode();oe.chessBoard.movementHandler.setReplaceMode(!e),$btnReplace.parent().toggleClass("active",!e)}),U.on("click",function(){de&&!ue&&new Dialog.AnalysisShare(de)}),jQuery.fn.shareButtons("filter",function(e){de&&!ue?Dialog.AnalysisShare.togglePublic(de,!0,function(){e&&e()}):e&&e()}),W.on("click",function(){if(!N&&!W.is(".disabled")){if(!config.level().isPremium)return void Dialog.conversionGoPremium("analysisMode");L=Chess.gameToCouch(H.getCurrentGame(),r),notificationHandler.sendMessage("coaching.start",{chessGame:L,knotId:H.getCurrentPosition().knotId},function(e){if(D.subscribe(e,!0),e){var t=W.data("url");if(t){G=window.location.href;var n=Handler.Template.renderString(t,{username:config.user().permalink,uuid:e});window.history.pushState({},"coaching",n)}Dialog.alert({content:window.t("Coaching session started")}),W.hide(),q.show()}})}}),q.on("click",function(){N&&ae&&(notificationHandler.sendMessage("coaching.stop",{uuid:N},j),W.show(),q.hide())}),K.on("click",function(){N&&!ae&&j()}),J.on("click",function(){N&&ae&&T(N,function(e){new Dialog.Coaching(N,e)})});var e=o.find("a.draw").on("click",function(){var t=jQuery(this);if(!t.is(".disabled")){var n=t.data("mode");switch(t.parent().is(".active")&&["red","blue","green","yellow","erase"].contains(n)&&(t=e.filter("[data-mode=off]"),n="off"),n){case"red":case"blue":case"green":case"yellow":oe.chessBoard.movementHandler.deactivate(),oe.chessBoard.highlightHandler.startDrawing(n);break;case"erase":oe.chessBoard.movementHandler.deactivate(),oe.chessBoard.highlightHandler.startEraser();break;case"clear":return void H.setHighlights([]);case"off":oe.chessBoard.highlightHandler.isDrawing()&&(oe.chessBoard.highlightHandler.stopDrawing(),oe.chessBoard.highlightHandler.stopEraser(),oe.chessBoard.movementHandler.activate());break;default:return}e.parent().removeClass("active"),t.parent().addClass("active")}});$(document).on("keydown",function(e){var t="";switch(console.log(e),e.keyCode){case Handler.Keyboard.keys.VK_SHIFT:t="green";break;case Handler.Keyboard.keys.VK_CTRL:t="blue";break;case Handler.Keyboard.keys.VK_ALT:t="red";break;case Handler.Keyboard.keys.VK_CAPS:t="yellow";break;default:return}oe.chessBoard.movementHandler.deactivate(),oe.chessBoard.highlightHandler.startDrawing(t)}),$(document).on("keyup",function(){oe.chessBoard.highlightHandler.isDrawing()&&(oe.chessBoard.highlightHandler.stopDrawing(),oe.chessBoard.highlightHandler.stopEraser(),oe.chessBoard.movementHandler.activate())})}function f(){re.upload.on("chess24:add",function(){V.addClass("disabled").data("label",V.html()).html(window.t("Importing...")),ne=new Dialog.Games({pgn:!0}),ne.loading(!0).show()}).on("chess24:done",function(e,t){V.removeClass("disabled").html(V.data("label"));var n=m(t),i=n&&[n]||void 0,r=t.result.data.result&&t.result.data.result.map(function(e,t){return e.chessGame});return 1==r.length?(ne.hide(),void p(r,i)):void ne.loading(!1).addTags(i).addGames(r).selectAll().on("select",function(e,t){ne.hide(),p(t.games||[],t.tags||[])})}).on("chess24:error",function(){V.removeClass("disabled").html(V.data("label")),ne.loading(!1).emptyMessage(!0)})}function p(t,n){var i={id:ue?void 0:de,csrf:config.csrf(),games:JSON.stringify(t),tags:n&&JSON.stringify(n)||null};jQuery.post(e+"saveSession",i).done(function(e){e.data.id?(de=e.data.id,ue=!1,c(Chess.couchToGame(t[0])),B(e.data.url)):Dialog.alert(window.t("Import is finished, you can find all imported games in the list of your sessions."))})}function m(e){if(e.result.data.result){var t=e.result.data.result.map(function(e){return e.chessGame&&e.chessGame.meta&&e.chessGame.meta.Event||""}).unique();if(1===t.length&&t[0])var n=t[0]}return!n&&e.files&&e.files[0]&&e.files[0].name&&(n=e.files[0].name),n}function g(){function e(e){re.name.empty().append(e).removeClass("editing"),y(),n=!1,H.setMeta("Title",e)}function t(e){re.name.empty().append(e).removeClass("editing"),y(),n=!1}var n=!1;y(),re.name.on("click",function(){if(!n){n=!0;var i=re.name.is(".placeholder")?"":re.name.text(),r=jQuery('<input type="text" maxlength="100"/>').val(i).on("keyup",function(n){13===n.which?e(r.val().sanitize()):27===n.which&&t(i)}).on("blur",function(){e(r.val().sanitize())});re.name.empty().append(r).addClass("editing"),r.focus()}}),re.name.on("setname",function(t,n){e(n)})}function v(){var e=H.getCurrentPosition();Y.toggleClass("disabled",e===H.getStartPosition()),X.toggleClass("disabled",e.isInMainline())}function y(){re.name.text().trim()?re.name.removeClass("placeholder"):re.name.html(re.name.data("placeholder")).addClass("placeholder")}function b(){if(config.level().isGuest)return Dialog.conversionRegister("analysis"),!1;var t=oe.meta.getTags(),n={id:de&&ue?void 0:de,csrf:config.csrf(),game:JSON.stringify(Chess.gameToCouch(H.getCurrentGame())),tags:t&&JSON.stringify(t)||void 0};return jQuery.post(e+"saveSession",n).done(function(e){de=e.data.id,ue=!1,B(e.data.url)}),!0}function w(t){function n(n){o={},n&&(t=void 0,ne.setCurrentTag()),ne.switchToGames().setupInfiniteLoading({url:e+"getSessions"+(n?"?pattern="+n:"")+(t?"?tag="+t:""),array:"sessions",onstart:function(){ne.loading(!0).emptyMessage(!1)},onerror:function(){ne.loading(!1).emptyMessage(n?"search":"general")},onload:function(e){ne.loading(!1),i=e.data.url;var t=ne.countRendered(),r=e.data.sessions.map(function(e,n){return o[e.id]=e,{disabled:!config.level().isPremium&&t+n>2,date:e.gameStartedAt,name:e.meta.Title,fen:e.moves&&e.moves[e.moves.length-1].fen||void 0,"public":e["public"],id:e.id}});ne.addGames(r),ne.countRendered()||ne.emptyMessage(n?"search":"general")}})}var i,r="",o={};return config.level().isGuest?void Dialog.conversionRegister("analysis"):(ne=new Dialog.Games({sessions:!0}),ne.setCurrentTag(t).show().on("alltags",function(){jQuery.getJSON(e+"allTags",function(e){ne.switchToTags(e.data.tags)})}).on("allgames",function(){t=void 0,ne.setCurrentTag().switchToGames(),n()}).on("search",function(e,t){var i=t.pattern;i!=r&&(r=i,n(i))}).on("select",function(e,t){var n=t&&t.games&&t.games[0]&&o[t.games[0].id];if(n){if(t.games[0].disabled)return void Dialog.conversionGoPremium("analysisMode");de=n.id,ue=!1;var r=Handler.Template.renderString(i,{id:de});B(r),c(Chess.couchToGame(n),0,n.tags),ne.hide(),ee.addClass("disabled")}}).on("delete",function(t,n){var i={id:n.id,csrf:config.csrf()};jQuery.post(e+"deleteSession",i).done(function(){ne.deleteGame(n.id)})}).on("newgame",function(){c(),ne.hide(),ee.removeClass("disabled"),Z.addClass("disabled"),de=void 0,ue=!1}).on("tag",function(e,i){t=i&&i.tag||void 0,ne.switchToGames(),n()}),void n())}function k(e,t){function n(){var e=Chess.gameToCouch(H.getCurrentGame(),r),t=Object.diff(L,e);Object.getLength(t)>0&&(L=e,notificationHandler.sendMessage("coaching.update",{uuid:N,data:t}))}ae?setTimeout(n):T(N,function(e){e.get("coaching").restrictions.game||n()})}function x(){function e(){T(N,function(e){e.get("coaching").knotId!=H.getCurrentPosition().knotId&&notificationHandler.sendMessage("coaching.goto",{knotId:H.getCurrentPosition().knotId,uuid:N})})}ae?setTimeout(e):T(N,function(t){t.get("coaching").restrictions.move||e()})}function C(e,t){clearTimeout(C.timeout),C.timeout=setTimeout(function(){var n=_(),i=Chess.chessGameDiff(H.getCurrentGame(),n.getCurrentGame());Chess.gamePatch(H,i),L=Chess.gameToCouch(H.getCurrentGame(),r),"meta"===e.currentChannel&&t.diff&&t.diff.Title&&re.name.trigger("setname",t.diff.Title)})}function j(){H.off(t,k),H.off(n,x);var e=_();e.off(t,C),N=void 0,ae=!1,Q({game:!1,engine:!1}),G&&window.history.replaceState({},"analysis",G),o.find(".chessDB").removeClass("coachingViewer coachingAuthor")}function T(e,t){if(T.instances=T.instances||{},T.instances[e])return void setTimeout(function(){t(T.instances[e])});var n={rkey:"model:CoachingChessGameRedisAR:"+e},i=Handler.socket.getSocket(Handler.socket.types.NOTIFICATION),r=new Record.ChessGameSocketPR(n,i,function(){T.instances[e]=r,t(r)},notificationHandler.getTimeOffset())}function _(){return _.instance||(_.instance=new Chess.GameHandler),_.instance}function S(e){e?(o.find(".chessDB").addClass("withChat"),re.chatTab.prependTo(re.tabs),chatHandler.addChat(re.chat,e,{viewId:"coachingchat"}),notificationHandler.on("chat",I)):(re.chat.is(":visible")&&re.tabs.find(":radio:last").prop("checked",!0),o.find(".chessDB").removeClass("withChat"),chatHandler.removeChat(e,"coachingchat"),re.chatTab.detach(),notificationHandler.off("chat",I))}function I(e,t){if(I.queue=I.queue||[],re.chatTab.find("> input").is(":checked"))I.queue=[];else if("message"===t.content.type){var n=t.content.data.message.id;I.queue.contains(n)||(I.queue.push(n),P(I.queue.length))}}function P(e){var t=re.chatTab.find("> label").removeClass("highlighted"),n=re.chatTab.find("> input"),i=t.find("> span");i.find(".notiBox").remove(),e>0&&!n.is(":checked")&&(t.addClass("highlighted"),i.append(jQuery('<span class="notiBox">'+e+"</span>")))}function M(){Q({premium:!1,whiteList:[],blackList:[],game:!1,position:!1,engine:!1})}function Q(e){e&&Object.forEach(e,function(e,t){switch(t){case"annotations":e?$("div.notationTableInlineElement").hide():$("div.notationTableInlineElement").show();break;case"game":e&&!se?(oe.chessBoard.movementHandler.deactivate(),oe.chessBoard.highlightHandler.stopDrawing(),oe.chessBoard.highlightHandler.stopEraser(),oe.notationArea.setUserCommentWritePermission(!1),oe.meta.toggleEdit(!1),o.find(".draw, .promoteMove a, .deleteMove a").addClass("disabled"),o.find(".draw").parent().removeClass("active"),o.find(".promoteMove, .deleteMove").hide(),H.setMoveMode(le).setDeleteMode(le)):!e&&se&&(oe.chessBoard.highlightHandler.stopDrawing(),oe.chessBoard.highlightHandler.stopEraser(),oe.chessBoard.movementHandler.activate(),oe.notationArea.setUserCommentWritePermission(!0),oe.meta.toggleEdit(!0),o.find(".draw, .promoteMove a, .deleteMove a").removeClass("disabled"),o.find(".draw[data-mode=off]").parent().addClass("active"),v(),H.setMoveMode(ce).setDeleteMode(ce)),se=!!e;break;case"engine":e?window.settings.setOverride(i,!e):window.settings.removeOverride(i);break;case"premium":e&&!config.level().isPremium&&j();break;case"whiteList":e&&e.length&&!e.contains(config.user().uuid)&&j();break;case"blackList":e&&e.contains(config.user().uuid)&&j()}})}function B(e){U.toggleClass("disabled",!de||ue),e&&(N?replaceUrl=e:window.history.pushState({},"analysis",e))}function E(e){E.queue=E.queue||[],window.settings.getBoolean("analysis-list-mode")?E.queue.push(e):e()}var O=a.initialGame,A=a.gameSessionToken,D=this;o=jQuery(o);var H,N,L,G,R,V,F,z,U,W,q,K,J,X,Y,Z,ee,te,ne,ie=new Handler.Template("database").append(new Handler.Template),re={},oe={},ae=!1,se=!1,le={duringGame:{mainline:!1,sideline:!1},afterGame:{mainline:!1,sideline:!1}},ce={duringGame:{mainline:!0,sideline:!0},afterGame:{mainline:!0,sideline:!0}},de=a.analysisId,ue=de&&!a.own;return D.setCurrentGame=function(e){!e instanceof Chess.Game||c(new Chess.Game({fen:e.toString(),meta:{Title:H.getMeta().Title}}))},D.subscribe=function(e,i){var a=_();notificationHandler.sendMessage("coaching.listen",{uuid:e},function(i){return i?void T(e,function(i){N=e;var s=i.get("coaching"),l=i.get("chessGame");return a.addGame(void 0,i.get("chessGame")),a.setCurrentGame(i.get("chessGame")),_.instance.on(t,C),c(Chess.couchToGame(Chess.gameToCouch(l,r))),H.gotoId(s.knotId||0),S(s.chatRoomId),s.closedAt?(j(),void Dialog.alert({content:window.t("Coaching session is over"),comment:window.t("If you want to be able to revisit it later, save it using the button on top")})):(i.on("set.coaching",function(e,t){t.diff&&(void 0!==t.diff.knotId&&H.getCurrentPosition().knotId!==t.diff.knotId&&H.gotoId(t.diff.knotId),void 0!==t.diff.chatRoomId&&S(t.diff.chatRoomId),ae||(t.diff.closedAt&&(j(),M(),Dialog.alert({content:window.t("Coaching session is over"),comment:window.t("If you want to revisit it later, you can save it using the button on top")})),setTimeout(function(){Q(i.get("coaching").restrictions)},50)))}),s.author.uuid===config.user().uuid?(ae=!0,o.find(".chessDB").addClass("coachingAuthor"),oe.meta.toggleEdit(!0)):(Q(s.restrictions),$("div.notationTableInlineElement .deleteComment").hide(),o.find(".chessDB").addClass("coachingViewer"),o.find(".coachingViewerSettings .ownerInfo").html(ie.render("coachingAuthor",s.author))),H.on(t,k),H.on(n,x),q.show(),void W.hide())}):void Dialog.alert(window.t("This coaching session is not available"))})},window.settings.on("settings.analysis-list-mode.off",function(){for(;E.queue&&E.queue.length;)E.queue.shift()()}),s()}}(),"undefined"==typeof Controller&&(Controller={}),Controller.ELearning=function(e,t,n){function i(e){for(var t=0;t<d[e].length;t++)d[e][t].funcCall(c);return c}function r(){return m.show(),p.children(".startButton").click(o),p.centerScreen(),p.show(),c}function o(){return m.hide(),p.hide(),g.show(),c.stopWatch&&c.stopWatch.start(),i("start"),c}function a(e,t){function n(o){jQuery.post(y,t).done(function(t){if(clearTimeout(i),t=t.data.badges,Array.isArray(t)&&0!==t.length){r.empty(),r.css("background-image","none");for(var n=0;n<t.length;n++){var o=jQuery('<img src="'+t[n].img+'" alt="" />'),a=jQuery("<p>"+t[n].dscr+"</p>"),s=jQuery("<h3>"+t[n].title+"</h3>");r.append(jQuery("<div/>").append(s).append(o).append(a))}}else r.hide();e.children(".feedbackButton").show()}).fail(function(e,a,s){5>o?i=setTimeout(function(){n(++o)},5e3):r.hide(),errorHandler.msg("critical",new Error("save failed for exercise"),!1,{data:t,nr:o,textStatus:a,errorThrown:s})})}var i,r=e.children(".badgeAchieved");return n(0),c}function s(e,n,i){m.show(),e.children(".subLessonProgressBar").progressbar({value:Math.floor(t.progress.completed/t.progress.total*100)}),e.children(".pointsGained").text(n),c.stopWatch&&(e.children(".timeLeft").text(c.stopWatch.getCurrentValue(!0)),e.children(".timeRun").text(c.stopWatch.getTimeRun(!0)));for(var r=0;r<i.length;r++)i[r].show();return e.centerScreen(),e.show(),e.children(".badgeAchieved").show(),c}function l(e){function t(){return l=s.runDown?s.init+c-Date.now():s.init+Date.now()-c,void 0!==s.stop&&(s.runDown?l<s.stop&&(l=s.stop):l>=s.stop&&(l=s.stop)),p}function i(){return clearTimeout(h),t(),r(),h=setTimeout(i,100),void 0!==s.stop&&(s.runDown?l<=s.stop&&p.stop():l>=s.stop&&p.stop()),p}function r(){return v.html(o(l)),l<s.timeBonus?f!==!0&&(f=!0,v.addClass("stopWatchNegative")):f!==!1&&(f=!1,v.removeClass("stopWatchNegative")),p}function o(e){if(0>e){var t="-";e=-1*e}else t="";if(2e4>e){e=Math.floor(e/100);var n=Math.floor(e/10),i=e%10;return t+n+"."+i}e=Math.floor(e/1e3);var r=Math.floor(e/60);return n=e%60,t+r+":"+(10>n?"0":"")+n}var a=!0,s={runDown:!1,init:0,timeBonus:0,stop:void 0};void 0!==n&&jQuery.extend(s,e);var l,c,d,u,h,f,p=this;return p.start=function(){return c=Date.now(),i(),p},p.stop=function(){return a&&(a=!1,d=Date.now(),u=d-c,clearTimeout(h),t()),l},p.getCurrentValue=function(e){return e?o(l):l},p.getTimeRun=function(e){return e?o(u):u},p}var c=this;c.container=e,c.containerWithoutHash=e.substr(1),""==c.container&&errorHandler.msg("critical",new Error("no container given"),!0);var d={start:[]},u=jQuery(c.container+"_donePerfect"),h=jQuery(c.container+"_doneGood"),f=jQuery(c.container+"_doneBad"),p=jQuery(c.container+"_intro"),m=jQuery(c.container+"_overlay"),g=jQuery(c.container+"_introAfterStart"),v=jQuery(c.container+"_stopWatch"),y="/api/web/campusSchoolAPI/saveExerciseResult";return"object"!=typeof t&&errorHandler.msg("critical",new Error("exerciseData not given"),!0,{exerciseData:t}),void 0===t.id&&errorHandler.msg("critical",new Error("exerciseData.id not given"),!0,{exerciseData:t}),0==p.length&&errorHandler.msg("critical",new Error("exercises has no intro text"),!0),0==u.length&&errorHandler.msg("critical",new Error("exercises has no perfect feedback"),!0),c.removeListener=function(e,t){for(var n=0;n<d[e].length;n++)if(d[e][n].funcCall===t){d[e].splice(n,1);break}return c},c.addListener=function(e,t,n){var i={funcCall:n,instanceOfClass:t};return d[e].push(i),c},c.getRandomPiece=function(e,t){if(t=t||["R","r","N","n","B","b","Q","q","K","k"],e=e||1,1>e){for(var n=[];n.length<e;)n.push(t.splice(Math.floor(Math.random()*e),1)[0]);return n}var i=Math.floor(Math.random()*t.length);return t[i]},c.exerciseComplete=function(e,n,i){e=e||!1,n=n||!1,i=i||!1;var r=[],o=0,l={exerciseId:t.id,activity_points:e,bonus_time:n,bonus_perfect:i};if(e)if(n===t.timeBonus.possible&&i===t.perfectBonus.possible)var d=u;else d=h;else d=f;return e&&t.progress.completed++,(e||t.solved.reached)&&(o+=t.solved.ap),n||t.timeBonus.reached?(o+=t.timeBonus.ap,r.push(d.children(".hasTimeBonus"))):r.push(d.children(".hasNoTimeBonus")),i||t.perfectBonus.reached?(o+=t.perfectBonus.ap,r.push(d.children(".hasPerfectBonus"))):t.perfectBonus.possible&&r.push(d.children(".hasNoPerfectBonus")),(i||t.perfectBonus.reached||n||t.timeBonus.reached)&&r.push(d.children(".hasBonus")),s(d,o,r),a(d,l),c},c.getRandomSquares=function(e,t,n,i){e=e||1,t=t||[],n=n||[],void 0===i&&(i=!0),e+t.length>64&&(errorHandler.msg("error",new Error("there are not enough squares"),!0,{amount:e,doNotUseThisFields:t}),e=64-t.length);for(var r=[],o=[],a=0,s=0;8>s;s++)for(var l=0;8>l;l++){var c=Chess.getSquare(s,l);-1===t.indexOf(c)&&o.push(c)}for(s=0;e>s;s++){if(a<n.length){var d=n[a++],u=o.indexOf(d);-1===u&&errorHandler.msg("critical",new Error("square you want is not possible"),!0,{possibleSquares:o,mustContain:n,squareComingFromContain:d})}else u=Math.floor(Math.random()*o.length);r.push(o[u]);var h=[];if(i)h.push(u);else{for(var f=-1;2>f;f++)for(var p=-1;2>p;p++){var m=o.indexOf(o[u].getNewSquare(f,p));-1!==m&&h.push(m)}h.sort(function(e,t){return t-e})}for(f=0;f<h.length;f++)o.splice(h[f],1)}return r},0!==v.length&&(c.stopWatch=new l(n)),r(),c},"undefined"==typeof Controller&&(Controller={}),Controller.LiveVideo=function(e,t){function n(){if(!f.length||!h.length)return l;var e="live"===window.location.hash.substring(1),t=h.find("div.list ul > li.live");return e&&t.length?t.first().trigger("click"):h.find("div.list ul > li.active").trigger("click",{autoPlay:!1}),
i(),o(),jQuery(window).on("resize",o),l}function i(){function e(e){e=e.split(","),jQuery("input.language").each(function(){var t=jQuery(this),n=t.val();e.contains(n)?t.prop("checked",!0):t.prop("checked",!1)})}function n(){var e=s.val(),t=i();return{query:e,languages:t}}function i(){var e=[];return c.each(function(t,n){var i=jQuery(n);i.prop("checked")&&e.push(i.val())}),e.join(",")}function o(e){if(e=e||{},e.query=e.query||"",e.languages=e.languages||i(),e.autoSelect=e.autoSelect||!1,!a||e.query!==a.query||e.languages!==a.languages){a=e;var n=h.find(".list .videoList");n.lazyload("reset").find("> ul").remove(),n.lazyload({url:b,data:{query:e.query,languages:e.languages,permalink:t,offset:0},distance:50,array:"liveVideos",onstart:function(){n.append(p)},onload:function(t){p.detach(),r(t.data,e.autoSelect),e.autoSelect=!1}})}}var a,s=h.find(".searchQuery"),l=h.find(".searchQueryClear"),c=h.find(".languageSelector input.language"),d=window.settings.get("live-video-languages");e(d);var u=Object.merge(n(),{autoSelect:!0});o(u),s.on("propertychange change click keyup input paste",function(){""===s.val().trim()?l.addClass("disabled"):l.removeClass("disabled");var e=n();o(e)}),c.on("change",function(){var e=n();window.settings.set("live-video-languages",e.languages),o(e)}),l.on("click",function(e){l.addClass("disabled"),s.val(""),o()})}function r(e,n){n=n||!1;var i=h.find(".list .videoList"),r=u.render("list",e),o=jQuery(r);o.find("li").add(o.filter("li")).on("click",function(){a(this)});var s=i.find("> ul");if(s.length?s.append(o.contents()):i.append(o),i.find(".showAge").showAge(),n){if(t)var l=!0,c=i.find("li.active");else l=!1,c=i.find("li").first();c.length&&a(c,{autoPlay:l})}}function o(){var t=jQuery(window).height()-200;e.css("min-height",t.toString()+"px").height(t)}function a(e,n){function i(){c=chatHandler.addChat(f.find("div.chat"),[v],{viewId:"liveVideo"}),d=v}if(e){n=n||{},n.autoPlay=n.autoPlay!==!1;var r=jQuery(e),o=r.data("title"),a=r.data("description"),l=r.data("provider-name"),p=r.data("account"),m=r.data("event");t=r.data("permalink");var g=r.data("video"),v=r.data("chatroom"),b=r.data("commentator"),w=r.data("commentator-user-uuid"),k=r.data("commentator-profile-url"),x=r.data("commentators-title"),C=r.data("language"),j=r.data("has-access"),T=!0;l!==y||m||(T=!1);var _=f.data("permalink");if(_!==t){var S=s(l,n.autoPlay);if(h.find("div.list ul > li.active span.active").hide(),h.find("div.list ul > li.active span.inactive").show(),r.find("div.startAt > span.inactive").hide(),r.find("div.startAt > span.active").show(),h.find("div.list ul > li").removeClass("active"),r.addClass("active"),f.data("permalink",t),f.find("div.details").html(u.render("details",{title:o,description:a,commentator:b,commentatorProfileUrl:k,commentatorUserUuid:w,language:C,commentatorsTitle:x})),f.find("div.description").html(u.render("description",{description:a})),History.pushState(null,"LiveVideo",u.render("url",{permalink:t})),!j)return f.find("div.premiumOverlay").show(),void f.find("div.iframe").hide();f.find("div.premiumOverlay").hide(),f.find("div.iframe").show().html(u.render("iframe."+l,{account:p,event:m,video:g,autoPlay:S,isVideo:T})),d?chatHandler.removeChat(d,"liveVideo",i):i();var I=f.find(".cIconInfo"),P=f.find(".description");P.hide(),I.on("click",function(){P.slideToggle()}),layout.userMiniprofile(f)}}}function s(e,t){if("boolean"!=typeof t)switch(e){case m:return!0;case g:return"1";case v:return!0;case y:return!0}switch(e){case m:return t.toString();case g:return t?"1":"0";case v:return t.toString();case y:return t.toString()}}var l=this;e=jQuery(e),0===e.length&&errorHandler.error(new Error("container not found in Controller.LiveVideo"),{container:e});var c,d,u=new Handler.Template("liveVideo").append(new Handler.Template),h=jQuery(e.children("div.navigation")),f=jQuery(e.children("div.current")),p=jQuery(u.render("commonLoader")),m="livestream",g="youtube",v="vimeo",y="twitch",b="/api/web/LiveVideoAPI/getLiveVideos";return n()},function(){function e(){function e(){j=new Handler.Template("playZone").append(new Handler.Template("colorHeader")),_=new Chess.GameHandler,n=E,O&&a("noGame",c),jQuery(".bodyContainer.liveTournament").length||jQuery("body").removeClass("broadcast").addClass("playZone"),Extend.Suspendable(E);var e=["soundView","clockTop","clockBottom"];return E.onSuspend(function(){I&&I.views&&e.forEach(function(e){I.views[e]&&I.views[e].suspend()})}),E.onResume(function(){I&&I.views&&e.forEach(function(e){I.views[e]&&I.views[e].resume()})}),window.settings.on("settings.game-blindfold",k),E}function r(e){function t(e,t){var n=_.getCurrentGame(),i=t.game;"s"===t.role?i.setMoveMode({duringGame:{sideline:!0,mainline:!1},afterGame:{sideline:!0,mainline:!1}}):(i.setMoveMode({duringGame:{sideline:!1,mainline:!0},afterGame:{sideline:!0,mainline:!1}}),_.emit("startPlayZoneGame",i),w(t.role),Handler.tracking("playzone","gameStart",i.getType())),i.setCheckForGameEnd(!1).setCalcTimeSpendInThisMove(!0).setNoTimeout(!1),i.link(_),g(T),!i.isOver()&&i.getMeta().GameUUID===n.getMeta().GameUUID&&t.role===i.getEndOfMainlinePosition().moveRight&&i.getDepth()+1===n.getDepth()&&i.getEndOfMainlinePosition().isLegalMove(n.getEndOfMainlinePosition().moveCoords)&&i.move(n.getEndOfMainlinePosition().moveCoords,i.getEndOfMainlinePosition(),void 0,void 0,"local"),n.destroy(),jQuery(".btnBiggerBoard").parent().show(),View.PlayButton.isPlaying(v),B&&"s"===t.role?w(t.game.getMeta().White.UUID===B?"w":"b"):Q&&"s"===t.role&&w("s"),Q&&Q.suspend(),x.role=t.role,k(),Q||a||C(i.getMeta())}function n(){_.emit("selfDisconnected")}function i(){_.emit("selfReconnected")}function r(e,t){if(t.gameSessionToken&&t.chessGame){var n=t.chessGame.moves&&Chess.couchToGame(t.chessGame)||new Chess.Game;n.setMeta(t.meta),n.setGameEndByPoints(t.whiteResult,t.blackResult,t.endedBy),n.link(_),_.setCurrentGame(n),I.views.board.setUserMoveRight(["b","w"]).attachKeyboardHandler(),n.setRules("analyse").setMoveMode({duringGame:{sideline:!0,mainline:!1},afterGame:{sideline:!0,mainline:!1}}),b(!n.getMeta().TournamentUUID,!0)}s("duringGame"),g(T),Q&&Q.resume()}if(void 0!==e&&void 0!==e.gameSessionToken&&void 0!==e.authToken){var a=!!e.broadcast;e.mode=e.mode||"analysis",e.role=e.role||"s",e.clock=e.clock||0,e.increment=e.increment||0,e.moveRight="s"!==e.role&&"analysis"!==e.mode?e.role:["w","b"],"b"===e.role?(e.upperRole="w",e.lowerRole="b"):(e.upperRole="b",e.lowerRole="w"),T&&conversationHandler.off("inGame."+T,y);var l=T=e.gameSessionToken;P&&l&&P.setGameSessionToken(l),conversationHandler.on("inGame."+T,y);var c=e.authToken;if(e.url=e.url||j.render("gameURL",{gameSessionToken:l}),D[e.gameSessionToken]=e,!Q||e.stream)var h=e.container?jQuery(e.container):jQuery("div.contentContainer > div.playZone");if(!h||0===h.length)return parseInt(jQuery("body").data("embed"),10)>0?(jQuery("<a/>").attr("href",e.url).css("display","none").attr("target","_blank").appendTo("body").get(0).click(),void setTimeout(function(){Dialog.alert(window.t('If the new window with the game did not open, please <a href="{url}" target="_blank">click here</a>',{"{url}":e.url}))},100)):window.location=e.url;if(void 0===I?I=d(h,e):(u(e),"human"!==e.mode||jQuery("body").data("embed")||Q||History.pushState(null,"PlayZone",e.url)),e.stream&&p(e.stream,e),jQuery("body").data("embed")&&(jQuery("body").removeClass("initial"),jQuery(".playNowContainer .playNowButton").fadeOut()),void 0!==S&&(I.views.disconnected&&I.views.disconnected.unlink(S),I.views.SpectatorList&&I.views.SpectatorList.unlink(S),S.disconnect().unlink(_).off()),"human"===e.mode&&(S=new Handler.Playing(l,c,e.playingServer),S.on("startGameSession",t).on("selfDisconnected",n).on("selfReconnected",i).on("gameSessionOver",r).on("gameSessionResults",o).link(_),void 0!==I.views.disconnected&&"s"!==e.role&&I.views.disconnected.link(S),void 0!==I.views.SpectatorList&&I.views.SpectatorList.link(S),b("s"===e.role&&!_.getMeta().TournamentUUID,"s"===e.role)),"analysis"===e.mode){var m=e.chessGame;m=Chess.couchToGame(m),m.setRules("analyse").setMoveMode({duringGame:{sideline:!0,mainline:!1},afterGame:{sideline:!0,mainline:!1}}).setCheckForGameEnd(!1).setCalcTimeSpendInThisMove(!0).setNoTimeout(!1).link(_),B&&"s"===e.role&&w(B===m.getMeta().White.UUID?"w":"b"),b(!0,!0),Q||a||C(m.getMeta())}if("standby"===e.mode?((new Chess.Game).link(_),b(!1,!1),Q||a||C()):f(l),"human"!==e.mode||"w"!==e.role&&"b"!==e.role)I.$containers.drawResignButtons.hide(),v=!1;else{I.$containers.drawResignButtons.show();var v=!0}I.views.board&&I.views.board.movementHandler&&I.views.board.movementHandler.setPremove(v?void 0:!1),A=e.role,g(T)}}function o(e,t){var n=t.getGameStatus(),i=D[T];if(i.chessGame=t,void 0!==n.endedBy){if(View.PlayButton.isPlaying(!1),I.views.board.attachKeyboardHandler(),t.hasEndedWithMove())var r=1e3;else r=0;if("w"===i.role||"b"===i.role?Dialog.playZone.afterTheGame(i).show(r):S.disconnect(),M&&M.modal("hide",!0),s("duringGame"),jQuery("body").data("embed")&&(jQuery(".poweredByChess24").attr("href",i.poweredByChess24),a("noGame",c),jQuery(".playNowContainer .playNowButton").fadeIn()),window.ga&&["w","b"].contains(i.role)){var o=n.result["w"===i.role?"white":"black"];o=1===o&&"won"||0===o&&"lost"||"draw",ga("send","event","playzone","gameEnd",o)}}return i.chessGame.setRules("analyse").setMoveMode({duringGame:{sideline:!0,mainline:!1},afterGame:{sideline:!0,mainline:!1}}),I.views.board.setUserMoveRight(["b","w"]),Q&&Q.resume(),b(I.$containers.spectatorList.is(":visible"),!0),E}function a(e,t){jQuery(document).on("click."+e,"a",t)}function s(e){jQuery(document).off("click."+e,"a")}function l(e){var n=this,i=jQuery(this),r=i.attr("href");return i.hasClass("noWarnOnLeave")?(e.preventDefault(),void c.apply(n,[e])):void(void 0!==r&&""!==r.trim()&&"#"!==r.trim()&&(e.preventDefault(),M=Dialog.confirmation(t("Are you sure you want to leave the game?"),function(){c.apply(n,[e])})))}function c(e){var t=jQuery(this),n=t.attr("href");void 0!==n&&""!==n.trim()&&"#"!==n.trim()&&(e.preventDefault(),jQuery("body").data("embed")?window.open(n):window.location.href=n)}function d(e,t){var n={},i={},r=t.template||"main";e.html(j.render(r,{isGuest:config.level().isGuest,permalink:config.user().permalink,stream:t.stream,broadcast:!!t.broadcast})),n.main=e,n.chessGame=e.find(".chessGame"),n.board=e.find(".chessBoard"),n.clockTop=e.find(".clocks .top"),n.clockBottom=e.find(".clocks .bottom"),n.capturedPiecesTop=e.find(".left .top .capturedPieces"),n.capturedPiecesBottom=e.find(".left .bottom .capturedPieces"),n.playerInfoTop=e.find(".top .playerInfo"),n.playerInfoBottom=e.find(".bottom .playerInfo"),n.gameInformation=e.find(".gameInformation"),n.notationTable=e.find(".notationTable"),n.cursor=e.find(".cursor"),n.disconnected=e.find(".disconnected"),n.spectatorList=e.find(".spectatorArea"),n.spectatorChat=e.find(".spectatorChat"),n.flipBoardButton=e.find(".burgerMenu .flipBoard"),n.settingsButton=e.find(".burgerMenu .settings"),n.playPositionButton=e.find(".burgerMenu .playPosition"),n.drawResignButtons=e.find(".drawResignButtons"),n.drawButton=e.find(".drawButton"),n.resignButton=e.find(".resignButton"),n.firstMoveTimeout=e.find(".secondsBeforeLosing"),n.afterGameControls=jQuery("<div/>"),n.reportGameButton=e.find(".reportGameButton"),n.autoPlayButton=e.find(".btnAutoPlay"),n.autoCommentator=e.find(".autoCommentator"),n.boardXLButton=e.find(".btnBiggerBoard"),n.bottomToggle=e.find(".bottomToggle"),n.chessGame.addClass(t.mode),n.chessGame.addClass(t.role);var o="b"!==t.role,a="s"===t.role||t.chessGame&&t.chessGame.gameStatus&&t.chessGame.gameStatus.endedBy,s=x();if(t.nonExclusiveView)i.board=new View.ChessBoard(n.board,!1,Handler.Highlight,!1).link(_);else{i.board=new View.ChessBoard(n.board,!0,Handler.Highlight,a).link(_).setUserMoveRight(t.moveRight).setBlindfold(s).flip(o);var l=i.board.getKeyboardHandler();l&&Handler.KeyboardDispatcher.add(l,e)}if(i.clockTop=new View.ChessClock(n.clockTop,t.upperRole).link(_),i.clockBottom=new View.ChessClock(n.clockBottom,t.lowerRole).link(_),n.capturedPiecesTop.length&&(i.capturedPiecesTop=new View.CapturedPieces(n.capturedPiecesTop,[t.lowerRole]).link(_)),n.capturedPiecesBottom.length&&(i.capturedPiecesBottom=new View.CapturedPieces(n.capturedPiecesBottom,[t.upperRole]).link(_)),i.playerInfoTop=new View.PlayerInfo(n.playerInfoTop,t.upperRole).link(_),i.playerInfoBottom=new View.PlayerInfo(n.playerInfoBottom,t.lowerRole).link(_),n.notationTable.length&&(i.notationArea=new View.NotationArea(n.notationTable,"playing").toggleExtension("PlayZoneChat",["w","b"].contains(t.role)).setBlindfold(s).link(_)),n.cursor.length&&(i.cursor=new View.Cursor(n.cursor,!1,void 0,!0).link(_)),n.flipBoardButton.length&&(i.flipBoardButton=new View.FlipBoard(n.flipBoardButton).link(_)),!t.nonExclusiveView&&(i.soundView=new View.Sound("playzone").setUserRole(t.role).link(_),n.autoCommentator.length)){var c=n.autoCommentator.find("input");c.prop("checked",window.settings.getBoolean("auto-commentator")),c.on("change",function(){window.settings.set("auto-commentator",c.prop("checked")?1:0)}),i.autoCommentator=(new View.AutoCommentator).link(_)}return t.nonExclusiveView||(i.pageTitle=(new View.PlayingPageTitle).setUserRole(t.role).link(_)),n.spectatorList.length&&(i.SpectatorList=new View.SpectatorList(n.spectatorList).link(_)),n.autoPlayButton.length&&i.board.movementHandler&&(i.autoPlay=new View.AutoPlay(n.autoPlayButton).link(_).link(i.board.movementHandler)),n.boardXLButton.length&&(i.boardXL=new View.BoardXL(n.boardXLButton)),n.settingsButton.on("click",function(){(new Dialog.PlayzoneSettings).getContent().modal("show")}),n.playPositionButton.on("click",function(){var e=_.getClockInformation(),t={clock:{white:e.runningUp?0:e.white.timeLeft,black:e.runningUp?0:e.black.timeLeft},increment:e.runningUp?0:e.white.incrementPerMove||e.black.incrementPerMove||0,fen:_.toString()};new Dialog.Engine(t)}),n.bottomToggle.on("click",function(){n.bottomToggle.is(".disabled")||b()}),n.drawButton.length&&(i.drawButton=new View.DrawButton(n.drawButton,function(){return A}).link(_)),n.resignButton.length&&(i.resignButton=new View.ResignButton(n.resignButton).link(_)),"human"!==t.mode||"w"!==t.role&&"b"!==t.role?n.drawResignButtons.show():n.drawResignButtons.hide(),n.disconnected.length&&("human"===t.mode||Q)&&(i.disconnected=new View.Disconnected(n.disconnected).link(_)),n.firstMoveTimeout.length&&(i.firstMoveTimeout=new View.FirstMoveTimeout(n.firstMoveTimeout).link(_)),h(t,n),i.board.adjust(),{$containers:n,views:i}}function u(e){void 0!==I.views.board&&I.views.board.setUserMoveRight(e.moveRight),void 0!==I.views.pageTitle&&I.views.pageTitle.setUserRole(e.role),void 0!==I.views.soundView&&I.views.soundView.setUserRole(e.role),void 0!==I.views.notationArea&&I.views.notationArea.toggleExtension("PlayZoneChat",["w","b"].contains(e.role)),I.$containers.chessGame.removeClass("analysis human").addClass(e.mode),I.$containers.chessGame.removeClass("b w s").addClass(e.role),I.views.boardXL&&I.views.boardXL.update(),w(e.role),h(e,I.$containers)}function h(e,t){function n(e){function t(e){var t={};return t.uuid=e.UUID?e.UUID:e.uuid,t.name=e.Name?e.Name:e.name,t}var n=[],i={},r={};if(e.chessGame&&e.chessGame.meta)i=t(e.chessGame.meta.White),r=t(e.chessGame.meta.Black);else if(e.stream&&e.stream.buffer)for(var o in e.stream.buffer){var a=e.stream.buffer[o];a&&a.gameSessionToken==e.gameSessionToken&&(i=t(a.data.player.white),r=t(a.data.player.black))}return config.user().uuid!==i.uuid&&n.push({name:i.name,uuid:i.uuid}),config.user().uuid!==r.uuid&&n.push({name:r.name,uuid:r.uuid}),n}"w"!==e.role&&"b"!==e.role||"human"!==e.mode||(s("noGame"),a("duringGame",l)),jQuery("body").data("embed")&&(e.poweredByChess24=jQuery(".poweredByChess24").attr("href"),jQuery(".poweredByChess24").attr("href",e.url)),users=n(e),t.reportGameButton.length&&t.reportGameButton.off("click.report").on("click.report",function(){Dialog.userReport({source:"playzone",referenceId:e.gameSessionToken,users:users})})}function f(e){if(I.$containers.spectatorChat.length){var t=I.$containers.spectatorChat.data("roomId");t&&chatHandler.removeChat(t);var n="playzone."+e;I.$containers.spectatorChat.data("roomId",n),chatHandler.addChat(I.$containers.spectatorChat,n)}}function p(e,t){function n(e){var t=e.data("href-"+config.language());t&&I.$containers.main.find(".topGamesLink").attr("href",t)}if(e.user)Q||(Q=new Handler.Stream("channel:gameSession:add:"+e.user,e).link(notificationHandler)),B=e.user;else if("topgames"==e.filter){switch(e.type="classic",e.eloType){case"1":case 1:e.type="bullet";break;case"2":case 2:e.type="blitz"}if(!Q){var i=["channel:gameSession:topgame:bullet","channel:gameSession:topgame:blitz","channel:gameSession:topgame:classic"];Q=new Handler.Stream(i,e).link(notificationHandler),Q.playzoneOption(Object.subset(t,["container","template","nonExclusiveView"]));var r=I.$containers.main.find(".playzoneStreamGameTypes li");r.length&&(r.removeClass("active").filter("."+e.type).addClass("active").end().find("a").on("click",function(){var e=jQuery(this),t=e.closest("li");if(!e.is(".active")){var i=t.attr("class"),o=3;switch(i){case"bullet":o=1;break;case"blitz":o=2}r.removeClass("active"),t.addClass("active"),Q.option("eloType",o);var a=e.attr("href");return a&&History.pushState(null,null,a),n(e),!1}}),n(r.filter(".active").find("a")))}}}function m(){var e,t=_.getMeta(),n=config.user().uuid;return Chess.colors.both.metaData.some(function(i){return t[i].UUID&&t[i].UUID!==n?e=t[i].UUID:void 0}),e}function g(e){var t=m();e&&t&&(conversationHandler.blockInGameMessageNotificationsFrom(m()),conversationHandler.getConversationInGame(t,e,function(e){var t=e.messages;t&&t.forEach(v)}))}function v(e){_.addChat(e.user,e.content,e.timestamp,e.moveId)}function y(e,t){_.addChat(t.message.user.uuid,t.message.content,t.message.timestamp,t.context.moveId)}function b(e,t){void 0===e&&(e=!I.$containers.spectatorList.is(":visible")),void 0===t&&(t=!0),I.$containers.spectatorList.toggle(e),I.$containers.spectatorChat.toggle(e),I.$containers.bottomToggle.toggleClass("sortDesc",!e).toggleClass("sortAsc",e),I.$containers.bottomToggle.toggleClass("disabled",!t)}function w(e){("b"===e&&"b"!==A||"b"!==e&&"b"===A)&&(A="b"===A?"w":"b",jQuery(function(){_.emit("flipBoard")}))}function k(){var e=x();I.views.board.setBlindfold(e),I.views.notationArea&&I.views.notationArea.setBlindfold(e)}function x(){var e=window.settings.get("game-blindfold");return"own"===e?"b"===x.role?"black":"w"===x.role?"white":"none":e}function C(e){e=Object.copy(e),layout.safe(function(){jQuery(document).trigger("chess24:header",{template:"game",data:e})})}var j,T,_,S,I,P,M,Q,B,E=this,O=jQuery("body").data("embed"),A="w",D={},H=!1;return E.getCurrentGameSessionToken=function(){return T},E.getCurrentGameSession=function(){return D[T]},E.getCurrentGame=function(){return _.getCurrentGame()},E.playNow=function(e){if(!H){H=!0;var t=config.user().authToken;View.PlayButton.isLoading(!0),jQuery.ajax({type:"GET",url:i+"?authToken="+t}).done(function(n){var i=n.data.openGameSessions;if(n.data.isAllowed){if(0===i.length)Dialog.playZone.playNow(n.data).show(),void 0!==n.data.nextTournamentStartsAt&&(new Dialog.PlayZone).setTimeWarning(n.data.nextTournamentStartsAt+notificationHandler.getTimeOffset(),!!n.data.nextTournamentRunning),"function"==typeof e&&e();else if(i.length>0){var o={gameSessionToken:i[0].token,authToken:t,role:i[0].role,mode:"human",playingServer:{host:i[0].host,port:i[0].port}};if(i[0].tournamentUuid){var a=j.render("playzoneTournamentURL",{tournamentId:i[0].tournamentUuid,play:!0});return void(window.location=a+"#play")}r(o)}}else n.data.suspended?Dialog.alert(window.t("Playzone is temporarily disabled, please try again in a couple of minutes.")):Dialog.conversionRegister("playZone")}).always(function(){H=!1,View.PlayButton.isLoading(!1)})}},E.resetLayout=function(){if(!I)return E;for(var e in I.views)I.views[e].unlink&&I.views[e].unlink(_);return I=void 0,E},E.initGameSession=r,e()}"undefined"==typeof Controller&&(Controller={});var n,i="/api/web/playzoneAPI/playNow",r={},o="/api/web/NodeServerAPI/getPlayingServer";Controller.getPlayZone=function(){return void 0!==n?n:new e},Controller.getPlayingServer=function(e){var t=new Helper.Deferred;return r[e]?(t.resolve(r[e]),t.promise):(jQuery.ajax({type:"GET",url:o+(e?"?gameSessionToken="+e:"")}).done(function(n){r[e]=n.data.server,t.resolve(r[e])}).fail(function(e,n,i){t.reject(new Error("No playing server available ("+i+")"))}),t.promise)}}(),jQuery(function(){function e(e,t,n){var i=t?jQuery(t).parents(".userRegistrationLogin"):jQuery(".userRegistrationLogin");if(n=void 0!==n?n:!i.parent().hasClass("loginRegistrationPopup"),i&&!i.find("header a.active."+e).length){if(n){var r="chess24.com :: "+e.substring(0,1).toUpperCase()+e.substring(1);window.History.pushState({name:e},r,jQuery(t).attr("href"))}i.find("header a").removeClass("active"),i.find(".tabContent").removeClass("active"),i.find("form").validatable("clear"),i.find("header a."+e).addClass("active"),i.find(".tabContent."+e).addClass("active"),i.find(".tabContent.active input[type=text]:first").focus(),i.find('input[name="csrf"]').val(config.csrf())}}var t=$(".userMenu .expandingMenu");if(t.find(".linkSupport."+config.language()).show(),config.level().isGuest)t.find(".linkLogout").hide(),t.find(".linkProfile").hide();else{var n=config.user();t.find(".linkLogin").hide(),t.find(".linkRegister").hide(),t.find(".profile img").attr("src",n.image),t.find("a.profile").attr("href",n.url),t.find("span.name").html(n.name),config.level().isPremium&&t.find(".linkPremium").hide()}t.find(".loader").hide(),t.find(".profile").css("display","block"),t.show(),jQuery(".userRegistrationLogin").length&&(jQuery(".userRegistrationLogin header a.login").on("click",function(){return e("login",this),!1}),jQuery(".userRegistrationLogin header a.registration").on("click",function(){return e("registration",this),!1}),jQuery(".userRegistrationLogin .lost-password-link").on("click",function(){return e("lost-password",this),!1}),jQuery(window).bind("statechange",function(){var t=window.History.getState();t.data&&t.data.name&&e(t.data.name,null,!1)}),jQuery(".loginRegistrationPopup").modal({close:!0}),jQuery(".login-link").on("click",function(){return jQuery(".loginRegistrationPopup").length>0?(e("login"),jQuery(".loginRegistrationPopup input[name=returnUrl]").val(window.location.href),jQuery(".loginRegistrationPopup").modal("show").find(".tabContent.active input[type=text]:first").focus(),!1):void 0}),jQuery("body").on("click",".register-link",function(){return jQuery(".loginRegistrationPopup").length>0?(Handler.tracking("registration","interest"),e("registration"),jQuery(".loginRegistrationPopup input[name=returnUrl]").val(window.location.href),jQuery(".loginRegistrationPopup").modal("show").find(".tabContent.active input[type=text]:first").focus(),!1):void 0}))}),function(){function e(e,t){return t?(t=$(t),t.find(e).add(t.filter(e))):$(e)}function t(e){return e&&(e=$(e)),t.tooltipOnClick(e),t.userMiniprofile(e),t.formatTimeAgo(e),t.formatDateTime(e),t.icons(e),t.buttons(e),t.suggestField(e),t.dateTimePickers(e),t.timePickers(e),t.datePickers(e),t.inputElements(e),t.tabs(e),t.scrollableTables(e),t.simpleSlideshow(e),t.dropDown(e),t.OLD_DEPRECATED(),t}function n(e){return jQuery(e).filter("[data-multiple]").each(function(){var e=jQuery(this);if(!e.data("pattern-flexi")&&!e.hasClass("dontWrap")){if(e.hasClass("flexiWidth"))var t=e.outerWidth();e.attr("data-pattern-flexi",!0),e.parent().hasClass("flexiWrapThis")||e.parent().closest(".flexiWrapThis").length||e.addClass("flexiInputWrapperMain").wrap('<div class="flexiInputWrapper" style="width:'+t+'px"/>').before('<div class="flexiInputWrapperTop">&nbsp;</div>').after('<div class="flexiInputWrapperBot">&nbsp;</div>').on("focus blur",function(t){e.closest(".flexiInputWrapper")["focus"===t.type?"addClass":"removeClass"]("onFocus")})}}).end()}window.layout=t;var i=new Helper.Deferred;t.safe=function(e){i.promise.done(e)},t.tooltipOnClick=function(n){return e(".cTooltipBox.onClick",n).each(function(){var e=$(this);if(!e.data("tooltiponClick")){var t;e.on("click.initTooltipClick",function(n){e.closest(".cTooltipBoxContainer").length||(e.addClass("show"),e.is(".onClickPersistent.show")&&(t=t||jQuery(document).add(e.children()),t.one("click.initTooltipClick",function(n){e.removeClass("show"),t.off("click.initTooltipClick"),n.stopPropagation()})),n.stopPropagation())}),e.is(".onClickPersistent")||e.on("mouseleave.initTooltipClick",function(){e.removeClass("show")}),e.data("tooltiponClick",!0)}}),t},t.userMiniprofile=function(n){return e(".ofMiniProfile",n).addMiniprofile(),t},t.formatTimeAgo=function(n){return e(".formatTimeAgo[data-created]",n).showAge(),t},t.formatDateTime=function(n){return e(".formatDateTime[data-created]",n).showDateTime(),t},t.icons=function(n){return e(".cIcon.inactive",n).each(function(){var e=$(this);e.data("pattern-icon")||e.data("pattern-icon",!0).on("click.cIcon",function(e){e.preventDefault()})}),t},t.buttons=function(e){return jQuery("input.cBtn:button, input.cBtn:submit",e).each(function(){var e=jQuery(this);if(!e.data("pattern-button")){e.data("pattern-button",!0);var t=e.attr("class");e.removeClass(),e.attr("data-pattern-button",!0),e.wrap('<span class="inputButtonWrapper '+t+'"/>')}}),t},t.suggestField=function(i){return n(e(".cPattern[data-auto-suggest]",i)).suggestField(),t},t.dateTimePickers=function(n){return e("input[data-datetime]",n).each(function(){var e=$(this);if(!e.data("pattern-datetime")){e.data("pattern-datetime",!0);var n=0;e.data("timezone-offset-utc")&&(n=60*(parseInt(e.data("timezone-offset-utc"))+parseInt((new Date).getTimezoneOffset())));var i=$('<div class="cDatetimepickerWrapper"/>').insertBefore(e);e.next().data("field")===e.attr("name")&&i.append(e.next()),i.prepend(e);var r=$('<input data-date="true" class="cInputText" type="text"/>').insertAfter(e),o=$('<input data-time="true" class="cInputText" type="text"/>').insertAfter(r),a=parseInt(e.val());if(a){var s=new Date(1e3*(a+n)),l=s.getHours(),c=s.getMinutes();r.val(Math.round(s.getTime()/1e3)-3600*l-60*c),o.val(l+":"+(10>c?"0":"")+c)}t.datePickers(r),t.timePickers(o),o.add(r).on("changeTime changeDate change",function(){e.trigger("focus").trigger("change");var t=r.datepicker("getDate");if(!t)return void e.val("");var i=o.val().split(":"),a=2===i.length?3600*i[0]+60*i[1]:0;t=Math.round(t.getTime()/1e3),e.val(t+a-n)})}}),t},t.timePickers=function(n){return e("input[data-time]",n).each(function(){var e=$(this);if(!e.data("pattern-time")){e.attr("data-pattern-time",!0),e.addClass("cTimepicker"),e.wrap('<div class="cTimepickerWrapper" />'),$('<img class="cTimepickerIcon" src="'+config.assetDir()+'/images/img/icon_timepicker.png" alt="..." title="..." />').insertAfter(e),e.timepicker({timeFormat:"G:i"}),e.next("img.cTimepickerIcon").on("click",function(){e.timepicker("show")});var t=$("<a/>").addClass("cTimepickerClear").insertAfter(e).on("click",function(){e.val(""),t.hide(),e.trigger("changeTime")})[e.val()?"show":"hide"]();e.on("changeTime",function(){e.val()?t.show():t.hide()})}}),t},t.datePickers=function(n){return e("input[data-date]",n).each(function(){var e=$(this);if(!e.data("pattern-date")){e.attr("data-pattern-date",!0),e.wrap('<div class="cDatepickerWrapper"/>');var t=$('<input type="hidden"/>').attr("name",e.attr("name")).insertBefore(e),n=e.val();e.attr("name","").attr("autocomplete","off");for(var i=e.data("mysql"),r=e.attr("class").split(" "),o=0;o<r.length;o++)"validate["===r[o].substr(0,9)&&(e.removeClass(r[o]),t.addClass(r[o]));var a=$("<a/>").addClass("cDatepickerClear").insertAfter(e).on("click",function(){e.val(""),t.val("").trigger("change"),a.hide(),e.trigger("changeDate")})[e.val()?"show":"hide"]();$("nothing").validatable(),e.on("keyup change",function(){setTimeout(function(){var n=e.datepicker("getDate");n&&$.fn.validatable.validators.date({format:"dd/MM/yyyy"}).validateValue(e.val())?(n=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate())),e.parent().removeClass("inputError"),i?t.val($.datepicker.formatDate($.datepicker.ATOM,n)):t.val(n.getTime()/1e3),t.trigger("change"),a.show()):e.val()?(e.parent().addClass("inputError"),t.val(""),a.show()):a.hide(),e.trigger("changeDate",n.getTime()/1e3)},1)}),e.datepicker({dateFormat:"dd/mm/yy",changeMonth:!0,changeYear:!0,altField:t,showOn:"button",buttonImage:config.assetDir()+"/images/img/icon_datepicker.png",buttonImageOnly:!0,altFormat:$.datepicker.TIMESTAMP}),e.datepicker("setDate",e.val()?new Date(parseInt(e.val()+"000")):""),t.val(n)}}),t};var r=0;t.inputElements=function(n){return e("input.cPattern:text, input.cPattern:password, input.cPattern:file",n).each(function(){var e=$(this);if(!e.data("pattern-input")&&(e.data("pattern-input",!0),!e.closest("div[data-auto-suggest]").length)){var t="";"undefined"!=typeof e.attr("class")&&(t=" "+e.attr("class"));var n=$("<span/>").addClass(t).insertBefore(e).append(e).append(e.prevAll("input:hidden"));if(!e.closest("span").hasClass("inputTextWrapper"))if(e.hasClass("inputTextWithBtn")||e.is(":file")){var i=e.attr("data-inputbtn-class"),r="";"undefined"!=typeof e.attr("data-inputbtn-id")&&(r=e.attr("data-inputbtn-id"));var o=e.attr("title");if(n.addClass("inputTextWrapper inputTextWithBtn"),e.is(":file"))n.addClass("inputFileUpload"),n.append('<a class="cBtn cBtnWhite cBtnIconFileUpload">'+window.t("Upload")+"</a>"),e.styleFileUpload();else{var a;n.append(a=$('<a class="cBtn '+i+'" id="'+r+'">'+o+"</a>").on("click",function(){if(!e.hasClass("cNoFollow")){var t=window.location.href;t=t.replace(new RegExp(e.attr("name")+"=[^&]*"),"").replace("&&","&").replace(/&$/,"").replace(/\?&?$/,"").replace("?&","?"),e.val()&&(t+=(-1!=t.indexOf("?")?"&":"?")+e.attr("name")+"="+e.val()),this.href=t}})),e.on("keydown",function(e){e.keyCode===Handler.Keyboard.keys.VK_RETURN&&a.trigger("click")})}}else n.addClass("inputTextWrapper");if(e.hasClass("inputTextWithReset")){var s=$("<a/>").addClass("cTextInputClear").on("click",function(t){t.stopPropagation(),s.hide(),e.val(""),e.trigger("blur"),e.focus(),n.find(".cBtn").get(0).click()})[e.val()?"show":"hide"]().appendTo(n);e.on("keyup keypress change",function(){setTimeout(function(){s[e.val()?"show":"hide"]()},3)})}e.is(":text,:password")&&e.on("focus blur",function(t){e.closest("span")["focus"==t.type?"addClass":"removeClass"]("onFocus")})}}),e("input.cPattern:radio, input.cPattern:checkbox",n).each(function(){var e=$(this),t=e.next("span").addClass("crLabel"),n="radioButton";if(e.is(":checkbox")&&(n="checkBox"),!e.data("pattern-checkbox")){e.attr("data-pattern-checkbox",!0);var i=e.attr("id");i||(i="pattern"+e.attr("type")+ ++r,e.attr("id",i)),e.wrap($('<label class="crContainer '+n+'" for="'+i+'"></label>')),e.closest(".crContainer").append(t),e.after($("<label/>").addClass("crImg").attr("for",i))}}),e("input.cPatternSlider").each(function(){var e=$(this);if(!e.data("pattern-slider")){e.data("pattern-slider",!0);var t=$("<div/>").addClass("cPatternSlider"),n=e.data("slider")||{};t.insertBefore(e).append(e),t.slider({value:e.val(),range:n.range||void 0,min:n.min||0,max:n.max||100,step:n.step,change:function(t,n){e.val(n.value).trigger("change")}})}}),e("div.cPatternSlider").each(function(){var e=$(this);e.children("input.cPatternSlider").length||e.slider({value:e.data("value")})}),e("input.cPattern[data-watermark-label], textarea.cTextarea[data-watermark-label]").each(function(){$(this).waterLabel()}),e("select.cPattern").off("update").on("update",function(){$(this).selectBox("refresh")}).selectBox(),e("select.autoSubmit").on("change",function(){var e=$(this);if(!e.data("pattern-autosubmit")){e.attr("data-pattern-autosubmit",!0);var t=window.location.href;t=t.replace(new RegExp(e.attr("name")+"=[^&]*"),"").replace("&&","&").replace(/&$/,"").replace(/\?&?$/,"").replace("?&","?"),e.val()&&(t+=(-1!=t.indexOf("?")?"&":"?")+e.attr("name")+"="+e.val()),$(".autoSubmit-selectBox-dropdown-menu a[rel="+e.val()+"]").attr("href",t).get(0).click();
}}),e("form.cPattern").validatable(),t},t.tabs=function(n){function i(e){if(!($('*[data-tab-content-id="'+e+'"]').length<=0)){var t=$('*[data-tab-content-id="'+e+'"]'),n=t.closest(".customTabs");if(!t.closest("li").hasClass("disabled")){n.find(" > section").hide(),$(" > section",n).removeClass("active"),$(" > .tabsList li",n).removeClass("active"),t.closest("li").addClass("active"),$(" > section",n).hide();var i=n.find("#"+t.data("tab-content-id"));i.show().addClass("active").trigger("chess24:show"),i.find(".customTabs section.active, .tabContentWrap > div:not(.hide)").trigger("chess24:show");var r=n.find("> section").not(i);return r.trigger("chess24:hide"),r.find(".customTabs section.active, .tabContentWrap > div:not(.hide)").trigger("chess24:hide"),!1}}}return e(".customTabs",n).each(function(){function e(){var e=$(this);e.prepend('<div class="disabledTabContentOverlay">&nbsp;</div>');var n=e.attr("id"),i="";e.data("tab-class")&&(i=e.data("tab-class"));var r=e.data("tab-title");$('<li class="'+i+'"><div data-tab-content-id="'+n+'"'+(e.data("href")?' data-href="'+e.data("href")+'"':"")+">"+r+"</div></li>").toggleClass("active",e.hasClass("active")).appendTo(t.find(".tabsList"))}var t=$(this);if(!($(".tabsList",t).length>0)){t.hasClass("tab-position-bottom")?t.append('<ul class="tabsList" />'):t.prepend('<ul class="tabsList" />'),$(" > section",t).each(e);var n=$(".tabsList > li:first",t).find("div").data("tab-content-id");$(".tabsList > li",t).each(function(){var e=$(this).find("div").data("tab-content-id");$(this).hasClass("disabled")||$(this).hasClass("active")&&($(".tabsList > li",t).removeClass("active"),$(this).addClass("active"),n=e)}),i(n),$(t).on("click",".tabsList > li div",function(){var e=$(this);i(e.data("tab-content-id")),e.data("href")&&1!=$("body").data("embed")&&window.history.pushState({},"game",e.data("href"))}),t.on("chess24:add",function(n,i){i=$(i),i.length&&($(i).hide(),t.append(i),e.call(i))}),t.on("chess24:remove",function(e,n){var r=t.find("> section#"+n),o=t.find("ul.tabsList [data-tab-content-id="+n+"]").closest("li");r.is(".active")&&(r.removeClass("active"),o.removeClass("active"),i(t.find("> section").not("#"+n).first().attr("id"))),r.remove(),o.remove()})}}),t},t.scrollableTables=function(n){function i(){var e=$(this);if(!e.is(":visible"))return void e.closest(".singleDisplay, .customTabs > section, .tabContent, .modal").one("chess24:show",function(){i.apply(e)});if(!e.data("scrollable-table")){e.data("scrollable-table",!0);var t=e.find("thead"),n=e.find("tfoot"),r=e.closest(".nativeScroll"),o={};t.find("th").each(function(e){$(this).css("width",$(this).width()),o[e]=$(this).outerWidth()}),e.find("tbody tr:first td").each(function(e){$(this).css("width",o[e]-parseInt($(this).css("padding-left"))-parseInt($(this).css("padding-right"))-1)}),0===t.length&&(t=$('<thead class="empty"><tr><th></th></tr></thead>').appendTo(e)),0===n.length&&(n=$('<tfoot class="empty"><tr><th></th></tr></tfoot>').appendTo(e)),e.hasClass("tHead")&&(t.clone(!0).insertBefore(r).wrap('<div class="gridView fixedHead"><table></table></div>'),t.remove()),e.hasClass("tFoot")&&(n.clone(!0).insertAfter(r).wrap('<div class="gridView fixedFoot"><table></table></div>'),n.remove())}}return e(".gridView.fixed",n).each(function(){i.call(this)}),t},t.simpleSlideshow=function(n){return e(".cPattern.addSimpleSlideshow",n).simpleSlideshow(),t},t.dropDown=function(n){return e(".dropdownFilter",n).each(function(){function e(e){$(e.target).closest(n).length||($(document).off("touchstart.dropdownfilter"),t.removeClass("active"),t.trigger("chess24:hide"))}var t=$(this);if(!t.data("pattern-dropdown")){t.on("chess24:hide chess24:show",function(e){e.stopPropagation()}),t.data("pattern-dropdown",!0);var n=t.find(".dropdownFilterContainer");t.hasClass("showOnlyOnClick")&&(t.find(".dropdownFilterTitle").off("click.dropdownfilter").on("click.dropdownfilter",function(n){t.hasClass("disabled")||($(".dropdownFilter").not(t).each(function(){$(this).removeClass("active")}),t.toggleClass("active"),t.hasClass("active")?(t.trigger("chess24:show"),$(document).on(("ontouchstart"in window?"touchstart.dropdownfilter ":"")+"click.dropdownfilter",e)):t.trigger("chess24:hide"),n.stopPropagation())}),t.hasClass("active")?(t.trigger("chess24:show"),$(document).on(("ontouchstart"in window?"touchstart.dropdownfilter ":"")+"click.dropdownfilter",e)):t.trigger("chess24:hide")),t.find(".likeSelectbox input:radio").on("change",function(e){var n=$(this),i=n.closest(".dropdownFilter").find(".dropdownFilterTitle"),r=n.siblings(".crLabel").text();n.is(":checked")&&!t.hasClass("staticLabel")&&i.text(r),t.removeClass("active")})}}),t},t.oneTime=function(){t.oneTime.colorHeader(),t.oneTime.csrfForCachedPages(),t.oneTime.initSharingIcons(),t.oneTime.preventScrolling(),t.oneTime.searchAnimation(),t.oneTime.openCloseResponsiveMenu(),t.oneTime.playNowMenuEntry(),t.oneTime.showMorePaymentPlans(),t.oneTime.OLD_DEPRECATED()},t.oneTime.colorHeader=function(){function e(){return r&&r.length?!0:(r=jQuery(".colorHeader"),r.length?(o=r.closest(".contentContainerInsider"),!0):!1)}function t(){var e=jQuery(".mainMenu .secondaryMenuWrapper li.active").eq(0);if(!e.length)return void n();var t=s.render("defaultHeader",{title:e.find("a").clone().children().remove().end().text(),subtitle:e.find("a").contents().filter("p").text()});a=e.attr("class"),i(t,a)}function n(){o.removeClass("showColorHeader")}function i(e,t){o.addClass("showColorHeader"),r.empty().append(e),a&&r.removeClass(a),t?r.addClass(t):a&&(a=void 0)}var r,o,a,s=Handler.Template("colorHeader");e()&&(r.hasClass("custom")?r.text().trim()||n():t()),jQuery(document).off("chess24:header").on("chess24:header",function(r,o){if(e())if(o)if(o===!0)t();else{var a=s.render(o.template+"Header",o.data);a&&i(a)}else n()})},t.oneTime.csrfForCachedPages=function(){$("form input[name=csrf]").val($.cookie("csrf"))},t.oneTime.initSharingIcons=function(){function e(){var e=$(".contentWrap").offset();e&&n.css("left",e.left+"px")}function t(e,t){"string"==typeof t?r.attr("href",t):i.data("embed-data",t),i.toggleClass("withEmbed",!!t)}var n=$(".stickyQuickies"),i=$(".globalSharing"),r=$("head > link[rel=embed-url]");i.shareButtons({plain:!0,noIcons:!0,noLabel:!0,facebook:!0,twitter:$(".oneNews h1").text()||$('head > meta[property="og:title"]').attr("content")||!0,google:!0,embed:!0,mail:!1}),$(window).on("resize",e),$(document).on("chess24:embedurl",t),e(),t()},t.oneTime.preventScrolling=function(){$(document).on("mousewheel DOMMouseScroll",'.deltaScroll, ul[class^="selectBox-"], ul[class*=" selectBox-"]',function(e){var t=e.originalEvent,n=t.wheelDelta||-t.detail;this.scrollTop+=30*(0>n?1:-1),e.preventDefault()})},t.oneTime.searchAnimation=function(){var e=!1;$("#search-bar > a").on("click mouseover",function(t){if(e)return void("click"===t.type);var n=$(this),i=$("#search-bar > div"),r=$("#search-bar").width()+2;e=!0,$(this).toggleClass("active"),i.css({width:"0px",left:r+"px"}).animate({width:r+"px",left:"0px"},200,function(){$("#search-bar > div input").focus()}),n.animate({right:r-n.width()+10+"px"},200),$("#search-bar").off("click touchend").on("click touchend",function(e){try{e.stopPropagation()}catch(t){e.cancelBubble=!0}}),$(document).one("click",function(){e&&(i.animate({width:"0px",left:r+"px"},200,function(){n.toggleClass("active"),e=!1}),n.animate({right:"0px"},200))})})},t.oneTime.playNowMenuEntry=function(){$(".menuGroupPlay .mmenuPlayNow > a").on("click",function(e){Controller.getPlayZone().playNow(),e.preventDefault()})},t.oneTime.openCloseResponsiveMenu=function(){$(".navContainerWrapper > .menuBurgerButton[data-class-setter-on-click]").classSetterOnClick()},t.oneTime.showMorePaymentPlans=function(){jQuery(".morePlans[data-class-setter-on-click]").classSetterOnClick()},t.OLD_DEPRECATED=function(){$(".tabsContainer").each(function(){var e=$(this);if(!e.data("pattern-tab")){e.attr("data-pattern-tab",!0);var t;window.location.hash&&(t=e.find(".tabNav").find('a[data-tab-content-id="'+window.location.hash.replace("#","")+'"]'),t.length>0&&(e.find(".tabNav > li").removeClass("current"),t.parent().addClass("current"))),e.find(".tabContentWrap > div").addClass("hide");var n=e.find(".tabNav li.current a").attr("data-tab-content-id");$(".tabContentWrap #"+n).removeClass("hide"),e.wrapTabs(),e.hasClass("userProfileTabs")&&e.ajaxTabs(),t&&t.length>0&&t.parents(".tabsContainer").find("#"+t.attr("data-tab-content-id")).trigger("chess24:show")}}),$(".stepSlider").each(function(){var e=$(this),t=e.data("slider")||{},n=t.step||4,i=e.find(".sliderValues");i.addClass("items-"+n)})},t.oneTime.OLD_DEPRECATED=function(){$(".language-change-link").on("click",function(){var e=$(this),t={language:e.data("lang"),csrf:config.csrf()};return $.ajax({url:"/api/web/UserAPI/setLanguage",type:"POST",data:t,dataType:"json",success:function(t){t&&0===t.status&&(window.location=e.attr("href"))},error:function(e,t,n){var i,r=window.t("Failed to change the language");try{i=$.parseJSON(e.responseText);var o;for(o in i.errors){r=i.errors[o][0];break}}catch(a){}errorHandler.msg("error",new Error(r),!1)}}),!1}),setTimeout(function(){if(window.editors&&window.editors.length){for(var e=!0,t=0;t<window.editors.length;t++)if(window.editors[t].is(".comment")){e=!1;break}e&&$(document).off("keydown.backspace").on("keydown.backspace",function(e){var t=!1;if(8===e.keyCode){var n=e.srcElement||e.target,i=$(n),r=n.tagName.toLowerCase(),o=(n.type||"").toLowerCase();t="input"==r&&["text","password","file","email"].contains(o)||"textarea"==r||i.is(".editor")||i.closest(".editor").length>0?n.readOnly||n.disabled:!0}t&&e.preventDefault()})}})},$(document).on("ready",function(){t.oneTime(),t(),i.resolve()}),$(document).on("newhtml",function(){t()})}(),jQuery(function(){function e(e){jQuery.ajax({url:"/api/web/UserAPI/getGTMData?uuid="+config.user().uuid,dataType:"json",type:"GET"}).done(function(t){e(t.data.gtm)})}function t(e){e.userCountry=config.user().countryIso3,dataLayer.push(e)}"object"==typeof dataLayer&&e(t)}),"undefined"==typeof View&&(View={}),function(){var e={};View.AutoCommentator=function(){function t(){b&&void 0===e[w]&&(e[w]=null,$.getJSON(y+"/"+w+".json").done(function(t){e[w]=t}))}function n(t){return function(){b&&e[w]&&t.apply(this,arguments)}}function i(e){return function(){m.isOver()||e.apply(this,arguments)}}function r(t,n){e[w].check&&n.isCheck()&&!n.isCheckMate()?d(e[w].check):o(n)}function o(t){if(e[w].move){var n=t.getSan().replace("#","").replace("+","");if(e[w].move[n])return void d(e[w].move[n]);if(e[w].capture&&t.hasTakenPiece){var i=n.substr(n.indexOf("x"));if(e[w].capture[i])return void d(e[w].capture[i]);e[w].capture.x&&d(e[w].capture.x)}}}function a(t){if(v=!1,e[w].result&&t.publisher.isOver()){var n,i=t.publisher,r=i.getGameStatus(),o=i.getMeta().White.UUID==config.user().uuid,a=r.result.white==(o?1:0),s=r.endedBy;switch(s){case"RESIGN":n=a?e[w].result.win:e[w].result.loss;break;case"CHECKMATE":n=a?e[w].result.checkmate.win:e[w].result.checkmate.loss;break;case"CLOCKFLAG":case"CLOCKFLAG_VS_INSUFFICENT_MATERIAL":n=a?e[w].result.flag.win:e[w].result.flag.loss;break;case"DISCONNECT_VS_INSUFFICENT_MATERIAL":case"DRAW_AGREED":case"INSUFFICENT_MATERIAL":case"REPETITION":case"NO_ACTION":case"STALEMATE":case"BOTH_FLAGS_DOWN":n=e[w].result.draw}d(n,!0)}}function s(t,n){v=!0,n.getStartPosition().countChildrenMoves()||d(e[w].start)}function l(e){soundManager.getSoundById(w+e)||c(w+e,{"audio/mp3":"mp3/"+e+".mp3","audio/ogg":"ogg/"+e+".ogg"})}function c(e,t){var n=[];for(var i in t)t.hasOwnProperty(i)&&n.push({type:i,url:y+"/"+w+"/"+t[i]});soundManager.destroySound(e),soundManager.createSound({id:e,url:n,autoLoad:!0,autoPlay:!1})}function d(e,t){"undefined"==typeof t&&(t=!1),Array.isArray(e)&&p(e.random(),t)}function u(){return k=!1,x.length?void p(x.shift(),!1):void h()}function h(){clearTimeout(h.timeout),h.timeout=setTimeout(n(i(f)),2e4+2e4*Math.random())}function f(){d(e[w].misc)}function p(e,t){if(b){if(k)return void(1==t&&x.push(e));l(e),k=!0,soundManager.play(w+e,{volume:window.settings.getNumber("game-sounds-volume"),onfinish:u})}}var m,g=this,v=!0,y=assetsBasePath+"/sounds/autoCommentator/"+config.language(),b=window.settings.getBoolean("auto-commentator"),w=window.settings.get("auto-commentator-theme")||"pepeCuenca",k=!1,x=[];return window.settings.on("settings.auto-commentator",function(e,n){b=!!n.value,t()}),window.settings.on("settings.auto-commentator-theme",function(e,n){w=n.value,t()}),Extend.Suspendable(g),Extend.Subscriber(g,{"move.mainline.add":g.delegate(n(r)),gameStatusChanged:g.delegate(n(a)),startPlayZoneGame:g.delegate(n(s))},{afterLink:function(e){m=e.publisher,t()}}),g}}();var View=View||{};!function(){var e=1e3;View.AutoPlay=function(t){function n(){return c}function i(){d.off("click").on("click",r),d.removeClass("play").addClass("pause"),clearInterval(l),s.isEndOfMainline()&&s.gotoStart(),l=setInterval(o,e)}function r(){u||(d.off("click").on("click",i),d.removeClass("pause").addClass("play"),clearInterval(l))}function o(){u=!0,s.gotoNextPosition(!0),u=!1,s.isEndOfLine()&&r()}function a(){d.removeClass("inactive"),r()}var s,l,c=this,d=jQuery(t),u=!1;return Extend.Subscriber(c,{pieceSelected:r,gameStatusChanged:a,currentGameChanged:a,movedPositionPointer:r},{afterLink:function(e){(e.publisher instanceof Chess.Game||e.publisher instanceof Chess.GameHandler)&&(s=e.publisher,a())}}),n()}}(),"undefined"==typeof View&&(View={}),View.BoardLink=function(e){var t=this;return e=jQuery(e),0===e.length&&errorHandler.error(new Error("container not found in View.BoardLink"),{container:e}),t.updateUrl=function(t){jQuery(".chess24RefLink > a").attr("href",t),e.wrap('<a href="'+t+'" target="_blank" />')},t};var View=View||{};!function(e){View.BoardXL=function(t){function n(){return r(),c.on("click",i),window.settings.on("settings."+s,r),a}function i(){window.settings.set(s,o())}function r(){var t=window.settings.getBoolean(s);t?(e("body").addClass(l),c.switchClass("cIconFullscreenOn","cIconFullscreenOff"),e(".pageSidebar").trigger("sticky_kit:detach")):(e("body").removeClass(l),c.switchClass("cIconFullscreenOff","cIconFullscreenOn"))}function o(){return window.settings.getBoolean(s)?0:1}var a=this,s="play-board-xl",l="boardXL",c=e(t);return a.update=r,n()}}(jQuery),"undefined"==typeof View&&(View={}),View.BroadcastPageTitle=function(e){function t(t){var n=t.publisher.getMeta();n.White.Name&&n.Black.Name&&Handler.pageTitle.set(n.White.Name+" vs. "+n.Black.Name+" | "+i.getTitle(e)+" | "+i.getYear(e)+" | chess24.com")}var n=this,i=new Controller.BroadcastTournament;return Extend.Subscriber(n,{currentGameChanged:t},{afterLink:t}),n},"undefined"==typeof View&&(View={}),View.Dual=function(e,t,n,i,r,o,a){function s(){l(e),f=new View.TeamRoundRobin(x,n,r).switchNavigation(!1).resume(),e.on("set."+n+".currentRound",u.delegate(function(t,n){c(e,n.value)}))}function l(e){var n=t.find(".dualNavigation"),a=n.find(v),s=n.find(y),l=k.data(b)||window.t("Section one"),d=k.data(w)||window.t("Section two");a.html(l).on("click",function(){u.emit("switch",0),C.hide(),x.show(),a.addClass("active"),s.removeClass("active"),f.resume(),p&&p.suspend()}).addClass("active"),s.html(d).on("click",function(){function e(){p=p||new View.TeamRoundRobin(C,i,r).switchNavigation(!1),u.emit("switch",1),x.hide(),C.show(),s.addClass("active"),a.removeClass("active"),f.suspend(),p.resume()}return p?e():void o(i,e)}),c(e,h)}function c(e,n){var i=d(g,n),r=parseInt(Object.keys(g).pop(),10);h=n;var o=m.render("dual.pagination",{rounds:i});t.find(".cPagination").html(o),t.find(".cPagination a").on("click",function(){var t,n=jQuery(this),i=n.parent();t=i.hasClass("goFirst")?1:i.hasClass("goLast")?r:i.hasClass("goPrev")?Math.max(1,h-1):i.hasClass("goNext")?Math.min(r,h+1):n.data("round"),c(e,t),f.setCurrentRound(t),p&&p.setCurrentRound(t)}),t.find(".cPagination .goFirst, .cPagination .goPrev")[1==n?"addClass":"removeClass"]("inactive"),t.find(".cPagination .goLast, .cPagination .goNext")[n==r?"addClass":"removeClass"]("inactive")}function d(e,t){var n=[];for(var i in e)n.push(parseInt(i,10));var r=n.indexOf(t),o=r-3,a=r+3;0>o&&(a-=o,o=0),a>=n.length&&(o-=a-n.length+1,a=n.length-1),0>o&&(o=0);for(var s=[],l=o;a>=l;l++)s.push({round:n[l],current:n[l]==t});return o>0&&(s.left=!0),a<n.length-1&&(s.right=!0),s}var u=Extend.Publisher(this);t=jQuery(t);var h=r;0===t.length&&errorHandler.msg("error",new Error("container not found"),!0,{container:t});var f,p,m=new Handler.Template("broadcast"),g=e.getAttribute(n,"rounds");if(a)var v=".switchRight",y=".switchLeft",b="label2",w="label1";else v=".switchLeft",y=".switchRight",b="label1",w="label12";var k=t.closest(".liveTournamentContainer");Extend.Suspendable(u),t.html(m.render("dual.main"));var x=t.find(".dualTournament1").show(),C=t.find(".dualTournament2").hide();return u.onSuspend(function(){f.suspend(),p&&p.suspend()}),u.onResume(function(){f.resume(),p&&p.resume(),c(e,h||e.getAttribute(n,"currentRound"))}),u.showTournament=function(e){return e===n?t.find(".dualNavigation .switchLeft").trigger("click"):e===i&&t.find(".dualNavigation .switchRight").trigger("click"),u},s(),u},"undefined"==typeof View&&(View={}),View.EnrollButton=function(e,t,n){function i(e){o=e.publisher;var s=jQuery.extend({},o.getAttribute(t,"players"));delete s.unknown;var h=Object.keys(s).length,f=o.getAttribute(t,"playersMax"),p=o.getAttribute(t,"enrollingFrom"),m=o.getRounds(t),g=m[1]?m[1].startDate<=Controller.Broadcast.offsetCorrectedDateNow():!1,v="finished"===o.getAttribute(t,"status"),y=m[1]?m[1].startDate-p<=Controller.Broadcast.offsetCorrectedDateNow():!1,b="cancelled"===o.getAttribute(t,"status"),w=Math.max(0,f-h);if(config.level().isGuest)return g||b?(c.hide(),d.empty()):(c.html(window.t("Enroll")).removeClass("disabled").on("click",function(){new Dialog.conversionRegister("playzoneTournament")}),d.empty()),a;var k=o.getAttribute(t,"restrictLevel"),x=o.getAttribute(t,"restrictEloMin"),C=o.getAttribute(t,"restrictEloMax"),j=o.getAttribute(t,"restrictGeo"),T=o.getAttribute(t,"whitelist");if(k&&!config.level().isPremium)return g||b?(c.hide(),d.empty()):(c.html(window.t("Enroll")).removeClass("disabled").on("click",function(){new Dialog.conversionGoPremium("enroll")}),d.html(window.t('<span class="cPremiumLabel">Premium</span> tournament. Enrollment to this tournament is only available to premium users'))),a;if(j&&Array.isArray(j)&&!j.contains(config.user().country))return c.html(window.t("Enroll")).addClass("disabled"),d.html(window.t("This tournament is not available in your country")),a;if(T&&T.length&&!T.contains(config.user().uuid)&&(!k||!config.level().isPremium))return c.html(window.t("Enroll")).addClass("disabled"),d.html(window.t("Limited tournament")),a;if(C||x){var _,S;for(var I in m){_=m[I].timeControl.base,S=m[I].timeControl.incrementPerMove;break}var P=_+40*S,M="classical";P>0&&18e4>P?M="bullet":9e5>P&&(M="blitz");var Q=config.user().elo[M],B=C&&Q>C||x&&x>Q;if(B){if(g||b)c.hide(),d.empty();else{if(c.html(window.t("Enroll")).addClass("disabled"),C&&x)var E=window.t("Enrollment is only available to users with Elo in the range between {from} and {to}",{"{from}":x,"{to}":C});else C?E=window.t("Enrollment is only available to users with Elo below {to}",{"{to}":C}):x&&(E=window.t("Enrollment is only available to users with Elo above {from}",{"{from}":x}));d.html(E)}return a}}if(c.show().off("click").removeClass("disabled"),s[n]&&!s[n].removed)if(v)c.html(window.t("Withdraw")).addClass("disabled").hide(),d.html(window.t("The tournament is over!"));else if(b)c.html(window.t("Withdraw")).addClass("disabled").hide(),d.html(window.t("The tournament has been cancelled, not enough users enrolled"));else if(g){var O={content:window.t("Do you really want to withdraw?")};parseInt(o.getAttribute(t,"punishWithdrawers"),10)&&(O.comment=window.t("You will be no longer able to join the tournament and <strong>will be banned from playing tournaments for another week</strong>.<br/>Do you want to proceed?")),c.html(window.t("Withdraw")).on("click",function(){new Dialog.confirmation(O,function(){var e=jQuery.extend({},u,{tournament:t});jQuery.post(l+"withdraw",e).done(function(){}).error(function(e){try{var t=jQuery.parseJSON(e.responseText);for(var n in t.errors)if(t.errors[n]&&t.errors[n][0]){new Dialog.alert(t.errors[n][0]);break}}catch(i){}})})}),d.empty()}else c.html(window.t("Withdraw")).on("click",function(){new Dialog.confirmation(window.t("Do you really want to leave the tournament?"),function(){var e=jQuery.extend({},u,{tournament:t});jQuery.post(l+"withdraw",e).done(function(){}).error(function(e){try{var t=jQuery.parseJSON(e.responseText);for(var n in t.errors)if(t.errors[n]&&t.errors[n][0]){new Dialog.alert(t.errors[n][0]);break}}catch(i){}})})}),d.empty();else if(v)c.html(window.t("Enroll")).addClass("disabled").hide(),d.html(window.t("The tournament is over!"));else if(b)c.html(window.t("Enroll")).addClass("disabled").hide(),d.html(window.t("The tournament has been cancelled, not enough users enrolled"));else if(g)c.html(window.t("Enroll")).addClass("disabled").hide(),d.html(window.t("The tournament has already started, you can't enroll"));else if(y)if(w){if(c.html(window.t("Enroll")).on("click",function(){r(t)}),k)var A=window.t('<span class="cPremiumLabel">Premium</span> tournament')+". ";1===w?d.html((A||"")+window.t("There is still one place free!")):d.html((A||"")+window.t("There are still {slots} places free!",{"{slots}":w}))}else c.html(window.t("Enroll")).addClass("disabled"),d.html(window.t("Sorry, no more places left, check later!"));else c.html(window.t("Enroll")).addClass("disabled"),d.html(window.t("Enrolling to the tournament is not yet open"));return g&&e.publisher.off("set."+t+":1:1",i),a}function r(e,t){var n=jQuery.extend({},u,{tournament:e});t&&(n.force=1),jQuery.post(l+"enroll",n).done(function(t){t.data&&t.data.alreadyEnrolled?new Dialog.confirmation(window.t("You are already enrolled to {title} and will be automatically withdrawn from it. Do you want to proceed?",{"{title}":t.data.alreadyEnrolled.title}),function(){r(e,!0)}):new Dialog.Enroll(e,!0).link(o).getContent().modal("show")}).error(function(t){try{var n=jQuery.parseJSON(t.responseText);for(var i in n.errors)if(n.errors[i][0]){var r=n.errors[i][0];break}}catch(a){}"blocked"===i||"restricted-elo"===i?new Dialog.alert(r):"restricted-premium"===i?new Dialog.conversionGoPremium("enroll"):new Dialog.Enroll(e,!1,r).link(o).getContent().modal("show")})}var o,a=this;n=n||config.user().uuid;var s=jQuery(e),l="/api/web/playzoneTournamentAPI/";0===s.length&&errorHandler.msg("error",new Error("container not found"),!0,{container:s}),s.find(".enroll-withdraw").remove();var c=jQuery("<a/>").addClass("cBtnFlexi cBtnBlue enroll-withdraw").appendTo(s).after("<br/>"),d=jQuery("<span/>").addClass("message enroll-withdraw").appendTo(s),u={csrf:config.csrf()};return Extend.Subscriber(a,{},{afterLink:function(e){o=e.publisher,i(e),e.publisher.on("set."+t+".playersMax",i),e.publisher.on("set."+t+".players",i),e.publisher.on("set."+t+":1.startDate",i),e.publisher.on("set."+t+":1:1",i),e.publisher.on("set."+t+".status",i)}}),a},"undefined"==typeof View&&(View={}),View.EvalIndicator=function(e,t,n,i){function r(){e.parent().show("slide",{direction:"right"},"fast")}function o(){e.parent().hide("slide",{direction:"right"},"fast")}function a(e){return y=!y,l(e,e.publisher.getCurrentPosition(),!0)}function s(e,t){l(e,t.getCurrentPosition(),!0)}function l(e,t,n){clearTimeout(b),b=setTimeout(function(){c(e,t,n)},0)}function c(e,t,n){for(u&&Handler.engine.off(u+":numerical",d);t&&t.isNullMove();)t=t.parentMove;u=t.getEngineFen(),h=t,Handler.engine.on(u+":numerical",d),d(e,Handler.engine.get(t,"numerical",!0,!0),n)}function d(t,n,i){return Handler.engine.shouldInvert(h,n)&&(n=Handler.engine.invert(n)),e.toggleClass("reverse",y).toggleClass("inactive",!!n.approximated).toggleClass("loader",!!n.approximated&&h.isInMainline()),p.setValue(n,i,n.approximated)}var u,h,f,p=this,m=new Handler.Template("broadcast"),g=window.settings.getBoolean("game-broadcast-engine");void 0===i&&(i=1e3),n=["horizontal","vertical"].contains(n)?n:"vertical",e=jQuery(e),t=jQuery(t);var v=e.find(".level");e.length||errorHandler.error(new Error("container not found"),{container:e});var y=e.hasClass("reverse");e.removeClass().addClass("evalIndicator"+(y?" reverse":"")),Extend.Suspendable(p),Extend.Subscriber(p,{currentGameChanged:p.delegate(s),"movedPositionPointer.current":p.delegate(l),flipBoard:p.delegate(a)},{afterLink:function(e){g?r():o(),f=e.publisher,l(e,e.publisher.getCurrentPosition())}}),window.settings.on("settings.game-broadcast-engine.on",r),window.settings.on("settings.game-broadcast-engine.off",o),p.onResume(function(e){e&&f&&(g?r():o(),l({publisher:f},f.getCurrentPosition()))});var b;return p.setValue=function(e,r,o){var a=Controller.Broadcast.convertEvaluationToPercent(e,y),s={};return s["horizontal"===n?"width":"height"]=a+"%",t.length&&t.attr("data-tooltip",m.render("game.engineTooltip",{value:Handler.engine.formatEngine(e.score,e.mate),phrase:Controller.Broadcast.getPhraseForEvaluation(e.score,e.mate),outdated:o})),v.stop(!0),!i||r?void v.css(s):void v.animate(s,r?0:i)},p},"undefined"==typeof View&&(View={}),function(){function e(){i=(new Chess.Game).setCheckForGameEnd(!1).setClockStartMove(2).setMoveMode({duringGame:{sideline:!0,mainline:!0},afterGame:{sideline:!0,mainline:!0}}),d=new Controller.BroadcastTournament;var e=new Handler.Template("broadcast");n=jQuery(e.render("tooltip",{}));var l=n.children(".clock");return r=new View.ChessBoard(n.children(".board"),!1).link(i),a=new View.ChessClock(l.children(".clockWhite"),"w",!0).link(i),s=new View.ChessClock(l.children(".clockBlack"),"b",!0).link(i),o=new View.NotationArea(n.children(".notation"),"tooltip").link(i),window.settings.on("settings.game-broadcast-engine",t),t(),n}function t(e){!e&&window.settings.getBoolean("game-broadcast-engine")?l=l||new View.EvalIndicator(n.children(".evalIndicator").show(),void 0,"vertical",0):(l=void 0,n.children(".evalIndicator").hide(),n.addClass("noEval"))}var n,i,r,o,a,s,l,c,d,u={};View.GameTooltip=function(r,a){function s(e,t){d.on(e,t),u[e]=t}function h(){for(var e in u)d.off(e,u[e])}function f(){n.detach()}function p(e){"finished"===e.status&&e.result?(i.setGameEndByPoints(e.result.white,e.result.black,void 0,!0),setTimeout(function(){var t=0;1==e.result.white?t=1e3:1==e.result.black&&(t=-1e3),g(null,null,{score:t})},100)):i.reOpen()}function m(e){var t=d.getRounds(a)[e.roundId].matches[e.matchId].games[e.gameId],r=d.getAttribute(a,"fen")||void 0;if(!t)return void i.setStartPosition(new Chess.Position({fen:r}));if(t.earlierFen){if(o.isSuspended()&&(o.resume(),n.children(".notation").show(),n.removeClass("simple")),i.setStartPosition(new Chess.Position({fen:t.earlierFen})),t.lastMoves){for(var s=0;s<t.lastMoves.length;s++)i.move(t.lastMoves[s],void 0,!0,void 0,void 0,!0);Object.forEach(i.getAllPositions(),function(e){i.setTimeUsage(0,e)})}}else o.isSuspended()||(o.suspend(),n.children(".notation").hide(),n.addClass("simple")),i.setStartPosition(new Chess.Position({fen:t.currentFen||r}));p(t.gameStatus),v(e,t),g(e)}function g(e,t,n){l&&(n=n||(t||d.getRounds(a)[e.roundId].matches[e.matchId].games[e.gameId]).engine,n&&l.setValue(n))}function v(e,t){t||(t=d.getRounds(a)[e.roundId].matches[e.matchId].games[e.gameId]);var n=i.getMoveRight(),r=Controller.Broadcast.getTimeOffset(),o=Object.map({white:"w"===n,black:"b"===n},function(e,n){return"running"===t.gameStatus.status?{base:Math.max(1,t.clock[n]-(e?Date.now()-r-t.clock.now:0))}:{timeLeft:t.clock[n]}});i.setClockInformation(o)}var y=this;return r=jQuery(r),c=new Controller.Broadcast,r.each(function(){var i=jQuery(this),r=i.data("gamePath");if(r&&c.snapshotsAvailable(a,r.roundId,r.matchId,r.gameId)){var o=i.find(".tScore");o.length||(o=i);var l=o.children("div:first-child");l.length||(l=i);var u,y,b,w,k;o.off("mouseenter.gametooltip").on("mouseenter.gametooltip",function(){n=n||e(),f(),t(!!d.getAttribute(a,"c24")),m(r),h(),u=function(){m(r)},y=function(e,t){p(t.value),v(r)},b=function(e,t){g(r,void 0,t.value)},w=function(){v(r)},k="set."+a+":"+r.roundId+":"+r.matchId+":"+r.gameId,s(k+".currentFen",u),s(k+".gameStatus",y),s(k+".engine",b),s(k+".clock",w)}).off("chess24:tooltip:hide").on("chess24:tooltip:hide",function(){d.off(k+".currentFen",u),d.off(k+".gameStatus",y),d.off(k+".engine",b),d.off(k+".clock",w)}),l.tooltip({side:"horizontal",SHOW_DELAY:200,HIDE_DELAY:1,invalidate:!0},function(t,i){n=n||e(),i(n)})}}),y}}(),"undefined"==typeof View&&(View={}),View.Header=function(e,t,n){function i(e,t){H?r(e,t):o(e,t)}function r(e,t){m();var n=k.find(".playzoneTournamentIcon");switch(n.removeClass("statePending stateCancelled stateRunning"),t.value){case"upcoming":n.addClass("statePending");break;case"running":n.addClass("stateRunning"),p();break;case"cancelled":f(),n.addClass("stateCancelled");break;case"finished":}}function o(e,t){switch(t.value){case"running":p();break;default:m()}}function a(e,n){return n.value?Q.removeClass("liveBroadcast").html(x.render("tournament.live",{tournamentUrl:y,languages:n.value.map(function(e){return e.language}).unique()})).show():"running"===w.getAttribute(t,"status")?p():m(),b}function s(e,t){var n=t&&(t.value[config.language()]||t.value.en);return n?(k.find(".tournamentTitle").text(n),b):b}function l(e,t){return A.empty(),t.value&&A.append(jQuery('<img src="'+t.value+'" />')),b}function c(e){if(n=w.getAttribute(t,"currentRound"),"undefined"!=typeof n){var i=w.getAttribute(t,"currentGame"),r=w.getRounds(t)&&w.getRounds(t)[n]&&w.getRounds(t)[n].startDate&&w.getRounds(t)[n].startDate[i]||w.getRounds(t)[n].startDate;return isNaN(r)?void 0:d(e,{value:r})}}function d(e,t){return g=t.value,f(),b}function u(e,t){return B.html(t.value),b}function h(e,t){return E.html(t.value),b}function f(){clearTimeout(v);var e=Controller.Broadcast.offsetCorrectedDateNow(),i=g-e,r=!1;if(H){var o=w.getAttribute(t,"status");"cancelled"===o&&(r=!0)}if(r)T.hide(),j.hide(),_.show();else if(e>=g)T.hide(),_.hide(),j.show(),O.html(n),u(void 0,{value:w.getAttribute(t,"runningGames")}),h(void 0,{value:w.getAttribute(t,"finishedGames")});else{j.hide(),_.hide(),T.show(),void 0===i&&(i=g-e);var a=Date.getSplitedTime(i);S.text(a.days),I.text(a.hours),P.text(a.minutes),M.text(a.seconds),v=setTimeout(f,1e3-e%1e3)}return b}function p(){w.getAttribute(t,"video")||Q.show().addClass("liveBroadcast")}function m(){w.getAttribute(t,"video")||Q.hide().removeClass("liveBroadcast")}var g,v,y,b=this,w=new Controller.BroadcastTournament,k=jQuery(e),x=new Handler.Template("broadcast");k.length||errorHandler.error(new Error("container not found in View.Header"));var C=k.find(".tournamentTimeBox"),j=C.children(".ongoing"),T=C.children(".pending"),_=C.children(".cancelled"),S=T.find(".days"),I=T.find(".hours"),P=T.find(".minutes"),M=T.find(".seconds"),Q=k.find(".liveTournamentIcon"),B=j.find(".gamesRunning"),E=j.find(".gamesFinished"),O=j.find(".currentRound"),A=k.find(".tournamentLogo"),D=k.find(".pgnLink"),H=!!w.getAttribute(t,"c24");config.level().isPremium||D.removeAttr("href"),D.on("click",function(e){return config.level().isPremium?(Handler.tracking("pgn","tournament"),!0):(Handler.tracking("pgn","tournamentConversion"),Dialog.conversionGoPremium("pgnDownload"),!1)}),k.on("click",function(e){if(e.target!==D.get(0)){var n=w.getAttribute(t,"currentRound"),i=new Controller.Broadcast;return i.showGameWhenReady(t,n),!1}}),Extend.Suspendable(b);var N={};return N["set."+t+".runningGames"]=b.delegate(u),N["set."+t+".finishedGames"]=b.delegate(h),N["set."+t+".currentRound"]=b.delegate(c),N["set."+t+".currentGame"]=b.delegate(c),N["set."+t+".logo"]=b.delegate(l),N["set."+t+".video"]=b.delegate(a),N["set."+t+".titles"]=b.delegate(s),N["set."+t+".status"]=b.delegate(i),N["set."+t+":"+n+".startDate"]=b.delegate(d),Extend.Subscriber(b,N,{afterLink:function(e){a(e,{value:w.getAttribute(t,"video")}),s(e,{
value:w.getAttribute(t,"titles")}),l(e,{value:w.getAttribute(t,"logo")}),i(e,{value:w.getAttribute(t,"status")}),c(e)}}),b.onResume(function(e){e&&(a(void 0,{value:w.getAttribute(t,"video")}),s(void 0,{value:w.getAttribute(t,"titles")}),l(void 0,{value:w.getAttribute(t,"logo")}),i(void 0,{value:w.getAttribute(t,"status")}),c(void 0))}),b.setTournamentUrl=function(e){return y=e,k.find(".tournamentLink").attr("href",y),b},b},"undefined"==typeof View&&(View={}),View.Intro=function(e,t){function n(n,i){function r(e,t){e.show().find("img").attr("src",t.picture).end().find("span").html(t.name).add(e.find("img")).addClass("ofMiniProfile position-top").data("uuid",t.id).addMiniprofile().end().attr("href",t.link)}if(s.getAttribute(t,"c24")){var o=s.getAttribute(t,"status");if(e.find(".introTeaser > div").hide().filter("."+o).show(),"finished"===o){e.find(".gold, .silver, .bronze").hide();var a=s.getAttribute(t,"standings").live,l=s.getAttribute(t,"players");if(!a)return;a[0]?r(e.find(".gold"),l[a[0]]):e.find(".gold").hide(),a[1]?r(e.find(".silver"),l[a[1]]):e.find(".silver").hide(),a[2]?r(e.find(".bronze"),l[a[2]]):e.find(".bronze").hide(),e.find(".tournamentEnrollButton").hide()}else e.find(".tournamentEnrollButton").show()}}function i(n){var i=n&&(n[config.language()]||n.en),r=!!s.getAttribute(t,"c24");if(r){e.find(".playzoneTournamentType span").html("Open");var l=e.find(".tournamentIntro"),c=l.find(".learnMore").detach();l.html(i+" ").append(c);var d=e.find(".playzoneTournamentTime");new View.TournamentTime(d,t).link(s);var h=e.find(".tournamentEnrollButton");new View.EnrollButton(h,t).link(s)}else{if(!i)return a;for(var f=o(i,u),p=0;p<f.length;p++)f[p]&&f[p].trim().length?jQuery(e[p]).show().html(f[p]):jQuery(e[p]).hide();for(var p=f.length;p<e.length;p++)jQuery(e[p]).hide()}return a}function r(e){var n=e.publisher.getAttribute(t,"fen"),i=e.publisher.getAttribute(t,"unrated");n?(f.show(),l=l||jQuery('<div class="chessBoardViewBubbleContainer" />'),l.bubble({align:f.find("a"),side:"bottom",point:"precise",offset_y:-10,noanimation:!0}),f.find("a").on("mouseover",function(){l.bubble("show")}).on("mouseout",function(){l.bubble("hide")}),c||(c=(new Chess.Game).setNoTimeout(!0)),c.setStartPosition(new Chess.Position({fen:n})),d||(d=new View.ChessBoard(l,!1),d.link(c))):(f.hide(),l&&l.hide()),i?p.show():p.hide(),n||i?h.show():h.hide()}function o(e,t){if(!e)return[];if(e.contains("\n"))return e.split("\n");var n=[],i=Math.floor(e.length/t),r=0;do{for(var o=i;" "!==e.charAt(o+r)&&o+r<e.length;)o++;n.push(e.substr(r,o)),r=r+o+1}while(r<e.length);return n}var a=this;e=jQuery(e),0===e.length&&errorHandler.msg("error",new Error("container not found"),!0,{container:e});var s,l,c,d,u=e.length,h=e.find(".customProperties"),f=h.find(".customFen"),p=h.find(".unrated");Extend.Suspendable(a);var m={};return m["set."+t+".descriptions"]=a.delegate(function(e,t){i(e,t.value)}),m["set."+t+".status"]=a.delegate(function(e,t){n(e,t.value)}),m["set."+t+".fen set."+t+".unrated"]=a.delegate(function(e,t){r(e)}),Extend.Subscriber(a,m,{afterLink:function(e){s=e.publisher,i(e.publisher.getAttribute(t,"descriptions")),n(e.publisher.getAttribute(t,"status")),r(e)}}),a.onResume(function(e){e&&(i(s.getAttribute(t,"descriptions")),n({publisher:s},s.getAttribute(t,"status")))}),a},"undefined"==typeof View&&(View={}),View.KnockoutTreeGroup=function(e,t,n){function i(){p={},g=[],h=new Controller.Broadcast,f=h.getTemplates();var e=v.getAttribute(n,"currentRound"),t=e%2!==0;y=t?(e+1)/2:e/2,r(y)}function r(e){y=e,m=l(e),p[e]=f.render("knockoutTree.slide",m.slide),d.html(f.render("knockoutTree.main",m));var t=d.find(".slides");t.empty().html(p[e]),o(e),a(m.pages,r)}function o(e){for(var t=m.slide;g.length>0;){var i=g.pop();i instanceof View.KnockoutTreeMatch&&i.unlink(v)}for(var r=0;r<t.matches.left.length;r++){var o=t.matches.left[r],a=o.roundNo,s=o.matchNo,l=o.gamesPerMatch,c=d.find(".slideNo"+e+" .knockoutTournamentRoundLeft .matchNo"+s);g.push(new View.KnockoutTreeMatch(c,n,a,s,l).link(v))}for(var u=0;u<t.matches.right.length;u++){var h=t.matches.right[u],f=h.roundNo,p=h.matchNo,y=h.gamesPerMatch,b=d.find(".slideNo"+e+" .knockoutTournamentRoundRight .matchNo"+p);g.push(new View.KnockoutTreeMatch(b,n,f,p,y).link(v))}}function a(e,t){var i=Object.values(Object.map(e,function(e){return e.slideNo})),r=Object.find(e,function(e){return e.current}),o=v.getAttribute(n,"currentRound");d.find(".pager").pager({live:Math.ceil(o/2),current:r&&r.slideNo||i[0]||0,margin:3,values:i,labels:i},t)}function s(e,t){var n=e[t];return n?Object.extend({id:t},n):{}}function l(e){function t(e,t){var n=[];for(var i in e){i=parseInt(i,10);var r=i%2!==0,o=r?(i+1)/2:i/2;r&&n.push({slideNo:o,current:o==t})}return n}var i,r={},o=v.getAttribute(n,"rounds"),a=v.getAttribute(n,"matchGroups"),l=v.getAttribute(n,"gamesPerMatch"),c=v.getAttribute(n,"players");r.shortList=Object.getLength(o)<=2;for(var d in o){d=parseInt(d,10);var u=d%2!==0,h=u?"left":"right",f=u?(d+1)/2:d/2;if(f===e){void 0===i&&(i={slideNo:f,rounds:{left:{},right:{}},matches:{left:[],right:[]}}),o[d].label&&(i.rounds[h].label=o[d].label[config.language()]||o[d].label),i.rounds[h].no=d;var p=o[d].matches;for(var m in p){var g={running:0,finished:0,upcoming:0};m=parseInt(m,10);var b=m-1,w=p[m];void 0===i.matches[h][b]&&(i.matches[h][b]={roundNo:d,slideId:f,side:h,matchNo:m,gamesPerMatch:l[d],games:[]});var k=w.games[1];k&&(i.matches[h][b].upper=s(c,k.player.white),i.matches[h][b].lower=s(c,k.player.black));for(var x={upper:0,lower:0},C=w.games,j=1;j<=l[d];j++){var T=j-1;void 0===i.matches[h][b].games[T]&&(i.matches[h][b].games[T]={gameId:j});var _=C[j];if(void 0!==_){if(g[_.gameStatus.status]=++g[_.gameStatus.status]||1,k.player.white===_.player.white&&k.player.black===_.player.black)var S="white",I="black";else k.player.white===_.player.black&&k.player.black===_.player.white&&(S="black",I="white");var P=_.gameStatus.result&&void 0!==_.gameStatus.result[S]&&1===parseInt(_.gameStatus.result[S],10),M=_.gameStatus.result&&void 0!==_.gameStatus.result[I]&&1===parseInt(_.gameStatus.result[I],10),Q=_.gameStatus.result&&(void 0!==_.gameStatus.result[S]&&"0.5"===_.gameStatus.result[S].toString()?"&frac12;":_.gameStatus.result[S]),B=_.gameStatus.result&&(void 0!==_.gameStatus.result[I]&&"0.5"===_.gameStatus.result[I].toString()?"&frac12;":_.gameStatus.result[I]);if(void 0!==_.engine)var E=Controller.Broadcast.convertEvaluationToPercent(_.engine,"white"===S);else E=50;i.matches[h][b].games[T]={gameId:j,fen:_.currentFen,showEngine:window.settings.getBoolean("game-broadcast-engine"),finished:"finished"===_.gameStatus.status,running:"running"===_.gameStatus.status,upcoming:"upcoming"===_.gameStatus.status,reverseEvaluationIndicator:"white"===S,evaluation:E,upper:{winner:P,score:Q,color:S},lower:{winner:M,score:B,color:I}},_.gameStatus.result&&!isNaN(_.gameStatus.result[S])&&(x.upper+=_.gameStatus.result[S]),_.gameStatus.result&&!isNaN(_.gameStatus.result[I])&&(x.lower+=_.gameStatus.result[I])}else i.matches[h][b].games[T].upcoming=!0}var O=0===g.running&&a[d].contains(g.finished);i.matches[h][b].finalResult={upper:{winner:x.upper>x.lower&&O,score:Controller.Broadcast.scoreToString(x.upper)},lower:{winner:x.lower>x.upper&&O,score:Controller.Broadcast.scoreToString(x.lower)}}}}}return r.slide=i,r.pages=t(o,y),r}var c=this,d=jQuery(e),u=[];0===d.length&&errorHandler.msg("error",new Error("container not found"),!0,{container:d});var h,f,p,m,g,v,y;return Extend.Suspendable(c),Extend.Subscriber(c,{},{afterLink:function(e){for(var t=0;t<u.length;t++)u[t].link(e.publisher);v=e.publisher,i()},afterUnlink:function(e){for(var t=0;t<u.length;t++)u[t].unlink(e.publisher)}}),c},"undefined"==typeof View&&(View={}),View.KnockoutTreeMatch=function(e,t,n,i,r){function o(e,o){k=!!o.value;for(var a=h.getRounds(t),s=a[n].matches[i],l=1;r>=l;l++)s.games[l]&&c(l,s.games[l].gameStatus,s.games[1])}function a(e,r,o){switch(o.key){case"gameStatus":var a=e.publisher.getRounds(t)[n].matches[i].games[1];c(r,o.value,a),s(t,n,i);break;case"currentFen":d(r,o.value);break;case"player":u(r,o.value);break;case"engine":l(r,o.value)}return p}function s(e,t,n){var i=h.getAttribute(e,"matchGroups"),r=h.getAttribute(e,"rounds"),o={upper:0,lower:0},a={running:0,finished:0,upcoming:0},s=r[t].matches[n].games[1];for(var l in r[t].matches[n].games){var c=r[t].matches[n].games[l];if(a[c.gameStatus.status]=++a[c.gameStatus.status],s.player.white===c.player.white&&s.player.black===c.player.black)var d="white",u="black";else{if(s.player.white!==c.player.black||s.player.black!==c.player.white)continue;d="black",u="white"}c.gameStatus.result&&!isNaN(c.gameStatus.result[d])&&(o.upper+=c.gameStatus.result[d]),c.gameStatus.result&&!isNaN(c.gameStatus.result[u])&&(o.lower+=c.gameStatus.result[u])}var f=0===a.running&&i[t].contains(a.finished),p={upper:o.upper>o.lower&&f,lower:o.lower>o.upper&&f};y.removeClass("winnerPlayer").removeClass("loserPlayer"),b.removeClass("winnerPlayer").removeClass("loserPlayer"),p.upper&&!p.lower?(y.addClass("winnerPlayer"),b.addClass("loserPlayer")):!p.upper&&p.lower&&(y.addClass("loserPlayer"),b.addClass("winnerPlayer"))}function l(e,t){if(t){var n=v.find("div.gameId"+e).find("span.evalIndicator");n.children("span").stop(!0).animate({height:Controller.Broadcast.convertEvaluationToPercent(t,n.hasClass("reverse"))+"%"})}}function c(e,r,o){var a,s,l,c=v.find("div.gameId"+e);if("upcoming"===r.status)a={},l="knockoutTree_games_upcoming";else if("running"===r.status){var d=h.getRounds(t)[n].matches[i].games[e],u=o.player.white===d.player.white;if(void 0!==d.engine)var f=Controller.Broadcast.convertEvaluationToPercent(d.engine,u);else f=50;a={reverseEvaluationIndicator:u,evaluation:f,showEngine:k},l="knockoutTree_games_running"}else if("finished"===r.status){var d=h.getRounds(t)[n].matches[i].games[e];if(o.player.white===d.player.white&&o.player.black===d.player.black)var m="white",y="black";else o.player.white===d.player.black&&o.player.black===d.player.white&&(m="black",y="white");var b=Controller.Broadcast.scoreToString(r.result[m]),w=Controller.Broadcast.scoreToString(r.result[y]);a={upper:{winner:1===r.result[m],score:b,color:m},lower:{winner:1===r.result[y],score:w,color:y}},l="knockoutTree_games_finished"}s=g.render(l,a),c.html(s);var x=v.find("div.matchContainerInsider div.gameTable div.gameContainer dl > dt"),C=v.find("div.matchContainerInsider div.gameTable div.gameContainer dl > dd"),j=0,T=0;x.each(function(){var e=jQuery(this).html().trim();"1"===e?e=1:"0"===e?e=0:"½"===e?e=.5:"—"===e&&(e=0),j+=e}),C.each(function(){var e=jQuery(this).html().trim();"1"===e?e=1:"0"===e?e=0:"½"===e?e=.5:"—"===e&&(e=0),T+=e}),j=j%1!==0?(0===Math.floor(j)?"":Math.floor(j).toString())+" &frac12;":j,T=T%1!==0?(0===Math.floor(T)?"":Math.floor(T).toString())+" &frac12;":T;var _=v.find("div.finalResult"),S=_.find("dl > dt"),I=_.find("dl > dd");return S.html(j),I.html(T),p}function d(e,t){if(f instanceof Chess.Game){var n=new Chess.Position({fen:t});f.setStartPosition(n)}return p}function u(e,n){if(1===e){var i="knockoutTree_player",r=v.find("div.upperPlayer"),o=v.find("div.lowerPlayer");for(var a in n){var s=g.render(i,Object.extend({id:n[a]},h.getPlayer(t,n[a])));switch(a){case"white":r.html(s).find("> h6 > span").addPlayerTournamentStatistics(t);break;case"black":o.html(s).find("> h6 > span").addPlayerTournamentStatistics(t)}}return p}}var h,f,p=this,m=new Controller.Broadcast,g=m.getTemplates(),v=jQuery(e);0===v.length&&errorHandler.msg("error",new Error("container not found"),!0,{container:v}),void 0===t&&errorHandler.msg("error",new Error("no tournamentId given"),!0),(void 0===n||isNaN(n))&&errorHandler.msg("error",new Error("no roundId given"),!0),(void 0===i||isNaN(i))&&errorHandler.msg("error",new Error("no matchId given"),!0),(void 0===r||isNaN(r)||1>r)&&errorHandler.msg("error",new Error("invalid gamesPerMatch given"),!0);var y=v.find(".upperPlayer"),b=v.find(".lowerPlayer"),w=v.find(".gameContainer"),k=window.settings.getBoolean("game-broadcast-engine");y.find("> h6 > span").addPlayerTournamentStatistics(t),b.find("> h6 > span").addPlayerTournamentStatistics(t),w.each(function(e){var r=e+1;if(!jQuery(this).hasClass("gameId"+r))return!1;var o=jQuery(this);o.data("gamePath",{roundId:n,matchId:i,gameId:r}),o.on("click",function(){var e=h.getRounds(t);if(e[n].matches[i].games[r]){try{hideChessBoardBubble()}catch(o){}return m.showGame(t,n,i,r),!1}})}),new View.GameTooltip(w,t);for(var x={},C=1;r>=C;C++)!function(e){x["set."+t+":"+n+":"+i+":"+e]=function(t,n){a(t,e,n)}}(C);return Extend.Suspendable(p),Extend.Subscriber(p,x,{afterLink:function(e){h=e.publisher}}),window.settings.on("settings.game-broadcast-engine",o),p},"undefined"==typeof View&&(View={}),View.MultiBoard=function(e,t,n,i,r){function o(e,t){w=!!t.value,d(i)}function a(e){return x.shorterFirstName(e,15)}function s(){for(;D.length;)D.shift()()}function l(e){var n=e.publisher.getAttribute(t,"currentRound");T.setCurrentRound(n,1)}function c(e){var n=new Handler.Template,i=k.getAttribute(t,"players")[e],r={Name:i.name,Title:i.title,Elo:i.elo,Country:i.country,Link:i.link,FideId:e,Picture:i.picture||n.render("playerImageUrl",{fideId:e})},o=k.getAttribute(t,"c24");return o&&(r.UUID=e),r}function d(e){if(void 0!==e){if(i!=e){var r=x.getCurrentGamePath();e==r.match?(g=r.match,m=r.game):(g=void 0,m=void 0)}i=e}0===P.length&&Object.forEach(k.getAttribute(t,"rounds")[n].matches[i].games,function(e,t){P.push({matchId:i,gameId:t})}),O=p(),d.delegate=d.delegate||function(){d()};var o=k.getTournamentPR(t);o.off("set.rounds",d.delegate),O.games.length||o.on("set.rounds",d.delegate),y=Math.ceil(O.games.length/_),v=0,b||(C&&!M&&k.on("set."+t+".teams",h),j&&k.on("set."+t+".currentRound",l),b=!0),u()}function u(){I.html(E.render("multiboard.main",Object.merge(O,{games:O.games.slice(v*_,(v+1)*_),renderLinks:!!B}))),layout(I),s();for(var e=v*_;e<O.games.length&&(v+1)*_>e;e++)!function(e){function i(){var e=k.getRounds(t),i=e[n].matches[l].games[d];if(!i)return A[u].setStartPosition(new Chess.Position),f&&f.setValue(A[u].getEngine()),void A[u].emit("clock",{});if(i.earlierFen||i.lastMoves){if(A[u].setStartPosition(new Chess.Position({fen:i.earlierFen})),i.lastMoves){for(var r=0;r<i.lastMoves.length;r++)A[u].move(i.lastMoves[r],void 0,void 0,void 0,void 0,!0);A[u].emit("clock",{timeSpendInThisMove:1})}}else A[u].setStartPosition(new Chess.Position({fen:i.currentFen}));void 0!==i.engine&&f&&f.setValue(i.engine),A[u].emit("clock",{timeSpendInThisMove:1})}function o(){if(f){var e=k.getRounds(t),i=e[n].matches[l].games[d];i&&void 0!==i.engine&&f.setValue(i.engine)}}function s(e,t){t.value.result?A[u].setGameEndByPoints(t.value.result.white,t.value.result.black,void 0,!0):A[u].setGameStatus("OPEN",void 0,!0)}var l=e.matchId,d=e.gameId,u=l+"-"+d,h=I.find(".gameId"+u);if(A[u]=new Chess.Game({fen:e.fen}).setMoveMode(S).setNoTimeout(!0),!j&&w)var f=new View.EvalIndicator(h.find(".evalIndicator"),void 0,"vertical");else h.find(".evalIndicator").remove(),h.addClass("noEval");A[u].setMeta("White",c(e.reverse?e.playerA:e.playerB)),A[u].setMeta("Black",c(e.reverse?e.playerB:e.playerA));var p=[new View.PlayerInfo(h.find(".playerAMeta"),e.reverse?"w":"b",a,t).link(A[u]),new View.PlayerInfo(h.find(".playerBMeta"),e.reverse?"b":"w",a,t).link(A[u]),new View.ChessBoard(h.find(".board"),!1).link(A[u])];if(e.reverse&&p[2].flip(),e.lastMoves){for(var v=0;v<e.lastMoves.length;v++)A[u].move(e.lastMoves[v],void 0,void 0,void 0,void 0,!0);A[u].emit("clock",{timeSpendInThisMove:1})}void 0!==e.engine&&f&&f.setValue(e.engine,!0),"finished"===e.gameStatus.status&&e.gameStatus.result&&A[u].setGameEndByPoints(e.gameStatus.result.white,e.gameStatus.result.black,void 0,!0);var y=T.delegate(i),b=T.delegate(o),x=T.delegate(s);k.on("set."+t+":"+n+":"+l+":"+d+".currentFen",y),k.on("set."+t+":"+n+":"+l+":"+d+".engine",b),k.on("set."+t+":"+n+":"+l+":"+d+".gameStatus",x),D.push(function(e,i){return function(){for(var r=0;r<e.length;r++)e[r].unlink(i);k.off("set."+t+":"+n+":"+l+":"+d+".currentFen",y),k.off("set."+t+":"+n+":"+l+":"+d+".engine",b),k.off("set."+t+":"+n+":"+l+":"+d+".gameStatus",x)}}(p,A[u])),r&&I.find(".gameId"+u+", .gameTrigger"+u).on("click",function(){var e=I.find(".gameId"+u);if(!e.hasClass("active")){g=l,m=d;var t=I.find(".gameTrigger"+u);I.find(".gameContainer.active, .gameTrigger.active").removeClass("active"),e.add(t).addClass("active"),r(n,l,d)}})}(O.games[e]);y-1>v?I.find(".nextPage").show().on("click",function(){v++,u()}):I.find(".nextPage").hide(),v>0?I.find(".previousPage").show().on("click",function(){v--,u()}):I.find(".previousPage").hide(),I.find(".gameContainer").length<=_/2?I.find(".previousPage, .nextPage").addClass("halfHeight"):I.find(".previousPage, .nextPage").removeClass("halfHeight"),g&&m&&T.setCurrentGame(g,m),C&&f(),I.find(".customize").on("click",function(){return config.level().isPremium?void new Dialog.GameSelector(t,n,P,function(e){P=e,v=0,M=P.length>0&&!!P.find(function(e,t){return t>0&&e.matchId!=P[0].matchId}),!M&&P.length&&(g=P[0].matchId);var r=k.getAttribute(t,"gamesPerMatch")||Object.getLength(k.getAttribute(t,"rounds")[n].matches[1].games);Q=M||P.length!=r,d(i)}):void new Dialog.conversionGoPremium("multiboard")}),I.find(".reset").toggleClass("hidden",!Q).on("click",function(){config.level().isPremium&&(P=[],v=0,M=!1,Q=!1,d(i))})}function h(){var e=E.render("multiboardTeamHeader",p());e&&(jQuery("div.teamMultigameView > header",I).replaceWith(e),F),f(),layout(I)}function f(){I.find(".dropdownFilter").off("chess24:show").on("chess24:show",function(e){return e.stopPropagation(),!1}).off("chess24:hide").on("chess24:hide",function(e){return e.stopPropagation(),!1}).find("input:radio").off("change").on("change",function(){P=[],d(jQuery(this).val())})}function p(){function e(e){if("undefined"!=typeof l[e])return l[e];for(var t in o)for(var n in o[t].rooster)if(o[t].rooster[n]==e)return l[e]=t,t}var r=k.getAttribute(t,"rounds"),o=k.getAttribute(t,"teams"),a=k.getAttribute(t,"players"),s=k.getAttribute(t,"standings"),l={},c=r[n].matches[i];if(!c)return void errorHandler.msg("error",new Error("there is no match to display"),!0,{round:r[n],matchId:i});var d={id:i,games:[],matches:[],multiMatch:M};C&&!M&&jQuery.extend(d,{teamEvent:!0,teamA:o[c.teams[1]].name,teamB:o[c.teams[2]].name,scoreA:0,scoreB:0,eloA:0,eloB:0,standingA:s.round.indexOf(c.teams[1])+1,standingB:s.round.indexOf(c.teams[2])+1,resultsA:k.getTeamResults(t,c.teams[1],n-1),resultsB:k.getTeamResults(t,c.teams[2],n-1)});var u=0,h=0;if(P.forEach(function(i){if(x.snapshotsAvailable(t,n,i.matchId,i.gameId)){var o=r[n].matches[i.matchId].games[i.gameId];if(C&&!M){var s={white:e(o.player.white),black:e(o.player.black)},l=s.white===c.teams[1],f=l?"white":"black",p=l?"black":"white";d.eloA+=a[o.player[f]].elo||0,d.eloB+=a[o.player[p]].elo||0,u+=a[o.player[f]].elo?1:0,h+=a[o.player[p]].elo?1:0,d.scoreA+=o.gameStatus.result&&o.gameStatus.result[f]||0,d.scoreB+=o.gameStatus.result&&o.gameStatus.result[p]||0}else l=!1,f="black",p="white";d.games.push({matchId:i.matchId,gameId:i.gameId,fen:o.earlierFen||o.lastMoves&&Chess.defaultFen||o.currentFen,lastMoves:o.lastMoves,gameKey:o.fullGameRKey,reverse:l,playerA:o.player[f],playerB:o.player[p],engine:o.engine,gameStatus:o.gameStatus,own:[o.player.white,o.player.black].contains(config.user().uuid),url:B?Handler.Template.renderString(B,{tournamentId:t,roundId:n,matchId:i.matchId,gameId:i.gameId}):null})}}),C&&!M){d.eloA=u?Math.round(d.eloA/u):0,d.eloB=h?Math.round(d.eloB/h):0,d.scoreA=Controller.Broadcast.scoreToString(d.scoreA),d.scoreB=Controller.Broadcast.scoreToString(d.scoreB);for(var f in r[n].matches)if(r[n].matches[f].teams&&r[n].matches[f].teams[1]&&r[n].matches[f].teams[2]){var p=C?o[r[n].matches[f].teams[1]]:void 0,m=C?o[r[n].matches[f].teams[2]]:void 0,g=k.getTeamResultsForRound(t,r[n].matches[f].teams[1],n),v=k.getTeamResultsForRound(t,r[n].matches[f].teams[2],n);d.matches.push({id:f,active:f==i,teamA:p?p.name:void 0,teamB:m?m.name:void 0,pointsA:Controller.Broadcast.scoreToString(g.bp),pointsB:Controller.Broadcast.scoreToString(v.bp)})}}else for(var f in r[n].matches)d.matches.push({id:f});return d}var m,g,v,y,b,w=window.settings.getBoolean("game-broadcast-engine"),k=new Controller.BroadcastTournament,x=new Controller.Broadcast,C=k.isTeamEvent(t),j=!!k.getAttribute(t,"c24"),T=this,_=8,S={mainline:!0,sideline:!0};S={duringGame:S,afterGame:S};var I=jQuery(e),P=[],M=!1,Q=!1,B=I.data("game-url");I.length||errorHandler.error(new Error("container not found"),{container:I}),t&&n&&i||errorHandler.error(new Error("missing information about match to be displayed"),{container:I,tournamentId:t,roundId:n,matchId:i});var E=new Handler.Template("broadcast"),O={},A={},D=[];return Extend.Suspendable(T,!0),T.onResume(function(e){e&&(w=window.settings.getBoolean("game-broadcast-engine"),d())}),window.settings.on("settings.game-broadcast-engine",T.delegate(o)),T.setCurrentGame=function(e,t){g=e,m=t;var n=e+"-"+t;I.find(".gameContainer.active, .gameTrigger.active").removeClass("active");var i=I.find(".gameId"+n);return i.length&&i.add(I.find(".gameTrigger"+n)).addClass("active"),T},T.setCurrentRound=function(e,t){return Q?T:(n!==e&&(P=[],n=e,d(t)),T)},T.setItemsPerPage=function(e){return _=e,T.isSuspended()||d(),T},T},"undefined"==typeof View&&(View={}),View.OpenGames=function(e,t,n,i){function r(e,t){E=!!t.value,o(Q)}function o(e){a(e),b(e)}function a(n){Q=n;var r=j.getAttribute(t,"rounds"),o=l(n);o.header=i,e.html(_.render("open."+(o.totalGames?"games":"nogames"),o));var c=Object.reduce(r,function(e,t,n){return e.push(t.label&&t.label[config.language()]||t.label||n),e},[]),d=c.reduce(function(e,t){return Math.max(e,(""+t).length)},0),u=3>d?3:5>d?2:1;if(e.find(".pager").pager({live:j.getAttribute(t,"currentRound"),current:n,margin:u,values:Object.keys(r),labels:c},a),!j.getAttribute(t,"unpredictableSchedule"))if(o.roundStartCountdown){e.find(".noGamesSimple, .noGamesCurrent, .roundStarted").hide(),e.find(".noGamesCounter, .futureGameCountdown").show();var h=e.find(".noGamesCounter .time, .futureGameCountdown .time");s(o.startDate,h.filter(".hours"),h.filter(".minutes"),h.filter(".seconds"),function(){e.find(".noGamesCounter").hide(),e.find(".noGamesSimple").toggle(!o.roundIsCurrentlyRunning),e.find(".noGamesCurrent").toggle(o.roundIsCurrentlyRunning),e.find(".roundStarted").show(),e.find(".futureGameCountdown").hide()})}else e.find(".noGamesSimple").toggle(!o.roundIsCurrentlyRunning),e.find(".noGamesCurrent").toggle(o.roundIsCurrentlyRunning),e.find(".roundStarted").show(),e.find(".futureGameCountdown").hide();layout.scrollableTables(e),layout.inputElements(e),layout.userMiniprofile(e),w(n)}function s(e,t,n,i,r){clearTimeout(P);var o=e-Controller.Broadcast.offsetCorrectedDateNow();if(0>=o)return n.html("0"),i.html("00"),void r();var a=Math.floor(o/1e3)%60,l=Math.floor(o/6e4)%60,c=Math.floor(o/36e5);c>0?t.html(c).add(t.next()).show():t.add(t.next()).hide(),l>0?n.html(l).add(n.next()).show():n.add(n.next()).hide(),i.html(a),P=setTimeout(function(){s(e,t,n,i,r)},1e3-Controller.Broadcast.offsetCorrectedDateNow()%1e3)}function l(e){e=e||1;var n=j.getRounds(t),i=j.getAttribute(t,"currentRound")||1,r="finished"===j.getAttribute(t,"status")||i>e,o=!["finished","cancelled"].contains(j.getAttribute(t,"status"))&&e==i,a=n[e],s=j.isKnockoutEvent(t),l={games:[],startDate:a.startDate,playzoneTournament:!!j.getAttribute(t,"c24"),totalGames:0,runningGames:0,unpredictableSchedule:j.getAttribute(t,"unpredictableSchedule"),tournamentFinished:"finished"==j.getAttribute(t,"status"),showOnlyRunningGames:A,roundIsCurrentlyRunning:o},d=Controller.Broadcast.offsetCorrectedDateNow();a.startDate>d&&(l.roundStartCountdown=a.startDate-d),l.roundStart=Helper.getFormatedLocalDateTime(a.startDate),B=j.getAllPlayersPoints(t,e-1);for(var u in a.matches){u=parseInt(u);var h=a.matches[u];for(var f in h.games){f=parseInt(f);var p=c(e,u,f,h.games[f],r);p&&(p.drawLine=s&&u>1&&1==f,l.games.push(p),l.runningGames+=p.status.finished?0:1),l.totalGames++}}return l}function c(e,n,i,r,o){if(o||!A||!r.gameStatus||"finished"!==r.gameStatus.status){var a=u(t,r.player.white),s=u(t,r.player.black),l=T.getGameUrl(t,e,n,i);return Object.extend({showIndex:!0,tournamentId:t,roundNo:e,matchNo:n,gameNo:i,embedUrl:T.isEmbedded(),player:{white:a,black:s},url:l,own:[r.player.white,r.player.black].contains(config.user().uuid),bye:r.gameStatus&&"TOURNAMENT_BYE"===r.gameStatus.endedBy},d(r))}}function d(e){var n=E&&!j.getAttribute(t,"c24");if(n)var i=Controller.Broadcast.convertEvaluationToPercent(e.engine,!0);return{showEngine:n,engine:i,status:h(e)}}function u(e,t){var n=Object.merge(j.getPlayer(e,t));return O||(n.name=T.shorterFirstName(n.name)),n.id=t,n.score=Controller.Broadcast.scoreToString(B[t]||0),n.showScore=S,n}function h(e,n){n=n||!1;var i={};if("upcoming"===e.gameStatus.status)i={upcoming:!0,reverse:n};else if("running"===e.gameStatus.status){if(j.getAttribute(t,"c24"))return i={upcoming:!0,reverse:n};var r=Controller.Broadcast.convertEvaluationToPercent(e.engine,n);i={running:!0,reverse:n,evaluation:r}}else if("finished"===e.gameStatus.status){var o=n?"black":"white",a=n?"white":"black",s=e.gameStatus.result&&e.gameStatus.result[o]||0,l=e.gameStatus.result&&e.gameStatus.result[a]||0,c={color:o,score:Controller.Broadcast.scoreToString(s),won:1===s},d={color:a,score:Controller.Broadcast.scoreToString(l),won:1===l};i={finished:!0,reverse:n,playerA:c,playerB:d}}return i}function f(){for(;D.length>0;){var e=D.pop();e.publisher.off(e.channel,e.callback)}}function p(){if(A&&"finished"===j.getAttribute(t,"status"))return A=!1,void o(Q);var e=j.getRounds(t),n=0,i=e[Q];for(var r in i.matches)"object"==typeof i.matches[r].games&&(n+=Object.getLength(i.matches[r].games));n!==I&&o(Q)}function m(t,i){n&&Q!==n?e.find(".pager").pager({update:{live:i.value}}):M=setTimeout(function(){n=Q=i.value,o(Q)})}function g(n,i){var r=c(i.roundId,i.matchId,i.gameId,i.full),o=e.find(".gameId"+i.gameId+".gameOfMatch"+i.matchId);if(o.length){var a=jQuery(_.render("open.game",r));o.find("td").each(function(e){jQuery(this).empty().html(jQuery(a.find("td")[e]).html())}),new View.GameTooltip(o,t),o.find("td > h6 > a").addPlayerTournamentStatistics(t)}}function v(n,i){var r=e.find(".roundNo"+i.roundId+".gameId"+i.gameId+".gameOfMatch"+i.matchId+" > .tScore");r.length&&(r.html(_.render("open.games.entry",d(i.full))),new View.GameTooltip(r.parent(),t))}function y(n,i){k();var r=e.find(".gameId"+i.gameId+".gameOfMatch"+i.matchId);if(A&&"finished"===i.value.status)return r.prev().is("tr")||x(r),void r.remove();var o=r.children(".tScore");o.html(_.render("open.games.entry",d(i.full))),new View.GameTooltip(o.parent(),t)}function b(e){f();var n=j.getRounds(t),i=n[e];clearTimeout(M),j.on("set."+t+".status set."+t+".totalNumberOfGames",p.delegate),D.push({publisher:j,channel:"set."+t+".status",callback:p.delegate}),D.push({publisher:j,channel:"set."+t+".totalNumberOfGames",callback:p.delegate}),j.on("set."+t+".currentRound",m.delegate),D.push({publisher:j,channel:"set."+t+".currentRound",callback:m.delegate});for(var r in i.matches){var o=i.matches[r];for(var a in o.games){var s="set."+t+":"+e+":"+r+":"+a,l=s+".player";j.on(l,g.delegate),D.push({publisher:j,channel:l,callback:g.delegate}),l=s+".engine",j.on(l,v.delegate),D.push({publisher:j,channel:l,callback:v.delegate}),l=s+".gameStatus",j.on(l,y.delegate),D.push({publisher:j,channel:l,callback:y.delegate})}}}function w(n){function i(t,i,o,a){var l=r[n].matches[s].games[c].gameStatus;if(!l||"TOURNAMENT_BYE"!==l.endedBy){var d=e.find(".gameContainer.gameId"+a+".gameOfMatch"+o);d.data("gamePath",{roundId:i,matchId:o,gameId:a}),d.on("click.game",function(){return T.showGame(t,n,o,a),!1})}}n=n||1;var r=j.getRounds(t),a=r[n];for(var s in a.matches){var l=a.matches[s];for(var c in l.games)i(t,n,s,c)}var d=e.find(".gameContainer");new View.GameTooltip(d,t),d.find("td > h6 > a").addPlayerTournamentStatistics(t),e.find(".runningGames input:checkbox").on("click",function(){A=jQuery(this).is(":checked"),o(Q)})}function k(){var n=j.getAttribute(t,"rounds")[Q],i=Object.reduce(n.matches,function(e,t){return e+Object.reduce(t.games,function(e,t){return e+(t.gameStatus&&"finished"===t.gameStatus.status?0:1)},0)},0);i&&e.find(".runningGames span.counter").html(i)}function x(e){var t=e.next("tr:visible");if(t.length){var n=e.find("td"),i=t.find("td");n.each(function(e){i.eq(e).css("width",jQuery(this).css("width"))})}}var C=this;n=n||1;var j,T=new Controller.Broadcast,_=T.getTemplates();e=jQuery(e);var S,I,P,M,Q=n,B={},E=window.settings.getBoolean("game-broadcast-engine"),O=e.hasClass("fullWidth"),A=!1,D=[];return 0===e.length&&errorHandler.error(new Error("container not found in OpenGames view")),Extend.Subscriber(C,{},{afterLink:function(e){j=e.publisher,S=j.showPlayerScoreHistory(t),C.isSuspended()||o(n||j.getAttribute(t,"currentRound"))}}),Extend.Suspendable(C,!0),C.onResume(function(e){e&&(E=window.settings.getBoolean("game-broadcast-engine"),o(Q||j.getAttribute(t,"currentRound")))}),r.delegate=C.delegate(r),p.delegate=C.delegate(p),m.delegate=C.delegate(m),g.delegate=C.delegate(g),y.delegate=C.delegate(y),v.delegate=C.delegate(v),window.settings.on("settings.game-broadcast-engine",r.delegate),C},"undefined"==typeof View&&(View={}),View.OpenStandings=function(e,t){function n(e){return x[e]&&x[e].length||(x[e]=k.find("tr.player"+e)),x[e]}function i(e){n(e).remove(),delete x[e]}function r(e,t){if(!t.value||!t.value.live||!t.value.live.length)return g=void 0,clearTimeout(a.timer),void(a.timer=setTimeout(a));if(g&&!a.timer){var n=l(t.value.live,g);if(!n)return;s(n),g=t.value.live}else clearTimeout(a.timer),a.timer=setTimeout(a)}function o(e,i){i.diff&&!a.timer?(Object.forEach(i.diff,function(e,i){var r=n(i);if(e&&r.length){var o=$(y.render("open.standingsPlayer",u(i)));r.replaceWith(o),x[i]=o,o.find(".ofMiniProfile").addMiniprofile(),o.children(".playerStatistics").addPlayerTournamentStatistics(t)}}),h()):(clearTimeout(a.timer),a.timer=setTimeout(a))}function a(){a.timer=null;var e=p.getAttribute(t,"standings");c(d(e)),e&&e.live&&e.live.length&&(g=e.live)}function s(r){var o=p.getAttribute(t,"standings"),a=o.live.reduce(function(e,t,n){return e[t]=n,e},{});r.removed.forEach(i),r.added.forEach(function(n){var i=$(y.render("open.standingsPlayer",Object.merge(u(n),{playzoneTournament:m}))),r=a[n],o=k.find("tr.player:eq("+r+")");o.length?o.before(i):e.find(".items tbody").append(i),i.find(".ofMiniProfile").addMiniprofile(),i.children(".playerStatistics").addPlayerTournamentStatistics(t)}),(r.added||r.removed)&&f(o.live.length),r.moved.sort(function(e,t){return a[t]-a[e]}),r.moved.forEach(function(e){var t=n(e),i=a[e],r=k.find("tr.player:eq("+i+")");t.insertBefore(r),t.find(".rank:first").html(i+1)})}function l(e,t){var n=t.reduce(function(e,t,n){return e[t]=n,e},{}),i=e.reduce(function(e,t,n){return e[t]=n,e},{}),r={added:[],removed:[],moved:[]};return t.forEach(function(e){void 0===i[e]?r.removed.push(e):i[e]!==n[e]&&r.moved.push(e)}),e.forEach(function(e){void 0===n[e]&&r.added.push(e)}),r.added.length||r.removed.length||r.moved.length?r:!1}function c(n){n&&n.players.length?(e.html(y.render("open.standings",n)),e.find(".playerStatistics").addPlayerTournamentStatistics(t)):e.html(y.render("open.nostandings",n)),layout.scrollableTables(e),layout.userMiniprofile(e),b=e.find(".avgElo"),w=e.find(".playerCount"),k=e.find(".tournamentTable .items"),x={},h()}function d(e){if(e&&e.live){e.live instanceof Array||"object"!=typeof e.live||(e.live=Object.values(e.live));for(var t={players:[],playzoneTournament:m},n=0;n<e.live.length;n++){var i=e.live[n],r=u(i);r&&t.players.push(r)}return t.noOfPlayers=t.players.length,t}}function u(e,n){if("unknown"!==e){var i=p.getPlayer(t,e);if(i){if(void 0===n){var r=p.getAttribute(t,"standings");n=parseInt(Object.findKey(r.live,function(t,n){return t===e}),10)}var o=p.getPlayerResults(t,e,"live");return{playzoneTournament:m,id:e,rank:n+1,score:Controller.Broadcast.scoreToString(o.p||0),
games:o.games||0,name:i.name,url:i.link,country:i.country,elo:i.elo,attributes:m&&{title:i.title&&{code:i.title,name:i.titleName},moderator:1==i.moderator,fraud:1==i.fraud,cop:1==i.cop,staff:1==i.staff,premium:1==i.premium},removed:i.removed,own:e===config.user().uuid}}}}function h(){var e=p.getAttribute(t,"players");if(e){var n=Object.reduce(e,function(e,t){var n=parseInt(t.elo,10);return n&&(e.elo+=n,e.count++),e},{elo:0,count:0});n.count>0&&b.html(Math.round(n.elo/n.count))}}function f(e){w.html(e)}var p,m,g,v=this,y=new Handler.Template("broadcast").append(new Handler.Template);e=jQuery(e);var b,w,k,x={};e.length||errorHandler.error("container not found in View.OpenStandings"),Extend.Suspendable(v,!0);var C=v.delegate(function(e,t){_.add(function(){r.call(v,e,t)})}),j=v.delegate(function(e,t){_.add(function(){o.call(v,e,t)})}),T={};T["set."+t+".standings"]=C,T["set."+t+".players"]=j,T["set."+t+".currentRound"]=C,Extend.Subscriber(v,T,{afterLink:function(e){p=e.publisher,C(e,{value:e.publisher.getAttribute(t,"standings")}),m=!!p.getAttribute(t,"c24")}}),v.onResume(function(e){e&&p&&a()});var _=rateLimit.createQueue({interval:50});return v},"undefined"==typeof View&&(View={}),View.OverviewButton=function(e,t,n,i,r){function o(){s();var e=u.getAttribute(t,"c24");if(e){var n=l();n&&(a(n.roundId,n.matchId,n.gameId),c(n.roundId,n.matchId,n.gameId))}}function a(o,a,l){return o==n&&a==i&&l==r?void s():void(o&&a&&l&&e.addClass("goToMyGame").off("click.overviewbutton").on("click.overviewbutton",function(){return h.showGameWhenReady(t,o,a,l),!1}))}function s(){d(),e.removeClass("goToMyGame"),e.off("click.overviewbutton").on("click.overviewbutton",function(){return h.showOverview(jQuery(this).attr("href")),jQuery("body").removeClass("boardXL"),!1})}function l(){var e=u.getAttribute(t,"rounds");for(var o in e)for(var a in e[o].matches)for(var s in e[o].matches[a].games){var l=e[o].matches[a].games[s];if((l.player.white==config.user().uuid||l.player.black==config.user().uuid)&&"running"==l.gameStatus.status){if(o==n&&i==a&&r==s)return;return{roundId:o,matchId:a,gameId:s}}}}function c(e,n,i){d(),c.current={event:"set."+t+":"+e+":"+n+":"+i+".currentFen",handler:function(){a(e,n,i)}},u.on(c.current.event,c.current.handler)}function d(){c.current&&(u.off(c.current.event,c.current.handler),c.current=void 0)}var u=new Controller.BroadcastTournament,h=new Controller.Broadcast,e=jQuery(e);0===e.length&&errorHandler.msg("error",new Error("container not found"),!0,{container:e});return self.switchGame=function(e,a,s,l){t=e,n=a,i=s,r=l,o()},o(),self},"undefined"==typeof View&&(View={}),View.PgnDownload=function(e,t,n,i,r){function o(){s=s||new Handler.Template("broadcast"),l=l||new Controller.BroadcastTournament;var o=config.level().isPremium,a=l.getAttribute(t,"pgnDownload");if(a){var c=Date.parse(a.freeUntil);c&&c>Date.now()&&(o=!0)}e.html(s.render("game.pgnDownload",{tournamentId:t,roundId:n,matchId:i,gameId:r,isPremium:o,showMatch:l.hasMatches(t)}));var d=e.find("a");d.on("click",function(){return o?(Handler.tracking("pgn","broadcast"),!0):(Handler.tracking("pgn","broadcastConversion"),Dialog.conversionGoPremium("pgnDownload"),!1)})}var a=this;e=jQuery(e),e.length||errorHandler.error(new Error("container not found in View.PgnDownload")),Extend.Suspendable(a,!0),a.onResume(o);var s,l,c=a.delegate(o);return a.changeGame=function(e,o,a,s){t=e,n=o,i=a,r=s,c()},e.data("view",a),a},"undefined"==typeof View&&(View={}),View.RoundNavigation=function(e,t,n,i,r){function o(){var r=e.find("a.previous"),o=e.find("a.next"),l=m.getAttribute(t,"rounds"),c=g.getCurrentGamePath(),d=l[c.round].matches[c.match].games[c.game]&&l[c.round].matches[c.match].games[c.game].player;if(d){e.find(".dropdownFilterTitle").html(v.render("navigation.current",{active:e.find(".dropdownFilter").hasClass("active"),current:{white:m.getPlayer(t,d.white),black:m.getPlayer(t,d.black)}})).on("click",function(){p.removeClass("new")});var u=a(c);r.off("click"),u.previous?r.removeClass("disabled").attr("href",g.getGameUrl(t,c.round,u.previous.matchId,u.previous.gameId)).on("click",function(){return g.showGame(t,c.round,u.previous.matchId,u.previous.gameId),n=c.round,i=u.previous.matchId,s(),!1}):r.addClass("disabled").removeAttr("href"),o.off("click"),u.next?o.removeClass("disabled").attr("href",g.getGameUrl(t,c.round,u.next.matchId,u.next.gameId)).on("click",function(){return g.showGame(t,c.round,u.next.matchId,u.next.gameId),n=c.round,i=u.next.matchId,s(),!1}):o.addClass("disabled").removeAttr("href")}}function a(e){var r=m.getAttribute(t,"rounds"),o=Object.keys(r[e.round].matches),a=o.shift(),s=o.pop(),l=parseInt(e.match,10),c=Object.keys(r[n].matches[i].games),d=c.shift(),u=c.pop();if(parseInt(e.game,10)>d)var h={matchId:e.match,gameId:e.game-1};else if(parseInt(e.match,10)>a){var f=Object.keys(r[e.round].matches[l-1].games).pop();h={matchId:e.match-1,gameId:f}}else h=void 0;if(e.game<u)var p={matchId:e.match,gameId:parseInt(e.game,10)+1};else if(e.match<s){var g=Object.keys(r[e.round].matches[l+1].games).shift();p={matchId:parseInt(e.match,10)+1,gameId:g}}else p=void 0;return{previous:h,next:p}}function s(i){u=m.getAllPlayersPoints(t,n-1),y=l(),y.active=i,e.find(".dropdownFilterTitle").html(v.render("navigation.current",y)),e.find(".prevGame").html(v.render("navigation.prev",y)),e.find(".nextGame").html(v.render("navigation.next",y)),p=e.find(".dropdownFilterNotification"),p.html(v.render("navigation.notification",y)),f=p.find("span");var r=e.find(".gameContainer");new View.GameTooltip(r,t),r.find("td h6").addPlayerTournamentStatistics(t),o()}function l(){var e=m.getAttribute(t,"rounds"),i=m.getAttribute(t,"players"),r=g.getCurrentGamePath(),o=e[r.round]&&e[r.round].matches[r.match]&&e[r.round].matches[r.match].games[r.game],s=a(r),l={tournamentIdPrevious:t,roundNoPrevious:n,matchNoPrevious:s.previous?s.previous.matchId:void 0,gameNoPrevious:s.previous?s.previous.gameId:void 0,tournamentIdNext:t,roundNoNext:n,matchNoNext:s.next?s.next.matchId:void 0,gameNoNext:s.next?s.next.gameId:void 0,embedUrl:g.isEmbedded()};return o&&o.player&&(l.current={white:i[o.player.white],black:i[o.player.black]}),l}function c(){var e=m.getAttribute(t,"currentRound"),n=f.data("template");f.attr("data-tooltip",Handler.Template.renderString(n,{round:e})),p.addClass("new")}function d(){m.on("set."+t+".players",h.delegate(function(t,n){Object.some(n.diff,function(e){return!e||Object.getLength(e)>2||!e.results})&&s(e.find(".dropdownFilter").hasClass("active"))})),m.on("set."+t+".currentRound",h.delegate(function(e,t){c()}))}var u,h=this;e=jQuery(e),e.length||errorHandler.error("container not found for View.RoundNavigation"),t&&n||errorHandler.error("missing information about match to be displayed in View.RoundNavigation");var f,p,m=new Controller.BroadcastTournament,g=new Controller.Broadcast,v=g.getTemplates(),y={};e.html(v.render("navigation.main"));var b,w=e.find(".gamesList");return b=m.isTeamEvent(t)?new View.TeamRoundRobin(w,t,n):new View.OpenGames(w,t,n,!1).link(m),Extend.Suspendable(h),h.onSuspend(function(){b.suspend()}),h.onResume(function(t){t&&s(t),e.find(".dropdownFilter").hasClass("active")&&b.resume(t)}),e.find(".dropdownFilter").on("chess24:hide",function(){b.suspend()}),e.find(".dropdownFilter").on("chess24:show",function(){b.resume()}),h.setCurrentGame=function(e,a,l,c,d){return d||i!=l||r!=c||t!=e||n!=a?d||t!=e||n!=a?(t=e,n=parseInt(a,10),i=parseInt(l,10),r=parseInt(c,10),s(),h):(i=parseInt(l,10),r=parseInt(c,10),o(),jQuery(document).trigger("click"),h):h},d(),s(),h},"undefined"==typeof View&&(View={}),View.StandingsBetting=function(e,t){function n(){var n=m.getAttribute(t,"betting");if(n.standings){var i=n.standings&&n.standings.description;"object"==typeof i&&(i=i[config.language()]||i[Object.keys(i)[0]]),e.html(g.render("betting.standings",{description:i,tournamentFinished:w})),v=e.find(".bet"),jQuery.getJSON("/api/web/broadcastAPI/getStandingsBet",{id:t}).done(function(e){var n=e.data&&e.data.bet,i=n&&n.standings||m.getAttribute(t,"standings").live,r=n&&n.roundId||m.getAttribute(t,"currentRound"),a=n&&n.date||!1;o(i,r,a)}),w&&a(0)}}function i(){var e,t=dummy;v.find(".standings li").draggable({helper:"clone",addClasses:!1,zIndex:100,axis:"y",start:function(t,n){e=jQuery(this),n.helper.css("width",e.width()),e.addClass("currently-dragged")},stop:function(n,i){i.helper.remove(),e.removeClass("currently-dragged"),t=dummy,c()},drag:function(){t()}}).droppable({over:function(n,i){var r=jQuery(this),o=i.helper;t=function(){var t=r.position(),n=o.position();t.top>n.top?e.insertBefore(r):e.insertAfter(r)}}})}function r(){v.find("a.clear").on("click",function(){u()}),v.find("a.reset").on("click",function(){var e=m.getAttribute(t,"standings").live;d(e)}),v.find(".date").showAge()}function o(e,n,a){o.lastCall=arguments;var s=m.getAttribute(t,"betting"),c=!s.standings.closed&&(!s.standings.closeAt||s.standings.closeAt>Controller.Broadcast.offsetCorrectedDateNow());c&&s.standings.closeAt&&(clearTimeout(o.closeTimeout),o.closeTimeout=setTimeout(function(){l()},Math.max(0,s.standings.closeAt-Controller.Broadcast.offsetCorrectedDateNow())));var d=m.getAttribute(t,"players"),u=m.getAttribute(t,"standings").live,h=0,f=!1,p=e.map(function(e,t){var n=Object.merge(d[e],{index:t+1,id:e});return w&&(f?(n.betResult="wrong",u[t]!=e&&(n.correctName=d[u[t]].name)):u[t]==e?(n.betResult="correct",h++):(f=!0,n.betResult="wrong",n.correctName=d[u[t]].name)),n});v.empty().append(g.render("betting.standingsBet",{players:p,roundId:n,date:a,open:c,openUntil:s.standings.closeAt,correctBets:h,amountOfPlayers:u.length,tournamentFinished:w})),c&&i(),r()}function a(e,n){jQuery.getJSON("/api/web/broadcastAPI/getBettingLeaderboard",{id:t,page:e,highlight:!!n}).done(function(t){var n=t.data&&t.data.bet;e=t.data&&t.data.bet.page,s(n,e)})}function s(t,n){s.lastCall=arguments;var i=t.players,r=t.pages,o=e.find(".bettingLeaderboard .leaderboardList"),l=g.render("betting.list",{list:i});o.removeClass("loading").html(l),jQuery(document).trigger("newhtml");var c=jQuery(".bettingLeaderboard  .cPagination");r>0&&(n>0?(c.find(".goFirst").removeClass("inactive").find("a").off("click").on("click",function(){a(0)}),c.find(".goPrev").removeClass("inactive").find("a").off("click").on("click",function(){a(n-1)})):c.find(".goFirst, .goPrev").addClass("inactive").find("a").off("click"),r-1>n?(c.find(".goLast").removeClass("inactive").find("a").off("click").on("click",function(){a(r-1)}),c.find(".goNext").removeClass("inactive").find("a").off("click").on("click",function(){a(n+1)})):c.find(".goLast, .goNext").addClass("inactive").find("a").off("click"),e.find(".cBtn").removeClass("cBtnInactive").off("click").on("click",function(){a(0,!0)}))}function l(){o.lastCall&&o.apply(null,o.lastCall),s.lastCall&&s.apply(null,s.lastCall)}function c(){var e=v.find(".standings li").map(function(){return jQuery(this).data("id")}).toArray();d(e)}function d(e){e.compare(y)||(h(),y=e,jQuery.post("/api/web/broadcastAPI/setStandingsBet",{csrf:config.csrf(),id:t,standings:JSON.stringify(e)}).done(function(){var n=m.getAttribute(t,"currentRound"),i=Controller.Broadcast.offsetCorrectedDateNow();f(),o(e,n,i)}))}function u(){h(),y=void 0,jQuery.post("/api/web/broadcastAPI/clearStandingsBet",{csrf:config.csrf(),id:t}).done(function(){var e=m.getAttribute(t,"standings").live,n=m.getAttribute(t,"currentRound");f(),o(e,n,!1)})}function h(){v.find("ul").addClass("disabled"),v.find("li").draggable("disable")}function f(){v.find("ul").removeClass("disabled"),v.find("li").draggable("enable")}var p=this,m=new Controller.BroadcastTournament,g=new Handler.Template("broadcast");e=jQuery(e);var v,y;0===e.length&&errorHandler.error(new Error("container not found"),{container:e}),m.on("set."+t+".betting",l);var b=m.getAttribute(t,"status"),w="finished"===b;return Extend.Suspendable(p,!0),p.onResume(function(e){e&&n()}),p},"undefined"==typeof View&&(View={}),View.StandingsTable=function(e,t,n){function i(){"teamRoundRobin"===s.getAttribute(t,"eventType")?r():o(),a()}function r(){var i=s.getAttribute(t,"rounds"),r=s.getAttribute(t,"teams"),o=s.getAttribute(t,"standings").live||[],a=s.getAttribute(t,"currentRound"),l=s.getAttribute(t,"gamesPerMatch")/2,c=o.reduce(function(e,t,n){return e[t]=parseInt(n,10),e},{}),u=o.map(function(){return o.map(function(){return{played:!1,bp:0}})}),h=o.map(function(){return 0});Object.forEach(i,function(e,t){e.unrated||n&&t>n||Object.forEach(e.matches,function(e,n){var i=e.teams[1],o=e.teams[2],a=c[i],s=c[o];if(void 0!==a&&void 0!==s&&r[i].results.rounds[t]&&r[o].results.rounds[t]){var d=r[i].results.rounds[t].bp,f=t>1?r[i].results.rounds[t-1].bp:0,p=r[o].results.rounds[t].bp,m=t>1?r[o].results.rounds[t-1].bp:0,g=d-f,v=p-m;if(d||p){var y=g>=l||v>=l;u[a][s].played=y,u[a][s].opponent=r[o],u[a][s].bp=(u[a][s].bp||0)+g,u[a][s].game={roundId:t,matchId:n,gameId:1},u[s][a].played=y,u[s][a].opponent=r[i],u[s][a].bp=(u[s][a].bp||0)+v,u[s][a].game={roundId:t,matchId:n,gameId:1},y&&(h[a]++,h[s]++)}}})});var f=u.map(function(e,t){var n=r[o[t]],i=e.map(function(e,n){var i=r[o[n]];return t===n?{self:!0}:{played:e.played,opponent:i,bp:Controller.Broadcast.scoreToString(e.bp),game:e.game}}),s=n.results&&n.results.rounds&&n.results.rounds[a]||{mp:0,bp:0};return{i:t+1,team:n,matches:i,results:{bp:Controller.Broadcast.scoreToString(s.bp),mp:Controller.Broadcast.scoreToString(s.mp),games:h[t]}}});e.html(d.render("standings.teams",{results:f,reduced:f.length>View.StandingsTable.MAX_TEAMS}))}function o(){var i=s.getAttribute(t,"rounds"),r=s.getAttribute(t,"players"),o=s.getAttribute(t,"standings").live||{},a=s.getAttribute(t,"currentRound");r=Object.map(r,function(e,t){return Object.merge({id:t},e)});var l=o.reduce(function(e,t,n){return e[t]=parseInt(n,10),e},{}),c=o.map(function(){return o.map(function(){return{games:[]}})}),h=o.map(function(){return 0}),f=!1;Object.forEach(i,function(e,t){e.unrated||n&&t>n||Object.forEach(e.matches,function(e,n){Object.forEach(e.games,function(e,i){var o=l[e.player.white],a=l[e.player.black];if(void 0!==o&&void 0!==a){var s=e.gameStatus&&"finished"===e.gameStatus.status,d=e.gameStatus&&"running"===e.gameStatus.status;if(s||d){if(f=f||!!c[o][a].games.length||!!c[o][a].games.length,s){var u=r[e.player.white].results.rounds[t].p,p=t>1?r[e.player.white].results.rounds[t-1].p:0,m=r[e.player.black].results.rounds[t].p,g=t>1?r[e.player.black].results.rounds[t-1].p:0,v=u-p,y=m-g,b={p:Controller.Broadcast.scoreToString(v),played:!0},w={p:Controller.Broadcast.scoreToString(y),played:!0};h[o]++,h[a]++}else b={reverse:!1,evaluation:Controller.Broadcast.convertEvaluationToPercent(e.engine,!0)},w={reverse:!0,evaluation:Controller.Broadcast.convertEvaluationToPercent(e.engine,!1)};b.game=w.game={roundId:t,matchId:n,gameId:i},b.played=w.played=s,b.running=w.running=!s,c[o][a].games.push(b),c[a][o].games.push(w)}}})})});var p=c.map(function(e,t){var i=r[o[t]],s=e.map(function(e,n){return t===n?{self:!0}:e}),l=i.results&&i.results.rounds&&i.results.rounds[n||a]||{games:0,p:0};return{i:t+1,player:i,matches:s,results:{games:h[t],p:Controller.Broadcast.scoreToString(l.p)}}});e.html(d.render("standings.players",{results:p,tournamentId:t,reduced:u,doubleRoundRobin:f}))}function a(){e.find(".gameLink").off("click").on("click",function(){var e=jQuery(this);return l=l||new Controller.Broadcast,l.showGame(t,e.data("round"),e.data("match"),e.data("game")),!1});var n=e.find(".running .evalIndicator").each(function(){var e=jQuery(this),n=e.data("round"),i=e.data("match"),r=e.data("game"),o=new View.EvalIndicator(e,void 0,"horizontal");s.on("set."+t+":"+n+":"+i+":"+r+".engine",function(e,t){t.value&&o.setValue(t.value)}),e.data("gamePath",{roundId:n,matchId:i,gameId:r})});new View.GameTooltip(n,t),e.find("span.player").addPlayerTournamentStatistics(t)}var s,l,c=this,d=new Handler.Template("broadcast");e=jQuery(e),e.length||errorHandler.error(new Error("container not found in View.StandingsTable"));var u=!!e.data("reduced");Extend.Suspendable(c,!0);var h=c.delegate(i),f={};return f["set."+t+".standings set."+t+".teams set."+t+".players"]=h,Extend.Subscriber(c,f,{afterLink:function(e){s=e.publisher,h()}}),c.onResume(function(e){e&&s&&h()}),c},View.StandingsTable.MAX_PLAYERS=16,View.StandingsTable.MAX_TEAMS=16,"undefined"==typeof View&&(View={}),View.TeamRoundRobin=function(e,t,n){function i(e,t){E=!!t.value,o()}function r(e){I=I||new Controller.Broadcast,P=P||new Controller.BroadcastTournament,S=P.showPlayerScoreHistory(t);var n=f(e);o(),g(n)}function o(){var t=f(Q);t.navigationVisible=O,t.compactView=A,e.html(D.render("teamRoundRobin.main",t)),layout.scrollableTables(e),m()}function a(n,i){if(i.diff){var r=n.publisher.getAttribute(t,"teams");for(var a in i.diff){var s=i.diff[a];if(s.results){var l=s.results.rounds&&s.results.rounds[Q]&&s.results.rounds[Q].bp||void 0;if(void 0!==l){var c=r[a].results&&(r[a].results.rounds&&r[a].results.rounds[Q-1]&&r[a].results.rounds[Q-1].bp||0);if(void 0!==c){l-=c;var d=e.find(".teamScore"+a).html(Controller.Broadcast.scoreToString(l)),u=d.prev(".tScore");if(u.length)var h=u.prev(),f=d.next();else u=d.next(".tScore"),h=u.next(),f=d.prev();var p=u.text();p=parseInt(p,10)+(p.match(/(frac12|½)/)?.5:0),d.add(f).toggleClass("winner",l>p),u.add(h).toggleClass("winner",p>l)}}}s.name&&e.find(".teamId"+a).html(s.name)}}else o()}function s(n,i){if(i.diff){j=P.getAttribute(t,"players");for(var r in i.diff){var a=e.find(".playerId"+r),s=a.closest(".gameContainer").data("gamePath");if(s){var l=Object.merge(j[r]);l.name=I.shorterFirstName(l.name),l.id=r,l.country=l.country||"",l.showScore=S,l.historyScore=l.results&&l.results.round&&l.results.round.p||l.results&&l.results.rounds&&l.results.rounds[s.roundId-1]&&l.results.rounds[s.roundId-1].p||void 0,l.url=I.getGameUrl(t,s.roundId,s.matchId,s.gameId),a.html(D.render("teamRoundRobin.player",Object.merge(l,s,{tournamentId:t})))}}}else o()}function l(e,t){n&&n!==Q||t.value!=Q&&(n=Q=t.value,r(Q))}function c(n,i){return function(r){var o=f(n,i),a=Object.merge(o.matches[0],{tournamentId:o.tournamentId,roundId:o.roundId}),s=D.render("teamRoundRobin.match",a);e.find(".matchId"+i).replaceWith(jQuery(s).find(".matchId"+i)),m(i),b("set."+t+":"+n+":"+i+".teams")}}function d(t,n,i){if(i&&E){var r=e.find(".matchId"+t+" .gameId"+n).data("evalIndicator");r&&r.setValue(i)}}function u(n,i,r,o){var a=P.getAttribute(t,"rounds")[n].matches[i];if(a){var s=v(a.games[1].player.white),l=s!==a.teams[1],c=e.find(".matchContainer.matchId"+i+" .gameContainer.gameId"+r);l&&r++;var d=r%2?o.white:o.black,u=r%2?o.black:o.white,h=Object.extend({id:d},P.getPlayer(t,d)),f=Object.extend({id:u},P.getPlayer(t,u));h.name=I.shorterFirstName(h.name),f.name=I.shorterFirstName(f.name),jQuery("td.playerA > h6",c).replaceWith(D.render("teamRoundRobin.player",h)),jQuery("td.playerB > h6",c).replaceWith(D.render("teamRoundRobin.player",f)),c.find("td.playerA > h6 > a, td.playerB > h6 > a").addPlayerTournamentStatistics(t)}}function h(n,i,r,o){var a=e.find(".matchContainer.matchId"+i+" .gameContainer.gameId"+r),s=x[n].matches[i];if(s){var l=o.gameStatus,c=v(o.player.white),d=c===s.teams[2],u={reverse:d,tournamentId:t,roundId:n,matchId:i,gameId:r};if("upcoming"!==l.status&&E){if("running"===l.status){if(void 0!==o.engine)var h=Controller.Broadcast.convertEvaluationToPercent(o.engine,!d);else h=50;u.evaluation=h,y="teamRoundRobin.games.running"}else if("finished"===l.status){var f=d?"black":"white",p=d?"white":"black",m={color:f,score:Controller.Broadcast.scoreToString(l.result[f]),won:1===l.result[f]},g={color:p,score:Controller.Broadcast.scoreToString(l.result[p]),won:1===l.result[p]};u.playerA=m,u.playerB=g,y="teamRoundRobin.games.finished"}}else var y="teamRoundRobin.games.upcoming";if(a.find(".tScore").html(D.render(y,u)),new View.GameTooltip(a,t),"running"===l.status){var b=new View.EvalIndicator(a.find(".evalIndicator"),void 0,"horizontal",_);a.data("evalIndicator",b)}}}function f(e,n){var i={};x=P.getAttribute(t,"rounds"),C=P.getAttribute(t,"teams"),j=P.getAttribute(t,"players");var r=P.getAttribute(t,"gamesPerMatch");i.tournamentId=t,i.roundId=e||P.getAttribute(t,"currentRound"),T=P.getAllPlayersPoints(t,i.roundId-1);var o=x[i.roundId];if(Q=i.roundId,o){i.matches=[];var a=0;if(n){var s={};s[n]=""}else s=o.matches;for(var l in s){for(var c=o.matches[l],d={matchId:l,teamIdA:c.teams[1],teamIdB:c.teams[2],teamA:C[c.teams[1]]&&C[c.teams[1]].name||"",teamB:C[c.teams[2]]&&C[c.teams[2]].name||"",scoreA:0,scoreB:0,games:[],compactView:A},u=0;r>u;u++){var h=c.games[u+1];if(h&&h.player){var f={white:v(h.player.white),black:v(h.player.black)},m=f.white===c.teams[2];if(void 0!==h.engine)var g=Controller.Broadcast.convertEvaluationToPercent(h.engine,!m);else g=50;var y=p(f.white===c.teams[1]?"white":"black",h,e,l,u+1),b=p(f.white===c.teams[1]?"black":"white",h,e,l,u+1);h.gameStatus.result&&(h.gameStatus.result[y.color]&&(d.scoreA+=h.gameStatus.result[y.color]),h.gameStatus.result[b.color]&&(d.scoreB+=h.gameStatus.result[b.color])),d.games.push({gameId:u+1,playerA:y,playerB:b,finished:"finished"===h.gameStatus.status,running:"running"===h.gameStatus.status,upcoming:"upcoming"===h.gameStatus.status,evaluation:g,fen:h.currentFen,reverse:m})}else d.games.push({gameId:u+1,empty:!0,embedded:I.isEmbedded(),playerA:{name:"&mdash;"},playerB:{name:"&mdash;"},finished:!1,running:!1,upcoming:!0,evaluation:0,fen:""})}d.winnerA=d.scoreA>d.scoreB&&d.scoreA>r/2,d.winnerB=d.scoreB>d.scoreA&&d.scoreB>r/2,d.scoreA=Controller.Broadcast.scoreToString(d.scoreA),d.scoreB=Controller.Broadcast.scoreToString(d.scoreB),d.odd=a,i.matches.push(d),a=1-a}return 1==i.matches.length&&(A=!0),i.showEngine=E,i}}function p(e,n,i,r,o){var a=Object.merge(j[n.player[e]]),s=n.gameStatus.result&&n.gameStatus.result[e];return a.name=I.shorterFirstName(a.name),a.color=e,a.score=Controller.Broadcast.scoreToString(s),a.historyScore=Controller.Broadcast.scoreToString(T[n.player[e]]),a.url=I.getGameUrl(t,i,r,o),a.id=n.player[e],a}function m(n){var i=void 0===n?e.find(".matchContainer"):e.find(".matchId"+n);if(i.find(".teamHeader .tScore").on("click",function(){var e=jQuery(this).closest(".matchContainer").find(".gameContainer:first"),n=e.data("gamePath");I.showGame(t,Q,n.matchId,n.gameId,"tabMultiboard")}),i.find(".gameContainer").on("click",function(){var e=jQuery(this),n=e.data("gamePath");return I.showGame(t,Q,n.matchId,n.gameId),!1}).each(function(){var e=jQuery(this),t=e.attr("class").match(/gameId(\w+)/)[1],n=e.closest(".matchContainer").attr("class").match(/matchId(\w+)/)[1];e.data("gamePath",{roundId:Q,matchId:n,gameId:t});var i=e.find(".evalIndicator");if(i.length){var r=new View.EvalIndicator(i,void 0,"horizontal",_);e.data("evalIndicator",r)}}),void 0===n){var o=Object.keys(x);e.find(".pager").pager({live:P.getAttribute(t,"currentRound"),current:Q,margin:3,values:o,labels:o},r)}var a=i.find(".gameContainer");new View.GameTooltip(a,t),a.find(".playerA h6 a, .playerB h6 a").addPlayerTournamentStatistics(t)}function g(e){w();var n=e.roundId,i=P.getAttribute(t,"rounds")[n]||{};y("set."+t+".teams",k.delegate(a)),y("set."+t+".players",k.delegate(s)),y("set."+t+".currentRound",k.delegate(l));for(var r=0;r<e.matches.length;r++){var o=e.matches[r].matchId;i.matches[o]&&i.matches[o].teams&&i.matches[o].teams[1]&&i.matches[o].teams[2]||y("set."+t+":"+n+":"+o+".teams",k.delegate(c(n,o)));for(var f=0,p=P.getAttribute(t,"gamesPerMatch");p>f;f++){var m=e.matches[r].games[f].gameId;y("set."+t+":"+n+":"+o+":"+m+".gameStatus",function(e,t){return k.delegate(function(i,r){h(n,e,t,r.full)})}(o,m)),y("set."+t+":"+n+":"+o+":"+m+".player",function(e,t){return k.delegate(function(i,r){u(n,e,t,r.value)})}(o,m)),y("set."+t+":"+n+":"+o+":"+m+".engine",function(e,t){return k.delegate(function(n,i){d(e,t,i.value)})}(o,m))}}}function v(e){if(M[e])return M[e];for(var t in C)for(var n in C[t].rooster)if(C[t].rooster[n]==e)return M[e]=t}function y(e,t){P.on(e,t),B[e]=t}function b(e){B[e]&&(P.off(e,B[e]),delete B[e])}function w(e){for(var e in B)P.off(e,B[e]);B={}}var k=this;e=jQuery(e),e.length||errorHandler.error(new Error("container not found"),{container:e});var x,C,j,T,_,S,I,P,M={},Q=n,B={},E=window.settings.getBoolean("game-broadcast-engine"),O=!0,A=e.width()<900,D=new Handler.Template("broadcast");return Extend.Suspendable(k,!0),k.onResume(function(e){(e||E!==window.settings.getBoolean("game-broadcast-engine"))&&(E=window.settings.getBoolean("game-broadcast-engine"),r(Q))}),window.settings.on("settings.game-broadcast-engine",k.delegate(i)),k.setCurrentRound=function(e){return r(e),k},k.switchNavigation=function(e){return O=!!e,k},k},"undefined"==typeof View&&(View={}),View.TournamentAttribute=function(e,t,n){function i(){if(n.predicate)var i=n.predicate();else{if(!n.attribute)return;i=a.getAttribute(t,n.attribute);var r="object"==typeof i&&config.language()in i;i=r?i[config.language()]:i}switch(n.action){case"toggleClass":e.toggleClass(n.classname,!!i);break;case"classname":i?(e.addClass(i),o=i):o&&(e.removeClass(o),o=void 0);break;case"content":e.html(i),n.hideOnEmpty&&(n.hideOnEmpty instanceof jQuery?n.hideOnEmpty.toggle(!!i):e.toggle(!!i))}}var r=this;e=jQuery(e),e.length||errorHandler.error(new Error("container not found"),{container:e});var o,a=new Controller.BroadcastTournament;return Extend.Suspendable(r),r.onResume(function(e){e&&i()}),n.attribute&&a.on("set."+t+"."+n.attribute,r.delegate(i)),i(),r},"undefined"==typeof View&&(View={}),View.TournamentInformation=function(e,t){function n(){var n=a.getAttribute(t,"tieRules");e.html(o.render("tabInformation",{c24:a.getAttribute(t,"c24"),description:a.getDescription(t),title:a.getTitle(t),tieRules:n&&n.map(window.t),showTieRules:n&&n.length,tournamentId:t,rounds:i(),isKnockout:"knockout"===a.getAttribute(t,"eventType"),unpredictableSchedule:a.getAttribute(t,"unpredictableSchedule")}));var r=e.find("td.pgn a");config.level().isPremium||r.removeAttr("href"),r.on("click",function(e){return config.level().isPremium?(Handler.tracking("pgn","broadcast"),!0):(Handler.tracking("pgn","broadcastConversion"),Dialog.conversionGoPremium("pgnDownload"),!1)});var l=e.find("td.showGame a");l.on("click",function(){return s.showGame(t,jQuery(this).data("round")),!1})}function i(){var e=[],n=a.getAttribute(t,"rounds");return Object.forEach(n,function(t,n){var i=t.label&&t.label[config.language()]||t.label||n;return"object"==typeof t.startDate?void Object.forEach(t.startDate,function(r,o){e.push({roundLabel:i,roundId:n,gameNo:o,startDate:Helper.getFormatedLocalDateTimeSeperated(r),hasGames:t.matches&&t.matches[1]&&t.matches[1].games&&t.matches[1].games[1]})}):void e.push({roundLabel:i,roundId:n,startDate:Helper.getFormatedLocalDateTimeSeperated(t.startDate),hasGames:t.matches&&t.matches[1]&&t.matches[1].games&&t.matches[1].games[1]})}),e}var r=this;e=jQuery(e),e.length||errorHandler.error(new Error("container not found"),{container:e});var o=new Handler.Template("broadcast"),a=new Controller.BroadcastTournament,s=new Controller.Broadcast;Extend.Suspendable(r,!0);var l=r.delegate(n);r.onResume(function(e){e&&n()});var c=["set."+t+".descriptions","set."+t+".titles","set."+t+".tieRules","set."+t+".unpredictableSchedule"];return a.on(c.join(" "),l),r.outdate(),r},"undefined"==typeof View&&(View={}),View.TournamentTime=function(e,t){function n(e){var n,i,r=e.publisher.getRounds(t),o=e.publisher.getAttribute(t,"pairingSystem");for(var c in r){n=r[c].timeControl.base,i=r[c].timeControl.incrementPerMove;break}var d=e.publisher.getAttribute(t,"clockWhite"),u=e.publisher.getAttribute(t,"clockBlack");if(d&&u)var h=Math.max(d,u)+40*i,f=Math.floor(d/6e4),p=Math.floor(d%6e4/1e3),m=Math.floor(u/6e4),g=Math.floor(u%6e4/1e3),v=window.t("{minwhite}m "+(p?"{secwhite}s ":"")+" vs. {minblack}m "+(g?"{secblack}s ":"")+(i?" + {increment}s":""),{"{minwhite}":f,"{secwhite}":p,"{minblack}":m,"{secblack}":g,"{increment}":i/1e3});else{h=n+40*i;var y=Math.floor(n/6e4),b=Math.floor(n%6e4/1e3);v=b?window.t("{min}m {sec}s"+(i?" + {increment}s":""),{"{min}":y,"{sec}":b,"{increment}":i/1e3}):window.t(i?"{min} min + {sec} sec":"{min} min",{"{min}":n/1e3/60,"{sec}":i/1e3})}var w="Classic";if(0===h)var w="Classic";else 18e4>h?w="Bullet":9e5>h&&(w="Blitz");l.addClass("cIcon cIcon"+w+"GameActive").html(v);var k=e.publisher.getAttribute(t,"players"),x=k&&Object.getLength(Object.without(k,["unknown"]))||0;if(2>x)C=0;else if("swiss"==o)var C=Math.round((Math.log(x)+Math.log(2))/Math.log(2));else C=Math.max(2*Math.ceil(x/2)-1,1);var j=2*h*C/1e3;if(j){var T=Math.floor(j/3600),_=Math.floor(j%3600/60);s.html(window.t("{hours} h : {minutes} min",{"{hours}":(""+T).lpad("0",2),"{minutes}":(""+_).lpad("0",2)})),a.show()}else a.hide()}var i=this;e=jQuery(e),0===e.length&&errorHandler.msg("error",new Error("container not found"),!0,{container:e});var r=e.find("#gameTimeContainer"),o=e.find(".gameTime"),a=e.find(".tournamentTime"),s=a.find("> span").first(),l=o.find("> span").first();return s.length||(s=a),l||(l=o),Extend.Subscriber(i,{},{afterLink:function(e){n(e);var i=e.publisher.getRounds(t);for(var o in i)e.publisher.on("set."+t+":"+o+".timeControl",n);r.length>0&&e.publisher.on("set."+t+".players",n)}}),i},"undefined"==typeof View&&(View={}),View.VideoSimple=function(e,t,n){function i(e,t){p=t.value,o()}function r(e,t){function n(e){return t?(e.title?e.title+" ":"")+e.name:e.link?"<a "+(e.title?'data-fide-title-before="'+e.title+'" ':"")+'href="'+e.link+'">'+e.name+"</a>":"<span"+(e.title?' data-fide-title-before="'+e.title+'" ':"")+">"+e.name+"</span>"}for(var i="",r=0;r<e.length;r++){var o=n(e[r]);i+=0===r?o:r+1===e.length?" & "+o:", "+o}return i}function o(){if(!p||!p.length)return e.empty();p[f]||(f=p.findIndex(function(e){return e.language===config.language()}),-1===f&&(f=p.findIndex(function(e){return"en"===e.language})),M&&(f=p.findIndex(function(e){return e.language===M})),-1===f&&(f=0));var t=e.find(".videoContainer");0===t.length&&(y&&y.detach(),e.html(w.render("game.video")),y&&y.prependTo(e),t=e.find(".videoContainer"));var n=e.find(".videoContainerWrapper").width(),i=e.find(".videoContainerWrapper").height();n||i||(n=x,i=C),n||(n=Math.round(i*j)),i||(i=Math.round(n/j));var r=p.map(function(e){var t=e.autoPlay;switch(e.premiumRestriction&&!config.level().isPremium&&(t=1),e.type){case"livestream":return Object.merge(e,{html:'<iframe width="'+n+'" height="'+i+'" src="//new.livestream.com/accounts/'+e.account+"/events/"+e.event+(e.video?"/videos/"+e.video:"")+"/player?height="+i+"&width="+n+"&autoPlay="+!!t+'" scrolling="no" frameborder="0" allowfullscreen></iframe>'});case"youtube":return Object.merge(e,{html:'<iframe src="//www.youtube.com/embed/'+e.event+"?autohide=1&modestbranding=1&playsinline=1"+(t?"&autoplay=true":"")+'" height="'+i+'" width="'+n+'" scrolling="no" frameborder="0" allowfullscreen></iframe>'});case"youplay.se":return Object.merge(e,{html:'<script async defer src="//content.youplay.se/players/single/'+e.event+".js?ap="+!!t+"&yot="+(e.title?"1":"0")+"&yod="+(e.description?"1":"0")+"&yos="+(e.social?"1":"0")+'"></script>'});case"ustream":return Object.merge(e,{html:'<iframe width="'+n+'" height="'+i+'" src="//www.ustream.tv/embed/'+e.event+"?v=3&amp;wmode=direct"+(t?"&amp;autoplay=true":"")+'" scrolling="no" frameborder="0" allowfullscreen></iframe>'});case"iframe":return t&&(e.src.indexOf("?")>-1?e.src+="&autoplay=1":e.src+="?autoplay=1"),Object.merge(e,{html:'<iframe width="'+n+'" height="'+i+'" src="'+e.src+'" scrolling="no" frameborder="0" allowfullscreen></iframe>'})}});s(r[f]),a()}function a(){var t=p.map(function(e,t){return{idx:t,lang:e.language,active:t===f,promote:e.promote,label:e.label||r(e.commentators,!0)}});e.find(".gamePresenter").html(w.render("game.videoSelector",{languages:t,label:p[f].label||r(p[f].commentators)})).find(".cTooltip").on("click",function(){var e=Date.now()/1e3;c(f,e-v),f=parseInt(jQuery(this).data("idx"),10),o()})}function s(t){var n=e.find(".videoContainer"),i=t.html,r=t.premiumRestriction;if(g!==i)if(g=i,!config.level().isPremium&&r){
var o=r.freeTimeAfterRoundStart,a=r.freePlayTime,s=d(f),c=60*a-s;I+60*o*1e3<(new Date).getTime()||0>=c?n.html(w.render("game.premiumShow",{minutes:o||a})):l(i,a,c,t.autoPlay)}else n.html(i);return b}function l(t,n,i,r){var o=e.find(".videoContainer"),a='<div class="playButton">&#9658;</div>';o.html(a),o.on("click",function(){v=Date.now()/1e3,o.html(t),setTimeout(function(){o.html(w.render("game.premiumShow",{minutes:n})),o.off("click"),c(f,60*n)},1e3*i)}),r&&o.trigger("click")}function c(e,n){for(var i=u(),r=!1,o=0;o<i.length;o++)if(i[o].videoId==e){i[o].seconds=n,r=!0;break}return r||i.push({videoId:e,seconds:n}),$.cookie(t,JSON.stringify(i),{expires:30,path:"/"})}function d(e){for(var t=u(),n=0;n<t.length;n++)if(t[n].videoId==e)return t[n].seconds;return 0}function u(){var e=$.cookie(t);return e=e?JSON.parse(e):[]}function h(){jQuery.getJSON("/api/web/advertisementAPI/getVideo",{language:config.language(),id:t,level:config.level().toString()}).done(function(e){e.data&&e.data.video?b.setPromoVideo(e.data):b.resumeToVideo()}).fail(b.resumeToVideo)}var f,p,m,g,v,y,b=this,w=new Handler.Template("broadcast"),k=!!n,x=438,C=252,j=16/9;e=jQuery(e),0===e.length&&errorHandler.error(new Error("container not found in View.VideoSimple "));var T=new Controller.BroadcastTournament,_=T.getAttribute(t,"rounds"),S=T.getAttribute(t,"currentRound"),I=_[S].startDate;Extend.Suspendable(b);var P={};P["set."+t+".video"]=b.delegate(i),Extend.Subscriber(b,P,{afterLink:function(e){m=e.publisher,n?h():i(e,{value:e.publisher.getAttribute(t,"video")})}}),b.onResume(function(e){e&&m&&i({publisher:m},{value:m.getAttribute(t,"video")})});var M=jQuery(".liveTournamentContainer").data("force-video-language");return b.attachOverlay=function(t){return k?!1:(b.removeOverlay(!0),y=t,e.prepend(y.hide()),y.css("height",0).prependTo(e).show().animate({height:"45px"},500,function(){y.css("height","")}),!0)},b.removeOverlay=function(e){y&&(e?(y.remove(),y=void 0):y.animate({height:0},500,function(){y.remove(),y=void 0}))},b.setPromoVideo=function(t){function n(e){e?(r.find(".pane .seconds").html(e),setTimeout(function(){n(e-1)},1e3)):r.find(".pane .info").hide()}var i=new Handler.Template("advertisement"),r=jQuery(i.render("video",t)).appendTo(e),o=r.find(".promoVideo"),a=r.find("a.overlay");return o.flowplayer({playlist:[t.video],cuepoints:[{time:t.timeout||10}],fullscreen:!1,embed:!1}).on("ready",function(){var e=o.data("flowplayer");a.removeClass("overlay"),Handler.tracking("advertisement","videoView",t.title),r.find(".cPatternSlider").on("change",function(){e.volume(jQuery("#ad-volume").val()/100)})}).on("resume",function(){var e=o.data("flowplayer");a.addClass("overlay"),r.find(".pane").css("display","block"),e.disable(!0),n(t.timeout||10)}).on("cuepoint",function(){r.find(".cTooltipBox, .info, .cPatternSlider").hide(),r.find(".pane").addClass("skip"),r.find(".pane, .cBtnFlexi").show().on("click",function(){b.resumeToVideo(),Handler.tracking("advertisement","videoSkip",t.title)})}).on("finish",function(){b.resumeToVideo(),Handler.tracking("advertisement","videoComplete",t.title)}).on("error",function(){b.resumeToVideo(),Handler.tracking("advertisement","videoError",t.title)}),o.hasClass("is-splash")||o.hasClass("is-error")?void b.resumeToVideo():(r.find(".cTooltipBox").show(),r.find(".cBtnFlexi").hide(),r.find(".pane").appendTo(o),void r.find(".cTooltipBoxContainer").html(t.title))},b.resumeToVideo=function(){k=!1,i(m,{value:m.getAttribute(t,"video")})},b},"undefined"==typeof View&&(View={}),function(){function e(e){return e===e.toUpperCase()}function t(t){var n=Object.without(t.getCurrentPosition().countPiecesOnBoard(),i),r={};for(var o in n){if(e(o))var a=o.toUpperCase(),s=o.toLowerCase();else a=o.toLowerCase(),s=o.toUpperCase();r[o]=n[a]-n[s]}return r}function n(e){var t={},n=e.getCurrentPosition().countPiecesOnBoard(),r=Object.without(a,i);for(var o in r)t[o]=r[o]-n[o];return t}var i=["white","black","total"],r={b:["q","r","b","n","p"],w:["Q","R","B","N","P"]},o={Q:"q",q:"w",K:"k",k:"l",B:"b",b:"n",N:"h",n:"j",R:"r",r:"t",P:"p",p:"a"},a=(new Chess.Position).countPiecesOnBoard();View.CapturedPieces=function(i,a,s){function l(){a.contains("w")&&a.contains("b")||(a.contains("b")?d.setColors(["w"]):a.contains("w")&&d.setColors(["b"]))}function c(l){var c=l.publisher,d=(s?t:n)(c),u="";a.forEach(function(t){for(var n=0;n<r[t].length;n++)for(var i=r[t][n],a=0;a<d[i];a++)(h&&e(i)||f&&!e(i))&&(u+=o[i])}),i.html(u)}var d=this;s=s||!1,a=a||["w","b"];var u,h=a.contains("w"),f=a.contains("b");i=jQuery(i),0===i.length&&errorHandler.error(new Error("container not found in View.CapturedPieces")),Extend.Suspendable(d);var p=d.delegate(c);return Extend.Subscriber(d,{currentGameChanged:p,"movedPositionPointer.current":p,flipBoard:l},{afterLink:function(e){u=e,p(e)}}),d.onResume(function(e){e&&u&&c(u)}),d.setColors=function(e){return a=e,h=a.contains("w"),f=a.contains("b"),p(u),d},d.setDiff=function(e){return s=!!e,p(u),d},d}}(),View=View||{},View.Chat=View.Chat||{},View.Chat.ChatHandler=function(e,n,r,o){function a(){le=!0,ce.emit("initialized")}function s(e){ce.emit("newMessage",e)}function l(){jQuery(this).parent("dd").toggleClass("showAll")}function c(e){13!==e.keyCode||e.shiftKey||(x.apply(this),e.preventDefault())}function d(e){13!==e.keyCode||e.shiftKey||(x.apply(this),e.preventDefault());var t=jQuery(this).closest("[group]"),n=(t.attr("group"),t.find(".specialMessageInput")),i=n.val().trim(),r=t.find(".btnSendSpecialMessage");i.length?(r.removeClass("disabled"),r.removeAttr("disabled")):(r.addClass("disabled"),r.attr("disabled","disabled"))}function u(e){if(ue.length&&re===X&&me.chatbox.scrollTop()<150){re=Y;var t=ue[0].data;chatHandler.getPreviousMessages(ae,r,t.id,t.timestamp),C()}}function h(e){if(U.isModerator&&ae){e=e.replace(/ +(?= )/g,"");var t=e.split(" ");switch(t[0]){case"/?":case"/help":A(pe.render("chatModeratorHelp"));break;case"/block":if(t.length<2)return void A('missing username (usage: "/block username [timeout in seconds]", default timeout: 10 minutes)');f(t[1],function(e){void 0===e?A('user "'+t[1]+'" cannot be found'):t[2]?chatHandler.moderator.user.block(e,Math.max(15,+t[2]),ae,r):chatHandler.moderator.user.block(e,void 0,ae,r)});break;case"/ban":if(t.length<2)return void A('missing username (usage: "/ban username")');f(t[1],function(e){void 0===e?A('user "'+t[1]+'" cannot be found'):chatHandler.moderator.user.ban(e,ae,r)});break;case"/unban":if(t.length<2)return void A('missing username (usage: "/unban username")');f(t[1],function(e){void 0===e?A('user "'+t[1]+'" cannot be found'):chatHandler.moderator.user.unban(e,ae,r)});break;case"/clear":if(t.length<2)return void A('missing username (usage: "/clear username")');f(t[1],function(e){void 0===e?A('user "'+t[1]+'" cannot be found'):chatHandler.moderator.user.deleteMessages(e,ae)});break;default:A("unknown command:"+t[0])}}}function f(e,t){var n=he[e.toLowerCase()];if(n)return void t(n);var i="/api/web/UserAPI/getUuidFromNick";jQuery.get(i,{nick:e},function(n){he[e]=n,fe[n]=e,t(n)}).fail(function(){t()})}function p(){if(ae&&!jQuery(this).hasClass("disabled")){var e=me.editor.editor("text").trim();if(e.length)if(me.editor.editor("reset"),"/"===e[0])h(e);else if(chatHandler.sendMessage(ae,e,void 0,m),!config.level().isPremium){var t=W[ae].config?W[ae].config.cooldown:Handler.ChatHandler.COOLDOWN_DEFAULTVALUE;g(t,"cooldown",!0)}me.editor.focus()}}function m(e){if(e&&!e.sent&&e.data.content.data){var t=e.data.content.data;switch(t.code){case ee:g(t.cooldown,"cooldown",!0);break;case Z:t.cooldown===ie?g(1/0,"banned"):g(t.cooldown,"blocked")}}}function g(e,t,n){if(0!==e&&(V=Date.now()+1e3*(e-.5),z=me.editorOverlay.attr(t+"template"),me.inputContainer.attr("disabled","disabled"),me.btnSendMessage.addClass("disabled"),me.chatToolbar.hide(),me.editor.hide(),me.editorOverlay.text(z),me.editorOverlay.show(),v(),n))switch(me.editor.parent().off("click.cooldownConversion"),t){case"premiumOnly":me.editor.parent().on("click.cooldownConversion",b);break;default:me.editor.parent().on("click.cooldownConversion",w)}}function v(){clearTimeout(F);var e=Date.now();return e>=V?y():(me.editorOverlay.text(Handler.Template.renderString(z,{n:Math.ceil((V-e)/1e3)})),void(F=setTimeout(v,1e3-e%1e3)))}function y(){clearTimeout(F),me.editorOverlay.text(""),me.editorOverlay.hide(),me.editor.show(),me.chatToolbar.show(),me.inputContainer.removeAttr("disabled"),me.btnSendMessage.removeClass("disabled"),me.editor.parent().off("click.cooldownConversion"),V=void 0,me.inputContainer.focus()}function b(){Dialog.conversionGoPremium("chatPremiumOnly")}function w(){var e=W[ae].config?W[ae].config.cooldown:Handler.ChatHandler.COOLDOWN_DEFAULTVALUE;Dialog.conversionGoPremium("chatCooldown",{},{cooldown:e})}function k(t){e.empty().append(pe.render("loadError",{message:window.t(t)}))}function x(){if(ae){var e=jQuery(this).closest("[group]"),t=e.attr("group"),n=e.find(".specialMessageInput"),i=n.val().trim();if(!i.length)return void n.focus();var r,o=e.find(".teaserLinkUrl"),a=o.val().trim(),s=e.find(".teaserImageUrl"),l=s.val().trim(),c=e.find(".teaserLinkText"),d=c.val().trim();a||l?(i=JSON.stringify({img:l,url:a,linkText:d,message:i}),r=t+"Teaser"):r=t,chatHandler.sendMessage(ae,i,r),n.val(""),o.val(""),s.val(""),c.val(""),n.focus()}}function C(){e.find(".messages-scroll-loader").show()}function j(){e.find(".messages-scroll-loader").hide()}function T(e){var t=me.chatbox,n=t.find(".chatList"),i=t.scrollTop()>0&&t.prop("scrollHeight")-t.scrollTop()-t.outerHeight()<100||0==t.scrollTop()&&t.outerHeight()>n.outerHeight();return e(),oe&&i&&t.scrollTop(t.prop("scrollHeight")),ce}function _(e,t){blockedUserHandler.isBlocked(e.user.uuid)||(he[e.user.nick.toLowerCase()]=e.user.uuid,fe[e.user.uuid]=e.user.nick,e.type?O(e,t):E(e,t),I())}function S(){return me.chatMessages.find("dd").length+me.chatMessages.find(".info").length}function I(){for(re!==J&&S()>=q&&(re=J);S()>q;){var e=me.chatMessages.children(":first-child");e.hasClass("chatBoxEntry")?G(ue.shift()):e.remove()}}function P(){var e=jQuery(this).closest("[user-id]").attr("user-id"),n=fe[e];Dialog.confirmation(t('Block user "{{userName}}"?',{"{{userName}}":n}),function(){chatHandler.moderator.user.block(e,void 0,ae,r)})}function M(){var e=jQuery(this).closest("[user-id]").attr("user-id"),t=fe[e];Dialog.Chat.banUser(t,function(t){chatHandler.moderator.user.ban(e,ae,r),t&&chatHandler.moderator.user.deleteMessages(e,ae)})}function Q(){T(function(){$(".chatMessages dl:not(.premiumMessage)").each(function(e,t){$(t).toggleClass("hidden",$("#premiumOnly").prop("checked"))})})}function B(){var e=jQuery(this).closest("[msg-id]").attr("msg-id");if(e){var n,i,r;for(r=ue.length,i=0;r>i;i++)ue[i].data.id===e&&(n=ue[i].data);if(n){var o=n.content;switch(n.type){case"chess24Teaser":o=JSON.parse(n.content).message}var a=Handler.Template.escape(o.substr(0,100));o.length>100&&(a+="..."),Dialog.confirmation(t('Delete message "{{message}}"?',{"{{message}}":a}),function(){chatHandler.moderator.deleteMessage(ae,n.id,n.timestamp)})}}}function E(e,t){var n,i=ue.length,r=null;if(i)if(t)for(n=0,r=ue[n];i>n&&!r.msg.hasClass("chatBoxEntry");)n++,r=ue[n];else for(n=i-1,r=ue[n];n>=0&&!r.msg.hasClass("chatBoxEntry");)n--,r=ue[n];var o,a=null!==r&&r.data.user?r.data.user.uuid:"";if(t){var s=me.chatMessages.find(":first-child");o=s.hasClass("info")||s.hasClass("special")||a!==e.user.uuid?"message":"continuedMessage"}else{var l=me.chatMessages.find(">dl:last");o=l.hasClass("info")||l.hasClass("special")||a!==e.user.uuid?"message":"continuedMessage"}var c=e.content.split("\n").map(function(e){return e.trim()}).filter(function(e){return e.length>0}).map(function(e){return{line:e}}),d=pe.render("messageContent",{lines:c}),u=jQuery(pe.render(o,{uuid:e.user.uuid,user:e.user.nick,permalink:e.user.permalink,attributes:e.user.attributes,profileImage:e.user.profileImageUrl,isPremium:e.user.attributes.premium,nick:e.user.nick,messageId:e.id,message:d,isModerator:U.isModerator}));u.find(".messageContent").expandEmoticons().expandLinks();var h={data:e,msg:u};if("continuedMessage"===o)if(t){var f=r.msg.find("dt").next();f.before(u),f.attr("msg-id",r.msg.attr("msg-id")),r.msg.attr("msg-id",u.attr("msg-id")),u.attr("msg-id",null),u.find(".messageTime").after(f.find(".messageUser"))}else r.msg.append(u);else me.chatMessages[t?"prepend":"append"](u);ue[t?"unshift":"push"](h);var p=48;if(u.find(".messageContent").height()>p&&("continuedMessage"===o?u.addClass("longMessage"):u.find("dd").addClass("longMessage")),u.find(".messageTime").showAge(e.timestamp,!0),""!==e.user.uuid){var m=u.find(".messageUser > a");m.length&&(m.data("uuid",e.user.uuid),m.addMiniprofile())}return $("#premiumOnly").prop("checked")&&!e.user.attributes.premium&&u.addClass("hidden"),u}function O(e,t){switch(delete e.user,e.type){case"chess24":case"chess24Teaser":var n="chess24",i="chess24"}var r;switch(e.type){case"chess24Teaser":var o=JSON.parse(e.content);o.url&&!o.linkText&&(o.linkText=o.url),r=(o.img?pe.render("messageContentTeaserImage",o):"")+"<div>"+o.message+(o.url?pe.render("messageContentTeaserLink",o):"")+"</div>";break;default:r=e.content.replace(/\n/g,"<br>")}var a=jQuery(pe.render("messageSpecial",{messageId:e.id,nick:i,message:r,type:n,isModerator:U.isModerator}));return a.find("img").error(function(){jQuery(this).parent().parent().remove()}),me.chatMessages[t?"prepend":"append"](a),ue[t?"unshift":"push"]({data:e,msg:a}),a}function A(e){me.chatMessages.append(pe.render("info",{message:e})),me.chatbox.scrollTop(me.chatbox.prop("scrollHeight"))}function D(){return!W[ae]||!W[ae].config||!W[ae].config.advertisement||W[ae].config.advertisement.enabled}function H(e){if(ve&&D()&&(e||!me.chatMessages.find(">dl:last").hasClass("advertisement"))){var t=ve.getNextAd();t&&me.chatMessages[e?"prepend":"append"](pe.render("advertisement",t)),e?ye=0:be=0,I()}}function N(e){if(ve&&D()){for(;me.chatMessages.find(">dl:last").is(".announcement."+e.item);)me.chatMessages.find(">dl:last").remove();me.chatMessages.append(pe.render("announcement",e)),I()}}function L(e){e?H(e):T(H)}function G(e){if(e.msg.hasClass("special"))e.msg.remove();else{var t=e.msg.find("dd");if(t.length>1){var n=e.msg.find(".messageUser");n.remove(),jQuery(t[1]).prepend(n),jQuery(t[0]).remove();var i=jQuery(t[1]).attr("msg-id");jQuery(t[1]).removeAttr("msg-id"),e.msg.attr("msg-id",i);var r,o=ue.length;for(r=0;o>r;r++){var a=ue[r];if(a.data.id===i){a.msg=e.msg;break}}}else e.msg.remove()}}function R(){if(!U.isGuest){var e=W[ae],t=!0,n=!0,i=!1;if(e&&e.config&&e.config.permissions){switch(e.config.permissions.write){case"premium":case"premium1":t=U.isPremium;break;case"registered":t=U.isRegistered;break;case"none":i=!0,t=!1;break;default:t=!1}switch(e.config.permissions.read){case"premium":case"premium1":n=U.isPremium;break;case"registered":n=U.isRegistered;break;default:n=!0}}if(i){if(!me.inputArea.find(".closedRoomOverlay").length){var r=jQuery(pe.render("closedRoomOverlay"));me.inputArea.append(r)}}else if(n||t)me.inputArea.find(".closedRoomOverlay").remove(),me.inputArea.find(".premiumConversionOverlay").remove();else if(!me.inputArea.find(".premiumConversionOverlay").length){var o=jQuery(pe.render("premiumConversionOverlay"));me.inputArea.append(o)}}}o.preSelectRoom=o.preSelectRoom!==!1;var V,F,z,U,W,q=1e3,K=1500,J=0,X=1,Y=2,Z=801,ee=802,te=403,ne=902,ie=-1,re=J,oe=void 0===o.autoscroll?!0:o.autoscroll,ae=o.defaultChatRoom||(o.preSelectRoom?n[0]:null),se=!1,le=!1,ce=Extend.Publisher(this);e=jQuery(e),e.length||errorHandler.error("container not found in View.Chat.ChatHandler");var de,ue=[],he={},fe={},pe=new Handler.Template("chat").append(new Handler.Template),me={},ge=setTimeout(function(){k("Chat system is not working at the moment, please come back later...")},3e4),ve=null;e.empty().append(pe.render("loader")),chatHandler.getInitData(n,r);var ye=0,be=0;ce.mixinAdvertisements=function(){if(le&&ve&&ve.isInitialized()&&D()){var e=ve.getMessagesThreshold(),t=0;jQuery(me.chatMessages.children().get().reverse()).each(function(n,i){if(t++%e===0){ye=0;var r=ve.getNextAd();if(r){var o=pe.render("advertisement",r);jQuery(i).after(o)}}else ye++})}},ce.renderAdvertisement=function(e){L(e)},ce.renderAnnouncement=function(e){T(function(){N(e)})},ce.isInitialized=function(){return le},ce.handleInitData=function(t){if(clearTimeout(ge),W=t.rooms,!se){se=!0,e.empty(),me.chat=jQuery(pe.render("chat",{isAdmin:config.level().isPremium})),me.title=me.chat.find(".title"),me.header=me.chat.find(".chatHeader"),me.countTotal=me.chat.find(".countTotal"),me.countMasters=me.chat.find(".countMasters"),me.chatbox=me.chat.find(".chatBox"),me.chatMessages=me.chatbox.find(".chatMessages"),o.header&&me.header&&me.header.html(o.header),me.chat.on("click",".labelShowComplete",l),me.chat.on("click",".btnDeleteMessage",B),me.chat.on("click",".btnModBlockUser",P),me.chat.on("click",".btnModBanUser",M),me.chat.on("click","#premiumOnly",Q),e.on("click",".btnSendMessage",p),e.on("click",".btnSendSpecialMessage",x),e.on("keydown",".specialMessageInput",c),e.on("input",".specialMessageInput",d),me.chatbox.on("scroll",u),e.append(me.chat),U=t.user;var i=me.chat.find(".inputAreaContainer");if(i.empty(),U.isGuest&&i.append(pe.render("unregisteredUser",{embedded:o.embedded})),U.isPremium||(ve=new View.Chat.AdvertisementHandler(ce,o.tournamentId).run()),de=new View.Chat.AnnouncementHandler(ce),n.length>1){var s=n.map(function(e){return{roomId:e,title:W[e]?W[e].title:e}}),h=pe.render("roomSelectorOption",{rooms:s}),f=jQuery(pe.render("inputArea",{roomOptions:h,profileImage:U.profileImageUrl,showModViewLink:(U.isModerator||U.isAdmin)&&"/chat/showRoom"!=window.location.pathname,roomIds:ae})),m=f.find(".chatRoomSelector .cTooltipBoxContainer");m.find("span").on("click",function(){m.find("span").removeClass("active");var e=jQuery(this);e.addClass("active"),ce.selectChatRoom(e.attr("value"))}),m.find("[value="+ae+"]").addClass("active")}else e.addClass("singleRoom"),f=jQuery(pe.render("inputArea",{profileImage:U.profileImageUrl,showModViewLink:(U.isModerator||U.isAdmin)&&"/chat/showRoom"!=window.location.pathname,roomIds:ae}));if(o.showSpecialInput&&Array.isArray&&Array.isArray(U.groups)&&U.groups.length>0){var g=jQuery('<div class="customTabs">');g.append(jQuery('<section id="chatInputTabChat" data-tab-title="Chat">').append(f)),jQuery(".inputAreaContainer").addClass("specialMessages"),U.groups.forEach(function(e){g.append(pe.render("inputAreaSpecial",{imageUrl:e.imageUrl,group:e.name}))}),i.append(g)}else i.append(f);return me.btnSendMessage=i.find(".btnSendMessage"),me.inputArea=i,me.inputContainer=i.find(".inputContainer"),me.editorOverlay=i.find(".editorOverlay"),me.chatToolbar=i.find(".chatToolbar"),me.editor=me.inputContainer.find(".editor.chat"),U.isGuest||($editor=me.editor.editor({language:config.language(),height:22,maxLength:K,hideToolbar:!0,extensions:["emoticons"],toolbar:{left:[],right:[]},extensionConfig:{emoticons:{dialogContainer:f.find(".btnChatExtension .cTooltipBoxContainer")}},watermark:me.inputContainer.attr("placeholder"),dialogConfig:{emoticons:{showAsPopup:!0}},removeLineBreaks:!0}),me.editor.on("keydown",function(e){switch(e.keyCode){case 13:e.shiftKey?e.preventDefault():(p(),e.preventDefault())}}).on("keyup change",function(e){me.editor.editor("isEmpty")?(me.btnSendMessage.addClass("disabled"),me.btnSendMessage.attr("disabled","disabled")):(me.btnSendMessage.removeClass("disabled"),me.btnSendMessage.removeAttr("disabled"))})),layout.tabs(e),chatHandler.enterChatRoom(ae,r,o.getMessagesLimit),ae&&R(),a(),ce}},ce.enterChatRoom=function(e){if(e.messages){for(var t=e.messages.length,n=t-1;n>=0;n--)_(e.messages[n]);re=t<o.getMessagesLimit?J:X}ce.mixinAdvertisements(),e.counts&&ce.updateCounts(e.counts);var i=W[ae];return!U.isPremium&&i&&i.config&&i.config.permissions&&"premium1"===i.config.permissions.write?g(1/0,"premiumOnly",!0):-1===e.blocked?g(1/0,"banned"):e.blocked?g(e.blocked,"blocked"):e.cooldown?g(e.cooldown,"cooldown",!0):y(),me.chatbox.scrollTop(me.chatbox.prop("scrollHeight")),setTimeout(function(){me.chatbox.scrollTop(me.chatbox.prop("scrollHeight"))},200),ce},ce.selectChatRoom=function(e){return n.contains(e)||errorHandler.warning("room is not in list of available rooms: ",{roomId:e}),chatHandler.leaveChatRoom(ae),me.chatMessages.empty(),ue=[],ae=e,jQuery(".chatModViewLink").attr("href","/chat/showRoom?rooms="+e),chatHandler.enterChatRoom(e,r),R(),ce},ce.enterChatRoomFailed=function(t){switch(t.code){case te:var n=W[t.roomId];if(n.config&&n.config.permissions)switch(n.config.permissions.read){case"premium":case"premium1":A(window.t("You must be a premium member to access this chat!"));break;case"registered":A(window.t("Please register to access this chat!"))}break;case ne:g(1/0,"roomNotExists"),A(e.find(".editorOverlay").attr("roomNotExiststemplate"))}return ce},ce.addNewMessage=function(e){return T(function(){s(e),_(e),ve&&++be>=ve.getMessagesThreshold()&&L(!1)}),ce},ce.updateCounts=function(e){return me.countTotal.text(e.total),me.countMasters.text(e.gm+e.im),ce},ce.updateMetadata=function(e){return W[e.roomId]=JSON.parse(e.metadata),ce.selectChatRoom(ae),ce},ce.addPreviousMessages=function(e){j();for(var t=me.chatbox,n=t.prop("scrollHeight"),i=e.length,r=0;i>r;r++)_(e[r],!0),ve&&++ye>=ve.getMessagesThreshold()&&L(!0);return re!==J&&(re=0===i?J:X),t.scrollTop(t.prop("scrollHeight")-n),ce},ce.deleteMessage=function(e){var t,n=ue.length;for(t=0;n>t;t++){var i=ue[t];if(i.data.id===e)return G(i),void ue.splice(t,1)}return ce},ce.deleteMessages=function(e){for(i=0;i<ue.length;i++){var t=ue[i];t.data.user&&t.data.user.uuid===e&&(G(t),ue.splice(i,1),i--)}return ce},ce.clear=function(){return e.empty(),ve&&ve.stop(),de&&de.stop(),ce},ce.handleUserBlocked=function(e){var t=fe[e.uuid];return A('user "'+t+'" has been blocked for '+e.timeout+" seconds"),ce},ce.handleUserBanned=function(e){var t=fe[e.uuid];return A('user "'+t+'" has been banned'),ce},ce.handleUserUnbanned=function(e){var t=fe[e.uuid];return A('user "'+t+'" has been unbanned'),ce}},View=View||{},View.Chat=View.Chat||{},View.Chat.AdvertisementHandler=function(e,t){function n(){i&&clearTimeout(i),c||(i=setTimeout(function(){e.renderAdvertisement(),n()},1e3*r))}var i,r=600,o=50,a=this,s=[],l=[],c=!1,d=!1;return a.run=function(){return jQuery.getJSON("/api/web/advertisementAPI/getOverlays",{language:config.language(),id:t,level:config.level().toString()}).done(function(t){t&&t.data&&t.data.advertisements&&t.data.advertisements.forEach(function(e){var t=e.nextShow;(!t||t<Date.now())&&s.push(e)}),d=!0,e.mixinAdvertisements(),n()}),a},a.isInitialized=function(){return d},a.stop=function(){return c=!0,i&&(clearTimeout(i),i=null),a},a.getNextAd=function(){if(0===s.length)return null;0===l.length&&s.forEach(function(e,t){l.push(t)}),n();var e=l[Math.randomBetween(0,l.length-1)];return l.splice(l.indexOf(e),1),s[e]},a.getMessagesThreshold=function(){return o},a},"undefined"==typeof View&&(View={}),View.Chat=View.Chat||{},View.Chat.AnnouncementHandler=function(e){function t(t,n){if(n&&n.content&&n.content.data&&i.contains(n.content.data.item)){var r=Object.map(n.content.data,function(e){return"object"==typeof e&&config.language()in e?e[config.language()]:e});e.renderAnnouncement(r)}}var n=this,i=["playzoneTournament"],r="channel:announcement";return notificationHandler.subscribe(r),notificationHandler.on(r,t),n.stop=function(){notificationHandler.off("channel",t),notificationHandler.unsubscribe(r)},n},"undefined"==typeof View&&(View={}),View.ChatTournament=function(e,t,n){function i(t,n){return n&&n.length?void(s||r(n)):(e.empty().removeClass("gameSlidingTabs").addClass("notationTable"),void(l.notationTable=new View.NotationArea(e)))}function r(e){f.on("click",function(){(h.hasClass("active")?m:g).trigger("click")}),p.on("click",function(){var e=jQuery(this),t=jQuery(".slidingTabTournamentChat");p.removeClass("active"),v.removeClass("active"),e.addClass("active");var n=jQuery(".jsClone.chatRoomSelector");e.hasClass("notation")?(h.addClass("active"),f.addClass("up"),n.hide(),window.settings.set("broadcast-chat-selected",0)):(t.addClass("active"),f.removeClass("up"),n.show(),window.settings.set("broadcast-chat-selected",1),t.one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(e){n.offset(jQuery(".selectChatRoom").offset())})),n.css("z-index",t.hasClass("active")?32:0)}),window.settings.getBoolean("broadcast-chat-selected")||g.trigger("click");var i=new RegExp("_"+config.language()+"$"),r=e.find(function(e){return i.test(e)})||e[0];chatHandler.addChat(u,e,{showSpecialInput:!1,defaultChatRoom:r,embedded:n,tournamentId:t}),l.InlineNotation=new View.InlineNotation(d),l.notationTable=new View.NotationArea(c,"broadcast"),s=!0}var o=this,a=new Controller.BroadcastTournament;e=jQuery(e),0===e.length&&errorHandler.error(new Error("container not found"),{container:e});var s,l={},c=e.find(".notationTable"),d=e.find(".notationTableInline > div"),u=e.find(".tournamentChat"),h=e.find(".slidingTabNotationTable"),f=e.find(".toggleNotationTable"),p=e.find(".slidingTabTrigger"),m=e.find(".slidingTabTrigger.chat"),g=e.find(".slidingTabTrigger.notation"),v=e.find(".slidingTabContent");Extend.Suspendable(o),o.onResume(function(){Object.forEach(l,function(e){e.resume(!0)})}).onSuspend(function(){Object.forEach(l,function(e){e.suspend()})});var y={};return y["set."+t+".chatRooms"]=o.delegate(i),Extend.Subscriber(o,y,{afterLink:function(e){i(e,a.getAttribute(t,"chatRooms")),Object.forEach(l,function(t){t.link(e.publisher)})},afterUnlink:function(e){Object.forEach(l,function(t){t.unlink(e.publisher)})}}),o},"undefined"==typeof View&&(View={}),View.ChessBoard=function(e,n,i,r){function o(e){return e=void 0!==e?e:!A,A&&e||!A&&!e?x:(A=e,x.reDraw(),x)}function a(){var e=O.getBoardMargin(I),t=O.getBoardMargin(P),n=E?e:0,i=E?t:0,r=O.getBoardSize(I),o=O.getBoardSize(P);B=jQuery("<img />").addClass("boardImage").attr("src",O.getBoardUrl(s())).css({position:"absolute",left:"0px",top:"0px"}).appendTo(D),x.boardOffset=B.position(),M=jQuery("<div />").addClass("svg").attr("style","opacity:0.6; position:absolute; left:"+(n+x.boardOffset.left)+"px; top:"+(i+x.boardOffset.top)+"px; height:"+(o-2*i)+"px; width:"+(r-2*n)+"px;").appendTo(D),Q=jQuery("<div />").addClass("popupInsider").addClass("piecePromotionDialog").appendTo(C);for(var a=0;8>a;a++)for(var l=7;l>=0;l--){var c=jQuery("<div />").addClass("_"+l+a).addClass("cell").data("coordinates",l.toString()+a.toString()).attr("style","position:absolute;");D.append(c),(l+a)%2!=0&&c.addClass(O.getWhiteSquareColor());var d=jQuery("<img />").addClass("highlight_"+l+a).addClass("highlight").data("coordinates",l.toString()+a.toString()).attr("src",O.getHighlightUrl()).attr("style","position:absolute; top:auto; left:auto; z-index:2;");c.append(d)}return H=Raphael(M.get(0),r-2*e,o-2*t),M.children().css({left:"0px",top:"0px"}),k(),x}function s(){return A?"white":"black"}function l(){for(G={additionalArrow:[]},c();L.length>0;){var e=L.pop();jQuery(e).stop(!0,!0)}return x}function c(){return H.clear(),x}function d(e,t,n){function i(e,t,n,i,r){var o=jQuery(C).find("._"+t.y+t.x),a=jQuery(C).find("._"+n.y+n.x),s=o.position().top,l=o.position().left,c=a.position().top,d=a.position().left,u=d-l,h=c-s;return e.zIndex(i),L.push(e),e.animate({left:u,top:h},S||1,function(){C.find("._"+n.y+n.x+" .piece").remove(),e.data("coordinates",n.y.toString()+n.x.toString()),C.find("._"+n.y+n.x).append(e),e.css({top:"auto",left:"auto"}).zIndex(3),r&&r()}),x}var r=e.startSquare,o=e.endSquare;t=t||{};var a=C.find("._"+r.y+r.x).find(".piece").not(".ui-draggable-dragging");if(window.settings.getBoolean("game-highlight-last-move")&&x.addArrow(e.x1,e.y1,e.x2,e.y2),i(a,r,o,30,function(){if(t.removePiece&&C.find("._"+t.removePiece.y+t.removePiece.x+" .piece").remove(),e.promotion){var i=e.promotion;"w"===n&&(i=i.toUpperCase())}else i=N.getPiece(o);var a=O.getPieceUrl(i);C.find("._"+o.y+o.x+" .piece").attr("src",a),G.move&&G.move.y1===r.y&&G.move.y2===o.y&&G.move.x1===r.x&&G.move.x2===o.x&&x.addArrow(r.x,r.y,o.x,o.y)}),t.additionalMove){var s=t.additionalMove.startSquare,l=t.additionalMove.endSquare,c=C.find("._"+s.y+s.x).find(".piece");i(c,s,l,29)}return x}function u(e,t){var n=e.publisher;return void 0!==x.highlightHandler&&(x.highlightHandler.anyMovesAllowed=n.getMoveMode(void 0,!0)||n.getMoveMode(void 0,!1)),l(),d(t.moveCoords,t.additionalMoveInformation,t.parentMove.moveRight),v(t),f(e,n.getHighlights()),void 0!==x.highlightHandler&&(f(e,n.getHighlights()),x.markKingInCheck()),x}function h(e){var t=e.publisher;S=y(),l(),void 0!==x.highlightHandler&&(x.highlightHandler.anyMovesAllowed=t.getMoveMode(void 0,!0)||t.getMoveMode(void 0,!1));var n=t.getCurrentPosition();if(N===n)return x;C.find(" .cell .piece").remove();for(var i=O.getSquareSize(),r=0;8>r;r++)for(var o=0;8>o;o++){var a=n.getPiece(r,o);if("-"!==a){var s=O.getPieceUrl(a),c=a.toLowerCase()===a?"black":"white",d=jQuery('<img src="'+s+'" width="'+i+'" height="'+i+'" style="position : relative;" />').zIndex(2);d.data("coordinates",r.toString()+o.toString()),d.addClass("piece "+c),C.find("._"+r+o).append(d)}}return x.movementHandler&&x.movementHandler.cancelPremove(),v(n),x.movementHandler&&x.movementHandler.initEvents(),x.highlightHandler&&(f(e,t.getHighlights()),x.markKingInCheck()),n.isRootPosition()||x.addArrow(n.moveCoords.x1,n.moveCoords.y1,n.moveCoords.x2,n.moveCoords.y2).drawArrow(),x}function f(e,t){x.highlightHandler.unHighlightAll(),b();for(var n=0;n<t.length;n++){var i=t[n];i.square?m(e,i):i.frame?m(e,i,!0):i.line&&p(e,i)}return x}function p(e,t){return G.additionalArrow.push(t),x.drawArrow(),x}function m(e,t,n){if(t.frame)var i="take",r=t.frame;else"-"===N.getPiece(t.square)?(i="",r=t.square):(i="take",r=t.square);return x.highlightHandler&&x.highlightHandler.highlightCell(r.y.toString()+r.x.toString(),t.color,i),x}function g(e,t){if(N===t)return x;if(void 0!==x.movementHandler){var n=x.movementHandler.getSelectedPiece();x.highlightHandler.unHighlightAll()}return t.parentMove!==N?h(e):(u(e,t),void 0!==x.highlightHandler&&void 0!==n&&(x.highlightHandler.highlightCell(n.y.toString()+n.x.toString(),"green","select"),window.settings.getBoolean("game-highlight-possible-square")&&x.highlightHandler.highlightTargetSquares(n)),x)}function v(e){return N=e,x.movementHandler&&x.movementHandler.setCurrentPosition(e),x}function y(){var e=window.settings.getNumber("game-board-speed");if("object"==typeof _[e]){var t=T&&T.getType()||"Blitz";return _[e][t]}return _[e]}function b(){G.additionalArrow=[],x.drawArrow()}function w(e){C.toggleClass("coordinatesOnBoard",e&&C.width()>300)}function k(){setTimeout(function(){var e=C.width();O.setContainerWidth(e),x.reDraw(),H.setSize(e,e)})}var x=this,C=jQuery(e);if(0===C.length&&errorHandler.msg("error",new Error("container not found"),!0,{container:C}),r)var j=new Handler.Keyboard;i=i||Handler.Highlight;var T,_={0:0,1:250,2:500,3:1e3,4:{Bullet:0,Blitz:250,Classical:500}},S=y(),I="x",P="y";void 0===n&&(n=!0),Extend.Suspendable(x),Extend.Subscriber(x,{currentGameChanged:x.delegate(h),"movedPositionPointer.current":x.delegate(g),"position.highlights.current":x.delegate(f),flipBoard:x.delegate(function(){return x.flip()})},{afterLink:function(e){return T=e.publisher,h(e),n&&(x.movementHandler&&x.movementHandler.isActive()&&x.movementHandler.deactivate(),x.movementHandler=new Handler.Movement(e.publisher,C,N,x,x.highlightHandler)),r&&j.link(T),x.highlightHandler&&x.highlightHandler.link(T),x},afterUnlink:function(){return r&&j.unlink(T),n&&x.movementHandler&&x.movementHandler.isActive()&&x.movementHandler.deactivate(),x.highlightHandler&&T&&x.highlightHandler.unlink(T),x}}),x.onResume(function(e){e&&T&&h({publisher:T})});var M,Q,B,E=!0,O=new Handler.Theme(C.width()),A=!0,D=jQuery("<div/>").css({position:"relative",overflow:"hidden"}).addClass("chess-board");C.addClass("board").append(D),w(window.settings.getBoolean("game-coordinates-on-board"));
var H,N,L=[],G={additionalArrow:[]};return x.setUserMoveRight=function(){return x.movementHandler&&x.movementHandler.setUserMoveRight.apply(x.movementHandler,arguments),x},x.getJQueryBoard=function(){return D},x.hideBorder=function(){E=!1;var e=O.getBoardMargin(I),t=O.getBoardMargin(P);return B.css({top:-t+"px",left:-e+"px"}),x.reDraw(),x},x.showBorder=function(){return E=!0,B.css("clip",""),B.css({top:"0px",left:"0px"}),x.reDraw(),x},x.isFlipped=function(){return!A},x.flip=o,x.rotate=o,x.reDraw=function(){var e=O.getSquareSize(),t=O.getBoardSize(I),n=O.getBoardSize(P),i=O.getBoardMargin(I),r=O.getBoardMargin(P);E?D.css({width:t+"px",height:n+"px"}):D.css({width:t-2*i+"px",height:n-2*r+"px",margin:r+"px "+i+"px"}),C.find(".piece").width(e).height(e),C.find(".highlight").width(e).height(e),B.width(O.getBoardSize(I)).height(O.getBoardSize(P)).attr("src",O.getBoardUrl(s())),x.boardOffset=B.position(),x.boardOffset.top=0,x.boardOffset.left=0,M.css({width:t-2*i+"px",height:n-2*r+"px",left:i+x.boardOffset.left+"px",top:r+x.boardOffset.top+"px"});for(var o=x.getCurrentPosition(),a=7;a>=0;a--)for(var l=0;8>l;l++){if(A)var c=l,d=Math.abs(7-a);else c=Math.abs(7-l),d=a;var u=C.find("._"+a+l);if(u.css({width:e+"px",height:e+"px",top:r+x.boardOffset.top+e*d+"px",left:i+x.boardOffset.left+e*c+"px"}),u.removeClass("bright"),u.removeClass("dark"),(a+l)%2!=0&&u.addClass(O.getWhiteSquareColor()),o){var h=o.getPiece(a,l);"-"!==h&&C.find("._"+a+l+" .piece").attr("src",O.getPieceUrl(h))}}return x.drawArrow(),x},x.showPromotionDialog=function(e,n,i,o){function a(t){var n=Chess.getMove(e.y1,e.x1,e.y2,e.x2,t);return function(){return i(n),Q.modal("hide"),jQuery(document).off("keydown.promotion"),r&&j.setActive(!0),!1}}var s=3;o="undefined"==typeof o?!0:o,Q.html("<h3>"+t("Choose your piece")+':</h3><div class="piecesSelection clearFloats"><ul></ul></div>');var l=Q.find("ul");if("w"===n)var c=["R","N","B","Q"];else"b"===n?c=["r","n","b","q"]:errorHandler.msg("error",new Error("illegal color"),!0,{color:n});for(var d=0;d<c.length;d++){var u=jQuery("<li/>"),h=jQuery('<a class="promotionPiece promotionPiece'+d+'" href="?promoteTo='+c[d]+'" />'),f=jQuery('<img src="'+O.getPieceUrl(c[d])+'" />');d===s&&u.addClass("selected"),function(e){u.on("mouseenter",function(){$(this).parent().children("li.selected").removeClass("selected"),$(this).addClass("selected"),s=e})}(d),h.on("click",a(c[d])),h.append(f),u.append(h),l.append(u)}return o&&(jQuery('<input type="checkbox"/>').addClass("cPattern").attr("data-setting","game-autopromote-queen").on("change",function(){this.checked&&a(c[c.length-1])()}).appendTo(Q),Q.append("<span>"+t("Always automatically promote to queen")+"</span>")),window.settings.attach(Q),Q.modal({align:B,classes:"defaultPopup",persistent:!0}).modal("show"),r&&j.setActive(!1),jQuery(document).on("keydown.promotion",function(e){switch(e.which){case 13:Q.find("a.promotionPiece"+s).trigger("click"),e.stopPropagation(),e.preventDefault();break;case 37:s--<=0&&(s=3),e.stopPropagation(),e.preventDefault();break;case 39:s++>=3&&(s=0),e.stopPropagation(),e.preventDefault()}Q.find("li.selected").removeClass("selected"),Q.find("a.promotionPiece"+s).parent().addClass("selected")}),x},x.resize=function(e){return O.setContainerWidth(e),x.reDraw(),x.getCurrentPosition()&&f(void 0,x.getCurrentPosition().getHighlights()),x},x.clearArrow=function(e){return e?(G.premove&&(delete G.premove,x.drawArrow()),x):(x.drawArrow(),x)},x.drawArrow=function(){function e(e,t,n){if(n=n||O.getArrowColor(t),A)var i=e.x1,r=7-e.y1,o=e.x2,a=7-e.y2;else i=7-e.x1,r=e.y1,o=7-e.x2,a=e.y2;var s=O.getSquareSize(),l=r*s+s/2,c=i*s+s/2,d=a*s+s/2,u=o*s+s/2;H.arrow(s,c,l,u,d,s/3,n)}c(),G.premove&&e(G.premove,!0),G.move&&!G.move.isNullMove()&&e(G.move);for(var t=0;t<G.additionalArrow.length;t++)e(G.additionalArrow[t].line,void 0,G.additionalArrow[t].color);return x},x.addArrow=function(e,t,n,i,r){return r?G.premove=Chess.getMove(t,e,i,n):window.settings.getBoolean("game-highlight-last-move")&&(G.move=Chess.getMove(t,e,i,n)),x.drawArrow(),x},x.markKingInCheck=function(){if(window.settings.getBoolean("game-highlight-check")&&x.highlightHandler&&N.isCheck()){var e=N.kingPos[N.moveRight];x.highlightHandler.highlightCell(e.y.toString()+e.x.toString(),"red","take")}return x},x.getCurrentPosition=function(){return N},x.getThemeHandler=function(){return O},x.attachPositionHandler=function(t,n){return x.positionHandler=new Handler.Position(e,t,n),x.movementHandler.deactivate("click"),x},x.attachKeyboardHandler=function(){return r||(r=!0,j=new Handler.Keyboard,T&&j.link(T)),x},x.getKeyboardHandler=function(){return j},x.highlightHandler=new i(C,x.getThemeHandler(),function(){return N.getMoveList.apply(this,arguments)},function(){return N}),x.setBlindfold=function(e){return C.removeClass("blindfoldAll blindfoldBlack blindfoldWhite"),"none"!==e&&C.addClass("blindfold"+e.toLowerCase().capitalize()),x},a(),window.settings.on("settings.game-board-theme",function(e,t){O.setBoardTheme(t.value),x.reDraw()}),window.settings.on("settings.game-piece-theme",function(e,t){O.setPieceTheme(t.value),x.reDraw()}),window.settings.on("settings.game-coordinates-on-board",function(e,t){w(t.value)}),window.settings.on("settings.game-board-speed",function(){S=y()}),window.settings.on("settings.play-board-xl",function(){k()}),x.adjust=k,x},"undefined"==typeof View&&(View={}),View.ChessClock=function(e,t){function n(e){d=e.publisher,u.setColor(Chess.colors.invert(t))}function i(){switch(t){case"w":e.removeClass("black").addClass("white");break;case"b":e.removeClass("white").addClass("black")}r(void 0,d.getClockInformation()),o()}function r(e,t){if(t.runningUp)var n="usage";else n="timeLeft";return l!==t[m][n]&&(l=t[m][n],a(t[m][n],t.runningUp)),u}function o(){var n=d.getEndOfMainlinePosition(!0),i=n&&t===n.moveRight&&!d.isOver()&&d.getClockStartMove()<=d.getDepth();e.toggleClass("active",i)}function a(e,t){var n,i,r=Date.getSplitedTime(e);return r.hours>0?(s(!0,!0),n=r.hours,i=r.minutes.toString().lpad("0",2)):t||r.minutes>0||r.seconds>19?(s(!1,!0),n=r.minutes,i=r.seconds.toString().lpad("0",2)):(s(!1,!1),n=(r.seconds+r.milliseconds/1e3).toFixed(1),i=""),n!==a.valueFirst&&f.html(a.valueFirst=n),i!==a.valueLast&&p.html(a.valueLast=i),u}function s(t,n){if(t)var i="hour";else i=n?"min":"sec";i!==c&&(c=i,e.toggleClass("hours","hour"===c).toggleClass("minutes","min"===c).toggleClass("seconds","sec"===c))}var l,c,d,u=this,h=new Handler.Template("playZone");"w"!==t&&"b"!==t&&errorHandler.error(new Error("illegal color in View.ChessClock"),{color:t}),e=jQuery(e),0===e.length&&errorHandler.error(new Error("container not found in View.ChessClock"),{container:e}),e.html(h.render("clock"));var f=e.find(".first"),p=e.find(".last"),m=Chess.colors.letter2full(t);return Extend.Suspendable(u),o.delegate=u.delegate(o),i.delegate=u.delegate(i),r.delegate=u.delegate(r),Extend.Subscriber(u,{clock:r.delegate,"movedPositionPointer.endOfMainline":o.delegate,gameStatusChanged:o.delegate,currentGameChanged:i.delegate,flipBoard:n},{afterLink:function(e){d=e.publisher,i.delegate()}}),u.onResume(function(e){e&&i()}),u.setColor=function(e){return t=e,c=void 0,l=void 0,m=Chess.colors.letter2full(e),i.delegate(),u},u},"undefined"==typeof View&&(View={}),function(e){var n,i={},r="/api/web/ChessDatabaseAPI/getGamesList",o="/api/web/ChessDatabaseAPI/getGame";View.ChessDBGames=function(a,s){function l(){l.called=!0,a.html(G.render("chessDBgames")),b(),w(),x(),C(),j(),T(),N=a.find(".filteredOpeningTreeButton"),layout(a.find(".databaseGamesSummary"))}function c(e){clearTimeout(A),A=setTimeout(function(){d(e)})}function d(e){l.called||l();var t=e.publisher.getCurrentPosition();D=t.getEngineFen(),u(m())}function u(t,n,o){s&&s.setFilterValues(U);var l=0;U.elo&&(l=parseInt(U.elo.split(",")[0],10)),U.playerName?_(l):S(),t=t||0,V=t,F=n=n||F,z=o=o||z;var c=D+t.toString()+n+o+JSON.stringify(U);return i[c]?void y(i[c],n,o,U):void(L.cacheKey!==c&&(L.ajax&&L.ajax.abort(),a.addClass("loading"),L.cacheKey=c,L.ajax=e.getJSON(r+"?level="+config.level().toString(),{fen:D,offset:t.toString(),sortBy:n,sortOrder:o,playerName:U.playerName,color:U.color,result:U.result,timespan:U.timespan,elo:U.elo,eloType:U.eloType,opponentName:U.opponentName}).done(function(e){e.data.gameList=h(e.data.gameList),i[c]=e.data,i[c].gameCount<=1e4&&_(),y(e.data,n,o,U)})))}function h(e){return e.map(function(e){var t=e._id,n=e.gameStartedAt,i=Helper.getFormatedLocalDateTimeSeperated(n).date,r=e.meta.White.Name,o=e.meta.Black.Name,a=e.meta.White.Elo,s=e.meta.Black.Elo,l=e.meta.AvgElo;return{id:t,date:i,dateValue:n,whiteName:r,blackName:o,whiteElo:a,blackElo:s,avgElo:l,result:e.meta.Result.replace(/1\/2/g,"&frac12;")}})}function f(){var t=e(this),n=t.closest("tr").data("chess_game_id");return i[n]?void v(i[n]):(p(),void e.getJSON(o,{id:n}).done(function(e){i[n]=e,v(e)}))}function p(){W[g()]=V}function m(){return W[g()]||0}function g(){return JSON.stringify(Object.reduce(U,function(e,t){return e.concat(t)},D))}function v(e){for(var t=Chess.couchToGame(e.data.game),n=t.getStartPosition(),i=H.getStartPosition();!n.isEndOfLine();)n=n.getChildrenMoveById(0),H.move(n.moveCoords,i,!1,void 0,"local",!0),i=i.getChildrenMoveByMove(n.moveCoords);var r=G.render("chessDBgamesComment",t.getMeta());H.setComment(r,i),t.destroy()}function y(t,i,r){var o=t.gameList,s=t.gameCount,l=t.additionalData;switch(r){case 1:var c="sortAsc";break;case-1:c="sortDesc"}var d={gameStartedAt:"gameStartedAt"===i,metaWhiteName:"meta.White.Name"===i,metaBlackName:"meta.Black.Name"===i,metaWhiteElo:"meta.White.Elo"===i,metaBlackElo:"meta.Black.Elo"===i,metaAvgElo:"meta.AvgElo"===i,metaResult:"meta.Result"===i},u=a.find(".databaseGames");if(n){var h=n.getActive();Handler.KeyboardDispatcher.remove(n)}var p=jQuery(G.render("chessDBGamesTable",{isAdmin:config.level().isAdmin,games:o,sortByCols:d,sortOrder:c}));u.empty().append(p),n=new Handler.TableKeyboard(p).link(H),Handler.KeyboardDispatcher.add(n,u),h&&Handler.KeyboardDispatcher.select(n),p.on("chess24:select",function(e,t){t.element&&f.call(t.element,e)});var m=a.find(".databaseGamesInfo");if(m.replaceWith(G.render("chessDBGamesCount",{gameCount:Number.addThousandSeparators(s)})),o.length&&u.find("tr.chessGame > td").not(".admin").on("click.chessdbGames",f),P(),M(),Q(s),u.removeClass("loading"),l>0){var g;config.level(!0).isGuest?g=e(Dialog.conversionRegister("analysis",{returnHTML:!0})):config.level().isPremium||(g=e(Dialog.conversionGoPremium("analysis",{returnHTML:!0})));var v=e('<div class="customPopup"/>').append(g.addClass("conversionInPage")).wrap('<div class="conversionOverlayWrapper"/>'),y=e('<div class="conversionOverlay"/>');u.addClass("premiumOnly").append(y).append(v.parent())}}function b(){k(a.find(".playerNameSearch"),a.find(".databaseGamesSearchPattern .searchDBgame"),a.find(".databaseGamesFiltered .resetPlayerSearch"),a.find(".searchPlayerClear"),"playerName")}function w(){k(a.find(".opponentNameSearch"),a.find(".databaseGamesSearchPattern .searchOpponentInput"),a.find(".databaseGamesFiltered .resetOpponentSearch"),a.find(".searchOpponentClear"),"opponentName")}function k(e,t,n,i,r){function o(){e.toggle(B(t))}function a(){U[r]=t.val(),n.text(s+U[r]).show(),t.val(""),o(),u()}var s=t.data("filter-prefix");s&&(s+=": "),t.on("input",o),e.on("click",a),t.on("chess24:select",a),n.on("click",function(){n.hide(),delete U[r],u()})}function x(){function n(){r.hide(),i.filter(".default").prop("checked",!0),delete U.color,u()}var i=a.find(".GameColorSearch input"),r=a.find(".databaseGamesFiltered .resetColorSearch");i.on("change",function(){var i=e(this);return i.hasClass("default")?void n():(U.color=i.data("value"),r.text(t(U.color)).show(),void u())}),r.on("click",n)}function C(){var n=a.find(".GameResultSearch input"),i=a.find(".databaseGamesFiltered .resetResultSearch");n.on("change",function(){U.result=e(this).closest("ul").find("input:checked").map(function(t,n){return e(n).data("value")}).toArray().join(","),U.result?i.text(t(U.result)).show():i.hide(),u()}),i.on("click",function(){i.hide(),n.prop("checked",!1),delete U.result,u()})}function j(){var e=a.find(".TimespanSearch"),t=a.find(".databaseGamesFiltered .resetTimespanSearch");I(e,t,"timespan")}function T(){var e=a.find(".EloTypeSearch input"),t=a.find(".RatingSearch"),n=a.find(".databaseGamesFiltered .resetEloSearch");I(t,n,"elo",e,"eloType")}function _(t){N.removeClass("disabled"),N.on("click",function(){config.level().isPremium?(s&&(t?s.setSelectElementByElo(t):s.setSelectElementFiltered()),e("li.tabDatabaseMoves div").click(),e("a[data-tab-content-id=videoTabDatabaseMoves]").click()):config.level().isGuest?Dialog.conversionRegister("customOpeningTree"):Dialog.conversionGoPremium("customOpeningTree",config.level().isGuest?"register":"goPremium")})}function S(){N.addClass("disabled"),N.unbind("click")}function I(t,n,i,r,o){function a(){return r?r.filter(":checked").siblings("span").text()+": ":""}function s(){U[i]?n.text(a()+U[i].replace(","," - ")).show():n.hide()}t.styleRangeSlider(),r&&o&&r.on("change",function(){var t=e(this);U[o]=t.data("value"),s(),u()});var l=t.children(".cPatternSlider"),c=l.slider("option","min"),d=l.slider("option","max");t.on("slidestop",function(e,t){var n=t.values.map(function(e){return Math.round(e)});c<n[0]||d>n[1]?U[i]=n.join(","):delete U[i],s(),u()}),n.on("click",function(){delete U[i],l.slider("values",[c,d]),s(),u()})}function P(){a.find("a.delete").on("click",function(e){var t="/api/web/chessDatabaseAPI/deleteGame/",n=jQuery(this).data("chess_game_id");n&&Dialog.confirmation("Really delete chessgame?",function(){jQuery.get(t,{id:n}).done(function(){u()}).fail(function(){Dialog.alert("Failed to delete chessgame")})})}),a.find("a.edit").on("click",function(){var t=e(this),n=t.data("chess_game_id");return i[n]?void Dialog.editChessGame(i[n].data.game,function(e){E(n,Object.patch(i[n].data.game,e))}):void e.getJSON(o,{id:n}).done(function(e){i[n]=e,Dialog.editChessGame(i[n].data.game,function(e){E(n,Object.patch(i[n].data.game,e))})})})}function M(){new Handler.Sorting(a,function(e,t){u(V,e,t)})}function Q(e){var t=a.find("tfoot .cPagination > ul"),n={first:t.find(".goFirst"),prev:t.find(".goPrev"),next:t.find(".goNext")},i={offset:V,total:e,limit:t.data("limit"),noOfPagesToShow:9};new Handler.Pagination(n,i,function(e){u(e,F,z)})}function B(e){return!!e.val().trim().length}function E(e,t){var n="/api/web/chessDatabaseAPI/saveGame";jQuery.post(n,{id:e,csrf:config.csrf(),game:t}).done(function(){u()}).fail(function(){Dialog.alert("Failed to save chessgame")})}var O=Extend.Suspendable(this,!0);a=e(a),a||errorHandler.error("container not found in View.ChessDBGames");var A,D,H,N,L={},G=new Handler.Template("database"),R=O.delegate(c),V=0,F="gameStartedAt",z=-1,U={};Extend.Subscriber(O,{currentGameChanged:R,"movedPositionPointer.current":R},{afterLink:function(e){n&&n.unlink(H).link(e.publisher),H=e.publisher,R(e)}}),O.onResume(function(e){e&&H&&c({publisher:H})});var W={};return O}}(jQuery),"undefined"==typeof View&&(View={}),function(e){var t,n,i,r={},o=["move","count","date","avgEloPlayer","maxEloPlayer","avgEloOpponent","percent","performance"],a=["move","count","date","avgEloPlayer","maxEloPlayer","avgEloOpponent","percent","performance"],s="/api/web/ChessDatabaseAPI/getMovesList",l="/api/web/ChessDatabaseAPI/getFilteredOpeningTree",c={1:"sortDesc"};View.ChessDBMovesWithSelector=function(t,r){function o(){var t=e(this);t.hasClass("filtered")||i.html(Handler.Template.renderString(i.data("template"),{games:Number.addThousandSeparators(t.data("games")),positions:Number.addThousandSeparators(t.data("positions"))})),l.setCurrentCollection(t.attr("id"))}t=e(t);var a=new Handler.Template("database");t.html(a.render("chessDBmovesWithSelector",config.level())),i=t.find(".databaseSizeInfo");var s=t.find(".dropdownFilter");n=s.find("input"),layout.dropDown(s),n.on("change",o);var l=new View.ChessDBMoves(t.children(".databaseMoves"),r);return o.apply(n.get(0)),l},View.ChessDBMoves=function(d,u){function h(){return n.filter(function(){return e(this).hasClass("filtered")})}function f(t){return t-=t%100,n.filter(function(){return e(this).attr("id")=="openingTreeOnePlayerAtLeast"+t})}function p(e){clearTimeout(k),k=setTimeout(function(){m(e)})}function m(t){var n=(t&&t.publisher||C).getCurrentPosition(),i=n.moveRight,o=n.getEngineFen(),a=o+j+JSON.stringify(T),c=n.moveCounter;if(r[a])return void b(r[a]);if(_.fen!==o||_.collection!==j||JSON.stringify(_.filters)!==JSON.stringify(T)){_.ajax&&_.ajax.abort(),d.addClass("loading"),_.fen=o,_.collection=j;var u={fen:o,filters:T};j&&(u.collection=j);var h="databaseFilter"==j?l:s;_.ajax=e.getJSON(h+"?level="+config.level().toString(),u).done(function(e){e.data.moveList=g(e.data.moveList,o,i,c),r[a]=e.data,b(e.data)})}}function g(e,t,n,i){t=Chess.translate.engineFenToLongFen(t,"b"===n);var r=new Chess.Position({fen:t}),o=[];return Object.forEach(e,function(e,t){var a="b"===n?Chess.translate.whiteToBlackMove(t):t,s="w"===n?"Player":"Opponent",l="b"===n?"Player":"Opponent",c=r.move({move:Chess.translate.canToMove(a),dontCheckForInsufficentMaterial:!0}).getSan(),d=Math.round(e.averageRatingPlayer),u=Math.round(e.averageRatingOpponent),h=e["point"+s]||0,f=e.draw||0,p=e["point"+l]||0,m=Math.getPercentages([h,f,p]),g={white:m[0],draw:m[1],black:m[2]};o.push({can:a,san:i+("w"===n?". ":"... ")+c,count:e.count,date:Helper.getFormatedLocalDateTimeSeperated(e.lastPlayedDate).date,dateValue:e.lastPlayedDate,avgEloPlayer:d,avgEloOpponent:u,avgElo:Math.round(d,u),maxEloPlayer:e.highestRatedPlayer,maxEloOpponent:e.highestRatedOpponent,maxElo:Math.max(e.highestRatedPlayer,e.highestRatedOpponent),performance:v(u,m,"w"===n),percent:g,resultValue:m[0]+.5*m[1]})}),o}function v(e,t,n){var i=0;return i=n?t[0]:t[2],t[1]>0&&(i+=t[1]/2),Math.round(e+850*(i/100-.5))}function y(){var t=e(this).data("can");C.move(t,x,!0,void 0,"local")}function b(n){var r=n&&n.moveList||[],o=n&&n.additionalItems||0,a=d.find("table.sortable");if(t){var s=t.getActive();Handler.KeyboardDispatcher.remove(t)}if(d.html(S.render("chessDBmoves",{sort:a.data("pattern-sortable")&&a.sortableTable("getCurrentSort")||c,moves:r,columnsToShow:u})),r.length){var l=d.find("table.sortable");l.sortableTable(),t=new Handler.TableKeyboard(l).link(C),Handler.KeyboardDispatcher.add(t,d),s&&(Handler.KeyboardDispatcher.select(t),t.selectDefault()),e("> table tr table tr",d).one("click.openingDB",y),l.on("chess24:select",function(e,t){t.element&&y.call(t.element,e)})}if(n&&n.games&&n.positions&&i.html(Handler.Template.renderString(i.data("template"),{games:Number.addThousandSeparators(n.games),positions:Number.addThousandSeparators(n.positions)})),d.removeClass("loading"),!config.level().isPremium&&o>0){var h=e('<div class="customPopup"/>').append(e(Dialog.conversionGoPremium("analysis",{returnHTML:!0})).addClass("conversionInPage")).wrap('<div class="conversionOverlayWrapper"/>'),f=e('<div class="conversionOverlay"/>');d.append(f).append(h.parent()),d.addClass("premiumOnly")}}u=u||a,u=o.reduce(function(e,t){return e[t]=u.contains(t),e},{});var w=Extend.Suspendable(this,!0);d=e(d).empty(),d.length||errorHandler.error("container not found in ChessDBMoves",{container:d});var k,x,C,j,T,_={},S=new Handler.Template("database"),I=w.delegate(p);return Extend.Subscriber(w,{currentGameChanged:I,"movedPositionPointer.current":I},{afterLink:function(e){return t&&(C&&t.unlink(),t.link(e.publisher)),C=e.publisher,w.isSuspended()?b():void p(e)}}),w.onResume(function(e){e&&C&&p({publisher:C})}),w.setCurrentCollection=function(e){return j=e,p(),w},w.setFilterValues=function(e){T=e,config.level().isPremium&&(Object.getLength(e)?(h().prop("disabled",!1),p()):(h().prop("disabled",!0),n[0].click()))},w.setSelectElementFiltered=function(){h().click()},w.setSelectElementByElo=function(e){h().prop("disabled",!0),f(e).click()},w}}(jQuery),"undefined"==typeof View&&(View={}),View.Color=function(e,t){function n(n){var i=n.publisher,r=i.getEndOfMainlinePosition(!0);e.toggleClass("active",r.moveRight===t&&!i.isOver())}var i=this;return e=jQuery(e),0===e.length&&errorHandler.error(new Error("container not found"),{container:e}),Extend.Subscriber(i,{currentGameChanged:n,"movedPositionPointer.endOfMainline":n},{afterLink:function(e){n(e)}}),i},"undefined"==typeof View&&(View={}),"undefined"==typeof View.Conversation&&(View.Conversation={}),View.Conversation.Conversation=function(e){function t(){var e=jQuery(".conversationContainer"),t=jQuery(window).height()-450;e.css("min-height",t.toString()+"px").height(t)}var n=jQuery(e);0===n.length&&errorHandler.msg("error",new Error("container not found"),!0,{container:n});var i,r=this,o=new Handler.Template("conversation").append(new Handler.Template);n.html(o.render("conversation"));var a,s=n.find(".selectedConversationContainer"),l=new View.Conversation.ConversationList(n.find(".conversationList")),c={};return l.on("selectedConversationChanged",function(e,n){if(i&&(clearTimeout(i),i=null),!c[n.id]){var r=jQuery("<div>");c[n.id]=new View.Conversation.ConversationChat(r,n),s.append(r),t()}null!=a&&a.hide(),a=c[n.id],a.show(),l.getSelectedConversation().hasUnreadMessages()&&(i=setTimeout(function(){l.getSelectedConversation().resetHasUnreadMessages(),a.updateLastReadMessageTimestamp(),notificationHandler.triggerNotificationDeleted("messageReceived",l.getSelectedConversation().data.users[0].uuid)},1e3))}),l.on("removedItem",function(e,t){null!=a&&a.getId()===t.id&&(a=null),c[t.id]&&(c[t.id].remove(),delete c[t.id])}),jQuery(window).resize(t),r},"undefined"==typeof View&&(View={}),"undefined"==typeof View.Conversation&&(View.Conversation={}),View.Conversation.ConversationChat=function(e,n){function i(e){var t,n=C.length;for(t=0;n>t;t++){var i=C[t];if(i.data.id===e)return i.msg.remove(),void C.splice(t,1)}return y}function r(){var e=jQuery(this).closest("[msg-id]").attr("msg-id");if(e){var r,o,a;for(a=C.length,o=0;a>o;o++)C[o].data.id===e&&(r=C[o].data);if(r){var s=r.content,l=Handler.Template.escape(s.substr(0,100));s.length>100&&(l+="..."),Dialog.confirmation(t('Delete message "{{message}}"?',{"{{message}}":l}),function(){conversationHandler.deleteMessage(n.id,r.id,r.timestamp,function(){i(r.id)})})}}}function o(e){if(C.length&&j===g&&x.chatBox.scrollTop()<150){x.loader.show(),j=v;var t=C[0].data;conversationHandler.getPreviousMessages(n.id,t.id,t.timestamp,function(e){x.loader.hide();for(var t=(x.chatBox.prop("scrollHeight"),e.length),n=0;t>n;n++)l(e[n],!0);j=0===t?m:g})}}function a(){var e=x.editor.editor("text").trim();e.length&&(x.editor.editor("reset"),1!==n.type||n.users.length?conversationHandler.sendMessage(n.id,e,void 0,s):conversationHandler.sendPrivateMessage(n.deletedFrom[0].uuid,e,void 0)),x.editor.focus()}function s(e){}function l(e,t){blockedUserHandler.isBlocked(e.user.uuid)||c(e,t)}function c(e,t){var n=C.length,i=null;if(n)if(t)i=C[0];else{var r=n-1;for(i=C[r];r>=0&&!i.msg.hasClass("chatBoxEntry");)r--,i=C[r]}var o=(null!==i&&i.data.user?i.data.user.uuid:"",e.content.split("\n").map(function(e){return e.trim()}).filter(function(e){return e.length>0}).map(function(e){return{line:e}})),a=jQuery(k.render("message",{uuid:e.user.uuid,user:e.user.nick,permalink:e.user.permalink,title:e.user.title,profileImage:e.user.profileImageUrl,nick:e.user.nick,messageId:e.id,gameUuid:e.context&&e.context.gameUuid,message:k.render("messageContent",{lines:o}),placeOnRightSide:e.user.uuid===config.user().uuid})).expandEmoticons().expandLinks();if(t?(x.messages.prepend(a),C.unshift({data:e,msg:a})):(x.messages.append(a),C.push({data:e,msg:a})),a.find(".messageTime").showAge(e.timestamp),""!==e.user.uuid){var s=a.find(".messageUser > a");s.length&&(s.data("uuid",e.user.uuid),s.addMiniprofile())}return a}function d(){w&&C.length>0&&conversationHandler.setLastReadMessageTimestamp(n.id,C[C.length-1].data.timestamp)}function u(e){var t=x.chatBox.scrollTop()>0&&x.chatBox.prop("scrollHeight")-x.chatBox.scrollTop()-x.chatBox.outerHeight()<100;return l(e),(t||e.user.uuid===config.user().uuid)&&(f=x.chatBox.prop("scrollHeight"),x.chatBox.scrollTop(f)),d(),y}function h(){b.find(".conversationInput").addClass("closedConversation")}var f,p=1e5,m=0,g=1,v=2,y=this,b=jQuery(e),w=!1;0===b.length&&errorHandler.msg("error",new Error("container not found"),!0,{container:b});var k=new Handler.Template("conversation");b.html(k.render("chat"));var x={chatBox:b.find(".conversationMessagesContainer"),inputContainer:b.find(".inputContainer"),messages:b.find(".conversationMessages"),btnSendMessage:b.find(".btnSendMessage"),loader:b.find(".messages-scroll-loader"),editor:b.find(".editor.conversation"),chatToolbar:b.find(".chatToolbar")};x.editor.editor({language:config.language(),height:80,maxLength:p,hideToolbar:!0,extensions:["emoticons"],toolbar:{left:[],right:[]},extensionConfig:{emoticons:{dialogContainer:x.inputContainer.find(".btnChatExtension .cTooltipBoxContainer")}},watermark:x.inputContainer.attr("placeholder"),dialogConfig:{emoticons:{showAsPopup:!0}}});x.btnSendMessage.on("click",a),x.messages.on("click",".btnDeleteMessage",r),x.editor.on("keydown",function(e){switch(e.keyCode){case 13:e.shiftKey||(a(),e.preventDefault())}}).on("keyup change",function(e){x.editor.editor("isEmpty")?(x.btnSendMessage.addClass("disabled"),x.btnSendMessage.attr("disabled","disabled")):(x.btnSendMessage.removeClass("disabled"),x.btnSendMessage.removeAttr("disabled")),x.editor.prop("scrollHeight")>x.editor.outerHeight()?x.chatToolbar.css("margin-right","13px"):x.chatToolbar.css("margin-right","0")});var C=[];conversationHandler.on("newMessage."+n.id,function(e,t){u(t.message)}),conversationHandler.conversationListHandler.on("user-left."+n.id,function(e,t){h()}),function(){function e(e){if(x.loader.hide(),t=m,!i&&(i=!0,e.messages)){for(var n=e.messages.length,r=n-1;r>=0;r--)l(e.messages[r]);f=x.chatBox.prop("scrollHeight"),x.chatBox.scrollTop(f),n>0&&(t=g)}}var t,i=!1;x.chatBox.on("scroll",o),setTimeout(function(){x.loader.show(),t=v,conversationHandler.enterConversation(n.id,e)},0),Array.isArray(n.deletedFrom)&&n.deletedFrom.length&&h()}();var j=g;y.getContainer=function(){return b},y.hide=function(){f=x.chatBox.scrollTop(),b.hide(),w=!1},y.show=function(){b.show(),w=!0,x.chatBox.scrollTop(f),layout.tabs(e)},y.getId=function(){return n.id},y.remove=function(){b.remove()},y.updateLastReadMessageTimestamp=d},"undefined"==typeof View&&(View={}),"undefined"==typeof View.Conversation&&(View.Conversation={}),View.Conversation.ConversationList=function(e){function t(){return f}function n(e){f&&e&&f.data.id===e.data.id||(f&&(f.resetIsSelected(),h&&conversationHandler.unblockMessagesNotificationsForConversation(f.getId())),f=e,f&&(f.setIsSelected(),h&&conversationHandler.blockMessagesNotificationsForConversation(f.getId()),d.emit("selectedConversationChanged",e.data)))}function i(e){for(var t=window.location.search.substring(1).split("&"),n=0;n<t.length;n++){var i=t[n].split("=");if(i[0]==e)return i[1]}return null}function r(){p||(p=!0,conversationHandler.conversationListHandler.getConversations()&&o(conversationHandler.conversationListHandler.getConversations()))}function o(e){m=[],u.empty(),e.forEach(function(e){c(e)}),m.length?a():jQuery(".conversationNoMessages").show()}function a(){var e=i("conversationId");if(e){for(var t=0;t<m.length;t++)if(m[t].getId()===e)return void n(m[t]);n(m[0])}else n(m[0])}function s(e){return e=new View.Conversation.ConversationListItem(e),e.$item.on("click",function(){n(e)}),e}function l(e){e=s(e),u.prepend(e.$item),m.unshift(e),e.setLastReadMessageTimestamp()}function c(e){e=s(e),e.$item.on("click",function(){n(e)}),u.append(e.$item),m.push(e),e.setLastReadMessageTimestamp()}var d=Extend.Publisher(this),u=jQuery(e);0===u.length&&errorHandler.msg("error",new Error("container not found"),!0,{container:u});var h,f,p=!1,m=[],g=conversationHandler.conversationListHandler;return function(){g.on("conversationListChanged",function(e,t){p&&o(t)}),g.on("movedItemToStart",function(e,t){if(t>0){var n=m[t];u.prepend(n.$item),m.splice(t,1),m.unshift(n)}}),g.on("newItem",function(e,t){var i=t.index,r=t.converesation;0==i?(l(r),m[0].setHasUnreadMessages()):(c(r),m[m.length-1]||m[m.length-1].setHasUnreadMessages()),f||(jQuery(".conversationNoMessages").hide(),n(m[0]))}),g.on("updateConversation",function(e,t){var n=t.index,i=t.message,r=t.timestamp,o=m[n],a=o.$item.find(".conversationTeaserText");t.isOwnMessage?a.find("span:nth-child(1)").show():a.find("span:nth-child(1)").hide(),a.find("span:nth-child(2)").text(i).expandEmoticons(),o.$item.find(".conversationLastUpdate").showAge(r,!0),f.getId()!==o.getId()&&m[n].setHasUnreadMessages()}),g.on("removedItem",function(e,t){var i=t.index,r=m[i];r.$item.remove(),m.splice(i,1),f.getId()==r.getId()&&(0===m.length?(n(null),jQuery(".conversationNoMessages").show()):n(i>0?m[i-1]:m[i])),d.emit("removedItem",r.data)});var e=jQuery(".userProfileTabs");e.find("#tabMessages").on("chess24:show",function(e){h=!0,f&&conversationHandler.blockMessagesNotificationsForConversation(f.getId()),p||r()}).on("chess24:hide",function(e){h=!1,f&&conversationHandler.unblockMessagesNotificationsForConversation(f.getId())}),"tabMessages"==e.find(".current a").attr("data-tab-content-id")&&(h=!0,r())}(),d.getSelectedConversation=t,d.setSelectedConversation=n,d},"undefined"==typeof View&&(View={}),"undefined"==typeof View.Conversation&&(View.Conversation={}),View.Conversation.ConversationListItem=function(e){function t(e){switch(e.type){case 1:n(e);break;default:errorHandler.warning("unhandled conversation type: "+e.type)}}function n(e){var t=e.users.length>0,n=t?e.users[0]:e.deletedFrom[0];i=jQuery(s.render("conversationListItem",{titleImageUrl:n.profileImageUrl,nick:n.nick,uuid:n.uuid,attributes:n.attributes,permalink:n.permalink,teaserText:e.lastMessage,isOwnMessage:e.lastMessageFrom===config.user().uuid,isClosed:t})).expandEmoticons(),new View.Online(i,n.isOnline,n.uuid).link(notificationHandler),e.lastReadMessageTimestamp<e.lastMessageTimestamp&&a.setHasUnreadMessages();var r=i.find(".conversationUser > a");r.length&&(r.data("uuid",n.uuid),r.addMiniprofile()),i.hover(function(){i.find(".buttons").show()},function(){i.find(".buttons").hide()})}var i,r=902,o=999,a=this,s=new Handler.Template("conversation"),l=!1,c=!1;return conversationHandler.conversationListHandler.on("user-left."+e.id,function(t,n){for(var r=0;r<e.users.length;r++)if(e.users[r].uuid===n){e.deletedFrom.push(e.users.splice(r,1)[0]);break}i.find(".conversationLastUpdate").addClass("closedConversation"),i.find(".userPic").addClass("closedConversation"),i.find(".conversationUser").addClass("closedConversation"),i.find(".conversationTeaserText").addClass("closedConversation"),$buttons=i.find(".buttons"),$buttons.addClass("visible"),$buttons.find(".btnDeleteConversation").removeClass("cIconClose").addClass("cIconDeleteConversation")}),a.setIsSelected=function(){i.addClass("selected"),c=!0},a.resetIsSelected=function(){i.removeClass("selected"),c=!1},a.setHasUnreadMessages=function(){i.addClass("hasNewMessages"),l=!0},a.resetHasUnreadMessages=function(){i.removeClass("hasNewMessages"),l=!1},a.setLastReadMessageTimestamp=function(){i.find(".conversationLastUpdate").showAge(e.lastMessageTimestamp,!0)},a.hasUnreadMessages=function(){return l},a.getId=function(){return e.id},function(){t(e),a.data=e,a.$item=i,i.find(".btnDeleteConversation").on("click",function(){Dialog.confirmation(window.t("Would you like to delete the conversation?"),function(){conversationHandler.deleteConversation(e.id,function(e){if(e.error){var t=window.t("Failed to delete conversation")+":<br>";switch(e.error.code){case r:t+=window.t("Conversation not found");break;case o:t+=window.t("Internal server error")}Dialog.alert(t)}})})})}(),a},"undefined"==typeof View&&(View={}),View.Cursor=function(e,t,n,i){function r(e,n){return function(){if(!y[0])return!1;var i=y[0].getCurrentGameKey();return u[i]?!1:t||!n?void jQuery(document).trigger(e,i):void y.forEach(function(e){
n(e,i)})}}function o(){i&&v.addClass("styleFlexi"),v.html(g.render("cursor",{live:!!i,flip:!!n})),i&&(f.live=v.find(".current"),l=f.live.children("span"),c=f.live.find(".notiBox")),"function"==typeof n&&v.find(".rotate").on(p,n),f.start=v.find(".start").on(p,r("chess24:firstmove",function(e,t){h[t]&&h[t].start?e.gotoId(t,h[t].start):e.gotoStart()})),f.prev=v.find(".prev").on(p,r("chess24:previousmove",function(e,t){(!h[t]||h[t]&&(void 0===h[t].start||e.getCurrentPosition().knotId>h[t].start))&&e.gotoParentPosition()})),f.next=v.find(".next").on(p,r("chess24:nextmove",function(e,t){(!h[t]||h[t]&&(void 0===h[t].end||e.getCurrentPosition().knotId<h[t].end))&&e.gotoNextPosition(!0)})),f.last=v.find(".last, .last-rotate").on(p,r("chess24:lastmove",function(e,t){h[t]&&h[t].end?e.gotoId(t,h[t].end):e.gotoEndOfLine(!0)})),f.tprev=v.find(".textPrev"),f.tnext=v.find(".textNext")}function a(e){var n;if(y[0]&&!u[n=e.publisher.getCurrentGameKey()]){var i=e.publisher.getEndOfMainlinePosition(!0),r=e.publisher.getCurrentPosition();if(f.live.off(p),i===r||e.publisher.isOver()){var o=r.moveRight===Chess.colors.black.letter?r.moveCounter:r.moveCounter-1,a=r.getSan(),s=a?o+(r.moveRight===Chess.colors.white.letter?"... ":". ")+a:"";m=0,l.html(s),f.live.removeClass("liveGrey liveBlue")}else f.live.on(p,function(){t?jQuery(document).trigger("chess24:golive",n):e.publisher.setCurrentPosition(e.publisher.getEndOfMainlinePosition(!0))}),l.html(l.data("live")),m?(f.live.removeClass("liveGrey").addClass("liveBlue"),c.html(m)):f.live.removeClass("liveBlue").addClass("liveGrey")}}function s(e,t){t.isNullMove()||m++}var l,c,d=this,u={},h={},f={},p="click.cursor",m=0,g=new Handler.Template("playZone"),v=jQuery(e);v.length||errorHandler.error(new Error("container not found in View.Cursor"));var y=[];Extend.Subscriber(d,i?{currentGameChanged:a,gameStatusChanged:a,"movedPositionPointer.current":a,"movedPositionPointer.endOfMainline":a,"move.mainline.add":s}:{},{afterLink:function(e){y.push(e.publisher),i&&a(e)},afterUnlink:function(e){y.removeByValue(e.publisher)}}),d.switchEventBased=function(e){return t=e,d},d.isEventBased=function(){return!!t},d.addEventButtons=function(){return f.tprev.show().on(p,r("chess24:previouslink")),f.tnext.show().on(p,r("chess24:nextlink")),d},d.deactivate=function(){if(!y[0])return d;var e=y[0].getCurrentGameKey();return u[e]=!0,jQuery(document).trigger("chess24:suspendmoves",e),d},d.activate=function(){if(!y[0])return d;var e=y[0].getCurrentGameKey();return u[e]=!1,jQuery(document).trigger("chess24:resumemoves",e),d},d.setRange=function(e,t,n){return h[e]={start:t,end:n},d},d.takeOverEvents=function(e){d.eventTarget=!!e,d[e?"setupEvents":"unsetEvents"]()},d.setupEvents=function(){return d.unsetEvents(),jQuery(document).on("chess24:nextmove",b.next).on("chess24:previousmove",b.prev).on("chess24:firstmove",b.first).on("chess24:lastmove",b.last),d},d.unsetEvents=function(){return jQuery(document).off("chess24:nextmove",b.next).off("chess24:previousmove",b.prev).off("chess24:firstmove",b.first).off("chess24:lastmove",b.last),d},o();var b=Object.map(f,function(e,n){return function(){t||f[n].trigger(p)}});return d},"undefined"==typeof View&&(View={}),View.Disconnected=function(e){function n(e,n){var i,r=n.timeout||2e4,o=n.win||!1,d=n.itsMe||!1;return d===!0?(c.html(t("You disconnected")),i="loose"):(l.addClass("blue"),c.html(t("Opponent disconnected")),i="win"),o===!0?u.html(t("seconds to "+i)):u.html(t("seconds to abort")),l.addClass("active"),jQuery("#disconnectTimeout").html(Math.max(0,r/1e3).toString()),a=setInterval(function(){r-=1e3,jQuery("#disconnectTimeout").html(Math.max(0,r/1e3).toString()),0>=r&&clearInterval(a)},1e3),s}function i(e){var n=e.itsMe||!1,i="";i=n===!0?t("You reconnected"):t("Your opponent reconnected"),o(i)}function r(e){var t=e.publisher;return t.getGameStatus().result!==t.getListOfGameResults().OPEN&&o(),s}function o(e){var t=void 0===e?0:3e3;return e=e||"",clearInterval(a),setTimeout(function(){c.html(e),d.html(""),u.html(""),l.removeClass("active blue")},t),s}var a,s=this,l=jQuery(e);0===l.length&&errorHandler.msg("error",new Error("container not found"),!0,{container:l}),Extend.Subscriber(s,{playerDisconnected:n,playerReconnected:i,selfDisconnected:n,selfReconnected:i,gameStatusChanged:r,abortOrResign:o,currentGameChanged:o});var c=jQuery("<span/>").attr("id","disconnectedPrefix"),d=jQuery("<div/>").addClass("digiTime").attr("id","disconnectTimeout"),u=jQuery("<span/>").attr("id","disconnectedSuffix");return l.append(c).append(d).append(u),s},"undefined"==typeof View&&(View={}),View.DrawButton=function(e,n){function i(t){var i=t.publisher;return n()!==i.getCurrentPosition().moveRight&&(u=!0),e.addClass("open"),h.off("click.drawOffer"),e.removeClass("active"),f.on("click.acceptDraw",function(){s(i)}),p.on("click.declineDraw",function(){l(i)}),c}function r(t){return e.removeClass("open active"),f.off("click.acceptDraw"),p.off("click.declineDraw"),o(t),c}function o(t,n){var i=t.publisher;return i.getDepth()<3||i.isOver()?(e.removeClass("active"),h.off("click.drawOffer")):u||(e.addClass("active"),e.removeClass("open"),h.off("click.drawOffer").on("click.drawOffer",function(){a(i)})),colorThatOfferedDraw=void 0,c}function a(t){n()===t.getCurrentPosition().moveRight&&(u=!0),e.removeClass("active"),t.emit("drawOffer")}function s(t){e.removeClass("open"),t.emit("acceptDraw")}function l(t){h.off("click.drawOffer").on("click.drawOffer",function(){a(t)}),e.removeClass("open")}var c=this,d=new Handler.Template("playZone");e=jQuery(e),0===e.length&&errorHandler.msg("error",new Error("container not found"),!0,{container:e});var u=!1;Extend.Subscriber(c,{drawOffered:i,"movedPositionPointer.endOfMainline":function(e){o(e),u=!1},gameStatusChanged:o,currentGameChanged:r},{afterLink:function(e){o(e)}}),e.html(d.render("drawButton"));var h=e.find(".offer"),f=e.find(".accept"),p=e.find(".decline");return h.html(t("Draw")),f.html(t("Accept")),p.html(t("Decline")),c},"undefined"==typeof View&&(View={}),View.EloChange=function(e,t){function n(e){switch(e){case"w":case"white":case"White":t="w",a="White",o="white";break;case"b":case"black":case"Black":t="b",a="Black",o="black"}}function i(e,t){r(e,{meta:t.getMeta()})}function r(t,n){var n=n.meta[a][c];e.removeClass("white black").addClass(o).removeClass(d),void 0!==n?e.addClass(d="dif"+n).html(Math.abs(n)):e.empty()}var o,a,s,l=this,c="EloChange",d="";e=jQuery(e),e.length||errorHandler.error(new Error("container not found in View.EloChange"),{container:e}),Extend.Suspendable(l);var u=l.delegate(r);return Extend.Subscriber(l,{currentGameChanged:l.delegate(i),meta:u,flipBoard:function(e){"b"===t?n("w"):"w"===t&&n("b"),u(e,{meta:e.publisher.getMeta()})}},{afterLink:function(e){s=e.publisher,u(e,{meta:e.publisher.getMeta()})}}),l.onResume(function(e){e&&s&&r({publisher:s},{meta:s.getMeta()})}),n(t),l},"undefined"==typeof View&&(View={}),View.EngineDiagram=function(e){function t(){u=!0,e.slideDown()}function n(){u=!1,e.slideUp()}function i(t,n){return clearTimeout(l),l=setTimeout(function(){for(var n=t.publisher.getStartPosition(),r=[];n=n.getChildrenMoveById(0);){c.contains(n.getEngineFen())||(Handler.engine.on(n.getEngineFen()+":numerical",function(){i(t)}),c.push(n.getEngineFen()));var o=n.getEngine("numerical",!0,!1);if(o&&o.score)isNaN(o.score)||(d.min=Math.max(Math.min(o.score,d.min),-400),d.max=Math.min(Math.max(o.score,d.max),400)),r.push(o.score);else if(o&&void 0!==o.mate)if(0===o.mate){var a="w"==n.moveRight;r.push("#"+(a?"-":"")+"0")}else r.push("#"+o.mate);else r.push(0)}for(var l=0;l<r.length;l++)isNaN(r[l])?"#"===r[l].substr(0,1)&&("-"===r[l].substr(1,1)?r[l]=d.min/100:r[l]=d.max/100):(r[l]>d.max&&(r[l]=d.max),r[l]<d.min&&(r[l]=d.min),r[l]=r[l]/100);for(var l=0;l<r.length;l++)"#"!=(""+r[l]).substr(0,1)&&(r[l]=r[l].toFixed(2));e.barChart(r),s=r},0),o}function r(){s&&setTimeout(function(){e.barChart(s)})}var o=this;e=jQuery(e);var a,s,l,c=[],d={min:-400,max:400},u=window.settings.getBoolean("game-broadcast-engine");Extend.Suspendable(o);var h=o.delegate(i);return Extend.Subscriber(o,{currentGameChanged:h,move:h},{afterLink:function(i){a=i.publisher,h(i);var r=jQuery("<a/>").addClass("barChartMarker cTooltipBox").appendTo("body"),o=jQuery("<span/>").addClass("cTooltipBoxContainer").appendTo(r);e.on("chartover",function(e,t){for(var n=i.publisher.getStartPosition(),a=-1;a<t.index;a++)n=n.getChildrenMoveById(0);var s=t.bar.offset(),l=n.getEngine("numerical",!0,!1);if(l){var c=Handler.engine.formatEngine(l.score);o.html("<h2>"+("w"===n.moveRight?n.moveCounter-1:n.moveCounter)+("w"===n.moveRight?". ... ":". ")+n.getSan()+"<br/>"+c+"</h2>"),r.css({left:s.left+"px",top:s.top+"px",width:t.bar.outerWidth(),height:t.bar.outerHeight()}),c>=0?r.removeClass("position-top").addClass("position-bottom"):r.removeClass("position-bottom").addClass("position-top"),r.off("click").on("click",function(){i.publisher.setCurrentPosition(n)})}}),u?t():n()}}),o.onResume(function(e){u?t():n(),e&&a&&i({publisher:a})}),window.settings.on("settings.game-broadcast-engine.on",t),window.settings.on("settings.game-broadcast-engine.off",n),window.settings.on("settings.play-board-xl",r),o},"undefined"==typeof View&&(View={}),View.EngineGroup=function(e,t){var n=this,i=new Handler.Template("broadcast");e=jQuery(e),t=t||[];var r=[];return 0===e.length&&errorHandler.msg("error",new Error("container not found"),!0,{container:e}),e.html(i.render("game.engine")),t.contains("Engine")?e.find(".engineLines").remove():r.push(new View.Engine(e.find(".engineLines"))),r.push(new View.OutcomePrediction(e.find(".tabEnginePredictionView"))),r.push(new View.EngineDiagram(e.find(".tabEngineDiagrammView"))),r.push(new View.CapturedPieces(e.find(".tabEngineMaterialBalanceView").find(".upper"),["b"],!0)),r.push(new View.CapturedPieces(e.find(".tabEngineMaterialBalanceView").find(".lower"),["w"],!0)),r.push(new View.FenView(e.find(".tabEngineFenView"))),Extend.Subscriber(n,{},{afterLink:function(e){for(var t=0;t<r.length;t++)r[t].link(e.publisher)},afterUnlink:function(e){for(var t=0;t<r.length;t++)r[t].unlink(e.publisher)}}),Extend.Suspendable(n),n.onSuspend(function(){r.forEach(function(e){e.suspend()})}),n.onResume(function(){r.forEach(function(e){e.resume()})}),n};var View=View||{};!function(){View.EngineToggle=function(e){function t(){return a.on("click",r),s?n():i(),o}function n(){a.removeClass("off").addClass("on")}function i(){a.removeClass("on").addClass("off")}function r(){var e=window.settings.getBoolean("game-broadcast-engine");window.settings.set("game-broadcast-engine",e?0:1)}var o=this,a=jQuery(e),s=window.settings.getBoolean("game-broadcast-engine");return window.settings.on("settings.game-broadcast-engine.on",n),window.settings.on("settings.game-broadcast-engine.off",i),t()}}(),"undefined"==typeof View&&(View={}),View.Engine=function(e){function t(){return Handler.engine.formatEngine(this.score,this.mate)}function n(){e.slideDown()}function i(){e.slideUp()}function r(){v="w"==v?"b":"w"}function o(e){e.find(".linkRegister").on("click.engineConversion",function(){return Dialog.conversionRegister(p),!1}),e.find(".linkPremium").on("click.engineConversion",function(){return Dialog.conversionGoPremium(p),!1}),e.find(".linkSettings").on("click",function(){return(new Dialog.PlayzoneSettings).getContent().modal("show"),!1})}function a(n){for(u();n.evaluations.length<3;)n.evaluations.push({});n.score=n.evaluations[0].score,n.mate=n.evaluations[0].mate,n.source&&(n.sourceSwitch={},n.sourceSwitch[n.source]=!0),n.formatScore=t,n.showRegisterConversion=j,n.showPremiumConversion=T,n.isPremium=C.isPremium,n.showInfo=void 0!==n.depth,n.settingsPhrase=!n.source&&!window.settings.getBoolean("game-broadcast-engine-local"),n.phrase=Controller.Broadcast.getPhraseForEvaluation(n.score,n.mate);var i=jQuery(g.render(window.settings.getBoolean(m)?"collapsed":"main",n));return o(i),i.find(".toggleCollapseExpand").on("click",function(){window.settings.set(m,+!window.settings.getBoolean(m))}),e.empty().append(i),i.find(".engine")}function s(e,t){l(e,t.getCurrentPosition())}function l(e,t){clearTimeout(_),_=setTimeout(function(){c(e,t)})}function c(e,t){y&&Handler.engine.off(y+":detailed",d),y=t.getEngineFen(),b=t,Handler.engine.on(y+":detailed",d),Handler.localEngine.newTask(y),d(e,Handler.engine.get(t,"detailed"))}function d(e,t){!x&&Handler.engine.isLocalEvaluation(t)?t=k:t&&t.evaluations&&b.nextMoveIsBlack()&&Handler.engine.shouldInvert(b,t.evaluations[0])&&(t=Handler.engine.invert(t));var n=a(Object.merge(k,t));if(t&&t.evaluations)for(var i=new Chess.Position({fen:b.toString(),validators:[{moveValidator:Chess.Game.validators.freeMove}]}),r=Math.min(t.evaluations.length,n.length),o=0;r>o;o++)if(t.evaluations[o].moves){var s=t.evaluations[o].moves,l=[],c=i,d=[];"b"===i.moveRight&&d.push(i.moveCounter+". ... ");for(var p=0;p<s.length;p++)try{var m=Chess.translate.canToMove(s[p]);c=c.move({move:m,dontCheckForInsufficentMaterial:!0}),l.push(c.getSan());var g="w"===i.moveRight?0:1;p%2===g&&d.push((p+g)/2+i.moveCounter+". ");var v=jQuery("<a/>").html(l[p]).on("click",function(e,t){return function(){u();for(var n=0;n<e.length;n++){w.move(e[n],i,void 0,void 0,"local");var i=w.getLastAddedPosition();if(n===t)var r=i}w.setCurrentPosition(r)}}(s,p));d.push(v),p!==s.length-1&&d.push(" "),h(v,c)}catch(y){errorHandler.warning(new Error("parsing moves for engineView failed"),{lineAsCan:s,lineAsSan:l,move:s[p],position:c.toString()})}jQuery(n[o]).children(".engineLine").append(d)}return f}function u(e){var t=jQuery(".chessBoardViewBubbleContainer");t.find(".chess-board").length||!e?t.bubble("hide"):setTimeout(u,10)}function h(e,t){return e.on("mouseenter",function(){P=P||jQuery('<div class="chessBoardViewBubbleContainer" />'),P.bubble({align:e,side:"bottom",point:"precise",offset_y:-10,noanimation:!0}),S||(S=(new Chess.Game).setNoTimeout(!0)),S.setCurrentPosition(t),I||(I=new View.ChessBoard(P,!1),I.link(S)),"b"==v!=I.isFlipped()&&I.flip(),P.bubble("show")}).on("mouseleave",function(){u(!0)}),f}var f=this,p="engine",m="engine-lines-collapsed";e=jQuery(e);var g=new Handler.Template("engine"),v="w";window.settings.getBoolean("game-broadcast-engine")||e.hide();var y,b,w,k={evaluations:[]},x=window.settings.getBoolean("game-broadcast-engine-local"),C=config.level(),j=C.isGuest,T=!j&&!C.isPremium;Extend.Suspendable(f),Extend.Subscriber(f,{currentGameChanged:f.delegate(s),"movedPositionPointer.current":f.delegate(l),flipBoard:r},{afterLink:f.delegate(function(e){w=e.publisher,l(e,e.publisher.getCurrentPosition())})}),window.settings.on("settings.game-broadcast-engine.on",n),window.settings.on("settings.game-broadcast-engine.off",i),window.settings.on("settings.game-broadcast-engine-local",function(e,t){x=!!t.value,w&&l({publisher:w},w.getCurrentPosition())}),window.settings.on("settings."+m,function(){w&&l({publisher:w},w.getCurrentPosition())}),f.onResume(function(e){e&&w&&l({publisher:w},w.getCurrentPosition())});var _,S,I,P},"undefined"==typeof View&&(View={}),View.FenView=function(e){function t(){clearTimeout(d),s.addClass("fixed").show(),d=setTimeout(function(){s.removeClass("fixed").hide()},2e3)}function n(e){!a.data(l)&&a.is(":visible")&&(a.clipboard({path:config.assetDir()+"/images/swf/jquery.clipboard.swf",copy:function(){return t(),o.html()}}),a.data(l,!0)),o.html(e.publisher.toString())}var i,r=this;e=jQuery(e);var o=e.find(".fen"),a=e.find("a.cBtnWhite"),s=a.children("span"),l="clipboardApplied";o.length&&a.length||errorHandler.error("container not found in View.FenView"),Extend.Suspendable(r);var c=r.delegate(n);Extend.Subscriber(r,{currentGameChanged:c,"movedPositionPointer.current":c},{afterLink:function(e){i=e,c(e)}}),r.onResume(function(e){e&&i&&n(i)});var d;return r},"undefined"==typeof View&&(View={}),View.FirstMoveTimeout=function(e){function t(e){if(e.publisher.getGameStatus().endedBy)return void n();var t=e.publisher.getMeta();if(!t.TournamentUUID)return void n();var r={w:2,b:3},o=l.getAttribute(t.TournamentUUID,"fen"),a=l.getAttribute(t.TournamentUUID,"forfeit_time")/1e3||60;if(o){var s=o.split(" ");s.length>0&&"b"==s[1]&&(r={w:3,b:2})}if([t.White.UUID,t.Black.UUID].contains(config.user().uuid)){var c=t.White.UUID===config.user().uuid?"w":"b";if(e.publisher.getMoveRight()===c)if(e.publisher.getDepth()>=r[c])n();else{if("w"===c)var d=a-Math.round((Controller.Broadcast.offsetCorrectedDateNow()-t.CreatedAt)/1e3);else d=a-Math.round((Controller.Broadcast.offsetCorrectedDateNow()-t.CreatedAt-e.publisher.getCurrentPosition().timeUsage)/1e3);i(d)}else n()}else n()}function n(){clearTimeout(a),a=setTimeout(function(){d.hide("slide",c)}),clearTimeout(r.timer)}function i(e){clearTimeout(a),a=setTimeout(function(){d.show("slide",c)}),r(e)}function r(e){u.html(e),e--,clearTimeout(r.timer),r.timer=setTimeout(function(){u.html(e),e>0?r(e):n()},1e3)}var o,a,s=this,l=new Controller.BroadcastTournament,c={direction:"left"},d=jQuery(e),u=d.find(".digiTime");return 0===d.length&&errorHandler.msg("error",new Error("container not found"),!0,{container:d}),Extend.Subscriber(s,{"movedPositionPointer.current":t,gameStatusChanged:t,currentGameChanged:t},{afterLink:function(e){o=e.publisher,t(e)}}),s},"undefined"==typeof View&&(View={}),View.FlipBoard=function(e){var t=this;return e=jQuery(e),0===e.length&&errorHandler.error(new Error("container not found in View.FlipBoard"),{container:e}),Extend.Subscriber(t,{},{afterLink:function(t){e.on("click.flipBoard",function(){t.publisher.emit("flipBoard")})},afterUnlink:function(){e.off("click.flipBoard")}}),t},"undefined"==typeof View&&(View={}),View.FloatingNotation=function(e){function t(e){return m=!0,n(e),o(),s}function n(e){var t=e.publisher,n=t.getCurrentPosition().knotId;return u.find(".highlighted").removeClass("highlighted"),u.find(".moveId_"+n).addClass("highlighted"),s}function i(){var e=u.find(".highlighted"),t=e.parent();return t.index()}function r(e){var t=d-e;return p||0===t||(0>t?(p=!0,u.cycle("next")):t>0&&(p=!0,u.cycle("prev"))),s}function o(){return c=void 0,r(i()),s}function a(e){function t(e){var n=[],i=e.countChildrenMoves();if(0===i)return n;var r="",o="";if("w"===e.moveRight?r=e.moveCounter+". ":o=e.moveCounter+"... ",k&&n.push(o),e===v.getStartPosition()){var s=jQuery("<a/>");s.text(r.trim()),s.addClass("moveBlock moveId_"+e.knotId),s.on("click",function(){return v.setCurrentPosition(v.getStartPosition()),!1}),n.push(s),n.push(" ")}else n.push(r);if(n.push(a(e.getChildrenMoveById(0))),n.push(" "),k=!1,i>1)for(var l=1;i>l;l++){n.push(" "),n.push(w.openSideline),n.push(o),n.push(r),n.push(a(e.getChildrenMoveById(l))),n.push(t(e.getChildrenMoveById(l)));var c=n.last();" "===c.last()&&c.pop(),n.push(w.closeSideline),n.push(" "),k=!0}n=n.concat(t(e.getChildrenMoveById(0)));for(var l=0;l<n.length;l++)n[l]instanceof jQuery||!Array.isArray(n[l])||n.splice.apply(n,[l,1].concat(n[l]));return n}function a(e){if(void 0===e.comment)var t="";else t=e.comment;t.length>0&&(t=" {"+t+"} ");var n=jQuery("<a/>");return n.text(e.getSan()+t),n.addClass("moveBlock moveId_"+e.knotId),function(e){n.on("click",function(){return v.setCurrentPosition(e),!1})}(e),n}function l(){y=jQuery('<div class="floatingNotationSlider"></div>').appendTo(u);var e=b.push(y);if(e>1){var t=jQuery('<a class="floatingNotationPrevButton cIcon cIconArrowL" href="?prevSlider">&nbsp;&nbsp;</a>');t.on("click",function(){return u.cycle("prev"),c=void 0,m=!1,!1}),y.append(t)}var n=jQuery('<a class="floatingNotationNextButton cIcon cIconArrowR" href="?nextSlider">&nbsp;&nbsp;</a>');return n.on("click",function(){return u.cycle("next"),c=void 0,m=!1,!1}),y.append(n),y}function g(e){0==f&&(f=Math.min(100,u.outerHeight()));var t=y.children(".floatingNotationNextButton");t.before(e);var n=y.outerHeight();for(n>f&&l();n>f;)g(" "),g(t.prev()),g(" "),n=y.outerHeight();return u}var v=e.publisher;u.empty(),h.empty();var y,b;b=[],l();for(var w={openSideline:"(",closeSideline:")"},k=!0,x=t(v.getStartPosition()),C=0;C<x.length;C++)g(x[C]);return g(document.createTextNode(v.getGameStatusAsString())),y.children(".floatingNotationNextButton").remove(),n(e),b.length>1&&u.cycle({fx:"scrollHorz",timeout:0,cleartype:!1,startingSlide:i(),autostop:b.length-1,pager:h,speed:800,pagerAnchorBuilder:function(e,t){return"<li></li>"},onPagerEvent:function(e,t){return m=!1,c=e,r(e),!1},after:function(e,t,n,i){d=jQuery(t).index(),p=!1,m?o():void 0!==c&&r(c)}}),s}var s=this,l=jQuery(e);0===l.length&&errorHandler.msg("error",new Error("container not found"),!0,{container:l}),l.addClass("floatingNotation");var c,d,u=jQuery('<div class="floatingNotationSliderContainer"></div>').appendTo(l),h=jQuery('<div class="floatingNotationPagerContainer"></div>').appendTo(l),f=u.outerHeight(),p=!1,m=!0;return Extend.Subscriber(s,{currentGameChanged:a,"movedPositionPointer.current":t,move:a},{afterLink:function(e){a(e)}}),s},"undefined"==typeof View&&(View={}),View.FraudReport=function(e,t,n){function i(){if(l!==!0){var e=(new Helper.UUID).getShort();notificationHandler.subscribe("fraud:report:"+e).once("fraud:report:"+e,r),jQuery.get("/api/web/fraudAPI/checkGame",{gameSessionToken:n||t.getCurrentGameSessionToken(),requestId:e}),l=!0}}function r(t,n){n=o(n.content),e.html(c.render("report",n))}function o(e){return e.connectionsSplitByPlayer&&(e.connectionsSplitByPlayer=a(e.connectionsSplitByPlayer,!0)),e=Object.map(e,function(e){return a(e)}),Object.extend(e,{formatTime:function(){return Helper.getFormatedLocalDateTime(this.time,Helper.getFormatedLocalDateTimeSeperated.phrases.dateTimeSeconds)}})}function a(e,t){return"object"!=typeof e||Array.isArray(e)?e:Object.reduce(e,function(e,n,i){return e.push({key:i,item:t?a(n,t):n}),e},[])}var s=Extend.Suspendable(this,!0);e=jQuery(e),e.length||errorHandler.error("container not found in View.FraudReport");var l,c=new Handler.Template("fraud");return s.onResume(i),s.onResume(i),s},function(e){"undefined"==typeof View&&(View={});var t={},n="/api/web/UserFriendAPI";View.FriendshipButton=function(){function i(){return e(document).on("click",".friend-button",r),o}function r(){var t=e(this),n=t.data("related-user"),i=t.data("relation"),r={csrf:config.csrf(),relationType:i,relatedUser:n};o.showLoader(n),e.post(a,r).always(function(){o.hideLoader(n)})}if(t.friendshipButton instanceof View.FriendshipButton)return t.friendshipButton;var o=this,a=n+"/UpdateFriendshipRelation";return o.createLoader=function(){var t=e("<img>").attr("src",config.assetDir()+"/images/img/icon_searching_large.gif").css("display","none").addClass("friend-button-loader");return t},o.showLoader=function(t){var n=e(".friend-buttons-for-"+t);n.each(function(){var t=e(this),n=e(".friend-button-loader",t);n.length||(n=o.createLoader(),t.append(n)),n.show(),e(".friend-button",t).hide()})},o.hideLoader=function(t){var n=e(".friend-buttons-for-"+t);n.each(function(){var t=e(this);e(".friend-button-loader",t).hide(),e(".friend-button",t).show()})},t.friendshipButton=i()},View.FriendshipSidebar=function(){function n(){return Extend.Subscriber(k,{friendship:o}),k.link(notificationHandler),Handler.pageTitle.updateNotification(b.html()),k}function i(){e(".sidebarMenu .myFriends > a").data("friends-initialized")||(e(".sidebarMenu .myFriends > a").data("friends-initialized",!0),k.status=g,e(".sidebarMenu .myFriends > a").click(function(){k.status===g&&(k.status=v,b.length&&b.get(0).innerHTML>0&&e("#myfriends-sidebar-incoming-section").show(),r())}))}function r(){e.ajax({url:"/api/web/UserFriendAPI/LoadSidebar",type:"GET",dataType:"json",success:function(t){t&&0===t.status&&t.data?(k.status=y,t.data.aIncomingUsers&&t.data.aIncomingUsers.length>0?(e("#myfriends-sidebar-incoming-content").html(""),e.each(t.data.aIncomingUsers,function(t,n){var i=f(n.sProfileImgSrc,n.sNick,n.sUUID,n.aButtons,n.sLinkToProfile,n.sTitle,n.bIsOnline);e("#myfriends-sidebar-incoming-content").append(i)})):e("#myfriends-sidebar-incoming-content .contentLoader").remove(),e("#myfriends-sidebar-confirmed-content .contentLoader").remove(),t.data.aConfirmedUsers&&t.data.aConfirmedUsers.length>0?(e("#sidebar-confirmed-friends").html(""),e.each(t.data.aConfirmedUsers,function(t,n){var i=p(n.sProfileImgSrc,n.sNick,n.sUUID,n.sLinkToProfile,n.sTitle,n.bIsOnline);e("#sidebar-confirmed-friends").append(i)}),e("#sidebar-confirmed-friends").show()):e("#sidebar-confirmed-friends-empty").show(),e(document).trigger("newhtml")):k.status=g},error:function(t,n,i){k.status=g;var r=window.t("Failed to change load my friends sidebar");try{var o=e.parseJSON(t.responseText);for(var a in o.errors){r=o.errors[a][0];break}}catch(s){}errorHandler.msg("error",new Error(r),!1)}})}function o(e,t){switch(t.content.sAction){case"action_incoming_request_add":a(t.content);break;case"action_incoming_request_remove":s(t.content);break;case"action_outgoing_request_add":break;case"action_outgoing_request_remove":break;case"action_friend_add":l(t.content);break;case"action_friend_remove":c(t.content);break;case"action_blocked_add":break;case"action_blocked_remove":break;case"action_update_buttons":h(t.content)}}function a(t){if(d(),k.status==y){var n=f(t.sShownUserImageSrc,t.sShownUserName,t.sShownUserUuid,t.aButtons,t.sLinkToShownUserProfile,t.sTitle,!0);0===e("#myfriends-sidebar-incoming-content").children().length?(e("#myfriends-sidebar-incoming-content").html(n),e("#myfriends-sidebar-incoming-section").show()):e("#myfriends-sidebar-incoming-content").prepend(n),e("#myfriends-sidebar-incoming-content").trigger("newhtml")}}function s(t){u(),k.status==y&&(e("#sidebar-friend-incoming-"+t.sShownUserUuid).remove(),0===e("#myfriends-sidebar-incoming-content").children().length&&e("#myfriends-sidebar-incoming-section").hide())}function l(t){if(k.status==y){var n=p(t.sShownUserImageSrc,t.sShownUserName,t.sShownUserUuid,t.sLinkToShownUserProfile,t.sTitle,t.bIsOnline);0===e("#sidebar-confirmed-friends").children().length&&(e("#sidebar-confirmed-friends-empty").hide(),e("#sidebar-confirmed-friends").show()),e("#sidebar-confirmed-friends").prepend(n),e("#sidebar-confirmed-friends").trigger("newhtml")}}function c(t){k.status==y&&(e("#sidebar-friend-confirmed-"+t.sShownUserUuid).remove(),0===e("#sidebar-confirmed-friends").children().length&&(e("#sidebar-confirmed-friends").hide(),e("#sidebar-confirmed-friends-empty").show()))}function d(){var e=parseInt(b.html());e=e?e+1:1,b.html(e).show(),Handler.pageTitle.updateNotification(1)}function u(){var e=parseInt(b.html());e=e?e-1:0,b.html(e),e||b.hide(),Handler.pageTitle.updateNotification(-1)}function h(t){var n=e(".friend-buttons-for-"+t.sShownUserUuid);n.each(function(){var n=e(this);e(".friend-button",n).remove(),e(".friend-buttons-for-"+t.sShownUserUuid+" .friend-button-loader").hide(),e.each(t.aButtons,function(e,t){if("Block"===t.sButtonRelation&&!n.data("withblockbtn"))return!1;var i=m(t.sButtonRelation,t.sUUID,t.sButtonTitle,t.sButtonClass);n.append(i)})})}function f(t,n,i,r,o,a,s){for(var l=0;l<r.length;l++)r[l].sButtonTitle=window.t(r[l].sButtonTitle);var c=w.render("sidebarFriendIncoming",{sProfileImgSrc:t,sNick:n,sUUID:i,aButtons:r,sTitle:a,sLinkToProfile:o});return $node=e(c),new View.Online($node,s,i).link(notificationHandler),$node}function p(t,n,i,r,o,a){var s=w.render("sidebarFriendConfirmed",{sProfileImgSrc:t,sNick:n,sUUID:i,sTitle:o,sLinkToProfile:r});return $node=e(s),new View.Online($node,a,i).link(notificationHandler),$node}function m(e,t,n,i){var r=w.render("friendButton",{sUUID:t,sButtonClass:i,sButtonRelation:e,sButtonTitle:window.t(n)});return r}var g=0,v=1,y=2,b=e("#count-incoming-friends"),w=new Handler.Template("friendship");if(t.friendshipSidebar instanceof View.FriendshipSidebar)return t.friendshipSidebar;var k=this;return i(),t.friendshipSidebar=n()},View.FriendshipProfile=function(n){function i(t){return _.reInit(t),e(window).scroll(_.checkAndLoad),_}function r(){clearTimeout(m),m=setTimeout(function(){a()},w)}function o(e,t){return t!==!0&&p==C?!1:(clearTimeout(m),a(),!1)}function a(){p=C,u(),g&&(g.abort(),g=null),v&&(v.abort(),v=null),g=e.ajax({url:S,data:{permalink:f,filter:e("#profile_friend_filter").val(),sort_by:e("#profile_friend_sort_by").val(),sort_order:e("#profile_friend_sort_order").val(),lang:config.language()},type:"GET",dataType:"json",success:function(t){h(),e(T).each(function(){_.removeOnlineAndChallengeLinks(e(this))}),e(T).remove();var n=null;t&&0===t.status&&t.data&&(t.data.aFriends&&t.data.aFriends.length?(e("#profile-friends-empty-list").hide(),e("#profile-friends-list").show(),e.each(t.data.aFriends,function(t,i){var r=s(i);n?n=r.insertAfter(n):(n=r,e("#profile-friends-list").prepend(r)),_.addOnlineAndChallengeLinks(r,i)})):(e("#profile-friends-empty-list").show(),e("#profile-friends-list").hide())),p=k},error:function(t,n,i){(0!==t.readyState||0!==t.status)&&(p=k,h(),e("#profile-friends-empty-list").show(),e("#profile-friends-list").hide())}})}function s(e){var t=parseInt(e.myData.score.me,10)||parseInt(e.myData.score.him,10);return e.myData.score.me=Controller.Broadcast.scoreToString(e.myData.score.me),e.myData.score.him=Controller.Broadcast.scoreToString(e.myData.score.him),jQuery(y.render("profileFriend",{me:e.me,user:e.user,label:e.label,myData:e.myData,showScore:t},"miniProfile"))}function l(t){var n=e(window).scrollTop(),i=n+e(window).height(),r=t.offset().top;return i+b>r}function c(){e("#profile-friends-scroll-loader").show()}function d(){e("#profile-friends-scroll-loader").hide()}function u(){e("#profile-friends-sortandfilter-loader").show()}function h(){e("#profile-friends-sortandfilter-loader").hide()}if(t.friendshipProfile instanceof View.FriendshipProfile)return t.friendshipProfile.reInit(n),t.friendshipProfile;var f,p,m,g,v,y=new Handler.Template("friendship").append(new Handler.Template),b=150,w=500,k=1,x=2,C=3,j=4,T=".profile-friend",_=this,S="/api/web/UserFriendAPI/LoadMoreFriends";return _.reInit=function(t){return e("#tabFriends").on("click","#profile-friend-btn-trigger-filtration",null,o),e("#tabFriends").on("change","#profile_friend_sort_by, #profile_friend_sort_order",null,function(e){o(e,!0)}),e("#tabFriends").on("keyup","#profile_friend_filter",null,r),p=k,f=t||"",e("#tabFriends").data("friendshipProfileView",_),_},_.addOnlineAndChallengeLinks=function(e,t){t&&(t.user&&void 0!==t.user.online&&(e.data("ViewOnline",new View.Online(e,t.user.online,t.user.uuid)),e.data("ViewOnline").link(notificationHandler)),t.me||(e.data("ViewChallengeButton",new View.ChallengeButton(e.find(".challenges"),t.user.uuid,t)),e.data("ViewChallengeButton").link(notificationHandler),config.level().isGuest?e.find(".sendUserMessage").hide():e.find(".sendUserMessage").on("click",function(e){e.preventDefault(),new Dialog.UserMessage(t.user.uuid)})))},_.removeOnlineAndChallengeLinks=function(e){e.data("ViewOnline")&&e.data("ViewOnline").unlink(notificationHandler),e.data("ViewChallengeButton")&&e.data("ViewChallengeButton").unlink(notificationHandler)},_.checkAndLoad=function(){var t=e(T).last();p==k&&t.is(":visible")&&l(t)&&(p=x,c(),v=e.ajax({url:S,data:{offset:e(T).length,permalink:f,filter:e("#profile_friend_filter").val(),sort_by:e("#profile_friend_sort_by").val(),sort_order:e("#profile_friend_sort_order").val(),lang:config.language()},type:"GET",dataType:"json",success:function(n){p=k,d(),n&&0===n.status&&n.data&&(n.data.aFriends&&n.data.aFriends.length?(e.each(n.data.aFriends,function(e,n){t=s(n).insertAfter(t),_.addOnlineAndChallengeLinks(t,n)}),_.checkAndLoad()):p=j)},error:function(e,t,n){d(),(0!==e.readyState||0!==e.status)&&(p=k)}}))},t.friendshipProfile=i(n)}}(jQuery),"undefined"==typeof View&&(View={}),View.Highlight=function(e){function t(t){jQuery("."+t+":first").addClass(e).trigger("highlight"),r=t}function n(t){jQuery("."+t).removeClass(e)}function i(e){var i=e.publisher;if("function"!=typeof i.getCurrentGameKey)return o;var a=i.getCurrentGameKey()+"_"+i.getCurrentPosition().knotId;return void 0!==r&&n(r),t(a),o}var r,o=this;return e=e||"highlight",Extend.Subscriber(o,{"movedPositionPointer.current":i,currentGameChanged:i},{
afterLink:function(e){i(e)}}),o},"undefined"==typeof View&&(View={}),View.initialPopup=function(e,t){function n(){var n=jQuery(r.render(e,t));n.appendTo("body");var i=n.modal({classes:"customPopup",close:!0});i.modal("show"),n.find(".initialPopupCloseBtn").on("click",function(){i.modal("hide")})}var i=this,r=new Handler.Template("initialPopup");return n(),i},"undefined"==typeof View&&(View={}),View.InlineNotation=function(e){function t(e){var t=e.publisher,i=t.getEndOfMainlinePosition(!0),a=0,s=[];for(t.isOver()&&s.unshift(" "+t.getGameStatusAsString());o>a&&i.parentMove;)a>0&&(i.lastMoveWasBlack()?s.unshift(" "+i.moveCounter+". "):s.unshift(" ")),s.unshift(n(t,i)),i=i.parentMove,a++;r.empty().append(s)}function n(e,t){var n=jQuery('<a href="?gotoId'+t.knotId+'"/>');return n.text(t.getSan()),n.addClass("moveId_"+t.knotId),function(t){n.on("click",function(){return e.setCurrentPosition(t),!1})}(t),n}var i=this,r=jQuery(e);0===r.length&&errorHandler.msg("error",new Error("container not found"),!0,{container:r}),Extend.Subscriber(i,{currentGameChanged:t,"movedPositionPointer.endOfMainline":t,gameStatusChanged:t},{afterLink:function(e){t(e)}});var o=15;return i},"undefined"==typeof View&&(View={}),View.LessonPages=function(e,t,n,i,r,o,a,s,l,c,d,u){function h(){f(),N.on("resize",function(){H.stop(!0,!0),v()})}function f(){var e=window.location.hash.replace("#",""),t=parseInt(e);if(isNaN(t)||1>t||t>Q)if(o===!0)t=1;else for(var n=0;n<a.length&&(t=n+1,void 0!==s[a[n]]);n++);M.showPage(t)}function p(e,t){var n=m(e);if(0===n.length)return!0;j&&j.abort();for(var i=[],d=0;d<n.length;d++)i.push(a[n[d]-1]);j=jQuery.ajax({url:l,data:{pages:i,lessonId:r},type:"GET",dataType:"json",success:function(e){e&&0===e.status&&e.data&&e.data.pages&&jQuery.each(e.data.pages,function(e,t){for(var n in a)if(a[n]===t.pageId){var i=parseInt(n)+1;break}E[i]=new View.SchoolPage(t,c,1==i,i==Q,s[t.pageId],o,u,G,R),E[i].on("back",function(){M.showPreviousPage()}),E[i].on("next",function(){M.showNextPage()}),E[i].on("stateUpdated",function(e,n){s[t.pageId]=n,w()}),i==Q&&o!==!0&&(E[i].on("canBeFinished",function(){D=!0}),E[i].on("finish",function(){M.finishLesson()}))}),"function"==typeof t&&t(),j=null},error:function(e,t,n){return j=null,e&&"abort"===e.statusText?!0:void 0},cache:!1})}function m(e){var t=null,n=null;if(null===B)1===e?(t=1,n=T):(t=e-Math.floor(T/2),n=e+Math.ceil(T/2));else if(e>B){for(var i=e;e+_>=i;i++)if(!E[i]){t=i,n=i+_;break}}else for(var i=e;i>=e-_;i--)if(!E[i]){t=i-_,n=i;break}var r=[];if(t&&n){t=1>t?1:t,n=n>Q?Q:n;for(var i=t;n>=i;i++)E[i]||r.push(i)}return r}function g(e,t){if(null===B)C||(C=y(),N.html(C)),C.html(t),C.trigger("onLessonPageLoaded",C),C.trigger("newhtml"),H.height(N.height());else if(e>B){var n=y();n.html(t),n.insertAfter(C),n.trigger("onLessonPageLoaded",n),n.trigger("newhtml"),v(),H.find(".lessonPageButtons").css("visibility","hidden"),O=!0,function(e,t){N.stop(!1,!1).animate({left:"-"+S+"px"},I,function(){E[e].detachContent(),t.remove(),N.css("left","0px"),v(function(){H.find(".lessonPageButtons").css("visibility","visible"),O=!1})})}(B,C),C=n}else{var n=y();n.html(t),n.insertBefore(C),n.trigger("newhtml"),N.css("left","-"+S+"px"),v(),H.find(".lessonPageButtons").css("visibility","hidden"),O=!0,function(e,t){N.stop(!1,!1).animate({left:"0px"},I,function(){E[e].detachContent(),t.remove(),v(function(){H.find(".lessonPageButtons").css("visibility","visible"),O=!1})})}(B,C),C=n}}function v(e){H.animate({height:N.height()},I/2,e)}function y(){return jQuery("<div>").addClass("lessonPage")}function b(){var e=0,t=0,n=0;for(var i in s)n++,("success"===s[i].status||"failed"===s[i].status)&&(e++,"success"===s[i].status&&t++);return Q>n?!1:0===e?!0:t/e>=2/3?!0:!1}function w(){jQuery.each(a,function(e,t){void 0!==s[t]&&L.find("li").eq(e).addClass("completed")})}function k(e){L.find("li").removeClass("current"),L.find("li").eq(e-1).addClass("current")}function x(){N.hide(),H.find(".illegalPage").show(),H.height(H.find(".illegalPage").height())}var C,j,T=3,_=2,S=980,I=500,P=new Handler.Template("schoolLesson").append(new Handler.Template),M=this,Q=a.length,B=null,E={},O=!1,A=!1,D=!1,H=jQuery(e);0===H.length&&errorHandler.msg("error",new Error("container not found"),!0,{container:H});var N=H.find(".lessonPagesCarriage"),L=jQuery(i),G="csrf",R=config.csrf();return M.showNextPage=function(){return O===!0?!1:null===B?!1:B+1>Q?!1:void M.showPage(B+1)},M.showPreviousPage=function(){return O===!0?!1:null===B?!1:2>B?!1:void M.showPage(B-1)},M.showPage=function(e){if(e===B)return!1;if(window.location.hash=e,k(e),E[e]){if(e>1&&void 0===s[a[e-2]])return x(),!1;var t=E[e].getContent();g(e,t),E[e].isExercise()?jQuery(n).addClass("training"):jQuery(n).removeClass("training"),p(e),B=e}else{var i=P.render("lessonPageLoader");g(e,i),B=null,p(e,function(){E[e]?M.showPage(e):x()})}},M.finishLesson=function(){if(D===!0&&A===!1){A=!0;var e={lesson:r};e[G]=R,jQuery.ajax({url:d,data:e,type:"POST",dataType:"json",success:function(e){},error:function(t,n,i){errorHandler.msg("error",new Error("Failed to finish the lesson in the school"),!1,{textStatus:n,requestData:e})},cache:!1});var n=jQuery(t).modal({classes:"customPopup",persistent:!0,close:!1});b()===!0?(n.find(".lessonFailed").remove(),n.find(".restartLessonBtn").remove()):n.find(".lessonFinished").remove(),n.show(),window.location.hash=""}},h(),M},View.SchoolPage=function(e,t,n,i,r,o,a,s,l){function c(e,t,n){e.find(".pageExerciseContainer").find(".styleWrapper").addClass(n?"correct":"incorrect"),t.stop(),e.find(".schoolPageCheckExerciseBtn").remove(),e.find(".schoolNextPageBtn").show(),i===!0&&e.find(".schoolFinishLessonBtn").show(),e.trigger("resize"),d(n?"success":"failed",t.getAnswer())}function d(n,r){if(null===f.status){f.status=n,f.state=r,f.emit("stateUpdated",{status:f.status,state:f.state});var o={page:e.pageId,status:f.status,data:f.state};o[s]=l,jQuery.post(t,o,"json").done(function(e){i===!0&&u()}).fail(function(e,t,n){errorHandler.msg("error",new Error("Failed to set page state in the lesson of the school"),!1,{textStatus:t,requestData:o})})}}function u(){f.emit("canBeFinished"),h.find(".schoolFinishLessonBtn").removeClass("disabled")}var h,f=this,p=!1;f.status=r&&r.status?r.status:null,f.state=r&&r.state?r.state:null,Extend.Publisher(this);var m=new Handler.Template("schoolLesson").append(new Handler.Template);f.detachContent=function(){h.detach()},f.getContent=function(){if(!p){switch(p=!0,e.type){case"content":h=m.render("schoolContentPage",e),h=jQuery(h),setTimeout(function(){h.find(".widgetcontainer.chessbubble").trigger("chess24:lock")},1),h.find(".schoolPageCheckExerciseBtn").remove();break;case"exercise":h=m.render("schoolExercisePage",e),h=jQuery(h),h.find(".schoolNextPageBtn").hide();var t=h.find(".pageExerciseContainer"),r=PuzzleFactory(t,e.contentData);r.start(),r.setSubmitBtn(h.find(".schoolPageCheckExerciseBtn")),r.on("success",function(e){c(h,r,!0)}),r.on("failure",function(e){c(h,r,!1)}),("success"===f.status||"failed"===f.status)&&setTimeout(function(){r.giveAnswer(f.state)},1);break;case"video":h=m.render("schoolVideoPage",e),h=jQuery(h),h.find(".schoolPageCheckExerciseBtn").remove(),h.find(".interactiveVideoChess").videoDisplay(e.contentData.ids,e.contentData.videoUrls,e.contentData.imageUrl)}if(n===!0&&h.find(".schoolBackPageBtn").remove(),i===!0)if(h.find(".schoolNextPageBtn").remove(),o!==!0)null!==f.status?u():"exercise"===e.type?h.find(".schoolFinishLessonBtn").hide():n===!0?d("completed"):setTimeout(function(){d("completed")},1500),h.find(".schoolFinishLessonBtn").on("click",function(e){return jQuery(this).hasClass("disabled")||f.emit("finish"),e.preventDefault(),!1});else{h.find(".schoolFinishLessonBtn").remove();var s=m.render("courseOverviewPageButton",{courseOverviewUrl:a});h.find(".lessonPageButtons").append(s)}else h.find(".schoolFinishLessonBtn").remove();h.find(".schoolBackPageBtn").on("click",function(e){return f.emit("back"),e.preventDefault(),!1}),h.find(".schoolNextPageBtn").on("click",function(e){return d("completed"),f.emit("next"),e.preventDefault(),!1})}return h},f.isExercise=function(){return"exercise"===e.type}},"undefined"==typeof View&&(View={}),View.MetaEditor=function(e,t){function n(n){var o={edit:!!t,tags:t&&!!p||p&&p.length,tag:p?0===p.length?p:p:!1,meta:i(n.publisher.getMeta())};e.html(u.render("meta",o)),t?(r(),p&&p.length&&p.forEach(function(t){e.find("div.suggestField").suggestField("add",{name:t.replace(/</g,"&lt;"),value:t})}),a(e.find(".metaEditor li"))):p&&p.length&&e.find(".tags span").on("click",function(e){d.emit("click",jQuery(this).text())})}function i(e){return Object.keys(f).map(function(t){for(var n=t.split("."),i=e;"object"==typeof e[n[0]]&&null!==e[n[0]];)i=e[n[0]],n.shift();return{name:t,value:i[n[0]],label:window.t(t.replace(/\./g," "))}})}function r(){e.find("div.suggestField").suggestField().suggestField("filter",function(e){return(""+e).sanitize()}).suggestField("clickable",function(e){d.emit("click",e)}).on("chess24:select",function(){d.emit("change",jQuery(this).suggestField("values",!0).map(function(e){return e.sanitize()}))}),e.find("input.suggestField").on("blur",function(){this.value=""}),e.find("[data-attribute]").each(function(){var t=jQuery(this),n=t.data("attribute"),i=f[n];if(i){var r=t.find("span");r.on("click",function(){if(!t.is(".editing")){var o=e.find(".editing[data-attribute]");o.length&&l(o.find("span"));var a=t.is(".empty")?"":r.html();if(r.data("original-value",a).empty(),"string"===i){var c=jQuery('<input type="text"/>').val(a).data("restore",a).appendTo(r).focus();c.css("width",t.width()-r.position().left+"px");var d=c,u=!1,h="blur"}else if("number"===i)c=jQuery('<input type="number"/>').val(a).data("restore",a).appendTo(r).focus(),d=c,u=!1,h="blur";else if("date"===i){c=jQuery("<span/>").appendTo(r);for(var f=a.split("."),p=jQuery('<select class="day"/>').appendTo(c).data("restore",f[2]).append('<option value="">'+window.t("day")+"</option>"),m=1;31>=m;m++)p.append(jQuery("<option/>").val(m).html(m).attr("selected",m==f[2]));for(var g=jQuery('<select class="month"/>').appendTo(c).data("restore",f[1]).append('<option value="">'+window.t("month")+"</option>"),m=1;12>=m;m++)g.append(jQuery("<option/>").val(m).html(m).attr("selected",m==f[1]));p.add(g).on("change",function(){jQuery(this).toggleClass("novalue",0===this.selectedIndex)}).trigger("change"),d=jQuery('<input type="text" class="year" maxlength="4" placeholder="'+window.t("year")+'"/>').data("restore",f[0]).val(f[0]||"").appendTo(c).on("keypress keyup",function(){setTimeout(function(){d.val(d.val().replace(/\D/,""))})}),u=!0}else"time"===i?(c=jQuery('<input type="text" data-time="true"/>').addClass("cPattern").val(a).data("restore",a).appendTo(r),layout.timePickers(c),h="changeTime",u=!1):i instanceof Array&&(c=jQuery('<select class="cPattern"/>').appendTo(r).data("restore",a),i.forEach(function(e){c.append(jQuery("<option/>").val(e).html(e).attr("selected",e==a))}),layout.dropDown(c),h="change",u=!1);h&&c.on(h,function(){clearTimeout(s.timeout),s.timeout=setTimeout(function(){s(n,c)},100)}),d&&d.on("keyup",function(e){switch(e.which){case 27:return l(r),!1;case 13:return s(n,c),!1}}),t.addClass("editing"),u&&t.append(jQuery('<a class="save"/>').on("click",function(){s(n,c)})),t.append(jQuery('<a class="cancel"/>').on("click",function(){l(r)}))}})}})}function o(e,t){if("date"===f[t]){var n=e.find(".year").val()||"????",i=e.find(".month").val()||"??",r=e.find(".day").val()||"??";return"????"===n&&"??"===i&&"??"===r?"":(""+n.substr(0,4)).lpad("0",4)+"."+(""+i).lpad("0",2)+"."+(""+r).lpad("0",2)}return e.val().sanitize()}function a(e){var t=e.parent("ul").data("empty");e.each(function(){var e=jQuery(this),n=e.find("span");n.text().trim()?e.removeClass("empty"):(e.addClass("empty"),n.html(t))})}function s(e,t){for(var n=o(t,e),i=c.getMeta(),r=i,a=e.split("."),s=0;r[a[s]]&&"object"==typeof r[a[s]];)r=r[a[s++]];r[a[s]]=n,c.setMeta(i)}function l(e){clearTimeout(s.timeout);var t=e.closest("li");e.empty().html(e.data("original-value")),a(t.removeClass("editing")),t.find(".cancel, .save").remove()}var c,d=this,u=new Handler.Template("database"),h=[void 0,"GM","IM","FM","CM","WGM","WIM","WFM","WCM"],f={Site:"string",Event:"string",Date:"date",Time:"time",Round:"number",Board:"number",Result:["1-0","0-1","1/2-1/2","*"],"White.Name":"string","White.Elo":"number","White.Title":h,"White.Country":"string","Black.Name":"string","Black.Title":h,"Black.Elo":"number","Black.Country":"string"},p=!1;return e=jQuery(e),e.length||errorHandler.error("container not found in View.MetaEditor"),Extend.Suspendable(d),n.delegate=d.delegate(n),Extend.Subscriber(d,{currentGameChanged:n.delegate,meta:n.delegate},{afterLink:function(e){c=e.publisher,n.delegate(e)}}),Extend.Publisher(d),d.onResume(function(e){e&&c&&n({publisher:c})}),d.refresh=function(){c&&n.delegate({publisher:c})},d.toggleEdit=function(e){e=!!e,t!==e&&c&&(t=e,n.delegate({publisher:c}))},d.setTags=function(e){return p=e,d},d.getTags=function(){return e.find(".suggestField").suggestField("values",!0)},d},"undefined"==typeof View&&(View={}),function(){var e={name:"Name",title:"Title",titleName:"TitleName",staff:"Staff",moderator:"Moderator",fraud:"Fraud",cop:"Cop",elo:"Elo",country:"Country",premium:"Premium"};View.Meta=function(t,n,i,r,o){function a(e){switch(e){case"w":case"white":case"White":n="w",d="White",c="white";break;case"b":case"black":case"Black":n="b",d="Black",c="black"}}function s(e,t){l(e,{meta:t.getMeta()})}function l(n,a){var a=a.meta[d][e[i]||i];t.removeClass("white black"),o||t.empty(),a?(t.addClass(c).addClass(i),o||t.html(p+a+m),r&&t.show()):r&&t.hide(),h&&h(t,a)}var c,d,u,h,f=this,p="",m="";t=jQuery(t),0===t.length&&errorHandler.error(new Error("container not found in View.Meta"),{container:t}),f.setPrefix=function(e){return p=e,f},f.setSuffix=function(e){return m=e,f},Extend.Suspendable(f);var g=f.delegate(l);return Extend.Subscriber(f,{currentGameChanged:f.delegate(s),meta:g,flipBoard:function(e){"b"===n?a("w"):"w"===n&&a("b"),g(e,{meta:e.publisher.getMeta()})}},{afterLink:function(e){u=e.publisher,g(e,{meta:e.publisher.getMeta()})}}),f.onResume(function(e){e&&u&&l({publisher:u},{meta:u.getMeta()})}),f.setCustomUpdate=function(e){return h="function"==typeof e?e:void 0,f},a(n),f}}(),"undefined"==typeof View&&(View={}),View.NotationArea.registerExtension("AfterGameControls","after",function(e){function t(e){if(!e.publisher.isOver())return a=!1,void l.empty();a=!0,l.html(s.render("extensions.afterGameControls",i(e))),l.find(".newGame").on("click",function(){return Controller.getPlayZone().playNow(),!1}),l.find(".pgnDownload").on("click",function(){return config.level().isPremium?(Handler.tracking("pgn","game"),!0):(Handler.tracking("pgn","gameConversion"),Dialog.conversionGoPremium("pgnDownload"),!1)}),config.level().isPremium||l.find(".analyze").on("click",function(){return Dialog.conversionGoPremium("analysisMode"),!1}),l.find(".share").shareButtons({noLabel:!0,noIcon:!0,facebook:!0,google:!0,embed:!1,twitter:$('meta[property="og:title"]').attr("content")||!0});var t=l.closest(".nativeScroll");t.length&&t.animate({scrollTop:t.prop("scrollHeight")+"px"})}function n(e){a&&config.level().isPremium&&l.find(".analyze").replaceWith(s.render("extensions.analysisLink",i(e)))}function i(e){var t=e.publisher.getMeta();return{knotId:e.publisher.getCurrentPosition().knotId,isPremium:config.level().isPremium,GameUUID:t.GameUUID,showNewGame:!t.TournamentUUID}}var r,o=this,a=!0;Extend.Suspendable(o),t.delegate=o.delegate(t),n.delegate=o.delegate(n),Extend.Subscriber(o,{movedPositionPointer:n.delegate,currentGameChanged:t.delegate,gameStatusChanged:t.delegate},{afterLink:function(e){r=e.publisher,t(e)}}),o.onResume(function(e){e&&r&&t({publisher:r})});var s=new Handler.Template("notationTable"),l=$("<div/>");return o.getContent=function(){return l},o}),View.NotationArea.registerExtension("Comment","bottom",function(e){function t(){n(void 0,l.getCurrentPosition())}function n(e,t){o(t.getGlyphes()),a(t.comment)}function i(e,t){a(t.value)}function r(e,t){o(t.value)}function o(e){y.removeClass("active"),e.forEach(function(e){y.filter(".glyphId-"+e).addClass("active")})}function a(e){b.editor("setValue",e&&Handler.Template.escape(e)||"",!0)}function s(){l&&d&&l.setComment(b.editor("text").trim())}var l,c=this,d=!0;Extend.Suspendable(c),Extend.Subscriber(c,{"movedPositionPointer.current":c.delegate(n),currentGameChanged:c.delegate(t),"position.comment.current":c.delegate(i),"position.glyph.current":c.delegate(r)},{afterLink:function(e){l=e.publisher,t(e)},afterUnlink:function(e){l=void 0}}),c.onResume(function(e){e&&l&&t()});var u=new Handler.Template("notationTable"),h=Chess.Glyphes.getByCategory(),f=$(u.render("extensions.comment",{glyphes:h,glyphCategories:Object.keys(h),getUUID:function(){return(new Helper.UUID).getShort()},getGlyphCategory:function(){return Object.reduce(h[this],function(e,t,n){return e.push({value:t,key:n}),e},[])}}));c.getContent=function(){return f},c.setUserCommentWritePermission=function(e){return d=e,g.toggleClass("disabled",!e),p.toggleClass("inactive",!e),b.toggle(e),c};var p=f.find(".inputContainer"),m=p.find(".editor"),g=f.find(".addComment"),v=p.find(".customTabs"),y=p.find(".glyphItem"),b=m.editor({language:config.language(),height:22,maxLength:e.maxLength||5e4,hideToolbar:!0,toolbar:{left:[],right:[]},watermark:p.attr("placeholder"),removeLineBreaks:!0});return g.on("click",function(){return s(),!1}),b.on("keypress",function(e){13===e.which&&(s(),e.preventDefault())}),v.on("chess24:hide chess24:show",function(e){e.stopPropagation()}),y.on("click.glyphToggle",function(){if(l&&d){var e=parseInt(jQuery(this).data("glyphId"),10),t=l.hasGlyph(e);if(t)return void l.removeGlyph(e);var n=l.getGlyphes(),i=Chess.Glyphes.getByCategory(),r=Object.findKey(i,function(t){return t[e]});if(!r||!Chess.Glyphes.isSinleItemCategory(r))return void l.addGlyph(e);var o=i[r],a=n.filter(function(e){return!o[e]});a.push(e),l.setGlyphes(a)}}),c}),View.NotationArea.registerExtension("GameEnd","after",function(e){function t(){o.html(r.render("extensions.result",{withScore:e.score,gameEndDescription:e.description&&n&&n.getGameEndDescription(),result:Object.map(n.getGameStatus().result,function(e){return"1/2"===e?"½":e})}))}var n,i=this;e=Object.extend({score:!0,description:!0},e||{}),Extend.Suspendable(i),t.delegate=i.delegate(t),Extend.Subscriber(i,{currentGameChanged:t.delegate,gameStatusChanged:t.delegate},{afterLink:function(e){n=e.publisher,t()},afterUnlink:function(e){n=void 0}}),i.onResume(function(e){e&&n&&t(void 0,n)});var r=new Handler.Template("notationTable"),o=$("<div/>");return i.getContent=function(){return o},i}),View.NotationArea.registerExtension("Moves","main",function(e){function t(e){switch(e){case"all":return{w:!1,b:!1};case"black":return{w:!0,b:!1};case"white":return{w:!1,b:!0}}return{w:!0,b:!0}}function n(){return e.engine&&window.settings.getBoolean("game-broadcast-engine")}function i(e,t){var n=t.parentMove;if(n){if(n&&n.parentMove&&!n.comment&&t.lastMoveWasBlack()&&n.parentMove.countChildrenMoves()<2&&!n.getChat().length){var i=g(n.knotId),r=$(K.render(J,A(t)));return _(r),void y(v(i).removeClass(q)).replaceWith(r)}n&&!n.parentMove&&n.comment&&v(g(n.knotId)).remove();var o=$(K.render(X,u(t.lastMoveWasWhite()&&t,t.lastMoveWasBlack()&&t,n.isRootPosition()&&n)));S(o),P(o),I(o),me.append(o),t.comment&&p(t)}}function r(e,t){if(t.parentMove.isInMainline()){if(k(t).length)return;var n=G(t,t.getPositionInChildrenArray());n.color=Chess.colors.invert(Chess.colors.letter2full(t.moveRight));var i=$(K.render(Y,n));I(i),S(i);var r=t.parentMove.getChildrenMoveById(0),o=v(g(r.knotId));return t.lastMoveWasWhite()&&!t.parentMove.isEndOfLine()&&c(o,t.moveCounter),void o.append(i)}if(t.getPositionInChildrenArray()){if(t.lastMoveWasWhite())var a=t.moveCounter+". ";else a=t.moveCounter-1+"... ";var d=K.render(Z,{elements:[L(" "+ae),L(a),N(t),L(se)]});if(2===t.parentMove.countChildrenMoves()){var u=g(t.parentMove.getChildrenMoveById(0).knotId);u.after(d),S(u.parent())}return void l(s(t))}if(1===t.parentMove.parentMove.countChildrenMoves()||t.parentMove.getPositionInChildrenArray()||t.parentMove.parentMove.isInMainline()){var d=K.render(Z,{elements:[L(t.lastMoveWasWhite()?" "+t.moveCounter+". ":" "),N(t)]}),h=b(t.parentMove),f=h.length&&h||g(t.parentMove.knotId);return f.after(d),void _(f.nextAll(".moveBlock"))}l(s(t))}function o(e,t){var n=s(t);return t===n?(k(t).remove(),void d(t.parentMove.getChildrenMoveById(0))):void l(n)}function a(e,t){var n=t.getDistanceToMainline();return n>1?void l(s(t)):void j()}function s(e){for(;!e.parentMove.isInMainline();)e=e.parentMove;return e}function l(e){var t=G(e,e.getPositionInChildrenArray()),n=k(e);n.children("span").html(K.render(Z,t)),S(n)}function c(e,t){if(!e.hasClass(q)){var n=$(K.render(X,{moveNumber:t,moves:[void 0,void 0]})),i=y(e),r=i.parent();y(n).replaceWith(i),r.html(K.render(ee)),n.append(e.find(".notationTableInlineElement.black")),e.after(n),e.addClass(q)}}function d(e){if(!(!e||e.comment||e.parentMove&&e.parentMove.countChildrenMoves()>1||e.lastMoveWasBlack()||e.isEndOfLine()||e.getChat().length)){var t=e.knotId,n=e.getChildrenMoveById(0).knotId,i=v(g(t)),r=g(n),o=v(r),a=y(i);a.replaceWith(r),o.find(".notationTableInlineElement").appendTo(i),o.remove(),i.removeClass(q)}}function u(e,t,n){return{moveNumber:e&&e.moveCounter||t&&t.moveCounter-1||n.moveCounter,startPosition:n,moves:[e&&A(e),t&&A(t)]}}function h(e,t){clearTimeout(h.aggregated),h.aggregated=setTimeout(function(){x(t)})}function f(t,n){switch(n.key){case"comment":return p(n.position);case"chat":return m(n.position,n.value)}if(n&&n.position&&(e.time||"timeUsage"!==n.key)){var i=g(n.position.knotId);if(i.length&&!n.position.isRootPosition())return n.position.isInMainline()?void i.html(K.render(te,A(n.position))):void i.html(N(n.position).moveText)}}function p(e){var t=b(e);if(!e.isInMainline()){var n=$(K.render(ne,N(e)));if(t.length)return void t.replaceWith(n);var i=g(e.knotId);return void i.after(n)}if(!e.comment)return d(e),e.isRootPosition()&&!e.countChildrenMoves()&&v(g(e.knotId)).remove(),void t.remove();if(t.length)return void t.find("span").html(Handler.Template.escape(e.comment));n=$(K.render(ie,A(e))),P(n);var r=v(g(e.knotId));if(e.lastMoveWasWhite()&&!e.isEndOfLine()&&c(r,e.moveCounter),e.isRootPosition()){if(r.length)return void r.prepend(n);var o=$(K.render(X,u(void 0,void 0,e)));return S(o),P(o),void me.append(o)}r.children("dl").after(n)}function m(e,t){if(ge){var n=w(e);if(n.length)return i=$(K.render(oe,D(t))),M(i),n.append(i),void C(e);var i=$(K.render(re,A(e)));M(i);var r=v(g(e.knotId));if(e.lastMoveWasWhite()&&!e.isEndOfLine()&&c(r,e.moveCounter),e.isRootPosition()){if(r.length)return void r.prepend(i);var o=$(K.render(X,u(void 0,void 0,e)));return S(o),void me.append(o)}r.children("dl").after(i),C(e)}}function g(e,t){return pe[e]||(pe[e]=(t||me).find(".notation-"+e))}function v(e){return e.closest("li")}function y(e){return e.find("dd:nth-of-type(2) > span")}function b(e){return me.find(".comment-"+e.knotId)}function w(e){return me.find(".chat-"+e.knotId)}function k(e){return me.find(".sideline-"+e.knotId)}function x(e){var t=g(e.knotId);ce!==t&&t.length&&(ce&&ce.removeClass(W),ce=t.addClass(W),C(e))}function C(e){var t=w(e);if(!de){var n=g(e.knotId),i=n.parent().height();i>0&&(de=3*i)}if(de){if(t.length)var r=t.position().top+t.children().last().position().top-de;else{n=n||g(e.knotId),r=n.position().top-de;var o=n.parent().parent();o.hasClass("notationTableInlineElement")&&(r+=o.position().top)}ue.stop(!0).animate({scrollTop:r+"px"})}}function j(){if(le){R(),ce=null,pe={};for(var e,t,n=[],i=le.getStartPosition(),r=i;r=r.getChildrenMoveById(0);)r.lastMoveWasWhite()?e=r:t=r,(t||e.comment||e.isEndOfLine()||e.parentMove&&e.parentMove.countChildrenMoves()>1||ge&&e.getChat().length)&&(n.push(u(e,t,i)),e=!1,t=!1,i=!1);i&&i.comment&&n.push(u(e,t,i)),me.html(K.render("extensions.moves",n)),T(),S(),P(),Q(),I(),x(le.getCurrentPosition())}}function T(){me.toggleClass("noPermissionDeleteSideline",!le.getDeleteMode(void 0,!1))}function _(e){return e.length?(e.each(function(e,t){t=$(t),pe[t.data("knotId")]=t}),e.off("click.moveBlock",B).on("click.moveBlock",B)):void 0}function S(e){return _((e||me).find(".moveBlock"))}function I(e){return(e||me).find(".deleteSideline").off("click.deleteSideline",B).one("click.deleteSideline",E)}function P(e){return(e||me).find(".deleteComment").off("click.deleteComment",O).one("click.deleteComment",O)}function M(e){e.expandEmoticons().expandLinks()}function Q(e){M((e||me).find(".chatLine"))}function B(){return le.gotoId(jQuery(this).data("knotId")),!1}function E(){return le.deleteMove(jQuery(this).data("knotId")),!1}function O(){return le.setComment(void 0,jQuery(this).data("knotId")),!1}function A(t){if(n()){var i=t.getEngine("numerical",!0,!1);V(t.getEngineFen())}var r=ge&&t.getChat();return{additionalMoveInformation:e.time||e.engine,knotId:t.knotId,chat:r&&r.length&&D(r),showTimeUsage:e.time,showEngine:e.engine,timeUsage:e.time&&!t.isNullMove()&&t.isAtLeastAwayFromRoot(le.getClockStartMove())&&Helper.formatTimeUsage(t.timeUsage,e.ms)||"",moveText:he[t.moveRight]?t.getMove("san",!0):"...",comment:t.comment,engineFen:t.getEngineFen(),color:t.isRootPosition()?"start":Chess.colors.invert(Chess.colors.letter2full(t.moveRight)),engine:i&&Handler.engine.formatEngine(i.score,i.mate),sideline:t&&t.parentMove&&H(t.parentMove)}}function D(e){if(!Array.isArray(e))return D([e])[0];var t=le.getMeta(),n=Chess.colors.both.metaData.reduce(function(e,n){return t[n].UUID&&(e[t[n].UUID]=n.toLowerCase()),e},{});return e.map(function(e){return{message:e.message,color:n[e.id]}})}function H(e){for(var t=[],n=e.countChildrenMoves(),i=1;n>i;i++)t.push(G(e.childrenMoves[i],i));return t}function N(e){return{knotId:e.knotId,moveText:e.getMove("san",!0),comment:e.comment||!1,plainText:!1}}function L(e){return{plainText:e,moveText:!1}}function G(e,t){function n(e){var t=[],r=e.countChildrenMoves();if(!r)return t;var o="",a="";if(e.lastMoveWasBlack()?(o=e.moveCounter+". ",t.push(" "+o)):(a=e.moveCounter+"... ",i&&t.push(a)),t.push(" ",N(e.getChildrenMoveById(0))," "),i=!1,r>1)for(var s=1;r>s;s++){t.push(" "+ae+a+o,N(e.getChildrenMoveById(s)),n(e.getChildrenMoveById(s)));var l=t.last();" "===l.last()&&l.pop(),t.push(se+" "),i=!0}t=t.concat(n(e.getChildrenMoveById(0)));for(var s=0;s<t.length;s++)Array.isArray(t[s])&&t.splice.apply(t,[s,1].concat(t[s]));return t}var i=!1,r=n(e);if(e.lastMoveWasWhite())var o=e.moveCounter+". ";else o=e.moveCounter-1+"... ";r.unshift(U[--t%U.length]+") "+o,N(e)," ");for(var a=[],s="",l=r.length-1;l>=0;l--)""!==r[l]&&("string"!=typeof r[l]?(s&&(a.unshift(L(s)),s=""),a.unshift(r[l])):s=r[l]+s);return s&&a.unshift(L(s)),{knotId:e.knotId,elements:a}}function R(){Object.isEmpty(fe)||(Handler.engine.off(Object.keys(fe).map(function(e){return e+":numerical"}).join(" "),F),fe={})}function V(e){fe[e]||(Handler.engine.on(e+":numerical",F),fe[e]=!0)}function F(e,t){if(window.settings.getBoolean("game-broadcast-engine")){var n=e.channel.split(":")[0],i=me.find(".fen-"+n.replace(/\//g,"\\/"));if(i.length){if(le){var r=le.getPositionByKnotId(i.parent().data("knot-id"));r.lastMoveWasWhite()&&Handler.engine.shouldInvert(r,t)&&(t=Handler.engine.invert(t))}i.html(Handler.engine.formatEngine(t.score,t.mate))}}}var z=this,U="abcdefghijklmnopqrstuvwxyz",W="highlighted jump-to-link",q="incomplete",K=new Handler.Template("notationTable"),J="extensions.move",X="extensions.moveLine",Y="extensions.sideLine",Z="extensions.sideLineElements",ee="extensions.noMove",te="extensions.moveProperties",ne="extensions.sideLineComment",ie="extensions.commentBlock",re="extensions.chatBlock",oe="extensions.chatMessage",ae="(",se=")";e=Object.extend({time:!0,ms:!0,engine:!0},e||{});var le,ce,de,ue,he=t(e.blindfold),fe={},pe={},me=$(K.render("extensions.movesContainer"));Extend.Suspendable(z).onResume(function(e){e&&le&&j()}),j.delegate=z.delegate(j),Extend.Subscriber(z,{currentGameChanged:j.delegate,"movedPositionPointer.start":j.delegate,"move.mainline.add":z.delegate(i),"move.sideline.add":z.delegate(r),"move.mainline.delete":j.delegate,"move.sideline.delete":z.delegate(o),"move.promote":z.delegate(a),position:z.delegate(f),"movedPositionPointer.current":z.delegate(h),"permission.delete":z.delegate(T)},{afterLink:function(e){le=e.publisher,ue=me.closest(".nativeScroll"),j()},afterUnlink:function(){le=void 0}});var ge=window.settings.getBoolean("game-chat");return window.settings.on("settings.game-chat",function(e,t){ge=!!t.value,j()}),window.settings.on("settings.game-broadcast-engine",j),z.getContent=function(){return me},z.setBlindfold=function(e){return he=t(e),j(),z},z.setUserCommentWritePermission=function(e){return me.toggleClass("readonlyUserComments",!e),z},z}),View.NotationArea.registerExtension("PlayZoneChat","bottom",function(e){function t(e){m.addClass("inactive"),p.addClass("disabled"),k.hide(),y.hide(),v.text(e||"").show(),e&&f.hide(),l=!1}function n(){l||(m.removeClass("inactive"),k.show(),y.show(),v.hide(),f.show(),p.removeClass("disabled"),k.focus(),l=!0)}function i(){var e=s.getMeta();return window.settings.getBoolean("game-chat")&&e.GameUUID?config.level().isGuest?void t(w):e.White.Guest||e.Black.Guest?void t(b):void n():void t()}function r(){var e,t=s.getMeta(),n=config.user().uuid;return Chess.colors.both.metaData.some(function(i){return t[i].UUID&&t[i].UUID!==n?e=t[i].UUID:void 0}),e}function o(){if(l&&!jQuery(this).hasClass("disabled")){var e=k.editor("text").trim();a(e),k.editor("reset"),k.focus()}}function a(e){var t=r(),n=s.getMeta();if(t&&n.GameUUID){var i={gameUuid:n.GameUUID,moveId:s.getEndOfMainlinePosition().knotId};conversationHandler.sendPrivateMessageInGame(t,i,e)}}var s,l,c=this;Extend.Suspendable(c),Extend.Subscriber(c,{currentGameChanged:c.delegate(i)},{afterLink:function(e){s=e.publisher,i()},afterUnlink:function(e){s=void 0}}),c.onResume(function(e){e&&s&&i(void 0,s)}),window.settings.on("settings.game-chat",i);var d=new Handler.Template("notationTable"),u=$(d.render("extensions.playZoneChat")),h=u.find(".chatElements"),f=u.find(".notationTableChatSettings"),p=h.find("a.sendChat"),m=h.find(".inputContainer"),g=h.find(".editor.chat"),v=h.find(".editorOverlay"),y=h.find(".chatToolbar"),b=v.attr("playzoneopponentisguesttemplate"),w=v.attr("playzoneyouareguesttemplate"),k=g.editor({language:config.language(),height:22,maxLength:250,hideToolbar:!0,extensions:["emoticons"],toolbar:{left:[],right:[]},extensionConfig:{emoticons:{dialogContainer:m.find(".btnChatExtension .cTooltipBoxContainer")}},watermark:m.attr("placeholder"),dialogConfig:{emoticons:{showAsPopup:!0}},removeLineBreaks:!0});return p.on("click",function(){return o(),!1}),k.on("keypress",function(e){13===e.which&&(o(),e.preventDefault())}).on("keyup change",function(e){k.editor("isEmpty")?(p.addClass("disabled"),p.attr("disabled","disabled")):(p.removeClass("disabled"),p.removeAttr("disabled"))}),window.settings.attach(f),c.getContent=function(){return u},c}),View.NotationArea.registerExtension("PlayingVsGuest","before",function(e){function t(){if(!i||config.level().isGuest)return void l.empty();var e=i.getMeta();return!e.White||!e.Black||e.White.UUID!==o&&e.Black.UUID!==o||!e.White.Guest&&!e.Black.Guest||settings.getBoolean("pair-registered-only")?void l.empty():void l.html(s.render(a+config.level().toString())).find("a.settings").on("click.settings",n)}function n(){(new Dialog.PlayzoneSettings).getContent().modal("show")}var i,r=this,o=config.user().uuid,a="extensions.playingVsGuest.";Extend.Suspendable(r),t.delegate=r.delegate(t),Extend.Subscriber(r,{currentGameChanged:t.delegate},{afterLink:function(e){i=e.publisher,t()},afterUnlink:function(e){i=void 0}}),r.onResume(function(e){e&&i&&t(void 0,i)});var s=new Handler.Template("notationTable"),l=$(s.render(a+"main"));return r.getContent=function(){return l},r}),"undefined"==typeof View&&(View={}),
View.OutcomePrediction=function(e){function t(){e.slideDown()}function n(){e.slideUp()}function i(t,n){var i=Object.merge(n.getMeta(),f);r(i,"White"),r(i,"Black"),e.html(m.render("predictedOutcome.main",i)),layout.userMiniprofile(e),p=jQuery(".predictionScale > span",e),o(t,n.getCurrentPosition(),!0)}function r(e,t){e[t]&&e[t].Picture&&"/"===e[t].Picture.substr(0,1)&&"//"!==e[t].Picture.substr(0,2)&&(e[t].Picture=config.assetDir()+e[t].Picture)}function o(e,t,n){clearTimeout(y),y=setTimeout(function(){a(e,t,n)})}function a(e,t,n){for(d&&Handler.engine.off(d+":numerical",s);t&&t.isNullMove();)t=t.parentMove;d=t.getEngineFen(),u=t,Handler.engine.on(d+":numerical",s),s(e,Handler.engine.get(t,"numerical",!0,!0),n)}function s(e,t,n){return Handler.engine.shouldInvert(u,t)&&(t=Handler.engine.invert(t)),l(t)}function l(t){var n=Controller.Broadcast.getOutcomePrediction(t);n.forEach(function(e,t){var n=e+"%";jQuery(p[t]).css("width",e+"%").attr("data-prediction",n)}),f={percentWhite:n[0],percentDraw:n[1],percentBlack:n[2]},e.find(".cTooltipBoxContainer").replaceWith(m.render("predictedOutcome.tooltip",Object.extend({eval:Handler.engine.formatEngine(t.score,t.mate),phrase:Controller.Broadcast.getPhraseForEvaluation(t.score,t.mate)},f)))}function c(){var t=jQuery(".predictionScale > span",e);t.parent().append(t[0]),t.parent().prepend(t[2]);var n=jQuery(".player.fLt",e),i=jQuery(".player.fRt",e);n.removeClass("fLt").addClass("fRt"),i.removeClass("fRt").addClass("fLt")}var d,u,h,f,p,m=new Handler.Template("broadcast"),g=window.settings.getBoolean("game-broadcast-engine");e=jQuery(e),e.length||errorHandler.error(new Error("container not found in View.OutcomePrediction"),{container:e});var v=Extend.Suspendable(this);Extend.Subscriber(v,{currentGameChanged:v.delegate(i),"movedPositionPointer.current":v.delegate(o),flipBoard:c},{afterLink:function(e){h=e.publisher,g?t():n(),i(e,e.publisher)}}),v.onResume(function(e){e&&h&&(g?t():n(),i({publisher:h},h))}),window.settings.on("settings.game-broadcast-engine.on",t),window.settings.on("settings.game-broadcast-engine.off",n);var y;return v},"undefined"==typeof View&&(View={}),View.PlayButton=function(e,n){function i(n,i){function r(){function t(e){if(clearTimeout(o),void 0===e&&(e=i.content.tournamentStartsAt-Controller.Broadcast.offsetCorrectedDateNow()),!(0>=e)){var a=Date.getSplitedTime(e);n.html(""+a.minutes),r.html((""+a.seconds).lpad("0",2)),o=setTimeout(function(){t(e-1e3)},1e3-Controller.Broadcast.offsetCorrectedDateNow()%1e3)}}if(e.removeClass(),i.content.gameSessionToken?l?v():g():h(),!jQuery(".tournament.tournamentId"+i.content.tournamentUuid).length){f.css("cursor","pointer"),void 0!==d&&d.remove(),d=jQuery(s.render("tooltipTournamentSoon",{tournamentName:i.content.tournamentName,tournamentUrl:i.content.tournamentUrl})),e.append(d).addClass("navTournamentSoon cTooltipBox position-bottom-fixed");var n=d.find("span.minutes"),r=d.find("span.seconds"),o=setTimeout(t,1e3-Controller.Broadcast.offsetCorrectedDateNow()%1e3);i.content.tournamentStartsAt=i.content.tournamentStartsAt||Controller.Broadcast.offsetCorrectedDateNow()}}function o(e){}function a(e){new Dialog.PlayzoneTournamentGame(e.tournamentUuid,e.gameUrl)}function u(n){e.removeClass().addClass("navPlayOn cTooltipBox position-bottom-fixed"),f.css("cursor","pointer"),f.off("click.playNow").on("click.playNow",function(){var e=new Controller.Broadcast;e.showGame(n.tournamentId,n.roundId,n.matchId,n.gameId)}),f.html(t("Back to the game"))}function h(){var n=e.is(".cTooltipBox");e.removeClass().addClass("navPlayNow"),n&&e.addClass("cTooltipBox position-bottom-fixed"),f.css("cursor","pointer"),f.html(t("Play Now")),f.off("click.playNow").on("click.playNow",m)}function m(){Controller.getPlayZone().playNow.apply(void 0,arguments)}function g(){e.removeClass().addClass("navPlayOn cTooltipBox position-bottom-fixed"),f.css("cursor","pointer"),f.off("click.playNow").on("click.playNow",m),f.html(t("Back to the game"))}function v(){e.removeClass().addClass("navPlaying"),f.css("cursor","default"),f.off("click.playNow"),f.html(t("Currently playing..."))}function y(n){return 1==n.immediate?void(l?v():g()):(f.data("challenge",n.challenge),e.removeClass().addClass("navChallengeAccepted cTooltipBox position-bottom-fixed"),f.css("cursor","pointer"),f.html(t("Start the challenge")),void f.off("click.playNow").on("click.playNow",function(){jQuery.post("/api/web/challengeAPI/gameResolve",jQuery.extend({challenge:n.challenge},p)).done(Controller.getPlayZone().playNow)}))}switch(c=i.mode,i.mode){case"tournamentSoon":r();break;case"tournamentStart":o(i.content);break;case"tournamentRoundStart":a(i.content);break;case"touramentPlaying":u(i.content);break;case"playNow":h();break;case"playOn":g();break;case"playing":v();break;case"challengeAccepted":y(i.content)}}function r(n,i){function r(e){e=Math.round(e/1e3),u.html(Handler.Template.renderString(d,{ttl:e}))}if(void 0!==i.content.expireAt){var a=i.content.expireAt,s=Date.now(),l=n.publisher.getTimeOffset(),c=a-s-l;if(i.content.win)var d=t('You will loose your game in <span class="dsDigitalFont">{{ttl}}</span> seconds');else d=t('Your game will be aborted in <span class="dsDigitalFont">{{ttl}}</span> seconds');var f=Math.ceil(c/1e3);u=jQuery("<div/>").addClass("cTooltipBoxContainer").html(Handler.Template.renderString(d,{ttl:f})),e.append(u),h=new Helper.timer.Countdown(c,1e3,r,o)}}function o(){h&&h.stop(),u&&u.remove()}if(View.PlayButton.instance instanceof View.PlayButton)return View.PlayButton.instance;var a=this,s=new Handler.Template("playButton"),l=!1,c="playNow";e=jQuery(e);var d,u,h,f=e.find("a.playNowLink");(0===e.length||0===f.length)&&errorHandler.msg("error",new Error("View.PlayButton: container not found"),!0,{container:e});var p={csrf:config.csrf()};return Extend.Subscriber(a,{game_challenge:function(e,t){t.content&&"accept"===t.content.action&&(t.mode="challengeAccepted",i(e,t))},playerDisconnected:function(e,t){"playOn"===c&&r(e,t)},playerConnected:function(e,t){l?t.mode="playing":t.mode="playOn",i(e,t),o()},"channel:gameSession:add:self":function(e,t){l?t.mode="playing":t.mode="playOn",i(e,t)},"channel:gameSession:remove:self":function(e,t){t.mode="playNow",i(e,t)},playzone_tournament:function(e,t){t.content&&(t.mode="start"==t.content.action&&"tournamentStart"||"soon"==t.content.action&&"tournamentSoon"||"round"==t.content.action&&"tournamentRoundStart"||"playing"==t.content.action&&"touramentPlaying",i(e,t))}},{afterLink:i(void 0,n)}),a.isPlaying=function(e){void 0===e&&(e=!0),l=e,l&&i(void 0,{mode:"playing"})},a.isLoading=function(t){t?e.addClass("loading"):setTimeout(function(){e.removeClass("loading")},300)},View.PlayButton.instance=a,a},View.PlayButton.isPlaying=function(e){View.PlayButton.instance instanceof View.PlayButton&&View.PlayButton.instance.isPlaying(e)},View.PlayButton.isLoading=function(e){View.PlayButton.instance instanceof View.PlayButton&&View.PlayButton.instance.isLoading(e)},"undefined"==typeof View&&(View={}),View.PlayShortcuts=function(e,t){function n(){t?i():r()}function i(){e.removeClass("inactive"),e.find("a").off("click.play").on("click.play",o)}function r(){e.addClass("inactive"),e.find("a").off("click.play")}function o(){var e=jQuery(this),t=JSON.parse(e.attr("settings"));Dialog.playZone.playNow({settings:t}).show().start()}var a=this;e=jQuery(e),Extend.Subscriber(a,{"channel:gameSession:add:self":r,"channel:gameSession:remove:self":i},{afterLink:n})},"undefined"==typeof View&&(View={}),View.PlayerCountry=function(e,t,n){function i(e){var t=e.publisher.getMeta();t&&o(e,{meta:t})}function r(e){"b"===t?t="w":"w"===t&&(t="b"),o(e,{meta:e.publisher.getMeta()})}function o(e,n){var i=n.meta[d[t]].Country;return i?void a(i,window.t.country(i)):a()}function a(t,n){if(t!==l){if(l&&u.removeClass("flag-"+l),l=t,!t)return void e.remove();e.attr("data-tooltip",n),u.addClass("flag-"+t),e.show()}}n=n||"Bottom";var s,l,c=this,d={w:"White",b:"Black"};e=jQuery(e),e.addClass("cTooltip"+n);var u=e.children("span").addClass("icoFlag");return 0===e.length&&errorHandler.msg("error",new Error("container not found"),!0,{container:e}),Extend.Suspendable(c),Extend.Subscriber(c,{meta:c.delegate(o),currentGameChanged:c.delegate(i),flipBoard:c.delegate(r)},{afterLink:function(e){s=e.publisher,i(e)}}),c.onResume(function(e){e&&s&&i({publisher:s})}),c},"undefined"==typeof View&&(View={}),View.PlayerInfo=function(e,t,n,i){function r(){return s.hasClass("white")?s.removeClass("white").addClass("black"):s.hasClass("black")&&s.removeClass("black").addClass("white"),o}var o=this,a=new Handler.Template("playZone"),s=jQuery(e);s.addClass("b"===t?"black":"white");var l=[];0===s.length&&errorHandler.msg("error",new Error("container not found"),!0,{container:s}),s.html(a.render("playerInfo"));var c=s.find(".player .name"),d=s.find(".player .level .attributeTitle"),u=s.find(".player .level .attributePremium"),h=s.find(".player .level .attributeStaff"),f=s.find(".player .level .attributeModerator"),p=s.find(".player .level .attributeFraud"),m=s.find(".player .level .attributeCop"),g=s.find(".player .level .elo"),v=s.find(".player .level .eloChange"),y=s.find(".player .country"),b=s.find(".player .pic"),w=s.find(".score"),k=s.find(".thinking");return l.push(new View.PlayerName(c,t,n,i)),l.push(new View.Meta(d.find("span"),t,"title",!0,!0).setCustomUpdate(function(e,t){e.attr("data-tlabel",t||""),d.toggle(!!t)})),l.push(new View.Meta(d,t,"titleName",!1,!0).setCustomUpdate(function(e,t){t?e.attr("data-tooltip",t).addClass("cTooltip"):e.removeAttr("data-tooltip").removeClass("cTooltip")})),u.length&&l.push(new View.Meta(u,t,"premium",!0,!0)),h.length&&l.push(new View.Meta(h,t,"staff",!0,!0)),f.length&&l.push(new View.Meta(f,t,"moderator",!0,!0)),p.length&&l.push(new View.Meta(p,t,"fraud",!0,!0)),m.length&&l.push(new View.Meta(m,t,"cop",!0,!0)),l.push(new View.Meta(g,t,"elo")),l.push(new View.EloChange(v,t)),l.push(new View.PlayerCountry(y,t,"Right")),l.push(new View.PlayerPicture(b,t)),l.push(new View.Score(w,t)),l.push(new View.PlayerThinking(k,s,t)),Extend.Subscriber(o,{flipBoard:r},{afterLink:function(e){for(var t=0;t<l.length;t++)l[t].link(e.publisher)},afterUnlink:function(e){for(var t=0;t<l.length;t++)l[t].unlink(e.publisher)}}),Extend.Suspendable(o),o.onSuspend(function(){for(var e=0;e<l.length;e++)l[e].suspend()}),o.onResume(function(){for(var e=0;e<l.length;e++)l[e].resume()}),o},"undefined"==typeof View&&(View={}),View.PlayerName=function(e,t,n,i){function r(e){"b"===t?t="w":"w"===t&&(t="b"),c(e)}function o(e){var t=e.publisher.getMeta();t&&a(e,{meta:t})}function a(r,o){var a="w"===t?"White":"Black";o=o.meta[a];var s=o.Link,l=o.Name,c=o.UUID;if(l&&n&&(l=n(l)),e.tooltip("reset").removeClass("ofMiniProfile position-left position-right position-top position-bottom"),void 0!==s&&""!==s.trim()){var d=jQuery("<a />").attr("href",s.replace("/en/profile/","/"+config.language()+"/profile/")),u=d.append(l);c&&e.addClass("ofMiniProfile position-horizontal").data("uuid",c)}else u=l;e.empty().append(u),s&&c?e.addMiniprofile(!0):i&&o.FideId&&e.addPlayerTournamentStatistics(i,o.FideId)}var s=this;e=jQuery(e),0===e.length&&errorHandler.error(new Error("container not found"));var l;Extend.Suspendable(s);var c=s.delegate(o);return Extend.Subscriber(s,{meta:s.delegate(a),currentGameChanged:c,flipBoard:r},{afterLink:function(e){l=e.publisher,o(e)}}),s.onResume(function(e){e&&l&&o({publisher:l})}),s},"undefined"==typeof View&&(View={}),View.PlayerPicture=function(e,t){function n(e){"b"===t?t="w":"w"===t&&(t="b"),i(e)}function i(e){var t=e.publisher.getMeta();return t&&r(e,{meta:t}),a}function r(n,i){var r=i.meta[l[t]].Picture;if(r&&("/"===r.substr(0,1)&&"//"!==r.substr(0,2)&&(r=config.assetDir()+r),r!==s)){if(!r)return void e.hide();c.attr("src",r),e.show()}}var o,a=this;e=jQuery(e);var s,l={w:"White",b:"Black"};0===e.length&&errorHandler.error(new Error("container not found"),{container:e});var c=e.children("img");c.length||(c=jQuery("<img />").appendTo(e)),Extend.Suspendable(a);var d=a.delegate(i);return Extend.Subscriber(a,{meta:a.delegate(r),currentGameChanged:d,flipBoard:a.delegate(n)},{afterLink:function(e){o=e.publisher,d(e)}}),a.onResume(function(e){e&&o&&i({publisher:o})}),a},"undefined"==typeof View&&(View={}),View.PlayerThinking=function(e,t,n){function i(e){n=Chess.colors.invert(n),u(e)}function r(e){s=e.publisher,o(e,e.publisher.getClockInformation())}function o(e,i){var r=void 0!==i.timeSpendInThisMove&&!e.publisher.isOver()&&n===e.publisher.getEndOfMainlinePosition(!0).moveRight;r&&d.html(a(i.timeSpendInThisMove)),t.toggleClass("active",r)}function a(e){0>e&&(e=0);var t=Date.getSplitedTime(e),n="";return n+=t.hours>0?t.hours+":"+t.minutes.toString().lpad("0",2)+":"+t.seconds.toString().lpad("0",2):t.minutes+":"+t.seconds.toString().lpad("0",2)}var s,l=this;e=jQuery(e),e.length&&t.length||errorHandler.error(new Error("container not found for View.PlayerThinking"));var c=jQuery((new Handler.Template).render("playerThinking")).appendTo(e),d=c.children("span");Extend.Suspendable(l);var u=l.delegate(r);return Extend.Subscriber(l,{clock:l.delegate(o),gameStatusChanged:u,currentGameChanged:u,flipBoard:l.delegate(i)},{afterLink:u}),l.onResume(function(e){e&&s&&r({publisher:s})}),l},"undefined"==typeof View&&(View={}),View.PlayingPageTitle=function(){function e(e){n=e;var a=e.publisher;return o.contains(r)&&!a.isOver()?a.getEndOfMainlinePosition().moveRight===r?Handler.pageTitle.setTextWithAnimation(t("Your move")):a.getEndOfMainlinePosition()===a.getStartPosition()?Handler.pageTitle.setTextWithAnimation(t("Game started")):Handler.pageTitle.setTextWithoutAnimation(t("Waiting for opponent")):Handler.pageTitle.reset(),i}var n,i=this,r="",o=["w","b"];return Extend.Subscriber(i,{"movedPositionPointer.endOfMainline":e,gameStatusChanged:e,currentGameChanged:e},{afterLink:e}),i.setUserRole=function(t){return r=t,n&&e(n),i},i},"undefined"==typeof View&&(View={}),View.PositionDetails=function(e,t,n){function i(e,t){switch(e.channel){case"movedPositionPointer.current.jump":a(e,t);break;case"movedPositionPointer.current.previous":o(e,t);break;case"movedPositionPointer.current.next":var n=e.publisher.getCurrentGameKey();!U||M[n]&&!F?o(e,t):r(e,t);break;case"movedPositionPointer.current.endOfLine":case"movedPositionPointer.current.start":r(e,t)}}function r(e,t){var n=e.publisher;x=n;var i=n.getCurrentGameKey(),r=(t||n.getCurrentPosition()).knotId,o=i+"_"+r;return!T.isEventBased()&&jQuery("a."+o).length>0&&T.switchEventBased(!N[i]),U&&l(e,t),S}function o(e,t){var n=e.publisher;x=n;var i=n.getCurrentGameKey(),r=(t||n.getCurrentPosition()).knotId,o=i+"_"+r;return!T.isEventBased()&&jQuery("a."+o).length>0&&T.switchEventBased(!1===N[i]),S}function a(e,t){var n=e.publisher;x=n,T.switchEventBased(!1===N[n.getCurrentGameKey()]),r(e,t)}function s(e,t){var i=e.publisher;x=i;i.getCurrentGameKey();if(i&&void 0!==i.getMeta()&&(pe.find("span").html(i.getTitle()),C.bubble("collapseTitle",i.getTitle()),!W)){for(var r=[],o=i.getMeta(),a=0;a<I.length;a++){var s=I[a].replace("."," "),l=o[I[a]];if(I[a].indexOf(".")>-1){var c=I[a].split(".");l=o;for(var d=0;d<c.length;d++)l=l[c[d]]}"White.Name"==I[a]&&o.White.Elo?l+=" ("+o.White.Elo+")":"Black.Name"==I[a]&&o.Black.Elo&&(l+=" ("+o.Black.Elo+")"),s&&l&&r.push(window.t(s)+": <strong>"+l+"</strong>")}r=r.length?r.join("<br/>"):window.t("Game information not available"),ee.html(r),n.url&&(Z.next(".pgn").length||Z.after(jQuery('<div class="pgn"/>').append(jQuery("<a/>").addClass("cBtnFlexi cBtnGrey").html(window.t("Download PGN")).on("click",function(){config.level().isPremium?(Handler.tracking("pgn","news"),window.location=n.url):(Handler.tracking("pgn","newsConversion"),Dialog.conversionGoPremium("pgnDownload"))}))))}}function l(e,t){var n=e.publisher;F=!1;var i=n.getCurrentGameKey(),r=t||n.getCurrentPosition(),o=r.knotId,a=!1,s=null;if(P[i])for(var l=0;l<P[i].length;l++)if(P[i][l].contains(o)){s=l,a=!0;break}if(M[i]||!a||Q[i]&&Q[i].contains(s)||!U){if(M[i]){var u=P[i][B][P[i][B].length-1];j.highlightHandler.unHighlightAll();var h,f=r.moveCoords,p=H.checkAnswer(f);p.correctAnswer?(d(!0),h=r.comment||window.t("Correct!"),_.addComment(i,o,h).setEnd(i,o).refresh(),o==u?(_.setEnd(i,o),M[i]=!1,v(i)):(G=!0,setTimeout(function(){return G=!1,R?void(R=!1):(n.gotoNextPosition(),void(n.getCurrentPosition().knotId==u?v(i):c(e)))},O))):(d(!1),ne.hide(),ie.hide(),oe.show(),h=r.comment||window.t("This is not the best move. Try again!"),_.setEnd(i,o).addComment(i,o,h).refresh())}}else M[i]=!0,m(i,s)}function c(e){var t=e.publisher,n=t.getCurrentGameKey();if(M[n])if(E=t.getCurrentPosition().childrenMoves[0],H=t.getQuestion(),E){var i=t.getCurrentPosition().knotId,r=t.getCurrentPosition().comment;_.setEnd(n,i).addComment(n,i,r).refresh(),F=!0}else v(n)}function d(e){le.removeClass("true false").addClass(e?"true":"false")}function u(){if(M[x.getCurrentGameKey()]&&!G){var e=E.moveCoords;j.highlightHandler.highlightCellTake(e.y1+""+e.x1,"red")}}function h(){if(M[x.getCurrentGameKey()]&&!G){var e=E.moveCoords;j.highlightHandler.unHighlightAll(),j.addArrow(e.x1,e.y1,e.x2,e.y2,!0).drawArrow()}}function f(){R=!0;var e=x.getCurrentGameKey();if(P[e]){var t=P[e][B];if(t){for(var n=function(e,t){if(e.knotId==t)return e;for(var i=0;i<e.childrenMoves.length;i++){var r=n(e.childrenMoves[i],t);if(r)return r}},i=n(x.getStartPosition(),t[0]);i&&t.contains(i.knotId);)i.comment&&_.addComment(e,i.knotId,i.comment),i=i.childrenMoves[0];if(t.length>1){var r=n(x.getStartPosition(),t[t.length-2]);r&&(H=r.getQuestion())}var o=t[t.length-1];x.gotoId(o),v(e)}}}function p(){R=!1,Q[x.getCurrentGameKey()].removeByValue(B),m(x.getCurrentGameKey(),B)}function m(e,t){if(x&&P[e]){var n=P[e][t];if(n){var i=x.getCurrentGameKey(),r=x.getCurrentPosition().knotId;(e!=i||n[0]!=r)&&x.setCurrentGame(e).gotoId(n[0]),L=_.getSettings("showSideline"),_.setSettings({showSideline:!0}).removeComment(e,n[0]).setStart(e,n[0]).setEnd(e,n[0]).refresh(),A&&A.html(window.t("You will be able to see the rest of the article as soon as the exercise is resolved.")),X.hide(),te.show(),se.show(),re.hide(),ae.hide(),oe.hide(),c({publisher:x}),clearTimeout(V),j.movementHandler.activate(),T.deactivate()}}}function g(e,t){F=!1,M[e]=!1,x&&P[e]&&(te.hide(),X.show(),_.setStart(e).setEnd(e).setSettings({showSideline:L}).refresh(),T.activate(),k())}function v(e){Q[e]?Q[e].push(B):Q[e]=[B],se.hide(),N[e]?(X.show(),T.activate()):ae.show(),clearTimeout(V),V=setTimeout(function(){j.movementHandler.activate(),j.movementHandler.deactivate()},1e3),re.show(),F=!1}function y(){var e=x.getCurrentGameKey();if(x&&M[e]){var t=x.getCurrentPosition().knotId;oe.hide(),ne.show(),ie.show(),x.gotoParentPosition(),_.removeComment(e,t).setEnd(e,x.getCurrentPosition().knotId).refresh(),F=!0}}function b(e){var t=jQuery(".exercise-"+B),n=P[e]&&P[e][B]?P[e][B][0]:null;if(null!==n){_.setEnd(e,n).addComment(e,n,"Start of exercise.").refresh(),t.hide().nextUntil(".widgetcontainer,p:has(.widgetcontainer)").hide().end();var i=t.filter("a").first().show(),r=i.closest("p").show(),o=r.clone(!0).insertBefore(r);D[e]=r.hide(),i=o.find(i.attr("class").replace(/(^| )/g,"."));for(var a=i.get(0);a.nextSibling;)a.parentNode.removeChild(a.nextSibling);var s=jQuery("<a/>").html("Start exercise").on("click",function(){m(e,B)}),l=jQuery("<a/>").html("Skip exercise").on("click",function(){f(),!1===N[e]&&g(e,B)});A=jQuery("<p/>").addClass("exercise-prompt").html("This is where the exercise starts. ").append(s).append(". ").append(l),r.after(A)}}function w(e,t){for(var n=0;n<t.length;n++)for(var i=null,r=0;r<t[n].length;r++){var o=jQuery("a.jump-to-link."+e+"_"+t[n][r]);!i&&o.length&&(i=o),o.addClass("exercise-"+n).closest("p").addClass("exercise-"+n)}}function k(){if(A){var e=x.getCurrentGameKey();D[e]&&(A.prev().show().prev().remove(),D[e]=null),A.remove()}jQuery(".exercise-"+B).show().nextAll().show(),B++,b(e)}var x,C,j,T,_,S=this,I=["Event","Site","Date","Round","White.Name","Black.Name","Result","ECO","Annotator","EventCountry","White.Team","Black.Team"],P={},M={},Q={},B=0,E="",O=1e3,A=null,D={},H=null,N={},L=!1,G=!1,R=!1,V=null,F=!1,z=!0,U=!!n.interactive,W=n.text,q=!!n.hideMeta,$=jQuery(e);0===$.length&&errorHandler.msg("error",new Error("container not found"),!0,{container:$}),Extend.Subscriber(S,{"movedPositionPointer.current":i,move:r,currentGameChanged:s,meta:s},{afterLink:function(e){j.link(e.publisher),T.link(e.publisher),_.link(e.publisher),r(e),s(e);var t=new View.AutoPlay(ce.find(".btnAutoPlay")).link(x);j.movementHandler&&t.link(j.movementHandler),U&&j.movementHandler.setPremove(!1)},afterUnlink:function(e){return x=null,j.unlink(e.publisher),T.unlink(e.publisher),_.unlink(e.publisher),S}}),S.setExercises=function(e,t,n){return P[e]=t,B=0,N[e]=n,U?(j.movementHandler.deactivate(),n?(T.switchEventBased(!1).setRange(e,t[0][0],t[0][t[0].length-1]),x&&x.setCurrentGame(e).gotoId(t[0][0]),M[e]=!0,m(e,0)):(w(e,t),b(e),x&&l({publisher:x}),T.switchEventBased(!0))):x&&l({publisher:x}),fe.find(".tabNav li").removeClass("current").last().addClass("current"),fe.find("#tab-meta").addClass("hide"),fe.find("#tab-notation").removeClass("hide"),S},S.setNoExercises=function(){U&&j.movementHandler.activate()},S.getBubble=function(){return C},S.toggleActive=function(e){T.takeOverEvents(e)},S.toggleTools=function(e){z="undefined"==typeof e?!z:e,K[z?"removeClass":"addClass"]("simple"),C.css("min-width","")};var K=jQuery("<div/>").addClass("chess-bubble").appendTo($),J=jQuery("<div/>").addClass("popup-board-board").appendTo(K),X=jQuery("<div/>").addClass("popup-board-cursor").appendTo(K),Y=jQuery("<div/>").addClass("popup-notation"),Z=jQuery("<div/>").addClass("popup-meta nativeScroll"),ee=jQuery("<div/>").addClass("nativeScrollInsider").appendTo(Z).html(W||""),te=jQuery("<div/>").addClass("exercise-buttons").appendTo(K),ne=(jQuery("<a/>").addClass("button-blue").html(window.t("Rotate")).appendTo(te).on("click",function(){j.flip()}),jQuery("<a/>").addClass("button-blue").html(window.t("Hint")).appendTo(te).on("click",u)),ie=jQuery("<a/>").addClass("button-blue").html(window.t("Show move")).appendTo(te).on("click",h),re=(jQuery("<a/>").addClass("button-blue").html(window.t("Solution")).appendTo(te).on("click",f),jQuery("<a/>").addClass("button-blue").html(window.t("Try again")).hide().appendTo(te).on("click",p)),oe=jQuery("<a/>").addClass("button-blue").html(window.t("Go back")).hide().appendTo(te).on("click",y),ae=jQuery("<a/>").addClass("button-blue").html(window.t("Continue")).hide().appendTo(te).on("click",function(){g(x.getCurrentGameKey(),B)}),se=te.find("a"),le=jQuery("<div/>").addClass("exercise-status").appendTo(K),ce=jQuery("<b/>").addClass("cTooltipBox position-top onClick burgerMenu").append('<a class="cBtnRound cIcon cIconBurger"></a>').append(jQuery('<span class="cTooltipBoxContainer"/>').append(jQuery("<ul/>").append(jQuery("<li/>").append(jQuery('<a class="flipBoard cIcon cIconFlipBoard" data-pattern-icon="true"><span>'+window.t("Flip board")+"</span></a>").on("click",function(){j.flip()}))).append(jQuery("<li/>").append(jQuery('<a class="playPosition cIcon cIconPosition" data-pattern-icon="true"><span>'+window.t("Play this position")+"</span></a>").on("click",function(){if(x){var e=x.getClockInformation(),t={clock:{white:e.runningUp?0:e.white.timeLeft,black:e.runningUp?0:e.black.timeLeft},increment:e.runningUp?0:e.white.incrementPerMove||e.black.incrementPerMove||0,fen:x.toString()};new Dialog.Engine(t)}}))).append(jQuery("<li/>").append(jQuery('<a class="settings cIcon cIconSettings" data-pattern-icon="true"><span>'+window.t("Settings")+"</span></a>").on("click",function(){(new Dialog.PlayzoneSettings).getContent().modal("show")}))).append(jQuery("<li/>").append(jQuery('<a class="btnAutoPlay cIcon cIconSoundPlay" data-pattern-icon="true"><span>'+window.t("Autoplay")+"</span></a>"))))).insertBefore(X),de=q;if(t){var ue=0;for(var he in t)if(t[he]instanceof Chess.Game&&(ue++,ue>1)){de=!0;break}}var fe=jQuery("<div/>").addClass("tabsWrap popup-tabs tabsStyleRounded").appendTo(K).append(q?"":jQuery('<ul class="tabNav"/>').append('<li class="tabIcon iconInfo'+(de?"":" current")+'"><a data-tab-content-id="tab-meta" id="meta">info</a></li>').append("<li"+(de?' class="current"':"")+'><a data-tab-content-id="tab-notation">'+window.t("moves")+"</a></li>")).append(jQuery('<div class="tabContentWrap">').append(q?"":jQuery('<div id="tab-meta">').append(jQuery('<div class="tabContentInsider">').append(Z)).addClass(de?"hide":"")).append(jQuery('<div id="tab-notation"'+(q?' class="fullheight"':"")+">").append(jQuery('<div class="tabContentInsider">').append(Y)).addClass(de?"":"hide"))).wrapTabs({speed:200}),pe=jQuery("<div/>").append("<span/>").addClass("popup-meta-title").appendTo(K);if(t instanceof Object){for(var me in t)N[me]=!0;var ge,ve=jQuery("<a/>").html(window.t("Select game")).on("click",function(){if(!ge){ge=jQuery("<ul/>").addClass("chess-bubble-choosegame");for(var e in t){x.hasGame(e)||x.addGame(e,t[e]);var n=jQuery("<a/>").html(t[e].getTitle()).on("click",function(e){return function(){x&&(x.setCurrentGame(e).gotoStart(),ge.bubble("hide"),T.switchEventBased(!1))}}(e));ge.append(jQuery("<li/>").append(n))}ge.bubble({side:"bottom",align:ve,point:"precise",flexible:!0})}"none"!=ge.closest(".bubble").css("display")?ge.bubble("hide"):ge.bubble("show")}).appendTo(pe).before(" ")}return C=K.bubble({side:"bottom",point:"precise",x:$.offset().left,persistent:!0,collapsable:!0}),setTimeout(function(){K.bubble("detach").css("z-index",4).bubble("show").bubble("hide"),$.css({height:C.height()+"px"})},100),j=new View.ChessBoard(J,!!U),j.resize(J.width()),T=new View.Cursor(X,t&&t.length>0),_=new View.NotationArea(Y,"positionDetails"),C.css("min-width",$.width()+"px"),fe.find(".tabNav a").one("click",function(){setTimeout(function(){jQuery(document).trigger("newhtml")},500)}),S},"undefined"==typeof View&&(View={}),View.ResignButton=function(e){function n(){void 0!==s&&(s.modal("hide",!0),s=void 0)}function i(e){function n(){var e="resign"!==c;l.removeClass("active"),l.off("click.resign"),Handler.tracking("playzone",c),i.emit("abortOrResign",{abort:e})}var i=e.publisher;if(void 0===i)return r;if(!(i instanceof Chess.Game||i instanceof Chess.GameHandler))return r;var a=!!i.getMeta().TournamentUUID;if(!a&&i.getDepth()<3){l.html(t("Abort"));var c="abort"}else l.html(t("Resign")).show(),c="resign";return l.closest(".drawResignButtons").toggleClass("noAbort","abort"===c),i.isOver()?(l.removeClass("active"),l.off("click.resign"),s&&s.modal("hide",!0)):(l.addClass("active"),l.off("click.resign").on("click.resign",function(){s=Dialog.confirmation(t(o[c]),n)})),r}var r=this,o={resign:"Are you sure you want to resign the current game?",abort:"Are you sure you want to abort the current game?"},a=new Handler.Template("playZone");e=jQuery(e),0===e.length&&errorHandler.msg("error",new Error("container not found"),!0,{container:e}),Extend.Subscriber(r,{"movedPositionPointer.current":n,"movedPositionPointer.endOfMainline":i,gameStatusChanged:i,currentGameChanged:i},{afterLink:function(e){i(e)}}),e.html(a.render("resignButton"));var s,l=e.find(".resign");return r},"undefined"==typeof View&&(View={}),View.Score=function(e,t){function n(e){t=e,s="w"===t?"white":"black"}function i(e){"b"===t?n("w"):"w"===t&&n("b"),d(e,e.publisher.getGameStatus())}function r(e){return o(e,e.publisher.getGameStatus()),l}function o(t,n){var i=n.result[s];return.5===i&&(i="&frac12;"),void 0===i?(c.removeClass("withScore"),void e.empty()):(c.addClass("withScore"),void e.html(i))}var a,s,l=this;e=jQuery(e);var c=e.parent();0===e.length&&errorHandler.error(new Error("container not found in View.Score"),{container:e}),Extend.Suspendable(l);var d=l.delegate(o);return Extend.Subscriber(l,{currentGameChanged:l.delegate(r),gameStatusChanged:d,flipBoard:i},{afterLink:r}),l.onResume(function(e){e&&a&&r({publisher:a})}),n(t),l},"undefined"==typeof View&&(View={}),View.SidebarAdvertisementRotation=function(e,t){function n(){jQuery.getJSON("/api/web/AdvertisementAPI/getSidebarAdds",{channel:t,language:config.language(),level:config.level().toString()},function(e){a=e.data.advertisements,a.length&&(a=a.sort(function(){return.5-Math.random()}),i())})}function i(){clearTimeout(r),o.html(a[s].content),r=setTimeout(function(){++s>=a.length&&(s=0),i()},1e3*l)}var r,o=jQuery(e),a=[],s=0,l=30;return o.length||errorHandler.error(new Error("container not found"),{container:o}),n(),this},"undefined"==typeof View&&(View={}),View.Sound=function(e){function t(){["capture","castling","check","move","negative","neutral","positive","start"].forEach(function(e){n(e,{"audio/mp3":e+".mp3","audio/ogg":e+".oga","audio/mp4":e+".m4a"})})}function n(e,t){var n=[];for(var i in t)t.hasOwnProperty(i)&&n.push({type:i,url:assetsBasePath+f+"/"+m+"/"+t[i]});soundManager.destroySound(e),soundManager.createSound({id:e,url:n,autoLoad:!0,autoPlay:!1,volume:window.settings.getNumber("game-sounds-volume")})}function i(e,t){0===t.getStartPosition().countChildrenMoves()&&a("start")}function r(e,t){if("finished"===t.status){var n="neutral";"w"===c&&1===t.result.white||"b"===c&&1===t.result.black?n="positive":("w"===c&&0===t.result.white||"b"===c&&0===t.result.black)&&(n="negative"),a(n)}}function o(e,t){if(!p)return d;var n="move";t.positionFlags.check?n="check":t.hasTakenPiece?n="capture":["O-O","O-O-O"].contains(t.getSan())&&(n="castling"),a(n)}function a(e){u.some(function(e){return window.settings.getBoolean(h+e)})&&soundManager.play(e,{volume:window.settings.getNumber("game-sounds-volume")})}function s(){p=!0}function l(){p=!1}if(e||errorHandler.error("missing context in Sound View"),View.Sound.instance)return View.Sound.instance.addContext(e),View.Sound.instance;var c,d=this,u=[],h="game-sound-category-",f="/sounds",p=window.settings.getBoolean("game-sounds"),m=window.settings.get("game-sounds-theme");if(!m)return errorHandler.msg("error",new Error("no sound theme defined"),!1),d;Extend.Suspendable(d);var g={"sound.on":d.delegate(s),"sound.off":d.delegate(l),"movedPositionPointer.current.next":d.delegate(o),gameStatusChanged:d.delegate(r),startPlayZoneGame:d.delegate(i)};return Extend.Subscriber(d,g),void 0===soundManager&&errorHandler.msg("critical",new Error("Can't find soundManager"),!0),soundManager.defaultOptions={stream:!1},soundManager.setup({url:config.assetDir()+"/images/swf",flashVersion:9,useHTML5Audio:!0,preferFlash:!1,html5Only:!1,debugMode:!1,stream:!1,onready:t}),window.settings.on("settings.game-sounds",function(){p=window.settings.getBoolean("game-sounds")}),window.settings.on("settings.game-sounds-theme",function(e,n){m=n.value||m,t()}),d.setUserRole=function(e){return c=["w","b"].contains(e)?e:void 0,d},d.addContext=function(e){return!e||u.contains(e)?d:(u.push(e),d)},d.addContext(e),View.Sound.instance=d,d},"undefined"==typeof View&&(View={}),View.SpectatorList=function(e){function t(e){s=e.publisher,r()}function n(e,t){if(!c.children("li."+t.uuid).length)if(t.registered){var n=m.render("spectatorLine",t);d.before(n),r()}else h.contains(t.uuid)||(h.push(t.uuid),r())}function i(e,t){c.children("li."+t.uuid).remove(),h.removeByValue(t.uuid),r()}function r(){var e=c.children("li.spectator").length||h.length,t=s&&!s.isOver();f.hide(),p.hide(),c.hide(),t?e?e&&c.show():p.show():f.show(),h.length?(d.show(),c.children("li.spectator").length?u.show():u.hide(),d.children(".count").html(h.length),h.length>1?(d.children(".singular").hide(),d.children(".plural").show()):(d.children(".singular").show(),d.children(".plural").hide())):d.hide()}function o(e,t){c.children("li.spectator").remove(),h=[];for(var i in t)t[i].uuid=i,n(e,t[i])}var a=this;e=jQuery(e);var s,l=e.find(".nativeScrollInsider"),c=l.children("ul"),d=c.children("li.guests"),u=d.children(".connector"),h=[],f=e.find(".emptyGameOver"),p=e.find(".emptyNoSpectators");e.length&&c.length&&d.length&&u.length||errorHandler.msg("error",new Error("container not found"),!0,{container:e}),Extend.Subscriber(a,{spectatorJoin:n,spectatorLeave:i,
spectatorUpdate:o,currentGameChanged:t,gameStatusChanged:t},{afterLink:function(e){(e.publisher instanceof Chess.Game||e.publisher instanceof Chess.GameHandler)&&t(e)}});var m=new Handler.Template("playZone").append(new Handler.Template);return a},"undefined"==typeof View&&(View={}),View.ActivityStream=function(e,t,n){function i(e){var i=l?l.find("li").length:0;jQuery.getJSON(h+"list",{type:t,offset:i,language:config.language(),topics:n},function(t){var i=t.data.items;if(!i.length)return void e(!1);i.forEach(function(e){e.content=o(e)}),$.isArray(n)&&(i=i.filter(function(e){return-1!==n.indexOf(e.storyTopicPermalink)}));var r=u.render("list",{items:i});l?l.append(jQuery(r).contents()):(d.empty().append(r),l=d.find(".activityStream")),s(),e(!0)})}function r(e){return"community"==e.topic&&"comment"==e.action&&(e.comment=jQuery(e.comment).find("script").remove().end().text().ellipsis({length:100})),e}function o(e,i){if(e=r(e),!$.isArray(n)||-1!==n.indexOf(e.storyTopicPermalink)){var o=u.render(t+"."+e.action,e);if(!i)return o;var a=u.render("item",Object.merge(e,{content:o}));if(l)l.prepend(jQuery(a));else{var c=u.render("list",{items:[Object.merge(e,{content:o})]});d.empty().append(c),l=d.find(".activityStream")}s()}}function a(e){d.find("#"+e.uuid).remove()}function s(){l.find(".formatTimeAgo").showAge(),l.find(".ofMiniProfile").addMiniprofile()}var l,c=this,d=jQuery(e),u=new Handler.Template("activity").append(new Handler.Template),h="/api/web/activityStreamAPI/";if(!d.length)return void errorHandler.msg("error",new Error("no container given"),!0);var f="channel:"+t+":"+config.language(),p="channel:revoke:"+t+":"+config.language();return Extend.Subscriber(c,{},{afterLink:function(e){e.publisher.subscribe(f).on(f,function(e,t){o(t.content,!0)}),e.publisher.subscribe(p).on(p,function(e,t){a(t.content)})}}),d.lazyload({distance:200,onstart:i}),c},"undefined"==typeof View&&(View={}),View.AdvertisementOverlay=function(e,t){function n(){t.removeOverlay(),p||o()}function i(){var e=[],i=config.level().toString();if("guest"==i&&(i="guests"),m.forEach(function(t,n){if(parseInt(t.active,10)&&parseInt(t["show_"+i],10)){var r=t.nextShow;(!r||r<Date.now())&&e.push(n)}}),e.length>0){var r=e[Math.randomBetween(0,e.length-1)],a=m[r],s=jQuery(f.render("overlay",m[r]));if(s.find(".trigger").on("click",function(e){return Handler.tracking("advertisement","overlayClick",a.title),e.stopPropagation(),!0}),s.on("click",function(){s.find(".trigger").get(0).click()}),!t.attachOverlay(s))return void o();clearTimeout(l),l=setTimeout(n,u),a.nextShow=Date.now()+1e3*a.min_timeout,Handler.tracking("advertisement","overlayShow",a.title),s.find(".close").on("click",function(e){return p=!0,n(),e.stopPropagation(),e.preventDefault(),!1})}else o()}function r(e,t){t=t.content;var n=m.find(function(e){return e.uuid==t.uuid});n?Object.extend(n,t):m.push(t),a||s||p||o()}function o(e){clearTimeout(s),s=setTimeout(i,e&&c||d)}var a,s,l,c=12e4,d=3e5,u=9e4,h=this,f=new Handler.Template("advertisement"),p=!1;t instanceof View.VideoSimple||errorHandler.error(new Error("provided view is not View.Video"),{video:t});var m=[],g="channel:advertisement:overlay:"+config.level()+":"+config.language(),v={};return v[g]=r,Extend.Subscriber(h,v,{afterLink:function(e){e.publisher.subscribe(g)}}),jQuery.getJSON("/api/web/advertisementAPI/getOverlays",{language:config.language(),id:e,level:config.level().toString()}).done(function(e){m=e.data&&e.data&&e.data.advertisements,m&&o(!0)}),h},"undefined"==typeof View&&(View={}),View.ChallengeButton=function(e,t,n,i,r){function o(e,t){function n(t){var n=t.user,i=n.online===!0&&n.canChallenge===!0;i===!0?n.challenge?a(e,n.challenge):s():l()}return config.level().isGuest?(s(),f.on("click.challenge",function(){Dialog.conversionRegister("challenge")}),h):(t?n(t):u(n),h)}function a(e,t){f.html(w.cancelChallenge).removeClass("cBtnInactive").off("click.challenge").on("click.challenge",function(){c(e,t)})}function s(){f.html(w.challenge).removeClass("cBtnInactive").off("click.challenge").on("click.challenge",d)}function l(){f.html(w.challenge).addClass("cBtnInactive").off("click.challenge")}function c(e,t){jQuery.post(g+"/gameCancel",jQuery.extend({challenge:t},v)).done(function(e){o()})}function d(){u(function(e){e.myData.reachedChallengeLimit?config.level().isGuest?Dialog.conversionRegister("challenge"):Dialog.conversionGoPremium("challenge"):new Dialog.Challenge(t,e.user).getContent().modal({close:!0,destroyOnClose:!0,classes:"customPopup"}).modal("show")})}function u(e){jQuery.getJSON(m+"/getMiniprofile?userUUID="+t).done(function(t){e(t.data)})}i=i||{},r=r!==!1;var h=this,f=jQuery(e),p="channel:online",m="/api/web/UserAPI",g="/api/web/ChallengeAPI";0===f.length&&errorHandler.msg("error",new Error("container not found"),!0,{container:f});var v={csrf:config.csrf()},y={},b=p+":"+t;y[b]=function(e){o(e)};var w={challenge:i.challenge||"Challenge me!",cancelChallenge:i.cancelChallenge||"Cancel challenge"};for(var k in w)w[k]=window.t(w[k]);return r?Extend.Subscriber(h,y,{afterLink:function(e){e.publisher.subscribe(b),o(e,n),e.publisher.on("game_challenge",function(e,n){n.content.toUuid===t&&("sent"===n.content.action&&a(e,n.content.challenge),("cancelself"===n.content.action||"accept"===n.content.action||"cancel"===n.content.action||"decline"===n.content.action)&&s())})},afterUnlink:function(e){e.publisher.off("game_challenge")}}):(h.link=function(){return h},h.unlink=function(){return h},s()),h},"undefined"==typeof View&&(View={}),View.Challenge=function(e,n){function i(e,t){t&&t.content&&("request"===t.content.action?s(t):"cancel"===t.content.action?l(t):"decline"===t.content.action?h(t):"accept"===t.content.action?Handler.singleTab("challenge-"+t.content.challenge,function(){f(t)}):"sent"===t.content.action?p(t):"cancelself"===t.content.action?c(t):"declineself"===t.content.action?d(t):"acceptself"===t.content.action&&u(t))}function r(){S.removeClass("active"),S.find(".sidebarMenuContent").hide()}function o(){return S.find(".sidebarMenuContent").is(":visible")}function a(e,t,n){M=Math.max(0,M+(t||0)),Q=Math.max(0,Q+(e||0)),B=Math.max(0,B+(n||0)),P.html(B||"")[B?"show":"hide"](),S[M||Q?"addClass":"removeClass"]("activeChallenges").attr("data-incoming",M).attr("data-outgoing",Q),Handler.pageTitle.updateNotification(n)}function s(e){if(o()){a(0,1,0),e.content.unseen=!0,e.content.userOnline=!0;var t=x(e.content,"itemIncoming");S.find("section ul").prepend(t),S.find(".noChallangesToShow").hide()}else a(0,1,1)}function l(e){a(0,-1,e.content.unseen?-1:0),o()&&(S.find("#challenge-"+e.content.challenge).remove(),S.find("section li").length||S.find(".noChallangesToShow").show())}function c(e){a(-1,0,0),S.find("#challenge-"+e.content.challenge).remove(),S.find("section li").length||S.find(".noChallangesToShow").show()}function d(e){a(0,-1,0),o()&&(S.find("#challenge-"+e.content.challenge).remove(),S.find("section li").length||S.find(".noChallangesToShow").show())}function u(e){a(0,-1,0),o()&&(S.find("#challenge-"+e.content.challenge).remove(),S.find("section li").length||S.find(".noChallangesToShow").show())}function h(e){a(-1,0,0),o()&&(S.find("#challenge-"+e.content.challenge).remove(),S.find("section li").length||S.find(".noChallangesToShow").show())}function f(e){if(a(-Q,0,0),e.content.immediate&&1===parseInt(e.content.immediate,10))o()&&r(),Controller.getPlayZone().playNow();else{o()&&S.find("#challenge-"+e.content.challenge+", section li").remove();var n=jQuery(I.render("dialogs.challengeAccepted",{userName:e.content.userName,clock:e.content.clock/6e4,increment:e.content.increment&&e.content.increment/1e3,rated:e.content.rated&&"rated"||"unrated",ratedString:e.content.rated&&t("rated")||t("unrated"),role:e.content.role}));Dialog.confirmation({content:t("{user} accepted your challenge",{"{user}":'<a href="'+e.content.userUrl+'">'+e.content.userName+"</a>"}),comment:n},{label:t("Go to game"),callback:function(){jQuery.post("/api/web/challengeAPI/gameResolve",jQuery.extend({challenge:e.content.challenge},D)).done(Controller.getPlayZone().playNow)}},{label:t("Close")})}}function p(e){var t=1-(e.content.cancelled?e.content.cancelled.length:0);if(a(t,0,0),o()){if(S.find("section ul").prepend(x(e.content,"itemOutgoing")),e.content.cancelled)for(var n=0;n<e.content.cancelled.length;n++)S.find("#challenge-"+e.content.cancelled[n]).remove();S.find(".noChallangesToShow").hide()}}function m(e){jQuery.post("/api/web/challengeAPI/gameAccept",jQuery.extend({challenge:e},D),function(e){0===e.status&&Controller.getPlayZone().playNow()})}function g(e){jQuery.post("/api/web/challengeAPI/gameDecline",jQuery.extend({challenge:e},D),function(t){0===t.status&&(S.find("#challenge-"+e).remove(),S.find("section li").length||S.find(".noChallangesToShow").show(),jQuery(document).trigger("newhtml"))})}function v(e){jQuery.post("/api/web/challengeAPI/gameCancel",jQuery.extend({challenge:e},D),function(e){0===e.status&&(S.find("section li").length||S.find(".noChallangesToShow").show(),jQuery(document).trigger("newhtml"))})}function y(e){return jQuery.post("/api/web/challengeAPI/gameResolve",jQuery.extend({challenge:e},D))}function b(){jQuery.post("/api/challengeAPI/gameCancelAll",D,function(e){0===e.status&&(S.find("section li").remove(),S.find("section li").length||S.find(".noChallangesToShow").show())})}function w(){jQuery.post("/api/challengeAPI/gameDeclineAll",D,function(e){0===e.status&&(S.find("section li").remove(),S.find("section li").length||S.find(".noChallangesToShow").show())})}function k(e){return e.find("li").add(e.filter("li")).each(function(){var e=jQuery(this),t=e.data("challenge");e.find("a.decline").on("click",function(){g(t)}),e.find("a.accept").on("click",function(){jQuery(this).is(".cBtnInactive")||m(t)}),e.find("a.cancel").on("click",function(){v(t)}),new View.Online(e,"1"==e.data("online"),e.data("uuid")).link(notificationHandler)}),e.find("a.ofMiniProfile").addMiniprofile(),e.find("a.cancelAll").add(e.filter("a.cancelAll")).on("click",b),e.find("a.declineAll").add(e.filter("a.declineAll")).on("click",w),e}function x(e,t,n){var i=jQuery.extend({},e);i.custom&&i.custom.clockWhite&&i.custom.clockBlack?i.custom.clockWhite!=i.custom.clockBlack?i.clock=window.t("{white} vs. {black}",{"{white}":C(i.custom.clockWhite),"{black}":C(i.custom.clockBlack)}):i.clock=C(i.custom.clockWhite):i.clock=C(i.clock),i.increment/=1e3,i.color=window.t("w"===i.color?"white":"b"===i.color?"black":"random"),i.rated=window.t(parseInt(i.rating,10)?"rated":"unrated"),i.userOnline=i.userOnline?1:0;var r=I.render(t,i);return n?r:k(jQuery(r))}function C(e){return window.t(e%6e4>0?"{minutes}m {seconds}s":"{minutes}m",{"{minutes}":Math.floor(e/6e4),"{seconds}":e/1e3%60})}function j(e){for(var t=[],n=0,i=0,r=0;r<e.length;r++){var o=e[r].incoming?"itemIncoming":"itemOutgoing";t.push(x(e[r],o,!0)),e[r].incoming?n++:e[r].outgoing&&i++}a(i-Q,n-M,-B);var s=jQuery(I.render("list",{items:t}));return k(s)}function T(){S.find(".section").addClass("loading"),S.find(".noChallangesToShow").hide(),jQuery.post("/api/web/challengeAPI/getGameChallenges",D,function(e){if(0===e.status){S.find("section").removeClass("loading").toggleClass("noscrolling",e.data.challenges.length<=3),S.find("section .nativeScrollInsider").html("").append(j(e.data.challenges)),e.data.playing&&(S.find("section .warning").show(),S.find("a.accept").addClass("cBtnInactive"));var t=S.find("section .nativeScrollInsider .incoming").length>0&&S.find("section .nativeScrollInsider .outgoing").length>0;t?S.find(".challengesFilter").show():S.find(".challengesFilter").hide(),S.find("input:radio").off("change.challenges").on("change.challenges",function(){var e=jQuery(this).data("filter");"all"===e?S.find("section li").show():"outgoing"===e?(S.find("section li.incoming").hide(),S.find("section li.outgoing").show()):(S.find("section li.incoming").show(),S.find("section li.outgoing").hide())}),0===S.find("section li").length?S.find(".noChallangesToShow").show():S.find(".noChallangesToShow").hide(),jQuery(document).trigger("newhtml")}})}var _=this,S=jQuery(e);if(!S.length)return void errorHandler.msg("error",new Error("no container given"),!0);var I=new Handler.Template("challenges").append(new Handler.Template),P=S.find(".notiBox"),M=parseInt(S.data("incoming"),10),Q=parseInt(S.data("outgoing"),10),B=parseInt(P.text(),10)||0,E=S.find("> a"),O=jQuery(n),A=O.data("challenge");A&&O.find(".playNowLink").on("click",function(){y(A)});var D={csrf:config.csrf()};return a(0,0,0),Handler.pageTitle.updateNotification(parseInt(P.text(),10)),Extend.Subscriber(_,{game_challenge:i}),E.on("click",T),_},"undefined"==typeof View&&(View={}),View.ConversionSidebar=function(e){function t(e,t){t&&t.content&&void 0!==t.content.html&&i.html(t.content.html)}var n=this,i=jQuery(e);i.length||errorHandler.error(new Error("container not found"),{container:i});var r="channel:conversionSidebar:"+config.level().toString()+":"+config.language(),o={};return o[r]=t,Extend.Subscriber(n,o,{afterLink:function(e){e.publisher.subscribe(r)}}),n},"undefined"==typeof View&&(View={}),View.Flash=function(e){function t(e,t){var i=jQuery(a.render("types_flashMessage",t.templateData));r.append(i),i.find(".closeFlashMessageBtn").on("click",function(){n(this)}),i.css("margin-top","-"+i.outerHeight()+"px");var s=r.find(".flashMessage").length,l=0;r.find(".flashMessage").each(function(e,t){jQuery(t).css("z-index",s-e),l+=jQuery(t).outerHeight()}),i.transition({"margin-top":"0px"},500),jQuery(".pageContent").stop().animate({"margin-top":o+l+"px"},500)}function n(e){var t=jQuery(e).parents(".flashMessage");t.transition({"margin-top":"-"+t.outerHeight()+"px"},500,function(){t.remove()});var n=parseInt(jQuery(".pageContent").css("margin-top"));jQuery(".pageContent").transition({"margin-top":n-t.outerHeight()+"px"},500)}var i=this,r=jQuery(e);if(!r.length)return void errorHandler.msg("error",new Error("container for flash messages was not found"),!0);Extend.Subscriber(i,{flash:t});var o=parseInt(jQuery(".pageContent").css("margin-top")),a=new Handler.Template("notifications");return i},"undefined"==typeof View&&(View={}),View.GameSessionList=function(e,t){function n(){d.children("tr").each(function(e,t){var n=jQuery(t);n.find(".ofMiniProfile").addMiniprofile()}),i()}function i(){0===d.children("tr").length?d.append(p):p.remove(),0!==h.length&&h.html(d.children("tr").not("tr.noItem").length)}function r(e,t){j.push(t.content)}function o(){for(;j.length;){var e=j.shift();s(e.gameSessionToken,e.data)}}function a(e){if(!y){var t=jQuery(f.render("gameSessionList.item",{player:{white:{profileUrl:!0,attributes:{title:{code:"GM"},staff:!0,premium:!0,moderator:!0,fraud:!0,cop:!0}}}}));y=t.find(".attributeTitle"),b=t.find(".attributeStaff").get(0).outerHTML,w=t.find(".attributeModerator").get(0).outerHTML,k=t.find(".attributeFraud").get(0).outerHTML,x=t.find(".attributeCop").get(0).outerHTML,C=t.find(".attributePremium").get(0).outerHTML}return e.nick=e.nick.ellipsis({pixels:178,css:{"font-style":"italic","font-size":"13px"},append:(e.attributes.title?y.clone().html(e.attributes.title.code).get(0).outerHTML:"")+(e.attributes.staff?b:"")+(e.attributes.moderator?w:"")+(e.attributes.fraud?k:"")+(e.attributes.cop?x:"")+(e.attributes.premium?C:"")||!1}),e}function s(e,t){if(0===d.children("tr.gameSession_"+e).length){a(t.player.white),a(t.player.black),t.gameTime=t.player.white.base?60*t.player.white.base+40*t.player.white.increment:99999;var n=jQuery(f.render("gameSessionList.item",t));n.find(".ofMiniProfile").addMiniprofile(),u.trigger("chess24:add",n.fadeIn("slow")),i()}}function l(e,t){var n=d.children("tr.gameSession_"+t.content.gameSessionToken);n.length&&(u.trigger("chess24:remove",n),i())}var c=this,d=jQuery(e).children("tbody"),u=d.closest("table"),h=jQuery(t);0===d.length&&errorHandler.msg("error",new Error("View.GameSessionList: container not found"),!0,{container:d});var f=new Handler.Template("lobby").append(new Handler.Template),p=jQuery(f.render("gameSessionList.noItem")),m="channel:gameSession:add",g="channel:gameSession:remove",v={};v[m]=r,v[g]=l;var y,b,w,k,x,C,j=[];return setInterval(o,3e3),Extend.Subscriber(c,v,{afterLink:function(e){e.publisher.subscribe(m),e.publisher.subscribe(g),n()}}),c},"undefined"==typeof View&&(View={}),View.Notifications=function(e){function t(){$.get(m+"getNotificationsNumber").done(function(e){var t=parseInt(e.data.notificationsNumber,10);S.html(Math.max(0,t)),1>t?S.hide():S.show()}).fail(function(){_.removeClass("loading").html(window.t("Messages couldn't be loaded")).show(),k=!1,S.hide()})}function n(){var e=parseInt(S.text(),10);C&&(e=Math.max(0,e-C),Handler.pageTitle.updateNotification(-C),C=0),S.text(e)[e>0?"show":"hide"]()}function i(e,t){if(!k){var i=T.find("li").length;v=p.find(".nativeScroll"),y=v.find(".nativeScrollInsider"),_.html("").addClass("loading").show(),k=!0;var o={offset:e,lang:config.language()};jQuery.get(m+"getNotifications",o,function(e){_.removeClass("loading").hide();var o=!1;if(e.data.notifications.length){var l="",c=!1;o=!0;for(var d=0;d<e.data.notifications.length;d++)l+=r(e.data.notifications[d])||"",c=c||!!e.data.notifications[d].unvisited;T.append(l).expandEmoticons().show(),_.html("").hide(),jQuery(document).trigger("newhtml"),y=v.find(".nativeScrollInsider"),s(),T.find("li").data("unseen",!1),c&&I.show()}else 0===i&&(T.hide().html(""),_.html(window.t("There are no messages for you")).show());t&&t(o),n(),k=!1,w=!0,t||a()}).error(function(){_.removeClass("loading").html(window.t("Messages couldn't be loaded")).show(),k=!1})}}function r(e,t){if(o(e)){if(x.contains(e.id)){var n=T.find("[data-id="+e.id+"]");n.data("unseen")&&C--,n.remove(),x.removeByValue(e.id)}C+=e.unseen||t?1:0,x.push(e.id);var i=b.render("types_"+e.template,e.data),r=b.render("notification",{unvisited:e.unvisited,id:e.id,frontend:!!e.frontend,body:i,url:e.data.url});return t&&(jQuery(r).expandEmoticons().data("unseen",!!e.unseen).prependTo(T),e.unvisited&&I.show()),r}}function o(e){if("badgeNotification"===e.template)Handler.tracking("badge",e.data.message.en||"Undefined badge"),e.data.message=e.data.message[config.language()],e.data.image=e.data.image[config.language()];else if(["playzoneTournamentToastCancel","playzoneTournamentToastFinish","playzoneTournamentToastInvite"].contains(e.template))e.data.tournamentName="object"==typeof e.data.tournamentName&&e.data.tournamentName[config.language()]||e.data.tournamentName;else if(["commentReplied","commentLiked"].contains(e.template))e.data.users=e.data.users.reverse(),e.data.users.length>3&&(e.data.other=e.data.users.length-2);else if(["broadcast","broadcast:guest","broadcast:registered","broadcast:premium"].contains(e.template)){if(e.data.message&&(e.data.message=e.data.message[config.language()],e.data.url=e.data.url[config.language()],e.data.linkname=e.data.linkname[config.language()]),!e.data.message)return!1;e.template="broadcast"}return!0}function a(){y.lazyload({distance:250,onstart:function(e){i(T.find("li").length,e)}})}function s(){T.find("a.delete").on("click",function(){return jQuery(this).off("click"),c(jQuery(this).closest("li").data("id")),!1}),T.find(".liTime").showAge()}function l(e,t){var i=T.find("li[data-id="+e+"]");if(i.length&&(i.data("unseen")&&C--,i.off().css("padding-bottom",0).animate({height:0},200,function(){i.remove(),0===T.find("li").length&&_.html(window.t("There are no messages for you")).show()})),t){var r=parseInt(S.text(),10);S.html(Math.max(0,r-1)),Handler.pageTitle.updateNotification(-1)}n()}function c(e){var t=jQuery.extend({id:e},j);l(e),jQuery.post(m+"deleteNotification",t)}function d(e,t){var n=jQuery.extend(t,j);jQuery.post(m+"deleteNotificationByReference",n,function(e){if(0===e.status){var t=e.data.id,n=e.data.unseen;l(t,n)}})}function u(e,t){switch(t.content.template){case"messageReceived":if(conversationHandler.isConversationsDisplayed(t.content.data.conversationId,t.content.data.reference_uuid))return void setTimeout(function(){c(t.content.id)},500)}var n=C;if(r(t.content,!0)){_.hide(),T.show();var i=C-n;if(jQuery(document).trigger("newhtml"),v=p.find(".nativeScroll"),y=v.find(".nativeScrollInsider"),s(),h())T.find("li").data("unseen",!1);else if(i){var o=parseInt(S.text(),10)||0;S.text(o+1).show(),Handler.pageTitle.updateNotification(1)}}}function h(){return p.find(".sidebarMenuContent").is(":visible")}var f=this,p=jQuery(e),m="/api/web/NotificationsAPI/";if(!p.length)return void errorHandler.msg("error",new Error("no container given"),!0);var g="channel:broadcast:"+config.level();Extend.Subscriber(f,{toast:u,deleteNotification:d},{afterLink:function(e){e.publisher.subscribe(g).on(g,u)}});var v,y,b=new Handler.Template("notifications"),w=!1,k=!1,x=[],C=0,j={csrf:config.csrf()},T=p.find(".nativeScrollInsider ul").hide(),_=p.find(".nativeScrollInsider .message").hide(),S=p.find(".notiBox");p.find("> a").on("click",function(){w?n():i()});var I=p.find("a.markAllAsRead").on("click",function(){I.is(".disabled")||(I.addClass("disabled"),jQuery.post(m+"allRead",{csrf:config.csrf()}).done(function(){I.removeClass("disabled")}),T.find("li").data("unseen",!1).filter(".unvisited").removeClass("unvisited"),C=0,S.empty().hide(),I.hide())}).hide();return t(),f},"undefined"==typeof View&&(View={}),View.OnlineUserCount=function(e,t){function n(){i(void 0,{count:t})}function i(e,n){n&&n.count?o.html(n.count.toString()):o.html(t)}t=t||0;var r=this,o=jQuery(e);0===o.length&&errorHandler.msg("error",new Error("View.OnlineUserCount: container userOnlineCount not found"),!0,{container:o});var a="channel:online:users:count",s={};return s[a]=i,Extend.Subscriber(r,s,{afterLink:function(e){e.publisher.subscribe(a),n()}}),r},"undefined"==typeof View&&(View={}),View.OnlineUserList=function(e,t){function n(){s.children("tr").each(function(e,t){var n=jQuery(t),i=n.find("td > a.challenges"),r=i.data("uuid"),o=i.data("miniprofile");n.find(".ofMiniProfile").addMiniprofile(),p.challenge[r]=new View.ChallengeButton(i,r,o,m,!1).link(notificationHandler),p.online[r]=new View.Online(n,!0,r).link(notificationHandler)}),i()}function i(e){0===s.children("tr").length?s.append(d):d.remove(),0!==l.length&&l.html(s.children("tr").not("tr.noItem").length)}function r(e,t){var n=t.content.userUUID;if(n!==config.user().uuid&&0===s.children("tr.userOnline_"+n).length){var r=jQuery(c.render("onlineUserList.item",t.content.data)),o=r.find("td > a.challenges");r.find(".ofMiniProfile").addMiniprofile();var a=JSON.betterParse(t.content.data.miniprofile);p.challenge[n]=new View.ChallengeButton(o,n,a,m,!1).link(notificationHandler),p.online[n]=new View.Online(r,!0,n).link(notificationHandler),s.append(r),i()}}function o(e,t){var n=t.content.userUUID,r=s.children("tr.userOnline_"+n);r.remove(),i(),p.challenge[n].unlink(notificationHandler),p.online[n].unlink(notificationHandler),delete p.challenge[n]}var a=this,s=jQuery(e).children("tbody"),l=jQuery(t);0===s.length&&errorHandler.msg("error",new Error("View.OnlineUserList: container userOnlineList not found"),!0,{container:s});var c=new Handler.Template("lobby"),d=jQuery(c.render("onlineUserList.noItem")),u="channel:user:online",h="channel:user:offline",f={};f[u]=r,f[h]=o;var p={challenge:{},online:{}};Extend.Subscriber(a,f,{afterLink:function(e){e.publisher.subscribe(u),e.publisher.subscribe(h),n()}});var m={challenge:"Challenge",cancelChallenge:"Cancel"};return a},"undefined"==typeof View&&(View={}),function(){var e={};View.Online=function(t,n,i){function r(t,n){return"online"===n.content.action?(e[i]=!0,a.removeClass("offline").addClass("online")):"offline"===n.content.action&&(e[i]=!1,a.removeClass("online").addClass("offline")),o}var o=this,a=jQuery(t),s="channel:online";0===a.length&&errorHandler.msg("error",new Error("container not found"),!0,{container:a});var l={},c=s+":"+i;return l[c]=r,e[i]=n||!1,Extend.Subscriber(o,l,{afterLink:function(e){e.publisher.subscribe(c);var t=n?"online":"offline";r(e,{content:{action:t}})}}),o},View.Online.getState=function(t){return e[t]}}(),"undefined"==typeof View&&(View={}),View.RunningGamesCount=function(e){function t(){e.html(l)}function n(){l++,t()}function i(){l>=1&&(l--,t())}var r=this;e=jQuery(e),0===e.length&&errorHandler.msg("error",new Error("View.GameSessionList: container not found"),!0,{container:e});var o="channel:gameSession:add",a="channel:gameSession:remove",s={};s[o]=n,s[a]=i;var l=e.data("count");return Extend.Subscriber(r,s,{afterLink:function(e){e.publisher.subscribe(o),e.publisher.subscribe(a),t()}}),r},"undefined"==typeof View&&(View={}),View.TopActivePlayers=function(e,t){function n(e,t){t.content.data&&r(t.content.data)}function i(e,t){o(),a.on(l[e],n),a.subscribe(l[e]),t&&jQuery.getJSON("/api/web/PlayzoneAPI/topActivePlayers",{type:e}).done(function(e){r(e.data.data)}),o=function(){a.off(l[e],n),a.unsubscribe(l[e])}}function r(t){t&&t.forEach(function(e){["link","streamUrl"].forEach(function(t){e[t]="object"==typeof e[t]?e[t][config.language()]:e[t]})});var n=c.render("topPlayers",{players:t});e.html(n),layout.userMiniprofile(e)}function o(){}var a,s=this,e=jQuery(e),l={bullet:"channel:topPlayers:bullet:update",blitz:"channel:topPlayers:blitz:update",classic:"channel:topPlayers:classic:update"};0===e.length&&errorHandler.msg("error",new Error("View.TopActivePlayers: container not found"),!0,{container:e});var c=new Handler.Template("lobby").append(new Handler.Template);return t.each(function(){var e=jQuery(this),n=e.data("type"),r=e.find("a");r.on("click",function(){t.removeClass("active"),jQuery(this).parent().addClass("active"),i(n,!0)})}),Extend.Subscriber(s,{},{afterLink:function(e){a=e.publisher,i("blitz")}}),s},"undefined"==typeof View&&(View={}),View.TopGame=function(e,t){function n(e,t,n){d[t]&&e.token==d[t].token||(d[t]=Object.copy(e),d[t].type=t,a(d[t].player.white),a(d[t].player.black),l.find("div."+t).html(c.render("topGamesItem",d[t])),l.find("ul.topGamesSwitch ."+t+" a").removeClass("disabled"),l.find(".ofMiniProfile").addMiniprofile(),n||l.is(":visible")||o(t))}function i(e){h.forEach(function(t){var i=u+t;e.subscribe(i).on(i,function(e,i){i.content.data&&n(i.content.data,t)})})}function r(){l.html(c.render("topGames")).hide();var e=l.find("ul.topGamesSwitch");e.find("a").on("click",function(){var t=jQuery(this);if(!t.is(".disabled")){var n=t.closest("li");if(!n.is(".active")){var i=n.attr("class");e.find("li.active").removeClass("active"),n.addClass("active"),l.find("div.bullet, div.blitz, div.classic").hide(),l.find("div."+i).show()}}})}function o(e){l.show(),l.find("div."+e).show(),l.find("li."+e).addClass("active")}function a(e){e.nick=e.nick.ellipsis({pixels:w-20,css:{"font-style":"italic","font-size":"14px"},append:(e.attributes.title?p.clone().html(e.attributes.title).get(0).outerHTML:"")+(e.attributes.staff?g:"")+(e.attributes.moderator?v:"")+(e.attributes.fraud?y:"")+(e.attributes.cop?b:"")+(e.attributes.premium?m:"")||!1})}var s=this,l=jQuery(e);0===l.length&&errorHandler.msg("error",new Error("View.TopGame: container not found"),!0,{container:l});var c=new Handler.Template("lobby").append(new Handler.Template),d={},u="channel:gameSession:topgame:",h=["bullet","blitz","classic"];Extend.Subscriber(s,{},{afterLink:function(e){if(i(e.publisher),r(),t)if(Object.forEach(t,function(e,t){e&&n(e,t,!0)}),t.blitz)var a="blitz";else t.bullet?a="bullet":t.classic&&(a="classic");a?o(a):l.hide()}});var f=jQuery(c.render("topGamesItem",{player:{black:{attributes:{premium:!0,title:{code:"GM"},staff:!0,moderator:!0,fraud:!0,cop:!0}}}})),p=f.find(".attributeTitle"),m=f.find(".attributePremium").get(0).outerHTML,g=f.find(".attributeStaff").get(0).innerHTML,v=f.find(".attributeModerator").get(0).innerHTML,y=f.find(".attributeFraud").get(0).innerHTML,b=f.find(".attributeCop").get(0).innerHTML,w=l.width();return s},"undefined"==typeof View&&(View={}),View.TournamentSchedule=function(e,t){function n(e,t,n){return Object.filter(n,function(n,i){return i>=e&&t>=i})}function i(){return Math.floor(this.clock/6e4)}var r=this;if("object"!=typeof t)return e.addClass("disabled"),r;e=jQuery(e);var o=e.children("ul");o.length||errorHandler.error(new Error("container>ul not found in View.TournamentSchedule"));var a=new Date;a.setTime(a.getTime()-36e5*a.getHours()-6e4*a.getMinutes()-1e3*a.getSeconds()-a.getTime()%1e3),a=a.getTime();var s=new Date(a-1+864e5).getTime(),l=new Handler.Template("playZone"),c=n(a,s,t);if(!Object.getLength(c))return e.addClass("disabled"),r;for(var d=0;24>d;d++){var u=new Date(a).setHours(d),h=new Date(new Date(a).setHours(d+1)-1).getTime(),f=n(u,h,t),p=Object.getLength(f)?Object.find(f,function(){return!0}):null;o.append(l.render("tournaments.dailyTournamentSchedule",{formatedTime:d.toString().lpad("0",2)+":00",activeTournament:p,formatedClock:i}))}return e.show(),r},"undefined"==typeof View&&(View={}),View.UserMoveMode=function(e,t){function n(){for(var e=p.getCurrentPosition(),t=e;t.parentMove&&"local"===t.getSource();)t=t.parentMove;return e!==t&&p.setCurrentPosition(t),s}function i(e){return r(e,e.publisher.getCurrentPosition())}function r(e,t){o(e,{value:t.getSource(),position:t})}function o(t,n){clearTimeout(a),a=setTimeout(function(){"local"===n.value?(1===h&&f++,e.removeClass(l),u=!0,window.settings.set(c,1),0===h&&e.show("slide",d),h=1):u?0!==h&&(e.hide("slide",d),h=0):2!==h&&(e.show("slide",d).addClass(l),h=2)})}var a,s=this,l="introducting",c="game-made-own-move",d={direction:"top"===t?"down":"left"};e=jQuery(e);var u=window.settings.getBoolean(c),h=0,f=0;e.on("click",n),e.length||errorHandler.error("container not found for userMoveMode");var p;return Extend.Subscriber(s,{"movedPositionPointer.current":r,"position.source.current":o,currentGameChanged:i},{afterLink:function(e){p=e.publisher,i(e)}}),s},"undefined"==typeof View&&(View={}),View.VideoExercises=function(e,t,n,i,r,o,a,s){function l(){if(jQuery(".btnEbook").on("click",function(){E.modal("hide"),window.location=jQuery("#linkedEbookUrl").val()}),Extend.Subscriber(j,{triggerExerciseGroup:d,triggerEndOfVideo:w}),E.on("chess24:hide",k),a&&E.find(".buyVideoSeries").on("click",function(){E.modal("hide")}),E.find(".btnIconShareGame a").shareButtons({noLabel:!0,noIcon:!0,facebook:!0,twitter:!0,google:!0,mail:!1,embed:!1}),n.bind("resume",b),jQuery(".learnRestartVideoBtn").on("click",function(){return x(),E.modal("hide"),!0}),!t||0===t.length)return c(),!0;for(var e=[],r=0;r<t.length;r++){for(var o={groupIndex:r,number:r+1,exercises:[]},s=0;s<t[r].length;s++)o.exercises.push({exerciseIndex:s});e.push(o)}var l=O.render("exerciseGroups",{groupsInfo:e});A.html(l),A.find(".exerciseGroupTabButton").on("click",function(){return jQuery(this).hasClass("disabled")?!1:void g(this.getAttribute("data-group-index"))}),C=A.find(".timelineExerciseBtn"),i.after(C)}function c(){B=!0,M.remove()}function d(e,i){if(B)return errorHandler.msg("error",new Error("Exercise group was triggered, but no exercise groups defined"),!1,{data:i}),!1;if(T[i.groupIndex])return!0;Q[i.groupIndex]=i.time;var r=A.find(".exerciseGroupTabButton.tabBtn"+i.groupIndex),o=A.find(".exerciseGroupContent.exerciseGroup"+i.groupIndex);_[i.groupIndex]=o,o.removeClass("disabled"),r.removeClass("disabled"),0===Object.keys(T).length&&(g(i.groupIndex),A.find(".initialExerciseGroupsText").remove());var a=t[i.groupIndex],s=u(i.groupIndex,i.time);T[i.groupIndex]=new View.VideoExercises.exerciseGroup(a,o,n,s,r,function(){j.restartExerciseGroup(i.groupIndex)}),i.userIsSeeking||h(i.groupIndex,i.time)}function u(e,t){var n=O.render("exerciseKnobOnVideo"),r=jQuery(n);return S[e]=r,r.css("left",f(t)+"%"),i.append(r),r.css("left",parseInt(r.css("left"))-r.width()/2),r.on("click",function(t){m(e)}),r}function h(e,t){p(),C.on("click",function(){m(e)});var n=jQuery(jQuery(".exerciseKnobOnVideo").get(e)),i=parseInt(n.css("left"))-C.width()/2+parseInt(n.width())/2;C.css("left",i),C.show(),I=setTimeout(function(){p()},P)}function f(e){var t=n.video.duration,i=100*e/t;return i}function p(){C.hide(),C.off("click"),I&&(clearTimeout(I),I=null)}function m(e){g(e),p(),M.trigger("click"),
v()}function g(e){y(),_[e].removeClass("hidden"),A.find(".exerciseGroupTabButton.tabBtn"+e).addClass("open")}function v(){n.pause(),jQuery("html, body").animate({scrollTop:i.offset().top-70},1e3,"easeOutCubic")}function y(){for(var e in _)_[e].addClass("hidden"),A.find(".exerciseGroupTabButton").removeClass("open")}function b(){if(a===!0&&jQuery(s).hide(),View.VideoExercises.exerciseGroup.resumedInternally===!0)return delete View.VideoExercises.exerciseGroup.resumedInternally,!1;for(var e in T)T[e].showGroupResults()}function w(){E.modal("show")}function k(){a===!0&&jQuery(s).show()}function x(){if(n.seek(.1),!B){for(var e in T)T[e].start();g(0),M.trigger("click")}}var C,j=this,T={},_={},S={},I=null,P=15e3,M=jQuery(r),Q={},B=!1,E=jQuery(o).modal({classes:"customPopup",close:!0,align:jQuery(".contentContainerInsider")}),O=new Handler.Template("videoSeries"),A=jQuery(e);return 0===A.length&&errorHandler.msg("error",new Error("container not found"),!0,{container:A}),j.restartExerciseGroup=function(e){var t;if(0===e)t=0;else{var i=e-1;if(!Q.hasOwnProperty(i))return!1;t=Q[i]}n.seek(t)},l(),j},View.VideoExercises.exerciseGroup=function(e,t,n,i,r,o){var a,s,l,c="started",d="finished",u="results",h=this,f=e,p={},m={},g=new Handler.Template("videoSeries");if(t instanceof jQuery)var v=t;else{""===t&&errorHandler.msg("error",new Error("no group container given"),!0);var v=jQuery(t)}return 0===v.length&&errorHandler.msg("error",new Error("group container not found"),!0,{container:t}),h.init=function(){v.find(".continueVideo").on("click",function(){h.continueVideo()}),v.find(".restartChapter").on("click",function(){h.restartChapter()}),h.start()},h.start=function(){a=c,l=0,h.showExercise(l),s=!1,i.removeClass("undone"),i.removeClass("done"),r.removeClass("success"),r.removeClass("fail"),r.addClass("enabled"),v.find(".afterExerciseGroupDialog").hide()},h.showExercise=function(e){var t=f[e],n=v.find(".exerciseContent.exercise"+e);p[e]=n,h.showExerciseContainer(e),t.exerciseOrder=e+1+"/"+f.length;var i=PuzzleFactory(n,t);i.on("success",function(t){h.exerciseSucceded(e)}),i.on("failure",function(t){h.exerciseFailed(e)}),i.start(),m[e]=i},h.showExerciseContainer=function(e){h.hideAllExerciseContainers(),p[e].show()},h.hideAllExerciseContainers=function(){v.find(".exerciseContent").hide()},h.exerciseSucceded=function(e){h.showExerciseResult(e,!0)},h.exerciseFailed=function(e){s=!0,h.showExerciseResult(e,!1)},h.showExerciseResult=function(e,t){if(m[e].stop(),p[e].find(".puzzleSubmitBtn").remove(),h.sendExerciseResult(e,t),p[e].find(".styleWrapper").addClass(t===!0?"correct":"incorrect"),e===f.length-1)v.find(".afterExerciseGroupDialogSuccess").hide(),v.find(".afterExerciseGroupDialogError").hide(),s?(v.find(".afterExerciseGroupDialogError").show(),i.addClass("undone"),r.addClass("fail"),r.removeClass("enabled")):(v.find(".afterExerciseGroupDialogSuccess").show(),i.addClass("done"),r.addClass("success"),r.removeClass("enabled")),v.find(".afterExerciseGroupDialog").show(),a=d;else{var n=g.render("nextExerciseBtn"),o=jQuery(n);o.click(function(){l++,h.showExercise(l)}),p[e].find(".puzzleButtonContainer").append(o)}},h.sendExerciseResult=function(e,t){var n={exercise:f[e].id,result:t,answer:m[e].getAnswer(),csrf:config.csrf()};jQuery.ajax({url:jQuery('link[rel="js-exerciseresultapi-setresult"]').attr("href"),data:n,error:function(e,t,i){errorHandler.msg("error",new Error("Exercise result was not saved"),!1,{resultData:n,textStatus:t})},cache:!1,type:"POST"})},h.continueVideo=function(){h.showGroupResults(),h.hideAfterExerciseGroupDialog(),h.scrollTopAndPlay()},h.restartChapter=function(){h.hideAfterExerciseGroupDialog(),"function"==typeof o&&o(),h.scrollTopAndPlay(),h.start()},h.scrollTopAndPlay=function(){var e=!0;jQuery("html, body").animate({scrollTop:0},500,function(){return e!==!0?!0:(e=!1,View.VideoExercises.exerciseGroup.resumedInternally=!0,void(n.paused?n.play():n.trigger("resume")))})},h.hideAfterExerciseGroupDialog=function(){v.find(".afterExerciseGroupDialog").hide()},h.showGroupResults=function(){return a!==d?!1:(a=u,v.find(".puzzleButtonContainer").remove(),void v.find(".exerciseContent").show())},h.init(),h},"undefined"==typeof View&&(View={}),View.Video=function(e,t,n,i,r,o){function a(){O.seek(0),Handler.tracking("video","start")}function s(){E.before('<div class="clear" />'),E.addClass("videoControl gameVideoControl");var e=jQuery('<b class="cTooltipBox position-top onClick burgerMenu"/>').append(jQuery('<a class="gameVideoControlIcon cIcon cIconBurger"/>')).append(jQuery('<span class="cTooltipBoxContainer"/>').append(jQuery("<ul/>").append(jQuery("<li/>").append('<a class="flipBoard cIcon cIconFlipBoard" data-pattern-icon="true">'+window.t("flip board")+"</a>")).append(jQuery("<li/>").append('<a class="playPosition cIcon cIconPosition" data-pattern-icon="true">'+window.t("Play this position")+"</a>")).append(jQuery("<li/>").append('<a class="settings cIcon cIconSettings" data-pattern-icon="true">'+window.t("Settings")+"</a>"))));jQuery("<ul/>").append(jQuery("<li/>").append(e)).appendTo(E),layout.tooltipOnClick(e),w=new View.FlipBoard(e.find("a.flipBoard")),e.find("a.settings").on("click",function(){(new Dialog.PlayzoneSettings).getContent().modal("show")}),e.find("a.playPosition").on("click",function(){if(y){var e=y.getClockInformation(),t={clock:{white:e.white.timeLeft,black:e.black.timeLeft},increment:e.white.incrementPerMove||e.black.incrementPerMove||0,fen:y.toString()};new Dialog.Engine(t)}});var t=jQuery("<li />").appendTo(E);t.wrap("<ul />"),b=new View.Cursor(t),E.find(".chess-cursor").addClass("cursorView stylePlain"),E.find(".chess-cursor .start").attr("title",window.t("Go to first move")),E.find(".chess-cursor .prev").attr("title",window.t("Go to previous move")),E.find(".chess-cursor .next").attr("title",window.t("Go to next move")),E.find(".chess-cursor .last").attr("title",window.t("Go to last move")),E.find(".iconSettings").attr("title",window.t("Board settings")),E.find(".iconFlipBoard").attr("title",window.t("Flip board"));var n=B.find(".fp-ui");E.append('<ul class="ulPlaySet" />'),E.append('<ul class="ulSoundSet last" />'),j=n.find(".fp-play"),E.find(".ulPlaySet").append(j),j.text("Play/Resume").addClass("gameVideoControlIcon iconPlay"),j.wrap('<li style="padding: 3px 10px 0 0;"></li>');var i=n.find(".fp-timeline");E.find(".ulPlaySet").append(i),i.wrap('<li style="padding: 10px 20px 0;"><div class="timelineContainer"></div></li>');var r=n.find(".fp-time");E.find(".ulPlaySet").append(r),r.wrap("<li />"),r.children(".fp-elapsed").after('<em class="fp-seperator">/</em>');var o=n.find(".fp-volumeslider");return E.find(".ulSoundSet").append(o),o.wrap('<li style="padding: 19px 5px 0 0;" />'),C=n.find(".fp-mute"),E.find(".ulSoundSet").append(C),C.text("Mute").addClass("gameVideoControlIcon "),C.wrap("<li />"),g(),jQuery(".gameVideoControl .fp-timeline .fp-progress:after").css("left","30%"),T}function l(e,t){return e.resultingPosition?e.resultingPosition.contains(t)||e.resultingPosition.push(t):e.resultingPosition=[t],T}function c(e){switch(e.name){case"selectGame":n.setCurrentGame(e.data.gameIndex),y.setCurrentGame(e.data.gameIndex),void 0!==e.data.initialMoveId?d(e.data.initialMoveId,e):x=y.getCurrentPosition();break;case"move":y.moveSep(e.data.move,x,!0,e.data.id,"remote"),n.moveSep(e.data.move,x.knotId,!0,e.data.id,"remote"),x=y.getCurrentPosition(),l(e,x);break;case"gotoId":d(e.data.id,e);break;case"highlightSquare":var t={color:e.data.color,frame:Chess.getSquare(e.data.y,e.data.x)};y.addHighlight(t,void 0,P);break;case"unmark":var i={frame:Chess.getSquare(e.data.y,e.data.x)};y.deleteHighlight(i,void 0,P);break;case"unmarkAll":y.deleteHighlightsByType("frame",void 0,P);break;case"drawArrow":var t={color:e.data.color,line:Chess.translate.canToMove(e.data.lineAsCan)};y.addHighlight(t,void 0,P);break;case"unarrow":var i={line:Chess.translate.canToMove(e.data.lineAsCan)};y.deleteHighlight(i,void 0,P);break;case"unarrowAll":y.deleteHighlightsByType("line",void 0,P);break;case"clearAllHighlights":var r=y.getAllPositions();for(var o in r)y.setHighlights([],r[o],P);Q[y.getCurrentGameKey()]=!0;break;case"triggerExerciseGroup":y.emit("triggerExerciseGroup",{groupIndex:e.data.index,time:e.time,userIsSeeking:I})}return k=e.index,S=e.index+1,T}function d(e,t){var i=!y.getPositionByKnotId(e);if(i){for(var r=n.getPositionByKnotId(e),o=[r],a=r;!y.getPositionByKnotId(a.parentMove.knotId);)o.push(a.parentMove),a=a.parentMove;for(;o.length;){var s=o.pop();if(y.move(s.moveCoords,s.parentMove.knotId,!1,s.knotId,"remote"),s.hasGlyphes()&&y.setGlyphes(s.getGlyphes(),s.knotId),s.comment&&y.setComment(s.comment,s.knotId),Q[y.getCurrentGameKey()]!==!0){var c=s.getHighlights();c&&y.setHighlights(c,s.knotId,P)}for(var d=y.getPositionByKnotId(s.knotId),u=d.parentMove.childrenMoves,h=u.length-1;h>=0;h--){var f=u[h];f!==d&&f.moveCoords.isNullMove()&&y.deleteMove(f,!0)}if(d.countChildrenMoves()){var p=y.getNextFreeKnotId();y.move(Chess.getMove(0,0,0,0),d,void 0,p,"remote",!0),y.promote(p)}var m=y.getPositionByKnotId(s.knotId);l(t,m);var g=s.parentMove.childrenMoves.indexOf(s),v=m.parentMove.childrenMoves.indexOf(m);v>g&&0===g&&y.promote(m)}}var b=y.getCurrentGameKey();if(void 0===M[b]&&(M[b]=[]),void 0===M[b][e]&&(M[b][e]=e,Q[b]!==!0)){var w=n.getHighlights(e);y.setHighlights(w,e,P)}y.gotoId(e),x=y.getCurrentPosition(),l(t,x)}function u(e,t,n,r){if(n.index===k&&r!==!0)return T;for(y.off("movedPositionPointer.current",h),n.index<S&&(S=0,M={},Q={}),P=!0;n.index>S;)c(i[S]);return P=!1,c(n),y.on("movedPositionPointer.current",h),T}function h(e,t){return _=!0,O.playing&&O.pause(),T}function f(e,t){if(j.removeClass("iconPlay").addClass("iconPause"),Handler.tracking("video","play"),_){_=!1;var n=S-1;S=1/0,u(e,t,i[n],!0)}return T}function p(e,t,n){I=!0;for(var r=0;r<i.length&&!(i[r].time>n);r++)var o=i[r];return o&&u(e,t,o),I=!1,T}function m(){j.removeClass("iconPause").addClass("iconPlay"),Handler.tracking("video","pause")}function g(){O.muted?C.removeClass("iconUnmute").addClass("iconMute"):C.removeClass("iconMute").addClass("iconUnmute")}function v(){y.emit("triggerEndOfVideo"),Handler.tracking("video","finished")}var y,b,w,k,x,C,j,T=this,_=!1,S=0,I=!1,P=!1,M={},Q={},B=jQuery(e);0===B.length&&errorHandler.msg("error",new Error("container not found"),!0,{container:B});var E=jQuery(t);0===E.length&&(E=void 0),Extend.Subscriber(T,{"movedPositionPointer.current":h},{afterLink:function(e){y=e.publisher,b&&b.link(y),w&&w.link(y),x=y.getCurrentPosition()}}),B.flowplayer({playlist:[r],cuepoints:i,fullscreen:!1,embed:!1,poster:o}),B.bind("cuepoint",u).bind("seek",p).bind("resume",f).bind("pause",m).bind("mute",g).bind("finish",v).bind("ready",a);var O=B.data("flowplayer");return B.find(".fp-timeline").data("api").disableAnimation(),E&&s(),T},"undefined"==typeof Widgets&&(Widgets={}),Widgets.Audio=Widgets.Base().extend({properties:{"float":"none"},create:function(e,t,n){e=this.parent.create(e,t,n);var i=e.find(".sound");if(i.length){var r=jQuery.parseJSON(i.attr("data"));i.soundPlayer({url:r.url})}return e.trigger("resize"),e}}),"undefined"==typeof Widgets&&(Widgets={}),function(e){Widgets.Image?e():setTimeout(e)}(function(){Widgets.Author=Widgets.Image().extend({properties:{"float":"none",width:"auto"},create:function(e,t,n){var i=e.data("widget"),r=e.find("img");return r.attr("src")||jQuery.getJSON("/api/web/contentWidgetAPI/getImageUrl?id="+i.resources[0].reference_id,function(e){r.attr("src",e.data.url)}),e},dialog:function(e,t,n,i,r){e=this.parent.dialog(e,t,n,i,r),e.find("#author-widget-cid").val(n.formData.cid);var o=r.data("widget").resources[0].properties.title;return r&&o&&(e.find("select option[value="+o+"]").attr("selected","selected"),e.find("select").selectBox("destroy").selectBox()),e}})}),"undefined"==typeof Widgets&&(Widgets={}),Widgets.BiographyLink=Widgets.Base().extend(function(){var e;return{properties:{biography_id:null,biography_name:null,text:null},setupInEditor:function(e,t){var n=jQuery.parseJSON(e.attr("data"));e.off("dblclick").on("dblclick",function(){t.extensions.widgets.editWidget(e)}),e.on("change",function(){var t=e.clone().find("span").remove().end().html().trim();if(n.text!==t){var i=e.data("widget");i.properties.text=t,e.attr("data-widget",jQuery.toJSON(i)),n.text=e.html(),e.attr("data",jQuery.toJSON(n))}})},setupOffEditor:function(e){},dialog:function(e,t,n,i,r){t.extensions.link&&t.extensions.link.formOptions(e,r,"biography-link");var o=e.find("[data-widget-property=text]");o.val()||o.val(r.text()),e.find("[data-auto-suggest]").on("chess24:select",function(){e.find("[data-widget-property=biography_id]").val(this.value),e.find("[data-widget-property=biography_name]").val(e.find("input.suggestField[type=text]").val())});var a=e.find("input[data-widget-property=text]");a.val()||a.val(r.clone().find("span").remove().end().html().trim())},create:function(t,n,i){n&&(e=n,t.addClass("unusual-link"));jQuery.parseJSON(t.attr("data")),t.data("widget");return n?this.setupInEditor(t,n):this.setupOffEditor(t),t}}}()),"undefined"==typeof Widgets&&(Widgets={}),Widgets.Broadcast=Widgets.Base().extend({properties:{"float":"none",type:"",c24:!1,tournamentId:"",roundId:"",matchId:""},create:function(e,t,n){function i(){var e,t=s.getAttribute(r.properties.tournamentId,"currentRound");switch(r.properties.roundId=parseInt(r.properties.roundId,10)||void 0,r.properties.type){case"OpenStandings":e=new View.OpenStandings(o,r.properties.tournamentId);break;case"OpenGames":e=new View.OpenGames(o,r.properties.tournamentId,r.properties.roundId||t,!0);break;case"TeamRoundRobin":e=new View.TeamRoundRobin(o,r.properties.tournamentId,r.properties.roundId||t);break;case"Header":var n=s.getAttribute(r.properties.tournamentId,"video");o.html(a.getTemplates().render("tournament.header",{tournamentId:r.properties.tournamentId,languages:(n||[]).map(function(e){return e.language}).unique()})),e=new View.Header(o,r.properties.tournamentId,r.properties.roundId||t);break;case"MultiBoard":e=new View.MultiBoard(o,r.properties.tournamentId,r.properties.roundId||t,r.properties.matchId||1).setItemsPerPage(6);break;case"StandingsTable":e=new View.StandingsTable(o,r.properties.tournamentId,r.properties.roundId)}e.link&&e.link(s),e.resume&&e.resume()}e=this.parent.create(e,t,n);var r=e.data("widget"),o=e.find(".broadcastWidgetContainer"),a=new Controller.Broadcast(o,{norender:!0}),s=new Controller.BroadcastTournament,l=Handler.socket.getSocket(Handler.socket.types.NOTIFICATION),c=1==r.properties.c24?"model:PlayzoneTournamentRedisAR":"model:webTournamentRedisAR",d=c+":"+r.properties.tournamentId,u={type:c,id:r.properties.tournamentId,rkey:d},h=new Record.TournamentSocketPR(u,l,function(){s.add(h,r.properties.tournamentId),i()});return e},dialog:function(e,t,n,i,r){e=this.parent.dialog(e,t,n,i,r);var o=e.find("select"),a=e.find(".selectRound"),s=e.find(".selectMatch");if(r){var l=r.data("widget");o.find("option[value="+l.properties.type+"]").attr("selected","selected"),o.selectBox("destroy").selectBox()}return o.on("change",function(){var e=o.val();a.toggle(["MultiBoard","OpenGames","TeamRoundRobin","StandingsTable"].contains(e)),s.toggle(["MultiBoard","OpenGames"].contains(e))}).trigger("change"),e}}),"undefined"==typeof Widgets&&(Widgets={}),Widgets.ChessBoard=Widgets.ChessView().extend({properties:{"float":"left",width:"648px",name:"",index:"",fen:"",highlights:""},dialog:function(e,t,n,i,r){e=this.parent.dialog(e,t,n,i,r);var o=this.chessBase;o.init(t.config.chessGames);var a=n.extensions&&n.extensions.contains("widgets(chessboard)");a&&e.find(".cBtn.back").remove();var s,l=e.find("[data-resource-property=reference_id]"),c=e.find("[data-widget-property=index]"),d=e.find("[data-widget-property=fen]"),u=e.find("[data-widget-property=highlights]");l.val()||c.val()||d.val()||d.val(Chess.defaultFen);var h=o.getGames();if(l.find("*").remove().end().append("<option/>"),h)for(var f in h)l.append(jQuery("<option/>").val(f).html(h[f].getTitle()));l.selectBox("destroy").selectBox(),l.find("option").length>1?(c.on("change",function(){c.val()&&(s.gotoId(c.val()),d.val(s.getCurrentPosition().toString(!0)))}),l.on("change",function(){var e=l.val();l.val()?(d.val(""),s.addGame(e,h[e]).setCurrentGame(e)):s.setCurrentGame("position-builder"),c.find("*").remove().end().append("<option/>");var t=o.getGame(this.value);if(t){var n=function(e,t){var n=e.getSan();n=n?("w"==e.moveRight?e.moveCounter-1+"... ":e.moveCounter+". ")+n:window.t("Top"),c.append(jQuery("<option/>").val(e.knotId).html(t+n))},i=function(e,t){n(e[0],t);for(var r=1;r<e.length;r++)n(e[r],t+"&raquo;&nbsp;"),e[r].childrenMoves&&e[r].childrenMoves.length&&i(e[r].childrenMoves,t+"&nbsp;&nbsp;&nbsp;");e[0].childrenMoves&&e[0].childrenMoves.length&&i(e[0].childrenMoves,t)},r=t.getStartPosition();r.childrenMoves&&r.childrenMoves.length?i(r.childrenMoves,""):c.append(jQuery("<option/>").val(0).html("Start")),c.selectBox("destroy").selectBox()}})):e.find(".board-game-move").hide();var p=r?r.data("widget"):null;return e=t.extensions.chess.positionBuilder(e.find(".position-builder"),p&&p.properties.fen?p.properties.fen:void 0,p&&p.properties.highlights?jQuery.parseJSON(p.properties.highlights):void 0),e.on("chess24:change",function(e,t){d.val(t.fen),u.val(jQuery.toJSON(t.highlights)),l.val("").selectBox("destroy").selectBox(),c.find("option").not(":first").remove(),c.selectBox("destroy").selectBox()}),s=e.data("handler"),p&&p.resources&&p.resources[0]&&p.resources[0].reference_id&&(l.find("option[value="+p.resources[0].reference_id+"]").attr("selected","selected").end().trigger("change").selectBox("destroy").selectBox(),p.properties&&c.find("option[value="+p.properties.index+"]").attr("selected","selected").end().trigger("change").selectBox("destroy").selectBox()),e},create:function(e,t,n){e=this.parent.create(e,t,n);var i=e.data("widget"),r=parseInt(i.properties.viewId)||0,o=this.chessBase.getView(r),a=null;if(o&&(a=this.chessBase.getControllersForView(r),this.chessBase.unlinkView(r),delete o),e.find(".chess-board").remove(),o=new View.ChessBoard(e.find(".diagram"),!1),r=this.chessBase.addView(r,o),i.resources[0]&&i.resources[0].reference_id&&i.properties.index)this.chessBase.makeStaticView(r,i.resources[0].reference_id,i.properties.index),e.find(".widget-buttons").remove();else if(i.properties.fen)try{var s=new Chess.Game({fen:i.properties.fen});this.chessBase.unlinkView(r),o.link(s);var l=i.properties.highlights;if("string"==typeof l&&l.length&&(l=jQuery.parseJSON(l)),l)for(var c=0;c<l.length;c++)l[c].square?s.addHighlight({square:Chess.getSquare(l[c].square.y,l[c].square.x),color:l[c].color}):l[c].frame?s.addHighlight({frame:Chess.getSquare(l[c].frame.y,l[c].frame.x),color:l[c].color}):l[c].line&&s.addHighlight({line:Chess.getMove(l[c].line.y1,l[c].line.x1,l[c].line.y2,l[c].line.x2),color:l[c].color})}catch(d){}else if(a){this.chessBase.unlinkView(r);for(var u=!1,c=0;c<a.length;c++)"@static"!=a[c].substr(a[c].length-7)&&(u=!0,this.chessBase.linkView(r,a[c]));u||this.chessBase.linkView(r,"main")}else this.chessBase.linkView(r,"main");this.chessBase.isStaticView(r)&&e.on("click",function(){jQuery("."+i.resources[0].reference_id+"_"+i.properties.index).trigger("click")});var h=function(t,n){var r=e.width();o.resize(r),r=o.getJQueryBoard().width(),e.css({width:r+"px",height:i.properties.name?"auto":r+"px"})};return e.on("resize",h),h(),i.properties.viewId!=r&&(i.properties.viewId=r,e.attr("data-widget",jQuery.toJSON(i))),e}}),"undefined"==typeof Widgets&&(Widgets={}),Widgets.ChessBubble=Widgets.ChessView().extend({properties:{"float":"none",width:"100%",name:"",oneexercise:!1,hidetools:!1,hideinfo:!1,text:""},dialog:function(e,t,n,i,r){return e=this.parent.dialog(e,t,n,i,r)},remove:function(e,t,n){var i=e.data("widget"),r=parseInt(i.properties.viewId)||0,o=jQuery("nothing"),a=jQuery("nothing");if(t.find("a.unusual-link").each(function(){var e=jQuery(this);try{(e.data("widget").properties.views.contains(r)||e.data("widget").properties.views.contains(""+r))&&(a=e.closest("p"),0==o.length&&(o=jQuery(a)))}catch(t){}}),!a.length||!o.length)return!1;var s=jQuery("<div/>").addClass("popupInsider").append(jQuery("<div/>").addClass("dialogContent").html(window.t("Do you want to remove only the viewer or the text too?"))).append(jQuery("<div/>").addClass("dialogFooter"));return s.find(".dialogFooter").append(jQuery("<a/>").addClass("cBtn cBtnGrey").html("The viewer").on("click",function(){s.modal("hide"),e.remove(),t.rescueOrphans()})).append(jQuery("<a/>").addClass("cBtn cBtnGrey").html("Everything").on("click",function(){var n=o.add(o.nextUntil(a)).add(a),i=a.next();if(i.length)for(var r=i.text().trim(),l=["0-1","1-0","1/2-1/2","*"],c=0;c<l.length;c++)if(r==l[c]){n=n.add(i);break}n.remove(),e.remove(),s.modal("hide"),t.rescueOrphans()})).append(jQuery("<a/>").addClass("cBtn cBtnWhite").html("Cancel").on("click",function(){s.modal("hide")})),s.modal({classes:"defaultPopup"}).modal("show"),!0},create:function(e,t,n){function i(e){e.addClass("draggable").on("mousedown.chessbubble",function(t){var n=parseInt(e.css("left"),10),i=parseInt(e.css("top"),10);jQuery(document).on("mousemove.chessbubble",function(r){var o=r.pageX-t.pageX,a=r.pageY-t.pageY;e.css({top:i+a+"px",left:n+o+"px"})}).one("mouseup",function(){jQuery(document).off("mousemove.chessbubble")}),t.stopPropagation(),t.preventDefault()})}function r(e){e.removeClass("draggable").off("mousedown.chessbubble")}function o(i){if("undefined"==typeof i&&(i=l.properties.hidetools),u.toggleTools(i),i)e.css("height","").add(e.find(".chess-bubble, .bubble")).removeClass("compact").css("width",e.parent().width()+"px").trigger("resize");else{var r=e.find(".popup-board-board");e.css("height","").add(e.find(".chess-bubble, .bubble")).addClass("compact").css("width",r.width()+2*parseInt(r.css("left"),10)+"px").trigger("resize")}t&&(l.properties.hidetools=!i,e.attr("data-widget",jQuery.toJSON(l)),e.find(".toggleTools").html(window.t(i?"Hide tools":"Show tools")),i?t.extensions.resizable.reset(e):t.extensions.resizable.index(e,{}),Widgets.Base().create(e,t,n))}e=this.parent.create(e,t,n);var a=this,s=jQuery.parseJSON(e.attr("data")),l=e.data("widget"),c=parseInt(l.properties.viewId)||0;s.oneexercise=!!l.properties.oneexercise,s.exercises=null,s.games=[];for(var d=0;d<l.resources.length;d++)l.resources[d].properties.exercises&&(s.exercises||(s.exercises={}),s.exercises[l.resources[d].reference_id]=l.resources[d].properties.exercises),s.games.push(l.resources[d].reference_id);s.games.length<2&&(s.games=null),e.attr("data",jQuery.toJSON(s));var u=this.chessBase.getView(c),h=null;u&&(e.find(".bubble").remove(),h=this.chessBase.getControllersForView(c),this.chessBase.unlinkView(c),delete u);var f=s.exercises?this.chessBase.createCopyId():void 0,p=null;if(s.games){p={};for(var d=0;d<s.games.length;d++)p[s.games[d]]=this.chessBase.getGame(s.games[d],f)}if(u=new View.PositionDetails(e,p,{interactive:!t,text:l.properties.text,hideMeta:l.properties.hideinfo,url:t?"":Handler.Template.renderString(decodeURIComponent(e.data("url")),{articleId:e.closest(".couch-content").data("cid"),widgetId:l.vid})}),c=this.chessBase.addView(c,u),h){this.chessBase.unlinkView(c);for(var d=0;d<h.length;d++)this.chessBase.linkView(c,h[d])}else p&&this.chessBase.separateView(c,Object.keys(p));if(s.exercises)for(var m in s.exercises)0==s.exercises[m]&&delete s.exercises[m];if(s.exercises&&Object.getLength(s.exercises)){var g=[];for(var m in s.exercises)g.push(m);this.chessBase.separateView(c,g,f);for(var m in s.exercises){var v=this.chessBase.getGame(m,f);if(v){for(var y=v.getStartPosition(),b=[],w=[],d=0;d<s.exercises[m].length;d++)b.push(s.exercises[m][d][0]),w.push(s.exercises[m][d][1]);for(var k=[],x=!1,C=[];y;)w.contains(y.knotId)?(C.push(y.knotId),k.push(C),C=[],x=!1,y=y.childrenMoves[0]):(b.contains(y.knotId)&&(x=!0),x&&C.push(y.knotId),y=y.childrenMoves[0]);C.length&&k.push(C),k.length&&u.setExercises(m,k,!!s.oneexercise)}}}var j=u.getBubble().appendTo(e);if(o(1!=l.properties.hidetools),t){c!=l.properties.viewId&&(l.properties.viewId=c,e.attr("data-widget",jQuery.toJSON(l))),j.css({position:"static"}).trigger("resize",!0);var T=e.find(".widget-buttons");T.find(".toolsToggle").remove(),T.append(jQuery("<a/>").addClass("toggleTools").html(l.properties.hidetools?window.t("Show tools"):window.t("Hide tools")).on("click",function(){o()}))}else{var _=function(){var e=jQuery(document).data("current-bubble");if(e){if(e==u)return;e.toggleActive(!1)}e=u,s.oneexercise||s.games&&s.games.length>1?(e.toggleActive(!0),Widgets.ChessJumpToLink().disable()):Widgets.ChessJumpToLink().enable(),jQuery(document).data("current-bubble",e)},S=jQuery(document).data("current-bubble");S||_(),Widgets.ChessJumpToLink(),j.on("mousedown",_),e.on("chess24:activate",_),e.css("z-index",j.css("z-index")),j.on("collapse expand",function(){B||e.css("height",j.height()+"px")});var I=jQuery(".widgetcontainer"),P=[];I.each(function(){"chess-bubble"==jQuery(this).data("widget").wid&&P.push(jQuery(this))});var M=jQuery(".widgetcontainer-inline"),Q=e.hasClass("compact"),B=!1,E=function(t){var n=e.offset(),i=e.width(),r=e.height(),o=jQuery("div:visible,header:visible").filter(function(){var e=jQuery(this),t=e.offset();return!e.is(j)&&!e.is(j.closest(".bubble"))&&"fixed"==e.css("position")&&parseInt(e.css("top"),10)<=n.top+r&&t.left<n.left+i&&t.left+e.width()>n.left}),s=0;o.each(function(){s+=jQuery(this).outerHeight()});var l=null;M.filter(":visible").each(function(){var e=jQuery(this);if(e.attr("data")){var t=jQuery.parseJSON(e.attr("data"));"chess-jump-to-link"==t.wid&&(t.views&&(t.views.contains(c)||t.views.contains(""+c))||(!t.views||!t.views.length)&&a.chessBase.isViewLinked(c,"main"))&&(l=e)}});var d=n.top,u=d+r;if(l&&l.length&&(u=l.offset().top+l.height()),P.length>1)for(var h=0;h<P.length;h++)if(jQuery(P[h]).is(e)&&P.length-1>h){u=Math.min(u,jQuery(P[h+1]).offset().top-10);break}var f=jQuery(document).scrollTop()+s;if(Q)"absolute"!=j.css("position")&&j.css({position:"absolute",left:"0",top:"0"});else if(B){var p=jQuery(document).scrollTop(),m=j.offset().top;if("fixed"==j.css("position"))d>=m?j.css({position:"absolute",top:d+"px"}):m+j.height()>=u&&j.css({position:"absolute",top:u-j.height()+"px"});else if("absolute"==j.css("position")){var g=jQuery(window).height();g/3+p>d&&u>2*g/3+p&&(j.css({position:"fixed",top:j.offset().top-p}),e.css("position","static"))}}else"fixed"==j.css("position")?j.offset().top<d?(j.removeClass("fixed").css({position:"absolute",top:d-n.top+"px",left:"0px"}),e.css("position","relative")):f+j.height()>u?(j.removeClass("fixed").css({position:"absolute",top:u-j.height()-n.top+"px",left:"0px"}),e.css("position","relative")):j.css({left:n.left+"px"}):f+j.height()<=u?f>=d?(j.addClass("fixed").css({position:"fixed",top:s+"px",left:n.left+"px"}),e.css("position","static")):parseInt(j.css("top"))>0&&j.css("top","0px"):f>=d&&j.css({top:u-j.height()-n.top+"px"})};j.css({left:"0px",top:"0px"}),jQuery(window).on("scroll resize",E),e.on("chess24:lock chess24:unlock",function(t){Q="chess24:lock"==t.type||e.hasClass("compact"),e.find(".bubble-detach, .bubble-collapse, .bubble-expand").css("visibility",Q?"hidden":"visible"),E()}),p||jQuery("<a/>").addClass("bubble-detach").on("click",function(){var t=jQuery(this).closest(".bubble");if(B)B=!B,e.css("height",""),r(t.appendTo(e).css({left:0,top:0,position:"absolute"})),o(!0),E();else{o(!1),B=!B,e.css("height",0);var n=t.offset().left+t.width(),a=t.offset().top-jQuery(document).scrollTop();i(t.appendTo("body").css({left:n+"px",top:a+"px",position:"fixed"})),E()}}).appendTo(e.find(".bubble-contents"))}return delete a,e}}),"undefined"==typeof Widgets&&(Widgets={}),Widgets.ChessJumpToLink=Widgets.Chess().extend(function(){var e,t=null,n=null,i={},r=!1,o=function(e){switch(document.activeElement.tagName.toLowerCase()){case"input":case"textarea":return}if(!r){r=!0,setTimeout(function(){r=!1},100);var t=Widgets.Base();switch(e.keyCode){case t.keys.VK_LEFT:jQuery(document).trigger("chess24:previousmove");break;case t.keys.VK_RIGHT:jQuery(document).trigger("chess24:nextmove");break;case t.keys.VK_UP:if(n){n.up();try{e.preventDefault(),e.stopPropagation()}catch(i){e.cancelBubble=!0,e.returnValue=!1}}break;case t.keys.VK_DOWN:if(n){n.down();try{e.preventDefault(),e.stopPropagation()}catch(i){e.cancelBubble=!0,e.returnValue=!1}}break;case t.keys.VK_ESCAPE:n&&(n.remove(),n=null);break;case t.keys.VK_RETURN:n&&(n.select(),n=null)}}},a=function(e,t){return function(){var n=jQuery.parseJSON(jQuery(this).attr("data"));return n.reference==e&&(!t||0>t&&n.index<-t||t>0&&n.index>=t)}},s=function(e,t,n){if(i[e]||i.all)return!1;var r=jQuery("."+e+"_"+t);return r.length?r.trigger("click").length>0:"forward"==n?jQuery("a.jump-to-link").filter(a(e,t)).first().trigger("click").length>0:"back"==n?jQuery(jQuery("a.jump-to-link").toArray().reverse()).filter(a(e,-t)).first().trigger("click").length>0:!1},l=function(e){if(e&&t&&t.length){var n=jQuery.parseJSON(t.attr("data"));n.reference!=e&&(t.removeClass("highlighted"),t=null)}},c=function(e){for(var t=jQuery.parseJSON(e.attr("data")),n=Widgets.Chess().chessBase,i=[],r=0;r<t.views.length;r++)for(var o=n.getControllersForView(t.views[r]),a=0;a<o.length;a++)i.contains(o[a])||i.push(n.getController(o[a]));return i.length||i.push(n.getController("main")),i},d=function(e,r){if(!i[r]&&!i.all)if(l(r),t&&t.length){var o=Widgets.Chess().chessBase,c=jQuery.parseJSON(t.attr("data"));if(r||(r=c.reference,!i[r])){if(n)return n.select(),void(n=null);var d=o.getMoveByKnotId(c.reference,c.index);if(d){var u=[];if(d.children&&d.children.length){if(1==d.children.length){var h=o.getMoveByIndex(c.reference,d.children[0]).knotId;return void s(c.reference,h,"forward")}for(var f=0;f<d.children.length;f++){var p=o.getMoveByIndex(c.reference,d.children[f]);jQuery("."+c.reference+"_"+p.knotId).length&&u.push(p)}}else for(var m=c.index;;){var g=o.getParentMoveByKnotId(c.reference,m);if(!g)break;for(var v=0;v<g.children.length&&o.getMoveByIndex(c.reference,g.children[v]).knotId!=m;v++);if(0!=v){var y=o.getMoveByIndex(c.reference,g.children[0]);if(y.children.length){if(1==y.children.length){var b=o.getMoveByIndex(c.reference,y.children[0]);return void s(c.reference,b.knotId,"forward")}for(var f=0;f<y.children.length;f++){var p=o.getMoveByIndex(c.reference,y.children[f]);jQuery("."+c.reference+"_"+p.knotId).length&&u.push(p)}break}m=g.knotId;break}m=g.knotId}if(1==u.length)s(c.reference,u[0].knotId,"forward");else if(u.length>0){for(var w=[],f=0;f<u.length;f++){var k=u[f].fen.split(" "),x=jQuery("."+c.reference+"_"+u[f].knotId).text();x=x.replace(/^\d+\.+ +/,""),x=k[5]-("w"==k[1]?1:0)+("w"==k[1]?"... ":". ")+x,w.push({id:u[f].knotId,text:x})}n=new popupList(w,function(e){s(r,e,"forward")})}else s(c.reference,parseInt(c.index)+1,"forward")}}}else if(r)jQuery("a.jump-to-link").filter(a(r)).first().trigger("click");else{var C=jQuery("a.jump-to-link:first");if(!C.length)return;if(r=jQuery.parseJSON(C.attr("data")).reference,i[r])return;C.trigger("click")}},u=function(e,r){if(!i[r]&&!i.all&&(n&&(n.remove(),n=null),l(r),t&&t.length)){var o=Widgets.Chess().chessBase,a=jQuery.parseJSON(t.attr("data"));if(r||(r=a.reference,!i[r])){var c=o.getParentMoveByKnotId(a.reference,a.index);c&&c.knotId>0?s(a.reference,c.knotId,"back")||h(e,r):h(e,r)}}},h=function(e,r){if(!i[r]&&!i.all&&(n&&(n.remove(),n=null),l(r),t&&t.length||(t=jQuery("a.jump-to-link").filter(a(r)).first(),t.length))){var o=c(t);t.removeClass("highlighted"),t=null;for(var s=0;s<o.length;s++)o[s].gotoStart()}},f=function(e,r){if(!i[r]&&!i.all&&(n&&(n.remove(),n=null),l(r),t&&t.length||(t=jQuery("a.jump-to-link").filter(a(r)).first(),t.length))){var o=c(t);t.removeClass("highlighted"),t=null;for(var s=0;s<o.length;s++)o[s].gotoEndOfLine()}},p=function(){jQuery(document).off("keydown",o).on("keydown",o).off("chess24:nextmove",d).on("chess24:nextmove",d).off("chess24:previousmove").on("chess24:previousmove",u).off("chess24:firstmove",h).on("chess24:firstmove",h).off("chess24:lastmove",f).on("chess24:lastmove",f).on("chess24:suspendmoves",function(e,t){
i[t]=!0}).on("chess24:resumemoves",function(e,t){i[t]=!1})};return jQuery(function(){!jQuery("[contenteditable]").length&&jQuery(".couch-content").length&&p()}),{properties:{index:null,text:null,glyph:null,sideline:null,views:[]},disable:function(){i.all=!0},enable:function(){i.all=!1,p()},getDialogButtons:function(t){var n=this,i={};return i[window.t("Save")]=function(i){var r=jQuery.parseJSON(jQuery(t).attr("data"));r.reference=i.reference,r.index=i["properties[index]"];var o=i["properties[views][]"],a=[];if(r.views&&o)for(var s=0;s<r.views.length;s++)-1==o.indexOf(r.views[s])&&a.push(r.views[s]);else r.views&&(a=r.views);if(o){for(var s=0;s<o.length;s++)-1==r.views.indexOf(o[s])&&n.chessBase.separateView(o[s],[r.reference]);r.views=o}else r.views=[];jQuery(t).attr("data",jQuery.toJSON(r)),a.length&&n.chessBase.checkSeparatedViews(a,e),e.extensions.widgets.save(i,jQuery(t)),e.extensions.dom.setSelection(t,t)},i[window.t("Delete")]=function(i){var i=jQuery.parseJSON(jQuery(t).attr("data")),r=t.parentNode;jQuery(t).replaceWith(jQuery(t).contents()),e.extensions.dom.flatten(r),e.extensions.dom.setCursor(r,0),i.views&&n.chessBase.checkSeparatedViews(i.views,e)},i[window.t("Cancel")]=function(){e.extensions.dom.setCursor(t,0)},i},setupInEditor:function(e,t){var n=jQuery.parseJSON(e.attr("data"));e.off("dblclick").on("dblclick",function(){t.extensions.widgets.editWidget(e)}),e.on("change",function(){var t=e.clone().find("span").remove().end().html().trim();if(n.text!=t){var i=e.data("widget");i.properties.text=t,e.attr("data-widget",jQuery.toJSON(i)),n.text=e.html(),e.attr("data",jQuery.toJSON(n))}})},setupOffEditor:function(e){},setupHighlight:function(e){var n=jQuery.parseJSON(e.attr("data")).reference;e.off("highlight").on("highlight",function(){if((!t||t&&!t.is(e))&&(t&&t.removeClass("highlighted"),t=e,t.addClass("highlighted")),e.is(":visible")&&!(i[n]||i.all||e.closest(".nativeScroll").length||e.closest(".ebookScroll").length)){var r=jQuery(document).scrollTop()+jQuery(window).height()-e.offset().top-e.height(),o=0;jQuery(".widgetcontainer .bubble").each(function(){var e=jQuery(this);"fixed"==e.css("position")&&(o=Math.max(o,e.offset().top+e.height()))}),o=e.offset().top-o,50>r?jQuery("html,body").stop().animate({scrollTop:jQuery(document).scrollTop()+(50-r)},200):15>o&&jQuery("html,body").stop().animate({scrollTop:jQuery(document).scrollTop()-(15-o)},200)}})},dialog:function(e,t,n,i,r){var o=this;t.extensions.link&&t.extensions.link.formOptions(e,r,"chess-jump-to-link"),e.find("a.restore").on("click",function(){if(t.extensions.chess&&r.length>0){var e=r.attr("data");t.extensions.chess.restoreLink(r.get(0)),e&&(e=jQuery.parseJSON(e),e.views&&o.chessBase.checkSeparatedViews(e.views,t))}});var a=this.chessBase;a.init(t.config.chessGames);var s=e.find("[data-resource-property=reference_id]"),l=e.find("[data-widget-property=index]"),c=a.getGames();if(s.find("*").remove().end().append("<option/>"),c)for(var d in c)s.append(jQuery("<option/>").val(d).html(c[d].getMeta().Title));s.selectBox("destroy").selectBox(),s.on("change",function(){l.find("*").remove().end().append("<option/>");var e=a.getGame(this.value);if(e){var t=function(e,t){var n=e.getSan();n=n?("w"==e.moveRight?e.moveCounter-1+"... ":e.moveCounter+". ")+n:window.t("Top"),l.append(jQuery("<option/>").val(e.knotId).html(t+n))},n=function(e,i){t(e[0],i);for(var r=1;r<e.length;r++)t(e[r],i+"&raquo;&nbsp;"),e[r].childrenMoves&&e[r].childrenMoves.length&&n(e[r].childrenMoves,i+"&nbsp;&nbsp;&nbsp;");e[0].childrenMoves&&e[0].childrenMoves.length&&n(e[0].childrenMoves,i)},i=e.getStartPosition();n(i.childrenMoves,""),l.selectBox("destroy").selectBox()}});var u=null;if(r){var h=r.data("widget");h&&(h.resources&&h.resources[0]&&h.resources[0].reference_id&&(s.find("option[value="+h.resources[0].reference_id+"]").attr("selected","selected").end().trigger("change"),h.properties&&l.find("option[value="+h.properties.index+"]").attr("selected","selected")),u=h.properties.views)}var f=e.find(".jump-to-link-views");t.find(t.widgetmask).each(function(){var e=jQuery(this).data("widget");("chess-bubble"==e.wid||"chess-board"==e.wid)&&f.append(jQuery("<div/>").addClass("chess-view").attr("data",e.properties.viewId).append(jQuery('<input type="checkbox"/>').attr("data-widget-property","views[]").val(e.properties.viewId).attr("checked",u&&u.contains(e.properties.viewId))).append(jQuery("<div/>").html(e.properties.name)))}),jQuery(document).trigger("newhtml");var p=e.find("input[data-widget-property=text]");p.val()||p.val(r.clone().find("span").remove().end().html().trim()),jQuery(document).trigger("newhtml")},create:function(t,r,o){r&&(e=r,t.addClass("unusual-link"));var a=jQuery.parseJSON(t.attr("data")),s=t.data("widget");if(a.views=(a.views||[]).concat(s.properties.views),t.attr("data",jQuery.toJSON(a)),t.is(".sideline-0")&&t.removeClass("sideline sideline-0"),a.views){for(var l=0;l<a.views.length;l++)a.views[l]=/^\d$/.test(a.views[l])?parseInt(a.views[l]):a.views[l],this.chessBase.separateView(a.views[l],[a.reference]);t.attr("data",jQuery.toJSON(a))}return t.off("click").on("click",function(){var e=jQuery(this),t=jQuery.parseJSON(e.attr("data"));if(!i[t.reference]){t.index=parseInt(t.index);var o=c(e);!r&&t.views&&t.views.length&&jQuery(".widgetcontainer").filter(function(){return jQuery(this).data("widget").properties.viewId==t.views[0]}).trigger("chess24:activate");for(var a=0;a<o.length;a++)o[a].setCurrentGame(t.reference).gotoId(t.index);n&&(n.remove(),n=null)}}),r?this.setupInEditor(t,r):this.setupOffEditor(t),r||this.setupHighlight(t),t}}}()),"undefined"==typeof Widgets&&(Widgets={}),Widgets.EbookExercise=Widgets.Base().extend({properties:{title:""},create:function(e,t,n){return e=this.parent.create(e,t,n),e.on("click",function(){jQuery(".exercises-from-"+e.data("widget").vid).trigger("chess24:show",!0)}),e}}),"undefined"==typeof Widgets&&(Widgets={}),Widgets.EbookLink=Widgets.Chess().extend(function(){var e;return{properties:{ebook_chapter_id:null,section_id:null,text:null},setupInEditor:function(e,t){var n=jQuery.parseJSON(e.attr("data"));e.off("dblclick").on("dblclick",function(){t.extensions.widgets.editWidget(e)}),e.on("change",function(){var t=e.clone().find("span").remove().end().html().trim();if(n.text!=t){var i=e.data("widget");i.properties.text=t,e.attr("data-widget",jQuery.toJSON(i)),n.text=e.html(),e.attr("data",jQuery.toJSON(n))}})},setupOffEditor:function(e){},dialog:function(e,t,n,i,r){t.extensions.link&&t.extensions.link.formOptions(e,r,"ebook-link");var o,a,s,l;jQuery.getJSON("/api/web/ContentAPI/getEbooks",{language:n.language},function(t){o=t.data.ebooks;var n=e.find("[data-widget-property=text]");n.val()||n.val(r.text());var i=e.find("select:first"),c=e.find("[data-widget-property=ebook_chapter_id]"),d=e.find("[data-widget-property=section_id]");o.forEach(function(e){i.append(jQuery("<option/>").val(e.id).html(e.title))}),i.selectBox("destroy").selectBox();var u=function(){c.find("*").remove(),d.find("*").remove(),jQuery.getJSON("/api/web/ContentAPI/getChapters",{ebookId:i.val()},function(e){s=e.data.chapters,s&&s.forEach(function(e){c.append(jQuery("<option/>").val(e.id).html(e.title))}),c.selectBox("destroy").selectBox(),d.selectBox("destroy").selectBox(),l&&c.selectBox("value",l.properties.ebook_chapter_id),h()})},h=function(){d.find("*").remove(),jQuery.getJSON("/api/web/ContentAPI/getSections",{chapterId:c.val()},function(e){if(a=e.data.sections,a&&a.forEach(function(e){d.append(jQuery("<option/>").val(e.id).data("uuid",e.uuid).html(e.name))}),d.selectBox("destroy").selectBox(),l){d.selectBox("value",l.ebook_chapter_id);var t=f.properties.section_id,n=f.properties.section_uuid;d.find("option").each(function(e){(this.value==t||$(this).data("uuid")==n)&&d.selectBox("value",this.value)})}})};if(i.on("change",u),c.on("change",h),r&&r.length){var f=r.data("widget");f&&"ebook-link"==f.wid?(l=f,jQuery.getJSON("/api/web/ContentAPI/getEbookId",{chapterId:f.properties.ebook_chapter_id},function(e){var t=e.data.ebookId;t&&i.selectBox("value",t),u()})):u()}else u()})},create:function(t,n,i){n&&(e=n,t.addClass("unusual-link"));jQuery.parseJSON(t.attr("data"));return n?this.setupInEditor(t,n):this.setupOffEditor(t),t}}}()),"undefined"==typeof Widgets&&(Widgets={}),Widgets.EbookSection=Widgets.Base().extend({properties:{header:"",title:"",location:"",date:""},getIndex:function(e){var t=e.data("widget");return t?t.properties.idx:void 0},create:function(e,t,n){return e=this.parent.create(e,t,n),e.find(".banner .title").text().trim()||e.find(".banner .locationdate").text().trim()||e.find(".banner").remove(),e.find(".header").text().trim()||e.find(".header").remove(),e}}),"undefined"==typeof Widgets&&(Widgets={}),Widgets.Embed=Widgets.Base().extend({properties:{"float":"none",width:"500px"},create:function(e,t,n){if(e=this.parent.create(e,t,n),t){var i=e.find(".embedded-content"),r=i.outerWidth()-i.width();i.outerHeight()-i.height();e.on("resize",function(){i.css("width",e.width()-r+"px"),i.find(".embed-link").css("width",i.find(".embed-content").width()+"px")})}return e},search:function(e,t){if(e){var n=this,i=jQuery.extend({},t,{url:e});jQuery.ajax({url:"/api/web/CouchContent/embedPreview",dataType:"json",type:"post",data:i}).success(function(t){0==t.status&&(n.container.find(".hint").hide(),n.container.find(".preview .image img").attr("src",t.data.image||"about:blank"),n.container.find(".preview .title").html("").html(t.data.title),n.container.find(".preview .description").html("").html(t.data.description),n.container.find(".preview .url a").html(e.length>50?e.substr(0,47)+"...":e).attr("href",e),n.container.find(".embed").show(),n.container.find("input[data-resource-property=image]").val(t.data.image),n.container.find("input[data-resource-property=title]").val(t.data.title),n.container.find("input[data-resource-property=description]").val(t.data.description),n.container.find("input[data-resource-property=url]").val(e))}).error(function(e){n.container.find("embed").hide(),n.container.find(".hint").show().html(window.t("Provided URL exposes no meta information"))})}},dialog:function(e,t,n,i,r){var o=this;return this.container=this.parent.dialog(e,t,n,i,r),this.search(this.container.find("input[name=search]").val(),i),this.container.find(".cBtn").on("click",function(){var e=o.container.find("input[name=search]").val();return o.search(e,i),!1}),this.container}}),"undefined"==typeof Widgets&&(Widgets={}),Widgets.ExternalVideo=Widgets.Base().extend({properties:{"float":"none",width:"540px",height:"303px"},create:function(e,t,n){e=this.parent.create(e,t,n);var i=e.width(),r=e.height();e.find("iframe").attr("width",i).attr("height",r);var o=e.data("widget");switch(o.resources[0].properties.server){case"youtube.com":o.resources[0].properties.playlistId?e.find("iframe").attr("src","https://www.youtube.com/embed/videoseries?list="+o.resources[0].properties.playlistId):e.find("iframe").attr("src","https://www.youtube.com/embed/"+o.resources[0].properties.id);break;case"vimeo.com":e.find("iframe").attr("src","https://player.vimeo.com/video/"+o.resources[0].properties.id);break;case"livestream.com":var a=JSON.parse(o.resources[0].properties.id);e.find("iframe").attr("src","https://livestream.com/accounts/"+a.account+"/events/"+a.event+(a.video?"/videos/"+a.video:"")+"/player?width="+i+"&height="+r+"&autoPlay=false&mute=false")}return t&&e.on("resize",function(){e.find("iframe").attr("width",e.width()).attr("height",e.height())}),e},search:function(e){if(e){var t,n,i,r,o;if(t=e.match(/youtube\.com\/watch\?v=([^&$]+)/))n=t[1],i='<iframe width="560" height="315" src="https://www.youtube.com/embed/'+n+'" frameborder="0" allowfullscreen></iframe>',r="youtube.com";else if(t=e.match(/youtube\.com\/playlist\?list=([^&$]+)/))o=t[1],i='<iframe width="560" height="315" src="https://www.youtube.com/embed/videoseries?list='+o+'" frameborder="0" allowfullscreen></iframe>',r="youtube.com";else{if(!(t=e.match(/vimeo\.com\/(\d+)/))){if(t=e.match(/livestream\.com\/(.+)/)){var a=this;return void jQuery.getJSON("/api/web/ContentWidgetAPI/resolveLivestreamEmbed",{data:t[1]},function(t){t.data&&t.data.account&&t.data.event&&(n={account:t.data.account,event:t.data.event},t.data.video&&(n.video=t.data.video),i='<iframe src="https://livestream.com/accounts/'+n.account+"/events/"+n.event+(n.video?"/videos/"+n.video:"")+'/player?width=560&height=315&autoPlay=false&mute=false" width="560" height="315" frameborder="0" scrolling="no"> </iframe>',r="livestream.com",a.container.find(".preview").html(i),a.container.find("input[data-resource-property=server]").val(r),a.container.find("input[data-resource-property=id]").val(JSON.stringify(n)),a.container.find("input[data-resource-property=url]").val(e))})}return}n=t[1],i='<iframe src="https://player.vimeo.com/video/'+n+'" width="560" height="315" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>',r="vimeo.com"}this.container.find(".preview").html(i),this.container.find("input[data-resource-property=server]").val(r),this.container.find("input[data-resource-property=id]").val(n||""),this.container.find("input[data-resource-property=playlistId]").val(o||""),this.container.find("input[data-resource-property=url]").val(e)}},dialog:function(e,t,n,i,r){var o=this;return this.container=this.parent.dialog(e,t,n,i,r),o.search(this.container.find("input[name=search]").val()),o.container.on("click",".resource-properties .cBtn",function(){return o.search(o.container.find("input[name=search]").val()),!1}),this.container}}),"undefined"==typeof Widgets&&(Widgets={}),Widgets.File=Widgets.Upload().extend({properties:{"float":"left",width:"auto"},create:function(e,t,n){e=this.parent.create(e,t,n);var i=e.data("widget"),r=e.find(".icon img");if(!r.attr("src")){var o=i.resources[0]&&i.resources[0].properties.filename;if(o){var a=o.substr(o.lastIndexOf(".")+1||1/0).toLowerCase();a&&["doc","docx","xls","xlsx","pdf"].contains(a)?r.attr("src",config.assetDir()+"/images/icons/"+a.substr(0,3)+".png"):r.attr("src",config.assetDir()+"/images/icons/default.png")}}return e.data("widget",i),e},dialog:function(e,t,n,i,r){e=this.parent.dialog(e,t,n,i,r),e.find("input[type=file]").on("chess24:done",function(t,n){e.find("[data-resource-property=filename]").val(n.originalFiles[0].name)})}}),"undefined"==typeof Widgets&&(Widgets={}),Widgets.GlossaryLink=Widgets.Base().extend(function(){var e;return{properties:{glossary_id:null,glossary_name:null,text:null},setupInEditor:function(e,t){var n=jQuery.parseJSON(e.attr("data"));e.off("dblclick").on("dblclick",function(){t.extensions.widgets.editWidget(e)}),e.on("change",function(){var t=e.clone().find("span").remove().end().html().trim();if(n.text!=t){var i=e.data("widget");i.properties.text=t,e.attr("data-widget",jQuery.toJSON(i)),n.text=e.html(),e.attr("data",jQuery.toJSON(n))}})},setupOffEditor:function(e){},dialog:function(e,t,n,i,r){t.extensions.link&&t.extensions.link.formOptions(e,r,"glossary-link");var o=e.find("[data-widget-property=text]");o.val()||o.val(r.text()),e.find("[data-auto-suggest]").on("chess24:select",function(){e.find("[data-widget-property=glossary_id]").val(this.value),e.find("[data-widget-property=glossary_name]").val(e.find("input.suggestField[type=text]").val())});var a=e.find("input[data-widget-property=text]");a.val()||a.val(r.clone().find("span").remove().end().html().trim())},create:function(t,n,i){n&&(e=n,t.addClass("unusual-link"));jQuery.parseJSON(t.attr("data")),t.data("widget");return n?this.setupInEditor(t,n):this.setupOffEditor(t),t}}}()),"undefined"==typeof Widgets&&(Widgets={});var initGoogleMaps=function(){"undefined"!=typeof google&&(Widgets.GoogleMaps=Widgets.Base().extend({map:null,marker:null,geocoder:null,container:null,controls:{panControl:!1,zoomControl:!1,mapTypeControl:!1,scaleControl:!1,streetViewControl:!1,overviewMapControl:!1,mapTypeId:google.maps.MapTypeId.ROADMAP},properties:{"float":"none",width:"100%",height:"50%"},createMap:function(e,t,n,i){var r=this;this.container.find("input[type=checkbox]").each(function(){var e=jQuery(this).attr("data");e&&(r.controls[e]=!!this.checked)}),this.map=new google.maps.Map(this.container.find(".map").get(0),jQuery.extend({center:e,zoom:t,scrollwheel:!1},this.controls)),n&&this.map.setMapTypeId(n),this.marker=new google.maps.Marker({position:this.map.getCenter(),map:this.map}),i&&(google.maps.event.clearListeners(this.map,"click"),google.maps.event.clearListeners(this.map,"zoom_changed"),google.maps.event.clearListeners(this.map,"maptypeid_changed"),google.maps.event.addListener(this.map,"click",function(e){r.centerMap(e.latLng),r.findLocation(e.latLng)}),google.maps.event.addListener(this.map,"zoom_changed",function(){r.save()}),google.maps.event.addListener(this.map,"maptypeid_changed",function(){r.container.find("input[data-resource-property=maptypeid]").val(r.map.getMapTypeId())}),r.save(),r.container.find("input[data-resource-property=maptypeid]").val(r.map.getMapTypeId()))},setupFormEvents:function(){var e=this;this.container.find(".cBtn.search").on("click",function(){var t=[];e.container.find("input[type=text]").each(function(){this.value&&t.push(this.value)}),t.length&&e.findAddress(t.join(", "))}),this.container.find("input[type=checkbox], .checkbox").on("click",function(){var t=jQuery(this).is("input")?jQuery(this):jQuery(this).find("input:first"),n=t.attr("data");n&&(e.controls[n]=t.is("[type=checkbox]")?!!t.attr("checked"):!!t.attr("value"),e.createMap(e.map.getCenter(),e.map.getZoom(),e.map.getMapTypeId(),!0),e.saveJson(e.container))})},centerMap:function(e){e||(e=this.marker.getPosition()),this.map.panTo(e),this.marker.setPosition(e),this.save()},save:function(){var e=this.map.getCenter(),t=this.map.getZoom();this.container.find("input[data-resource-property=latitude]").val(e.lat()),this.container.find("input[data-resource-property=longitude]").val(e.lng()),this.container.find("input[data-resource-property=zoom]").val(t),this.saveJson(this.container)},parseComponents:function(e){for(var t={},n=0;n<e.length;n++){var i=e[n].types;i&&(t[i[0]]=e[n].long_name)}return t},updateAddress:function(e){var t=this.parseComponents(e),n=[],i=[];t.route&&n.push(t.route),t.street_number&&n.push(t.street_number),t.locality&&i.push(t.locality),t.postal_code&&i.push(t.postal_code),this.container.find("input[data-resource-property=address]").val(n.join(" ")),this.container.find("input[data-resource-property=city]").val(i.join(" ")),this.container.find("input[data-resource-property=country]").val(t.country||"")},findAddress:function(e){var t=this;this.geocoder.geocode({address:e},function(e,n){n==google.maps.GeocoderStatus.OK&&(t.centerMap(e[0].geometry.location),t.updateAddress(e[0].address_components))})},findLocation:function(e,t){var n=this,i=e instanceof google.maps.LatLng?e:new google.maps.LatLng(e,t);this.geocoder.geocode({latLng:i},function(e,t){t==google.maps.GeocoderStatus.OK&&n.updateAddress(e[0].address_components)})},create:function(e,t,n){this.container=this.parent.create(e,t,n);var i=this;0==e.find("ul li").length&&e.find("ul").remove();var r=e.find(".map"),o=e.data("widget").resources[0].properties;return o&&(this.controls.panControl=0!=o.panControl,this.controls.zoomControl=0!=o.zoomControl,this.controls.mapTypeControl=0!=o.mapTypeControl,this.controls.scaleControl=0!=o.scaleControl,this.controls.streetViewControl=0!=o.streetViewControl,this.controls.overviewMapControl=0!=o.overviewMapControl,this.createMap(new google.maps.LatLng(o.latitude,o.longitude),parseInt(o.zoom),o.maptypeid)),r.css({width:e.width+"px",height:e.height()-e.find("ul").outerHeight()+"px"}),google.maps.event.trigger(i.map,"resize"),i.centerMap(),t&&e.on("resize",function(){r.css({width:e.width+"px",height:e.height()-e.find("ul").outerHeight()+"px"}),google.maps.event.trigger(i.map,"resize"),i.centerMap()}),this.container},dialog:function(e,t,n,i,r){var o=this;if(e){this.container=this.parent.dialog(e,t,n,i,r);var a=e.find("input[data-resource-property=latitude]").val(),s=e.find("input[data-resource-property=longitude]").val(),l=e.find("input[data-resource-property=zoom]").val()||8,c=e.find("input[data-resource-property=maptypeid]").val();if(a&&s||(a=43.945372,s=12.457672,"undefined"!=typeof navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){var t=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);o.centerMap(t),o.findLocation(t)})),r&&r.length){var d,u=r.data("widget").resources[0].properties,h=[];for(d in this.controls)h.push(d);h.push("showAddress");for(var f=0;f<h.length;f++)d=h[f],e.find("input[data-resource-property="+d+"]").val(0!=u[d]?1:0).parent()[0!=u[d]?"addClass":"removeClass"]("checked")}return this.createMap(new google.maps.LatLng(a,s),parseInt(l),c,t),this.geocoder=new google.maps.Geocoder,this.setupFormEvents(),this.container}}}))};!function(){return"undefined"!=typeof google&&google.maps?function(e){e()}:jQuery}()(initGoogleMaps),"undefined"==typeof Widgets&&(Widgets={}),Widgets.Html=Widgets.Base().extend({properties:{"float":"none",width:"540px",height:"auto",plain:0},create:function(e,t,n){return e=this.parent.create(e,t,n),e.find("iframe").attr("width",e.width()).attr("height",e.height()),t&&e.on("resize",function(){e.find("iframe").attr("width",e.width()).attr("height",e.height())}),e},dialog:function(e,t,n,i,r){return this.container=this.parent.dialog(e,t,n,i,r),this.container.find("input[type=text]").on("change",function(){var e=jQuery(this),t=e.val();"%"!=t.substr(t.length-1,1)&&("height"!=e.data("widget-property")||"auto"!=t)&&(t=parseInt(e.val(),10),e.val(t?t+"px":""))}),this.container.find("textarea").on("change",function(){var e=jQuery(this);e.val(e.val().replace(/connect.facebook.net\/([^\/]+)\/sdk.js/i,"connect.facebook.net/$1/all.js"))}),this.container}}),"undefined"==typeof Widgets&&(Widgets={}),Widgets.Image=Widgets.Upload().extend({properties:{"float":"left",width:"auto"},create:function(e,t,n){function i(){if("auto"==r.properties.width){var n=e.outerWidth()-e.width();o.css({"max-width":e.parent().width()-n+"px",width:"auto"}),e.css("width",o.width()+"px"),t||o.on("load",function(){e.css("width",o.width()+"px").trigger("resize")})}else o.css("width",e.width()+"px").on("load",function(){e.trigger("resize")});t&&(e.on("resize",function(){o.css("width",e.width()+"px"),e.css("height","auto")}),o.off("load").one("load",function(){var t=r.properties.width;if("auto"==t){e.css("width","auto");var n=Math.min(o.width(),e.width());0==n?(o.css("width","auto"),e.css("width",o.width()+"px")):(e.css("width",n+"px"),o.css("width",n+"px").css("max-width",""))}e.trigger("resize"),"auto"==t&&(r.properties.width="auto",e.attr("data-widget",jQuery.toJSON(r)))}))}e=this.parent.create(e,t,n),""==e.find(".info").text().trim()&&e.find(".info").remove();var r=e.data("widget"),o=e.find("img");return o.attr("src")?i():jQuery.getJSON("/api/web/contentWidgetAPI/getImageUrl?id="+r.resources[0].reference_id,function(e){o.attr("src",e.data.url),i()}),e},dialog:function(e,t,n,i,r){e=this.parent.dialog(e,t,n,i,r),e.find("#image-widget-cid").val(n.formData.cid);var o=e.find(".hint-area"),a=e.find(".preview-area"),s=e.find(".edit-area");e.find("input[type=file]").on("chess24:add",function(e,t){o.add(a).add(s).hide(),l.hide()}).on("chess24:done",function(e,t){t?(a.find("img").attr("src",t.result.data.reference_url),a.find(".label").html(t.result.data.filename)):a.find(".label").html(window.t("Uploaded image")),a.add(s).show(),s.find(".editor-toolbar").css("width","auto"),s.css("height",a.innerHeight()+"px"),a.find("img").on("load",function(){s.css("height",a.innerHeight()+"px")}),l.show()}),t.toggleToolDialogButtons(!1);var l=e.find(".buttons a.submit");if(l.on("click",function(){t.extensions.widgets.save()}),e.find(".editor").editor({input:e.find("input[data-resource-property=caption]"),extensions:["wrapper","link","align","clear","history"],toolbar:["bold","link","alignleft","aligncenter","alignright"],extraClass:"white",height:70,banner:window.t("Comment:")}),r&&r.is(t.widgetmask)){var c=e.find(".resource-upload-preview img"),d=r.data("widget");c.attr("src")||jQuery.getJSON("/api/web/contentWidgetAPI/getImageUrl?id="+d.resources[0].reference_id,function(e){c.attr("src",e.data.url)}),e.find("input[type=file]").trigger("chess24:done")}else l.hide();return e}}),"undefined"==typeof Widgets&&(Widgets={}),Widgets.SimpleChessBoard=Widgets.ChessView().extend({properties:{fen:"",highlights:""},dialog:function(e,t,n,i,r){e=this.parent.dialog(e,t,n,i,r),this.chessBase.init(t.config.chessGames);var o=e.find("[data-widget-property=fen]"),a=e.find("[data-widget-property=highlights]");return o.val()||o.val(Chess.defaultFen),t.extensions.chess.positionBuilder(e.find(".position-builder"),o.val(),a.val()).on("chess24:change",function(e,t){o.val(t.fen),a.val(t.highlights?jQuery.toJSON(t.highlights):"")}),e},create:function(e,t,n){e=this.parent.create(e,t,n),t?e.prependTo(t).attr("draggable",!1):e.prependTo(e.closest(".couch-content"));var i=e.data("widget"),r=parseInt(i.properties.viewId,10)||0,o=this.chessBase.getView(r);if(o&&(this.chessBase.unlinkView(r),o=void 0),e.find(".chess-board").remove(),o=new View.ChessBoard(e,!1),r=this.chessBase.addView(r,o),parseInt(r,10)!==parseInt(i.properties.viewId,10)&&(i.properties.viewId=r,e.attr("data-widget",jQuery.toJSON(i))),i.properties.fen)try{var a=new Chess.Game({fen:i.properties.fen});this.chessBase.unlinkView(r),o.link(a);var s=i.properties.highlights;if("string"==typeof s&&s.length&&(s=jQuery.parseJSON(s)),s)for(var l=0;l<s.length;l++)s[l].square?a.addHighlight({square:Chess.getSquare(s[l].square.y,s[l].square.x),color:s[l].color}):s[l].frame?a.addHighlight({frame:Chess.getSquare(s[l].frame.y,s[l].frame.x),color:s[l].color}):s[l].line&&a.addHighlight({line:Chess.getMove(s[l].line.y1,s[l].line.x1,s[l].line.y2,s[l].line.x2),color:s[l].color})}catch(c){}return e}}),"undefined"==typeof Widgets&&(Widgets={}),Widgets.Slideshow=Widgets.Upload().extend({multiple:!0,properties:{width:"",height:"60%","float":"none"},create:function(e,t,n){e=this.parent.create(e,t,n);var i=e.find("ul"),r=0,o=e.data("widget");i.find("img").each(function(e){var t=jQuery(this);t.attr("src")||(r++,jQuery.getJSON("/api/web/contentWidgetAPI/getImageUrl?id="+o.resources[e].reference_id,function(e){r--,t.attr("src",e.data.url)}))});var a=setInterval(function(){0===r&&(i.slideshow({height:e.height(),stage:Math.round(.74*e.height())}),clearTimeout(a))},10);if(t){var s=function(){i.slideshow("adjust",e.width(),e.height())};e.on("resize",s),s()}},slideshow:function(e,t,n){var i=function(){var t=[],i=0;e.find("li").each(function(){var e=jQuery(this);t.push(e.attr("data-resource-id")),e.attr("data-resource-id",i).data("resource-id",i++)}),n.extensions.widgets.reorderResources(t)};e.slideshow({height:414,stage:305,reorder:".move-button",onreorder:i}).slideshow("adjust",t)},dialog:function(e,t,n,i,r){e=this.parent.dialog(e,t,n,i,r);var o=t.extensions.widgets.widgetdata;if(o&&o.resources)for(var a=0;a<o.resources.length;a++)o.resources[a].properties&&o.resources[a].properties.url&&delete o.resources[a].properties.url;var s=this,l=e.find(".resources-previews"),c=e.find(".resource-properties[data-key=image]"),d=e.find(".hint-area"),u=e.find(".preview-area"),h=e.find(".edit-area"),f=e.find(".buttons a.save-button"),p=e.find(".buttons a.submit"),m=e.find("a.cancel").hide(),g=function(){c.hide(),l.show(),h.hide(),u.hide(),d.show(),f.hide(),m.show(),e.find(".editor").html(""),s.slideshow(l.find("ul"),l.show().width(),t)},v=function(){e.find(".fileupload").nextAll(".fileUploadProgress").remove()},y=0,b=0;if(e.find("input[type=file]").on("chess24:add",function(e,t){d.add(u).add(h).hide(),y++,b=y}).on("chess24:done",function(e,n){return y--,u.find("img").attr("src",n.result.data.reference_url),u.find("label").html(n.result.data.filename),h.find("[data-resource-property=reference_id]").val(n.result.data.reference_id),f.off("click",g),b>1?(f.trigger("click"),void(y>0?(l.hide(),c.show()):s.slideshow(l.find("ul"),l.show().width(),t))):(0==y&&(v(),b=0),d.hide(),u.add(h).show(),h.find(".editor-toolbar").css("width","auto"),h.css("height",u.innerHeight()+"px"),u.find("img").on("load",function(){h.css("height",u.innerHeight()+"px")}),n&&u.find(".label").html(n.files[0].name),f.show(),void f.on("click",g))}).on("chess24:error",function(e){y--}),t.toggleToolDialogButtons(!1),p.on("click",function(){t.extensions.widgets.save()}),m.on("click",function(){h.hide(),u.hide(),d.show(),l.show(),l.find("ul.resources-previews-list").slideshow("adjust"),c.hide(),f.hide()}),l.find(".slideshow li").on("click",function(){l.find(".slideshow-stage input").remove()}),e.on("click",".edit-button",function(){v(),s.multiple=!1,h.add(u).show(),d.hide(),f.show(),u.find("img").attr("src",jQuery(this).closest(".resources-preview-item").find("img").attr("src")),u.find(".label").html(window.t("Uploaded image")),h.find(".editor-toolbar").css("width","auto"),h.css("height",u.innerHeight()+"px"),u.find("img").on("load",function(){h.css("height",u.innerHeight()+"px")}),f.html(window.t("Update image"))}),e.on("click",".add-button",function(){v(),s.multiple=!0,h.add(u).hide(),d.show(),f.html(window.t("Insert image")),e.find(".editor").html("<p/>")}),e.on("click",".delete-button",function(){var e=0;l.find("ul li").each(function(){jQuery(this).attr("data-resource-id",e).data("resource-id",e++)})}),e.on("update",function(){var e=l.find("ul img"),t=e.length;e.each(function(){var e=jQuery(this);return e.attr("src")?void t--:void jQuery.getJSON("/api/web/contentWidgetAPI/getImageUrl?id="+e.data("reference-id"),function(n){t--,e.attr("src",n.data.url)})}),function n(){return t>0?void setTimeout(n,50):void l.find("ul").slideshow("adjust",l.width())}()}),h.find(".editor").html("").editor({input:h.find("input[data-resource-property=caption]"),extensions:["wrapper","link","align","clear","history"],toolbar:["bold","link","alignleft","aligncenter","alignright"],extraClass:"white",height:70,banner:window.t("Comment:")}),r&&r.is(t.widgetmask)){l.show();var w=0,k=r.data("widget");l.find("ul img").each(function(e){var t=jQuery(this);w++,jQuery.getJSON("/api/web/contentWidgetAPI/getImageUrl?id="+k.resources[e].reference_id,function(e){w--,t.attr("src",e.data.url)})});var x=setInterval(function(){0===w&&(s.slideshow(l.find("ul"),l.width(),t),clearTimeout(x))},10);h.hide(),u.hide(),d.show(),c.hide(),m.show()}else l.hide(),c.show();return f.hide(),e}}),"undefined"==typeof Widgets&&(Widgets={}),Widgets.Table=function(){return Widgets.Base().extend({properties:{"float":"none",width:"100%"},clearTdEllipsis:function(e){e.find("div.td-ellipsis").each(function(){jQuery(this).parent().data("restore-text",jQuery(this).html()).end().replaceWith(jQuery("<div/>").css("height",jQuery(this).height()+"px").css("background","#e8e8e8").html("&nbsp;"))})},setupTdEllipsis:function(e){e.find("tr:first").get(0);e.find("td,th").each(function(){var e=jQuery(this);if(e.html()){var t=e.data("restore-text");t||(t=e.html());var n=jQuery("<div/>").addClass("td-ellipsis").appendTo(e.html(""));n.css("width",n.width()+"px").append(t)}}),e.find(".cover").css({width:e.css("width"),height:e.css("height")})},create:function(e,t,n){e=this.parent.create(e,t,n);var i=e.data("widget").resources[0].properties.data;if((t||0==e.find("table").length)&&i){for(var r,o=jQuery("<table/>").addClass("table").attr("cellspacing","0").attr("cellpadding","0"),a=1,s=0;s<i.length;s++){r=jQuery("<tr/>").addClass(a?"odd":"even").appendTo(o);for(var l=0;l<i[s].cells.length;l++){var c=i[s].cells[l],d=jQuery("<"+(i[s].header?"th":"td")+"/>").css("width",c.params.width+"%").appendTo(r),u=c.params.link?'<a href="'+c.params.link+'">'+c.text+"</a>":c.text;c.params.center&&d.css("text-align","center"),c.params.bold&&d.css("font-weight","bold"),c.params.colspan&&d.attr("colspan",c.params.colspan),c.params.flag&&(u='<span class="flag flag-'+c.params.flag+'"></span>'),c.params.empty&&(d.addClass("empty"),u="&nbsp;"),l==i[s].cells.length-1&&d.addClass("last"),
u=u.replace(/%26/g,"&").replace(/%3E/g,">").replace(/%3C/g,"<"),d.html(u)}a=1-a}o.appendTo(e.html(""))}if(e.find("table").css({width:e.width()+"px","float":e.css("float")}),t){var h=this;e.on("resize",function(t,n){h.clearTdEllipsis(e);var i=e.find("table").css({width:e.width()+"px","float":e.css("float")});i.width()>e.width()&&e.css("width",i.width()+"px").trigger("resize",n),n||h.setupTdEllipsis(e)}),this.setupTdEllipsis(e)}return e},dialog:function(e,t,n,i,r){e=this.parent.dialog(e,t,n,i,r),r&&r.is(t.widgetmask)&&e.find("a.back,h3").remove();var o=r&&r.length?jQuery.toJSON(r.data("widget").resources[0].properties.data):"",a=e.find(".resource-properties[data-key=table]");return a.length?a.on("show",function(){var e=jQuery(this).find("input[data-resource-property=data]").val(o);jQuery(this).find(".table-builder,.widget-table-builder").tableBuilder(t,n,e)}):e.find(".widget-table-builder").tableBuilder(t,n,e.find("input[data-resource-property=data]").val(o)),e}})}(),"undefined"==typeof Widgets&&(Widgets={}),function(){return"undefined"!=typeof google&&google.maps?function(e){e()}:jQuery}()(function(){"undefined"!=typeof google&&(Widgets.Tournament=Widgets.GoogleMaps().extend({controls:{panControl:!1,zoomControl:!0,mapTypeControl:!0,scaleControl:!1,streetViewControl:!0,overviewMapControl:!1,mapTypeId:google.maps.MapTypeId.ROADMAP},properties:{"float":"none",height:"60%"},create:function(e,t,n){this.container=this.parent.create(e,t,n);var i=this,r=e.find(".map"),o=e.find(".info"),a=e.data("widget").resources[0].properties;a&&this.createMap(new google.maps.LatLng(a.latitude,a.longitude),parseInt(a.zoom),a.maptypeid,t),r.add(o).css({width:Math.floor(e.width()/2)+"px",height:e.height()+"px"}),google.maps.event.trigger(i.map,"resize"),i.centerMap();var s=e.find(".players");if(t){e.on("resize",function(){r.add(o).css({width:Math.floor(e.width()/2)+"px",height:e.height()+"px"}),google.maps.event.trigger(i.map,"resize"),i.centerMap();var t=e.height()/e.width()*100,n=e.data("widget");n.properties.height=t+"%",e.attr("data-widget",jQuery.toJSON(n))});var l=s.next("li");if(0==l.html().trim().length){var c=e.data("widget"),d=c.resources[0].properties.players;if(d)for(var u=c.resources[0].properties.players_meta,h=c.resources[0].properties.players_label,f=0;f<d.length;f++)l.append(("1"==u[f]?'<a href="">'+h[f]+"</a>":d[f])+(f<d.length-1?", ":""));else s.add(s.next("li")).hide()}}else 0==s.next("li").html().trim().length&&s.add(s.next("li")).hide();return this.container},dialog:function(e,t,n,i,r){var o=this;e=this.parent.dialog(e,t,n,i,r),e.find("input[data-resource-property=location]").on("change",function(){o.findAddress(this.value)}),e.find("input[type=text],textarea").on("change",function(){o.saveJson(e)});var a=e.find("[data-auto-suggest]");if(a.on("chess24:select",function(){a.nextAll("input[type=hidden]").add(a.parent(".flexiInputWrapper").nextAll("input[type=hidden]")).remove(),a.find("input[type=hidden]").each(function(){var e=jQuery(this).clone().insertAfter(a);e.attr("data-resource-property",e.attr("name"))})}),!a.data("value")&&r&&r.length){var s=[],l=r.data("widget");if(l){var c=l.resources[0].properties.players;if(c)for(var d=l.resources[0].properties.players_meta,u=l.resources[0].properties.players_label,h=0;h<c.length;h++)s.push({name:u[h],value:"1"==d[h]?c[h]:void 0});a.data("value",s)}}return o.save(),e}}))}),"undefined"==typeof Widgets&&(Widgets={}),Widgets.Twitter=Widgets.Base().extend({properties:{"float":"none",width:"500px"},tweetUrl:null,html:function(e){return new Handler.Template("widgets").render("widget-twitter-content-twitter",{properties:{url:e}})},create:function(e,t,n){e=this.parent.create(e,t,n);var i=e.data("widget").resources[0].properties;if(t){e.find("iframe").length&&e.find("iframe").remove().end().prepend(this.html(i.url)),e.find("blockquote").after('<script src="//platform.twitter.com/widgets.js" charset="utf-8"></script>');var r=setInterval(function(){e.find(".twitter-tweet-rendered").length>0&&(e.trigger("resize",!0),clearTimeout(r))},500);e.on("chess24:dragend",function(){if(e.find("iframe").length&&i.url){e.css("min-height",e.height()+"px"),e.find("iframe").remove(),e.prepend(this.html(i.url));var t=setInterval(function(){e.find(".twitter-tweet-rendered").length>0&&(e.css("min-height",""),clearTimeout(t))},500)}})}return e},search:function(e){e&&(this.container.find(".preview").html(this.html(e)),this.container.find("input[data-resource-property=url]").val(e))},dialog:function(e,t,n,i,r){var o=this;return this.container=this.parent.dialog(e,t,n,i,r),this.container.on("click",".form a",function(){return o.search(o.container.find("input[name=search]").val()),!1}),this.search(this.container.find("input[name=search]").val()),this.container}});